42374,451062,920240,6,"You'll need to add a check for whether the use cancelled the event.

So perhaps change these lines to:

```js
var e // put this up the top with the other variables for consistency

this.$element.trigger(e = $.Event('show')
if (e.isDefaultPrevented()) retu",4112055,2012-06-04 03:49:54
42374,451062,920243,16,"Since we don't need to use this event again (such as checking `isDefaultPrevented()`), there's no need to create a a `jQuery.Event` for it.

You could simply write:

```js
this.$element.trigger('shown')
```

Same applies for hidden.",4112055,2012-06-04 03:51:38
42374,443348,920246,16,"Uhm... I'm rather confused now :) do I need to check
""isDefaultPrevented()"" or not?

In case... Can't you just fix it by yourself? The patch is damn small,
as it adds only 4 lines per each function (8 lines in total), and you
know the code and the APIs be",4112055,2012-06-04 03:54:41
42374,451062,920252,16,"The check for `isDefaultPrevented()` allows the user to call `e.preventDefault()` in their event handler. For the `show` and `hide` events, if the user calls `e.preventDefault()`, it means they want to stop the `show` or `hide` function before it happens.",4112055,2012-06-04 04:07:35
42374,443348,920254,16,"Ok I'm very busy, but will take some time to do that tomorrow :)
Thanks for the advices!



Il giorno 04/giu/2012, alle ore 01:07, Richard Pickett
<reply@reply.github.com>
ha scritto:

>> @@ -145,6 +148,9 @@
>>           .css(tp)
>>           .",4112055,2012-06-04 04:09:47
47193,451062,1359044,4,Why aren't you using `this.options.tooltipPosition`? You should also add a default value to the defaults array.,4214196,2012-08-13 01:57:37
55770,5105,1128906,68,"Fix indenting here (2 spaces, not 4). Add comments for why we nuke the margins.",4365994,2012-07-10 12:01:05
55770,5105,1128908,52,"`rgba(0,0,0,.1)`—no extra spaces, no extra 0 before decimals.",4365994,2012-07-10 12:01:30
55770,5105,1128910,4,"Break selectors to two lines.

Also, add spaces after every `:`.",4365994,2012-07-10 12:01:55
55770,5105,1128914,35,No go in IE7—need an alternate approach.,4365994,2012-07-10 12:02:41
55770,48477,1545791,35,What's exactly the no go ? The whole block of code or the selectors in the last line?,4365994,2012-09-06 21:15:08
65828,72921,1296880,4,Perhaps kill out this `console.log()`,542639,2012-08-03 00:49:44
65828,72921,1296891,4,Perhaps kill out this `console.log()`,542639,2012-08-03 00:50:44
69278,451062,1369931,4,"```js
this.options.cache || this.$element.find('.modal-body').load(this.options.remote)
```
is shorter :)",4540761,2012-08-14 12:30:32
98768,451062,1408288,5,"The `!!` is unnecessary here because `this.options.pills` is already a Boolean. And even if it wasn't, you only need to check truthy or falsey here anyway.",5111943,2012-08-18 07:10:00
98768,451062,1408298,23,"You've mixed single and double quotes all the way through. The rest of BS uses single quotes so you should stick to that. Also to stick with BS's style, you should remove semicolons, spaces inside parentheses, unnecessary braces, etc.",5111943,2012-08-18 07:16:23
98768,451062,1408300,28,Why not use the existing `.active` utility class here? That would be consistent with the rest of BS.,5111943,2012-08-18 07:17:42
98768,451062,1408317,20,You can shorten this to `pills += '<span/>'` and jQuery will match up the closing tags for you. Also why not use `i++` on the line above?,5111943,2012-08-18 07:30:41
98768,43111,1426888,23,"Sure. The code was written before the famous semi-colon discussion, and I was just following JS linting. ",5111943,2012-08-21 22:21:18
98768,43111,1426901,28,I'll look into it. See how it works out. ,5111943,2012-08-21 22:22:56
98768,43111,1427315,28,"This isn't a good idea. When using the active class, one would need more css properties to override from .carousel .active, then just having active-pill as a seperate class. ",5111943,2012-08-21 22:56:16
98768,161924,2288945,17,"I would add a class for the individual pills (e.g: `.carousel-pill`). This way people can use any element they want, like `<button>` or `<a>`, rather than forcing everyone to use `<span>`. The `.carousel-control` is already done this way.",20960048,2012-12-03 10:14:52
98768,43111,2342848,17,"In my opinion, it's a hassle to match tags manually to the image elements. However, if more feel the way you do, I'd be happy to change this. ",20960048,2012-12-07 05:57:47
99223,451062,1408324,9,"You could rewrite this as `this.$element.parent('[data-toggle^=""buttons-radio""]')`. `^=` means *starts with*.",5119328,2012-08-18 07:39:44
99223,7144,1408326,9,"good idea, fixed",5119328,2012-08-18 07:42:56
167205,5101,1019796,28,dont' want to do this - we would want to continue to use delegation here. something like `* > li` should work`.,6188809,2012-06-20 22:31:43
167348,5101,1019754,5,could you change this to `this.$element.off().removeData('tooltip')`,6191486,2012-06-20 22:27:10
167348,5572,1019915,5,"sure, done.",6191486,2012-06-20 22:43:01
180431,5101,1212191,13,can you remove the spaces here? thanks!,6356747,2012-07-23 02:35:08
180431,5101,1212192,4,this isn't necessary,6356747,2012-07-23 02:35:29
180431,5101,1212193,17,use this.options.minLength,6356747,2012-07-23 02:35:41
192853,65291,1118086,4,"Both, ```MSTransitionEnd``` and ```transitionend```, do exist in IE10 but the former won't be ever called!",6528151,2012-07-07 13:43:01
195055,87942,1118768,12,Yes! ,6548881,2012-07-08 05:23:52
210566,5572,1212143,6,just realized that this could be combined into this.hide().off(this.options.ns)... if you like.,6210983,2012-07-23 01:57:42
210566,5101,1212176,6,yes pls,6210983,2012-07-23 02:14:39
221287,5101,1095328,55,ah nice - i prefer that - could you change this @gutomaia please - thanks!,6865521,2012-07-03 23:49:12
221290,44150,601181,5,isnt this the same as `if (this.options.pills)` ?,5111949,2012-03-25 23:16:05
221290,43111,601257,5,"Yes, but it's often used to convert to boolean value. ",5111949,2012-03-26 01:56:46
221290,895939,658356,5,"Yep, tested the carousel with pills and it works perfectly. Nice work mikaelbr!",5111949,2012-04-08 10:53:15
238446,451062,1444895,10,Indentation should be only 2 spaces here. :),7112573,2012-08-23 18:55:02
238446,136672,1459711,11,Also fixed the indentation. 2 spaces.,7396971,2012-08-25 20:15:39
270352,24060,411349,12,use matchMedia api to check if we are applying the mobile style,7529035,2012-02-03 01:45:52
270352,2503218,469538,24,"you can actually just unset the top property with jquery's css function. this will remove the property from the style attribute without obliterating anything else that may for some reason be applied

",7529035,2012-02-21 09:03:32
270352,2503218,469539,12,great idea! thanks this helped me!,7529035,2012-02-21 09:03:56
270352,24060,469557,24,That is very true and a much better fix.  I think I must have just followed the .removeClass just before it...but your way is a better approach,7529035,2012-02-21 09:12:21
271194,5101,417777,5,hm... this is wrong... Title tags are replaced with `data-original-title` attributes (so that a title tag isn't shown) - but the default title value is taken from the title tag.,7548974,2012-02-06 10:03:26
271194,5101,417778,7,this isn't actually correct either. We don't add a `data-tooltip` attribute. This could be a weird zepto thing. But you should still be able to do .attr('data-tooltip'),7548974,2012-02-06 10:05:00
271194,5101,417779,10,"nope, title tag",7548974,2012-02-06 10:05:26
271194,5101,417780,11,"yep, and above is now top",7548974,2012-02-06 10:05:41
271194,5101,417781,13,defaults to allow html now,7548974,2012-02-06 10:05:55
271194,32592,418036,5,"Okay, I get it now. I looked at the HTML of the bootstrap docs, but I was looking at the generated HTML and not the original source, hence the confusion.",7548974,2012-02-06 14:30:28
275601,443393,494259,28,"This should be using formatteddelimiter to prevent extra spaces:
```, input = this.mode === 'multiple' ? this.$element.val().split(this.formatteddelimiter()) : [this.$element.val()]```",7658261,2012-02-28 09:25:35
275601,48457,494267,28,The extra spaces will be removed in the `trim` call below. But this could be changed to use `formatteddelimiter()` so that the code matches.,7658261,2012-02-28 09:28:17
275601,443393,494285,28,That ```trim``` will only trim the last input - it's the previous inputs that end up with extra spaces.,7658261,2012-02-28 09:35:43
275601,48457,494293,28,"Ah, i see, my bad. Thanks for pointing that out!",7658261,2012-02-28 09:38:16
275601,443393,494298,28,Of course!,7658261,2012-02-28 09:40:00
288227,5101,600722,16,almost this entire function is duplicated logic,7970402,2012-03-25 08:58:53
288227,5101,600723,45,you're now managing two classes - active and inactive - yet they are literally boolean - the absence of one should presuppose the other state,7970402,2012-03-25 08:59:26
288227,5101,600724,62,"this is pretty hacky and adds a dependency for people to use the data attributes to get this ""initialize behavior"" - it also doesn't account for tabs which are injected after domready.",7970402,2012-03-25 10:00:00
288227,5101,600725,61,domready inception,7970402,2012-03-25 10:00:00
294363,451062,1469690,4,Should this be `.carousel-vertical` to maintain the naming conventions used elsewhere?,8149513,2012-08-28 03:30:20
294363,5105,1471608,4,I've made this change in my local branch—no need to change here.,8149513,2012-08-28 10:10:23
296345,5101,685624,4,`|| false` is redundant,8206446,2012-04-15 06:04:07
296345,5101,685627,15,"not crazy about having the label being maintained in the plugin. You should keep an object for lookups outside of this plugin which you then translate to. So for example, you would provide an array to the typeahead, if it matched ""@fat"" - you would use th",8206446,2012-04-15 06:08:19
296345,5101,685628,37,"```js
fn = $.isArray(this.source) ? 'lookupLocal' : 'lookupAsync'
```",8206446,2012-04-15 06:09:26
296345,129828,685729,4,"No t if you want it to default to an explicit false. However if you want a null/undefined then yes, it is redundant.",8206446,2012-04-15 10:22:55
298534,1826898,673889,5,"Instead of using the `hsla()` function, you could write `fade(@color, @alpha)`.",8273753,2012-04-12 03:53:33
305981,451062,1483374,5,The `+` isn't necessary here. It passes the test either way.,8516740,2012-08-29 14:05:47
313383,451062,1493929,5,Or simply `size != null` would check for both `null` and `undefined`,8745861,2012-08-30 11:46:46
340096,859,1648974,42,The key should be set according to ``this.itemLabel``,8642166,2012-09-20 14:46:16
354593,451062,1531396,6,"This looks nicer:
```js
return item == null ? 0 : ~item.toLowerCase().indexOf(this.query.toLowerCase())
```",10016384,2012-09-05 13:59:45
354593,346538,1531484,6,that's true :),10016384,2012-09-05 14:19:32
359619,451062,1554217,27,"This should probably be `.media-list` or `.media-group` for consistency with the rest of BS.

Besides media is already the plural form of medium so medias isn't grammatically correct. :)",10404716,2012-09-07 17:31:09
359619,5105,1625006,27,I'll handle that. Good call.,10404716,2012-09-18 06:13:58
373913,27865,488538,5,"This doesn't look right.

```
xxxx = { source : 'la di da' }
Object
typeof(xxxx.source === 'string')
""boolean""
typeof(this.source === 'string') ? 'true' : 'false'
""true""
typeof(this.source === 'magic') ? 'true' : 'false'
""true""
xxxx = ['zing']",11244889,2012-02-25 17:09:39
375080,5101,468520,4,why did you take these away?,7776882,2012-02-21 02:57:23
375080,328417,468534,4,"I wanted to run the test suite to make sure I didn't break anything and those stop() lines were preventing the suite from running. When I removed them, all the tests passed, so I left in the change. Please feel free to revert if necessary.",7776882,2012-02-21 03:03:22
376933,81423,494341,6,"Change @wellsize to @padding.

Add a space after the : as well.",11349531,2012-02-28 09:56:09
376933,81423,494343,15,It's not required that this CSS be redeclared at every size. Remove it from the mixin and apply it to the base `.well` class instead.,11349531,2012-02-28 09:56:43
376933,81423,494345,24,One too many spaces here.,11349531,2012-02-28 09:56:54
378578,274398,572700,13,This section creates the necessary markup and allows you to stack your HTML for a mobile/tablet layout and then display them differently for larger screens.,11405063,2012-03-19 08:19:17
406086,785187,1629212,4,set the backdrop z-index as the modal z-index - 1,12274776,2012-09-18 19:02:33
425715,859,1659961,27,"I think the default implementation of ``this.updater`` should be updated to return ``this.itemLabel(item)``, so that it does not break when people start passing objects (they will still need to update the method if they don't want to use the label as sele",12760610,2012-09-21 15:32:14
425715,859,1659975,7,The description is wrong. It should be ``Returns the identifier for the item``. Your implementation does not return the name of a property in the function,12760610,2012-09-21 15:34:22
425715,859,1659978,13,same issue here,12760610,2012-09-21 15:34:32
425715,60729,1659992,27,"Good point. From a compatibility perspective, this would be necessary. But at the same time, I'd love to see a callback when an item is selected. Perhaps a special new method? ",12760610,2012-09-21 15:36:07
425715,859,1659997,14,"it should return a string. Returning an integer will likely break as typeahead is calling string methods on it (``toLowerCase``, ``indexOf``, ...)",12760610,2012-09-21 15:36:33
425715,859,1660002,19,*and returns the value set in the field*,12760610,2012-09-21 15:37:08
425715,859,1660448,27,"well, the goal of ``updater`` is to return the value to set in the field from the item. Btw, this let me wonder if the default implementation should be ``itemLabel`` or ``itemKey``.
If you simply a callback running when selecting, a separate method should",12760610,2012-09-21 16:51:08
425715,60729,1660469,27,"Agree about the separate method. If I understood you correctly, the `updater` method is not supposed to be overriden by the consumer. Is this right? In my case, I added an extra property to the text field called ""data-selected-id"", but I'm handling it on ",12760610,2012-09-21 16:56:08
425715,60729,1660537,27,"Re-reading your comments gave me a different interpretation :-) So, the line for this comment wouldn't be changed, but the return value of updater, right? If so, then agreed completely and my points are invalid, as `updater` can still be used as a callbac",12760610,2012-09-21 17:15:47
425715,859,1660969,27,"@jpkrohling yeah, indeed. There is a way to use it as callback as long as you continue returning the value set in the field.",12760610,2012-09-21 18:15:20
425715,60729,1661136,27,"Alright, so, I implemented the suggestions on the newer commit, including the changes to the documentation. ",12760610,2012-09-21 18:29:35
426823,859,1661075,14,I would find more logical to use a boolean for ``setDisabled`` than a string ``'disabled'``,12682633,2012-09-21 18:24:44
426823,282887,1661315,14,"That's legit and I thought about doing that as well. 

I decided to use `'disabled'`, when you set the state of the button, because I felt it was more clear than using `true`.

E.G.
`$('#some-btn').button('complete', 'disabled');`

vs.

`$('#some-btn').bu",12682633,2012-09-21 18:46:23
427160,859,1661051,5,This should be done above when fixing the selector (line 113) instead of doing it here IMO,12710344,2012-09-21 18:22:39
429032,451062,1667613,6,"This can simply be written as
```js
width: this.$element[0].offsetWidth || 0
```",12833395,2012-09-22 17:13:52
430774,451062,1668845,5,`'' + item` is shorter than `item.toString()` :),13002023,2012-09-23 16:23:51
430774,140787,1669037,5,"Sure, but I'd say it's more unreadable.",13002023,2012-09-23 20:32:19
432048,169985,1670904,12,"Here I suggest to create an other variable called `@modalBoxShadowColor` for instance (or something better, as you want), which has `@modalBorder` as value.

What do you think?",13128053,2012-09-24 13:06:54
432048,140787,1670961,12,"We could do something like this:

```less
# variables.less
@modalBorder:         rgba(0,0,0,.3);
@modelBoxShadowColor: @modalBorder;
```",13128053,2012-09-24 13:15:18
432048,5105,1731244,6,"The problem with vars like `@whiteSmoke` is that it does mean this should only be `#f5f5f5`, not a light gray of some sort. I'd love us to abstract all our grayscale vars a bit more to something like `@black`, `@black90`, `@black80`, etc where each number",13527244,2012-10-01 23:33:28
432048,5105,1731253,16,Really all these should be consolidated somehow. That means making some calls on which border is most appropriate and works best across all relevant components. We just need a default border color and that be it.,13527244,2012-10-01 23:34:18
432048,5105,1731258,49,What are these ones for? No comments here to let us know.,13527244,2012-10-01 23:34:46
432048,5105,1731279,114,"Where do we draw the line on how many variables to support? To me, this is getting out of control a bit. We just need super lightweight and flexible defaults rather than overrides like this.",13527244,2012-10-01 23:36:02
432048,5105,1731297,135,"Instead of another set of custom colors for these, we need to be making use of global colors across the board. Would be interested in seeing that get fleshed out.",13527244,2012-10-01 23:36:43
432048,140787,1750853,6,I agree!,13527244,2012-10-03 19:57:30
432048,140787,1750883,49,It's for the text color and border color of an invalid input. I'll add comments and/or look at if it can be done differently.,13527244,2012-10-03 19:59:26
432048,140787,1750897,114,"The thought was that no colors should be hardcoded, as suggested in #5247.

I guess the borders can (or should) inherit from the default borders.",13527244,2012-10-03 20:00:22
432048,140787,1750918,135,"I agree, and was thinking of it when writing the code.

I'll see if I can make use of the global colours.
Probably just need to adjust the saturation, brightness or whatever to get matching results.",13527244,2012-10-03 20:01:42
432048,81423,1752048,135,"If need be, change the global color vars we have to be those of the alerts and what not. Those were specifically designed to work pretty well. I don't recall the state of the color vars honestly.",13527244,2012-10-03 21:35:07
440789,5101,1875344,12,this is a breaking change. you need to still bind to html i believe,13818401,2012-10-18 11:02:12
440789,5101,1875366,12,"hm nope, seems to work fine… though it will probably break something weird and we'll be sad in the future.",13818401,2012-10-18 11:06:09
440789,5101,1875373,12,hopefully not tho,13818401,2012-10-18 11:06:48
440789,1565,1875383,12,"i can't imagine what you could be doing for it to make a difference.

w/ the old school `$.fn.live`, jquery defaulted to binding to document. still a fine delegation context.",13818401,2012-10-18 11:10:56
440789,5101,1875589,12,document > body tho,13818401,2012-10-18 12:01:41
440789,5101,1875593,12,im not gonna worry about it,13818401,2012-10-18 12:02:05
450524,5101,1875177,5,changing this logic isn't necessary. we only need to move the event def further down. ,14348218,2012-10-18 10:23:20
461667,169985,2108118,4,"Already fixed on 2.2.2-wip. 
Here is the update on this file: https://github.com/twitter/bootstrap/blob/2.2.2-wip/less/tables.less",16307802,2012-11-13 17:24:51
481087,449240,1899202,15,"Can't this just be : 

```javascript
items = $.isFunction(window[this.source]) ? window[this.source](this.query, $.proxy(this.process, this)) : this.source
```

It's a bit less readable (really just a big IMO), but we use `$.isFunction` just one.",17064629,2012-10-22 01:23:13
481087,9080,1899350,15,"Guess not, because if the function was set through the javascript options object, the function wouldn't be a property of the window.",17064629,2012-10-22 03:02:12
481087,449240,1899352,15,"You're right, I didn't think of that ...",17064629,2012-10-22 03:04:24
481087,9080,1901202,15,"Yeah you're right about the duplicate `$.isFunction`, but getting around it is not very much possible. At first I thought of the following:

```js
source = window[this.source] ? window[this.source] : this.source
items = $.isFunction(source) ? source(t",17064629,2012-10-22 13:46:10
590154,5101,2287169,21,2 spaces… please follow code style,20806008,2012-12-02 17:22:59
590154,5101,2287170,22,no semicolons,20806008,2012-12-02 17:23:11
590154,60729,2290903,21,"Sorry, but I'm not going to spend more time on this if it would take another 2 months to get another review or to get it incorporated...",20806008,2012-12-03 17:32:55
590180,5101,2287173,8,this condition should be combined with the one above it…,20806973,2012-12-02 17:26:42
590180,5101,2287174,30,no semicolons,20806973,2012-12-02 17:26:57
590180,5101,2287175,40,no semicolons,20806973,2012-12-02 17:27:08
590180,5101,2287176,31,space after comma,20806973,2012-12-02 17:27:17
590180,5101,2287177,29,space after =,20806973,2012-12-02 17:27:31
590180,5101,2287178,21,tooltipID,20806973,2012-12-02 17:29:19
590185,5101,2287181,4,space after =,20807791,2012-12-02 17:30:17
590185,5101,2287179,4,space after comma,20807791,2012-12-02 17:30:12
590228,5101,2287190,6,"hm, this seems like it will fire two events – does it?",20810511,2012-12-02 17:48:07
590228,56488,2287193,6,It will be listening to both events - but it's the only way I could see to match native behavior. E.g. As you click and you let go on another item it registers a click. And also work as it currently does on mobile (if I listened for touchstart or somethin,20810511,2012-12-02 17:51:20
590228,56488,2287197,6,"Sorry, this commit isn't the latest by the looks. Let my just apply my changes.",20810511,2012-12-02 17:59:28
590244,5101,2287195,39,why change this from regex,20811139,2012-12-02 17:55:53
590244,5101,2287196,26,why move this out isActive,20811139,2012-12-02 17:56:37
590244,56488,2287200,26,It was a few months ago since I made most of these changes - but I believe it for mainly for accessibility. Currently when hitting [esc] it doesn't focus back to the element (I think it was for that).,20811139,2012-12-02 18:08:57
590244,56488,2287203,39,"No reason in particular - I think it was because I was looking through the typahead source and matched the functionality there (or perhaps another file). Either should be fine.

E.g. https://github.com/twitter/bootstrap/blob/master/js/bootstrap-typeahea",20811139,2012-12-02 18:11:07
590244,5101,2354862,39,"alright, change this back to the regex style, it looks nicer",20811139,2012-12-08 06:01:30
590244,5101,2354865,5,remove the double quotes,20811139,2012-12-08 06:01:43
590244,5101,2354870,10,remove touchstart,20811139,2012-12-08 06:02:11
590244,5101,2354872,11,remove touchstart,20811139,2012-12-08 06:02:31
590244,5101,2354876,20,v sus - i don't think we want to associate objects with dom nodes,20811139,2012-12-08 06:03:17
590244,5101,2354887,49,"use hasclass, it's faster",20811139,2012-12-08 06:04:22
590244,5101,2354919,11,"i believe document is wrong here.

If you click on a link in a dropdown menu it will close now as it is bound at the same level as the data-api",20811139,2012-12-08 06:09:09
590244,5101,2354961,26,ok that makes sense,20811139,2012-12-08 06:13:15
590244,5101,2355043,49,"there should be a better way of doing this. as is, im not comfortable with having this code in bootstrap – even if it means not supporting flyout menus.",20811139,2012-12-08 06:22:21
590244,5101,2355093,62,"should just do this as an object literal:

```js
keymap = { up: 38, … }
```",20811139,2012-12-08 06:28:09
590244,5101,2355131,100,"this should be at the top and returned early…

so for example:

```js
if (!e.which === keyMap.left && !e.which === keyMap.right) return $items.eq(index).focus()
```",20811139,2012-12-08 06:32:11
622592,5101,2287159,34,we don't do _private methods in bootstrap,21964400,2012-12-02 17:15:24
622592,5101,2287160,35,"if making a pull request, please try to follow the code style. thanks!",21964400,2012-12-02 17:15:41
632983,757,1237058,4,wassup,21997137,2012-07-25 22:33:20
633001,5572,1268540,15,invoking,6865640,2012-07-31 03:23:19
633001,5572,1268543,15,invoking,6865640,2012-07-31 03:23:42
633001,5572,1268551,27,should can?,6865640,2012-07-31 03:24:39
633173,5101,2475156,9,"we manually hoist all our vars to the top of the functions in bootstrap – just a weird style thing… also, shouldn't you have just needed the first line above",22062112,2012-12-20 15:52:48
633840,5101,2494258,38,could use change this to single quotes - thanks!,22066657,2012-12-22 08:35:14
633848,5101,2475395,6,"change this line to:

```js
var self = e ? $(e.currentTarget)[this.type](this._options).data(this.type) : this
```",22066670,2012-12-20 16:21:57
748249,5101,2495357,4,please follow our code style,23548036,2012-12-23 03:35:11
772644,539394,2520905,38,"We'll need access to `reset` inside of `Affix.pin` and `Affix.unpin` but it's not unique to each instance, so a var up here is fine.",24322966,2012-12-30 12:35:54
772644,539394,2520910,96,We pull this functionality out into `Affix.pin` and `Affix.unpin` methods to allow for triggering.,24322966,2012-12-30 12:45:30
772644,539394,2520911,67,I renamed `this.unpin` to `this.unpinned` to avoid collision with the new method of the same name.,24322966,2012-12-30 12:48:19
778496,81423,2821522,117,Missing a comma between these two.,26765456,2013-01-30 12:03:31
779284,930082,2559643,407,"Issue #6466, if `.modal-backdrop` exists, take first one to use, otherwise, instantiate.",24922958,2013-01-06 14:46:33
819554,5101,2938652,42,don't need this – disabled property doesn't fire events,25868153,2013-02-08 12:57:53
819554,5101,2938663,63,don't need,25868153,2013-02-08 12:58:39
819554,5101,2938670,71,"call toggle here directly, not a click event",25868153,2013-02-08 12:59:22
819554,5101,2938678,69,confused a bit here… but shouldn't e.keyCode and e.which be the same?,25868153,2013-02-08 12:59:51
819554,122183,2941977,42,"Indeed. 
(Poorly executed) TDD misguided my judgement. 
Commit incoming.",25868153,2013-02-08 19:48:57
819554,122183,2942359,69,"the whole `keydown` block it's a botched attempt at being smart when using a keyboard...

On second thought, I'd go for an extremely light first version:

```javascript
[...]
keydown: function (e) {
      $(this).toggle
}
[...]
```

This shoul",25868153,2013-02-08 20:26:41
819554,5101,4084469,51,assuming you don't want me to review this…,39462116,2013-05-04 10:45:50
839317,377188,2752662,5,you gotta remove the whitespace here to be able to pass travis. since theres nothing on the line just make it go to the start of the line,26207965,2013-01-24 08:48:59
902765,5101,2495560,25,just set the e here,24656290,2012-12-23 13:01:43
902765,5101,2495561,4,and here,24656290,2012-12-23 13:01:49
902873,5101,2499097,6,"just make this a ternary:

```js
this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)
```",24656295,2012-12-25 03:53:19
902873,377188,2499273,6,"I added the .length there to make sure it got inserted in case the element wasnt on the page, and if not then it would still get the default `insertAfter()`  otherwise it wouldnt show up if the container wasnt there

I'll make your change as you suggest",24656295,2012-12-25 06:05:25
902873,5101,2499354,6,"yeah i understood what it was doing, but it's too ""magical""… better to fail if the intended container is missing",24656295,2012-12-25 06:44:14
902873,5101,2499356,9,i actually disagree with this. Tooltip will break if inserted in the body triggered on a modal because of z-index issues. Just remove this line.,24656301,2012-12-25 06:45:03
902873,5101,2499358,10,change this example to 'body',24656301,2012-12-25 06:45:32
902873,5101,2499359,6,`string | false`,24656301,2012-12-25 06:45:45
902873,5101,2499360,7,default false,24656301,2012-12-25 06:45:53
902873,5101,2499361,14,default `false`,24656301,2012-12-25 06:46:06
928436,377188,2786176,22,we have to follow the coding standards in bootstrap which includes no semi-colons - [Contributing guidelines](https://github.com/twitter/bootstrap/blob/master/CONTRIBUTING.md#pull-requests),27243927,2013-01-27 13:56:38
944267,81423,2848304,6,"I don't think you need this one—the anchor should wrap the block level elements within just fine. I know semantically you might not want block level elements in inline ones, but it's unnecessary here. Any thoughts behind adding it?",26899631,2013-02-01 01:43:55
944267,45717,2848408,6,"You're right. I only did it because, like you said, I didn't want a block level element in an inline one. I'll remove it from the request.",26899631,2013-02-01 01:48:54
957873,15716,2906393,9,"Since you've already used the unit function (introduced in 1.3.3) you could use that here too... `@px-fallback: unit(round(@size * 10), px);` that way you could instead pass rem unit variables to this font size function instead of passing unitless variabl",28330033,2013-02-06 15:15:46
957873,33442,2975752,9,"Hey, thanks for the suggestion. I thought about including `rem` in the unit but decided against it. The mixin's name already says ""rem-fall-back"", so I thought it's not necessary. I'm not chained to this decision, so I'm open for the discussion :)",28330033,2013-02-12 17:10:09
977172,5101,2937819,18,remove this – not necessary,29077434,2013-02-08 10:02:13
977172,5101,2937822,53,we only accept option objects in our apis,29077434,2013-02-08 10:03:27
977175,5101,2937843,83,opacity mixin son,29077457,2013-02-08 10:07:35
977175,5101,2937867,7,var $body = $(document.body),29077457,2013-02-08 10:11:29
977175,81423,2937948,83,"sheeeit, fixed.",29077457,2013-02-08 10:31:36
1129242,24857,2979960,14,you forgot a trailing `'` there :trollface:,29474995,2013-02-12 23:01:52
1311756,1807842,3746819,4,What if focus failed?,37633584,2013-04-11 08:15:36
1319394,81423,3836778,42,Should this use the `@pagination-bg` var?,37688169,2013-04-17 21:47:16
1319394,1003334,3837956,42,"Well since the hover and focus have different background on line 25 therefore we cant delete background-color property for .disabled because there would be other background for disabled:hover & focus and this makes no sense. 

I think you're right - on ",37688169,2013-04-17 22:46:43
1326889,81423,3920008,24,"Comment is inaccurate—we're adding the hover effects :). `// Add hover effects, but only for links` should work.",37741426,2013-04-23 21:48:22
1326889,81423,3920021,25,"Use either or, not both. I'd stick with `[href]` I think since we're doing that elsewhere in the framework.",37741426,2013-04-23 21:49:03
1326889,81423,3920051,50,Use a more accurate comment like `// Contextual variations (linked labels get darker on :hover`.,37741426,2013-04-23 21:51:14
1326889,81423,3920063,53,All of these should actually have `:hover` attached to them. The idea is that linked labels get darker on hover for that clickable affordance. Huge my bad on not including those already.,37741426,2013-04-23 21:51:40
1326889,1003334,3934598,24,Oh my bad! :),37741426,2013-04-24 16:12:54
1326889,1003334,3935010,53,I'll add the <code>:focus</code> also - folks using the tab button will be happy.,37741426,2013-04-24 16:49:18
1327795,7261,3931726,8,Why was this changed to not use a variable?,37747255,2013-04-24 12:24:35
1327795,1191659,3932150,8,"From http://www.w3.org/TR/CSS21/visudet.html#propdef-line-height
> The used value of the property is this number multiplied by the element's font size.

Thus the `line-height` property will correspond to `font-size` value.",37747255,2013-04-24 13:00:13
1434524,81423,4830071,217,"We can nuke this—Jekyll now builds our docs for us, so none of this copy-pasta stuff needs to happen. Yay!",46792191,2013-06-22 07:09:26
1434524,742728,4830809,217,"Good point. I'll remove that, and it's related parts.",46792191,2013-06-22 16:47:14
1434524,21147,4830976,219,Should be `compress:gh`,46792191,2013-06-22 18:48:53
1501821,5101,4350492,10,this doesn't close now if refresh is true,42380540,2013-05-23 03:21:58
1520235,7261,4394864,45,"Unless my eyes are failing me, this condition is exactly the same as that of the previous `else if`, which means that the next line is dead code.",43001944,2013-05-26 23:26:55
1520235,7261,4394865,57,Same problem here.,43001944,2013-05-26 23:28:14
1543992,340305,4516418,11,Sorry. I looked at composer/installer again. It's will throw exception if type isn't supported. Thank.,43812529,2013-06-04 11:26:15
1543992,12192,4491800,11,"Their is no css-type in composer-installers:
https://github.com/composer/installers/blob/master/README.md (Scroll down to `Current Supported Package Types` )

Base-types for reference: http://getcomposer.org/doc/04-schema.md#type",43812529,2013-06-02 21:30:20
1572223,5101,5361452,7,this makes no sense to me,44816272,2013-07-24 05:58:02
1607567,534735,4757577,6,"I used `ceil()` instead of `floor()` because it renders correct in Chrome, Firefox, Safari and Opera. `floor()` makes the `input` appear larger than the addon in some browsers",46225899,2013-06-19 00:47:11
1607567,81423,4758440,6,"Do we want `@line-height-large-computed` and `@line-height-small-computed`, or is this value here just fine?",46225899,2013-06-19 01:20:34
1607567,81423,4758443,6,Overall though I like this change :).,46225899,2013-06-19 01:20:45
1607567,534735,4759135,6,"I thought about this and actually they could be used to compute different margins, paddings and line-heights for larger/smaller font-sizes (instead of `@line-height-computed` that is used everywhere atm. But as I haven't found any issues there I thought n",46225899,2013-06-19 01:50:10
1622254,26331,4790390,5,`.data('content')`,46480223,2013-06-20 11:27:21
1622254,146193,4790632,5,err...my fault. ,46480223,2013-06-20 11:48:42
1627597,81423,5429563,14,Only need `border-radius` FYI.,46640834,2013-07-26 23:34:28
1627597,81423,5429532,5,I imagine you don't need this if we redo the structure of this.,46640834,2013-07-26 23:33:25
1648200,81423,4874758,7,Perhaps we can add a link to the mailing list to encourage folks to head there?,47169159,2013-06-26 00:10:56
1648200,81423,4874782,7,"I wonder if we need to be even more specific and say that it requires Recess, which compiles using LESS.js, but with it's own property order, formatting, and what not? Open to ideas here to make this super clear and not overly verbose.",47169159,2013-06-26 00:11:54
1648200,7261,4875660,7,"Perhaps ""not support"" => ""not officially support""? I'm just nitpicking.",47170397,2013-06-26 00:49:22
1648200,7261,4875705,6,Please add an `id` so that we can link people directly to this (e.g. from issues people file).,47170397,2013-06-26 00:51:08
1648200,7261,4875716,6,Please add an `id` so that we can link people directly to this (e.g. from issues people file).,47170397,2013-06-26 00:51:28
1648200,7261,4875883,7,"Does it really absolutely require Recess? I seem to recall hearing people successfully using just `less.js` on its own.
Anyway, regardless, mandating Recess specifically would be a totally reasonable option.",47169159,2013-06-26 00:59:22
1648200,1544623,4876325,7,"I personally have never used anything but WinLESS, which is a wrapper for pure `less.js`, so that definitely works in praxis.
How about this:

If you download the original files, you need to compile Bootstrap's LESS files into usable CSS. To do that, B",47169159,2013-06-26 01:14:11
1649513,81423,5227443,14,"Remove extra space before closing parens, and rename `@max` to `@max-width` for consistency with the actual property.",47207726,2013-07-17 01:41:56
1664861,1544623,4954179,14,"That should be ""badge-aNchor-color"" (but maybe even ""badge-link-color"").",47507205,2013-06-30 19:42:32
1664861,1544623,4954181,10,Typo: breadcrumb,47507205,2013-06-30 19:43:04
1664861,7261,4956905,1,"IMO, making Normalize customizable seems contrary to the whole point of Normalize.",47507205,2013-07-01 11:50:13
1664861,82520,4959990,14,"Thanks, Will fix this.",47507205,2013-07-01 16:35:10
1664861,82520,4959993,10,"Thanks again, will fix this as well.",47507205,2013-07-01 16:35:28
1664861,82520,4960028,1,"Hmmmmmm yeah I agree, but I believe the colors provided in normalize.less are based on default bootstrap color scheme (grey colors) so if we modify the colors (which we ultimately will and do), so may be normalize.less colors also should be changed???",47507205,2013-07-01 16:37:46
1664861,7261,4969077,20,"I would suggest grouping these color variables with the sections for their respective components, rather than grouping them by what their values are.",47531189,2013-07-01 23:50:37
1664861,82520,4978796,20,"I think its better if we keep color variables in single group instead of spanning them into components grouping, also I would like to see these color variables being converted to sections like

Primary Colors (the colors which will affect the main look ",47531189,2013-07-02 12:01:53
1664861,81423,5227043,14,"Remove extra spaces here, and instead use `@accordion-group-border-color`.",47531189,2013-07-17 01:28:52
1664861,81423,5227071,14,Use `@badge-link-hover-color` to match patterns.,47531189,2013-07-17 01:29:38
1704541,5101,5364455,13,con?,48076509,2013-07-24 11:11:27
1704541,5101,5364460,13,$parent is a better name,48076509,2013-07-24 11:11:40
1705965,7261,5055818,16,To save other people the trouble of looking them up in the Unicode tables: these are left and right guillemets (i.e. « & »),48085344,2013-07-08 03:53:26
1714329,7261,5056788,7,Overridden for `pre` on old line 20,48139893,2013-07-08 08:10:25
1714329,7261,5056800,4,Overridden for both `code` and `pre` in their respective specific sections,48139893,2013-07-08 08:12:07
1714329,7261,5056806,6,Overridden for both `code` and `pre` in their respective specific sections,48139893,2013-07-08 08:12:37
1714329,7261,5056815,8,Overridden for `pre` on old line 37.,48139893,2013-07-08 08:14:08
1743489,7261,5102872,1,This file seems unnecessary.,48243828,2013-07-10 02:45:06
1743489,476306,5105384,5,"This should be added here
```sass
@right: right;
@left:  left;
@dir:   ltr;
```
and in the `rtl.less` file
```sass
@right: right;
@left:  left;
@dir:   ltr;
```

Then compile
`bootstrap.less` => `bootstrap.css`
`rtl.less` => `bootstrap.rtl.",48243828,2013-07-10 04:52:10
1743489,476306,5105399,19,Here using of `@right` or `@left` variables ,48243828,2013-07-10 04:53:06
1743489,7261,5102885,5,These should probably just go in `variables.less`,48243828,2013-07-10 02:45:33
1778084,81423,5223483,4,"You can nest and chain these:

```css
.thumbnail {
  > img,
  > video {
    ...
  }
}

That said, I don't know that we want to perpetuate tags here. We should realistically be using classes without these specific selectors to better support diff",49374107,2013-07-16 23:21:12
1778084,443481,5229975,4,"Ah, I can see your point. Using explicit tags might reduce flexibility. Maybe I can come up with a more flexible approach. I will withdraw this pull-request for now.

Thanks for your feedback :-)",49374107,2013-07-17 03:12:41
1802817,82520,5298774,5,"I was thinking if its ""background"" then I will use @bg else if it specifies ""background-color"" then should use @bg-color???? What you say?",50592420,2013-07-19 23:02:22
1802817,82520,5298784,10,Will do.,50592420,2013-07-19 23:02:51
1802817,81423,5297369,10,We can do the entire `text-shadow` here I think: `text-shadow: @breadcrumb-text-shadow`. ,50592420,2013-07-19 22:03:25
1802817,81423,5297394,9,Let's not do this just yet—the abstraction or naming scheme isn't very meaningful.,50592420,2013-07-19 22:04:37
1802817,81423,5297330,23,Change to `@badge-active-bg`.,50592420,2013-07-19 22:01:57
1802817,81423,5297341,5,Let's shorten these up—change to `@accordion-border-color`.,50592420,2013-07-19 22:02:22
1802817,81423,5297348,5,"Following our convention for background colors, use `@breadcrumb-bg`.",50592420,2013-07-19 22:02:43
1802817,82520,5298831,9,"I was thinking to move this once I move all colors to variables and then should follow some pattern to name the colors (like you did for brand-primary, etc). But will remove it for now to save time.",50592420,2013-07-19 23:04:29
1802817,82520,5298841,19,okay.,50592420,2013-07-19 23:04:59
1802817,81423,5297429,19,"Lastly, clean up the spacing between all the above properties—each variable should be grouped with it's fellow component variables.

For example:

```css
@badge-color
@badge-link-hover-color

@breadcrumb-text-shadow
@breadcrumb-bg
```",50592420,2013-07-19 22:06:01
1802817,82520,5298746,5,Ok.,50592420,2013-07-19 23:01:10
1824236,2103599,5366358,4,display: table-cell works well when parent's display is set to table,51647075,2013-07-24 13:48:29
1825646,1544623,5383115,4,"Whoops, sorry, I totally missed that.",51682093,2013-07-25 01:30:06
1825646,82520,5378790,4,"I followed the siblings pattern for Modals section, they had .col-lg-4 used so I used it because of that. Let see what @mdo have to say about that. Thanks for pointing it out though.",51682093,2013-07-24 23:02:06
1825646,1544623,5375472,4,"As of now, variable fields are organized in `.col-lg-6` columns. Would probably be best if you could stay with that. Not for me to decide though.",51682093,2013-07-24 20:55:55
1838150,5101,5417420,16,o_O,52017236,2013-07-26 12:34:21
1838150,5101,5417418,1,need to add this logic back,52017236,2013-07-26 12:34:11
1838150,5101,5417428,213,tooltip needs to be before popover,52017236,2013-07-26 12:35:07
1838150,7261,5417549,1,"Yeah, like I said, we're gonna need some help on that one.",52017236,2013-07-26 12:42:51
1838150,5101,5417423,10,where did transitions go O_o?,52017236,2013-07-26 12:34:44
1838150,7261,5417735,16,"Just an illusion of the reordering. Some of the JS files in the vanilla 3.0.0-wip branch have outdated years (including, in particular, `affix.js`)",52017236,2013-07-26 12:58:44
1838150,7261,5417709,10,"Still there, just moved to line 1893 apparently.",52017236,2013-07-26 12:57:04
1838150,7261,5417761,213,Good catch. Shouldn't be using wildcards in the `concat` task since the ordering matters.,52017236,2013-07-26 13:00:43
1838150,5101,5417664,1,"ah sorry missed that, got it",52017236,2013-07-26 12:53:25
12319,44017,1052398,113,"This, along with newSymbol, feels like it might be useful in more places than Matrix. Should it be pulled into RichPipe?",465183,2012-06-26 21:15:51
12319,44017,1052445,133,"Same comment as above: this feels useful for all joins, not just matrix joins. Pull it out into a separate file?",465183,2012-06-26 21:20:42
12319,44017,1052474,45,I love these examples. So awesome.,465183,2012-06-26 21:24:11
12319,7111,1053562,664,"This is actually a bug... We are not using the Ordering in the case where we push to reducers.

We can do this by setting the comparator in the sorting fields.  See TypedPipe.scala for an example of how to fix it.",465183,2012-06-26 23:25:47
12319,7111,1053580,23,Remove this commented out line.,465183,2012-06-26 23:26:56
12319,7111,1053604,66,"We need to renable this.  I think we disabled it when joinWithTiny was broken due to cascading HashJoin was broken.  Since it (mostly) works now, I think it should be turned back on, otherwise we won't ever get bug reports.",465183,2012-06-26 23:29:00
12319,7111,1053607,78,Same here.  Go back to joinWithTiny and remove TODO.,465183,2012-06-26 23:29:14
12319,7111,1053625,96,"Even though it is a bit dangerous, I would make this a var, so we can change it in a job until we figure out a better what to set this.  If it is a var, we can control it on a per-job basis (at the start of the job).",465183,2012-06-26 23:30:27
12319,7111,1079108,133,Agree.  This can be moved to FieldsConversions.,465183,2012-06-30 02:29:01
12319,8579,1082316,583,I think this needs to be serializable.,465183,2012-07-02 07:34:24
12319,7111,1290218,48,please change this to MatrixPipeExtensions because PipeExtensions is too generic of a name,465225,2012-08-02 10:25:08
12319,7111,1079106,113,"Yes.  I agree.  Let's put it in FieldsConversions, then you can use it with import Dsl.ensureUniqueFields.",465183,2012-06-30 02:28:41
13616,7111,1334820,24,Does it make sense to add classOf[Writable] here? Will this scheme actually work if cascading doesn't know exactly what class it should return?,2625860,2012-08-08 22:47:55
13616,7111,1334891,41,"I think we should take type parameters here:

```
case class WritableSequenceFile[K <: Writable : Manifest, V <: Writable : Manifest](p : String, f : Fields) extends FixedPathSource(p) with Mappable[(K,V)] {
  override val fields = f
  override val keyTyp",2625860,2012-08-08 22:51:58
13616,44014,1335741,24,"This scheme works, don't know if it's absolutely necessary. My Scala skills are still 'under construction', so it might be superfluous to have it here.",2625860,2012-08-09 00:10:32
34047,7111,778463,26,"Could you add some code to do something like:

--JobOne:outdir j1out --JobTwo:outdir j2out

So, any args prefixed with ""<jobname>:"" would only be passed (with the jobname removed) to one of the particular jobs?  This is useful because there could be c",3946217,2012-05-05 21:30:15
34047,7111,778468,28,"couldn't we instead do:

val jobList  = args.list(""jobs"").map { jobname => Job(jobname, argsFor(jobname, args)) }

Then I think you can make jobList immutable and public, and you can also remove the other methods below.  What do you think?",3946217,2012-05-05 21:32:40
34047,7111,778472,24,"I think we could do this instead with a CascadeJob companion object so you don't need to make CascadeJob mutable.

So:

object CascadeJob {
  apply( jobs : (String, Args)*)
}

Then: CascadeJob((""job1"", Args(""--test1"")), (""job2"", Args(""--test2"")))",3946217,2012-05-05 21:38:55
34047,7111,778474,11,"It would be nice, as you mentioned, to actually run a test job (one that we already have, for instance).

You are right, you will need to change this line:

https://github.com/twitter/scalding/blob/master/src/main/scala/com/twitter/scalding/JobTest.sc",3946217,2012-05-05 21:43:52
34047,18018,778576,26,"The Args class does not expose its internal hash. So I can either subclass Args and have a CascadeJobArgs, or I can modify the Args class to expose it internal map. Or, I could add an argsFor(prefix : String) method to Args that uses the above logic, basi",3946217,2012-05-06 00:08:00
52199,7053,1076977,29,I'm not a very big fan of doing this import here. Why not just call ```CascadingUtils.kryoFor``` when you need this?,185393,2012-06-29 21:32:06
52199,7053,1076995,4,"Since this is a fix dealing with mutable init value, do you want to add a test that it is fixed now?",185393,2012-06-29 21:33:35
52199,7053,1077055,39,"Why do you need to do the deep copy both here and in line 236? I thought that doing it just here would be enough, right?",185393,2012-06-29 21:43:26
52199,7111,1078945,39,One is for foldLeft one is for BufferOp (which is used for scanLeft).,185393,2012-06-30 02:06:45
52199,7053,1078962,39,"Oh sorry, the github thing made me confused.",185393,2012-06-30 02:09:59
52341,44018,1079552,5,DriveShaft has been deprecated as of 2012.,185389,2012-06-30 03:47:49
55466,7053,1122832,5,"The style we try to follow is to group up to 6 imports together like this:

```scala
import com.twitter.maple.hbase.{HBaseScheme, HBaseTap}
```",4361690,2012-07-09 20:01:35
55466,141863,1122860,15,"body p { margin-bottom: 0cm; margin-top: 0pt; } 
    On 9/7/2012 18:00, Argyris Zymnis
      wrote:
    
      
        @@ -0,0 +1,54 @@
+package com.twitter.scalding
+
+import cascading.tap.Tap
+import cascading.tuple.Fields
+import com.twitter.maple.hba",4361690,2012-07-09 20:05:48
55466,7053,1122834,9,You can also group the imports here.,4361690,2012-07-09 20:01:55
55466,141863,1122867,5,"body p { margin-bottom: 0cm; margin-top: 0pt; } 
    On 9/7/2012 18:01, Argyris Zymnis
      wrote:
    
      
        @@ -0,0 +1,54 @@
+package com.twitter.scalding
+
+import cascading.tap.Tap
+import cascading.tuple.Fields
+import com.twitter.maple.hba",4361690,2012-07-09 20:06:43
55466,7053,1122870,18,"I'm actually not a fan of these implicits. They are dealing with basic primitives like ```String```, ```Long```, ```Array[Byte]``` and could lead to really subtle bugs later on.

I think that the right way to deal with this is to override ```transformForR",4361690,2012-07-09 20:06:57
55466,141863,1130415,18,"a) Doesn't adding an array of types break the ```transformForRead```signature defined in ```Source```  ?

b) I do get your point that those conversions have unforeseeable side effects, but:
b.1) Why not use the mechanism offered by 
```def map[A,T](fs : (",4361690,2012-07-10 16:44:05
55466,141863,1130731,18,... Or maybe use ```cascading.tuple.Tuples#coerce``` seems cool ... what do you think ?,4361690,2012-07-10 17:38:52
55466,7053,1133823,18,Yeah not entirely sure how to proceed here. Let me think about it some more and I'll get back to you.,4361690,2012-07-10 23:28:53
55466,141863,1199496,18,"I have been playing around with Scalding to try solve this out, and the more I delved into the code the more I understood your initial rejection towards the 2 implicits I have written. I got to the conclusion that the only place I could deserialize the HB",4361690,2012-07-19 23:11:43
55466,7053,1122823,15,Presumably you would never use ```HBaseSchemeSource``` outside of ```HBaseSource``` so why not merge them into a single class? That means that you would not need the class ```HBaseTable``` anymore,4361690,2012-07-09 20:00:36
55466,141863,1187113,18,"body p { margin-bottom: 0cm; margin-top: 0pt; } 
    On 10/7/2012 21:28, Argyris Zymnis
      wrote:
    
      
        @@ -135,4 +136,12 @@ trait FieldConversions extends LowPriorityFieldConversions {
     val f2 = uf(pair._2)
     (f1, f2)
   }
+  
+  ",4361690,2012-07-18 17:36:11
63467,7111,1211038,7,"if (left.isEmpty) {
 right
}
else if (right.isEmpty) {
  left
}
else {
  // Both are not empty:
  Some(monoid.plus(left.get, right.get))
}",4428746,2012-07-21 23:28:38
63467,7111,1211041,4,"Inside object Monoid put:

implicit def optionMonoid(implicit mt : Monoid[T]) = new OptionMonoid[T](mt)

and then this will get picked up automatically with:

implicitly[Monoid[Option[T]]]

or inside the ones for tuples.",4428746,2012-07-21 23:31:18
64221,7053,1219735,14,Weird indentation.,185223,2012-07-24 02:14:36
127702,44017,1409629,60,"Always using a toString here seems a bit wasteful... I should benchmark this, but it feels like an optimized version for a single Long field might be worthwhile.",5602432,2012-08-19 09:18:57
127702,7111,1409637,60,"Sure. It would be good to see if toString.getBytes is significantly slower than the approach of serializing the long into a byte array.

If it is, I'm all for adding a better approach.

",5602432,2012-08-19 09:25:03
127702,7111,1409653,60,"```scala
> def time(reps : Int) = {
     |   val start = System.currentTimeMillis
     |   (0 until reps).foreach  { long2Bytes(_) }
     |   println((System.currentTimeMillis - start)/(reps.toDouble))
     |   val start2 = System.currentTimeMillis
     |",5602432,2012-08-19 09:35:15
172113,7111,1418603,22,"A few things:

1) It appears this only works for TupleEntries of primitives. Is this right? Or rather, it just calls .toString on each item. Can we get a comment to this effect?

2) This is not reversible. Do you want to add transformForRead that creates ",6257394,2012-08-21 01:58:11
190566,7053,1426758,45,"I think that you are missing ```"":"" + CLASSPATH``` at the end of this line.",6494061,2012-08-21 22:11:46
190566,271470,1426980,45,"Yes, I don't know where it goes. ",6494061,2012-08-21 22:29:26
190566,271470,1427028,45,"I have the same error in my code, probably before the commit I did some changes and then I checked only local_cmd. I didn't test build_job_jar and so I couldn't find the error. I confirm that after + there is "":"" + CLASSPATH.",6494061,2012-08-21 22:33:30
190566,271470,1427207,45,Fixed,6494061,2012-08-21 22:48:06
281727,7053,560738,36,"I think it would be cleaner to do:

FileSystem.get(config).exists(filePath)",7829758,2012-03-15 05:29:22
281727,89543,560785,36,good idea...done.,7829758,2012-03-15 05:38:39
284350,7053,578528,49,"Yeah ok, on first read I thought that you are dropping all the fields in the right side. Can you add a couple more tests maybe? At least one where you have say ('x, 'y) on the left and then ('x, 'z) on the right and you end up with ('x, 'y, 'z)?",7893553,2012-03-20 12:51:38
284350,7053,577599,10,"Maybe make this a method of the RichPipe class instead of the object? That way we could do:

p.setReducers(r)

Instead of:

RichPipe.setReducers(p, r)",7893553,2012-03-20 05:38:35
284350,7053,577611,49,"Should we explicitly mention in the comments that if you are doing an innerJoin and there is at least one common field name in the join, then all right side fields will be dropped?",7893553,2012-03-20 05:42:07
284350,7111,578374,10,"The reason I did it this way was so that I could explicitly call it in some code that is doing a ""star-join"" which we don't have a good handle on yet in scalding.

I think having this as a static function is useful (for instance, Yifan will likely use it ",7893553,2012-03-20 11:14:52
284350,7111,578376,49,"This should only drop those in common, not all of them.  Note how it computes the intersection.

I thought the comment was clear.  Do you think not?  Also, previously, this was a bug, so this will not effect any running code (unless I wrote something inco",7893553,2012-03-20 11:15:47
284350,7111,578388,10,"Also, we need to call it in GroupBuilder, which doesn't have the RichPipe implicits.  We could put them in there, but despite my admiration for the power of implicits, I also like to constrain them to where they are essential for usability.",7893553,2012-03-20 11:24:51
284350,7111,578409,49,Actually... Don't pull yet.  I forgot to handle the joinWithTiny case as well.  That needs the same treatment.,7893553,2012-03-20 11:43:29
284350,7053,578523,10,"Alright not a big deal, lets leave it as a static.",7893553,2012-03-20 12:48:16
285470,7053,586437,21,"Also, could you add documentation for pivot/unpivot to Codesnippets.md?",7912311,2012-03-21 23:24:23
285470,7053,586413,21,"Missing a ' on the toField symbol.

Also I find this explanation confusing. Non-nulls are Options and nulls are None, right?",7912311,2012-03-21 23:21:57
285470,7053,586458,4,Can you add an example call in the documentation? Also add to Codesnippets.md,7912311,2012-03-21 23:27:03
285470,7111,594792,21,"I'm adding snippets to Codesnippets, but the above hint I am going to leave as it is.

Comments are not the place for a long discussion on complex usage examples.  I simply wrote enough for the person that wanted to see that this pivot is safe even if som",7912311,2012-03-23 10:50:21
288315,7111,601312,155,"Same issue as above: suppose you had a Tap that can produce a set of lines of text, and you want to automatically break them.  That's how cascading works now.  It just so happens that 95% of the time, you use Hfs.",7973435,2012-03-26 03:13:03
288315,7053,601229,16,"Is this preferable to using an Enumeration?

```scala
object AccessMode extends Enumeration {
  val READ, WRITE = Value
}
```",7973435,2012-03-26 01:05:28
288315,7053,601235,17,Streams are awesome!,7973435,2012-03-26 01:08:46
288315,7111,601265,16,"For this case, object just felt right, but here's a stack overflow on the subject (that also tends towards case object):

http://stackoverflow.com/questions/1898932/case-classes-vs-enumerations-in-scala",7973435,2012-03-26 02:10:04
288315,7053,601301,16,"Yeah feels 6 one way, half a dozen another. Case objects are fine.",7973435,2012-03-26 02:59:06
288315,7053,601303,135,Delete this.,7973435,2012-03-26 03:05:20
288315,7053,601307,144,Why is this extending Mappable? Would we ever use it for a non-FileSource?,7973435,2012-03-26 03:09:27
288315,7053,601308,155,"Again, maybe this should extend FileSource?",7973435,2012-03-26 03:09:45
288315,7053,601309,168,Same as above.,7973435,2012-03-26 03:09:58
288315,7053,601310,144,Actually I thought about it some more. This is more general than files so this is good as is.,7973435,2012-03-26 03:10:57
288315,7111,601311,144,"Well, it was always Mappable so you could just operate on the string in each line.  You can easily imagine a non-file based TestLineScheme.  For instance, it could be an in-memory list of strings.  Taps abstract the storage mechanism, schemes abstract the",7973435,2012-03-26 03:12:18
288315,7111,601313,168,"Again, I think you want this potentially in Source.  Suppose you want to store Cascading serialized (sequence-files) in Redis for instance.",7973435,2012-03-26 03:14:12
288546,7053,601986,5,"This might be a bit pedantic, but you could you also add a test for the implicit, i.e., call join on the list directly?",7980754,2012-03-26 13:07:04
294226,7053,652140,14,What does arity of -1 mean? I don't know?,8145300,2012-04-06 00:24:35
294226,7111,652360,14,"Means we don't know the arity, so it cannot be checked at flow build time.",8145300,2012-04-06 01:04:46
294313,7111,652883,13,"Need a comment that this should be called on the larger of the two pipes.  Also mention that this is useful mostly for star-join situations or cases where you need aggregation after the cogroup, otherwise joinWithSmaller/joinWithTiny should be preferred (",8148442,2012-04-06 02:39:53
294313,7111,653146,40,"What if coGroups is empty?  CoGroup doesn't make a lot of sense.  I think we should:

assert(!coGroups.isEmpty, ""coGroupBy requires at least one other pipe to .coGroup"")",8148434,2012-04-06 03:54:08
294313,7111,653170,41,Shouldn't RichPipe.assignName(pipe) be put here instead of joinWithSmaller?,8148434,2012-04-06 03:59:32
294313,7111,653178,47,I think the assignName needs to be moved inside CoGroupBuilder.  We want .coGroupBy to work for people that don't think about pipe names.,8148434,2012-04-06 04:00:22
294313,7111,653182,63,Move assignName to inside CoGroupBuilder.schedule,8148434,2012-04-06 04:00:42
294313,7111,653190,44,Add a TODO to move here the automatic renaming of fields in inner joins and drop the duplicated fields as we do in joinWithSmaller/Tiny now.,8148434,2012-04-06 04:02:20
297193,44018,684100,13,"Wow, really beautiful.",8230095,2012-04-14 02:11:02
297193,7111,684122,13,Nice.,8230095,2012-04-14 02:15:19
318481,7053,889434,22,Maybe rename sh to showHeaders and wh to writeHeaders?,8914114,2012-05-29 00:01:46
318481,141863,889606,22,"body p { margin-bottom: 0cm; margin-top: 0pt; } 
    On 28/5/2012 22:01, Argyris Zymnis wrote:
    
      
        @@ -186,11 +189,13 @@ abstract class FixedPathSource(path : String*) extends FileSource {
 /**
 * Tab separated value source
 */
-case class",8914114,2012-05-29 01:12:24
321926,7053,941448,32,"I think that could make this an implicit. All the TPipe methods (map, flatMap, etc) have different signatures than the equivalent ones in Pipe and Mappable so we should be ok.",464975,2012-06-07 08:12:28
321926,7053,952093,50,"Add a comment/doc/simple example here. Nothing much, just a note to the unsuspecting code reader.",464971,2012-06-08 21:42:45
321926,7053,953149,69,"I was skeptical about this initially, but now I think that keeping all the maps/flatMaps/filters in one chained flatMapFn is a cleaner implementation. It's not just the optimization of only doing one Each. This is actually easier to read.",464971,2012-06-09 00:03:38
321926,7053,953173,97,"I would actually argue that doing

```
pipe.mapTo(fields -> ('key, 'value)) { t => (g(t), t)} (implicitly[TupleConverter[TupleEntry]], Tup2Setter) 
```

reads better here.",464971,2012-06-09 00:06:23
321926,7053,953195,118,I don't understand this comment.,464971,2012-06-09 00:08:32
321926,7053,953215,135,This sounds more generic than it really is. Is this not just for abstracting out a bunch of methods on Grouped and CoGrouped?,464971,2012-06-09 00:10:04
321926,7053,953310,145,Nice abstract algebra geekout.,464971,2012-06-09 00:21:46
321926,7053,953324,157,"Wait, why is there a type parameter here? Is is not max of Ts?",464971,2012-06-09 00:23:23
321926,7053,953330,163,Same comment as above.,464971,2012-06-09 00:23:55
321926,7053,953358,188,Do you need override identifiers for the abstract methods of KeyedList?,464971,2012-06-09 00:25:39
321926,7053,954766,88,I'm confused as to what the evidence stuff does here. Are you using it at all? Is it needed for the cast?,464971,2012-06-09 04:13:52
321926,7053,954767,89,So why does it matter if it is serializable or not?,464971,2012-06-09 04:14:11
321926,7053,954814,237,"Either ```bigJoiner```, ```smallJoiner```
or ```bigMode```, ```smallMode```",464971,2012-06-09 04:24:41
321926,7053,954821,247,Can we check this? Would Manifest magic help here?,464971,2012-06-09 04:26:03
321926,7053,954823,236,"So presumably this will break if I try to join a pipe of ```(Int, String)``` and ```(Long, String)```?",464971,2012-06-09 04:27:21
321926,7053,955046,60,How much would you object to calling this class TypedPipe instead?,464971,2012-06-09 05:48:57
321926,7053,955053,236,"Again add a comment explaining what this is, a use case, etc.",464971,2012-06-09 05:53:02
321926,7053,955062,278,Keep in mind that we have never tested calling GroupBuilder methods in a CoGroupBuilder. We need to add some tests in CoGroupBuilderTests to check that this works.,464971,2012-06-09 05:55:29
321926,7053,955072,9,Wow it feels like specs should be doing this already... It sucks that they don't.,464971,2012-06-09 06:01:55
321926,7053,955073,26,Don't need this.,464971,2012-06-09 06:02:40
321926,7053,955074,27,Same.,464971,2012-06-09 06:02:46
321926,7111,958043,157,Because we can actually use an implicit ordering on a superclass of T do to the contravariance of Ordering (follows the scala standard library API),464971,2012-06-11 12:00:07
321926,7111,958046,135,"I think it is exactly that general.  The point is, there are 4 (5 here, but I got smarter later and will make another pull request) fundamental operations on KeyedList.  These could be implemented in scala collections or whatever, but we are doing it for ",464971,2012-06-11 12:01:40
321926,7111,958048,118,"There is a new cascading (val pipe) that has run all the map/flatMaps/filter.  Since we have to run those to write out the result, let's capture the result so we don't recompute it.  We do this by taking the result pipe and returning the new TypedPipe wra",464971,2012-06-11 12:03:12
321926,7111,958049,69,Okay.  I'll leave it.,464971,2012-06-11 12:03:53
321926,7111,958051,50,Okay.,464971,2012-06-11 12:04:04
321926,7111,958065,97,"Okay, I'll revert.",464971,2012-06-11 12:10:26
321926,7111,958072,188,You don't need them.  We are not consistent about requiring them in code review.,464971,2012-06-11 12:12:05
321926,7111,958077,88,"If the type of T is not (K,V), then at compile time, this will fail.  It uses implicits to do a compile time check that one type is equivalent to another.  If T is not (K,V), we can't automatically group.  We cast because it is safe to do so, and we need ",464971,2012-06-11 12:14:57
321926,7111,958084,89,"we have to serialize the job in cascading, and objects that are not serializable that get swept up into functions will cause an exception at runtime.",464971,2012-06-11 12:16:51
321926,7111,958090,145,thank you sir!,464971,2012-06-11 12:19:25
321926,7111,958093,237,Will fix.,464971,2012-06-11 12:20:20
321926,7111,958100,247,"Having the CoGrouped2[K,...] also have a TupleGetter[K] in the constructor would help.  It means when we construct we need to pass down the getter for K, and then we resolve it at compile time at the location where K is know.

I think for now it is actual",464971,2012-06-11 12:22:18
321926,7111,958102,60,done.,464971,2012-06-11 12:22:26
321926,7111,958106,236,"Yes, to join int with long you would need to do:

pipe1.map { tup => (tup._1.toLong, tup._2) } join pipe2",464971,2012-06-11 12:24:30
321926,7111,958110,278,There are tests like that in the code here (see the case where we do .size after a join).,464971,2012-06-11 12:25:06
321926,7111,958111,9,no shit.  I got sick of doing this to see the real stack trace.,464971,2012-06-11 12:25:28
321926,7111,958112,26,fixed.,464971,2012-06-11 12:26:01
321926,7111,958113,27,fixed.,464971,2012-06-11 12:26:14
321926,7053,962698,88,Thanks for the explanation.,464971,2012-06-12 01:45:04
324745,7053,962648,52,I find this paragraph confusing. A simple example of what can go wrong here would be helpful.,185533,2012-06-12 01:38:10
324745,7053,962651,80,Again provide a concrete example of what can go wrong.,185533,2012-06-12 01:38:35
324745,7053,962671,65,"Maybe add a test that exercises the weird behavior of mapStream (with the misaligned fields, etc)?",185533,2012-06-12 01:41:40
324745,7111,964035,52,"there is no simple example.  I had to discover it with a unit test.  I don't think it is worth going into other than as I say, if you want the output aligned, include it in the scan function.

See the unit test and see if you can help me by explaining tha",185533,2012-06-12 04:53:31
324745,7111,964045,80,"What do you mean?  Can you be more precise?  What can go wrong is that you don't get map-side aggregation if you use this method, but often your ultimate logic could be implemented with reduce.",185533,2012-06-12 04:55:12
324745,7111,964074,65,This test does that because drop/scan are now implemented with mapStream.,185533,2012-06-12 04:59:20
324745,7053,964242,52,"Ok now that I looked at the test case case more carefully, I realized what you are talking about. This behavior really sucks, except its probably not going to affect most cases.

I was mostly confused as to what aligned means. I thought that by misaligned",185533,2012-06-12 05:41:00
324787,7053,1507414,6,"So since this is a var and not a constant anymore, maybe we should not use all caps?",9114708,2012-08-31 20:13:10
324787,7053,1507457,73,This code is very similar to the one above. Maybe use the code above and do a transpose instead of copy pasting?,9114708,2012-08-31 20:17:13
327194,7053,1015326,19,Why not put it in the LowPriorityTuplePackers?,185434,2012-06-20 08:44:06
327194,7053,1015328,28,Wait why do this?,185434,2012-06-20 08:45:33
327194,7053,1015336,28,"I guess you are doing this because you want to make this really a TupleConverter. Don't see what you are gaining though, given that we need the whole Packer hierarchy...",185434,2012-06-20 08:47:50
327194,7053,1015338,72,Typo: +uses+,185434,2012-06-20 08:48:36
327194,7111,1028469,19,It would conflict with the reflection case.  I'm trying to make sure this is higher priority for TupleN.,185434,2012-06-22 00:05:29
327194,7111,1028516,28,"With the converter (which I copied from our setter approach on TupleUnpacker) we can have access to both the type and the fields when we generate the TupleConverter to use.  Otherwise, the TuplePacker is only looked up implicitly using the type, and we ca",185434,2012-06-22 00:11:31
348627,44017,1517742,24,Why is ReduceOperations sortable? This seems wrong.,9484395,2012-09-03 21:28:24
348627,44017,1517750,18,I don't understand the Fields type param here. Are you using or contemplating using Sortable in some context where cascading Fields aren't used?,9484395,2012-09-03 21:30:00
348627,44017,1517754,9,"Hm, just saw this. I would argue that the versions where ordering matters should move to FoldOperations.",9484395,2012-09-03 21:31:12
348627,7111,1517946,24,"I agree.  It was a difficult choice. Here is the issue: It is faster to build a list in reverse order if you use immutable data-structures (push into a stack).  Then at the end, if you care about order, you need to reverse this list. If you don't care abo",9484395,2012-09-03 22:39:23
348627,7111,1517952,18,"Straight-up laziness.  I realized that this trait doesn't care about the Fields object at all, and I simply differed it until where it was used. I can make it concrete if you prefer. Just say so.",9484395,2012-09-03 22:40:33
348627,7111,1517963,9,"So, I'd prefer not to move toList and mkString to FoldOperations because they do make sense in a non-sorted situation, but they are just slightly faster if we don't care about ordering. I'll just pay the cost every time (PS: these methods kind of suck bec",9484395,2012-09-03 22:42:34
348627,44017,1517984,18,"I think so, for simplicity.",9484395,2012-09-03 22:50:22
348627,44017,1517991,9,"Agreed that we should just pay the reversal.

Given the OOM issues, I almost wonder if we should get rid of these and force people to use take or sortedTake... (btw, I keep meaning to add takeRandom, which is basically mapPlusMap{x => (math.random, x)}{t ",9484395,2012-09-03 22:52:47
360953,7111,1560941,64,"This should be ""sealed"" so the compiler can see that any matches are guaranteed to be exhaustive (not a huge deal since field conversion happens before job submission, but still...)",10489019,2012-09-08 23:52:16
360953,7111,1560943,66,"Can we also get the manifest here:

def manifest : Manifest[T]",10489019,2012-09-08 23:53:24
360953,7111,1560944,73,"also:

(implicit mf : Manifest[T])

would be nice.",10489019,2012-09-08 23:55:56
360953,7111,1560959,66,"actually, we might want Option[Manifest[T]] since we can't get the Manifest from a cascading field, and as such this method would prevent us from being able to go from cascading Fields -> List[Field] which is something we probably want to be able to do.",10489019,2012-09-09 00:02:56
360953,7111,1560962,81,"How about a method here like:

def apply(fs : cascading.tuple.Fields) : List[Field] = {
  // Go through and get out the comparator, use Ordering.comparatorToOrdering to convert.
  // I've been trying to talk chris Wensel into adding the java Class object ",10489019,2012-09-09 00:06:34
360953,605979,1568302,81,"An alternative to this would be to define a RichFields class (extending
Fields) and an implicit Fields -> RichFields conversion, so that in place
of the apply method we could have the (somewhat more natural?)

fields.getFieldList

to return a List[F",10489019,2012-09-10 22:29:26
360953,7111,1569874,81,Sounds good to me.,10489019,2012-09-11 01:01:00
360953,7111,1583432,126,"if you want to make this class more compact, you can do:

StringField[T](override val id : String)(implicit override val ord : Ordering[T], override val mf : Option[Manifest[T]]) extends Field[T]

I think....  Not a big deal, just FYI.",11063271,2012-09-12 09:29:03
360953,605979,1589120,126,"Nice.  I figured there was a cleaner way to do this, just wasn't sure what
the syntax was.  Thanks!

On Tue, Sep 11, 2012 at 9:29 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In src/main/scala/com/twitter/scalding/FieldConversions.scala:",11063271,2012-09-12 21:48:15
360953,7111,1592996,97,"lazy val toFieldList

perhaps?",11133905,2012-09-13 04:11:34
360953,7111,1599303,87,lazy val for these?,11281522,2012-09-13 21:16:05
360953,7111,1599307,88,I'd prefer lazy.,11281522,2012-09-13 21:16:15
403744,44018,1624019,105,"Can you explain all of these little contractions, or provide a link to some scala code that explains them? This looks like an internal detail that they'll upgrade sometime to mess with us.",12153824,2012-09-18 03:37:05
403744,7111,1630874,105,"You are absolutely right, but we have unit tests and they will fail if that happens.

There is really now way around this. If you call .getClass on (1,1) you will find that it is Tuple2$mcII$sp.  It's just some internal name mangling that the scala compil",12153824,2012-09-18 21:34:08
403744,44018,1630943,105,Sounds good. Gotta get those Scala folks to fix this shit up!,12153824,2012-09-18 21:40:08
406644,7053,1632546,37,Can you add a TODO that we should fix ```Mappable```?,12315537,2012-09-18 23:53:13
425388,7053,1675143,15,Should this not be a method of ```Grouped```?,12770269,2012-09-24 21:59:37
425388,7111,1675206,15,"who would be using it (also clearly you can get at it if you really need it)?

I'm trying to keep a minimal API in grouped. Once we add functions, we should be very careful about removing them.

This method is only here for the temporary bugfix. The real ",12770269,2012-09-24 22:06:49
425388,7053,1677395,15,"I don't insist. It just feels like this is not the right place for this, even if this is a temporary bugfix. Why do you need to introduce this as an inner function of operate? Will you ever need this again if you need to convert Grouped to Pipe?

By the w",12770269,2012-09-25 01:23:10
425388,7053,1681439,15,"Anyway, no reason to bikeshed. I'll merge this and we figure it out later.",12770269,2012-09-25 13:24:53
440739,7111,1708833,15,"I'd rather see this as:

isNumber(arg)

and:
```scala
def isNumber(arg : String) : Boolean = {
  try {
    arg.toDouble
    true
  }
  catch {
    case e : Throwable => false
  }
}
```
Or another more elegant function if one exists.  The advantage of the ",13688725,2012-09-27 21:13:33
440739,7053,1709240,15,Agreed.,13688725,2012-09-27 21:44:14
451706,7053,1741088,58,This feels a bit more generic than Joiner. Maybe we create a CascadingUtils class? Or TupleBase?,14427666,2012-10-02 22:15:33
451706,7053,1741142,118,Typo: resulting,14427666,2012-10-02 22:22:12
451706,7053,1741182,118,Maybe add: otherwise the flow planner will throw an exception.,14427666,2012-10-02 22:24:34
466570,7111,2132660,55,do you need the foldLeft here? Can't you just do a (1 to k).toList.map { x => ... }.reverse and get the same result?,16605225,2012-11-15 06:32:19
466570,7111,2132671,19,"Maybe you should just do:

```scala
type PipeInt = (RichPipe, Int)
```
rather than introduce a new class (which you never pattern match on).  I think the case class is useful if you are actually pattern matching.",16605225,2012-11-15 06:33:15
466570,7111,2132682,68,"If you did the .map approach I mention above, you wouldn't need to reverse here.",16605225,2012-11-15 06:33:43
466570,7111,2132720,168,"not clear what this means. Do you require associativity here? If so, is it not acceptable to require an implicit Monoid[T]?",16605225,2012-11-15 06:37:05
466570,7111,2132814,171,"Can you rename resultNotOk to isUnsatisfiable or something? The issue is that resultNotOk sounds like !resultOk, which it is not really the meaning.",16605225,2012-11-15 06:45:33
466570,7111,2132888,4,"can you remove this from the diff, just to keep it a tiny bit cleaner.",16605225,2012-11-15 06:54:12
466570,7111,2132925,171,usually we would return Pipe here since RichPipe is just an enrichment class.,16605225,2012-11-15 06:57:58
466570,7111,2132950,46,Prefer to return Pipe since RichPipe is only an enrichment class for Pipe.,16605225,2012-11-15 07:00:28
466570,7111,2324556,46,I think this comment should be addressed.,16605225,2012-12-06 01:27:37
466570,7111,2324616,57,"Why did you use """" + n rather than n.toString

Also, why are you using strings at all here?  It looks like you are generating something that should be:

```scala
val pipe = IterableSource( (x._2 + 1 to n), x._1 ).read
```

Also, ```pipe``` is a ba",21520605,2012-12-06 01:31:05
466570,7111,2324622,70,Can you comment why you used crossWithSmaller rather than crossWithTiny?,21520605,2012-12-06 01:31:33
466570,7111,2324631,80,"remove the spurious space before ""n""",21520605,2012-12-06 01:32:10
466570,7111,2324646,98,please return Pipe.,21520605,2012-12-06 01:33:00
466570,7111,2324688,248,"Replace with:
```scala
IterableSource((0 to result.toInt by wt.toInt), name)
```",21520605,2012-12-06 01:35:53
466570,7111,2324731,170,"please give a better name.  For instance, ```allSolutionsForSize``` or something.

Note, Algebird now has Semigroup[T] that is only associative. I think we should be using that here.",21520605,2012-12-06 01:38:39
466570,7111,2325491,157,"I think this is imprecise. What are these families of variadic functions?

So, what do we know?  We actually know that f is related to a function on a List[T], because you are requiring only type T to be passed in, so we can define flist:

```scala
d",21520605,2012-12-06 02:27:43
466570,7111,2325511,195,please add a comment as to why crossWithTiny doesn't work.,21520605,2012-12-06 02:28:54
466570,7111,2325545,239,"This should return Pipe.

Also, can you take a type [N: Numeric] instead of Double, so you can do Int, Long, Double?

rmake the space "": Pipe"" not "" :RichPipe""",21520605,2012-12-06 02:31:18
466570,7111,2325570,272,"replace this with ```x.getInteger(i)``` which does this same logic internally, but avoids the toString if the internal data is already an int (also note, strings are REALLY expensive compared to Ints, so for performance, you should avoid them).",21520605,2012-12-06 02:32:36
466570,7111,2061767,62,"why capture res2, why not just return the result of the foldLeft?",16605330,2012-11-08 04:46:21
466570,7111,2061782,31,I think taking an IndexedSeq[T] would be more idiomatic scala.,16605330,2012-11-08 04:47:28
565702,44017,2238542,94,"I haven't fully thought through this, but I think using inner joins here (and below, line 398) might actually be to our advantage. My reasoning is this: since the full skew join is only allowed to have inner join semantics, any (for example) left key that",19751071,2012-11-28 00:27:40
565702,44017,2225182,94,"Shouldn't this be a joinWithTiny? You're doing a joinWithTiny later on with the full sampledCounts, so presumably sampledRight is also small enough...",19751071,2012-11-27 01:01:49
565702,7111,2230084,94,"There is no outerjoin with joinWithTiny, but there is a left join.

Not clear to me that we need outerjoin though.",19751071,2012-11-27 08:32:47
565702,7111,2243631,94,"But due to sampling, we can't trust the innerjoin is a true zero, vs a sampled zero where there is actually a heavy key on the other side, right?

Alternatively, Edwin and I were discussing use CountMinSketch, which (we thought) could conclusively disti",19751071,2012-11-28 05:53:43
565702,8579,2244686,94,"Sorry, I think my previous comments got lost...

Yeah, a CountMinSketch works like a Bloom filter, so if the CMS says the frequency is zero, it's a true zero. (but not vice-versa)",19751071,2012-11-28 07:33:54
565702,8579,2244716,94,"Also, re: Avi's first comment, I'm actually thinking of changing the joinWithTiny against the full sampledCounts to a joinWithSmaller, since I'm not so sure sampledCounts is that tiny.",19751071,2012-11-28 07:36:44
565702,7111,2244956,94,"I'd bias to the tiny if I were you. For instance, if we default to 1/10,000 probability, than a key has to show up 10k times to be expected to survive.

If there are 10^10 rows initially, then you have 10^6 after sampling, and presumably, some of those ",19751071,2012-11-28 08:01:31
565702,7053,2255554,78,Dont you want this to be strictly greater than 1?,19751071,2012-11-29 02:29:30
565702,7053,2255560,78,"Actually never mind, you don't need this.",19751071,2012-11-29 02:30:00
565702,7053,2255607,103,Previous two lines are a bit long. Please break them up.,19751071,2012-11-29 02:32:14
565702,7111,2255630,147,"If the following three lines were in a method, we could override that method and experiment with different replication strategies.

That might be the easiest thing to do for a quick shipit and experiment-phase.",19751071,2012-11-29 02:33:06
565702,7053,2255670,127,"So presumably this method is only going to be used by ```skewJoinWithSmaller```. Instead of passing countFields and dummyFields as params, you could define them as constants and call them as such instead of passing them in the method call.

Not a big de",19751071,2012-11-29 02:35:11
565702,8579,2261975,127,"Yeah, agree having a bunch of parameters is gnarly (and I just added more :(), but I don't really want to make these constants on JoinAlgorithms. (because they'd be random and dangling) Other suggestions welcome.",19751071,2012-11-29 15:17:43
565702,8579,2262077,103,Done.,19751071,2012-11-29 15:33:10
565702,8579,2262082,147,Done. Moved into their own class.,19751071,2012-11-29 15:33:31
566637,141360,2240682,13,Good suggestions. Done.,19812708,2012-11-28 02:42:20
566637,141360,2240684,17,Done.,19812708,2012-11-28 02:42:34
566637,141360,2240690,18,Done. Thanks for the help!,19812708,2012-11-28 02:42:52
566637,44017,2225513,13,what's the purpose of this?,19812708,2012-11-27 01:25:18
566637,44017,2225519,17,"I wonder if a better name, in the spirit of groupBy and groupAll, would be groupRandomly?",19812708,2012-11-27 01:25:41
566637,7111,2225809,13,"We actually have a use case, but I agree we should add a comment with proper scaladoc.

The use case is this: we have a compute heavy job, but hadoop won't let us read less than the min-split size. So, we read the data, and then shard it N ways and star",19812708,2012-11-27 01:51:01
566637,44017,2225905,13,"Ok, got it. I vote for groupRandomly for the more general method and shard for this specific usage.
Also, that abuse of takeWhile feels like it should be made explicit in GroupBuilder with a method called something like pass().",19812708,2012-11-27 01:57:53
566637,7111,2225983,18,"I think you actually want to do something like:
```scala
using[Unit,Random](new Random)
  .map(() -> '__shard__) { (r:Random, _:Unit) => r.nextInt(n) }
```
Otherwise, ```new Random``` will get initialized with the time in millis (I think), and two ca",19812708,2012-11-27 02:05:32
566637,7111,2226011,13,"upvote for groupRandomly.

Also I like adding pass to GroupBuilder as Avi suggests, which can be this takeWhile(0) hack that is also repeated in groupAll.",19812708,2012-11-27 02:07:08
581705,7111,2274709,34,"Or, RichDate.upperBound(startDate + Days(period-1)) might be right.... I'll let you gents verify.",20480292,2012-11-30 11:33:59
581705,47082,2280619,34,"Went with startDate + Days(period) - Millisecs(1), as RichDate.upperBound only takes a string (I've been meaning to write a version that takes a RichDate, but not right now).",20480292,2012-12-01 00:45:14
581705,47082,2280623,15,Good catch. Fixed.,20480292,2012-12-01 00:45:32
581705,7111,2274668,15,"this should be lazy if you want to regain the ability to only fail if date is present AND we actually touch dateRange, which is a nice feature.  So, can we add lazy back here?",20480292,2012-11-30 11:22:44
581705,7111,2274698,34,"if period == 1, then this will be a DateRange with only startDate inside the range.

I think the upperBound logic needs to come into play here as well.  Of course, if DateRange had been exclusive in the upper bound, this would have been simpler. Maybe f",20480292,2012-11-30 11:31:16
581705,7111,2274701,25,"Would you guys be willing to add TypedCsv following the TypedTsv pattern? That would be really nice, as we could then use the Mappable interface, which works well with the typed API.",20480292,2012-11-30 11:32:22
643766,7111,2300233,4,Please add a note that this scheme is how cascading.jruby parses args and is added for compatibility with systems that are built around that.,22169289,2012-12-04 06:30:10
643766,7111,2300254,4,Please add a test that checks for serialization of Args (i.e. make sure toString round-trips correctly and that: https://github.com/twitter/scalding/blob/develop/src/main/scala/com/twitter/scalding/serialization/KryoSerializers.scala#L69 still works prope,22169289,2012-12-04 06:32:17
653809,141360,2388824,6,"I wanted the type of the partitionFn to be inferred, but I had to still specify it with (_:Int). Is there a way to add the type inference?",22281711,2012-12-12 10:58:23
653809,7111,2410630,14,"```scala
def partition[A,R](fs: (Fields, Fields))(fn: (A) => R)(builder: GroupBuilder => GroupBuilder)
  (implicit ... ord: Ordering[R], rset: TupleSetter[R])
```
This is a little tricky. So the way to work this is something like:
```scala
  val tmp",22281711,2012-12-14 00:56:13
653809,141360,2388793,14,"FYI, Oscar had suggested this be called groupByFn. I can do this if we still want to and think this a more appropriate name.",22281711,2012-12-12 10:52:02
653809,141360,2535675,14,This is pretty cool. Believe I addressed this. Please take a look.,22281711,2013-01-03 09:29:12
653809,7111,2540167,20,please add ```rset.assertArityMathces(toFields)```,26722602,2013-01-03 23:23:08
653809,7111,2540174,25,please add: ```.discard(tmpFields)``` as they are not expanded back into into the toFields.,26722602,2013-01-03 23:23:38
653809,141360,2540855,20,Done.,26722602,2013-01-04 00:09:00
653809,141360,2540862,25,Done.,26722602,2013-01-04 00:09:37
653809,7111,2541271,7,"you need to project the fields to fix the order:
```.project('isAdult, 'weight)```
(before the .write)
Because the new code reordered the fields.
",26722603,2013-01-04 00:38:59
653809,7111,2541281,25,"Looks like the build fails:

https://travis-ci.org/twitter/scalding/builds/3935538/#L3763




On Thu, Jan 3, 2013 at 9:09 AM, Arkajit Dey <notifications@github.com>wrote:

> In src/main/scala/com/twitter/scalding/RichPipe.scala:
>
> > +        ",26722602,2013-01-04 00:39:57
653809,7111,2541284,7,"https://travis-ci.org/twitter/scalding/builds/3935538/#L3763

That's the error.",26722603,2013-01-04 00:40:21
653809,141360,2541320,7,"Ah, good point, thanks!",26722603,2013-01-04 00:43:46
656362,7111,1266650,62,Can you put a TODO to handle Test mode and Local mode here?,1253877,2012-07-31 00:24:40
656363,7053,1948042,13,Do you want to also add a spec for this job?,22310836,2012-10-26 04:16:39
656363,605979,1957659,13,"Definitely.  My first goal was just to make sure the scala compiler got the type inferences right - and a spec isn't necessary for that, since we just need to make sure that it compiles.

But I certainly want more testing before considering this for a m",22310836,2012-10-27 02:00:04
656371,44017,2032952,27,"This is maybe just me, but I find (ag.reduce _) confusing when I know that reduce is arity 2. I guess it works, but it feels odd that it does.",16237083,2012-11-06 01:24:22
656378,7111,1892849,16,Can we move this to Source.scala?,16237145,2012-10-19 22:47:36
656378,7111,1892871,34,Can you remove the case class and instead add an object with an apply?  Case classes can't be subclassed so we have tried to deprecate their usage as sources that we intend to subclass (also we don't use the pattern matching aspect).,16237145,2012-10-19 22:48:44
656378,7111,1892889,85,"totally confused as to why Tsv can't handle this case? What is the difference? Looks like someone didn't extend Tsv properly. Remove this and add a object Tsv { 
  def apply(paths: Seq[String])
}",16237145,2012-10-19 22:50:08
656378,7111,1892892,25,remove case class.,16237145,2012-10-19 22:50:30
656378,44018,1892894,16,Done.,16237145,2012-10-19 22:50:34
656378,44017,1892895,23,"Can we make the YEAR_MONTH_DAY pattern an implicit so that it's more easily configurable, without subclassing/modifying all N of these classes?",16237145,2012-10-19 22:50:55
656378,44018,1892903,85,gone,16237145,2012-10-19 22:51:51
656378,44018,1892940,34,"Done, for this and all other case classes.",16237145,2012-10-19 22:54:34
656378,44018,1892951,25,Done.,16237145,2012-10-19 22:55:26
656378,7111,1893897,23,"So, I don't think we want an implicit string sitting around (obviously), but we could have something like:

case class YearMonthDayPath(path: String)

and make that implicit.

Or we could, as Sam suggested, just make it a val, which could we could o",16237145,2012-10-20 00:24:01
656378,44017,1894307,23,"Yes, I was thinking of a case class. The advantage of an implicit over a val is that you can set it once in, say, a trait that you mix into every Job (which I suspect most organizations have), and then just use all of the DailySuffix, DailySuffixCsv, Dail",16237145,2012-10-20 01:06:36
656388,7111,1836320,22,"Maybe a comment to explain this:
/** This Source writes out the TupleEntry as a JSON map. Probably only useful for writing, on read it is identical to TextLineScheme
 */",16237266,2012-10-14 00:29:27
656408,7053,505761,4,"Wait, why is the artifact scalding_2.8.1 and the version is 0.3.4?",22310380,2012-03-01 14:14:33
656408,7053,505768,49,"0 is safe here right? I guess it is, just checking.",22310380,2012-03-01 14:17:04
656410,7111,2410384,27,"I like this. What about adding an additional function to go from ```toBytes: (U) => Array[Byte]``` and not make this private.

In hyperLogLog/approxUniques, you have:, U = CTuple and:
```scala
toBytes = { (in: CTuple) => in.toString.getBytes(""UTF-8"") ",22310911,2012-12-14 00:37:27
656410,605979,2414376,27,So I assume we will also need a TupleConverter[U] parameter?,22310911,2012-12-14 04:58:39
656410,605979,2414486,27,"Scratch that - tuple conversion gets delegated to mapPlusMap, of course",22310911,2012-12-14 05:06:13
656410,7111,2415941,20,"I think you actually need CTuple, not Any here. The issue is if someone counts multiple fields (like age, height combinations) the arity will be 2, but the default TupleGetter has arity 1 (singleGetter). By using the CTuple type, scalding just passes you ",22489037,2012-12-14 07:32:07
656410,7111,2415948,25,"Can we move the toBytes before fn, since it logically happens before ( T=> toBytes => HLL => fn ).",22489037,2012-12-14 07:32:55
656410,7111,2950699,24,"Super sorry for the delay.

Will click merge right now if you send one that doesn't change old signatures (just adds methods, otherwise we can't put it in 0.8.3 which I want to release soon.).

So, can you make approxUniques use the toString.getBytes(",29081953,2013-02-09 05:44:06
656410,605979,2452306,25,I wish this could be an implicit hasher...,22489037,2012-12-19 01:12:36
656410,7111,2479933,37,"you are going to need to add T: TupleConverter. Without that, this method can't see which TupleConverter to use, and so it uses the singleConverter, which just is: getObject(0).asInstanceOf[T], which breaks because the internal object is not a CTuple.

",26722486,2012-12-21 00:52:03
670896,68408,2410464,13,"Sounds fine to me, whichever you think is more idiomatic",22471221,2012-12-14 00:43:42
670896,7111,2415924,13,"Since we use -> for fields so often in the scalding DSL, I tend to prefer to avoid it here.

Can I suggest you pick either: insert(f: Fields, value: A) or insert(f: Fields)(value: A), giving either: insert('a, 1) or insert('a)(1). Your choice.

I'll m",22471221,2012-12-14 07:29:23
670896,7111,2410289,13,"We need ```insert[A:TupleSetter]``` otherwise, we are not threading through the TupleSetter correct

This is nice, but I do wonder if it is not better to just do:

```insert(f: Fields, value: A)```

What do you think about that?",22471221,2012-12-14 00:30:49
776252,7111,2491855,6,"Should this not be abstract?
",24576291,2012-12-22 02:17:58
776252,504464,2491936,6,"yes it should be. i will change.

On Fri, Dec 21, 2012 at 2:18 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In src/main/scala/com/twitter/scalding/Operations.scala:
>
> > @@ -73,6 +73,23 @@ import CascadingUtils.kryoFor
> >    }
> >
>",24576291,2012-12-22 02:30:02
779842,605979,2568526,42,Because TupleConverter is invariant in its type parameter.,24946879,2013-01-08 02:52:58
779842,605979,2568595,139,"Good catch.  This compiled fine thanks to TypedPipe's newfound covariance, but perhaps could cause subtle problems due to the TupleConverter in operate having the wrong type?  In any case, I've fixed this",24946879,2013-01-08 02:58:45
779842,605979,2554666,14,Note that the changes to TypedPipe.aggregate and Grouped.aggregate can be reverted once the corresponding patch to algebird (making Aggregator type variant) propagates.,24946879,2013-01-05 03:34:00
779842,7111,2560863,108,"Maybe add a link to:
http://stackoverflow.com/questions/676615/why-is-scalas-immutable-set-not-covariant-in-its-type
To explain why Set is invariant, but List is not.",24946879,2013-01-07 06:10:55
779842,7111,2560872,139,Don't you want ```operate[U]``` here?,24946879,2013-01-07 06:12:24
779842,7111,2560881,14,Can you add a TODO to this effect?,24946879,2013-01-07 06:13:39
779842,7111,2560882,14,Or at least an issue in the issue tracker?,24946879,2013-01-07 06:13:48
779842,7111,2560892,42,Can you explain this one for me? I don't see why we need this.,24946879,2013-01-07 06:17:17
779842,605979,2568565,108,"Done.  Incidentally, this is one of the things that most annoys me about the scala API.",24946879,2013-01-08 02:55:55
910514,44018,2639337,4,Remove what? the Object? Can you add a note on why?,26770624,2013-01-15 02:17:07
910514,44018,2639346,4,"Okay, yeah, I see below.",26770624,2013-01-15 02:17:18
919855,7053,2661193,1,We probably still want the license headers here or Chris A will be angry.,26800572,2013-01-16 11:29:58
919855,7053,2661196,604,"Were we not talking about not instantiating Tuple, but keeping one around for each setter?",26800572,2013-01-16 11:31:14
919855,7053,2661204,604,"I guess we should probably do this as a separate diff though, right?",26800572,2013-01-16 11:33:24
919855,7111,2661292,1,Can you copyright generated code?,26800572,2013-01-16 11:54:16
919855,7111,2661296,604,"Yes, I think it should be in a separate diff.",26800572,2013-01-16 11:55:00
945812,7111,2854098,16,"Yes. Please change to:
```scala
new Fields(fieldMap.map { case (fieldName, _) => fieldName })
```
Isn't that right?",26909236,2013-02-01 08:00:25
945812,7111,2854105,16,"Actually:
`new Fields(fieldMap.keys.asJava)`

with the scala.collection.JavaConverters._ imported.",26909236,2013-02-01 08:01:11
945812,7111,2862554,28,"Can you just make this return a Fields object? That way, you can just call original ReflectionSetter with this inferred Fields object.",26909223,2013-02-02 00:58:02
945812,7111,2854072,24,Can you add a new test in addition to this one? I don't want to remove the old test (we need to make sure it still passes).,26909236,2013-02-01 07:58:34
945812,7111,2862619,28,"Also, please make an:
```scala
object ReflectionUtils {
  def fieldsOf[T](c: Class[T]): Set[String]
  //for a given class, give a function that takes a T, and a fieldname and returns the values
  def fieldGetters[T](c: Class[T]): (T,String) => AnyRef",26909223,2013-02-02 01:03:29
945812,20575,2862726,28,"Ah just saw these. `ReflectionUtils` is a nice idea. On returning a Fields object - I went the other way and stripped it down to FieldNames, let me know which you think is sounder...

Two other things:

1. I couldn't figure out how to test with anythi",26909223,2013-02-02 01:14:19
945812,20575,2863108,28,**Update**: returning a Fields object like you suggested is much nicer. Making the change now...,26909223,2013-02-02 01:35:33
945893,7053,2854738,14,Do you mind adding a comment here as to what is going on? This is a confusing esoteric call.,26909780,2013-02-01 09:00:59
962137,7053,2953808,6,Typo: not sampled in any particular method.,28841915,2013-02-10 02:40:32
975866,12202,2918808,88,this id is wrong,29069935,2013-02-07 05:44:23
975866,12202,2918815,93,wrong id also...,29069935,2013-02-07 05:44:43
975866,44018,2919990,93,"Whoops, good catch.",29069935,2013-02-07 07:12:15
978031,7111,2950544,17,"the sortBy should happen first:

g => gs(g.sortBy('__rand__)).reducers(n)",29081879,2013-02-09 05:32:42
978031,7111,2986690,43,"Let's get rid of this one. scala will implicitly convert between Int and Long, and so reading the code it won't be clear.

In fact, I might say only keep shuffle(shards: Int) and shuffle(shards: Int, seed: Long).

How does that sound?",29081869,2013-02-13 05:17:21
978358,7111,2953414,16,"I think you want fields -> 'json here, right? Otherwise we might scoop up some Fields we don't want.",29083675,2013-02-09 23:52:07
978358,7111,2953439,11,"Can you add a TODO here?

This is really just a ""pipe transformer"" on TextLineScheme (a pair of transformForRead/Write). We need a cleaner way to write such transformations on pipes and not have to bolt them on one at a time.",29083675,2013-02-09 23:59:18
1125579,7111,3104239,20,"I think: implicitly[TupleConverter[(K,V)]] would have worked here. The tupleN converters are automatically generated.  Also, gK and gV are not needed since the type bound you have above (K : TupleGetter V: TupleGetter).",31714910,2013-02-22 02:07:07
1125579,7111,3104283,15,"how many ways to write word count?

:)",31714910,2013-02-22 02:09:07
1125579,504461,3104296,20,I think I tried that first (the implicitly[TupleConverter....] but let me give it a shot again. ,31714910,2013-02-22 02:09:56
1125579,504461,3104610,15,Don't want to break the most important Hadoop use case!,31714910,2013-02-22 02:28:06
1158516,44018,3328003,14,"@johnynek, do we need to upgrade this to a jdk6 friendly build?",33361852,2013-03-12 06:27:29
1158516,7111,3328068,14,"yes. We do.

I'd branch off master, only bump the javacOption trick, and release 0.1.10, I guess. Sound good?",33361852,2013-03-12 06:34:00
1158516,7111,3493764,38,Can you make this java.io.Serializable?  We've had some problems running on the cluster with non-serializable objects in cascading.,36701935,2013-03-22 23:28:53
1198216,7111,3164394,8,"Can you change this to:
```scala
def sample(percent: Double): Pipe = ...
```
Putting the return type helps us keep the API stable (I know we have cases where we don't put the type, but we're trying to fix that).",33927789,2013-02-27 08:06:23
1211355,7111,3208507,9,"Can we change this to
```scala
def optional[A](key: String)(fn: String => A): Option[A]
def optional(key: String): Option[String] = optional[String](key)(identity[String](_))
```
So we can write: optional(""count"") { _.toInt } which looks more like th",34968069,2013-03-02 01:29:24
1211355,7111,3208618,9,"But when I look, can you make the case for this over:
```scala
optional(""count"").map { _.toInt }
```
Which, granted, it 4 characters longer, but has the advantage of fewer moving parts (and keeping the simplicity that args are always strings).

Also",34968069,2013-03-02 01:35:19
1260235,7111,3442614,8,"Can you change it from Csv to MultipleTextDelimited?  Csv kind of implies that "","" is the delimiter.  Or another idea that doesn't make it look like it is only for comma-separated?",36520619,2013-03-20 04:55:33
1260235,1448184,3493729,8,just renamed into something more meaningful,36520619,2013-03-22 23:27:41
1292579,7111,3502355,4,"Change this to `Enumeration#Value` and that will also fix the scala 2.10 compilation failure this branch is seeing.

As soon as you do that, and the build is green, I'll merge.  Thanks!",37455636,2013-03-24 03:47:37
1292579,34697,3502814,4,Done!,37455636,2013-03-24 08:09:14
1307955,7111,3688741,107,"I'm worried that in scala, filter takes a predicate that means *keep* the items (and there is filterNot for the opposite). It seem like this method is somewhat the reverse semantics, if the predicate here is: that is defined at (row, col), then this is a ",37607089,2013-04-08 09:38:41
1307955,241541,3690290,107,"fixed.


On Mon, Apr 8, 2013 at 12:39 AM, P. Oscar Boykin
<notifications@github.com>wrote:

> In
> scalding-core/src/main/scala/com/twitter/scalding/mathematics/Matrix.scala:
>
> > @@ -573,6 +626,40 @@ class Matrix[RowT, ColT, ValT]
> >      new",37607089,2013-04-08 13:36:00
1307957,7111,3688815,23,"can you change this to:
```scala
def timeout[T](timeout:Long = 10, unit: TimeUnit = TimeUnit.SECONDS)(t : => T): Option[T]
```
So, you can do: `timeout(2) { /* some stuff here */ }`

Next, we need to see a test with runHadoop to be sure that this se",37607110,2013-04-08 10:04:41
1307957,7111,3692962,26,"Sorry for one last issue: in scalding we already have some class for time arithmetic. Can you change to use those here?

I think you want AbsoluteDuration. Also, I'm questioning the wisdom of having a default. Maybe people should just say the timeout th",37607100,2013-04-08 17:22:12
1307959,7111,3688826,24,"This isn't binary compatible (change the constructor on Tsv).

Can you implement this with a methon the the companion object to Tsv:

```scala
object Tsv {
  def apply(p: Path, sm: SinkMode): Tsv = new Tsv(p, ...) {
    override val sinkeMode = sm",37607103,2013-04-08 10:07:01
1307959,7111,3688828,44,Same here. Would rather avoid the binary incompatible change.,37607103,2013-04-08 10:07:20
1307959,598255,3698467,24,"Are you suggesting I remove all changes except for the FileSource class?  I could then do the overloaded apply in my project since I don't know what optional parameters I might want @ the time.

If I left the change in scalding I would need an overloade",37607103,2013-04-08 22:16:49
1307959,7111,3758128,24,"What if you added something like:
```scala
sealed trait HeaderMode
case object NoHeader extends HeaderMode
case object WithHeader extends HeaderMode
case object WriteHeaderSkipOnRead extends HeaderMode
```
Then the code be clear (the boolean is a b",37607103,2013-04-11 22:55:34
1307959,598255,3885743,24,Agreed that would be clearer. Lets merge these changes in with 0.9.0,37607103,2013-04-21 01:20:17
1318260,44018,3821819,5,"I'll merge, but rather than writing INFO, you might want to use the logger and actually log under the info level so users can squash if they want.",37680380,2013-04-17 02:34:38
1318260,7111,3821893,5,"when you write Dots, there is no flow run. I think you would always want to print that (as you can see, what it does next is just exit).

Also, there are println's all over scalding and I don't want to block this cleanup with doing logging right.",37680380,2013-04-17 02:38:26
1318260,44018,3821934,5,remove the INFO prefix and we're good to go.,37680380,2013-04-17 02:40:57
1325988,1825352,3907951,6,Will it make sense to name the two parameters in a more meaningful way? even like mp and dVal?,37735629,2013-04-23 05:36:01
1325988,859018,3910742,6,"Ok. I think it make sense. And what about ""xMap"" and ""dVal"" names?",37735629,2013-04-23 12:17:33
1325988,1825352,3910857,6,"Yes, these names look  good to me.",37735629,2013-04-23 12:29:39
1325988,7111,3947779,16,"This just returns a string, right?

I think we want to print the string to stdout after the stack trace.",37753019,2013-04-25 03:01:59
1325988,1825352,3928766,10,"Trivial. I understand you use ""c"" as variable name here cuz it's a Throwable  class. But since it's also a key for the Map, how about call it as kCls or something similar? Sorry for being picky on variable names.",37735626,2013-04-24 05:10:33
1339779,7111,3962493,9,I think we need a space after the period.,37830076,2013-04-25 22:40:30
1339779,1825352,3963969,9,"Oh, yes you're right. Just fixed this.",37830076,2013-04-25 23:55:14
1359610,7111,3759451,5,"this should be a def.  Otherwise it will only get called once (at object creation time).

Also, I think it should be:

def now: RichDate = RichDate(System.currentTimeMillis)",37971392,2013-04-11 23:56:12
1400258,7111,3989980,7,"Can you write a few tests for this?  I would assume you need `t.getClass.getName`.

Maybe put this function in the RichXHandler object so it is easier to test.",38257387,2013-04-28 00:48:16
1400258,1825352,3990987,7,"I tried both ways on scala REPL, they're giving the same results. But I think you're right, t.getClass.getName is more type-safe.
I will also move these lines to RichXHandler and come up with certian tests. Thanks for suggestion.",38257387,2013-04-28 13:24:22
1400258,7111,4002901,5,"43-47 should only live iv the handler test, not in this class.",38533059,2013-04-29 22:17:22
1400258,1825352,4004101,5,"Sure thing. Thanks.


On Mon, Apr 29, 2013 at 10:17 AM, P. Oscar Boykin
<notifications@github.com>wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/XHandler.scala:
>
> > @@ -39,5 +39,16 @@ object RichXHandler {
> >      classOf[Plann",38533059,2013-04-29 23:12:47
1421735,7111,4047044,4,must *have* an ordering,39009210,2013-05-02 04:31:42
1421735,7111,4047272,5,"I think this should work with:
```scala
def distinct(implicit ord: Ordering[_ >: T]): TypedPipe[T] = {
  // cast because Ordering is not contravariant, but should be (and this cast is safe)
  implicit val ordT: Ordering[T] = ord.asInstanceOf[Ordering[",39009210,2013-05-02 04:48:35
1421735,7111,4047293,5,"Also, can we get a docstring to beef up the scaladoc?",39009210,2013-05-02 04:49:52
1441284,44018,4099223,7,"I think these guys need more descriptive names.

Also, test please? I want to see the different behaviors.",39814900,2013-05-07 00:01:21
1466965,1825352,4198311,14,"Can we have one more test case for chained operations? i.e. mat1.removeRowsBy(col1).removeColsBy(col1)?
Thanks.",40748654,2013-05-13 22:34:35
1466965,241541,4200028,14,i'm unsure what the advantage of that would be. ,40748654,2013-05-13 23:46:25
1466965,1825352,4202841,14,I was thinking it will cover another common usage case. But it's trivial and up to you.,40748654,2013-05-14 02:09:37
1466965,7111,4203116,7,"shouldn't that be RowVector[RowT, ValU]?

I'd merge if you make that change (or convince me that I am mistaken).",40748654,2013-05-14 02:23:49
1466965,241541,4203568,7,"I was imagining something like:

[ d ] [                  ]
[ r ]  [    input       ]
[ o ] [                  ]
[ p ] [                  ]


the input tells which rows to get rid of. Ideally there would be a vector base class that could be accept",40748654,2013-05-14 02:52:04
1466965,241541,4203584,7,"sorry, git reformatted in away my beutiful ascii art matrices. input in the above is the matrix from which rows are being removed. ",40748654,2013-05-14 02:52:51
1466965,241541,4211550,7,"I'd contrast this with:
[drop]
[]
[input]
[]
[]

where drop is the row vector containing the columns that should be removed. ",40748654,2013-05-14 16:03:32
1466965,7111,4218147,7,"I can't understand the diagrams you have here.  Can you try with a
```
code block?
```
It doesn't seem wrong to you that both removeRowsBy and removeColsBy both take a column vector?

I think removeColsBy should take a ColVector as the mask. I think",40748654,2013-05-14 22:15:32
1466965,241541,4219758,7,"Tried to update my ascii diagrams. I feel that rows match up with with the columns to be removed, and columns match up with the rows to be removed- like multiplying with a vector of 1's and 0's. I think if anything, we would consider making both versions ",40748654,2013-05-14 23:24:18
1466965,1825352,4219937,7,Make both versions for the two methods seems redundant to me. Do we have a discussion of having a Vector base class? That sounds a good idea to me and will be really helpful is this scenario.,40748654,2013-05-14 23:31:38
1466965,241541,4220547,7,"I think it's absolutely worth having a vector base, but i dont think it's within the scope of this PR. ",40748654,2013-05-14 23:54:41
1466965,1825352,4221773,7,"I think the best solution here is to create a Vector base class and pass this type to both removeRowsBy and removeColsBy methods. Otherwise it's more intuitive to pass RowVector to removeRowsBy. Passing a ColVector is not technically wrong, but will confu",40748654,2013-05-15 00:48:39
1466965,241541,4221978,7,why will it confuse users? ColVector seems like the mathematically correct thing to do. ,40748654,2013-05-15 00:58:01
1466965,7111,4223823,7,Can you explain how colVector is what you intend on both cases: removing rows and cols?,40748654,2013-05-15 02:20:45
1466965,241541,4402702,7,"my mistake, this should have been rowVector in removeColsBy to keep with the Matrix-Vector Logic. Fixed in latest commit. ",40748654,2013-05-27 21:43:00
1466965,1825352,4405335,7,Now it makes sense to me.,40748654,2013-05-28 04:48:28
1511770,13840,4366619,82,Love the `breakOut` usage here!,42686208,2013-05-23 23:16:44
1511770,7111,4366689,82,Trying it out more. It does seem a bit faster (in some micro-benchmarks).,42686208,2013-05-23 23:20:46
1511770,44018,4366991,24,"Would be nice to comment on what this is -- also, TupleGetter, TupleSetter, etc
",42686208,2013-05-23 23:35:03
1511770,44018,4367113,24,Never mind.,42686208,2013-05-23 23:39:29
1521736,1825352,4373377,14,returns TraverableOnce of T.,42895260,2013-05-24 04:42:14
1543835,7111,4514429,14,I don't think this should be implicit.,43811569,2013-06-04 06:49:32
1543835,7111,4514444,12,Is this still needed with the fix on line 111?,43811569,2013-06-04 06:51:04
1543835,7111,4514450,21,Isn't this fixed by the mode on 111?,43811569,2013-06-04 06:51:56
1543835,7111,4514456,30,Is this really needed?,43811569,2013-06-04 06:52:27
1543835,1825352,4514962,12,"No, it's not. Fixed.",43811569,2013-06-04 07:53:17
1543835,1825352,4514923,14,"Yes, you're right. Actually getNode doesn't need the mode parameter at all.",43811569,2013-06-04 07:49:10
1543835,1825352,4514973,21,ditto.,43811569,2013-06-04 07:55:56
1543835,13840,4510919,15,"This could also be:

```scala
  modeMap.getOrElse(args(""scalding.job.mode""), mode)
```",43884186,2013-06-04 02:41:06
1543835,1825352,4513002,15,"Thanks! Just fixed!

Kevin


On Mon, Jun 3, 2013 at 2:41 PM, Ryan LeCompte <notifications@github.com>wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/Mode.scala:
>
> >    implicit var mode : Mode = Local(false)
> >
> > +  // Map t",43884186,2013-06-04 04:40:55
1547434,7111,4557543,12,let's keep this because no one should ever set this twice.,43834749,2013-06-06 03:25:52
1547434,1825352,4558003,12,Reverted.,43834749,2013-06-06 03:55:10
1551030,47822,4571361,75,"Sure, hadn't thought of that",43858334,2013-06-06 21:24:01
1551030,47822,4571368,26,"yep, i'll change that",43858334,2013-06-06 21:24:18
1551030,47822,4571605,75,What do i do in the case where the configuration is not available? should i make that a require()? just do nothing?,43858334,2013-06-06 21:35:00
1551030,7111,4738153,120,"don't need the implicit mode here, right?",45363987,2013-06-18 04:42:00
1551030,7111,4738163,130,"no mode either here, right?",45363987,2013-06-18 04:42:18
1551030,7111,4738218,9,"Can you add a comment something like:

/**
 * To use the DistributedCache do: DistributedCacheFile(""SomeFileName.txt"")
 */",45363987,2013-06-18 04:45:57
1551030,7111,4738233,42,"Why return the Uncached, rather than going ahead and calling add?",45363987,2013-06-18 04:46:41
1551030,47822,4738513,42,"I think originally I was going to handle the ""Is HDFS available"" issues by allowing the user to choose to call add() or not. I guess now that I support all the Modes, I can just always call add here and make it easier.",45363987,2013-06-18 05:02:58
1551030,47822,4738528,9,"Sure, I was going to update the example in the wiki once this landed as well. (if that's OK with you)",45363987,2013-06-18 05:03:33
1551030,7111,4551446,75,"seems hadoop specific.

Can we instead take an implicit Mode here and get the configuration from that?

Then we can also support this is tests or locally by mocking it out correctly.",43858334,2013-06-05 23:06:31
1551030,7111,4551482,26,can't these three be in the trait since they just call through?,43858334,2013-06-05 23:07:52
1551030,7111,6977742,9,"Jonathan,

Congrats on the new son, by the way.

Just checking in: I lost track of the wiki stuff you wrote for you
distributed cache work. That is in science now, and I wanted to give you a
shout-out and link to the documentation.

Can you remind",45363987,2013-10-15 22:20:57
1551030,47822,6977944,9,"Oh, hey, yes

$ git clone git@github.com:twitter/scalding.wiki.git scalding.wiki

it's in a branch 'distributed-cache-page' in Using-DistributedCacheFile.md

I may have been overly conservative in making a branch and such, I had an
aversion to publ",45363987,2013-10-15 22:25:59
1551030,7111,6978269,9,"Looks good to me. Can you replace the current page on Distributed Cache
with this?

https://github.com/twitter/scalding/wiki/Using-the-distributed-cache

I think we should get people to use this approach as the supported approach.


On Tue, Oct 15",45363987,2013-10-15 22:35:23
1551030,47822,6980738,9,"yup, will do


On Tue, Oct 15, 2013 at 1:35 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In
> scalding-core/src/main/scala/com/twitter/scalding/filecache/DistributedCache.scala:
>
> > @@ -0,0 +1,29 @@
> > +package com.twitter.scalding",45363987,2013-10-15 23:40:52
1551030,47822,6991046,9,"updated!
https://github.com/twitter/scalding/wiki/Using-the-distributed-cache


On Tue, Oct 15, 2013 at 2:40 PM, Jonathan Simms <slyphon@twitter.com> wrote:

> yup, will do
>
>
> On Tue, Oct 15, 2013 at 1:35 PM, P. Oscar Boykin <notifications@git",45363987,2013-10-16 07:22:11
1565514,7111,4621646,5,we shouldn't take the implicit TupleConverter. We always put the whole T into a single column here (use singleConverter),44632636,2013-06-11 02:08:55
1565514,7111,4621657,11,use the single converter.,44632636,2013-06-11 02:09:21
1565514,7111,4621679,4,not sure this is right. @krishnanraman or @sritchie should chime in an this,44632636,2013-06-11 02:10:18
1565514,7111,4621755,18,Why is this commented out?,44632636,2013-06-11 02:13:22
1565514,967231,4621943,4,"I believe it is right. PailSource class constructor is private, we
exclusively use the PailSource.source(..) & PailSource.sink(..) functions.
tx
  krishnan


On Mon, Jun 10, 2013 at 2:10 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In",44632636,2013-06-11 02:21:19
1565514,7111,4622024,7,shouldn't need conv. We always these pairs using the tuple2converter.,44632636,2013-06-11 02:24:56
1565514,7111,4622051,27,don't think conv is needed here,44632636,2013-06-11 02:25:57
1565514,7111,4622169,5,sum[Double] is equivalent to the old code.,44632636,2013-06-11 02:30:17
1575339,7111,4622250,5,"I regret this pattern of mixing in tons of implicit conversions. Can we instead do something like putting these is an object, FunctionImplicits, and people can opt in to this?

I'm really nervous with how this will interact with the typed API if we turn",44938474,2013-06-11 02:34:08
1575339,7111,4622264,5,don't like mixing this in to all Jobs.,44938474,2013-06-11 02:34:40
1580477,7111,4737992,10,Let's not have the second parameter list as that does non-obvious things with equality and hashCode.,45123134,2013-06-18 04:34:06
1580477,34711,4776723,10,"Good point, I will update the pull request. 

Thanks for the feedback. ",45123134,2013-06-19 21:36:03
1587808,44018,4667325,43,"shit, sorry. Didn't mean to do these. Let me adjust.",45354194,2013-06-13 02:15:50
1588576,44018,4670871,10,nice,45377663,2013-06-13 05:55:18
1588576,13840,4672695,85,I think this should also be `flowMap.synchronized { flowMap.get(fd) }` since the map isn't thread-safe at all and needs to be properly synchronized for all get/modify operations.,45377663,2013-06-13 09:59:04
1588576,1825352,4673771,42,"Maybe I'm wrong, isn't p a method here ( => Pipe), can it be automatically converted to Pipe?",45377663,2013-06-13 12:25:37
1588576,7111,4682618,42,"`p: => Pipe` means it is a call by name variable, so every access of it will cause the expression that was passed to it to be evaluated. It is similar to a `() => Pipe` except that every time you use the variable, it is like calling the function.

This ",45377663,2013-06-13 21:13:45
1588576,1825352,4683588,42,"Oh, yes. Now I remember it. ",45377663,2013-06-13 21:47:59
1649610,7111,4891251,4,can we avoid this by just using java built in MD5? I'm trying to get apache commons out of the deps (Ashu saw a problem with it in the past and we are only using it for trivial stuff).,47400652,2013-06-26 18:59:29
1649610,44018,4897298,4,Done,47400652,2013-06-26 22:48:50
1654527,7111,4928778,11,I think we can get rid of this and just use projectFields == None for this case,47491958,2013-06-28 03:43:09
1654527,7111,4928791,6,don't we init with Some(groupFields)?,47491958,2013-06-28 03:43:39
1654527,7111,4928801,21,"I think:
```scala
projectFields = projectFields.map { Fields.merge(_, inFields) }
```
will do it.",47491958,2013-06-28 03:44:29
1654527,1825352,4930351,11,"Yes, we don't need this Boolean at all. Actually we don't even need a check here by using projectFields = projectFields.map { Fields.merge(_, inFields) } suggested by you.",47491958,2013-06-28 05:22:27
1658915,7111,5175095,44,return type.,48493209,2013-07-13 02:16:45
1658915,7111,5175058,36,return type on all public methods please.,48493209,2013-07-13 02:14:50
1663474,7111,4944395,219,"can we integrate these two approaches?

I guess we should make I transient too, and meatlocker that too?",47498345,2013-06-28 23:05:58
1663474,44018,4945143,219,"ah, for sure.",47498345,2013-06-28 23:33:37
1677023,7111,4977976,6,"Avoid the var unless really needed:
```scala
val extraInfo = (if(RichXHandler().handlers.exists(h => h(t))) {
  RichXHandler.mapping(t.getClass) + ""\n""
}
else {
  """"
}) +
  ""If you know what exactly caused this error, please consider contributing ",47582613,2013-07-02 10:25:14
1714340,7111,5072852,23,"you should get the Configuration from the Hdfs mode (call mode and pattern match).

If you are doing cascading local, this more tricky. For now, just through an exception I think.",48139959,2013-07-08 23:54:35
1714340,7111,5072865,24,Can we get a longer option: mapreducejob.input or something?,48139959,2013-07-08 23:55:08
1714340,7111,5072916,23,"actually, in local mode, this might just work, but you might want to get the Configuration is it is present, else make a new one.",48139959,2013-07-08 23:56:39
1714340,7111,42788170,33,"can we call this jobConf or something? Also, can we put a type or make it private?",329764265,2015-10-22 23:39:28
1714340,7111,42788047,25,"can we put this in it's own file? We have not been great about this in the past, but Job.scala is getting to be quite a mess.",329764265,2015-10-22 23:38:21
1714340,7111,42788355,31,"does this make sense? Are we really going to be able to run this in local mode? If not, perhaps we should sys.error here, or make `conf: Option[Configuration]`",329764265,2015-10-22 23:40:44
1714340,7111,42788537,81,don't see why we need this line.,329764265,2015-10-22 23:42:05
1714340,7111,42788896,69,totally blown away that this could work. How is the source plumbed through to the map-reduce job that knows nothing of our test mocking or cascading schemes/etc... Does this really work?,329764265,2015-10-22 23:44:51
1715346,7111,5072580,4,"we could add a scalding-colt package, but we can't make that a core dependency. We are actually trying to remove dependencies.",48147969,2013-07-08 23:44:52
1715346,808914,5073269,4,I can make changes as you see fit. I think adding a scalding-colt package is an overkill at this stage. Can implement Poisson random generator as shown on http://www.johndcook.com/blog/2010/06/14/generating-poisson-random-values/ and remove dependencies,48147969,2013-07-09 00:10:04
1715346,7111,5174999,10,do you mean sampleWithReplacement?  I am not sure what you mean by with return.,48336761,2013-07-13 02:11:37
1728535,1825352,4494190,22,"Since this function is just for TupleConverter, can we name it as asSuperConverter? asSuper() is too generic and seems is a method from a root class.",44241997,2013-06-03 10:54:02
1728535,1825352,4494192,9,Ditto. asSubSetter?,44241997,2013-06-03 10:54:09
1728535,1825352,4494195,48,override def?,44241997,2013-06-03 10:54:29
1728535,1825352,4494196,15,override def?,44241997,2013-06-03 10:54:33
1752389,7111,5123919,25,"minor nit: can you change these pattern matches to .foreach:
```scala
skipStrategy.foreach { flow.setFlowSkipStrategy(_) }
```",48280189,2013-07-11 00:03:16
1794154,44018,5272455,62,"Hey dude,

Can you help me with this?

scalac -classpath /tmp/maven/hadoop-core-0.20.2.jar:/tmp/maven/slf4j-log4j12-1.6.6.jar:/tmp/maven/log4j-1.2.15.jar:/tmp/maven/commons-httpclient-3.1.jar:/tmp/maven/commons-cli-1.2.jar:/tmp/maven/zookeeper-3.3.4.jar:/",50573570,2013-07-18 21:41:40
1794154,1825352,5277002,62,"Will do it later today. I don't have scala 2.9.3 on my computer right now, and I'm using scala 2.9.2 to build some stuff at this moment.",50573570,2013-07-19 00:39:32
1794154,44018,5273656,62,Can you try running the tutorial test locally from this branch?,50573570,2013-07-18 22:30:54
1794154,1825352,5272345,62,"0.8.5 -> 0.8.6. 
I should change this when releasing 0.8.5...",50573570,2013-07-18 21:36:14
1794154,1825352,5273460,62,"This is interesting. Tutorial0 is just about reading from and writing to a
TextLine source.
So shouldn't be the Tutorial itself, must be some setting issues I guess. I
will look into it more.


On Thu, Jul 18, 2013 at 9:42 AM, Sam Ritchie <notificat",50573570,2013-07-18 22:23:31
1828832,7111,5388387,17,can we put this in the typed package?,51699233,2013-07-25 05:27:33
1829443,44018,5388613,5,"I'd prefer to wait on:

https://github.com/twitter/scalding/pull/506/files

there's a weird build break, only on travis, with the tutorial. I think that reviewboard has a cleaner approach to the 2.9.3/2.9.2 dependency issue.",51706390,2013-07-25 05:42:03
1829443,7111,5388966,5,"Sure. This can wait on getting algebird up, but I think bijection needs to be done at the same time as this.",51706390,2013-07-25 06:07:51
1829443,44018,5388621,11,issue link?,51706390,2013-07-25 05:42:34
1829443,44018,5388648,5,"@reconditesea is messing with it now to fix the tutorial build break, but once that's done this comment applies.",51706390,2013-07-25 05:44:20
1829443,44018,5388616,39,this will break the 2.10 build.,51706390,2013-07-25 05:42:15
1829443,1825352,5389109,5,"https://github.com/twitter/scalding/pull/506/files is green now.
@johnynek Since both Sam and I made commits there, can you take a look and merge it if looks good to you?",51706390,2013-07-25 06:22:16
1836541,7111,5411642,1,Typo in the file name? ReducuceOperationsTest,51871401,2013-07-26 03:13:13
1836541,7111,5412076,71,"I seem to remember some issue when writing to Tsv with hadoop and non-primitive types. I seem to recall that it writes as string, reads it back in the testing, and the List winds up being a string.

What if you check to see if this is equal to `List[(St",51886659,2013-07-26 03:38:48
1837639,44018,5428871,86,Why not just make all of these call-by-name?,51935634,2013-07-26 23:07:52
1842142,7111,5436261,14,What the pain is in mixing immutable patterns with mutable ones. Also the type system of Java treats a lot of things as equal that are not equal in scala.,52063626,2013-07-27 06:00:29
1842142,33685,5430115,14,"I have tried that, but that does not compile:

[error] /tmp/code/scalding/scalding-core/src/main/scala/com/twitter/scalding/Job.scala:168: type mismatch;
[error]  found   : Seq[(AnyRef, AnyRef)]
[error]  required: Seq[(AnyRef, String)]
[error]       ",52063626,2013-07-26 23:54:32
1842142,7111,5427095,14,"Here is what you want:
```scala
import scala.collection.mutable.{Map => MMap}
import scala.collections.JavaConverters._

// At the end of the def config method:
val tempMap = MMap[AnyRef, String](config.toSeq :_*)
AppProps.addApplicationFramework(t",52063626,2013-07-26 21:50:32
1842142,33685,5426664,14,"the method has a side-effect: it stores the framework property back in the passed in map. Since the config map is not modifiable, I just made the copy. 

Since I am new to scala: How would I create a modifiable map, so that I don't get an exception, whe",52063626,2013-07-26 21:26:47
1842142,7111,5426506,14,"What do you intend to do here? Config is immutable, and I guess this is creating a Java HashMap from it (but:
```scala
import scala.collections.JavaConverters._
config.asJava
```
would be more canonical. But, in any case, the flow already got the con",52063626,2013-07-26 21:19:08
1861050,504461,5461195,52,That's a good idea. Not sure why I didn't have that anyway. Will add it. ,52806630,2013-07-30 01:48:22
1861050,7111,5461138,52,"do you want to have two more apply methods? One `(path: String)` implying `schema = None` and the other with `(path: String, schema: Schema)` implying `Some(schema)`?  ",52806630,2013-07-30 01:46:44
1905443,598255,5698943,5,We should also think about removing the last project. It's useful to have the other fields in some cases.,53195175,2013-08-11 04:47:15
1907617,7111,5700743,21,"I think this give a warning for unchecked types due to erasure in scala 2.9 at least. This might be warning free:
```scala
case Sum(l@Sum(_, _, _), r@Sum(_, _, _), _) => collectAddends(l) ++ collectAddends(r)
```",53210062,2013-08-11 23:32:16
1907617,7111,5700755,19,"can we refine this type: `List[Either[Product[R, C, V], MatrixLiteral[R, C, V]]]`

Is that right?  If that is not the case, then later down below, it is hard to see that we have really optimized everything.",53210062,2013-08-11 23:37:11
1907617,7111,5700758,45,"Can you comment here that `x` is never a Sum, (see my comment above about it being `Either[Product, MatrixLiteral]`) and since it is never a Sum, this call to toTypedPipe does not recurse, and we actually do have all the sums in one groupBy.",53210062,2013-08-11 23:38:58
1907617,7111,5719349,78,why special case this?  Why not just: `collectAddends(this).map { ...`,53496721,2013-08-13 00:44:51
1907617,7111,5719392,26,repeating yourself here. Lets sort by sizeHint and then either hashJoin OR join.  How does that sound?,53496721,2013-08-13 00:46:32
1907617,821979,5729423,26,"I distinguish between the smaller and bigger relation, and between join and HashJoin - plus doing the map, such that variables match ord2 for the groupBy.
Do you mean to drop  the smaller and bigger cases, and just do one.join(two) or one.hashJoin(two)?",53496721,2013-08-13 12:00:16
1907617,7111,5740658,26,"I mean:
```scala
val (smaller, larger, sSize, lSize) = if (sizeOne < sizeTwo) (one, two, sizeOne, sizeTwo) else (two, one, sizeTwo, sizeOne)
// now just write larger.join(smaller) or larger.hashJoin(smaller)
```
Don't repeat each branch for smaller a",53496721,2013-08-13 21:29:09
1907617,821979,5741986,26,"What happens with ord2? If I don't have branches for smaller / larger, the compiler infers it'll need Ordering[(Any, Any)]",53496721,2013-08-13 22:17:34
1907617,7111,5742990,26,Fair enough. Cleaning that up will be ugly.,53496721,2013-08-13 22:52:54
1922713,7111,5750422,6,monoid not ring here.,53336945,2013-08-14 02:57:15
1922713,821979,5750453,6,sumColVectors is Product which needs Ring?,53336945,2013-08-14 02:58:11
1922713,7111,5750534,6,"Okay, we can leave it for now, but mathematically all we are using in propagate is the monoid.",53336945,2013-08-14 03:00:50
1922713,7111,5751085,14,"not really sure why sumColVector is needed here.  I know it is needed for L2 normalization, but why here?

What are we gaining over just doing a groupBy the row and adding everything up with the Monoid?

We aren't getting any win in the scheduling her",53336946,2013-08-14 03:23:36
1922713,7111,5751121,132,can you comment this case?,53336946,2013-08-14 03:24:52
1922713,821979,5751374,14,"This is how it was done in the old API (sumColVectors but with Monoid, because it was not implemented as Product), but there is no gain, so I'll change it.",53336946,2013-08-14 03:38:58
1922713,7111,5766739,18,I think we should filter Monoid.zero,54332690,2013-08-14 20:36:42
1922713,7111,5766768,11,"Add a TODO: use size to check if we should hashJoin.

Also, we need to make that joining code pluggable.",54332690,2013-08-14 20:37:27
1922713,7111,5766786,24,"we want sparse matrices, so just filter the zeros.",54332690,2013-08-14 20:38:04
1922713,7111,5766831,85,add a TODO pull this into some MatrixJoiner like we did in the original API. It came up twice already.,54332690,2013-08-14 20:39:38
1922713,7111,5766905,18,"let's tighten this up:

```scala
.toTypedPipe.map { case (idx, _, v) => (idx, v) }
.write(TypedTsv[(Int,Double)](""prop-col""))
```",54332690,2013-08-14 20:42:04
1922713,7111,5766925,35,lets avoid going to the Pipe. Just write to a TypedTsv from the TypedPipe,54332690,2013-08-14 20:42:56
1922713,7111,5766955,50,"comment that this is the sparse representation, otherwise people will get confused.",54332690,2013-08-14 20:44:10
1922713,7111,5767117,34,"If the toTypedPipe on product is not a lazy val, I fear we are going to compute matL2Norm twice here. Once on the right, and once on the left.

Maybe not since matL2Norm is not lazy, but in general, should the toTypedPipe on all subclasses of Matrix2 be",54332690,2013-08-14 20:48:43
1922713,821979,5768154,35,"Could you give me a hint how one pulls values from it down below?
Before it was
.sink[(Int, Int, Double)](Tsv(""cosine"")) { ob => (...)

if I do: .sink(TypedTsv[(Int, Int, Double)](""sum"")) { ob => (...)
I get an error for ob - missing parameter type",54332690,2013-08-14 21:27:53
1922713,7111,5805588,102,Shouldn't this be calling .toOuterSum instead of doing it again here?,54332695,2013-08-16 05:37:25
1922713,7111,5805601,182,"no need of this here, tpipe is already materialized. Let's revert.",54332695,2013-08-16 05:38:35
1922713,7111,5805643,34,I don't think lazy does anything in this context. Can you tell me what your expectation is?,54332695,2013-08-16 05:41:44
1922713,7111,5805656,102,more specifically: let's move this better joining logic into toOuterSum and call toOuterSum here.,54332695,2013-08-16 05:42:33
1922713,7111,5805702,60,lazy val.,54332695,2013-08-16 05:46:04
1922713,7111,5805774,35,"I think:
```scala
.sink[(Int, Int, Double)](TypedTsv[(Int,Int,Double)]()) { ob => ...
```
Should work.",54332690,2013-08-16 05:51:43
1922713,821979,5812093,34,So that it is not materialized before the product with matD below is evaluated?,54332695,2013-08-16 16:44:50
1922713,7111,5827835,41,"since MatrixLiteral is not call-by-name, this forces the lazy.

But it is okay that code will only actually result in a hadoop operation if it is needed.",54332703,2013-08-17 06:29:41
1922768,7111,5753518,24,"no reason to run this test.  Just do something like:

```scala
  ""correctly compute sizeHint"" in {
    val j = new ColDiagonal(Args(""""))
    j.sizeHintTotal must be_==(100.0)
  }
```",53311883,2013-08-14 05:49:22
1922768,1312251,5754119,24,"That is what I was trying to ask, how to test for something inside a job without running the job. Thanks.
This looks much more succinct, but what do I need to pass as the args, it throws an exception for trying to find the Mode. I have tried a lot of dif",53311883,2013-08-14 06:33:03
1922768,7111,5766621,24,"Ahh, sorry. `new ColDiagonal(Mode.putMode(new TestMode(Map.empty), new Args("""")))`

We changed how that works in scalding 0.9.0 and I forgot.  Users usually don't need to set up the Mode like that.",53311883,2013-08-14 20:33:20
1929881,7111,5766480,12,"I don't like that this has defaults for everything as I think that well get confused with the above method for some users.

I think at least one parameter should not have a default, whichever you think is the most likely to be set by the user.

Also, ",53356761,2013-08-14 20:28:55
1929881,984324,5767794,12,"Thank you for the quick feedback. I will definitely add some more clear documentation and link to the Output object. Ill update the pull request asap.

I can change the implementation. However, I was trying to mirror cascading Debug functionality withou",53356761,2013-08-14 21:13:52
1929881,7111,8535950,68,"how about: `debug(fn: PipeDebug => PipeDebug): Pipe`

so you can do: `debug(_.toStdErr.withPrefix(""debug"").printTuplesEvery(20))` and you just call the function given with `PipeDebugOpts()`",78870060,2013-12-24 05:26:24
1929881,7111,8535953,17,this has been added by a later PR merged today. Can you resync with develop?,78870060,2013-12-24 05:26:46
1929881,7111,8545444,17,Let's move this to it's own file. It looks good and we might want to use it in TypedPipe.,79041062,2013-12-25 01:05:13
1929881,7111,8545451,15,"can we make this call your new version with the identity function: debug(identity) should do the same thing (or our identity is misconfigured, if you ask me).",79041062,2013-12-25 01:06:31
1929881,7111,8545456,31,can we verify and add a http link that the default constructor is doing the same as new Debug()?,79041062,2013-12-25 01:07:09
1929881,7111,8545468,50,"can you add an example code snippet to show how to config?
{{{ debug { _.toStdOut.printTuplesEvery(100) } }}} for instance. ",79041062,2013-12-25 01:08:46
1944960,7111,5858044,57,private maybe.,55895055,2013-08-20 05:13:22
1944960,7111,5858047,55,private.,55895055,2013-08-20 05:13:28
1944960,7111,5858054,105,think this function should just return TypedPipe. No need to wrap it with the matrix here.,55895055,2013-08-20 05:14:16
1944960,7111,5858061,125,looks like copy paste. Haven't we seen code like this before? Can we put it somewhere common (object Matrix2 for instance?),55895055,2013-08-20 05:15:12
1944960,7111,5858077,164,"you could take the implicit Mode and FlowDef in the constructor, but leave as error for now. Not 100% sure scalar as a special case of Matrix is right. Makes the product a pain, as you notice.",55895055,2013-08-20 05:16:37
1944960,7111,5858107,40,"lets use the ordering on R here to be sure.

filter Ordering.equiv(r, index) to be sure we are consistent.

Also, can you add getCol?",55895055,2013-08-20 05:18:37
1944960,7111,5877626,145,Nice work here.,56028593,2013-08-20 23:56:39
1944960,7111,5877682,150,"Add an issue: -(A * B) = ((-A) * (B)) = (A  * (-B)) likewise with #*#.  So, we can just call negate on the smaller of A or B (left or right). No need to materialize this into a TypedPipe yet.",56028593,2013-08-20 23:58:54
1958409,7111,5879592,6,"Can you more formally describe the product you are doing in standard doc strings `(/** */)` so they are picked up by scaladoc?

What it `[T]` in the parameter list?  Why is the column type of the second matrix `RowT` and not `Col2T` or something?

Can",56044653,2013-08-21 01:16:58
1958409,7111,5879760,6,"I think splitter should be: `(RowT) => (G, RowT)` where `G` is the group id type. Is that right? Then there is effectively a graph that is being used to only compute products where G values are equal, right?",56044653,2013-08-21 01:22:35
1958409,1312251,5880797,6,"I will use the standard doc strings.

I intended to actually use the T for the splitter, but forgot, I'll use it per your last advice.

The splitter is used to split the rows to groups and values. Since there is no way to add another dimension to the ",56044653,2013-08-21 01:59:58
1958409,7111,5932740,81,"can we order the Matrix the same as the BlockMatrix? `Matrix[GroupT, RowT, Map[ColT, ValT]]`",56265158,2013-08-22 23:33:13
1958409,7111,5932904,82,"`def *[RowT2](that: BlockMatrix[RowT2, GroupT, ColT1 ValT]): Matrix[RowT, RowT2, ValT]`
Also consider calling this `dotProd` because it is really a dot product on a higher dimensional Vector (a vector over G where each item in the vector is a Matrix).",56265158,2013-08-22 23:37:16
1963700,7111,5902120,52,"don't use HashMap, just use Map.",56233118,2013-08-21 22:28:26
1963700,7111,5902135,64,Use xor (^) which is a safer way to combine hashCodes. Don't use the parens.,56233118,2013-08-21 22:29:00
1963700,7111,5902252,100,"lets use a case match here:
```scala
expressions match {
   case Some(m) => m.get(this) match {
     case Some(pipe) => pipe
     case None => computePipe
   }
   case None => computePipe
}
```",56233118,2013-08-21 22:32:30
1963700,7111,5902298,52,"Can you comment the expressions more? It seems if we accidentally leave it out, we will destroy the memoization. Can you explain when it will be Some vs None?",56233118,2013-08-21 22:34:15
1963700,7111,5902316,135,don't you need to thread through the expressions?,56233118,2013-08-21 22:34:43
1963700,7111,5902417,45,Why not make sparsity a BigDecimal?,56233118,2013-08-21 22:37:49
1963700,7111,5902660,135,"I guess not, since I think the expressions are only used in the planning phase which is happening when toTypedPipe is called and a Matrix2 is rendered at a TypedPipe. Negate is never called as part of planning, so this should be okay.

In any case, we n",56233118,2013-08-21 22:44:49
1963700,7111,5902726,47,"Can we also test just G^k?  That should be different. With the new planning stuff, G^8 should be:
```g2 = G*G
  g4 = g2*g2
  g8 = g4*g4
```",56244748,2013-08-21 22:47:01
1963700,821979,5908844,45,Because it's between 0.0 and 1.0?,56233118,2013-08-22 01:58:23
1963700,7111,5931643,26,"this makes me really worried. Why are we explicitly planning here?  Why doesn't a naive recursion work:
```scala
def ^(power: Int)(implicit ev: =:=[R, C], ring: Ring[V]): Matrix2[R, R, V] = {
  assert(power > 0, ""exponent must be >= 1"")
  if(power == ",56399843,2013-08-22 22:59:25
1963700,7111,5931695,194,wrap this line after =,56399843,2013-08-22 23:01:02
1963700,7111,5931708,234,wrap this line after ++,56399843,2013-08-22 23:01:21
1963700,7111,5931917,262,"I prefer something like this:
```scala
  def *[R,C](that: Matrix2[R, C, V])(implicit ring: Ring[V]): Matrix2[R, C, V] = that match {
    case Product(left, right, _, _, _) =>
    case Hadamart(...
    case Sum(..
    case OneR(... // turn the scalar",56399843,2013-08-22 23:07:48
1963700,7111,5931949,279,let's rename this apply so we can do: Scalar2(4.0),56399843,2013-08-22 23:09:13
1963700,7111,5931979,50,need to add tests to the sizeHint laws for this.,56399843,2013-08-22 23:10:19
1963700,7111,5932003,45,that's fine.,56233118,2013-08-22 23:11:06
1963700,7111,5932028,75,"this is what I meant. If sparsity is BigDecimal, this conversion is not needed.",56399843,2013-08-22 23:11:41
1963700,7111,5932095,72,we should be calling optimize on `g^8`. I don't think we should make any contract on the unoptimized graphs.,56399843,2013-08-22 23:13:18
1963700,7111,5932136,71,"also need a check that

`(optimizedGraph8 == optimize(g * g * g * g * g * g * g * g)._2)`",56399843,2013-08-22 23:14:33
1963700,7111,5932193,106,"add some comments here. What is this equality? I don't think it sees that (A*B) * C == A * (B*C), for instance, so it is more limited. If they are equal here, they must be mathematically equal, but not the other way?",56399843,2013-08-22 23:16:38
1963700,7111,5932291,70,"add a TODO: reverse of this:
```scala
  // take a column and make it a matrix with a single value.
  def asCol[C2](c2: C2)(implicit ev: C =:= Unit): Matrix2[R, C2, V]
 // similar for asRow.
```",56399843,2013-08-22 23:19:24
1963700,7111,5932381,34,"write this as `J[Int, Int, Double]` and let the implicits do their job.",56399843,2013-08-22 23:22:11
1963700,7111,5932453,56,"need to do: `import Scalar2.from` because scala will not find a * method on 3.0, but won't know to check the Scalar for such a conversion. In the other direction, scala sees ` def *(s: Scalar2[V])` and checks Scalar2 for a conversion.",56399843,2013-08-22 23:24:56
1963700,821979,5933322,26,"Because if you have these same square matrices, the optimize produces a ""wrong"" plan, because it's indifferent in the cost.
I couldn't think of a simple way how to incorporate this special case -  one thing I tried in optimize was to find all duplicate p",56399843,2013-08-22 23:50:39
1963700,821979,5933775,75,"It'd still be needed unless there's some handy implicit I can import from somewhere - if I change double to BigDecimal and remove this conversion, it'll complain that sp isn't BigInt... i.e. I'll still need to convert BigInt (columns) to BigDecimal",56399843,2013-08-23 00:07:51
1963700,821979,5940861,26,"OK, I take it back - it was quite easy to incorporate it in optimize... but I had to change evaluate etc. in the optimization tests. Anyway, now it reflects Map/Reduce more in a way which is great.",56399843,2013-08-23 04:54:40
1963700,7111,5961430,220,Why is left here twice?,56494703,2013-08-24 02:15:38
1963700,7111,5961476,228,"can you comment on the cost you're putting on label.diff here? Is this a hueristic, or does it represent something directly measurable?

Again, why is left.sizeHint repeated?",56494703,2013-08-24 02:17:15
1963700,7111,5961506,59,Write this as Scalar2(3.0) otherwise apply is very generic.,56494703,2013-08-24 02:18:41
1963700,7111,5961625,29,"nice that the naive implementation works with optimization!

Please add a comment to that effect so people don't get nervous later.",56494703,2013-08-24 02:23:24
1963700,7111,5970288,78,use the ordering here. It is safer than equals.,56905502,2013-08-26 06:08:29
1963700,7111,5970356,217,"I think this method needs exactly the same signature as the trace method would have on the Matrix2 trait.

we don't need `=:=[R,C]` here, do we? With ev1, we know that we have:
`l: Matrix2[R, C, V] * r: Matrix2[C, R, V] = Matrix2[R, R, V]`

But the t",56905502,2013-08-26 06:27:17
1963700,7111,5970365,247,should just return Scalar. I think Computed is a detail users shouldn't be thinking of.,56905502,2013-08-26 06:27:58
1963700,7111,5970375,77,should just return Scalar. I think Computed is a detail users shouldn't be thinking of.,56905502,2013-08-26 06:28:52
1963700,7111,5970396,300,"this is a fine solution for now, but alternatively, we could imagine a `FunctionMatrix[R,C,V](fn: (R,C) => V)` and a Literal scalar is just: `FuctionMatrix[Unit, Unit, V]({ (_, _) => v })`

This might be a good TODO, don't do it in this pull req. We can",56905502,2013-08-26 06:31:58
1963700,7111,5970408,289,"TODO: add `+ (Scalar), * (Scalar) and - (Scalar)`",56905502,2013-08-26 06:32:56
1963700,7111,5970431,285,I seem to recall a `unary_-` or something operator. Perhaps we can add an method with that name to Matrix2 that calls negate,56905502,2013-08-26 06:37:10
1963700,7111,5982102,330,TODO: optimize sums of scalars like sums of matrices: only one M/R pass for the whole Sum (Not in this pull request).,56922136,2013-08-26 21:38:09
1978900,7111,5982804,17,I think I'd rather us just take `Set[String]` here.,56673997,2013-08-26 22:00:30
2002406,7111,6053757,3,also need this in Job.scala to set in the JobConf.,56762149,2013-08-29 11:38:50
2002406,7111,6072186,23,need to revert this before a publish.,57564985,2013-08-30 01:32:21
2007162,44018,6078335,60,"cut the comments, or add another test?",57554403,2013-08-30 07:05:53
2034935,7111,6133563,23,`ValuePipe[+T]`,57601239,2013-09-03 23:24:47
2034935,7111,6133583,23,val toPipe: `TypedPipe[T]` rather than inpipe,57601239,2013-09-03 23:25:36
2034935,7111,6133634,24,"`def fold[U,V](that: ValuePipe[U])(f: (T,U) => V): ValuePipe[V]` =",57601239,2013-09-03 23:27:13
2034935,7111,6133673,26,Add `def map` and `def filter`,57601239,2013-09-03 23:28:21
2034935,7111,6133700,21,"can we be sure there is exactly one value? How can we be sure there is not zero here?

It may be more like an option.",57601239,2013-09-03 23:29:00
2034935,1312251,6137988,21,"One way I thought addressing this issue is to allow creation of ValuePipes only from within the scalding package, and only reductions on groupAll will be ValuePipes.

Another way is somehow to assert the truthfulness of having a single element, but I do",57601239,2013-09-04 02:02:05
2034935,1312251,6138024,26,What should be the behavior of filter? Should we add filter with Scalar to the TypedPipe API?,57601239,2013-09-04 02:03:15
2034935,1312251,6138195,23,why val and not def?,57601239,2013-09-04 02:10:00
2034935,7111,6160148,21,"Even if you only create ValuePipes with scalding, how do you know the Pipe had anything in it to start?",57601239,2013-09-04 22:24:39
2034935,7111,6160240,23,I mean rename inpipe to `toPipe` so we can call: `ValuePipe.toPipe` and it looks like a method.,57601239,2013-09-04 22:27:43
2034935,1312251,6187035,21,"Since enforcing it basically means changing the type of it based on the runtime data, I don't know if it's possible. I think it would be fine if the behavior will be the same as the behavior of crossing a pipe with an empty pipe. Maybe we should just add ",57601239,2013-09-05 21:54:26
2034935,7111,6275517,22,"`def fold[T,U,V](l: ValuePipe[T], r: ValuePipe[U])(f: (T, U) => V): ValuePipe[V]`",57777325,2013-09-11 00:11:37
2034935,7111,6275606,24,"add:
```scala
  implicit def toPipe[V](v: ValuePipe[V]): TypedPipe[V] = v.toPipe
```",57777325,2013-09-11 00:14:24
2034935,7111,6275625,5,Add return type: `TypedPipe[V]`,57777325,2013-09-11 00:14:57
2034935,7111,6275653,8,"add return type, call it filterWithScalar.",57777325,2013-09-11 00:15:28
2034935,7111,6275882,33,"make this a trait:
```scala
sealed trait ValuePipe[+T] {
  def map[U](fn: T => U): ValuePipe[U]
  def toPipe: TypedPipe[T]
}
case class LiteralValue[T](value: T) extends ValuePipe[T] {
  def map[U](fn: T => U) = Literal(fn(value))
  lazy val toPip",57777325,2013-09-11 00:23:54
2034935,7111,6275898,2,Change the return type of TypedPipe.aggregate and TypedPipe.sum to be a ValuePipe,57777325,2013-09-11 00:24:40
2034935,7111,6275945,5,"a bit concerned as to what happens here if the ValuePipe is empty. What if you sum an empty pipe or totally filtered pipe?

Perdaps mapWithScalar should take `fn: (T, Option[U]) => V` and we can do a left hash join to implement this cross.  Thoughts?",57777325,2013-09-11 00:26:31
2034935,7111,6275957,8,"Same worry, should this be `(T, Option[U]) => Boolean`?",57777325,2013-09-11 00:27:00
2034935,1312251,6286473,5,"The only issue that I have with this api is that it might suggest to people that some of the lines will be Some while other will be None. In our case all of the lines will either be there or not. 

I think we would like mapWithScalar to have the followi",57777325,2013-09-11 10:59:05
2034935,1312251,6286766,33,Why is the need for a case match?,57777325,2013-09-11 11:33:30
2034935,1312251,6286796,8,"Same as the previous comment, I propose that the behavior of filtering with an empty value will be just returning the original pipe, i.e. not filtering out anything.",57777325,2013-09-11 11:36:09
2034935,7111,6298794,31,"you want: https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/typed/Grouped.scala#L186

leftHashJoin so this doesn't cause a MR step. Also, not that ugly, actually how cross is implemented.",58008645,2013-09-11 21:23:02
2034935,7111,6298862,31,"Also, I really don't like this return type, because it should really be: `Either[TypedPipe[T], TypedPipe[V]]` but we can't actually tell which until we see the data.

Either ALL items will be T, or all will be V.

I still think, `f: (T, Option[U]) => ",58008645,2013-09-11 21:25:06
2034935,7111,6298914,44,"write a `def leftCross[V](p: ValuePipe[V]): TypedPipe[(T, V)]` method and call it here. That method should use leftHashJoin.",58008645,2013-09-11 21:26:36
2034935,1312251,6305883,31,"Yeah, it was one of those ideas that seemed good late at night, but when I woke up it turned out to be not as good as I thought.
Will change it.",58008645,2013-09-12 01:28:36
2062460,7111,6201116,155,"this is in the wrong order. The fork needs to come before toPipe:
```scala
  val res = fork
  dest.writeFrom(res.toPipe[T](dest.sinkFields)(dest.setter))
  res
```",57662635,2013-09-06 09:57:25
2062460,7111,6201128,158,cast here to avoid the closure on ev.,57662635,2013-09-06 09:58:42
2062460,7111,6201132,160,cast here to avoid the closure on ev.,57662635,2013-09-06 09:58:55
2062460,7111,6202325,7,add a return type.,57662636,2013-09-06 12:09:03
2062460,7111,6202453,265,transient,57662636,2013-09-06 12:20:08
2062460,7111,6202459,226,transient,57662636,2013-09-06 12:20:32
2062460,7111,6213031,45,dumb.,57662636,2013-09-06 21:54:44
2062460,13840,6213070,45,It's like you're fighting with yourself in your own pull request. :) ,57662636,2013-09-06 21:55:54
2062460,44018,6221731,85,kill e@,57662624,2013-09-07 03:41:11
2087835,7111,6299087,37,"don't take a file name, can we take an output stream or the file? Let's loosen the coupling.",57937250,2013-09-11 21:32:59
2087835,7111,6299119,39,"can this be `Map[String, Any]`? Name for statsMap?",57937250,2013-09-11 21:34:19
2087835,7111,6299177,46,"can these be public methods on the Flow instead?

Not crazy about baking in JSON here.  Would rather return the map if we want a weakly typed stats reporting.

That said, I would actually prefer we make a case class to do this:

case class JobStats(",57937250,2013-09-11 21:36:20
2087835,7111,6299186,5,"let's use ""scalding.flowstats"". I think the scalding namespace is a better choice of prefix.",57937250,2013-09-11 21:36:55
2087835,504464,6301592,37,"sure. i was actually debating myself if it was worth the effort to use
hadoop filesystem so the output can go to HDFS (and in local mode resort to
normal File)


On Wed, Sep 11, 2013 at 12:33 PM, P. Oscar Boykin
<notifications@github.com>wrote:

>",57937250,2013-09-11 23:01:46
2087835,504464,6301624,46,"How do i make them methods on the Flow? Pimp the Flow?

You do mean on the Job? That makes sense to me.



On Wed, Sep 11, 2013 at 12:36 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/",57937250,2013-09-11 23:03:24
2087835,7111,6301910,46,"I meant that take Flow as the first arg, but yes, on the job works too I think.",57937250,2013-09-11 23:14:26
2101644,7111,6338561,5,can you remove MeatLocker here so we can be sure we got all the items?,58134910,2013-09-13 05:11:50
2101644,44018,6338596,5,"I had to use MeatLocker for the ""init"", actually, since there was no copy on Externalizer.",58134910,2013-09-13 05:13:36
2101644,7111,6338664,5,"okay, but can we make all the MeatLockers private and make a def initCopy?

So we can remove it later without binary pain.",58134910,2013-09-13 05:19:52
2101644,44018,6338771,5,done,58134910,2013-09-13 05:28:53
2110954,12202,6438638,1,add copyright headers,58256258,2013-09-18 21:36:15
2110954,12202,6438644,1,copyright headers please,58256258,2013-09-18 21:36:25
2110954,1008176,6439804,1,fixed and committed.,58256258,2013-09-18 22:15:54
2110954,7111,6439886,107,"this got changed in develop, I don't think this will compile, there is no Mode.mode.

You want something like Mode.putMode((m, args)) and you pass that to the Job, where m is the mode for the repl (which is loaded from that script file).",58256260,2013-09-18 22:18:32
2110954,7111,6439902,1,"this should be in another variable, like in the ShellPipe companion object. We got rid of the Mode static var.",58256260,2013-09-18 22:19:17
2110954,7111,6439936,32,let's name this Repl.  Implicits is a bit vague.,58256260,2013-09-18 22:20:15
2110954,7111,6439962,1,Actually put it in a var next to the flowDef in Implicits (or what we rename to Repl).,58256260,2013-09-18 22:21:04
2110954,7111,6440252,33,this does nothing in 0.9.0. The TupleConverters were made a typeclass and don't need special imports.,58256260,2013-09-18 22:32:04
2110954,1008176,6451237,32,I like ReplImplicits. I think if we name it repl people will go looking there for things they would actually find in the ScaldingShell object. Thoughts?,58256260,2013-09-19 05:47:19
2110954,7111,6451286,32,"sounds good to me.


On Wed, Sep 18, 2013 at 5:47 PM, Juliet Hougland
<notifications@github.com>wrote:

> In scalding-repl/src/main/scala/com/twitter/scalding/Implicits.scala:
>
> > +
> > +import cascading.flow.FlowDef
> > +import cascading.pipe",58256260,2013-09-19 05:51:47
2110954,7111,6469303,5,can this be added to you person sbt config instead? ~-/.sbt/plugins/idea.sbt for instance.,58224752,2013-09-19 23:42:33
2110954,7111,6469544,33,"Let's just explicitly pass the mode and not jump through these hoops that the reflection based Tool imposed.
```scala
private[scalding] def getJob(args: Args, override val mode: Mode): Job = new Job(args) {
```",58224752,2013-09-19 23:50:08
2110954,7111,6469551,44,"remove this, pass override val mode.",58224752,2013-09-19 23:50:22
2110954,7111,6469579,107,"replace with: `getJob(arg, mode).run` and just be explicit.",58224752,2013-09-19 23:51:23
2110954,1008176,6470267,5,"For sure. I'm new to sbt and have a few questions about plugins and how scalding likes to use them. So, the travis build is currently failing because of conflicting dependencies. In maven, I would use `mvn dependency:tree` to figure out what the conflict ",58224752,2013-09-20 00:12:32
2110954,44018,6470287,5,"bumping is fine, I like that one. This replaces the publish pgp with `publish-signed`.",58224752,2013-09-20 00:13:30
2110954,7111,6470336,5,you can also remove the pgp plugin. That really shouldn't be there since we handle publishing and have it locally installed.,58224752,2013-09-20 00:15:27
2110954,7111,6470362,33,ps: that override val is clearly insane.  I meant for it to be captured and used for the mode below.,58224752,2013-09-20 00:16:38
2110954,1008176,7775151,1,fixed :),58256258,2013-11-20 05:21:34
2124113,7111,6606167,33,"pull out the stuff on the right into:

private def defaultSeed: Long = System.identityHashCode(this) * 2654435761L ^ System.currentTimeMillis

so it is a bit more readable.",58306479,2013-09-26 21:44:47
2124113,7111,6606201,56,you should make a new MergedPipe here and call sample on the right and left. This will preserve empty and Iterable pipes.,58306479,2013-09-26 21:46:02
2134507,7111,6642863,58,this does not scale. Can we think of an algorithm that uses all the reducers?,58371025,2013-09-28 06:19:38
2134507,7111,6733178,50,"you can't do sortBy random, it is not stable.  You need to do something like:
```scala
lazy val rand = new Random(seed)
IterablePipe(iterable.map((rand.nextDouble, _)).toList.sortBy(_._1).take(size), fd, mode)
```",59025451,2013-10-03 06:33:21
2134507,7111,6733185,61,lazy val,59025451,2013-10-03 06:33:54
2134507,7111,6733190,65,"attach a random value V, then sort on the just the random part.",59025451,2013-10-03 06:34:36
2134507,7111,6733211,60,"add a comment: this assumes that each reducer gets more than, size, right?",59025451,2013-10-03 06:36:17
2134507,7111,6733245,65,"I can't help but think that something clever operation keeping track of the max of the random variable you have seen on the mapside could help you filter there without sending everything to the reducers.

Did you do a search for ""map/reduce reservoir sa",59025451,2013-10-03 06:39:35
2134507,44017,6733476,65,"Yeah, shouldn't this just be mapReduceMap where you map to (rand, V), reduce with TopK on rand, and then map again to drop the random value?",59025451,2013-10-03 07:05:44
2134507,7111,6733625,65,"@avibryant remember that discussion about reservoir sampling in Map/Reduce? We never found a scalable 1-pass exact algorithm did we?

As for topK with mapReduceMap, that is going to keep everything in memory while you sample, so that is going to be a pr",59025451,2013-10-03 07:22:22
2134507,44017,6733790,65,"Ah, it would keep O(k) in memory, yeah. Which could certainly be problematic.

I don't think there is a scalable 1-pass algorithm for large k. But I think a scalable 2 pass algorithm (which is easy) is still probably preferable in most cases to somethin",59025451,2013-10-03 07:45:11
2134507,1312251,6733894,65,"@johnynek One case for exact reservoir might be to initialize random centroids for k-means clustering. For this particular example using the TopK approach will suffice for most realistic use cases. 

Would you like me to reimplement the algorithm and ju",59025451,2013-10-03 07:59:01
2134507,1312251,6734553,60,There is no assumption on size here,59025451,2013-10-03 09:09:10
2179975,319889,6673179,67,"Spaces after ,'s in type specifiers ?",58646645,2013-10-01 03:13:35
2179975,319889,6673198,70,Is this comment really valid? the right hand side of a cross with an empty pipe is irrelevant?,58646645,2013-10-01 03:14:28
2179975,319889,6673237,99,is the return type for this needed? you removed from limit but kept for sample and debug?,58646645,2013-10-01 03:15:51
2179975,7111,6673379,99,Don't know. I removed it on override since the compiler would complain there. I guess I can make this override and remove the type.,58646645,2013-10-01 03:22:19
2179975,319889,6675551,25,"[B, C]",58665943,2013-10-01 05:19:00
2189426,504461,6724160,16,"As you noticed this doesn't work in 2.10 for some reason. I ran into the same with the avro source. Try changing to:
override def hdfsScheme = (new ParquetTupleScheme(fields)).asInstanceOf[Scheme[JobConf, RecordReader[_, _], OutputCollector[_, _], _, _]]",58879739,2013-10-02 23:38:57
2189426,46049,6724605,16,"Exactly! I've copied the fix from [LzoTraits](https://github.com/twitter/scalding/blob/12de4deb4976a3eb2e1ff0a5babeee9fc6fc01a3/scalding-commons/src/main/scala/com/twitter/scalding/commons/source/LzoTraits.scala#L66). See the commit bellow.
Thanks!",58879739,2013-10-02 23:53:59
2189426,89478,6745783,17,"How about making ParquetSource a trait? Since we have other kinds of sources in FileSource, like TimePathedSource.
ParquetSource could be only responsible for setting the schema and converter. Then the concrete source can extends either TimePathedSource ",59292700,2013-10-03 21:16:51
2189426,164018,6754191,16,"prefer generating the input as part of the test.
you can use ParquetWriter:
https://github.com/Parquet/parquet-mr/blob/master/parquet-hadoop/src/main/java/parquet/hadoop/ParquetWriter.java",59292700,2013-10-04 02:05:36
2189426,44017,8768350,30,"For Scalding 0.9, you should probably make this be TypedSource and TypedSink, and implement setter. Also, it would be nice to make it LocalTapSource.

(Looks good otherwise, though. We have nearly this exact class internally at Stripe).",68745559,2014-01-10 02:42:08
2189426,7111,9448681,24,"add `with TypedSink[T]` as Avi suggested, please.",86848381,2014-02-05 09:33:18
2189426,7111,9448764,24,"actually, can you make this a trait:
```scala
trait ParquetTBase[T] entends Mappable[T] with TypedSink[T] with LocalTap /* get the etsy tap for local mode */ {
  def manifest: Manifest[T] // subclasses do the implicit thing
  // rest of code here
}
",86848381,2014-02-05 09:37:23
2198567,319889,6745851,48,will this change have a breaking impact on users? ,58925831,2013-10-03 21:18:32
2198567,7111,6747639,48,"no, there is a default implementation in KeyedList that goes through sum.",58925831,2013-10-03 22:22:29
2202410,319889,6751254,5,"the current version doesn't really apply here. the old version didn't come from this repo, and as this is develop once this is released it will be on 0.9.0 with the other artifacts.",59046471,2013-10-04 00:14:47
2207311,44018,6802559,13,its,59078719,2013-10-07 21:42:00
2207311,1825352,6812552,13,Can you fix this typo and then we can merge this pull?,59078719,2013-10-08 03:33:16
2244046,7111,6907553,23,seem weird. Shouldn't their be a 1.1.2 version?,59394349,2013-10-11 09:04:31
2244046,918962,6918766,23,This is indeed a little strange. Hadoop-core is the artifact for the old versions (0.20.x or 1.x.x) of hadoop. Hadoop-common is a (partial) replacement for the newer versions of hadoop (such as 0.23.x or 2.x.x). Including **BOTH** at the same time doesn't,59394349,2013-10-11 20:51:03
2244046,2662540,6920831,23,hadoop-common 2.x.x is still in beta now,59394349,2013-10-11 22:14:33
2244046,918962,6921435,23,"My point was that hadoop-core 1.1.2 and hadoop-common 0.23.9 (0.23.9 is considered ""new implementation"" and pretty similar to 2.x.x) contain a lot of same classes with very different implementations, and some of them are incompatible.

I'm not exactly s",59394349,2013-10-11 22:36:33
2244046,504461,6921546,23,"Is it possible to pull this from the sbt deps automatically?  project/Build.scala has the current Hadoop version. 
",59394349,2013-10-11 22:40:31
2244046,2662540,6921772,23,"Are we comfortable with pulling in hadoop-common-2.x.x beta/alpha?


On Fri, Oct 11, 2013 at 10:36 AM, Sangjin Lee <notifications@github.com>wrote:

> In scripts/scald.rb:
>
> > @@ -33,10 +34,18 @@
> >      ""namespaces"" => { ""abj"" => ""com.twitter.",59394349,2013-10-11 22:48:34
2244046,504461,6921839,23,I don't think cascading supports this yet and my guess is that bad things will happen. ,59394349,2013-10-11 22:50:55
2244046,2662540,6921946,23,"we need hadoop-common, we can either go with the last stable release 0.23.9
or 2.x.x alpha/beta.


On Fri, Oct 11, 2013 at 10:51 AM, Chris Severs <notifications@github.com>wrote:

> In scripts/scald.rb:
>
> > @@ -33,10 +34,18 @@
> >      ""namespa",59394349,2013-10-11 22:54:46
2244046,918962,6922046,23,"I agree with @ccsevers. Cascading doesn't yet support hadoop 2.0, and by extension not 0.23.9 either. Again, 2.x.x and 0.23.9 are quite similar in this regard. I wasn't arguing for replacing 0.23.9 with 2.x.x. I was wondering why hadoop-common is needed.",59394349,2013-10-11 22:58:22
2244046,2662540,6922814,23,"Indeed. removed it.


On Fri, Oct 11, 2013 at 10:58 AM, Sangjin Lee <notifications@github.com>wrote:

> In scripts/scald.rb:
>
> > @@ -33,10 +34,18 @@
> >      ""namespaces"" => { ""abj"" => ""com.twitter.ads.batch.job"", ""s"" => ""com.twitter.scalding"" }",59394349,2013-10-11 23:26:43
2277580,44017,7033578,39,"Map[((String,String),Long] is a pretty awkward signature. I wonder if we'd be better off with Map[String,Long], and just use a period or something other character to separate the counter group and name.",64006576,2013-10-17 19:21:32
2277580,44017,7033740,39,"Are you sure this shouldn't be something like this instead:

````scala
pipe.incrementCounters{ t => Map((""myjob"" -> ""items""), 1L)} //doesn't change pipe
````",64006576,2013-10-17 19:25:48
2277580,44017,7033907,39,"I'd also like to see some versions for the common cases of counting the current stream or some subset of it... something like

````scala
pipe.incrementCounter(""myjob.items"") //increment by 1L for each item
pipe.incrementCounterWhere(""myjob.items""){t =",64006576,2013-10-17 19:30:13
2277580,7111,7040954,39,"Good comments. A couple of notes:

1) people seem to often use ""."" in the group. So I'm skeptical of "".""
2) What do you think of: Map(""one"" -> ""two"" -> 3L)? or some other enrichment? ""one"" / ""two"" -> 3L?",64006576,2013-10-17 22:59:10
2277580,7111,7041389,39,"If we did:
```scala
pipe.incrementCounters{ t => Map((""myjob"" -> ""items""), 1L)}
```
you have to keep making functions to extract the counter rather than doing the operation in a collect, flatMap, map, etc...",64006576,2013-10-17 23:10:53
2277580,44017,7041433,39,"How about just ""/"" inside the string? ""myjob/items""?

Alternatively (and my preference, I think), just ask for the counter name, and set the group to something like ""Scalding"". It's unclear to me why you really need the two levels of hierarchy.",64006576,2013-10-17 23:11:51
2277580,44017,7045102,39,"@johnynek true, and that form of incrementCounters can be trivially built from the other one, so I don't mind keeping the primitive you have here (but I would suggest the set of convenience methods I've described as well).",64006576,2013-10-18 01:00:35
2277580,7053,7050888,39,"I spoke with Oscar about this offline, but I would personally like more an API which is closer to ostrich. You have some global Counter object and you just call ```Counters.increment(""my_counter"")```.

Since this requires hooking into the flowDef, this ",64006576,2013-10-18 04:28:34
2282495,7111,7080187,4,let's put this where it is used: FileSource.,65551938,2013-10-19 23:54:10
2282495,7111,7080208,9,"let's add sinkMode to the test tap constructor. If given a FileSource, you can get the sinkMode from there.  Also, let's add two constructor methods to the object to make this easy.",65551938,2013-10-20 00:04:40
2321117,7111,7194107,8,please change to externalizer.,66803843,2013-10-24 22:07:40
2366047,7111,7414011,5,"we should not mix implicit and non implicit parameters.  Can you give an example of calling this without the default reducers?

I think it will look like:
```.distict(Ordering[T], 20)``` which looks a bit ugly to me.

I'd rather something like:
```s",68336312,2013-11-05 04:28:50
2366047,7111,7414168,5,"Also, I wonder if we should punt on this until we do a `HugeSet[T]` api:
```scala
trait HugeSet[+T] {
  def union[U>:T](that: HugeSet[U]): HugeSet[U]
  def intersection[U>:T](that: HugeSet[U]): HugeSet[U]
  def filter(fn: T => Boolean): HugeSet[T]
 ",68336312,2013-11-05 04:33:43
2366047,2848762,7415072,5,"I prefer to push this happen since it will make the usage clear and easy at
least for now.

Best,
Jenna Zhang
Software Engineer | Twitter, Inc
Follow me: @jenna_zz


On Mon, Nov 4, 2013 at 1:34 PM, P. Oscar Boykin <notifications@github.com>wrote:",68336312,2013-11-05 05:01:56
2375174,252230,7388822,38,these things seem to do the same thing -- is that true?,68543427,2013-11-03 03:21:30
2375174,252230,7388824,24,"i left this like this, so we can expose a flow method here if we wanted. I didn't see the use of it atm, so I didn't add it",68543427,2013-11-03 03:22:10
2375174,252230,7388833,13,I added this call to all operations that take a user-defined function and have a flowProcess. This might be overkill...,68543427,2013-11-03 03:23:33
2375174,7111,7416373,6,why not a val?,68910764,2013-11-05 05:42:45
2375174,7111,7416430,13,remove parens.,68910764,2013-11-05 05:45:26
2375174,7111,7416440,19,add a return type. I think it is Unit. Right?,68910764,2013-11-05 05:45:43
2375174,252230,7416458,6,artifact from previous iteration. will fix.,68910764,2013-11-05 05:46:24
2375174,252230,7416554,19,correct. it is Unit. will fix.,68910764,2013-11-05 05:49:43
2375174,252230,7416655,45,"are you ok with this?

I wanted to expose the flow in the JobTest to see if the counters were changed, but I found it hard to get the flow for all jobs, specifically because cascadeJob can have multiple flows and those flows are not exposed. Another opt",68910764,2013-11-05 05:52:46
2375174,7111,7416798,45,"Well, ideally we could take a `Seq[Flow[_]]` so we can do a similar thing for cascade.

How does that sound?",68910764,2013-11-05 05:56:45
2375174,252230,7417209,45,"that could probably work. it requires changing CascadeJob a little. something like this

https://gist.github.com/smarden1/7310874

But it also means that we won't be calling run anymore in JobTest. Which means that if other things are subclassing Casc",68910764,2013-11-05 06:12:33
2375174,7111,7441273,45,This is fine with me. Let's go for it.,68910764,2013-11-06 01:59:26
2375174,252230,7444052,45,k.,68910764,2013-11-06 03:17:09
2375174,148888,8921043,14,is this assertion supposed to be `_flowProcess.get != null`?? seems like `_flowProcess` can't be null.,68910764,2014-01-16 09:44:17
2431056,1123342,7579592,34,"Unfortunately, the debug output from the TypedPipe could come sometime after the println. Not sure how to improve that though.",70327138,2013-11-12 07:50:47
2431056,7111,7579621,13,"I think you want this inside a .map else it will run on the submitter, not where you intend.",70327138,2013-11-12 07:51:50
2431056,7111,7579626,33,put inside a .map.,70327138,2013-11-12 07:52:04
2431056,7111,7579631,24,inside .map,70327138,2013-11-12 07:52:11
2431056,7111,7579654,13,"of course, there is actually no way to trigger this remotely since map is a no-op on Empty....

I guess this is fine.",70327138,2013-11-12 07:53:17
2431056,1123342,7579882,33,Thank you for spotting that. It's now fixed.,70327138,2013-11-12 08:04:27
2594188,7053,8286269,5,Why not put these imports at the top?,74304117,2013-12-12 06:27:45
2597612,7111,8286586,5,"can we call field: ""path"" instead?",74327461,2013-12-12 06:39:51
2597612,7111,8286591,10,toString is unneeded.,74327461,2013-12-12 06:40:07
2597612,7111,8286657,12,"`Option(fs), path.tail`",74327461,2013-12-12 06:42:42
2597612,7111,8286782,6,"Let's change this to:
```scala
(path, node) match {
  case (_, None) => null
  case (h::Nil, Some(fs)) => fs.get(h).orNull
  case (h::tail, Some(fs)) => fs.get(h).map { m => nestedRetrieval(Some(m), tail) }.orNull
  case (Nil, _) => null
}

```",74327461,2013-12-12 06:47:44
2597612,69492,8291128,12,"The second match is required in the case of matching 'a.b.c' against {""a"": {""b"": 3} }. This case is covered in the test. Previously suggested map {}.orNull also broke tailrec.",74430056,2013-12-12 11:10:44
2626848,7111,8315484,7,"how is this different from args.required(key) (or maybe you want .optional):

https://github.com/Antwnis/scalding/blob/develop/scalding-args/src/main/scala/com/twitter/scalding/Args.scala?pr=%2Ftwitter%2Fscalding%2Fpull%2F719#L123",74567483,2013-12-13 04:30:49
2626848,7111,8315497,17,args.optional(key).getOrElse(default),74567483,2013-12-13 04:31:11
2626848,7111,8315609,23,"looks like this duplicates this functionality:

https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/filecache/DistributedCacheFile.scala#L51",74567483,2013-12-13 04:34:01
2644088,38128,8377959,6,"much cleaner to abstract/hide usage of .asInstanceOf - if it has to be used at all, than exposed as it was",77042658,2013-12-17 02:20:07
2644088,7111,8382926,6,"Sadly, since cascading drops the types, when we get to cascading, we have to cast. I think that is okay, since the users are always dealing with type safe code. None of the casts should ever fail, it is just that the compiler is not helping us prove that.",77042658,2013-12-17 04:34:47
2665842,115552,8532576,28,"technically you just need a mapper to deterministically come up with a seed -- it's ok for different mappers to have different seeds. But this is totally fine, too.",78954083,2013-12-24 02:05:21
2691832,7111,8534281,23,no need for the `{ }` since this is a one line expression.,78986237,2013-12-24 03:46:17
2691832,17050,8534306,23,"hehe I was actually thinking which style you guys like for 1-exp-methods, looked around and saw some {} so left it :-)

Roger that, I'm also all for skipping {} :+1: ",78986237,2013-12-24 03:47:24
2691832,7111,8534465,23,"Yeah, a lot of old code there. Prefer to avoid them is the style we adopted going forward.",78986237,2013-12-24 03:54:19
2719100,7053,8590304,25,Does it make sense to add an assertion that checks for this?,80059371,2013-12-31 02:45:43
2719100,7111,8590324,25,"cascading has those:

https://github.com/Cascading/cascading/blob/2.5/cascading-hadoop/src/main/shared/cascading/scheme/hadoop/WritableSequenceFile.java#L85",80059371,2013-12-31 02:46:38
2723647,7111,8594616,3,remove these?,80214583,2013-12-31 07:44:14
2723647,7111,8594620,1,add a copyright header.,80214583,2013-12-31 07:44:22
2723647,7111,8594628,141,don't need the vals in case classes.,80214583,2013-12-31 07:45:06
2723647,7111,8594652,17,"can you add a comment on how to specify a JDBCSource?  using the bigint(), etc... below?",80214583,2013-12-31 07:47:46
2723647,7111,8594661,1,can we put this in the scalding.jdbc package? (and directory)?,80214583,2013-12-31 07:48:27
2723647,7053,8595048,50,"Note that dbName is not used here, while we use it in the internal version from which this comes from. Maybe make this take a ConnectionSpec instead?",80219017,2013-12-31 08:36:45
2723647,7053,8595054,167,Nitpick: add a newline here,80219017,2013-12-31 08:37:17
2723647,7111,8595116,156,add a comment for the purpose of this (to create the DB).,80219017,2013-12-31 08:47:04
2723647,7111,8595124,69,"is there any reason for this to be final? can it instead be:
```scala
protected def driverFor(adapter: String): String = Map(...).apply(adapter) // but you can override
```",80219017,2013-12-31 08:48:56
2723647,7111,8595128,139,not sure this needs to be private. protected?,80219017,2013-12-31 08:49:29
2723647,1825352,8597113,139,"Makes sense. Do we also wanna change the internal version of this to protected? So that if people want to create JDBCScheme in another way in the subclass, they can do it?",80219017,2013-12-31 16:44:32
2723647,7111,8602603,130,"Why not make this:
```scala
val ConnectionSpec(uName, passwd, adapter, url) = currentConfig
```

and have currentConfig return not an Option? Put another way, why return on Option if it is a runtime error to return None?",80267602,2014-01-01 02:48:24
2723647,7111,8602613,52,skeptical that this should be Option rather than just the ConnectionSpec (see below).,80267602,2014-01-01 02:48:56
2723647,7111,8602624,32,should probably be case object since case classes should have parameters.,80267602,2014-01-01 02:49:35
2734235,1825352,8643107,35,Tiny comment: the parenthesis is not needed if no arguments.,80541916,2014-01-04 02:49:47
2734235,7111,8643326,35,+1,80541916,2014-01-04 02:57:54
2734235,1825352,8652748,18,"In Hadoop naming convention, should this be ""Scalding Custom""?",80541919,2014-01-05 02:26:30
2734235,7053,8653651,18,"Sure, will do.",80541919,2014-01-05 06:45:06
2734235,7111,8957790,48,"can we do:
if(flowProcess.isDefined) {
  //avoid a closure since this should be as low overhead as possible:
  flowProcess.get.increment(group, name, amount)
}
else {
  logger.error(""incrementing %s, %d, %s, but no FlowProcess"".format(name, amount, ",82317588,2014-01-17 12:44:26
2735274,13840,8653090,17,"Nice! Another alternative:

```scala
iters.collectFirst { case iter if iter.nonEmpty => iter.head }
```",80601776,2014-01-05 04:12:21
2735274,393209,8654209,4,Unused?,80533606,2014-01-05 10:39:49
2735274,393209,8654251,14,"I'm not sure why the indexing logic changes here from previous, shouldn't value position always be 1.",80533606,2014-01-05 10:54:17
2735274,7111,8654279,14,"previously, we were first mapping the tuple with two elements onto a tuple with one element, then getting it out. That is wasteful since we could just get it out from the second position.",80533606,2014-01-05 11:07:56
2735274,7111,8654433,14,"more precisely, line 35 here:

https://github.com/twitter/scalding/pull/734/files#diff-635a3e0989547560868086ab5f88207fL35

had the mapping, which is now removed.",80533606,2014-01-05 12:43:29
2735535,7111,8654499,178,should probably be `.iterator.map` to sure to be lazy.,80609725,2014-01-05 13:38:57
2735535,7111,8654507,75,"this is not really a self join, the mapside part in different because of the min/max. Need to fix that and assert that the self join is triggered.",80609725,2014-01-05 13:44:53
2735535,7053,8678558,1,Maybe rename this file to KeyedListLike.scala? It took me a while to find where this was defined.,80535312,2014-01-07 04:39:58
2735535,7111,8679009,131,crap... This code is never calling fn. Clearly we need a test on this.,80535312,2014-01-07 04:55:02
2735535,7111,8682227,1,Can we wait for the follow up refactoring that cleans up all these group-related classes?,80535312,2014-01-07 07:00:12
2735535,7053,8682693,1,Fair enough.,80535312,2014-01-07 07:20:28
2735535,164018,8734692,30,maybe add an import to just annotate @tailrec ?,80535311,2014-01-09 01:54:37
2735535,164018,8735265,174,possibly add the offending inputs to the message. That would help with debugging.,80535311,2014-01-09 02:11:22
2735535,164018,8735470,130,"This looks like the meat of the PR.
could you explain the part where self join is treated separately?
What's the constraint that forces 2 cases?",80535311,2014-01-09 02:17:19
2735535,7111,8840714,30,"this is actually pretty standard, and only used once in the file. Going to leave as is.",80535311,2014-01-14 04:14:25
2735535,7111,8840719,174,good call. Will do.,80535311,2014-01-14 04:14:32
2805323,7053,8882380,220,This looks like the default implementation of mapValues.,82911931,2014-01-15 07:16:18
2805323,7053,8882533,261,Maybe you don't need this either.,82911931,2014-01-15 07:21:58
2805323,7053,8882574,261,Also probably want to avoid creating a closure like you do below.,82911931,2014-01-15 07:23:31
2805323,7053,8882755,290,Maybe add a comment that colon is needed. Otherwise capture the method and return it?,82911931,2014-01-15 07:31:51
2805323,38527,8910054,18,odd wording,82911931,2014-01-16 03:06:17
2805323,38527,8910060,23,ibid,82911931,2014-01-16 03:06:23
2805323,38527,8910103,24,"The naming of HasReducers and WithReducers is a bit off to me.. perhaps FixedReducerCount and SettableReducerCount or something? Doesn't have to be that verbove but ""has"" vs ""with"" has nothing to do, to my ear, with a fixed vs variable reducer count.",82911931,2014-01-16 03:07:21
2805323,7111,8910168,24,"It is not fixed. It is more like: I can read a reducer count, or I can update a reducer count.

Settable worries me, because set sounds like mutation, which this is not (closer to the builder pattern here).",82911931,2014-01-16 03:09:10
2805323,38527,8954928,24,"Fair enough. I mean, you are consistent with the Has/With terminology in other places, so it's fine.",82911931,2014-01-17 08:30:22
2805323,319889,8955612,142,Why do we drop the value type info now?,82976333,2014-01-17 09:09:07
2805323,44017,8957058,21,Is anything ever CoGroupable but not HashJoinable or vice versa?,82976333,2014-01-17 11:29:34
2805323,7111,8957657,142,"it was coming in as _, and scala could not handle it with the param. The type is not needed, as the only real question is what is the tuple arity (2 in this case).",82976333,2014-01-17 12:28:08
2805323,7111,8957663,21,"CoGrouped is CoGroupable, but not HashJoinable, but I think everything that is HashJoinable is also CoGroupable.

So, we could, if it is of use, force HashJoinable extends CoGroupable. Thoughts on that?",82976333,2014-01-17 12:29:28
2805323,44017,8957931,21,"I think we should do that, yes, given how much we are otherwise trying to embody the semantics in the types.",82976333,2014-01-17 13:01:01
2805323,7111,8989227,21,"Agreed. Just made the change. Anything else, or can we merge?",82976333,2014-01-19 03:48:07
2838025,319889,9014995,15,"We've made some of these transitive before to be safe, worth doing it here too?",83965088,2014-01-21 02:18:41
2838025,319889,9015024,30,Is there any threading concern with these?,83965088,2014-01-21 02:19:32
2838025,7111,9017482,30,"There is a concern… but hadoop counters are thread safe, and we always set this var in the prepare method. We could not find another solution that was:

1) trivial cost to those not using it.
2) does not require new APIs for every function where we mig",83965088,2014-01-21 03:29:32
2838025,7111,9020411,15,Good point. Updated this.,83965088,2014-01-21 05:11:58
2868369,1825352,9170690,5,Is this an efficiency concern to avoid lambda (lamba in the comment is a typo?) but explicitly get resIter and interate on it?   ,84854072,2014-01-25 15:37:56
2868369,7111,9173075,5,"Yes. in the foreach, a function is called for each one. In this code there is no function call, it is inlined for sure. Normally I would not say this is a good way to code (since it is much easier to make a mistake in code like this). That said, if we get",84854072,2014-01-26 04:32:39
2881816,7053,9174008,17,Why define ```UniqueID``` inside ```Job```?,85284972,2014-01-26 09:02:38
2881816,319889,9174011,17,"The notion being its a piece of state te objects can pick up submitter side
to be used in th cluster later to find the rift flow process. The job also
sets fields in the job conf so it's a good way to add that state.

Any other place suitable ?

On ",85284972,2014-01-26 09:04:20
2881816,7053,9174015,17,"Nah sounds good, leave it there.",85284972,2014-01-26 09:05:12
2881816,7053,9174029,11,"Looking at the code, looks like you can still define a ```Stat``` within an anonymous function and still have everything work right? If so, why not keep the original API of ```Stats.increment(""counter.name"")``` or maybe something like ```Stats.for(""counte",85284972,2014-01-26 09:13:25
2881816,7053,9174030,11,So ```Stats.for``` would create the appropriate ```Stat```,85284972,2014-01-26 09:13:48
2881816,44017,9176516,51,"typo: ""scading""",85284972,2014-01-27 00:05:13
2881816,44017,9176518,27,"typo: ""scading""",85284972,2014-01-27 00:05:28
2881816,44017,9176525,11,"But you could just do ````Stat(""counter.name"").inc````",85284972,2014-01-27 00:08:17
2881816,44017,9176533,12,"Feels strange to have this on an individual Stat object, since it does the same thing no matter what the name and group of the stat are. ",85284972,2014-01-27 00:10:28
2881816,319889,9177342,12,I was just transferring the logic really. Having it on a global doesn't really work. If it doesn't feel natural here I guess we need to remove the function entirely?,85284972,2014-01-27 03:38:38
2881816,319889,9177344,51,fixed,85284972,2014-01-27 03:38:43
2881816,44017,9177808,12,Could we add it to Job?,85284972,2014-01-27 05:04:05
2881816,319889,9178286,12,"Job would need to do some similar tricks to get the flow process too right?

If its not part of the stats and it doesn't fit there anymore I think I'd
rather we address it in another PR and remove it for now?


On Sun, Jan 26, 2014 at 2:04 PM, avibr",85284972,2014-01-27 06:38:55
2881816,44017,9178323,12,"Well, sure, but given that the Job has the uniqueId already it would just be ````RuntimeStats.getFlowProcessForUniqueId(uniqueId)````, same as here.

Fine with me to make it a separate PR though.",85284972,2014-01-27 06:49:04
2881816,7111,9213514,11,would prefer incBy,85512952,2014-01-28 07:48:14
2881816,7111,9213522,13,prefer inc. Is this copying some storm jank?,85512952,2014-01-28 07:48:30
2881816,7111,9213540,25,worried about a memleak here. Can we use a WeakHashMap protected with a mutex?,85512952,2014-01-28 07:49:02
2881816,319889,9213609,25,"We can, what scenario are you thinking memory leak?",85512952,2014-01-28 07:51:48
2881816,319889,9213617,13,"Its copying something we had somewhere else, dunno where. Don't care which one it is really, will change to inc + incBy",85512952,2014-01-28 07:52:07
2881816,7111,9213632,54,"do we really need this? This is what was causing the problem. Why not just add a hook to the job to process the Flow after it was run, and call .getStats on the flow.  Then we can remove all these global variables.",85512952,2014-01-28 07:52:57
2881816,319889,9213797,54,"No idea how people want these maintained. The other part with the ConcurrentHashMap/WeakHashMap seems hard to avoid. These however I've not really thought about in any serious way. 

(The problem before I believe is that the closures were reporting to o",85512952,2014-01-28 08:00:09
2881816,7111,9215222,17,"One issue with this is that inner classes capture references to their outer. In this case, that is needless, but the scala compiler does it anyway. This may complicate serialization of UnqueID if that ever needs to happen.",85284972,2014-01-28 09:08:28
2881816,7111,9215251,33,"I am nervous about this tight coupling here to Job. Despite appearances, Job is not needed. In summingbird, we don't use it, for instance.

So, I wonder how we will use Stats in summingbird? I guess we will have the to replicate this step.",86861266,2014-01-28 09:10:01
2881816,7111,9215262,7,is this ever used?,86861266,2014-01-28 09:10:52
2881816,7111,9215286,39,can we share a constant somewhere to not type this twice?,86861266,2014-01-28 09:12:18
2881816,319889,9215292,17,Good spot. While currently they shouldn't need to be serialized. No reason not to move it to a safer spot,85284972,2014-01-28 09:12:48
2881816,7111,9215306,54,I actually think these were the guys causing the problem this PR is addressing. I think the bug can be fixed by just removing these variables and getting the stats from the flow created by the Job.,85512952,2014-01-28 09:13:42
2881816,7111,9319544,50,"can we guard this on null? This will be called on all jobs, and people that do not start a job with scalding.Job (like summingbird), may get an exception here.",86848552,2014-01-31 02:32:08
2887488,7111,9198889,26,"Can we use a type that does not extend function here? When you have an implicit function in scope, it can be used for implicit conversions, which will give K all the methods of Array[Byte] (there are a lot: http://www.scala-lang.org/api/current/index.html",85718338,2014-01-28 01:16:12
2887488,7111,9199297,26,added: https://github.com/twitter/bijection/issues/158,85718338,2014-01-28 01:25:58
2887488,7111,9199320,32,private where possible?,85718338,2014-01-28 01:26:22
2887488,7111,9199442,52,you could remove this by adding a SkethJoinedWithRed and make that the one that has .toTypedPipe.  Make this extends `WithReducers[SketchJoinedWithRed[….]]`,85718338,2014-01-28 01:29:16
2887488,7111,9199524,58,private?,85718338,2014-01-28 01:31:09
2887488,7111,9199570,61,what if totalCount < numReducers? Want to add 1?,85718338,2014-01-28 01:32:03
2887488,7111,9199860,62,"Can you add some comments around the following cases:

1) if the cms.freq == 0, we don't send to reducers.
2) if the cms.freq < maxPerReducer we still send something (the ceil.toInt seems to do this, but a comment will help).",85718338,2014-01-28 01:38:14
2887488,7111,9199940,69,"we have to seed these. Due to map/reduce restarts, a bug can be introduced if the same job runs twice but buckets the output differently (or so Dmitiry was fairly convinced, and I have not yet bothered to write a clear proof of that, but it seems to cost ",85718338,2014-01-28 01:39:48
2887488,44017,9200001,26,"I was just copying what SketchMap did. It seems like importing bijection provides something this can use for String, at least, though TBH I'm not sure exactly what's going on there. I'm +1 on an explicit Encoder typeclass though, and I think having Scaldi",85718338,2014-01-28 01:41:06
2887488,44017,9200087,52,"Trading a clear runtime error for an opaque compile time one. *Probably* worth it.

Is there any good way to get at the default number of reducers for the job? If not, should there be?",85718338,2014-01-28 01:42:57
2887488,44017,9200097,61,"Good catch, thanks.",85718338,2014-01-28 01:43:10
2887488,44017,9200111,4,"Should we include a zero-arg version, for convenience? Otherwise you need to always do ````sketch()````",85718338,2014-01-28 01:43:39
2887488,44017,9200724,52,"Alternatively, should reducers just be a required arg when creating the Sketched object in the first place? I like using withReducers for consistency with the rest of the API but it's not required there and it is here.",85718338,2014-01-28 01:57:10
2887488,44017,9200771,26,"... BTW since really this is about hashing, it could also be an argument for a Hashable typeclass in scalding, which I know has come up before.",85718338,2014-01-28 01:58:17
2887488,7111,9200983,26,"That is probably cleaner, or Hashable in Algebird.

There was a proposal, but I could never get something looked really good. Something like:

```scala
trait Hashable32[K] {
  def hash(k: K): Int
}

trait Hashable64[K] extends Hashable32[K] {
  ",85718338,2014-01-28 02:03:51
2887488,7111,9201021,52,"Yes, that might be a good idea. You can't set the constants correctly without.",85718338,2014-01-28 02:04:48
2887488,44017,9201141,26,"That looks pretty good, though I might use hash64 and hash128 for the method names, for consistency with the trait names?

So... does this go in algebird or in bijection?",85718338,2014-01-28 02:07:56
2887488,7111,9211975,4,"Sure, but question: Should this be in an enrichment rather than adding the method to TypedPipe? I am wondering how to draw the line of what we add to TypedPipe.",85718338,2014-01-28 06:52:40
2887488,44017,9212021,4,"I think anything we accept into scalding-core should go on TypedPipe. From a discoverability point of view I think we want a small number of very rich APIs, not stuff scattered around everywhere.",85718338,2014-01-28 06:54:07
2887488,7111,9213324,26,I guess algebird.  algebird-hash? and then depend on that in algebird-core?,85718338,2014-01-28 07:39:23
2887488,7111,9214858,58,this V parameter is confusing since there is also a V on the class. Are they distinct? I think so. Can you make this W or something not used in the class?,85718341,2014-01-28 08:49:16
2887488,44017,9216560,26,"Sounds right. Do we want to block this PR on that? My vote is that we get this into 0.9.0 as is (once I've addressed other feedback), then try to do algebird-hash ""right"" for the next round of releases.",85718338,2014-01-28 10:28:31
2887488,319889,9216699,4,"Why all into one class, rather than an enrichment pattern? Having a CMS joiner is very powerful, but hard to call it 'core' to a typed pipe?",85718338,2014-01-28 10:37:55
2887488,44017,9217176,4,"So, my feeling is this: it's hard to dispute that joins are core; almost anyone using joins is going to run into problems with skew at some point, and ask how to solve that; having a good answer for that seems pretty fundamental.

In the very earliest d",85718338,2014-01-28 11:09:49
2887488,7111,9217644,26,Nope. Let's get this in with `(K => Array[Byte])` and fix all later.,85718338,2014-01-28 11:55:28
2887488,7111,9217663,33,"type on all public methods, otherwise binary compatibility is difficult.
`hash(k: K): Long`",85718341,2014-01-28 11:57:48
2887488,7111,9217681,36,`lazy val sketch: TypedPipe[CountMin]` or make it private.,85718341,2014-01-28 11:59:29
2887488,7111,9217738,71,"`toTypedPipe: TypedPipe[(K, R)]`",85718341,2014-01-28 12:05:53
2887488,7111,9217788,6,"can you comment on the eps/delta choice? Since we are dealing with map/reduce, it makes little sense to default to computing a small CMS. I think defaulting to something like 10MB should be done. Otherwise, the overhead to computing the CMS overwhelms the",85718341,2014-01-28 12:10:38
2887488,44017,9218666,6,"Well, I didn't give it a ton of thought because even a crappy small CMS makes such an incredible difference; the main thing is to reliably identify the large keys without including *too* many of the small keys, and it doesn't take much to do that.

10MB",85718341,2014-01-28 13:26:16
2887488,7111,9281425,56,"dist is unused for now, right?",85718344,2014-01-30 02:53:02
2887488,7111,9281550,56,I don't think it is super essential that we use dist. We could just run tests whece size ~ max and where max << size (so we can expect keys to be repeated many times).,85718344,2014-01-30 02:55:39
2887488,7111,9316904,71,why toList here?,85826320,2014-01-31 01:33:21
2887488,7111,9316983,6,"this delta is really small and somewhat increases runtime due to extra hashing. I'd rather have more eps and have a better shot at seeing zeros. Holding size constant, can we trade delta for a bit of eps?",85826320,2014-01-31 01:35:26
2887488,7111,9316997,6,"also, can you add in the comment the number of hashes and the size of the output?",85826320,2014-01-31 01:35:55
2887488,44017,9317900,71,"Good catch, this was needed at one point but no longer.",85826320,2014-01-31 01:54:40
2887488,44017,9318366,6,"Ok, done. We should probably do some empirical measurement of different parameters and how they affect runtime and accuracy, but easy to tweak the defaults later.",85826320,2014-01-31 02:05:42
2894300,7111,9281658,8,"I think this class is gone in 2.10, and causing the tests to fail there.",85718693,2014-01-30 02:58:10
2905405,44017,9329907,2,you might want to update this string to more accurately match what the test does now,86040842,2014-01-31 07:13:37
2931046,7111,9432481,43,"looks like PathFilter is basically `(Path) => Boolean`. Might be nice to have combinators on those: (x.and(y), x.or(y), x.not, x.xor(y))…. but I just love combinators.",86861391,2014-02-05 01:40:00
2931046,7111,9432521,63,this is getting at least one successfile. The previous use was to check every path.,86861391,2014-02-05 01:41:31
2931046,7111,9432736,56,"this method is repeated below (DRY).
Let's take the `(glob: String, filter: PathFilter, conf: Configuration) => Boolean` out.

In fact, why not:
```scala
  def glob(glob: String, conf: Configuration, path: PathFilter = AcceptAll): Iterable[FileStatus",86861391,2014-02-05 01:46:48
2931046,7111,9432830,127,"```scala
glob(p, conf).size == glob(p, conf, HiddenFileFilter.and(SuccessFileFilter)).size
```",86861391,2014-02-05 01:49:08
2931046,622449,9439412,63,"I don't think that was the previous behavior unless I'm reading this wrong, but was that the intent?

Looking at line 251 below the old behavior was (paraphrasing):
globStatus(path).exists { x => x.name == ""_SUCCESS"" } // so looking for at least one fi",86861391,2014-02-05 04:23:22
2931046,622449,9439437,43,*rolls up sleeves* one batch of combinators coming right up,86861391,2014-02-05 04:23:55
2931046,622449,9446475,127,"I don't think this is going to work.
I want to make sure there are 1) files that aren't hidden and 2) a hidden file name _SUCCESS. So HiddenFileFilter and SuccessFileFilter are exclusive of each other. I'm not && the filters together, I'm && the result o",86861391,2014-02-05 07:51:01
2931046,7111,9482818,43,:),86861391,2014-02-06 05:58:15
2931046,7111,9483099,127,"You're right. This was a weak check in the past. Tend to think we should make it stricter now, but I guess we can punt on that and just get 0.9.0 out.",86861391,2014-02-06 06:04:43
2959490,7111,9549715,34,"my name is Boykin. no ""s"".",87553971,2014-02-08 01:42:15
2959490,7111,9549797,34,"should we have `override val fields: Fields = Fields.ALL` to keep the default being get all the fields?

If not, should we make `def fields: Fields` abstract and be more consistent?

I actually prefer the second: users should explicitly declare the fi",87553971,2014-02-08 01:45:15
2959490,7111,9549898,9,"can you add this same approach in `object ParquetTupleSource`? I think that is nice for users:

`ParquetTupleSource(('age, 'name), Seq(""path1"", ""path2""))` should work. ",87553971,2014-02-08 01:47:39
2959490,7111,9549916,44,can we add multi path versions where we take Seq[String].,87553971,2014-02-08 01:48:05
2959490,89478,9551408,9,But the user is not be able to use mappable in this case. Since they have to extend the class to use mappable.,87553971,2014-02-08 02:27:46
2959490,89478,9551483,34,I agree,87553971,2014-02-08 02:29:21
2959490,89478,9555836,9,"Added, merge?",87553971,2014-02-08 04:27:02
2959967,7111,9553154,42,hadoop version here.,87643315,2014-02-08 03:07:04
2985136,7111,9574176,4,"can you talk a bit more about the use cases here?  I am concerned that this is not easy to reason about since it happens on the mappers. On the reducers, it makes more sense, as you have all the values for a particular key.

I am not inclined to add thi",88460751,2014-02-10 11:52:25
2987649,7111,9607499,5,"this is not the way to fix it. This implies that TypedSink API is broken in VersionedKeyValSource.

I think we need to fix that API or remove it there. We should not hack around it.",88501506,2014-02-11 06:26:44
2987649,7111,9607631,5,"I think if we put `override def sinkFields = Fields(""key"", ""value"")` in VersionedKeyValSource it should work.

",88501506,2014-02-11 06:30:31
2987649,7111,9609378,52,pretty weak test. We are not checking that the values are actually added here.,88501501,2014-02-11 07:33:20
2987649,319889,9609541,52,"Yeah just something to get it off the ground, it caught the other errors before. Not sure how to give a store in scalding tests a previous value? ",88501501,2014-02-11 07:40:42
2987649,7111,9609630,52,good point. The writing is the main thing here.,88501501,2014-02-11 07:44:56
3022062,7111,9761127,42,"do we not need this part anymore? This code has so many little nooks and crannies, I lost track.",88914919,2014-02-15 02:45:21
3022062,7111,9761160,72,"how does that hadoop-lzo get installed? Looks a bit suspect. Obviously, it was always there. I guess java ignores missing files?",88914919,2014-02-15 02:46:04
3022062,590407,9765488,72,"I know nothing of the history of that element on the HADOOP_CLASSPATH.  I
left it there assuming that someone, somewhere knew why it was there.

I know that with e.g. CDH4, that is not the correct location.

The Java system definitely ignores missing elem",88914919,2014-02-15 04:52:21
3022062,590407,9765740,42,"If one builds scalding with ./sbt (which selects sbt 0.13; which is also
stated to be required by scalding), then the code in scald.rb which
attempts to find a compiler in ~/.sbt/0.12 seems no longer needed.

Sorry I batched it in there.  I cherry picked ",88914919,2014-02-15 05:00:16
3149354,7111,10220519,12,please put a type on any public val/def that is not an override.,93028346,2014-03-04 00:57:36
3149354,7111,10220554,22,please put a type on public vals.,93028346,2014-03-04 00:58:27
3149354,7111,10220595,12,"Also, can you add in the comment what the default charset is?",93028346,2014-03-04 00:59:14
3222581,38527,10462615,10,"is this a pattern we want to generally promote? I like this refactor and don't want to bog you down in this stuff, but it seems weird to curry this for the user. why not mapping(x: Class): String, and do mapping _ if we want to invoke the implicit later? ",94786520,2014-03-11 11:56:35
3222581,7111,10462644,10,"It's a jank house. But I let it slide on the initial review. I'm 99% sure this code is not being used anywhere except in Tool where the outermost exception is caught. I'll remove if you like.

I just want to fix the issue where we point to InvocationExc",94786520,2014-03-11 11:59:03
3222581,38527,10462693,10,"Cool. How about we open an issue to refactor this stuff and move on. In the future might be nice to also have a handler for serialization issues, for example.",94786520,2014-03-11 12:02:41
3248757,46049,11096717,29,"Thanks for the idea. I forgot that I can use ordinals of fields.
Changing ```flatMapTo('BidRequest -> 'outField)``` to ```flatMapTo(0 -> 'outField)``` makes it possible to use JobTest with PackedAvroSource.

Unfortunately mocking PackedAvroSource in Jo",96074199,2014-03-30 10:00:00
3249167,7111,10592939,51,"We can wrap it with LocalTap in FileSource, but I doubt it will work correctly due to the magic under the covers.",96087137,2014-03-14 06:33:52
3249167,622449,10592989,51,"Let me send you a quick PR removing the TODO then, thanks.",96087137,2014-03-14 06:35:53
3304311,1825352,10819974,8,"Can we return a TypedPipe[(U, T)] here? I'm thinking if user is calling distinctBy, he/she probably is interested in using the distinct key later.",97818252,2014-03-21 04:28:19
3304311,319889,10820198,8,"We can, its obviously pretty trivial, I do explictly remove it. It does seem like its not really obviously in the contract though? 
the similar F# function would take the view it should go from T => T: http://msdn.microsoft.com/en-us/library/ee340464.asp",97818252,2014-03-21 04:35:33
3304311,7111,10820597,8,"can we call this with, e.g.: `.distinctBy( _ % 2)` I would think we need trailing `()` for the default second block.
",97816000,2014-03-21 04:46:15
3304311,319889,10820664,8,"I changed it from that signature for that reason, its now the last parameter of the first block with a default value. So you can call it like .distinctBy(_._2)",97816000,2014-03-21 04:47:49
3304311,7111,10820719,8,"I think distinctBy should be like sortBy, and not return the U, we are uniquing on. If you need that, do:
```scala
pipe.map { t => (fn(t), t) }.distinct
```",97818252,2014-03-21 04:49:13
3304311,7111,10820968,21,"can you strengthen this? you need either: `Set((0,1), (2.2), (2,5))` or `Set((1,1), (2.2), (2,5))`",97818252,2014-03-21 04:56:11
3304311,7111,10821013,8,"no, I was wrong. you would need: `pipe.map { t => (fn(t), t) }.group.head`",97818252,2014-03-21 04:57:25
3304311,1825352,10821118,8,"Ok, makes sense to me.",97818252,2014-03-21 05:00:14
3304311,319889,10821199,21,"Sure, can do",97818252,2014-03-21 05:02:26
3333355,7111,10918714,66,this should probably be called withInNorm to distinguish the total in-degree weight of a node from the total out-degree weight of the node.,98760638,2014-03-25 12:19:29
3333355,7111,10918739,32,"can we add: `def reverse: Edge[N, E]` which swaps from and to. This will make it easier to reverse graphs to reuse the similarity code. ",98760638,2014-03-25 12:20:59
3333355,7111,10918751,38,I don't think weight or norm need val. It is public due to case class. InDegree needs it to override degree.,98760638,2014-03-25 12:21:46
3333355,319889,10945683,54,Vertices rather than edges right?,98816873,2014-03-26 00:29:44
3333355,1825352,10951027,54,"Correct, will change this.",98816873,2014-03-26 02:17:45
3339702,7111,10944208,19,what is this?,98934587,2014-03-26 00:02:08
3339702,7111,10944307,18,indentation is off here. Right? Should be indented with val on 197?,98935049,2014-03-26 00:04:14
3339702,319889,10944393,18,"Yep it is, fixed",98935049,2014-03-26 00:05:59
3386091,319889,11233110,34,Was this same code anywhere else/ something we should maybe test?,100018963,2014-04-03 04:15:38
3386091,38527,11233153,34,"Yes, this is the only thing I was wondering as well. I feel like this is important enough that assuming it looks good (which it seems to), we should push this out and cut a 0.9.1, but it would be good to test for this sort of thing. We know the MR structu",100018963,2014-04-03 04:17:00
3386091,7111,11233188,34,"it is tested by any code that does mapValues + sum (.toList, .size, .toSet) .size is very common in the tests.",100018963,2014-04-03 04:18:17
3386091,7111,11233304,34,A test that .groupAll.size communicates at most M tuples where M are the number of map-tasks would be good. Might be possible with checking the counters after the job.,100018963,2014-04-03 04:22:07
3423324,44017,11326698,25,Shouldn't we have a test that has multiple operations with errors after the same trap?,101503751,2014-04-06 20:40:52
3423324,38527,11327114,25,"Absolutely, I will add that test next. For now, I want to figure out why adding multiple traps is making cascading freak out. The pipes should be different, the names are different.",101503751,2014-04-06 22:25:07
3423324,7111,11330463,7,"I don't think you need the conv, do you?",101503751,2014-04-07 08:27:32
3423324,7111,11330485,9,"couldn't we keep the result of the fork, use one branch on the addTrap?",101503751,2014-04-07 08:29:12
3423324,7111,11330492,10,"an issue may be that we need to add a new name to the pipe every time we add a trap. Renaming does not often come up, but see for instance merge. I think in the case of multiple traps on the same Pipe we are going to have name collisions (just a guess, th",101503751,2014-04-07 08:30:33
3423324,7111,11330496,11,would really like to find a way to avoid the TupleConverter here.,101503751,2014-04-07 08:30:51
3423324,38527,11331360,10,"Hmm, I see. This is a bit confusing, so I'll look at the merge code to see how cascading deals with this.",101503751,2014-04-07 10:08:16
3423324,38527,11331426,11,"Well, this comment will respond to a couple of the above.

First, I question how efficient we need to make addTrap. Isn't this technically an anti pattern? That is to say, if you're swallowing errors, something is going wrong. This is the intention in t",101503751,2014-04-07 10:13:27
3459061,319889,11443455,6,"Why change to WS, this looks off in spacing now?",102385236,2014-04-09 21:07:30
3459061,319889,11443507,15,"Why add a new field and not just refer to the job.name, its not very long. Would we expect to need to override the name for the test independent of the Job?",102385236,2014-04-09 21:08:25
3459061,33685,11443637,6,left over from an earlier try. will clean it up.,102385236,2014-04-09 21:10:42
3459061,33685,11443654,15,"alright, will remove that one",102385236,2014-04-09 21:10:54
3459061,7111,11448736,4,"I am a bit concerned about cruft here. Will this start polluting all users with these paths on every run?

Can we not check an environmental variable and only do this if some SCALDING_CASCADING3_DEBUG is set, or something?",102391943,2014-04-09 22:55:53
3459061,33685,11478003,4,updated the PR to do that,102391943,2014-04-10 15:17:50
3512385,319889,11753766,18,"much as you removed the (_) from the fn, can you remove it from the isDefinedAt/or want to?",103738858,2014-04-18 01:59:58
3512385,7111,11754102,18,"Actually, PartialFunction <: Function, so we could pass it without an extra allocation. The same is not true of isDefinedAt, which requires allocation. Syntactically, it may work to remove the (_), and I can if you prefer, but the reason is different (sty",103738858,2014-04-18 02:06:55
3512385,2221968,11754167,18,"fn is (already) a function object, but isDefinedAt is just a method on an object, so you need the (_) to create a function object",103738858,2014-04-18 02:08:30
3571169,319889,12009171,5,Change needed?,104234396,2014-04-25 23:27:02
3571169,319889,12009200,14,Commented out the provided? you can make it non-provided in the tests (similar to how we do with logging deps),104234396,2014-04-25 23:27:41
3571169,38527,12009204,5,Ah damn I thought I cleaned up my temp changes for local stuff,104234396,2014-04-25 23:27:44
3571169,38527,12009266,14,"Ah, same as above. This is stuff I forgot to clean up from trying to debug some issues. i think the way it was should work fine.",104234396,2014-04-25 23:29:04
3571169,319889,12009297,70,longer than fits in github view... new line + tab indent i think,104234396,2014-04-25 23:29:42
3571169,38527,12009350,70,"What column width do we want for scalding? I typically develop at 120 characters these days but that can be a bit wide for github, yeah.",104234396,2014-04-25 23:30:34
3571169,319889,12009388,31,"scala syntax for import reformat .{FileSystem, FileUtil, ...}",104234396,2014-04-25 23:31:11
3571169,319889,12009398,40,not make LocalCluster a case class?,104234396,2014-04-25 23:31:25
3571169,319889,12009463,48,"looks like this should be centralized, lots of repetition",104234396,2014-04-25 23:32:35
3571169,319889,12009548,121,hadoop-test-lib is that a constant from elsewhere or something we should have as a UUID in the path?,104234396,2014-04-25 23:34:10
3571169,38527,12009564,40,This is a stylistic thing I wanted to hash out. Case classes conflate a couple of nice things with one thing that may be undesirable here: the fact that equality is based simply on the members (in this case of which there are none). I'm fine making them c,104234396,2014-04-25 23:34:27
3571169,319889,12009574,133,lazy val this?,104234396,2014-04-25 23:34:42
3571169,38527,12009622,121,"probably should be a random dir, yeah #cargocult",104234396,2014-04-25 23:35:26
3571169,319889,12009649,37,I imagine most/all of these LOG.info's should be LOG.debug's?,104234396,2014-04-25 23:35:59
3571169,38527,12009700,133,"depends on how we want the lifecycle of the class to work. Currently, you could use the same instance and call initialize/shutdown then initialize/shutdown and each time, between initialize and shutdown, the mode would be different. a lazy val would elimi",104234396,2014-04-25 23:36:54
3571169,38527,12009720,37,Indeed,104234396,2014-04-25 23:37:18
3571169,319889,12009727,70,"I'm not sure, I tend to develop at something absurdly wide, but making it pretty in github seems good.",104234396,2014-04-25 23:37:23
3571169,319889,12114286,4,Should this be in the aggregate target with/without publishing so that its tested with everything?,106326005,2014-04-30 01:16:43
3571169,319889,12114297,20,collapse imports,106326005,2014-04-30 01:16:59
3571169,319889,12114350,47,"This is going to be the class source of the constructor, not the Job right? we probably want to get the job on the classpath?",106326005,2014-04-30 01:18:10
3571169,319889,12114483,43,private val only referenced in the create sources with a foreach ?,106326005,2014-04-30 01:20:36
3571169,38527,12116034,4,I was debating this. These tests potentially will add a lot of time to the tests...but they will be more thorough. Not sure what the flow should be.,106326005,2014-04-30 01:52:59
3571169,38527,12116215,43,"Well, the idea is that if there are other things people want to dump, this would be the natural buffer to add them to. Pending the need, however, we can just inline it and if we end up needing it, we can readd it.",106326005,2014-04-30 01:55:55
3571169,38527,12116267,47,"not sure what you mean. cons will come from the test class, so it should put everything there on the classpath.",106326005,2014-04-30 01:56:38
3571169,319889,12117635,47,"Cons is a function 1 to the job class, you want to ensure we get the job class not the function 1, we aren't really guaranteed they are in the same place ",106326005,2014-04-30 02:22:56
3571169,38527,12117948,47,"I can certainly add it, though it's important to note that if things get crazy we'll have to add more to the classpath. We have a hook to do this in the LocalCluster but if they reference a library not on any of this, they'll have to add it. That said, in",106326005,2014-04-30 02:29:48
3571169,7111,12151131,108,this should be foreach. It is a sideeffect.,106326008,2014-04-30 21:06:32
3571169,7111,12151179,112,"`addClassSourceToClassPath[T](clazz: Class[T])`

Should allow us to avoid the cast elsewhere.",106326008,2014-04-30 21:07:32
3571169,7111,12151541,37,"this is copying the JobTest. Can we not share code here?

Also, the original job test used mutable val and vars for no real reason. It should have just used a case class, immutable data structures and `.copy(sources = newSrc :: sources)` for instance.  ",106326008,2014-04-30 21:15:18
3571169,38527,12157833,37,"The issue with this and JobTest is the way in which the sources and sinks are mocked in the JobTest. Since that is all in memory, the way in which data is passed around is very different. In our case we have to actually get the data on/off of a hadoop clu",106326008,2014-04-30 23:21:07
3644211,319889,12331688,15,Why is this a var? ,108479654,2014-05-06 20:49:43
3644211,319889,12331728,25,"You should also lift the other code from tool around parsing the hadoop args, it will allow using -Dio.sort.mb and such from the command line args when launching the script",108479654,2014-05-06 20:50:16
3644211,319889,12331838,4,using --local and --hdfs would be more in keeping with existing scripts?,108479654,2014-05-06 20:51:28
3644211,1847115,12333497,25,"Yeah, I can do that. It used to exist in an older version, but I took it off because the current scald-repl.sh doesn't allow passing of any command-line args.",108479654,2014-05-06 21:23:16
3644211,1847115,12333574,4,"I am ok with that. If I am going to enable passing additional arguments (as per discussion above), then I don't need to do any kind of arg handling in bash at all. I can just pass ""$@"" through.",108479654,2014-05-06 21:24:44
3644211,1847115,12333802,15,"You mean just instantiate it when I need it? Because I want to add to the configuration later if I want. Also, it helps me steal the code from Tool better (since that relies on getConf, which doesn't exist here because we don't extend from hadoop.util.Too",108479654,2014-05-06 21:30:07
3644211,622449,12335443,15,"no, why a `var` and not a `val` (var is a mutable reference, val is like final in java)",108479654,2014-05-06 22:03:00
3644211,1847115,12337501,15,"Ah yes, it doesn't need to be mutable. Old java habits die hard.",108479654,2014-05-06 22:42:23
3644211,38527,12496898,32,"Maybe instead of throwing an error, we can do a log error of the parameter?

Otherwise it can be _ => ()",109504332,2014-05-10 02:27:25
3644211,38527,12496924,43,"if a method doesn't contain multiple statements, you don't need the {}'s",109504332,2014-05-10 02:28:06
3644211,38527,12496966,4,doesn't bash have some stuff built in to make this a bit cleaner?,109504332,2014-05-10 02:29:24
3644211,1847115,12498232,32,"Its actually going to complain about stuff like ""--local"". It doesn't seem like we do much with it anyways. So I will go with  _ => ().",109504332,2014-05-10 03:09:19
3644211,1847115,12498287,43,"I cut and pasted from tool :). But yes, I can fix this.",109504332,2014-05-10 03:10:41
3644211,1847115,12498319,4,I may be able to use getopt (not getopts). Let me see what I can do.,109504332,2014-05-10 03:11:51
3644211,1847115,12499442,4,Scratch that. getopt doesn't work on mac os - http://stackoverflow.com/questions/11777695/why-the-getopt-doesnt-work-well-in-my-mac-os.,109504332,2014-05-10 03:59:49
3646066,7111,12390310,24,"what if we add:
```
def apply(s: Seq[Comparable]): Fields
```",108881931,2014-05-07 22:31:56
3657556,38527,12562829,5,"formatting is a little strange, I feel we usually prefer dropping the result to the next line before the arguments",110243196,2014-05-13 06:08:02
3657556,38527,12562925,10,"I'm a bit confused as to what you are going for. Generally, TypedSeparatedFile is just to help in the creation of TypedDelimiteds. So mixing it in here doesn't really do much? Except make a class which can also make TypedDelimiteds, but with no connection",110243196,2014-05-13 06:11:47
3657556,1825352,12566321,10,The suggested workaround for https://github.com/twitter/scalding/pull/864 is to replace usage of Tsv with TypedTsv. So we also need an alternative of DailySuffixTsv. That's the main purpose of this PR. Also I guess it's not a bad idea to have time-pathed ,110243196,2014-05-13 09:26:05
3657556,38527,12596089,9,"TypedSeparatedFile is not what makes something a TypedTsv. If you have this, what you will have is a DailySuffixSource which has an apply method which will create TypedTsv's. ie

(DailySuffixTypedTsv(""prefix))(""input) would be a TypedTsv. This is obviou",111048752,2014-05-13 22:26:43
3657556,1825352,12602727,9,"I see, thanks for the clarification.
So extend TypedDelimited with DailySuffixSource should give me the desired DailySuffixTypedTsv I guess?",111048752,2014-05-14 00:13:23
3657556,1825352,12611048,9,"Actually TypedDelimited is a class and extends FixedPathSource, so it won't work with DailySuffixSource. Does it make sense to change TypedDelimited to trait without extending any *PathSource? And create a FixedPathTypedDelimited class to replace the curr",111048752,2014-05-14 02:54:13
3778965,44017,13193051,27,Should `transformer` here be implicit?,115467127,2014-05-29 22:32:39
3778965,319889,13193120,27,"Thats a good question, no particular reason why not... will update",115467127,2014-05-29 22:34:15
3778965,319889,13193330,27,"Updated as an implicit, and updated the tests with the cleaner workflow that results",115467127,2014-05-29 22:38:29
3778965,814892,13195048,30,`extends BijectedSourceSink.SourceSink[U]`?,116382496,2014-05-29 23:07:19
3778965,319889,13195197,30,"had tried that, it didn't like extending off the class defined type for some reason",116382496,2014-05-29 23:09:46
3778965,2523602,13195702,30,"This looks awesome. I wonder if  implicit transformer: Bijection[T, U])
would have serialization issues or should be lazy?


On Thu, May 29, 2014 at 1:09 PM, ianoc <notifications@github.com> wrote:

> In
> scalding-core/src/main/scala/com/twitter/s",116382496,2014-05-29 23:19:02
3778965,7111,13198804,27,"you should take `ImplicitBijection` here, not Bijection. This is a trick to deal with the fact that `Bijection[A, B]` and `Bijection[B, A]` are equivalent, but confuse implicit resolution.",116382496,2014-05-30 00:10:13
3778965,7111,13198897,32,would be good to have this as a combinator on the setter.,116382496,2014-05-30 00:11:54
3778965,7111,13198922,27,type on a public method.,116382496,2014-05-30 00:12:31
3845988,1008176,13571182,26,"The returned exit code is actually still 127, as set in the commons script. ",121931974,2014-06-10 04:41:54
3845988,1847115,13572855,26,"Maybe the comment wasn't clear. But ""diff tutorial/data/hello.txt tutorial/data/output1.txt"" exits with a non-zero exit code, and hence the test_tutorials.sh fails will fail (due to the set -e). Which is what we want. I will clarify the comment.",121931974,2014-06-10 05:41:29
3845988,319889,13606897,6,"dirname $0 can fail to identify the current working path for the distro under relative paths or other things... we should use

DIR=""$( cd ""$( dirname ""${BASH_SOURCE[0]}"" )"" && pwd )""

for it, its about the most reliable way to get the info",124683572,2014-06-10 22:25:01
3845988,319889,13606944,13,"We should daisy chain common off a global path, see previous comment rather than sourcing it first then doing this.

Also these should be all caps constants",124683572,2014-06-10 22:25:56
3845988,1847115,13629407,6,Will do. Updated PR coming.,124683572,2014-06-11 06:11:20
3845988,1847115,13629442,13,"Will do about caps constants.

What do you mean daisy chain off a global path? I need to find the global path to actually find the common.sh to source.

Will send an update PR - let me know if that addresses your comments.",124683572,2014-06-11 06:12:45
3851396,44017,13521898,5,segacist.,121901932,2014-06-08 04:34:15
3851396,44017,13521904,16,I think the name `butFirst` has better symmetry with `andThen`,121901932,2014-06-08 04:36:00
3851396,44017,13521908,8,What's the practical difference between using this and just using `map`?,121901932,2014-06-08 04:37:08
3851396,319889,13522020,16,contraMap is the haskel naming for this right?,121901932,2014-06-08 05:11:59
3851396,319889,13522021,8,"typedSource has no map, it would be via the implicit conversion to a TypedPipe to get it. I think not using map is to avoid being ambiguous. 

The main reason not to map is that you can still have it be a TypedSource and keep it as that type.",121901932,2014-06-08 05:14:54
3851396,7111,13522022,16,http://hackage.haskell.org/package/contravariant-0.1.2.1/docs/Data-Functor-Contravariant.html,121901932,2014-06-08 05:15:54
3851396,7111,13522026,8,"Suppose you have an API that needs a `TypedSource[T]`. You might have one that you could get there via a map, then you can use this. I agree, it would be better to call .map, but I am afraid of confusing error messages since Mappable extends TypedSource a",121901932,2014-06-08 05:17:40
3851396,7111,13522028,16,"That said, I am happy to add:
```scala
  final def butFirst[U](fn: U => T): TypedSink[U] = contraMap(fn)
```
I think that contraMap is at least the principled name for this operation, and I think it applies in more cases than butFirst.

How does thi",121901932,2014-06-08 05:19:07
3851396,7111,13522332,8,"put another way, this is transformForRead in the Typed-API.",121901932,2014-06-08 07:19:44
3851396,44017,13522452,8,"Makes sense, yep.",121901932,2014-06-08 08:21:27
3851396,44017,13522453,16,"I don't think an appeal to Haskell is very useful; in general Scalding has tried to keep consistent with the Scala naming conventions, not Haskell's. I think `butFirst` (while a bit silly) is in keeping with `andThen`, so I think it's a better name in thi",121901932,2014-06-08 08:22:52
3851396,7111,13525056,16,"Haskell is only relevant because we had to have some name. I am happy to add butFirst here, and would have been happy to make the one on TupleConverter butFirst, but I don't think it is worth a (minor) breaking change to change that one.

Two options: (",121901932,2014-06-08 22:09:02
3851396,44017,13525144,16,"I didn't realize there was something else we have already pushed that we're being consistent with. Grudgingly, let's keep it as `contraMap` here too.",121901932,2014-06-08 22:36:00
3851396,7111,13606758,16,"Okay. So, unless there is any other issue, will someone merge?",121901932,2014-06-10 22:22:05
3851746,44017,13521896,30,Maybe the body of this if clause should be delegated to another method that could be called explicitly if someone wants to override the `<= 100` limitation. ,121929100,2014-06-08 04:33:17
3851746,1825352,13525349,4,Alphabetical order.,121929100,2014-06-08 23:19:06
3851746,1825352,13525353,30,Make this 100 a constant value and declared right after the comments?,121929100,2014-06-08 23:19:33
3851746,1825352,13525458,32,Maybe we should avoid using terms like sortedTake in comments to reduce confusions. Just say we're doing in-memory heap-sort on mappers?,121929100,2014-06-08 23:26:14
3851746,38527,13664324,28,why can't you just return ```this```?,121929100,2014-06-11 23:06:44
3851746,7111,13664647,28,"if you `take(0)` it should be empty, but we don't have an empty grouped. filtering everything should work.",121929100,2014-06-11 23:11:41
3851746,7111,13664821,30,"@reconditesea sure, I can make a constant (but I have to add {}, which you know I hate. :)

@avibryant can you suggest how to do your suggestion? I agree that it sucks to have some hard coded constant. But only in the case of sorting did I work this out",121929100,2014-06-11 23:15:27
3851746,44017,13667624,30,"My point is that you could have a method, in Grouped, which is called `bufferedTake` or something, which just has the implementation from this `else if` clause:

````scala
def bufferedTake(n: Int) = {
   implicit val mon = ...
   val pretake: ...
}",121929100,2014-06-12 00:03:54
3851746,7111,13667933,30,"Got it. I'll update to this approach. I'll have to push it all the way down
to KeyedListLike I think, but that shouldn't be a problem.


On Wed, Jun 11, 2014 at 12:03 PM, Avi Bryant <notifications@github.com>
wrote:

> In scalding-core/src/main/sca",121929100,2014-06-12 00:09:00
3851746,7111,13677180,30,"@avibryant a couple of problems here:

1) If there is no ordering defined, it is janky or broken to use the heap approach (I could define a fake ordering on the hashcodes, for instance).
2) If we don't do the above, we need a new monoid that that takes",121929100,2014-06-12 03:09:19
3851746,44017,13686366,30,What about just dropping `bufferedTake` on `IdentityValueSortedReduce`? I don't feel *that* strongly about this but I feel like giving an expert a convenient way to override the constant would be nice.,121929100,2014-06-12 08:36:36
3851746,814892,13892935,22,minor - should say sending to the reducers?,126177192,2014-06-18 04:39:27
3851746,814892,14320336,30,"Is there a different way to drop all entries? I presume filterKeys will still look at each key?
Shouldn't matter much since this is an edge case. Just asking out of curiosity. Thanks.",126177192,2014-06-28 04:46:22
3851746,7111,14320566,30,"filterKeys will at least be pushed map-side, and there will be no shuffle. But point taken, we need some EmptyGrouped that could skip even reading the data in the first place (although, it probably almost never happens to take(0). Why would you?)",126177192,2014-06-28 04:58:18
3851746,7111,21119362,4,"somehow, this was not here, even though we are using BaseProperties, which is in the test artifact. Not really sure how the tests have been passing, but they would not pass for me. Maybe there was a reference to that in core somehow? Or a bug in sbt?",185675862,2014-12-02 04:06:10
3881823,38527,13663506,36,JVM languages generally prefer camelCase,125335346,2014-06-11 22:52:22
3881823,38527,13663549,40,"just import Pipe above, I try to avoid fully qualified types in the code",125335346,2014-06-11 22:52:58
3881823,38527,13663569,37,why is this necessary?,125335346,2014-06-11 22:53:21
3881823,38527,13663676,34,I'm curious why you decided to go with the case approach,125335346,2014-06-11 22:55:06
3881823,38527,13663756,43,the preferred way to get this is actually to use TypedPipe.from,125335346,2014-06-11 22:56:17
3881823,7111,13663773,58,"prefer the `.map(_.reverse)` style. Only use `{ }` for lazy evaluated code, or when it is needed for multiple expressions.",125335346,2014-06-11 22:56:36
3881823,38527,13663849,109,why typed.?,125335346,2014-06-11 22:58:15
3881823,52981,13663876,34,"I just started doing it all in one file because the first few were like 1 or two lines of unique code, so it was easier to see the differences between tutorials.",125335346,2014-06-11 22:58:36
3881823,38527,13663893,129,TypedPipe.from,125335346,2014-06-11 22:58:55
3881823,7111,13664243,40,"don't do this at all. We should make a `TextFile extends TypedSource[String] with TypedSink[String]`. You should not need to go into the fields API to use the typed API.

Or use `TypedTsv[String]` for this example. ",125335346,2014-06-11 23:05:15
3881823,7111,13664273,78,you didn't put the type above. Let's be consistent. I lean towards putting the type on output sinks.,125335346,2014-06-11 23:05:56
3881823,7111,13664330,107,"or, we you can call reduce, foldLeft, or in full generality, mapGroup.",125335346,2014-06-11 23:06:49
3881823,7111,13664351,129,let's not go via the fields API here.,125335346,2014-06-11 23:07:04
3881823,7111,13664439,129,"We should make `TextLine extend Mappable[(String, Long)]` perhaps.",125335346,2014-06-11 23:08:01
3881823,7111,13664513,150,"I question if writing the types helps at first. You don't need to, and we get into the discussion of the whole Grouped, UnsortedGrouped, CoGrouped, etc...",125335346,2014-06-11 23:09:07
3881823,52981,13665028,43,"Ah, I got that from the wiki API reference (https://github.com/twitter/scalding/wiki/Type-safe-api-reference), which had an example using `toTypedPipe`, but didn't mention `from`. If that's the preferred way to do it, I'll update the wiki, too.",125335346,2014-06-11 23:19:04
3881823,52981,13665149,109,`UnsortedGrouped` doesn't come in with `import TDsl._`. I've added another import so the names aren't qualified.,125335346,2014-06-11 23:21:16
3881823,52981,13665538,150,"Hmm, yes it is messy. I found it useful to see the types in order to understand how various tuples end up nesting when you group and join. For instance here, I wanted to note that join takes you from `[String,Long] join [String,Double] -> [String,(Long,Do",125335346,2014-06-11 23:28:38
3881823,52981,13665618,78,"I'll leave the types on each of the examples. The comment in ""case 2"" said that you *could* leave out the types, but in general you should use them for safety as things change.",125335346,2014-06-11 23:29:54
3881823,52981,13665723,40,"There is an implicit conversion to TypedPipe from TextLine, which I use in the rest of the examples. This was just showing all the steps. It may just muddy the waters, but coming from the Fields API examples, it was strange to just magically get the `Type",125335346,2014-06-11 23:31:48
3881823,52981,13672182,129,"It works out to be pretty ugly:

```scala
val typedLines = TypedPipe.from[(Long,String)](TextLine(args(""input"").read),('offset,'line))
```

All just to get both fields of TextLine typed. Maybe it'd be better to use a TypedTsv source as an example, i",125335346,2014-06-12 01:30:13
3881823,7111,13719110,42,"no commented lines, please. Also, don't you need to give the sourceFields?",125813103,2014-06-12 23:47:30
3881823,7111,13719126,34,"there should be a default here of replace, I believe.",125813103,2014-06-12 23:47:51
3881823,7111,13719181,34,"actually, let's not have any defaults here and just set the defaults once as you do below in the object.",125813103,2014-06-12 23:48:50
3881823,7111,13719233,24,should not be needed. Let's not use this.,125813103,2014-06-12 23:49:31
3881823,7111,13719272,44,let's not mention Pipe or .read unless we are explicitly doing a tutorial on interop between Fields and Typed.,125813103,2014-06-12 23:50:08
3881823,7111,13719330,63,"let's not use implicits. Let's use:

```scala
TypedPipe.from(TextLine(arg(""input""))
  .map(_.reverse)
```",125813103,2014-06-12 23:51:10
3881823,7111,13719343,79,"again, let's avoid the implicits.",125813103,2014-06-12 23:51:25
3881823,7111,13719392,140,explicit TypedPipe.from please,125813103,2014-06-12 23:52:17
3881823,7111,13719403,147,TypedPipe.from,125813103,2014-06-12 23:52:29
3881823,7111,13719451,194,"also, let's discuss making TypedPipe from pipe using TypedPipe.from, and also, let's talk about going back to a Pipe, via .toPipe",125813103,2014-06-12 23:53:21
3881823,52981,13719734,42,"Oops, meant to delete those lines. The default is to get all the fields by using `converter` to get the arity: `Dsl.intFields(0 until converter.arity)` (TypedSource:37), which does what we want (I think).",125813103,2014-06-12 23:58:07
3881823,7111,13725686,35,"this is repeated on like 396. There is a risk of them getting out of sync. Remove the default here, just have it in the object.",125864437,2014-06-13 01:54:18
3881823,52981,13727172,24,"Hmm, the ""typed block"" command doesn't work without TDsl. What's the deal with that import? Is it supposed to be deprecated, and all the implicits just come in with `import com.twitter.scalding._`?",125813103,2014-06-13 02:20:14
3881823,7111,13731862,24,"Well, you can use the TDsl or Dsl imports as needed, but generally only as
needed.

Yes, in this case, .typed needs TDsl. Do this:

```scala
val result: Pipe = {
  import TDsl._ // to get the .typed enrichment
  ...read.typed('x -> 'y) { TypedPipe",125813103,2014-06-13 04:00:51
3881823,52981,13733100,24,"Guilty as charged. Ah, and it looks like `toTypedPipe` is also there, which is no longer necessary when using `TypedPipe.from`. I'm going to update some places in the wiki that are misleading.",125813103,2014-06-13 04:41:54
3881823,7111,13735547,165,should we also mention that this is the same as `sumByKey`?,125917803,2014-06-13 06:26:25
3881823,7111,13735591,31,let's remove this. The scala style at Twitter is moving to minimizing use of implicit enrichment unless it is really justified. Avoiding .from seems like not worth the obfuscation of going through the implicit enrichment mechanism.,125917803,2014-06-13 06:28:37
3882592,7111,13668402,122,Can we make a class like: `case class DriverName(className: String)`,125374105,2014-06-12 00:16:35
3882592,814892,13686778,76,doesn't seem backward compatible. Will that be an issue?,125493687,2014-06-12 09:02:27
3882592,814892,13686846,30,"Nice.. works much better than `updateBy` I think, since mysql already knows what the unique key is.",125493687,2014-06-12 09:06:29
3882592,7111,13730154,76,"I encouraged this, but I think that ColumnName here, might be too little win. I don't see the risk of using String directly here. The more dangerous case is: `def fn(name: String, dogsName: String, teamName: String)` as the compiler can't help if you get ",125493687,2014-06-13 03:23:21
3882592,814892,13734387,76,Makes sense to me. Wish scala allowed some way of enforcing named args for methods.,125493687,2014-06-13 05:28:44
3882592,7111,14034820,62,why are these private? Subclasses can't use them then. Is that the intent?,125493687,2014-06-20 23:39:35
3882592,7111,14160950,69,BIGINT changed to DOUBLE.,130328292,2014-06-25 04:03:23
3882592,7111,14160992,57,"strange that defOp has no default, but sizeOp does. I didn't even know that was allowed.",130328292,2014-06-25 04:04:21
3921011,1847115,13837979,80,I would keep the repl test.,127337351,2014-06-17 05:35:24
3998541,38527,14221833,11,do we want to do it for anything that isn't explicitly typed?,130789225,2014-06-26 06:25:03
3998541,38527,14221909,5,"perhaps ""to hack around a known Cascading bug that they have decided not to fix""",130789225,2014-06-26 06:28:14
3998541,38527,14221917,7,"Perhaps we should mention the optimization in cascading that triggers this, and the flag to turn it off if they are worried?",130789225,2014-06-26 06:28:37
3998541,319889,14255286,11,"Not all of them have this quirk, TextLine seems to be fine for instance. Though I'm reasonably fine with doing that -- if you use a typed source but in an untyped manner it may still appear? (given most untyped sources are presented as Mappable's these da",130789225,2014-06-26 22:55:22
3998541,7111,14256646,11,"I think untyped sources (and sinks) should go away. I think Tsv is the only one that has this issue. So, I'd be fine with this minimal change.

Can we have a test that is broken before this and that this fixes?",130789225,2014-06-26 23:18:42
3998541,7111,14256716,11,"Nevermind, I see the test below. Ian, can you confirm that test failed before this fix?",130789225,2014-06-26 23:19:35
3998541,7111,14256809,4,"Do we need `T`? I don't think so.

Also, the `()` is not needed. In fact, you can make this an `object`. Can we add a comment that this is just to put empty nodes in the cascading graph that is used to control some aspects of the planning.",130789225,2014-06-26 23:21:12
3998541,319889,14259047,7,Do you know the name of that switch?,130789225,2014-06-26 23:55:02
3998541,319889,14259141,11,It did fail before fix. we don't have a travis build with that however by the looks. So i'm going to stick up a branch with just the tests and not the fix to ensure we catch these on travis.,130789225,2014-06-26 23:56:04
3998541,319889,14259317,11,"https://travis-ci.org/twitter/scalding/builds/28528347 should cover this without the fix:

https://github.com/twitter/scalding/compare/testCacheBugTest",130789225,2014-06-26 23:58:40
3998541,7111,14260042,11,"I would have taken your word for it. :)


On Thu, Jun 26, 2014 at 8:58 AM, ianoc <notifications@github.com> wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/RichPipe.scala:
>
> > @@ -549,7 +549,16 @@ class RichPipe(val pipe: Pipe) ext",130789225,2014-06-27 00:10:42
3998823,38527,14222140,144,"why do you use .+ here and space everywhere else? Not a big deal, just curious.",130797216,2014-06-26 06:38:37
3998823,38527,14222240,217,"1. Do we not want to return a Config?
2. Do we want a method configToHadoop that then will set everything in the map to Hadoop? Though maybe that isn't necessary since internally we just require Maps",130797216,2014-06-26 06:41:54
3998823,7111,14222329,144,"somehow the riform was wrapping it, and breaking semicolon inference. :/",130797216,2014-06-26 06:47:21
3998823,7111,14222331,217,Agree.,130797216,2014-06-26 06:47:27
3998823,319889,14249470,89,"Are these built up just once, or would it make sense that we expand this class so we can pass the 4 ser types around and then just reify into the map at a final toMap step?",130824891,2014-06-26 21:04:00
3998823,319889,14249516,136,"slight typo, second is => if",130824891,2014-06-26 21:05:06
3998823,319889,14249542,144,"Interesting, any idea if it was only 2.9 ? ",130797216,2014-06-26 21:05:35
3998823,7111,14252182,144,"@ianoc no, I didn't try with 2.10.

It was wrapping it like:
```scala
this + x
+ y
```
rather than
```scala
this + y
  + x
```
Maybe neither would work, though.",130797216,2014-06-26 21:56:29
3998823,7111,14252467,89,"This method should only be called once (it overwrites the keys it touches). Generally, users would not call this (even the Config.default sets up something reasonable).

I thought about that approach too, which I like more in many ways. A better approac",130824891,2014-06-26 22:01:51
3998823,319889,14254853,89,Is moving to a Config => Config model you think we should note as a 1.0 issue or just a nice to have we can more or less skip?,130824891,2014-06-26 22:47:16
3998823,319889,14254871,144,"Ah, funky. cool",130797216,2014-06-26 22:47:44
3998823,7111,14257372,136,Good catch. Fixed in the next one.,130824891,2014-06-26 23:30:27
3998868,38527,14266351,77,"Do we also want to document to them how to contrust the proper mode and conf object, if this is meant to be instructive?",131127205,2014-06-27 01:58:24
3998868,7111,14266453,77,Good idea.,131127205,2014-06-27 02:00:06
3998868,38527,14266719,91,the reason is that wildcards are not interchangeable. The _ Flow[_] in the return type is different from the Flow[_] here. One solution is to make them both Flow[Any]. Another solution is to add a type parameter that does nothing. Another solution is to c,131168690,2014-06-27 02:03:53
3998868,7111,14267474,91,"But `Flow[Any]` is not really right either, because `Flow[C]` is invariant in `C` even though it should be covariant (C only appears in return values). It really has some type, we just don't tell you what it is.",131168690,2014-06-27 02:19:02
3998868,38527,14267542,91,"I think if you do a type parameter C and pass it to the return type, it will just get filled in with Nothing and then erased. This should work fine, no?",131168690,2014-06-27 02:20:27
3998868,7111,14267575,91,"But, yes, I know the `_` are different `somethings` but, why does manually doing the `try` work, but using `Try` does not. That seems like a compiler bug to me.",131168690,2014-06-27 02:21:07
3998868,7111,14267760,91,"But that's also a lie, since we don't really know or ever care what `C` is.
In fact, `C` seems like an error in cascading's design, since he
backpedaled and uses `Map<Object, Object>` in most places now for the
config.


On Thu, Jun 26, 2014 at 11:2",131168690,2014-06-27 02:25:17
3998868,38527,14268035,91,"Oh it's definitely an error in cascading's design.

Thinking on why it's an error... that's a good point. Hm.",131168690,2014-06-27 02:30:39
3998868,319889,14270480,43,Do we need this FN? would it not suffice to be a Future[Flow[Config]] ? ,131175883,2014-06-27 03:23:53
3998868,7111,14274091,43,"We don't need it, but I didn't want to pass on scala.concurrent.ExecutionContext just to access the stats, which clearly is not an expensive operation.

So, this is a map tacked on the end, but logically, you are right. Since this is an adapter class, I",131175883,2014-06-27 05:01:08
3998868,319889,14274494,43,"Ok cool fair enough, not used the scala futures really enough to know when those are needed/not needed. ",131175883,2014-06-27 05:14:37
3998868,38527,14275494,14,this is where using github tags would be nice...it'd be good to accrue some of the bigger breaking changes we'd like before 1.0. Like this.,131323058,2014-06-27 05:47:20
3998868,38527,14275536,7,"there are some non-String keys allowed. Not a ton, but they're allowed. Do we just not care?",131323058,2014-06-27 05:48:45
3998868,38527,14275586,37,It would be cool to make this sort of lifecycle stuff type safe,131323058,2014-06-27 05:51:05
3998868,7111,14276087,7,What are they?,131323058,2014-06-27 06:13:17
3998868,7111,14276110,37,"Agree, but how? And this is for tests, not prod, so I am not *that* worried about misuse. Misuse it and your tests fail. Pretty safe.",131323058,2014-06-27 06:14:21
3998868,7111,14276825,7,"https://github.com/cwensel/cascading/blob/f152df983a70b342dd77c02b84f82fd5026b5c0c/cascading-core/src/main/java/cascading/property/AppProps.java#L65

Looks like we need to special case that one in Config. Dammit.",131323058,2014-06-27 06:48:44
4005175,7111,14257763,9,add a return type to public methods (this old code didn't follow that rule).,131099444,2014-06-26 23:37:06
4005175,7111,14257773,27,add a return type please.,131099444,2014-06-26 23:37:22
4005175,7111,14257843,9,"This makes me pretty nervous, as this breaks old code. Anyone that overrides writeFrom will not have this behavior, right? Is there a way to be compatible?",131099444,2014-06-26 23:38:30
4005175,7111,14257892,9,could we just look through the tals in the flowDef for the sinkName to get the pipe back?,131099444,2014-06-26 23:39:14
4005175,7111,14258249,63,"Iterators can be dangerous types (due to mutability) to return, and I generally only like them for performance critical code. Can we make this a List or a Set?  By putting `toSet` at the last line, `Set[Pipe]` should be returned, and I think that a Set is",131099444,2014-06-26 23:44:02
4005175,7111,14258419,75,"is this the same as `new FlowDef`, can you comment to say why not?",131099444,2014-06-26 23:46:34
4005175,319889,14258454,9,This will break code using writeFromAndGetTail directly when writeFrom is overridden. So far that just entails the REPL. Though we did talk yesterday about maybe looking through the sinks after the call for the new one and working from that. It would seem,131099444,2014-06-26 23:47:22
4005175,52981,14258564,9,Good points. I'll see if I can come up with the least-brittle way to get the right tail pipe.,131099444,2014-06-26 23:48:47
4005175,7111,14258590,58,"these functions are way too useful to be put here.

Let's move them to `object RichPipe` or somewhere else in scalding-core. I can think of a few uses of these methods.",131099444,2014-06-26 23:49:10
4005175,52981,14258782,75,"In fact, I don't want the name-change that `ReplImplicits.getEmptyFlowDef` does. Changed to `new FlowDef`",131099444,2014-06-26 23:51:09
4005175,7111,14258931,63,"Isn't this the same as getHeads?

https://github.com/Cascading/cascading/blob/2.5/cascading-core/src/main/java/cascading/pipe/Pipe.java#L345",131099444,2014-06-26 23:53:16
4005175,7111,14258984,63,"I guess not, this is the transitive closure of this and the previous.",131099444,2014-06-26 23:54:06
4005175,7111,14259051,82,"https://github.com/Cascading/cascading/blob/2.5/cascading-core/src/main/java/cascading/pipe/Pipe.java#L345

This seems redundant. If `getParent == null`, `getHeads == Seq(this)` right?",131099444,2014-06-26 23:55:03
4005175,52981,14259075,63,"Yep, I'll note that in the comments.",131099444,2014-06-26 23:55:23
4005175,7111,14259106,83,prefer `{ }` for a closure this large.,131099444,2014-06-26 23:55:38
4005175,52981,14259288,58,You're referring to the two operations on pipes (`localizedFlow` and `upstreamPipes`)?,131099444,2014-06-26 23:58:15
4005175,7111,14259386,114,+1,131099444,2014-06-26 23:59:43
4005175,7111,14259514,111,can you comment what this is getting?,131099444,2014-06-27 00:01:31
4005175,7111,14260364,58,"Yes, I am.",131099444,2014-06-27 00:15:57
4005175,7111,14260942,115,"I think we need something like `def newTempPath: String` to `Mode` and in Hdfs, we need to do this:

https://github.com/cwensel/cascading/blob/f152df983a70b342dd77c02b84f82fd5026b5c0c/cascading-hadoop/src/main/shared/cascading/tap/hadoop/Hfs.java#L723",131099444,2014-06-27 00:23:09
4005175,7111,14261370,115,"This might be of use when making a `TempSource[T]` that extends `Source[T] with Sink[T]` https://github.com/cwensel/cascading/blob/f152df983a70b342dd77c02b84f82fd5026b5c0c/cascading-hadoop/src/main/shared/cascading/tap/hadoop/util/TempHfs.java#L87

",131099444,2014-06-27 00:30:11
4005175,52981,14264645,82," Good catch, you're right.",131099444,2014-06-27 01:30:45
4005175,52981,14270668,82,"Actually, it turns out that all of these have ""getParent == null"", so really the non-redundant criteria should be (_.getPrevious.length == 0).",131099444,2014-06-27 03:28:36
4005175,7111,14275608,34,what if pipe is not a sink? Can we guard here and only do this step if there is actually a sink?,131262771,2014-06-27 05:52:11
4005175,7111,14275835,67,"I think you actually want to pass the FlowDef from localizedFlow here, otherwise the original FlowDef will see this named tap as both a source and a sink, which causes problems in cascading.

I think, it the current FlowDef, you don't want to add the wr",131262771,2014-06-27 06:02:05
4005175,7111,14275865,85,"same concern as above. I think you don't want the writeFrom on this to take the implicit FlowDef, you want to use the localizedFlow to do the write, I think.",131262771,2014-06-27 06:03:21
4005175,7111,14275911,15,pretty concerned about this. What could this mean? What order is it in? What is Last here?,131262771,2014-06-27 06:05:14
4005175,7111,14276041,67,"actually, I think if change the logic as I describe you can remove this:

1) make localizedFlow work even on non-tail pipes (just walk walk up from thisPipe)
2) pass the localizedFlow in manually:
```scala
val localFD = thisPipe.localizedFlow
dest.w",131262771,2014-06-27 06:11:10
4005175,52981,14276078,15,"I completely agree. I dislike the entire bit about trying to rediscover the pipe that we threw away in `writeFrom`. I tried to come up with ways to look up the pipe, but it always comes down to what, precisely, the FlowDef does in `.addTail` (can't just f",131262771,2014-06-27 06:13:00
4005175,52981,14276142,67,"Ah, good idea. Still have the problem that the new `TypedPipe.from(dest)` adds itself to the overall flow, but if every call to `run` disregards unused sources, it should be fine.",131262771,2014-06-27 06:15:32
4005175,38527,14305891,41,give it an explicit return type please,131377848,2014-06-27 22:57:15
4005175,7111,14308286,28,this override is just calling super. Let's drop that.,131377848,2014-06-27 23:41:31
4005175,7111,14308689,41,"I don't think this should be an enrichment method. It should be a ""command"". You should set things up, and then just type ""run"" at the command.

That said, I think when you run, you expect everything in the flow to run, and if you call run again, it sho",131377848,2014-06-27 23:48:09
4005175,7111,14308776,59,"this needs to be totally redone.

1) we should use the SequenceFile storage.
2) we should use your .save code, not the run above.",131377848,2014-06-27 23:49:32
4005175,7111,14308926,59,"in fact, it should be on ShellTypedPipe",131377848,2014-06-27 23:52:15
4005175,52981,14309096,41,"I agree, ""run"" now can be a command that just executes the given flowDef (and takes the implicit flowDef by default).

I guess I *don't* expect the contract to be that it will secretly memoize the run. I was imagining that you take a snapshot explicitly",131377848,2014-06-27 23:55:37
4005175,52981,14309323,59,Actually I was thinking the opposite: this ensures that only the sources that are upstream from sinks are included. The snapshot and save methods are special cases were we drop all the other sinks and just do the new one. But I don't yet know how to make ,131377848,2014-06-27 23:59:18
4005175,7111,14309384,41,"Do we ever want run?

Do we not just want save, snapshot, toIterable?


On Fri, Jun 27, 2014 at 8:55 AM, Brandon Holt <notifications@github.com>
wrote:

> In scalding-repl/src/main/scala/com/twitter/scalding/ShellPipe.scala:
>
> > @@ -97,16 +99,",131377848,2014-06-28 00:00:18
4005175,52981,14309772,41,"The value of ""run"" would be that you can build up your ""target"" job, end to end, in the repl, with more than one sink, etc. Snapshot, save, toIterator are all just one sink.",131377848,2014-06-28 00:07:55
4005175,38527,14315932,27,is this just here to be explicit?,131377848,2014-06-28 02:22:07
4005175,52981,14315986,27,Reordering so it will group by word. Is that not needed?,131377848,2014-06-28 02:23:20
4005175,38527,14316432,28,explicit return type,131680683,2014-06-28 02:34:30
4005175,38527,14316459,52,public API's should always have explicit return types,131680683,2014-06-28 02:35:14
4005175,52981,14316504,52,Gets me every time.,131680683,2014-06-28 02:36:32
4005175,38527,14316983,29,shouldn't this go in ShellTypedPipe?,131685888,2014-06-28 02:49:18
4005175,38527,14317031,27,oh whoops totally misread that haha. carry on...,131377848,2014-06-28 02:50:41
4005175,52981,14317052,29,"That's from before, and should probably just be left for now. Another PR should fix it with some real support for .toIterator, .dump, etc.",131685888,2014-06-28 02:51:15
4005175,52981,14317064,29,"I could move it for now, though.",131685888,2014-06-28 02:51:34
4005175,38527,14317069,27,you could do _.swap but this is fine,131377848,2014-06-28 02:51:41
4005175,7111,14320130,52,don't like this. Just add all of it here. No need for two methods.,131703411,2014-06-28 04:37:23
4005175,7111,14320196,63,"let's break this out:

`def heads: Set[Pipe]` then `filterKeys(head.map { p => p.getName })` note Sets are alread Functions, so you don't need to make another with contains.",131703411,2014-06-28 04:40:08
4005175,7111,14320230,70,"does this really work? What about checkpoints that point to sources? They will still be in there, right?",131703411,2014-06-28 04:41:40
4005175,7111,14320257,52,"I see, you call it below. Nevermind... Can you add a comment avoid to explain the strange choice?",131703411,2014-06-28 04:42:49
4005175,7111,14320281,52,This should return Unit to make it clear which is being mutated here.,131703411,2014-06-28 04:43:46
4005175,7111,14320303,52,"also, `.mergeFrom` might make it clearer too.",131703411,2014-06-28 04:44:42
4005175,7111,14320352,90,"we need to check for Checkpoints in these pipes here, otherwise scalding's `.forceToDisk` will be ignored in these flows, which is not great.

At the very least, add a TODO for that.",131703411,2014-06-28 04:47:06
4005175,7111,14320504,123," just delete this for now. It is pretty broken now. It should be save, followed by .toIterator on a typed-version of SequenceFile.

We can get this working in the next PR.",131703411,2014-06-28 04:54:26
4005175,52981,14320728,70,I don't know about Cascading's Checkpoints. Does Scalding use them at all?,131703411,2014-06-28 05:07:09
4005175,52981,14320751,70,"Ah, I see, `forceToDisk`.",131703411,2014-06-28 05:09:21
4005175,7111,14322813,70,"By the way, I know this patch is a lot of work, but in fact I think it will
turn out to be one of the best contributions in quite a while when done.

I think this can actually fix a design flaw in scalding: that using pipe
and TypedPipe has side effec",131703411,2014-06-28 11:10:16
4005175,52981,14363186,90,"Added a TODO for this. Not sure what's supposed to happen -- I tried adding a checkpoint, but it seems to go into the flow as just another pipe (doesn't get added to the flowDef (`.addCheckpoint`), so it seems to me like it should work out the same in the",131703411,2014-06-30 22:33:40
4005175,7111,14363914,54,"it looks like the add* methods FlowDef in cascading are not idempotent:

https://github.com/cwensel/cascading/blob/wip-2.6/cascading-core/src/main/java/cascading/flow/FlowDef.java#L153

Is that going to be a problem?
",132413561,2014-06-30 22:45:02
4005175,52981,14365348,54,"In this case, `addSources` does look idempotent: it's just adding what is already in one map into another.

As for `addSource(Pipe)`, it shouldn't be any different -- my understanding is that head pipes have the same name as their source, so `addSource(",132413561,2014-06-30 23:08:38
4005175,7111,14365787,54,"Sorry, bad link:

https://github.com/cwensel/cascading/blob/wip-2.6/cascading-core/src/main/java/cascading/flow/FlowDef.java#L128

addSource(String, Tap) is not adding to a map, it is making sure that the key is not already present. Am I missing somet",132413561,2014-06-30 23:16:20
4005175,7111,14365854,54,"Actually:
```scala
  val y = x.copy
  x.mergeFrom(x)
  Equiv.equiv(y, x) // damn mutable variables
```",132413561,2014-06-30 23:17:22
4005175,52981,14366846,54,"As long as you're copying over all sources, as in `mergeFrom`, you should get map equality for `getSources` and the rest. The only place where you might have a problem is if you build up your own set of sources, in which case you have to ensure this prope",132413561,2014-06-30 23:32:38
4005175,7111,14383789,54,"So, we can merge with this now, but we need to add an issue to fix it.

mergeFrom should be idempotent, or it will be very difficult to use in interesting cases, specifically for the case I have in mind for making TypedPipe referentially transparent.",132413561,2014-07-01 05:31:31
4005175,52981,14383878,54,Okay. So you're proposing making a deterministic choice when keys collide?,132413561,2014-07-01 05:34:44
4005175,7111,14383951,54,"Well, the keys can collide with the same value, in that case there is no choice to make. You can still error if there are keys that collide, but the values are not equal.",132413561,2014-07-01 05:37:08
4005175,7111,14384030,47,is this test run as part of the travis build? It looks more like an example than a unit test.,132413561,2014-07-01 05:38:30
4005175,52981,14384091,47,"Correct, it currently won't be run. My plan is to test using the new Execution stuff in the next PR. I'd be happy to track these plans in Issues.",132413561,2014-07-01 05:40:53
4005260,7111,14259863,21,why do we need this at all?,131116870,2014-06-27 00:07:07
4005260,38527,14260670,21,"Doesn't seem like it is testing much, I agree, but I guess they wanted to test equality against an identically configured class that wasn't the same object",131116870,2014-06-27 00:18:54
4005260,7111,14261442,21,whatever...,131116870,2014-06-27 00:31:12
4007824,319889,14272439,4,how did this happen with the plugin? ,131307793,2014-06-27 04:12:18
4007824,38527,14272812,4,"Was wondering that myself. Maybe oscar's patch hadn't run scalariform? I don't think this is such a bad thing. Scalariform will carry us forward in an automated fashion. As long as the diffs aren't huge, shouldn't be a huge risk of merge conflicts.",131307793,2014-06-27 04:22:55
4035870,7111,14385150,22,"failure gives you a Throwable, not a stats. Don't think this should compile.",132518863,2014-07-01 06:17:43
4035870,7111,14385166,18,I guess you want: `ec.flowDef.mergeFrom(flowDef)`,132518863,2014-07-01 06:18:33
4035870,52981,14386412,61,"@johnynek Do you have any idea if this ""tmpJarsConfig"" stuff should stick around, or if I can just delete it like this?",132526305,2014-07-01 07:22:39
4035870,7111,14418408,55,"let's change this to a match:
```scala
replCodeJar match {
  case Some(jar) => ...
}
```",132532384,2014-07-01 22:46:12
4035870,7111,14418463,87,"`val (_, tryStats) = `
Will make it clearer you don't care about the return value.",132532384,2014-07-01 22:47:25
4035870,7111,14418555,51,"I assume so. What is happening here is that the code in the repl needs to make it to the mappers/reducers. This is how that happens. we should make that more clear in the comments.

For instance, each function is a subclass of FunctionN in scala, but a ",132532384,2014-07-01 22:49:01
4035980,7111,14386071,15,"why are any of these needed? You are not using tset. And tget can fall back to the default, I think, without an issue. Where is mf needed?",132521286,2014-07-01 06:59:34
4035980,7111,14386086,14,"Let's add a big warning comment that this should only be used for short term temporary files, as Kryo serialization is not guaranteed to be consistent from version to version.",132521286,2014-07-01 07:00:20
4035980,7111,14386096,35,don't think we need this.,132521286,2014-07-01 07:00:50
4035980,7111,14386113,56,"we don't need this, right?",132521286,2014-07-01 07:02:06
4035980,7111,14386143,66,"this is questionable. What if there was a huge filter? This will load a huge data set at then filter on the host. To start, let's just run the job no matter what.",132521286,2014-07-01 07:04:15
4035980,7111,14386161,66,"let's not do .toIterator, let's do .toIterable:
```def toIterable: Iterable[T] = new Iterable[T] {
  def iterator = /* put the iterator creating code here */
}
```",132521286,2014-07-01 07:05:54
4035980,7111,14386203,66,"Actually, you can keep this approach, but instead of checking if there is no previous, how about also checking if the flatMap function is a converter: https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/typed",132521286,2014-07-01 07:08:34
4035980,7111,14386207,80,lose the Manifests.,132521286,2014-07-01 07:08:50
4035980,52981,14386323,66,"Okay, so this would force a snapshot if any kind of operation was performed?",132521286,2014-07-01 07:16:25
4035980,52981,14386328,66,"Excuse me, meant to say if any kind of `map`, `filter`, etc operation was performed.",132521286,2014-07-01 07:16:47
4035980,7111,14417960,66,yes. That's right.,132521286,2014-07-01 22:36:42
4035980,38527,14420467,15,"In addition to Oscar's comment, for the ones you do actually need, if you don't reference them explicitly, in this case you can do class TypedSequencefile[T: Manifest: TupleGetter: TupleSetter]",132521286,2014-07-01 23:21:02
4035980,38527,14420614,24,same point as above. This can be apply[T: Manifest],132521286,2014-07-01 23:21:29
4035980,38527,14420655,35,"I imagine it's necessary for
```
val dest = TypedSequenceFile[T](tmpSeq)
```",132521286,2014-07-01 23:22:09
4035980,7111,14420852,35,That's circular. We don't need it for any of them is my claim.,132521286,2014-07-01 23:25:54
4035980,52981,14474166,66,"@johnynek I'm having issues with TextLine. I've figured out that the problem is that I need to use TypedPipeInst's `fields` (`sourceFields`) to select the right fields from the TupleEntry before passing it to flatMapFn.

Is there a way to do something l",132521286,2014-07-02 23:19:42
4035980,7111,14488150,47,"if you do: `cl: CascadingLocal` you will get both Local and Test modes, if we want to support Test (which might be nice).",133038468,2014-07-03 03:33:10
4035980,7111,14488278,69,"I think:

```scala
case TypedPipeInst(p, fields, Converter(conv)) if p.getPrevious.isEmpty =>
```
is better, and then you can use `.asScala.map { tup => conv(tup.selectEntry(fields)) }` rather than flatMap.",133038468,2014-07-03 03:36:49
4035980,7111,14488372,75,"prefer `sys.error` here. I would say ""Pipe has no previous, but there is no registered Source"" to make it clearer what the error is.",133038468,2014-07-03 03:37:38
4035980,7111,14488470,20,is this TODO still in play? Seems like toIterator is there above. Shouldn't this be removed?,133038468,2014-07-03 03:39:51
4035980,7111,14490307,17,this should be moved into the scalding.typed package. Sorry I didn't notice this before.,133031901,2014-07-03 04:29:40
4035980,7111,14490469,8,"I think the ValuePipe should perhaps get its own treatment. ValuePipe should have toOption because it is either a single value or empty, and snapshot does not make sense in this case, so you really want to just read the value.",133031901,2014-07-03 04:34:06
4035980,7111,14529071,13,"no commented code, please.",133332080,2014-07-03 23:08:17
4035980,7111,14529129,88,no need for the `()`,133332080,2014-07-03 23:09:16
4035980,7111,14537494,72,"why aren't these `implicit def flowDef: FlowDef = ...`.

I like to minimize the vars. Can we just make the ones in ReplImplicit vars?",133369939,2014-07-04 01:57:13
4035980,7111,14537680,97,should we add the EmptyPipe case?,133369939,2014-07-04 02:01:03
4035980,52981,14537784,72,"Oops, definitely didn't intend to make them ""var"".",133369939,2014-07-04 02:03:37
4035980,7111,14537803,123,"`tp.snapshot.toIterator.take(2).toList`

is is a bit safer, in the case there is some bug. It will still error, but it won't blow up the memory if there are 2 or more items in the list.",133369939,2014-07-04 02:04:08
4035980,7111,14538033,123,"actually, why not `tp.toIterator.take(2).toList`, why should we explicitly cass snapshot?",133369939,2014-07-04 02:09:06
4035980,52981,14538317,123,"It is an error to have more than one value in a ValuePipe, right? In the match, should I do a `sys.error` for case _?",133369939,2014-07-04 02:15:20
4035998,93705,14421776,25,"maybe something like this (inspired by  http://github.com/scala/scala-module-dependency-sample):
```
) ++ mimaDefaultSettings ++ (CrossVersion.partialVersion(scalaVersion.value) match {
      case Some((2, scalaMajor)) if scalaMajor >= 10 =>
         ",132523465,2014-07-01 23:40:38
4050231,7111,14535358,14,I think `mapValues(sg.sumOption(_).get)` should work here. The empty case does not come up: each key has at least one value.,133337028,2014-07-04 01:09:34
4058168,319889,14534655,17,Maybe we should make both of this and the flowProcess below private[this] ?,133361380,2014-07-04 00:55:09
4058168,7111,14534840,17,Yes! Good catch.,133361380,2014-07-04 00:58:24
4066424,7111,14572869,6,I think this should be 2.10.4.,134002347,2014-07-06 02:52:04
4137368,7111,14844819,169,"`.withGender.group` since this is already key, value form. Similar below.",136590588,2014-07-12 02:27:32
4137368,7111,14844839,173,"let's put a case match here. That is very hard to read. If you do .group above:

`case ((((name, gender), age), income), smoker) =>`",136590588,2014-07-12 02:27:56
4137368,7111,14844858,168,.swap.group,136590588,2014-07-12 02:28:18
4155914,319889,14908164,15,in?,137674882,2014-07-15 03:25:38
4155914,7111,14908244,15,woops.,137674882,2014-07-15 03:27:38
4155914,319889,14908288,28,With this before was .join not possible?,137674882,2014-07-15 03:29:05
4155914,7111,14908467,28,"You could do this enrichment, but you had to explicitly import it. That is another way to go, just make this class what we enrich to. It more narrowly constrains the enrichment.

That said, it seemed like HashJoinable was the right place to jump in, sin",137674882,2014-07-15 03:34:14
4155914,319889,14908614,28,"yep, fair enough. it also moves to the newer .withReducers code paths too. ",137674882,2014-07-15 03:38:00
4167074,319889,14975805,5,Seems like a bad whitespace change,138130833,2014-07-16 05:11:23
4167074,319889,14975853,36,Why all the excludes?,138130833,2014-07-16 05:12:48
4167074,319889,14975990,50,what do these functions have to do with lingual?,138130833,2014-07-16 05:17:04
4167074,1852479,14976062,36,I was running into errors during assembly mentioning that I have duplicate jars.  Testing without the excludes now.,138130833,2014-07-16 05:19:42
4167074,1852479,14976120,50,"Not much, would there be a better place for these extensions to live?  The lingualTap function is mostly a work around because Scalding has a sealed trait if I remember correctly around where a similar operation is done during a Source.read.",138130833,2014-07-16 05:21:18
4167074,38527,15073031,38,"This (and openFile, for example) have no dependency to the rest of the code. Consider moving into the class object so it stays that way, and it's clear what are just short utilities, and what aren't?

Either that or make them private. I'm questioning th",138985264,2014-07-17 22:57:15
4167074,38527,15073068,43,don't need the outer curlies,138985264,2014-07-17 22:57:57
4167074,38527,15073187,48,"I'm going top to bottom so I will see when lines is used, but is it expected to the user that if the count they pass in is greater than the number of lines, that they will get a list of size <= count ",138985264,2014-07-17 22:59:52
4167074,38527,15073206,43,"Does it need to be a list vs. Seq, IndexedSeq, etc?",138985264,2014-07-17 23:00:10
4167074,38527,15073231,53,don't need the outer curlies,138985264,2014-07-17 23:00:32
4167074,38527,15073239,55,don't need the curlies,138985264,2014-07-17 23:00:43
4167074,38527,15073277,64,"toSeq feels like further evidence that the return type of lines should be Seq, and it should just be consistent all the way through in the type that you need",138985264,2014-07-17 23:01:13
4167074,38527,15073317,58,why is toArray necesasry before .iterator? Isn't there a .iterator or .toIterable on every collection type?,138985264,2014-07-17 23:01:42
4167074,38527,15073448,53,"also, isn't this also kind of a ""take"" semantic, and could be called as such?",138985264,2014-07-17 23:03:39
4167074,38527,15073476,65,This error doesn't make sense to me,138985264,2014-07-17 23:04:00
4167074,38527,15074750,32,Why is this necessary?,138985264,2014-07-17 23:24:51
4167074,38527,15074870,48,What is the intended use of this? I feel it should have a more descriptive name,138985264,2014-07-17 23:26:59
4167074,38527,15075510,44,"I realize this is in line with the dsl style approach of scalding originally, but I wouldn't mind seeing this be expressed in methods rather than implicit mutation of everything. The LingualJob is particularly mutation heavy... instead there could be

d",138985264,2014-07-17 23:35:27
4167074,1852479,15091577,43,"The list is a little odd, originally I was returning a seq by calling a toSeq but it does something unexpected on the iterator.  It returns a Stream object. Now the issue is that I return a few stream objects so later on when I try to instantiate the stre",138985264,2014-07-18 05:01:14
4167074,1852479,15091615,48,Renamed it to take from lines.  Matches up more with the scala collections function so hopefully will make more sense to the user.,138985264,2014-07-18 05:02:38
4167074,1852479,15091856,44,"I was going with this approach to make it a bit closer to how you would use a sql database.  With some of these functions and more so with the REPL code that will come later I am trying to make the library easy to understand for people new to Scala.

So",138985264,2014-07-18 05:12:17
4167074,1852479,15091946,32,"Git doesn't seem to show my the correct line here, what line of code are you referring to?",138985264,2014-07-18 05:16:17
4167074,360025,15272303,52,where is this used?,138985260,2014-07-23 10:58:35
4167074,360025,15272364,44,[I am still new to scalding/cascading ] can this work with a TypedPipe/Pipe so that user can easily map fields to produce flattened fields required for Lingual query?,138985260,2014-07-23 11:02:43
4167074,1852479,15292474,52,"No where yet, I originally wrote this code to work as a normal Job and also in the REPL.  This code was a remnant of the REPL code that I didn't refactor out.  I am going to do a pull request for the repl code after this gets in so I figured maybe I shoul",138985260,2014-07-23 19:58:39
4167074,1852479,15292590,44,Should work with either Typed or RichPipe.  In both cases you need to give the fieldNames though because lingual needs names on the fields for the query.  ,138985260,2014-07-23 20:00:15
4167074,38527,17136234,39,with implicits it's always good practice to make the return type explicit (mainly because it the class hierarchy is changed later on it could change the implicit functions in ways you do not expect),157604597,2014-09-05 00:27:22
4214267,7111,15209637,18,I'm wondering if this should be configurable? Are there cases where you might simply want to fail in this case?,140275355,2014-07-22 08:51:14
4214267,453150,15215746,18,"Good question, but by default it can be assumed that generating lines of JSON will at least generate some trailing lines which should not make it fail. If you wish I can add a constructor parameter.",140275355,2014-07-22 13:26:28
4214267,453150,15745502,18,"So, should I modify it, or can it be merged the way it is?",140275355,2014-08-04 13:46:51
4214267,319889,15765974,18,Can you modify it and have the current behavior remain constant with what it is? It avoids this being a breaking change on users at run time. ,140275355,2014-08-04 21:51:19
4216005,7111,15208006,16,This could probably be done in toPipe: we could copy the FlowState for the localFlowDef into the target one.,140343663,2014-07-22 07:23:57
4216005,7111,15208220,341,there is no need for this map. Just cast the whole pipe at once.,140343663,2014-07-22 07:34:14
4216005,7111,15208228,355,this has been fixed in this commit.,140343663,2014-07-22 07:34:37
4216005,7111,15209219,259,"this should definitely be private, so I guess no case class.",140355350,2014-07-22 08:27:42
4216005,7111,15209416,58,this code is relying on the fact that it can access the flowDef. It does not mutate it though. This should be refactored.,140355350,2014-07-22 08:37:30
4216005,7111,15268015,69,"note, this is just putting all this code inside a ContinuationTypedPipe, no other change. Better diffs would be good.",140729183,2014-07-23 06:55:10
4216005,7111,15268054,20,call this outside the closure to help serialization.,140729183,2014-07-23 06:57:04
4216005,7111,15268097,69,Get the joinFunction and inputs out before we use them below to avoid closing over `this`.,140729183,2014-07-23 06:58:57
4216005,7111,15268127,27,minimize the vals we are closing over here.,140729183,2014-07-23 07:00:49
4216005,7111,15268165,132,todo Add this back to IterablePipe to avoid triggering a map-reduce job if not needed.,140729183,2014-07-23 07:02:41
4216005,7111,15268412,195,we may need WeakHashMaps for all these ContinuationTypedPipe instances to memoize multiple calls with the same FlowDef. We needed something like that in Summingbird.,140729183,2014-07-23 07:17:31
4216005,38527,15322793,4,throw an error on null until such case?,141110913,2014-07-24 04:35:25
4216005,52981,15363614,64,forgot to remove these extra lines?,141110913,2014-07-24 23:27:01
4216005,7111,15366643,64,"those are there for someone to see the minimal change, that would compile without the annotation. So, you can type check it, then erase the type yourself (replace with Any), then use tailrec.",141110913,2014-07-25 00:21:01
4216005,52981,15369502,64,"ah, thanks for clarifying.",141110913,2014-07-25 01:12:43
4216005,38527,15381788,30,?,141110913,2014-07-25 05:54:46
4216005,38527,15381861,32,couldn't the type checker have all of this information? did you just not want to complicate the types?,141110913,2014-07-25 05:57:32
4216005,38527,15381933,60,Ah I think that answers the above,141110913,2014-07-25 06:01:35
4216005,38527,15382004,64,"Hm, this clarification is useful and is not immediately obvious when reading the code. Not sure of the best way, as a verbose comment might not be ideal. Perhaps we can have a verbose explanation in one place, then refer other examples to that?",141110913,2014-07-25 06:04:59
4216005,319889,15382010,4,"good notice/catch, maybe file issue to link from here?",141110913,2014-07-25 06:05:13
4216005,7111,15382179,30,That is a mistake.,141110913,2014-07-25 06:12:46
4216005,7111,15382268,4,"Good idea. In fact, JobStats is a bit janky, in my mind. I think it should be something like:
```scala
trait JobStats {
  def totals: Map[StatName, Long]
  def steps: Seq[JobStats]
}
```
And then we can define a monoid on them and just add them up.",141110913,2014-07-25 06:17:13
4216005,38527,15382531,282,What's the value of Any vs the wildcard type?,141110913,2014-07-25 06:26:21
4216005,7111,15382613,64,I'll just remove the comments. It is kind of obvious that you could make it type-check without the tailrec. I'll just leave the comment that the cast is needed for tailrec.,141110913,2014-07-25 06:29:06
4216005,7111,15382625,282,"I figured we should be consistent. Since tuple and TypedPipe are both covariant, there is no reason not to put Any there.",141110913,2014-07-25 06:29:41
4216005,38527,15382700,484,"This is the type we expect to be referentially transparent, yes? May be worth stating that as its purpose.",141110913,2014-07-25 06:32:01
4216005,7111,15382720,484,All of them are now. Even TypedPipeInst.,141110913,2014-07-25 06:32:57
4216005,38527,15382743,334,should these be public even? It almost makes sense for TypedPipeFactory and TypedPipe to be the only visible types,141110913,2014-07-25 06:33:39
4216005,38527,15382761,484,"Badass. Am reviewing everything and then will give that guarantee a very specific looking over, esp. the cascading interactions.",141110913,2014-07-25 06:34:21
4216005,38527,15382803,524,"I know you get a localFlowDef above, but do you think it's special enough to warrant expressing how we expect this to be used internally?",141371912,2014-07-25 06:36:19
4216005,7111,15382810,484,"Yeah, cascading Pipe has no mutable members, but who knows if he'll change that, but for now, it is fine.

The flowDef is a copy of the subset associated with this pipe.",141110913,2014-07-25 06:36:27
4216005,7111,15382828,334,"Good question. It can be useful to pattern match on some of the cases inside of scalding, but maybe you are right. Maybe all the instances should be `private[scalding]`",141110913,2014-07-25 06:37:14
4216005,38527,15382841,525,"Musing here: if we had TypedPipeFactory as our main TypedPipe, couldn't we get rid of the need for a flowDef/mode dep _anywhere_, and any time we need it, make a new TypedPipeFactory and compose it in?",141371912,2014-07-25 06:37:40
4216005,7111,15382842,334,"Is that a request for a change, BTW, or just a question? I feel like we can punt to a later more deliberated answer to this.",141110913,2014-07-25 06:37:47
4216005,38527,15382856,334,"Fine with punting, let's make an issue and discuss there. I think going private[scalding] is a good idea, not critical for this pr",141110913,2014-07-25 06:38:37
4216005,38527,15382877,533,no no filtering should be no filtering,141371912,2014-07-25 06:39:38
4216005,7111,15382922,525,"We would break old code by doing that. There are APIs that expect to be able to pass in a Pipe, and they are in use heavily.",141371912,2014-07-25 06:41:31
4216005,7111,15382946,533,this is really confusing to read. Github is not showing me context below. Are you pointing out a grammar error? I'll check the file to be sure.,141371912,2014-07-25 06:42:35
4216005,38527,15382965,533,"yeah, it's a grammar error. you repeat no twice",141371912,2014-07-25 06:43:26
4216005,7111,15382970,533,"Ahh, ""no no filtering"" should be ""no filtering"" in the comment. Got it.",141371912,2014-07-25 06:43:40
4216005,38527,15382998,525,"Yeah, thus the musing, though even that could go away. The cool thing about making it completely decoupled would be that it would make the TypedPipe api almost completely isolated from cascading, and easier to use with other systems.

I do think the pip",141371912,2014-07-25 06:44:45
4228308,7111,15302671,69,looks like these comments are out of sync.,140800301,2014-07-23 22:41:28
4228308,7111,15302746,80,can you add the TestTapFactory call here so that people can mock this source using JobTest?,140800301,2014-07-23 22:43:11
4228308,7111,15302837,39,can you add more comments and a link to cascading as to what the format of this template should be?,140800301,2014-07-23 22:44:42
4228308,7111,15303491,33,we have often found regexs to be quite slow. It might be worth adding a TODO note for other kinds of partitions that might could work without regex.,140800301,2014-07-23 22:54:58
4228308,1123342,15453248,69,Fixed.,140800301,2014-07-28 14:24:14
4228308,1123342,15453287,80,I have added TestTapFactory and HadoopTest.,140800301,2014-07-28 14:25:21
4228308,1123342,15453550,39,"Will do. Template is just a format string such as ""%s/%s"".

It's actually not a cascading thing. In order for Cascading Partition tap to work you need to provide it with something that extends the Partition interface, which has two keep methods:
* `toT",140800301,2014-07-28 14:32:46
4228308,1123342,15453575,33,I can think of some alternate Partition schemes I could add that don't use regex.,140800301,2014-07-28 14:33:21
4242143,7111,15383432,29,"default is a weird term because in fact, both can be applied.",141374318,2014-07-25 07:06:56
4242143,7111,15383919,43,"can you comment on what this is testing?

I'd like to see it test the reducer estimation, but I don't see that here.",141374318,2014-07-25 07:20:36
4242143,38527,15384707,37,"on a new line, my friend!",141374333,2014-07-25 08:09:30
4242143,38527,15384731,59,"we are going to have to see how many reducers were set, right? should be doable by looking for the part files that we expect? as of now I'm not sure that we're testing that it got invoked, no?",141374333,2014-07-25 08:11:05
4242143,52981,15411467,29,"Well, if you set a stepStrategy here it would override the reducer estimator provided by ExecutionContext.buildFlow. So I don't think you can have both. Perhaps default isn't the right way to describe it regardless.",141374318,2014-07-25 21:53:18
4242143,52981,15411521,43,"yeah, didn't figure out a way to check that. Looks like @jcoveney may have an idea (checking the part files for the output).",141374318,2014-07-25 21:54:29
4242143,52981,15411586,59,"that's a good idea, I'll give it a try.",141374333,2014-07-25 21:56:07
4242143,7111,15411718,29,I thought cascading allows you to have more than one. I didn't check carefully though.,141374318,2014-07-25 21:59:02
4242143,1847115,15416016,59,Is it possible to get the JobConf and run getNumReduceTasks() on it? AFAIK there is no contract on the number of part files being same as the number of reducers (although it is generally true).,141374333,2014-07-25 23:17:10
4242143,38527,15423597,59,"you can get the conf, but not the jobconf. jobconf is tricky because it's kind of meaningless if there's a multistage job?",141374333,2014-07-26 01:46:08
4242143,52981,15424023,59,"I'm working a way to get the flow steps out, each should have its own JobConf which we can inspect. I'll ping when I've pushed.",141374333,2014-07-26 01:55:24
4242143,7111,15485874,23,"Is this being used? I am nervous about it causing serialization errors. All kinds of things in scalding are serialized, and loggers have given issues before.",142811615,2014-07-29 00:49:50
4242143,7111,15485996,17,where is this used? #serializationanxiety,142811615,2014-07-29 00:52:08
4242143,7111,15486121,39,can you add the reason for this?,142811615,2014-07-29 00:54:41
4242143,7111,15486309,1,"maybe reducerestimator or runtimeconfig? We need something more descriptive than estimator, or more general (something to encompass flow plan changes?)",142811615,2014-07-29 00:57:39
4242143,52981,15486412,1,"Absolutely. Which would you prefer? I guess the question is, what else can you imagine putting in this package?",142811615,2014-07-29 00:59:09
4242143,52981,15486462,1,"also, since package names are generally lowercase, do we need an ""_"" for separating words? Can we come up with a single-word name?",142811615,2014-07-29 00:59:51
4242143,52981,15486666,23,"my bad; those were in there to report the exceptions (ClassNotFoundException, InstantiationException) that we decided to just throw now.",142811615,2014-07-29 01:03:24
4242143,7111,15605200,1,I guess reducer_estimation is good. Naming is hard.,142811615,2014-07-31 00:08:49
4242143,52981,15606498,1,Works for me. Long names with tons of subdirectories is the name of the JVM game.,142811615,2014-07-31 00:32:51
4242188,38527,15384478,18,"Still reading the code so I'm just tossing stuff out as I go along, but this seems like a Reader[(Config, Mode, ConcurrentExecutionContext), Future[T]] ?",141374806,2014-07-25 07:55:17
4242188,7111,15384605,18,"sort of, but actually it should be a `ReaderT[WriterT[ImmutableFlowDef], (Config, Mode, ConcurrentExecutionContext), Future, T]` or something like that. There are three monads here, Reader, Writer, Future.",141374806,2014-07-25 08:01:17
4242188,38527,15421860,54,"so right now, it's common to do pipe.stuff.write(sink).stuff.write(sink2) and so on...if we want to encourage functional purity, we'd force the user to compose executions, right? I wonder if it would be useful to have another
```
def writeThrough(dest: ",141374806,2014-07-26 01:11:28
4242188,38527,15422089,143,"some serious pedantry here but can you bump this above the comment? for our less monad aware viewers it could be confusing. like I said, serious pedantry. that's how good a review this is :P",141374806,2014-07-26 01:15:49
4242188,319889,15422200,54,"I'm not sure it is, that example would all be part of one execution right? what does writeThrough mean there? we force write it out and resume from there? ",141374806,2014-07-26 01:18:33
4242188,7111,15422328,54,"We could add that easily. snapshotExecution is similar, you just don't control the task.

Alternatively:
```scala
val forked = somestuff.fork
val ex1 = forked.writeExecution(sink)
val ex2 = someMore(forked)
zip(ex1, ex2).unit : Execution[Unit]
```",141374806,2014-07-26 01:20:08
4242188,38527,15422381,54,"Edit: I wrote this before I saw oscar's, but I think it still stands

That's what I wasn't sure about. I mean once they do .write(), how can they continue computation?

If you have (tpipe:TypedPipeFactory).stuff.writeExecution(sink), now you're stuff.",141374806,2014-07-26 01:21:06
4242188,38527,15422749,36,"This is where my knowledge of the ExecutionContext is somewhat lacking, but why not pick it up here as well?",141374804,2014-07-26 01:28:18
4242188,7111,15422992,54,"it is like summingbird .also. If you don't .zip them, one of them will be ignored. Watch out!

you can also flatMap them.",141374806,2014-07-26 01:33:21
4242188,7111,15423299,36,"So, ExecutionContext was a first take on this, but the mutable FlowDef makes composition really tough. We are reusing a lot of what is going on with that, but the advantage to just calling Await on the future is that we only have one function to compose (",141374804,2014-07-26 01:40:14
4242188,319889,15423382,18,"On a similar note, should we lift this out to have a ScaldingExecution[...], this seems like something that would be useful outside of scalding jobs themselves. -- Though i'm quite in favor of getting this down and abstracting later also.",141374806,2014-07-26 01:41:44
4242188,319889,15423469,36,"This does sound reasonably like the twitter Future model of a fall back scheduler, it might be nice to avoid that pattern. But we may want a default execution context..implicit global maybe not ideal however? Thoughts?",141374804,2014-07-26 01:43:15
4242188,7111,15423983,54,"So, the problem if we flatMap an Execution, it is going to push it into two flows. a Zip will be only one.

Let's recall, to make this pure, all the side effects (write) must wind up in the Execution type. So, they can use for (which will sequence thing",141374806,2014-07-26 01:54:43
4242188,7111,15424132,54,"What about a method like:

```scala
def zipAll[T](exs: Seq[Execution[T]]): Execution[Seq[T]] =
```
And then you capture all your job into one.

How does that sound?",141374806,2014-07-26 01:57:40
4242188,7111,15425765,36,"From what I read, global is almost always used and does the right thing most of the time. Since very little work is done in futures, I don't think it is critical, and given that users can always use their own ExecutionContext with run, I figured this conv",141374804,2014-07-26 02:34:50
4242188,38527,15440612,77,"I'm trying to think if this could break people...it definitely will if fn has side effects. Trying to think if there are ""more legitimate"" cases where it would as well... ie where they need the computation to happen but don't care about the result.

Sti",142219406,2014-07-27 22:59:53
4242188,7111,15440991,77,"I  would say, that is not map, that is foreach. Map is pure. We make the assumption that mapping functions are pure all the time.

By the way, what kind of side-effect would be safe to apply?",142219406,2014-07-28 00:14:19
4242188,38527,15441003,77,Hm. I mean I agree with you. I suppose we will just punish people who abuse the API :),142219406,2014-07-28 00:17:39
4244914,319889,15422497,23,while in here maybe just mention that we do a rename all the individual pipes -- or are we just assigning names now? ,141407339,2014-07-26 01:23:26
4244914,7111,15422783,23,"right now, we just make an identity pipe `(new Pipe(newName, previous))` with a new unique (just integer increment now) name, but only if there is more than one pipe going into the merge.

I'm not totally clear what I should add. Suggestions?",141407339,2014-07-26 01:29:04
4244914,319889,15423752,23,"Just a note that we must rename the pipes if we use the merge call since cascading can't handle the multiple pipes possibly with the same name? -- ""When using the merge primitive we rename all pipes going into it as Cascading cannot handle multiple pipes ",141407339,2014-07-26 01:49:37
4256742,38527,15440715,19,"If the goal is explicitly to bring it into memory, should the type reflect that? ie a Seq? Or do we want to say ""yeah it's in memory, but that impl could change""?",141533310,2014-07-27 23:16:00
4276373,7111,15505080,34,"this should just take Any, and not put the .get(""counters"") inside.",142932425,2014-07-29 09:07:53
4276373,44017,15505440,12,this comment were confusing or incompl,142932425,2014-07-29 09:27:15
4276817,38527,15549231,67,"Hmm, I'm wondering if this might be one of the cases where a .forceToDisk or a .fork might be prudent. Thoughts, @johnynek ?

Also, you could do the map before applying the predicates, since we map them to the exact same thing.",142958306,2014-07-30 01:18:33
4276817,1825352,15561782,67,I can do the map first before creating two pipes using the predicates and add a .forceToDisk there. Is that more recommend?,142958306,2014-07-30 05:41:12
4276817,7111,15561983,67,I don't think we need to add another. These two paths are separate since they are grouped differently.,142958306,2014-07-30 05:48:54
4295784,7111,15731022,184,there is no reason for these first two to be in Future threads.,144801704,2014-08-03 01:05:52
4295784,7111,15731031,5,this should probably not be here. Looks like something superseded by Ian's work.,144801704,2014-08-03 01:06:41
4295784,319889,15731036,5,Correct has been since moved into a bash script.,144801704,2014-08-03 01:07:45
4306270,1825352,15678183,9,We may need some rules of thumb of when to use this V.S when to use Group operation.,144188076,2014-08-01 05:33:41
4306270,38527,15678334,5,s/ in / into/,144188076,2014-08-01 05:41:20
4306270,814892,15706975,9,"I think it would be partition when you want to split your 'dataflow' into two, groupBy when you want to create a grouping in the same dataflow?

Anything else that comes to mind? I'm still partially hung over in the fields API world so might be missing ",144188076,2014-08-01 22:09:24
4306270,814892,15707049,5,Fixed.,144188076,2014-08-01 22:10:40
4316411,7111,15730480,78,"so, we need to run scalding-repl/assembly to create the assembly here, I guess? Should we make the error string below mention that for the case of the repl? It just says sbt assembly on line 261.",144690338,2014-08-02 23:34:55
4316411,319889,15730589,78,"True, I made this change just so you didn't need to compile everything to run the repl. I'll update the error strings",144690338,2014-08-02 23:45:02
4332249,7111,15771758,13,you probably need to update the .travis.yml now since all the tests run in separate test jobs (due to them getting too large for Travis to deal). Chat with @ianoc ,145253869,2014-08-04 23:25:39
4332249,7111,15771849,14,"should we go ahead and pass in `Seq[FlowStep[JobConf]]` here? I think so. I don't like passing mutable objects (but I realize that Flow and FlowStep are mutable, but at least we can minimize).",145253869,2014-08-04 23:27:04
4332249,7111,15772016,41,"I would prefer a combinator pattern here. We should not have a fallback val, instead how about:

```scala
case class FallbackEstimator(first: ReducerEstimator, orElse: ReducerEstimator) extends ReducerEstimator
```
If you want to geek out, there is a",145253869,2014-08-04 23:29:45
4332249,7111,15772056,33,good catch. I guess we forgot this case.,145253869,2014-08-04 23:30:23
4332249,7111,15772157,24,can you explain this in a comment? required is confusing. It seems like getFirstKey or something to me.,145253869,2014-08-04 23:31:57
4332249,7111,15772240,45,"not a good thing to have in a private val. Pretty sure this does not belong in the open source version.

Perhaps API_HOSTNAME is an abstract def?",145253869,2014-08-04 23:33:19
4332249,7111,15772338,55,not helpful to have go/jira links in public code.,145253869,2014-08-04 23:34:48
4332249,7111,15772802,7,"I'd prefer if we could break this in two:

1) An abstract class that has a method like
```scala
case class InputSizes(mappers: Long, reducers: Long)

// implement this
trait HistoryService {
  def getHistory(f: FlowStep[JobConf], max: Int): Seq[In",145253869,2014-08-04 23:41:50
4332249,52981,15779956,41,"I guess I was imagining that there would usually a pretty intuitive choice for each estimator which one should be the thing to fall back to. But I guess we can't necessarily assume estimator succession will always be tree-like.

Estimator is specified a",145253869,2014-08-05 01:47:39
4332249,52981,15780033,33,"Yeah, this worried me — first analytics batch job I ran exposed this. Are there any other cases you can think of that don't implement Hfs that may come up?",145253869,2014-08-05 01:49:13
4332249,7111,15780965,33,"None that I know of.


On Mon, Aug 4, 2014 at 10:49 AM, Brandon Holt <notifications@github.com>
wrote:

> In
> scalding-core/src/main/scala/com/twitter/scalding/reducer_estimation/InputSizeReducerEstimator.scala:
>
> >      val fs = f.getPath.get",145253869,2014-08-05 02:04:29
4332249,52981,15781252,45,"Oops!

Seems like it'd be better as another config parameter?",145253869,2014-08-05 02:09:05
4332249,52981,15786126,7,"I think I'm confused by the structure you're proposing. 
- How does this allow for different HistoryService implementers to provide different history info? (presumably other ReducerEstimators will take into account more than mapper/reducer input sizes)
",145253869,2014-08-05 03:37:13
4332249,52981,15786677,7,Would it be useful to parameterize `HistoryService` on what kind of history information it returns?,145253869,2014-08-05 03:51:43
4332249,230143,15787004,41,"+1 for combining registers instead. You could also imagine additional things like `FirstPossibleEstimator` that tries a bunch of strategies and takes the first one that succeeds or something.

I think getting a list of estimators and monoid them togethe",145253869,2014-08-05 03:59:23
4332249,7111,15789922,45,"these could be defaults that also could be configured in the conf, right?",145360724,2014-08-05 05:31:13
4332249,7111,15790111,7,"Perhaps, but if it is that generic, how can you compose at all? Seems like this might be a case where bottlenecking on a common subset of information could make it easier to reuse. How can I make use of a `HistoryService[T]` unless I have some kind of `Hi",145253869,2014-08-05 05:34:27
4332249,7111,15790137,12,"still really opposed to this and preferring the `case class FallbackEstimator` approach. Combinators are the future. When things compose, we should leverage that.",145360724,2014-08-05 05:35:39
4332249,7111,15790266,106,"this should not take conf as an arg. Just capture it in the closure. If you are going to use inner functions, it is best to leverage the closures as much as possible, in my view.",145360724,2014-08-05 05:40:45
4332249,7111,15790300,90,I tend to think this should return a Try[JobDetails] to make sure we handle all the possible exceptions of this code.,145360724,2014-08-05 05:42:06
4332249,52981,15837862,106,Ah good call.,145360724,2014-08-06 01:05:04
4332249,52981,15841601,7,"I guess what I'm trying to figure out is what the expected extensions/reuse patterns will be. I suppose there are probably several different services which could provide job history info, so abstracting out hRaven is fine in this regard. But I imagine mos",145253869,2014-08-06 02:02:29
4332249,52981,15892911,90,"Okay, but then we handle the exceptions in the HRavenHistoryService before passing back a `Seq[FlowStepHistory]`? (sorry, using my names for these things)

The unhandled exceptions right now are IOExceptions related to the hRaven REST client, which I fi",145360724,2014-08-06 23:24:53
4332249,7111,15913926,95,can you use the forName with getCurrentContext? That seems to be correct thing (or at least what cascading and hadoop do in several places) to get the classloader for the current thread.,146880070,2014-08-07 06:09:06
4332249,7111,15913949,41,Can we remove this now?,145253869,2014-08-07 06:09:57
4332249,7111,15914140,87,Why does this subclass InputSizeReducer? I think the better way is to use the Monoid as a fallback to InputSizeReducer than subclass here.,146880070,2014-08-07 06:17:47
4332249,7111,15914160,101,why is this here? Is there really any evidence this is a problem? Why not just try our best?,146880070,2014-08-07 06:18:54
4332249,7111,15914189,112,why not take more than 1 and do the total sum?,146880070,2014-08-07 06:20:05
4332249,52981,15948123,87,"InputSizeReducerEstimator's `totalInputSize` and `estimateReducers` functionality are both used in `estimateReducers` below (line 106,108).",146880070,2014-08-07 21:55:54
4332249,52981,15948189,101,"Not a particularly well grounded argument, but I copied this from the Pig estimator.",146880070,2014-08-07 21:57:01
4332249,7111,15968582,120,"Should this also have a RichDate for when that job ran?

One idea would be to use a sealed trait here so we can add more to it later without breaking the code. We can still have some apply methods that create these so FlowStepHistory(10L, 1L) would stil",146880075,2014-08-08 03:27:46
4332249,7111,15968846,87,ok.,146880070,2014-08-08 03:34:33
4332249,7111,15968991,180,why case class? Why not just class here?,146880075,2014-08-08 03:37:34
4332249,7111,15969052,129,"should this be a Try[Seq[FlowStepHistory]] so the caller can decide how/if to log and can tell the case where you got no response from the case of an empty response?

I tend to think so.",146880075,2014-08-08 03:39:28
4332249,52981,16003647,120,"Cool, I didn't know what sealed traits did. Seems like a plan.

So far, I haven't added RichDate. Is it a big deal for someone to add it whenever they need it?",146880075,2014-08-08 22:00:49
4332249,52981,16003663,129,Good point. I'm working on this now.,146880075,2014-08-08 22:01:12
4332249,7111,16021490,19,just noticed this method does not really depend on `T`. Scalac should probably warn or error on unused type parameters.,146880083,2014-08-09 04:18:32
4332249,52981,16021998,19,good catch,146880083,2014-08-09 04:41:05
4345345,38527,15893162,39,"is the purpose of this to make idF available internallyk, or to somehow change/manipulate it? This matters because any change to the id won't be represented in the underlying Tap. We can just surface the info.",145800821,2014-08-06 23:28:20
4345345,44695,15893616,39,"> 
> is the purpose of this to make idF available internallyk, or to somehow change/manipulate it? This matters because any change to the id won't be represented in the underlying Tap. We can just surface the info
> 
> 

you cannot change the value o",145800821,2014-08-06 23:34:43
4345345,7111,15894771,39,"Note the following facts:
1) We are not ""changing"" and ids, we are initializing them in the constructor to be the same as the Id of the proxy. Can you comment as to why that is dangerous? It seems the tests pass?

2) As for adding Metadata, I would act",145800821,2014-08-06 23:51:47
4345345,44695,15899348,39,"
> Note the following facts:
> 1) We are not ""changing"" and ids, we are initializing them in the constructor to be the same as the Id of the proxy. Can you comment as to why that is dangerous? It seems the tests pass?
> 
as of 2.5.6 the id is immediat",145800821,2014-08-07 00:58:43
4345345,7111,15899568,39,"It would be nice to have Pipe have a decorator, but we don't use SubAssemblies so far in scalding (other than the AggregateBy for some code in the Fields-API of scalding).",145800821,2014-08-07 01:02:08
4345345,44695,15899711,39,"lets start with a MetaTap, and I can try a MetaPipe later.

On Aug 6, 2014, at 1:02 PM, P. Oscar Boykin <notifications@github.com> wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/cascading_interop/ProxyTap.scala:
> 
> > +
> > +import",145800821,2014-08-07 01:04:24
4345841,7111,15852090,10,"is there a per-user tmp directory on hadoop or are we going to hit the same issue here?

Should we not use the subdirectory and just use a file ""/scalding-repl-"" + randomUUID ?

Did you test that this fixes our issue?",145818717,2014-08-06 06:21:08
4345841,52981,15852172,10,"Yes, we get ""hadoop.tmp.dir"" = ""/tmp/hadoop-${user.name}"" which resolves correctly to a per-user temp directory.",145818717,2014-08-06 06:24:11
4365853,360025,15979181,6,"aka 'secondary sorting' in Hadoop. Could say 'All sorting methods defined here trigger Hadoop secondary sort on value. i. e. won't materialize all values of each key in memory on the reducer'. 

I should add a description to recent 'qna' expanding on an",146646756,2014-08-08 11:04:07
4365853,360025,15979183,6,most often one would use mapValueStream() rather than mapGroup() for this purpose (since key is often not used).,146646756,2014-08-08 11:04:13
4365853,1825352,15981257,6,"Sure, this makes the comments further clearer.",146646756,2014-08-08 12:51:48
4365853,1825352,15981312,6,Added this to comments.,146646756,2014-08-08 12:53:56
4390831,7111,16220435,44,"you say current directory here, but you are actually getting the user's home dir.

I like the idea of a current directory so I could put some .scalding_repl file in my science directory have that different from my home. Am I missing this?",149576415,2014-08-14 09:03:54
4390831,52981,16223451,44,"Actually, this property is named kind of confusingly. ""user.dir"" is the current working directory (of the user, I guess...)

~~~scala
scala> System.getProperty(""user.dir"")
res0: java.lang.String = /Users/bholt/dev/hub/scalding

scala> System.getProp",149576415,2014-08-14 11:53:05
4403935,7111,16220514,21,can you comment on this change? Why is this needed?,149082195,2014-08-14 09:10:31
4403935,7111,16220522,3,should this be a var so users can control it at the repl?,149082195,2014-08-14 09:11:09
4403935,52981,16222953,21,It has to do with #1014. This forces JobConf to evaluate expressions before handing over the value. I'll add a comment to this effect in the code to avoid future confusion.,149082195,2014-08-14 11:34:21
4403935,52981,16223099,3,"hmm. Config is immutable, but I suppose they could just assign a modified version back to the var",149082195,2014-08-14 11:41:00
4403935,52981,16223297,3,"Just kidding, it's totally intuitive:

~~~scala
scalding> config += (""foo"" -> ""1"")
scalding> config.get(""foo"")
Option[String] = Some(1)
~~~",149082195,2014-08-14 11:47:32
4403935,7111,16253219,9,"+1 to this change. To use scalding you must, in scalding, set the ioSerializations key. It is a pain that we have all these special cases in the config. But given the way hadoop works, it seems that special cases are the only way around.",149911509,2014-08-14 22:40:19
4403935,7111,16257239,8,"actually, can we do this just once? We might need to make a fresh jar for every run to ship to the mappers. I'm not 100% sure, but the safest course might be to have config be the way you have it, but a replConfig or executionConfig that is a def that add",149920372,2014-08-14 23:37:30
4403935,52981,16259716,8,"Valid concern. To avoid voodoo, I'll do some investigating to see what the deal is.",149920372,2014-08-15 00:14:57
4403935,52981,16268798,8,"Alright, touché. We do need to re-create that jar each run. Can't replicate with ""--hdfs-local"", unfortunately, so don't know of an easy way to test it automatically.",149920372,2014-08-15 02:49:19
4403935,7111,16270544,8,"For now, this is fine. We should add an Issue to test the repl with the minicluster.

Glad we caught it before it was an issue.",149920372,2014-08-15 03:21:54
4403935,52981,16270733,8,Created #1020.,149920372,2014-08-15 03:26:25
4530568,319889,17028094,12,This one isn't recoverable is it? do we want this one to be the old exception maybe?,155055765,2014-09-03 06:59:18
4530568,1240572,17029777,12,"We do not have a choice, given the API specification (and there is code that depends on that
specification being observed). See https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/Source.scala#L154",155055765,2014-09-03 08:22:04
4543159,7111,17192779,73,"Could we recurse here if there is a member that is a case class? We could get an instance, cast to Tuple, and materialize the converter for that item.
",156570735,2014-09-06 00:34:12
4543159,38527,17192859,73,"I wasn't sure about what the proper flow here was for nested cases classes. Is the desire that any and all case classes should be turned into tuples in a nested fashion? If so, yes, we definitely can.",156570735,2014-09-06 00:35:53
4543159,38527,17194164,73,"Ok, I update it, it should do this... only needed 2 lines :)",156570735,2014-09-06 01:00:56
4543159,146404,17194270,42,This requires the `CTuple` alias to be defined at the point that the macro is expanded. You really want to use `_root_.cascading.tuple.Tuple` for the sake of hygiene.,156570737,2014-09-06 01:02:48
4543159,38527,17194316,42,"Ah! I wasn't sure about that, but I did wonder how it was handled. This is good to know. Thank you!",156570737,2014-09-06 01:03:38
4543159,38527,17194380,42,"Question: should I use the fully qualified path in the macros ie ```stuff: _root_.cascading.tuple.Tuple```, or just in Macro.scala?",156570737,2014-09-06 01:04:37
4543159,146404,17194521,92,Not a big deal but `.asClass` is useful shorthand for the explicit cast.,156570737,2014-09-06 01:07:10
4543159,146404,17194604,42,"Not sure what you mean by ""in the macros""? Basically you'll want to be explicit in anything that's quasiquoted, since that's code that's going to be compiled when it's expanded.",156570737,2014-09-06 01:08:25
4543159,38527,17194650,42,I'll update it and you can comment accordingly :),156570737,2014-09-06 01:09:07
4543159,38527,17194764,42,"I guess my question is if it's enough to get rid of the ```Tuple => CTuple`` realias, or if any time I refer to a type in something quasiquoted, I should use the fully qualified path?",156570737,2014-09-06 01:10:19
4543159,7111,17195056,74,"Am I incorrect about this allocating a new TupleConverter on each cass to apply? If so, it would be great to do this just once. We could pass over all the types first and see if we need to materialize converters for the inner items first.",156570737,2014-09-06 01:15:14
4543159,146404,17195137,42,If you want the macro to be bulletproof you should use it everywhere (see e.g. [the section of the documentation on hygiene](http://docs.scala-lang.org/overviews/quasiquotes/hygiene.html)). You could remove all the `cascading` imports from `Macro.scala` a,156570737,2014-09-06 01:16:17
4543159,7111,17195166,34,same comment below. I'm concerned we going to allocate a new setter for each call to apply. It would be nicer to allocate the inner setters in an initial pass.,156570737,2014-09-06 01:16:45
4543159,38527,17195293,74,"You are not mistaken, yes, I am going to fix that.",156570737,2014-09-06 01:18:59
4543159,146404,17195831,17,"I don't know if this is a big deal, but I'd be more comfortable doing something like this:

``` scala
val memberTypes = tag.tpe.declarations.collect {
  case m: MethodSymbol if m.isCaseAccessor => m.returnType
}
```

Which lets you use the nice `i",156570742,2014-09-06 01:25:13
4543159,38527,17195919,17,"Seems reasonable. A lot of this is me figuring out the reflection/macro apis, so these tips are greatly appreciated.",156570742,2014-09-06 01:26:35
4543159,146404,17196514,41,"This is a matter of style and taste, but you don't actually need the `.tpe` part here, so if you name your implicit type tag parameter the same thing as your type you can use a very natural `TupleSetter[$T]` syntax.",156570742,2014-09-06 01:35:56
4543159,146404,17196712,37,Also a matter of style—you can just drop this line entirely and use `..$set` below to create the block.,156570742,2014-09-06 01:39:09
4543159,38527,17197012,37,Excellent,156570742,2014-09-06 01:44:04
4543159,164018,17197156,15,typo: parmter,156570742,2014-09-06 01:46:30
4543159,164018,17197295,56,same. maybe factor out a ```checkIfCaseClass[T](c)```,156570742,2014-09-06 01:49:25
4543159,38527,17197311,41,This stuff is great. I need to track down the more exhaustive quasiquotes manual...,156570742,2014-09-06 01:49:36
4543159,38527,17197412,56,"yeah I definitely want to factor more common stuff out, kind of seeing how the two implementations settle (esp. with @travisbrown 's really useful comments)",156570742,2014-09-06 01:51:17
4543159,146404,17199269,15,"Unless you really want an illegal argument exception (which will be thrown at compile-time, anyway), it'd be more idiomatic to use `c.abort(c.enclosingPosition, ""Type parameter..."")` here.",156570748,2014-09-06 02:25:40
4543159,7111,17202722,13,What causes this resolution to fail if T is not a case class?,156570748,2014-09-06 03:52:52
4543159,146404,17203513,13,"Magic.

Specifically, if you've got the following:

``` scala
import language.experimental.macros, reflect.macros.Context

trait Foo[A]

def materializeImpl[T](c: Context)(implicit T: c.WeakTypeTag[T]): c.Expr[Foo[T]] = {
  import c.universe._
",156570748,2014-09-06 04:22:55
4543159,7111,17206072,13,"What if you also had `implicit val stringFoo: Foo[String] = new Foo[String] { }` in the Foo companion object? Would everything be fine?

Because that is what scalding wants: we want that if it is not a case class, that the default lowest priority implic",156570748,2014-09-06 06:45:39
4543159,146404,17206539,13,"The macro-provided implicit will hide the implicit value in the companion object in implicit search, just as if you'd imported any other old method providing an implicit value of the same type. You definitely could have the macro check for an existing imp",156570748,2014-09-06 08:16:26
4543159,146404,17208626,13,"Oh, sorry, @johnynek, I think i misunderstood part of your question yesterday. If there's e.g. an implicit `Foo[Int]` in the `Foo` companion object, this macro (which only provides a `Foo[String]`) won't hide it—it'll just fail to provide a `Foo[Int]` and",156570748,2014-09-06 18:58:40
4543159,7111,17439963,80,"It occured to me that we are just using the index and not the field names at all, which may be present in the TupleEntry. I'm not sure what to do about this because I can see issues either way: 1) if there are fields in the TupleEntry, I guess we should u",156570755,2014-09-11 23:41:55
4543159,146404,17457113,100,Does this actually work? If so I'm a little surprised. You can just use the companion symbol directly in the quasiquotes and it'll get lifted appropriately.,156570758,2014-09-12 05:05:13
4543159,38527,17457154,100,"It turns out it doesn't! I used the companion symbol and it didn't seem to
be working, will try again, but it looked like the code was generating a
relative path not a fully qualified one. Will try again though.",156570758,2014-09-12 05:06:32
4543159,146404,17457334,100,`companionSymbol` should always be fully qualified. I just tried both and the tests fail to compile with the term name version.,156570758,2014-09-12 05:11:38
4543159,7111,17568069,18,"this looks like big pain. Migrating people may be painful. What about keeping TypedDelimited, mark it deprecated, and instead add a new trait that has the logic you have: `TypeTagDelimited` or something.",155423361,2014-09-16 01:56:01
4543159,319889,17614359,73,Did you run into TypeTag not being serializable here?,155423361,2014-09-16 21:52:15
4543159,319889,17614393,18,"At least for internal purposes it might be firing up a sandbox to see, given almost anywhere we can get a manifest implicitly we can get the TypeTag it *might* not be a big issue? It probably depends on how the sources are composed. (Just afraid of a big ",155423361,2014-09-16 21:52:51
4543159,38527,17616249,73,"I think it is serializable but I was dealing with other serialization issues and forgot to remove this one.

That said, I think I'm gonna table this PR until scalding is on 210/211 so I can see how those aspects of it shake out...",155423361,2014-09-16 22:23:57
4543159,319889,21789619,22,needed to use typetags... kinda fugly to have everywhere but...,186865581,2014-12-14 00:18:22
4543159,319889,21790072,18,"So on closer inspection of this, I'm a bit concerned that even if we could get the TypeTag's in place the case class code isn't thread safe(reflection in scala isn't), which would just be a little odd. But also if you don't use the macro tuple setters/get",155423361,2014-12-14 01:14:02
4543159,7111,21802700,9,"why is this change here? It seems like it breaks code that only defines local sources, which could have been done in the past.

I don't see a reason to remove this support, and if we are going to do it, we should do it with a bit more design.",186865581,2014-12-15 09:08:34
4543159,7111,21802721,26,"do we want to bite this off now? Grep source for how many mf parameters we have.

If we are going to go though massive migration pain, maybe we want to see if this is really the best long term direction. An alternative approach is to make `def types: Ar",186865581,2014-12-15 09:11:08
4543159,7111,21802726,61,shouldn't this be protected? what about a return type?,186865581,2014-12-15 09:11:43
4543159,7111,21802749,124,this is in the hot path: each tuple will go through it. I think the same inlining that we did in bijection would be a good idea.,186865581,2014-12-15 09:13:20
4543159,319889,21827009,9,We can close this PR --- but I think this must have been committed somewhat accidentally. #1130 contained a cleaned up/working one of this.  ,186865581,2014-12-15 21:20:37
4543159,319889,21827172,26,I don't think we want to change this either now... we could maybe rename the old one to deprecated and make this one take a typetag. (Just under the notion that otherwise will we have a TypedDelimited2?) -- Or add a new one beside. I think this kind of il,186865581,2014-12-15 21:22:17
4543159,319889,21827363,80,"Will it possibly be much slower if we attempted to use the names and the indexes? i guess we would need to use the names then fall back if it doesn't exist? There are two use cases that spring to mind here, one is fine with ID's, one is more natural with ",156570755,2014-12-15 21:25:38
4543159,319889,21829304,124,Have in another branch. We should probably confirm doing something like this won't generate a structural type (don't think it should?) which would have a bigger performance cost..,186865581,2014-12-15 21:55:43
4559447,7111,17386665,5,"will this work? I think it will just change the class name part that you have.

I think it is fine to add, but I am not sure it closes #1044 ",155055737,2014-09-11 01:30:05
4559447,480660,17388200,5,It's not meant to close #1044. This is a separate issue.,155055737,2014-09-11 01:55:41
4563935,7111,17439302,5,let's not put this here. I don't want to disable for the world. I meant we could do this in TwitterJob inside Twitter or at launch time with -D argument.,155055733,2014-09-11 23:32:37
4563935,7111,17439311,5,this is good.,155055733,2014-09-11 23:32:46
4563935,1825352,17440181,5,"Okay, will remove it. I was thinking if we want to do it internally, it's also a good idea to disable it here.",155055733,2014-09-11 23:45:16
4566075,7111,17465739,51,"Not crazy about the extra parameter group here. I see why you are doing it, but I am trying to think if we can find another way.",155055706,2014-09-12 12:12:11
4566075,38527,17486563,51,"@johnynek: as far as I can tell there are 3 options. The parameter, a mutable internal variable, or f-bounded polymorphism.",155055706,2014-09-12 20:57:59
4566075,164018,17493086,51,"As there is only one class with this we could also do:
public constructor (fields: Fields, paths: String*)
private constructor (fields: Fields, paths: Array[String], filterPredicate: Option[FilterPredicate])
and add a 
def withFilter(filter: FilterPre",155055706,2014-09-12 23:03:52
4566075,164018,17572919,41,I think you can omit (mf) here,155055696,2014-09-16 03:23:15
4566075,164018,17572996,8,It seems that this could be simplified by having an EverythingFilterPredicate,155055696,2014-09-16 03:24:52
4566075,622449,17631458,41,done!,155055696,2014-09-17 02:23:32
4566075,89478,17632518,8,Any reason not use val?,155055696,2014-09-17 02:41:58
4566075,622449,17632845,8,yes! turns out vals in traits (espcially when you try to override them in subclasses) come with a bunch of gotchas related to initialization order.,155055696,2014-09-17 02:48:38
4566075,89478,17634280,51,"A little worry about calling the constructor here. User may extends this class, and calling copyWithFilter may return an instance of different class. And in the subclass, user may mix-in other trait or override some methods, and those changes will be miss",155055696,2014-09-17 03:14:59
4566075,622449,17635691,51,"Actually, users should not override this class, maybe we should make it final.

Because if they override this class, the This parameter would be wrong.",155055696,2014-09-17 03:50:09
4566075,7111,17684441,11,"let's use a case match here:
```scala
val newFp = filterPredicate match {
  case None => fp
  case Some(old) => and(old, fp)
}
```
I feel like that is a clearer expression, and clearly perf does not matter here.",155055687,2014-09-17 23:41:16
4566075,7111,17684586,40,you had a val here above. I'd like this to be consistent.,155055687,2014-09-17 23:43:01
4566075,622449,17696226,11,done,155055687,2014-09-18 02:40:17
4566075,622449,17697432,40,done -- removed val (not needed),155055687,2014-09-18 03:03:23
4576487,7111,17566994,12,"this function is going to require the Specification to be serialized, and that class has a ton of stuff that can be serialized.

Instead do this:
```scala
class CleanUp {
  var called: Boolean = false
  def cleanUp(): Unit = { called = true; () }
}",157218175,2014-09-16 01:36:39
4576487,7111,17572330,1,these should not be here.,157218182,2014-09-16 03:10:30
4576487,7111,17572385,13,do we need that `[U >: T]`? That is less than optimal.,157218182,2014-09-16 03:11:36
4576487,7111,17572910,13,"Also, can we call this, `def onComplete`, and no need for the transient here, or the { } for a single expression method.",157218182,2014-09-16 03:23:05
4587320,7111,17709535,25,extends AnyVal should work here.,157219482,2014-09-18 10:24:00
4587320,7111,17882952,69,"this doc describes setting a key in the config. Is this how this works under the covers? What about multi-input (merges, joins)?",156138829,2014-09-23 03:34:29
4587320,622449,17883921,69,this is setup in sourceConfInit which handles this case ,156138829,2014-09-23 03:57:24
4588779,232760,17743070,43,"Can you explain what the res function parameter is doing? Is it the result of the execution, in which case, should it also be a Future?",155055682,2014-09-18 22:50:44
4588779,7111,17743549,43,"I am using the lazy parameter `(: =>)` in the same way a mutable map does with .getOrElseUpdate. So, if we have not already evaluated ex, put the code to evaluate it there. Now you can actually get the future into the cache before it is complete and so pa",155055682,2014-09-18 22:58:44
4588779,232760,17745029,43,Would zips made into a sequence here because in case of b.zip(c) c considers b to be a parent? ,155055682,2014-09-18 23:22:56
4588779,232760,17755665,65,"I'm still not completely clear on why we need to keep two copies of the caches (getting used to thinking about Futures), but do you think the duplication will hurt performance-wise since these are vals and thus they are separate copies?",155055682,2014-09-19 02:19:39
4588779,7111,17756870,65,"Keep in mind that immutable maps use structural sharing, so they take O(log_32 N) copies to update an immutable Map.

Also, there will be few executions, not like 1000s, so I don't think it will be much of an issue.",155055682,2014-09-19 02:41:35
4588779,232760,17757247,65,"Yea, that's true. Looked up structural sharing - pretty cool :)",155055682,2014-09-19 02:48:21
4588779,7111,17762896,43,"b.zip(c) should generally not have b being a parent of c, but it could be. Imagine: b.zip(b.map(fn)). we would first schedule the execution of b, then when scheduling c = b.map(fn) we would find b in the cache, and would reuse the future there.",155055682,2014-09-19 04:54:06
4593448,319889,17807344,2,Can you kill the manifest references too while your at it?,158060333,2014-09-20 01:28:09
4593448,319889,17807387,29,Should we use assert or shouldBe? is shouldBe ever preferable over assert? ,158060333,2014-09-20 01:28:57
4593448,38527,17807485,2,I was hoping to enlist the compiler in helping with this... can't do that until we're on 2.11 (ie algebird release).  see: https://github.com/twitter/algebird/issues/351,158060333,2014-09-20 01:30:29
4593448,319889,17807491,57,should we use the an[xxx] approach or the intercept one? intercepts only advantage is getting access to the exception afterward. More i'm not sure we want to use both if we don't need to? not an issue though fine with this too.,158060333,2014-09-20 01:30:35
4593448,38527,17807534,29,"Maybe asserts are better? That said, I have very little desire to change this massive PR to use asserts over Matchers... if we prefer asserts I can use those from here on out, and we can have a PR to use them.",158060333,2014-09-20 01:31:12
4593448,319889,17807603,407,whats the idx var about? do we run it multiple times? ,158060333,2014-09-20 01:32:09
4593448,319889,17807670,2,How would the compiler help? if you enable warnings manifests are a warning in 2.10 also?,158060333,2014-09-20 01:33:25
4593448,319889,17807727,29,FYI scalatest asserts are a type of matchers. But anyway that seems reasonable to me. My preference is for asserts since there is just one style and it should cover ever use case. but no particular backing as to them being better...,158060333,2014-09-20 01:34:42
4593448,38527,17807786,407,yes. run and runHadoop each rerun the same verification closure,158060333,2014-09-20 01:35:52
4593448,38527,17807832,57,"I think the current approach works fine for when we just want to verify that it was thrown, and don't care to know more. In other areas we check things about the exception and then use ```the[Exception]```",158060333,2014-09-20 01:36:29
4593448,38527,17807852,2,By giving me errors instead of warnings ;),158060333,2014-09-20 01:36:52
4593448,319889,17808017,2,Manifests are still in 2.11 as a warning i'm pretty sure?,158060333,2014-09-20 01:39:51
4593448,319889,17808108,407,So idx is there to tell them apart in their runs? this seems like a bad way to achieve that no? we need to put a mutable variable in each test?,158060333,2014-09-20 01:41:39
4593448,38527,17808113,2,"Oh, really? well if that's the case, I'd prefer not to tackle that in this PR. This is going to get bit enough as it is and I'd like to focus on reconciling the breaking changes",158060333,2014-09-20 01:41:42
4593448,38527,17808240,407,"It's certainly not ideal, but I think that the possibility for confusion is fairly minimal. There are a couple of different ways to do this, most of which required more refactoring than this did, so I went with this approach. I think it is worth having a ",158060333,2014-09-20 01:43:38
4602556,38527,17871600,5,This line is unecessary,156338852,2014-09-23 00:18:45
4602556,7111,17876072,5,"You mean you would prefer I not explain the meaning with code. Note, this will appear in the scaladoc, whereas the implementation won't.",156338852,2014-09-23 01:33:18
4602556,38527,17878100,5,Good point,156338852,2014-09-23 02:05:32
4717444,319889,18043118,5,"Why delta from the other projects handling of this? I'm a big fan of being consistent.

https://github.com/twitter/bijection/blob/develop/project/Build.scala#L13",157873568,2014-09-25 21:35:06
4717444,7111,18043326,5,I missed that. This is a non-exhaustive match that will fail when we try to use 2.11. I guess we'll see it then and have to fix it.,157873568,2014-09-25 21:38:21
4717444,622449,18052552,5,"Yeah the one we looked at in chill was not exhaustive either:
https://github.com/twitter/chill/blob/0.4.0/project/Build.scala#L151
(though it is now, we were looking at an older revision). 

I just assumed it was not exhaustive on purpose (throw an ex",157873568,2014-09-26 00:01:55
4747090,319889,20876662,8,you have fields in the params twice here?,185458396,2014-11-25 23:57:02
4747090,7111,20880687,13,"this breaks binary compatibilty because the class now has an additional constructor. Could we instead get the same result by adding a method to the companion object?

```scala
object TemplatedTsv {
  // This might be a use case for the builder pattern",185458397,2014-11-26 00:52:23
4747090,319889,20882272,13,I think with the changes recently on the JDBC source we've already lost binary compatibility. Not sure if you think its worth the extra code bloat to keep it for this class? Maybe?,185458397,2014-11-26 01:12:44
4747090,7111,20882521,13,"Good point. Forgot about it.

We really need some kind of better versioning handling with CI. It would be
great to always have two dev branches: one that is binary compatible with
the previous release and one that had that plus more. It would be nice ",185458397,2014-11-26 01:15:46
4747090,319889,20882859,13,"True, it would probably be good to do the twin branches. Usually i suppose thats done with the maintaining of a 0.12 branch or similar and then PR's against it and such. ",185458397,2014-11-26 01:20:32
4747090,1179759,20978231,13,How should take this forward? Let me know if I can consider this branch as without binary compatible and if it make sense to merge this? Also let me know which branch I should consider as binary compatible branch ? I will commit the same in that branch us,185458397,2014-11-27 10:51:33
4828656,7111,18317280,16,"could these three really cause a problem? These are on Identity reduces, which mean the keys could not have been removed, I thought. Did you have a test that failed without them?",161543684,2014-10-02 05:30:10
4828656,86248,18320603,16,"Yes. I included a test that fails without this change.
On Oct 1, 2014 8:30 PM, ""P. Oscar Boykin"" <notifications@github.com> wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/typed/Grouped.scala:
>
> > @@ -146,7 +150,7 @@ case class IdentityRe",161543684,2014-10-02 08:01:57
4828656,86248,18345145,16,"To elaborate, my test breaks without the fix on IdentityReduce, but I think it is prudent to add the guard to enforce the mapGroup invariant that the iterators are empty in all places including UnsortedIdentityReduce and IdentityValueSortedReduce",161543684,2014-10-02 20:06:41
4828656,7111,18376637,5,let's move this comment to addEmptyGuard to be sure we remember why we have it.,161543684,2014-10-03 05:34:46
4828656,7111,18467483,40,"I don't think this works actually. Consider the case where localRed(k, iter) == Iterator.empty, but fn(k, _) == Iterator(k). The newReduce will not behave as expected. I think your previous patch is correct: If any function maps to Iterator.empty, that is",165193433,2014-10-06 21:30:19
4828656,86248,18475710,40,"Not sure I follow...  This refactor makes it so the invariant on
mapGroupNonEmptyIters is that fn(_, Empty) == Empty always

On Mon, Oct 6, 2014 at 12:30 PM, P. Oscar Boykin <notifications@github.com>
wrote:

> In scalding-core/src/main/scala/com/twitter/",165193433,2014-10-06 23:33:41
4957630,319889,18928003,15,kill the todo i think,172764320,2014-10-16 03:33:44
4957630,319889,18928289,22,kill,172764320,2014-10-16 03:39:37
4985572,7111,19450707,14,tests for this function would be great.  I think some scalacheck would be nice. Generate random Array[String] args and the non-hadoop args can't be parsable with the GenericOptionsParser.,175810014,2014-10-28 08:34:09
4985572,7111,19450770,20,"can you flatten this out? I don't like two level matching:
```scala
args.foldLeft(Array[String](), Array[String](), Option.empty[String]) {
  case ((hadoopArgs, nonHadoop, Some(l), current) if dArgPattern.findFirstIn(current).isDefined =>
  // etc....",175810014,2014-10-28 08:37:21
4985572,7111,20097201,35,"couldn't this fail if we randomly get a string that looks like ""-Da=b""",183991368,2014-11-11 00:27:40
4985572,319889,20097449,35,"Yep, sort of just relying on that being improbable. I could filter out such
things in here ?

On Monday, November 10, 2014, P. Oscar Boykin <notifications@github.com>
wrote:

> In
> scalding-core/src/test/scala/com/twitter/scalding/ExecutionAppProp",183991368,2014-11-11 00:31:13
4985572,7111,20103341,35,"It is super improbable, I guess.",183991368,2014-11-11 01:57:25
5000907,7111,19513770,9,"this should be Option[(U, V)]",174514074,2014-10-29 06:23:04
5000907,41405,19517693,9,I seem to recall `flattenValues` was giving me grief when I was using an `Option`... I'll confirm though,174514074,2014-10-29 08:42:40
5000907,319889,20024228,11,don't need field names when using the typed api,183810081,2014-11-08 00:33:11
5000907,319889,20024454,6,"better description of what you mean by culumative sum, with an example would be good. (i.e. given a List((1, 2), (4,2)) a cumulative sum would be Y)",183810081,2014-11-08 00:37:44
5000907,319889,20024485,35,split over a few more lines to drop the line length.,183810081,2014-11-08 00:38:13
5000907,319889,20024604,30,"more lines in comment, so its not as wide for github diff reading",183810081,2014-11-08 00:40:14
5000907,319889,20024650,60,Indenting looks off here. Separate out the concat to its own val and use that in the group,183810081,2014-11-08 00:41:02
5000907,319889,20024725,6,Shouldn't need tdsl,183810081,2014-11-08 00:42:15
5000907,319889,20024743,39,don't need dsl/field names?,183810081,2014-11-08 00:42:31
5000907,41405,20030762,6,"if I remove this I get:
```
[info] Compiling 1 Scala source to /Users/snoble/Code/stripe/scalding/scalding-core/target/scala-2.9.3/test-classes...
[error] /Users/snoble/Code/stripe/scalding/scalding-core/src/test/scala/com/twitter/scalding/CumulitiveSu",183810081,2014-11-08 02:20:25
5000907,7111,20053843,6,"It's fine, but Ian was suggesting to use `TypedPipe.from(TypedTsv[ ](..))` instead of the implicit. No biggie.",183810081,2014-11-09 02:35:57
5000907,7111,20053873,51,"if we remove this, you could return an SortedGrouped, I think, which can still do reduces on, if people want that. I think returning the TypedPipe is only a loss of power. Consider if you want to follow up with a fold or another scan (or a filter followed",204588584,2014-11-09 02:40:31
5027953,319889,19248919,5,"This should be an option, not defaulting to -1",175722549,2014-10-23 03:27:08
5027953,319889,19248941,15,option.map().getOrElse or option match instead,175722549,2014-10-23 03:27:28
5076599,7111,19579827,9,Can we use def here to lesson the chance of a val init order null?,177717637,2014-10-30 05:24:37
5076599,7111,19579868,3,"are we on 2.10 only yet? If so, these should extend AnyVal (all the single parameter case classes should in general).",177717637,2014-10-30 05:25:39
5192257,622449,20187948,50,should we do the same for skipStrategy?,184032770,2014-11-12 05:51:42
5192257,622449,20188171,27,"does type param A do anything useful here? Or would just using [_] throughout make sense?

if this code never pulls an A out of any of these objects / methods (it only calls a apply which returns Unit right?) is it adding any safety? ",184032770,2014-11-12 05:54:32
5192257,7111,20188605,28,"why take _ here, and then cast. Why not make the caller cast? I mean, it should be: `Option[FlowStepStrategy[A]]` right? then you don't need the cast.",184032770,2014-11-12 06:00:03
5192257,7111,20188760,28,"Also, this is clearly a Monoid. Why not just make a Monoid[FlowStepStrategy[A]] and use that?",184032770,2014-11-12 06:01:51
5192257,7111,20188911,54,"why wrap with the Option here? Seems like redirection. Why not:
```scala
existing match {
  case null => strategy
  case nonNull => Monoid.plus(nonNull, strategy)
}
```",184032770,2014-11-12 06:04:06
5192257,232473,20245978,50,bias to laziness,184032770,2014-11-13 02:56:23
5206217,360025,20362940,474," This looks great. How does it compare to:
```
val (rest21, v) = nested
val t21 = LeftNestedAlternatingTupleOptionFlatten21(rest21)
(t21._1, t21._2 ....t21._21, v)
```

performance (kind of recursive calls vs getOrElse calls) might just the same.
",184163570,2014-11-14 22:01:05
5206217,622449,20384382,474,"I thought about that. 
It would work, though now you're making nested function calls, so it seems like it would be slightly more expensive.

The other option would be to short circuit after the first `.getOrElse` is triggered, but to do that is tricky.",184163570,2014-11-15 03:34:29
5206217,7111,20971319,17,I thought you could not have two implicits with the same name. You sure these resolve? I think they shadow each other.,184441771,2014-11-27 06:45:59
5206217,7111,20971528,6,"wait, so are we going down this road?

I thought we didn't want to pollute the docs with tons of generated almost identical methods.

Here is another idea: add a .multi method to CoGroupable that returns a MultiCoGroupable which just wraps the current",184441771,2014-11-27 06:50:21
5206217,622449,20973532,17,"Thanks, that might be why it wasn't working :)
I haven't had a chance to look into it",184441771,2014-11-27 07:54:14
5206217,164018,21116773,6,"And what about just Multi be an object and do ```Multi.join(pipe,a,b,c,d)``` it is awkward to me to have the first pipe have a special role now that we join with more than one.",184441771,2014-12-02 03:26:31
5206217,7111,21118188,6,"Yeah. I like this better. What about:

```scala
object MultiJoin {
  // default inner join 2-22
  def apply(...)
  // 2-22 outer join methods here
  def outer(..
}
```",184441771,2014-12-02 03:49:46
5206217,44017,21118578,6,Strong +1 on `MultiJoin`,184441771,2014-12-02 03:55:06
5233725,7111,20678466,15," This is fine to merge, but note, you could have gotten this same behavior by overriding allPathsFor in your subclass. So, you are not blocked now, right?",184374002,2014-11-21 04:25:57
5233725,7111,20678654,17,"why not be more direct and just add a method:

```scala
// Override this if you want to change how we get the duration
def getDuration: Option[Duration] = TimePathedSource.stepSize(pattern, tz)
```
then we are totally binary compatible.",184374002,2014-11-21 04:28:51
5278457,7111,21130815,46,should we collect these version number above as we do with algebird/bijection/chill....,184657566,2014-12-02 07:01:12
5278457,319889,21131154,46,"Seems reasonable, will make the change",184657566,2014-12-02 07:07:33
5284884,7111,21402004,170,pull this up to our section on versions?,184696731,2014-12-06 04:35:35
5284884,319889,21404097,170,will do,184696731,2014-12-06 05:11:01
5284884,319889,21404173,170,should we do that for all versions? there is still a sprinkling of them around. I think most that are common are moved out but we haven't moved once off's before,184696731,2014-12-06 05:12:28
5284884,7111,21407076,33,didn't even know we were using this.,184696731,2014-12-06 06:05:01
5284884,7111,21407225,170,"I guess we should for all the versions so it easy to see for a reader what things depend on.

What do you think?",184696731,2014-12-06 06:08:36
5284884,7111,21407279,179,isn't this stuff already in libraryDependencies? Why did we need to add it?,184696731,2014-12-06 06:09:39
5284884,319889,21407323,179,"The other ones are test only, here its for build + test. (None of this should be new I don't think?)
I cleaned up a little of it. But maybe as a follow up PR we can take a pass at what we'd want to do with cleaning this up in general? ",184696731,2014-12-06 06:10:50
5284884,319889,21407333,33,"Yeah, not sure why/how it got in there really. Just started appearing in all my diffs",184696731,2014-12-06 06:11:04
5284884,319889,21407362,170,"I like it, but unless you object a follow up PR? just to get this in and make that one seem clearer",184696731,2014-12-06 06:11:51
5284884,7111,21407375,2,"while we are breaking binary compatibility, should we move to ClassTag here? That is all that is needed, I believe.

Same for most of the places we used Manifests (any time we don't look at the type parameters of the manifest).",184696731,2014-12-06 06:12:15
5284884,7111,21407404,4,this probably needs Manifest or TypeTag or something. It is looking into the type parameters of T.,184696731,2014-12-06 06:12:57
5284884,7111,21407450,2,I think this can be ClassTag.,184696731,2014-12-06 06:14:05
5284884,622449,21408348,48,should you use `isScala210x` here?,184696731,2014-12-06 06:36:31
5284884,622449,21408988,14,lets check if typed pipe actually works in a for comprehension,184696731,2014-12-06 06:43:01
5284884,622449,21409012,29,=== ?,184696731,2014-12-06 06:43:33
5284884,622449,21409026,43,=== ?,184696731,2014-12-06 06:43:46
5284884,622449,21409524,1201,.size === 2000 ?,184696731,2014-12-06 06:57:44
5284884,319889,21409792,1201,"Any difference we would want === over should have size ?

On Friday, December 5, 2014, Alex Levenson <notifications@github.com> wrote:

> In scalding-core/src/test/scala/com/twitter/scalding/CoreTest.scala:
>
> >      val input = (1 to 1000).flatMap",184696731,2014-12-06 07:06:12
5284884,622449,21410888,1201,"just saw that you were using === in some of the tests at the top of the diff then switched to the ""should be"" / ""should haves"" later (or maybe it's your vs. jco's branch), so ideally we'd just stick with one but not a huge deal.

I don't particularly li",184696731,2014-12-06 07:34:39
5284884,319889,21411716,1201,"Not opposed. Follow up if this passes as an issue / pr though ?

On Friday, December 5, 2014, Alex Levenson <notifications@github.com> wrote:

> In scalding-core/src/test/scala/com/twitter/scalding/CoreTest.scala:
>
> >      val input = (1 to 1000).",184696731,2014-12-06 08:04:34
5292882,7111,21337127,8,Option[Hdfs],184743387,2014-12-05 04:22:48
5292882,7111,21337354,11,"how about:
```scala
def useLocalMode() { mode = Local(false) }
def useStrictLocalMode() { mode = Local(true) }
```
I kind of hate boolean parameters now unless the method name is super clear.
",184743387,2014-12-05 04:26:03
5292882,7111,21337472,17,"`useHdfsMode`?
```scala
println(""To use HDFS/Hadoop mode, you must *start* the repl in hadoop mode to get the hadoop configuration from the hadoop command."")
```",184743387,2014-12-05 04:27:53
5292882,7111,21337537,6,"`case h@Hdfs(_, _) => ` then you can keep the type tightened down to Hdfs.",184743387,2014-12-05 04:28:55
5292882,7111,21337566,8,can this be `private[scalding]`? Any reason to not make it?,184743387,2014-12-05 04:29:20
5292882,132245,21340252,8,done and done,184743387,2014-12-05 05:04:11
5292882,132245,21340259,11,"oh, i meant to add a default to this param but forgot. 

i like two methods better, switched to your suggestion.",184743387,2014-12-05 05:04:18
5292882,132245,21340271,17,done,184743387,2014-12-05 05:04:29
5293724,622449,21348785,63,fed?,184748380,2014-12-05 07:55:45
5293724,622449,21348918,64,"for beginners it might be useful to explain the 'flatten' part of flatMap, eg that the input function returns a TravsersableOnce but the output is a flattened view of all those together, and also point out that this is powerful because it can be used to b",184748380,2014-12-05 07:58:09
5293724,622449,21349035,111,may not *be* what you want,184748380,2014-12-05 08:00:47
5293724,622449,21349052,111,i mean think,184748380,2014-12-05 08:00:57
5293724,622449,21350142,286,really heavy?,184748380,2014-12-05 08:28:28
5293724,7111,21353205,286,"Yes. That is a good fix. ""have really heavy skew"".

On Thu, Dec 4, 2014 at 3:28 PM, Alex Levenson <notifications@github.com>
wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/typed/TypedPipe.scala:
>
> > @@ -515,7 +627,21 @@ trait Type",184748380,2014-12-05 10:08:53
5293724,123326,21358370,64,"An equation (or four) is worth a thousand words:

```
p flatMap { _ => empty } = empty

// This equation is only true if you ignore ordering
p flatMap { a => f(a) ++ g(a) } = (p flatMap f) ++ (p flatMap g)

p flatMap { a => Seq(a) } = p

p flatM",184748380,2014-12-05 14:16:23
5293724,7111,21387968,64,"Feel free to add those. Please omit the ordering comment or at least say
that TypedPipes semantically are unordered (sumByLocalKeys shuffles key
order, for instance).



On Thu, Dec 4, 2014 at 9:16 PM, Gabriel Gonzalez <notifications@github.com>
wr",184748380,2014-12-06 01:02:40
5294025,7111,21353128,25,maybe not be? or may not be?,184750445,2014-12-05 10:06:06
5294025,622449,21356920,25,"oh.. ""maybe not what you think"" makes sense to me now.
ok how about ""and may not be what you think""?",184750445,2014-12-05 13:03:40
5330752,7111,21623549,47,can this be private?,184990210,2014-12-11 01:19:27
5330752,7111,21623575,47,I guess to use this with the Fields API you'd need it. Nevermind.,184990210,2014-12-11 01:19:50
5330752,7111,21623844,49,"this should definitely be private, right? Or have a type parameter: `Injection[T, String]`.",184990210,2014-12-11 01:23:02
5567087,7111,21847538,44,shouldn't we abort here? I thought we are doing the flattening only on primitive types.,194255324,2014-12-16 02:02:04
5567087,319889,21848616,44,"Thats a good question, I can see the argument going either way, you can do a setObject in cascading. Should we allow that or just throw?",194255324,2014-12-16 02:15:22
5567087,7111,21848716,42,can we put this at the front of this method rather than putting it here and below?,194255324,2014-12-16 02:16:32
5567087,7111,21852304,44,"What is the use case here? For Pig, the data people write is generally (always?) just primitive + strings right? Also, for DB it is the same thing. So, I would tend to say it would be good to error in this case.

We could take a boolean to `onlySimpleTy",194255324,2014-12-16 03:05:43
5567087,7111,21853203,10,"we should document here that these only work when the case class is ""simple"" (primitive + string) or nested simple.",194255328,2014-12-16 03:18:29
5567087,7111,21853589,11,"it would be nice to add a macro for:

`def fieldsOf[T: IsCaseClass]: Fields`
that returns a Fields object with the dotted names and the types set.

The goal is to use this with TypedDelimited and generate the types needed so cascading can parse the s",194255328,2014-12-16 03:23:14
5607578,7111,22068545,9,"1. I'm not sure you are getting any mileage out of this. Couldn't you just inline the parsing in the methods below? You don't expose a generic way to use this.

2. NumberFormatException is too specific here. I would have gone with:
```scala
import sca",197022908,2014-12-19 03:23:51
5607578,7111,22068618,26,"1. Can't we just put these directly on Args? Any reason to use the enrichment pattern?

2. Prefer to avoid { } in single expression methods like these.
",197022908,2014-12-19 03:24:52
5607578,7111,22068679,27,I think `args.optional(key).map(_.toInt).getOrElse(default)` is just as clear here.,197022908,2014-12-19 03:25:53
5607578,7111,22068735,30,"`args(key).toInt` is shorter and just as clear, right?",197022908,2014-12-19 03:26:41
5607578,46174,22069134,26,"1. No, but the same could be said for RangedArgs. I assumed the intent was to keep Args pure.",197022908,2014-12-19 03:34:03
5640238,7111,22187506,11,why not `Option[T]` here?,198295609,2014-12-23 03:19:39
5640238,7111,22187547,15,"the default value might not fit an Int, right? Or did you mean 32 bit int here? Maybe better to have Long as the type if we are dealing with a superset.",198295609,2014-12-23 03:20:37
5640238,7111,22187606,11,Do we need the type parameter at all?,198295609,2014-12-23 03:21:41
5640238,7111,22187637,16,"Can this be `inner: Either[StringColumn, IntColumn]`? We don't want to allow `Option[Option[T]]` do we? Or do we?",198295609,2014-12-23 03:22:34
5640238,7111,22187814,21,"if we got rid of the type parameter, this becomes `columns: Iterable[JdbcColumn]` which is a bit nicer.",198295609,2014-12-23 03:27:08
5640238,7111,22188003,16,can we add a test without a size on the string? What should that mean? Error?,198295609,2014-12-23 03:30:58
5640238,319889,22190776,11,I added it in so we could have a method accessing the self type. But possibly not really no.,198295609,2014-12-23 04:17:26
5640238,319889,22191062,11,The type inference would be screwy in instanciation if I just have T be in the jvm type. I could do either have both the JdbcColumn type and the inner type and it seems good. Or leave this as any and drop the type? ,198295609,2014-12-23 04:22:12
5640238,319889,22191150,15,"So this needs to be expanded a bit. From the ORM's i've seen Integer is often used in the jvm to map all sizes up to signed int. Unsigned int needs a Long. then you have long for signed long, and big integer after that. 

Thoughts on naming if you have ",198295609,2014-12-23 04:23:44
5640238,319889,22191222,16,"I think String/Int types will have to expand more, so an either probably doesn't quite do it. We can use another sentinel type though to put here that inherits from  JdbcColumn. Something like JdbcValueType extends JdbcColumn and have OptionalColumn accep",198295609,2014-12-23 04:24:47
5640238,319889,22191341,16,It doesn't compile the way i've set that up. I'll need to add some tests like the bijection magic one for missing implicit to show the cases that shoudln't work,198295609,2014-12-23 04:26:50
5640238,7111,22194607,16,shapeless has some trick where you write the code in a string and you have a test that it won't compile.,198295609,2014-12-23 05:30:46
5640238,319889,22195287,16,"Should have uploaded a set there. Uses implicit ordering to show up not
being able to build the implicit. We have it in our bijection tests. We can
add more runtime evals too but for this I think this gives full coverage

On Monday, December 22, 2014,",198295609,2014-12-23 05:44:52
5688553,7111,22334100,50,"should we abort here if expanded is empty? This would happen if T is not a case class so it has no method accessors, right?",200945785,2014-12-30 06:45:25
5688553,319889,22334391,50,"We should be testing for that upfront i think per our conversation earlier. The output of all this is type checked too. 

Not a bad thing ot have an abort here, but the error probably should just be more of an ""I don't know how this could happen""",200945785,2014-12-30 07:00:09
5688553,7111,22335239,50,"I'm confused, what is preventing something like:

```scala
def test[T: IsCaseClass](t: T): Any = Macros.toFields[T]
```
Which compiled before, but would give, I think, and empty Fields instance here.",200945785,2014-12-30 07:40:45
5688553,319889,22335766,50,"I had been thinking it just wouldn't compile. But you could be right in the
case of the fields constructor empty is valid. So yes this needs a
test/throw. I was more thinking in the general case as we discussed we need
to put more tests on the 'inside'",200945785,2014-12-30 08:11:43
5688553,7111,22335831,56,don't we need `_root_.cascading` and `_root_.scala` to be safe?,200945785,2014-12-30 08:15:37
5688553,7111,22335913,61,"why are you using valueOf here and not elsewhere? Why not valueOf everywhere?

Also, what about using `_root_.java.lang.Integer.valueOf` rather than just `Integer`?",200945785,2014-12-30 08:19:22
5688553,7111,22335927,70,can we not use a counter rather than random numbers? This will make different runs possibly fail due to the small probability of collision.,200945785,2014-12-30 08:20:24
5688553,7111,22335995,65,shouldn't we check for `!inOption` here? I think `Option[Option[Int]]` does not make sense. `Option[Primitive]` or `Option[CaseClass]` works though. The problem with `Option[Option[Int]]` is that null is ambiguous: was it `None` or `Some(None)`?,200945785,2014-12-30 08:24:16
5688553,319889,22336014,70,Well the counter would need to be passed around as an external state or be a global var. Neither seemed too appealing. I've seen some references to a fresh function... so i was planning to look into seeing if it can cover this use case,200945785,2014-12-30 08:25:24
5688553,7111,22336062,34,also the `Option[Option[Int]]` case comes up here. We should have a test to make sure that does not work.,200945785,2014-12-30 08:27:39
5688553,319889,22336073,65,"We can, though we should then probably add a new clause so the error isn't strange about it being an unsupported type? ",200945785,2014-12-30 08:28:07
5688553,7111,22336075,77,`_root_.scala.Int`?,200945785,2014-12-30 08:28:11
5688553,319889,22336084,61,"I was planning on using box everywhere since its really the semantics i'm aiming for, but it doesn't exist on Integer, it does on everything else though...",200945785,2014-12-30 08:28:48
5688553,7111,22336101,68,I think this will give `finalIdx == 0` if you pass a non-case class here. I think we need to abort if `finalIdx == 0`.,200945785,2014-12-30 08:29:45
5688553,319889,22336132,56,I'm not sure if the root is needed. I can add them in though -- Do you know where the advise for that came from? i guess scala import could be ambigious in some contexts or was there some more specific advise/other issue wiht it?,200945785,2014-12-30 08:31:21
5688553,7111,22336133,51,"we need to test with Options too, right?",200945785,2014-12-30 08:31:22
5688553,319889,22336404,51,"There is no support for options in the Fields one yet, so no tests. I've done setter and converter only here. so it should be strictly better than where we were but not complete coverage",200945785,2014-12-30 08:44:19
5688553,319889,22336443,68,"So this has an issue with an empty case class I believe, but I think we should as most of this code does in the bodies presume we are dealing with a case class -- some of these methods may just throw for non-case classes beyond our code... what you ran in",200945785,2014-12-30 08:46:06
5688553,7111,22357815,63,"missing _root_.scala.Array on the end, and also _root_.java.lang.

The issue here is that, as you may know, if we don't do this the macro can fail based on the in-scope names at the time.",201160123,2014-12-31 01:19:18
5688553,7111,22357846,68,same `_root_` issue here.,201160123,2014-12-31 01:20:11
5688553,7111,22358077,45,"should we make a static method for these three lines? It is repeated in several places.

`def getCaseAccessors(t: Type): Seq[MethodSymbol]`",201160123,2014-12-31 01:25:30
5688553,319889,22358564,45,"Attempting to factor that out triggers...
[warn] /Users/ioconnell/workspace/github/scalding/scalding-macros/src/main/scala/com/twitter/scalding/macros/impl/CaseClassHelpers.scala:10: abstract type pattern c.universe.MethodSymbol is unchecked since it is ",201160123,2014-12-31 01:36:30
5688553,319889,22358619,63,he who re-maps java in import scope... but might aswell make it as robust as possible,201160123,2014-12-31 01:38:28
5688553,7111,22391108,39,can you comment on what WithUnknown means?,201196800,2015-01-01 02:00:42
5688553,7111,22391173,45,strange that it works inside the macro but not outside.,201160123,2015-01-01 02:03:24
5688553,319889,22391175,39,"Sure, added",201196800,2015-01-01 02:03:28
5688553,7111,22391362,121,"this is no longer correct, right?",201196800,2015-01-01 02:11:01
5688553,319889,22391557,121,"True, killed.",201196800,2015-01-01 02:18:54
5704263,7111,22392709,20,"Let's add a comment here:
```scala
/**
 * This class is used to bind together a Fields instance which may contain a type array via getTypes,
 * a TupleConverter and TupleSetter, which are inverses of one another. Note the size of the Fields
 * object",201450876,2015-01-01 03:00:23
5705782,319889,22401070,38,not clear what the function get is here,201495816,2015-01-02 01:39:13
5705782,7111,22420358,38,"Sorry, `hash(Bufferable.get(b: ByteBuffer)._2)` is the correct way to write it.",201495816,2015-01-03 02:46:03
5705782,319889,22528788,81,Should the OrderedBufferable I build call reallocatingPut or should I presume whatever is on the outside will handle reallocations on failure? It looks like the Bufferables in bijection all call the reallocatingPut,202768144,2015-01-06 22:36:48
5705782,7111,22533389,81,"Don't call reallocatingPut. That was a bad idea in my opinion. The
outermost caller should do that if they want it, not a required feature of
all composed items.

On Tuesday, January 6, 2015, ianoc <notifications@github.com> wrote:

> In
> scalding",202768144,2015-01-06 23:44:35
5705782,7111,22542823,98,rewind before write,203027288,2015-01-07 02:00:10
5705782,7111,22542960,98,maybe use DataOutput stream to write size consistently.,203027288,2015-01-07 02:01:39
5705908,319889,22419586,13,"add comments on each of these, along with a top one above as to what they are for",201499351,2015-01-03 02:25:09
5705908,319889,22419613,23,do these need to be implicit? ,201499351,2015-01-03 02:25:49
5705908,319889,22419663,16,comment looks out of date,201499351,2015-01-03 02:27:06
5705908,319889,22419690,7,Imports don't look used,201499351,2015-01-03 02:27:35
5705908,319889,22419697,20,bad comment again,201499351,2015-01-03 02:27:45
5705908,319889,22419703,15,Private/package private?,201499351,2015-01-03 02:27:53
5705908,319889,22419726,26,"Should maybe go elsewhere eventually, nothing JDBC specific in this",201499351,2015-01-03 02:28:21
5705908,319889,22419760,55,comment out of date,201499351,2015-01-03 02:29:29
5705908,319889,22419769,57,params should be tabbed in more,201499351,2015-01-03 02:29:42
5705908,319889,22419818,73,Option[Option[Int]] looks like it would pass through here?,201499351,2015-01-03 02:30:52
5705908,319889,22419833,62,Nested case class support?,201499351,2015-01-03 02:31:23
5705908,319889,22419880,95,"If a size annotation is above, but the size is a reference to a number elsewhere I don't believe it will be a literal constant so we will lose that value.",201499351,2015-01-03 02:32:54
5705908,319889,22419892,11,bad comment again,201499351,2015-01-03 02:33:17
5705908,319889,22419937,28,comment on what this does? is it necessary in the case of datetype?,201499351,2015-01-03 02:34:27
5705908,319889,22419963,37,Sealed case objects rather than all these booleans?,201499351,2015-01-03 02:35:37
5705908,7111,22421865,15,+1,201499351,2015-01-03 03:30:53
5705908,7111,22421953,73,"yes it does. Probably good to specify this class we can deal with. Option is a special case Either. You can think of it as Either[Unit, T]. That does not make it easier, I don't think, but it I just wanted to mention. :)",201499351,2015-01-03 03:34:35
5705908,319889,22423640,73,"It would, but i think similar to the TSV problem with a simple flattening to types we can't really support the nested Option[Option[Int]] right? since we won't know at which level the None is
",201499351,2015-01-03 04:32:22
5705908,7111,22423759,37,+1 just because the matrix of cases is so large.,201499351,2015-01-03 04:37:33
5705908,7111,22423955,73,"Yes, I just mean it would be nice to understand this class.",201499351,2015-01-03 04:45:45
5705908,7111,22424042,28,"the sum of Booleans is XOR, right (since it is what Field[Boolean] needs). Is that what you want here? Seems like you want `.forall(identity)`?",201499351,2015-01-03 04:48:24
5705908,319889,22442608,28,"True, seems like there was likely a bug there the tests never hit. Mostly as part of cleaning up the string case i've refactored all of them so the sum code doesn't exist anymore. (Here the monoid i would have been looking for was OR. But its not clean on",201499351,2015-01-05 03:54:09
5746023,7111,22566709,52,this does not need to take TBaseOrdered... just OrderedBufferable is enough. (same above).,203122798,2015-01-07 08:51:38
5746023,7111,22566804,35,can we add a BIG comment here explaining this. I'd love to see a TODO to make it follow the contract of compare == compareBinary,203122798,2015-01-07 08:54:09
5746023,7111,22566949,35,"actually, TBase extends comparable, why not do:

```scala
a.compareTo(b)
```",203122798,2015-01-07 08:57:59
5746023,7111,22567006,68,"case is not needed here, I don't think.",203122798,2015-01-07 08:59:31
5746023,7111,22567046,6,can we remove this duplicated code and just call one method for both?,203122798,2015-01-07 09:00:29
5746023,7111,22567109,5,"this would not be needed with the boxing approach, right?",203122798,2015-01-07 09:02:12
5765216,7111,22625388,27,what about byte?,203389075,2015-01-08 06:29:30
5765216,7111,22625468,31,do you want a `case _ => abort...`,203389075,2015-01-08 06:31:25
5765216,7111,22625712,81,not needed.,203389075,2015-01-08 06:36:31
5765216,7111,22626330,42,do we need to clamp this?,203389075,2015-01-08 06:49:51
5765216,7111,22626353,55,do we need clamp here?,203389075,2015-01-08 06:50:27
5765216,7111,22700409,39,"need the try { } catch here, I think.",203898917,2015-01-09 10:51:53
5765216,7111,22700422,56,might as well inline the try { } catch to be a bit faster.,203898917,2015-01-09 10:52:32
5765216,7111,22700437,75,"this seems wasteful, if actually all of the compares except like short and byte are doing this. Seems like we should special case those.",203898917,2015-01-09 10:53:35
5765216,7111,22700501,133,"what about a class that specifically exercises Product?

```scala
class MyData(override val _1: Int, override val _2: Option[Long]) extends Product2[Int, Option[Long]]
```
just to be sure the tuple case is not picking up case class version.",203898917,2015-01-09 10:56:23
5765216,319889,22702604,75,How do you mean ? the inner function is wasteful? or trying to do the clamp?,203898917,2015-01-09 12:58:20
5765216,7111,22702741,75,"I just mean most of the time, innerMemCompare will already be -1, 0, 1. Then we are going to go through the branching again. Maybe we can only do this for the explicitly needed cases (Short? Byte?)",203898917,2015-01-09 13:04:52
5771407,115552,22693569,1,"how old is this? make sure to grab the one from my internal branch, several fixes went in.",203774362,2015-01-09 07:07:05
5771407,319889,22694170,1,Last night or so,203774362,2015-01-09 07:20:22
5790382,319889,22728399,4,"Doesn't seem like it should be in the default job, something can be opted into by extending a trait instead",204091329,2015-01-10 00:13:04
5790382,319889,22728521,8,Does 2.5 JDBC go with 2.6 cascading?,204091329,2015-01-10 00:15:07
5790382,74347,22729100,8,"It can, but it's not necessary.",204091329,2015-01-10 00:24:29
5790382,74347,22729206,4,Are you suggesting that Job extend a trait that initializes Tracing? Or that end users should explicitly request tracing. If the later I disagree. This functionality isn't something people are likely to discover.,204091329,2015-01-10 00:26:14
5790382,319889,22729548,45,Why is this here and not in init? ,204091329,2015-01-10 00:31:29
5790382,319889,22729574,4,"The former, they should extend a trait. If they use driven they will know its there. Why have tracing code running for everyone as this would have? 

(Indeed it seems like tracing here should be a trait anyway that gets extended from. also can allow its",204091329,2015-01-10 00:31:50
5790382,74347,22730011,4,"A document service is a plugin deployed at runtime. The programmer may not have any idea that one is deployed.

The tracing code change is just registering a regex representing the boundary of the internals of Scalding. It runs once at start up and has ",204091329,2015-01-10 00:38:07
5790382,74347,22730112,45,It's a very cheap way to create one-time-init semantics.,204091329,2015-01-10 00:39:41
5849375,319889,22959179,11,dead import now?,204786477,2015-01-15 01:47:39
5849375,319889,22959247,19,Still called bufferable here,204786477,2015-01-15 01:48:33
5849375,319889,22959333,26,strategy here is to jump back to a mark then skip the remainder? is this preferable to a mutating variable tracking how far we've gone but just that we can't go backwards?,204786477,2015-01-15 01:49:35
5849375,7111,22960063,26,"in practice the Hadoop InputStreams appear to always be backed with byte arrays, so they all support mark and reset, and they support fast skip.

The algorithm here is: if the InputStream supports mark/reset (which hadoop and cascading's do), we can use",204786477,2015-01-15 01:57:25
5849375,319889,22961887,67,could you put a type on c1? it looks like its int? So when you really read a byte from the underlying stream it gives you an unsigned byte in an int?,204786477,2015-01-15 02:19:59
5849375,319889,22961963,121,should this call readUnsignedShort ? looks the same modulo the to short at the end?,204786477,2015-01-15 02:20:56
5849375,319889,22962074,177,What is the overhead of requires do you know? will it block jit or just go away? ,204786477,2015-01-15 02:22:07
5849375,319889,22962347,84,"What seems to be a big one in testing that i've seen is to serialize N of these, and then compare. It covers a lot of overflow edge cases that start appearing in the real world. Just doing (0 until N) of a and B in this law and requiring them be distinct ",204786477,2015-01-15 02:25:21
5849375,319889,22963620,30,since order matters here that these are side effecting it might make sense to pull it out before to make that clearer,204786477,2015-01-15 02:39:46
5849375,319889,22966867,62,I'm not sure i'm too keen on the distance between the Reader and Writer variants for a type like String. Though have to admit not sure the other options will really improve it once testing is solid.,204786477,2015-01-15 03:22:17
5849375,319889,22967237,26,"Thanks for the explanation, in light of that seems like this is totally the right idea",204786477,2015-01-15 03:27:15
5849375,7111,22967462,121,"There is an unsignedShort one (that returns an Int, because Java). This one, will interpret the bytes as a signed number. Java does this for the low 16 bits of an Int

```scala
scala> 65000.toShort
res21: Short = -536
```",204786477,2015-01-15 03:30:58
5849375,7111,22967628,177,"Just an if followed by a throw. Nice thing is the message is lazy, so we don't evaluate that string interpolation unless we hit the exceptional case:

https://github.com/scala/scala/blob/2.10.x/src/library/scala/Predef.scala#L231",204786477,2015-01-15 03:32:58
5849375,319889,22967836,121,"I think we can still just can have

```
def readShort = readUnsignedShort.toShort
```
 ?",204786477,2015-01-15 03:35:47
5849375,7111,22968459,62,"not sure I follow. You mean the code to read strings and write strings is far apart (so possibly easy to get out of sync)? If so, yeah, I see that point. Only testing seems like it can help us here.",204786477,2015-01-15 03:46:08
5849375,319889,22967904,177,"cool, sounds good",204786477,2015-01-15 03:36:51
5849375,319889,22970342,62,"Yeah exactly, normally one would put them beside each other with a read and write. But i guess that just gives you at a glance to read both, no real better enforcement they match. Testing and more testing",204786477,2015-01-15 04:13:32
5914870,7111,23130616,4,I'd rather not the outer { }.,207367386,2015-01-18 10:48:26
5914870,7111,23130623,14,why did you remove this? Any reason the code I had would not have worked?,207367386,2015-01-18 10:49:57
5914870,7111,23130634,24,"good catch here. I had some moment of confusion and thought, like read on bytes, that it was returning the count. I realized it was not later (because I had to write `pos += 1` not `pos += count`, but I failed fix the `== 0` case.",207367386,2015-01-18 10:51:20
5914870,7111,23130639,46,"I don't think you need the if guard. `n >= 0` so `count >= 0`, right?",207367386,2015-01-18 10:52:11
5914870,7111,23130648,5,what is the `Int` here? why not just `compareBinary` to match the terminology we normally use?,207367386,2015-01-18 10:53:41
5914870,7111,23130620,26,this was dumb on my part.,207367386,2015-01-18 10:49:33
5914870,319889,23135036,5,"This is moving a function you already had which returned int, though it suits my purposes that it returns Int so it matches all the standard compare functions.",207367386,2015-01-19 00:31:27
5914870,319889,23135054,14,"The thinking here was that using mark and reset in passed around things was unsafe, and the code I had that used it would break in a meta sense. So making the inner input streams not support it allowed me to hint that only the outermost ones should use it",207367386,2015-01-19 00:33:19
5914870,319889,23135072,46,"Alas no, by the input stream docs 0 is also any negative number too",207367386,2015-01-19 00:35:39
5922413,7111,23137873,69,"why is this marked implicit, but then, seemingly, not resolved implicitly?

Would `import Macros.toScroogeInternalOrderedSerialization` work here?",207855729,2015-01-19 05:44:03
5922413,7111,23137918,38,"you sure this does not box? I was using `java.lang.Boolean.compare(a, b)` for this case to be sure we are not triggering scala to box.",207855729,2015-01-19 05:48:05
5922413,7111,23137926,42,"why not just `q""($inputStreamA.readByte == (1:Byte))`",207855729,2015-01-19 05:48:55
5922413,7111,23137937,43,same boxing anxiety here.,207855729,2015-01-19 05:49:58
5922413,7111,23137958,27,Unit should be added at some point. That is a 0 byte type where all items are equal to each other.,207855729,2015-01-19 05:52:31
5922413,7111,23137965,70,I'd rather use the `javaType.compare` approach here as well.,207855729,2015-01-19 05:53:14
5922413,7111,23137978,81,`javaType.compare`,207855729,2015-01-19 05:53:50
5922413,319889,23138820,69,"So, the exact one beside it is resolved explicitly, though these are often recursive, so you need the implicit to do the recursion. I.e. instead of making one big OrderedSerializer when it finds any inner thrift structs it sticks in a implicitly[InnerStru",207855729,2015-01-19 07:30:48
5922413,319889,23138826,38,"Nope, indeed it does box -- originally all of the primitives used this approach, it was showing up on XProfs. I killed a bunch and it disappeared, but it just suggests these are a problem, so all worth fixing imo. I'll kill this one",207855729,2015-01-19 07:31:31
5922413,7111,23140991,27,"PS: Unit should be added because we use it in the groupAll case, just to be clear.",207855729,2015-01-19 09:58:08
5922413,7111,23141297,27,"Can you comment as to what Scrooge has to do with the next one? It appears to work for anything, not just Scrooge ThriftStruct. Also, I wonder if toThriftStructOrderedSerialization is a better name.",207897851,2015-01-19 10:17:11
5922413,7111,23141378,61,"here you use readByte.toInt, but above for enums you used readSize (since I guess enums have to be positive). Why the difference?",207897851,2015-01-19 10:23:10
5922413,7111,23141405,33,again a comment here explaining the two differences or a reference to where that is explained will help the reader.,207897851,2015-01-19 10:24:34
5922413,7111,23239556,61,I don't see how this is used. Is it?,207897851,2015-01-21 00:40:52
5922413,7111,23239592,63,"again, where is this used?",207897851,2015-01-21 00:41:22
5922413,7111,23239701,26,might as well make this `private[this]` I guess which might slightly improve look up time below.,207897851,2015-01-21 00:43:10
5922413,7111,23239815,58,`Integer.compare` would be more consistent here.,207897851,2015-01-21 00:44:51
5922413,7111,23240768,65,"Can you add a comment about this being where the recursion occurs? Also, can this pick up implicits set up by the user at this point? I guess not since it is returning a TreeOrderedBuf which is a macro construct. I guess this does not need to get implicit",207897851,2015-01-21 00:56:44
5922413,7111,23241191,69,"might be nice to add a comment above this something to the effect that enums are basically treated as non-negative integers in what happens below, and only turned into scrooge on read.",207897851,2015-01-21 01:01:52
5922413,7111,23241354,42,"what's the intent of the Int.MaxValue.toLong here? This looks a bit dangerous. Can you comment on the intent. I guess you are trying to get a unique variable ID, but I can't tell if the intent is that for two types of the same name they get the same ID. I",207897851,2015-01-21 01:04:09
5922413,7111,23241597,28,can you add a comment as to what is handled here? It looks like ThriftStruct that is not a ThriftUnion.,207897851,2015-01-21 01:07:12
5922413,7111,23241705,45,this seems confusing to me. It looks like all this is doing is wrapped an implicit OrderedSerialization in a macro. It does not seem to have anything to do with Scrooge as such at this stage. I wonder if there is a clearer name and description for the mot,207897851,2015-01-21 01:08:40
5922413,7111,23242014,33,"can you put a `require(subData.nonEmpty, ""subData cannot be empty"")` to make it clear why the `.get` below cannot fail.",207897851,2015-01-21 01:13:28
5922413,7111,23242050,63,`Integer.compare` for consistency.,207897851,2015-01-21 01:13:58
5922413,7111,23242134,75,"same `require(subData.nonEmpty, `",207897851,2015-01-21 01:15:07
5922413,7111,23242217,81,"this looks like it is using the old method names, which seems to me like this code path must not be tested. Can we add a test that verifies that it is broken and then fix it?",207897851,2015-01-21 01:16:17
5922413,7111,23242758,108,"`require(subData.nonEmpty, `",207897851,2015-01-21 01:23:55
5922413,7111,23242990,129,"It's easy to lose track of what these types mean (which is the Left, Right)?

Can you introduce types for these?",207897851,2015-01-21 01:26:56
5922413,7111,23243165,106,Seems like you want a `SubData` type wraps a head and tail (a non-Empty list). Then I think you could put the foldLeft(None) { }.get pattern in there so it is not repeated.,207897851,2015-01-21 01:29:10
5922413,7111,23243275,124,Can you explain the `1` here? Why is a None here a 1?,207897851,2015-01-21 01:30:22
5922413,7111,23243327,129,Not clear why we wind up in Right no matter what. Comment to clear it up?,207897851,2015-01-21 01:31:07
5922413,7111,23243515,272,can you comment why you break the pattern here of not calling .get at the end of the fold and instead put it here? Is it that sometimes this would fail (in the other branches)?,207897851,2015-01-21 01:33:36
5922413,7111,23243598,28,"does this one really have anything to do with Scrooge? If so, why is it not in the type parameter?",207897851,2015-01-21 01:34:41
5922413,7111,23243633,33,why is this here and not calling the object Macros? Would they not work?,207897851,2015-01-21 01:35:22
5922413,7111,23243761,69,why are we putting it explicitly below then? Can't we just use `runCompareTest[TestStruct]`?,207855729,2015-01-21 01:37:01
5922413,7111,23243872,69,"By the way, your comment is good here, but it would be better to also add it as a comment in the code to help the next reader who may not be you are I.",207855729,2015-01-21 01:38:07
5922413,7111,23243910,85,same comment as above.,207897851,2015-01-21 01:38:39
5922413,7111,23243885,75,same comments as above.,207897851,2015-01-21 01:38:21
5922413,7111,23244199,5,is there any reason we need a macro on this one at all? What part is macro generated? Can't we just use runtime reflection at instantiation to get the minField?,207897851,2015-01-21 01:41:43
5922413,7111,23244452,25,why does this have to be a Macro? I'm still not seeing the argument as to why basic types should not be implemented with an instance. If we need to use them in other macros get them implicitly or wrap them as you do in the ScroogeInternal macro.,207897851,2015-01-21 01:44:29
5922413,7111,23244595,64,looks like it is still using ByteBuffer here. Are there tests for this path?,207897851,2015-01-21 01:46:32
5922413,7111,23244671,64,Or is this macro hitting another tree and expanding that?,207897851,2015-01-21 01:47:26
5922413,7111,23244801,52,"It does not look like you are recursively calling the hash function here. So, if an inner type has a `def hash()` that is not just `.hashCode`, it would be lost here, right?",207897851,2015-01-21 01:49:04
5922413,7111,23244966,151,this code is duplicated above. Can we share.,207897851,2015-01-21 01:51:23
5922413,7111,23245275,47,"these could actually be optimized to work byte by byte. We don't need to read all 8 bytes of a long for instance. With big-endian ordering, lexigraphical ordering is correct.",207897851,2015-01-21 01:55:10
5922413,7111,23245704,97,"seems like we need a type other than Either here, and use `+` method on that type to implement this logic. I don't think it needs to be coded into the macro.",207897851,2015-01-21 01:59:44
5922413,7111,23246116,97,"reason is, reading this, I have no idea what Right and Left are here.",207897851,2015-01-21 02:04:30
5922413,7111,23246228,148,"should this be `frestT(""tmpRes"")`+=",207897851,2015-01-21 02:06:00
5922413,7111,23246768,53,"validTypes.exists(curType <:< _)

should be the same, right?",207897851,2015-01-21 02:12:50
5922413,7111,23247929,83,this looks almost identical to the case class code. Can't we share code here and just pass a Tree to instantiate the new object?,207897851,2015-01-21 02:26:52
5922413,7111,23248668,27,can we change the name to something with `TProtocol` on this one to make it clear that the implementation is different?,207897851,2015-01-21 02:35:26
5922413,7111,23249381,55,"can we add a comment to the magic numbers (6 == ""Field "".length)",207897851,2015-01-21 02:43:43
5922413,7111,23250008,38, comment here as to what Outer means would be good.,207897851,2015-01-21 02:51:25
5922413,7111,23250214,26,Can we not just make this a normal implicit now?,207897851,2015-01-21 02:54:18
5922413,7111,23250417,45,Can we just rename this part to ImplicitTreeOrderedBuf?,207897851,2015-01-21 02:56:54
5922413,7111,23251234,44,Byte.compare,207897851,2015-01-21 03:07:37
5922413,7111,23413931,28,"Let's add a type constraint if possible, a comment otherwise as to what `T` is valid for this macro.",207897851,2015-01-23 04:59:50
5922413,319889,23414542,33,They would. I'm not sure we want to keep the object macros too long term. But right now these are just straight up duplicates/bad,207897851,2015-01-23 05:07:33
5922413,7111,23422655,75,I think we need `ProductLike.hash` to ensure that we recurse on the hashing as well.,209444338,2015-01-23 07:11:29
5922413,319889,23424607,28,"So as i think you alluded to somewhere else, we could put the type in here, but this one right now actually winds up being a superset of all the macros. ",207897851,2015-01-23 07:53:11
5922413,319889,23425064,27,"Did this one, called it ScroogeTProtocol for now",207897851,2015-01-23 08:03:09
5922413,7111,23561537,50,you want to use your fancy new hashing on this?,210819080,2015-01-27 03:29:36
5922413,7111,23561892,52,"this is the one you want to replace with a non-implicit, right?",210819080,2015-01-27 03:34:54
5922413,7111,23562016,62,murmur int hashing here?,210819080,2015-01-27 03:36:35
5922413,7111,23563588,24,"might be better to just take the Class[T] here than the ClassTag, since that's all we need, right? Otherwise, we are going to have to serialize the ClassTag. I'd be more confident we are serializing the Class correctly.",210819080,2015-01-27 03:59:01
5922413,7111,23563824,60,"does a.compareTo(b) not work here?

http://people.apache.org/~thejas/thrift-0.9/javadoc/org/apache/thrift/TBase.html

Did that only show up in 0.9? (TBase extends Comparable).",210819080,2015-01-27 04:02:04
5922413,319889,23563904,60,"Dunno if its 0.9 or because its invariant as a trait, but nope doesn't work here",210819080,2015-01-27 04:02:57
5922413,7111,23564043,59,thes look like they should be scalacheck. Can't we write an Arbitrary for TestThrftStructure and express these very cleanly?,210819080,2015-01-27 04:05:10
5922413,7111,23564121,43,I think the todo can be gone now.,210819080,2015-01-27 04:06:26
5922413,7111,23564251,45,"I think we should remove this and instead register a default serializer for subclasses of Boxed. This way, this code might eventually get away with not depending on Kryo. Maybe not needed immediately.",210819080,2015-01-27 04:08:06
5922413,7111,23565026,34,"might as well inline this too, right?",210819080,2015-01-27 04:19:00
5922413,7111,23565339,104,not sure the specialized is buying us much here since Iterator is not specialized.,210819080,2015-01-27 04:23:04
5922413,7111,23565560,53,is this faster than hashing the bytes?,210819080,2015-01-27 04:26:01
5922413,7111,23565771,59,"we should merge this with `singleOrdered` to reduce code duplication `valueSorting == singleOrdered(""value"")`",210819080,2015-01-27 04:29:00
5922413,7111,23565958,95,"comment to the loop here: it is a search of all parents of this.

One note, we actually have a much simpler version of this in RichPipe, I remembered, that we use in the REPL. (.upstreamPipes or something). It uses the fact that we have a DAG so we don'",210819080,2015-01-27 04:31:40
5922413,7111,23565991,118,this should call singleOrdered,210819080,2015-01-27 04:32:03
5922413,7111,23566290,25,"`C` type is unused, right? can be deleted?",210819080,2015-01-27 04:35:54
5922413,7111,23566332,38,"`C` is unneeded, right?",210819080,2015-01-27 04:36:26
5922413,7111,23566431,24,"can we get a comment as to what the elementData means here? I can guess, but a clear explanation will be nice.",210819080,2015-01-27 04:37:45
5922413,319889,23566653,53,"This is straight out of guava, we aren't using it yet actually we use the String one in the scala murmur hash at the moment",210819080,2015-01-27 04:40:37
5922413,7111,23567542,88,vector has fast append. List has very slow (O(N) vs O(log_32 N)). The difference might change compile times for wide products.,210819080,2015-01-27 04:51:54
5922413,7111,23568082,174,"I'm nervous about this cost. We have to allocate the list, and then walk it and call functions.

What if you unroll this in the macro? Can't we do that?",210819080,2015-01-27 04:57:48
5922413,7111,23568313,51,"should this be `isSame = inputStreamA.readByte == inputStreamB.readByte`?

Two comments here:
1) Mutability and side effects bit us. an immutable tail recursive loop might have avoided this.
2) We need a unit test to check this one.",210819080,2015-01-27 05:00:24
5922413,319889,23568419,174,"We could, need a better pattern as how those things should fully unroll nicely. But yeah its effectively unrolled then re-rolled. ",210819080,2015-01-27 05:01:43
5922413,7111,23568473,68,was this in a macro? why the long path? Let's import this.,210819080,2015-01-27 05:02:23
5922413,319889,23568556,68,Yeah its all been pulled out of the macro. It probably should go somewhere else in serialization land since its nothing specific to do with this,210819080,2015-01-27 05:03:27
5922413,319889,23568749,51,Yeah it should be a tail recursive loop.. Now that its more pulled out it should be easier to test it explicitly.,210819080,2015-01-27 05:06:07
5922413,7111,23570222,233,"if you make this a final val that is a function2, you won't have to box it again on every compare (the method to function takes a boxing).",210819080,2015-01-27 05:26:24
5922413,7111,23570070,201,"what is the `q""e""` here? Not following. Comment?",210819080,2015-01-27 05:24:16
5922413,7111,23573558,268,ahh is this the e I asked about before? Tricky....,210819080,2015-01-27 06:14:58
5922413,7111,23573848,65,don't we need to skip the rest of the bytes? this is just stopping at the first difference.,210819080,2015-01-27 06:19:29
5922413,7111,23573973,88,weird indentation here.,210819080,2015-01-27 06:21:26
5922413,7111,23574199,30,can we switch Short and Byte to go in size order?,210819080,2015-01-27 06:24:59
5922413,319889,23575687,268,"Yeah, its not wonderful. Should be refactored away",210819080,2015-01-27 06:49:59
5922413,7111,23575766,109,let's use `Arrays.sort` with our comparator that will guarantee we are not making a copy with sortWith.,210819080,2015-01-27 06:51:36
5922413,7111,23576487,53,Let's add a comment as to the serialization format here.,210819080,2015-01-27 07:03:25
5922413,7111,23576559,146,"builders can take a size hint, I think. It might speed things up since we know the size.",210819080,2015-01-27 07:04:41
5922413,7111,23576957,232,"1 here is for the 1 byte to write 0, right? Comment to that effect.",210819080,2015-01-27 07:12:41
5922413,7111,23576986,203,"I'm nervous about the head being called, but I don't understand with the actual tree here is. Can we see this is never called if it is empty? Can you comment to that?",210819080,2015-01-27 07:13:32
5922413,7111,23577061,212,"can you capture this and share with the same below. The 1 here is slightly non-obvious, since it is `sizeBytes(0)`, right?",210819080,2015-01-27 07:14:53
5922413,7111,23577605,43,why not just inline a constant here?,210819080,2015-01-27 07:25:43
5922413,7111,23577696,39,"why not Integer.compare(lenA, lenB)?",210819080,2015-01-27 07:27:14
5922413,7111,23577735,24,"this does not skip to the end. That is needed right? Cascading is going to blow up without it, isn't it?",210819080,2015-01-27 07:27:53
5922413,7111,23577762,50,I don't think we need the root here. math.min will do.,210819080,2015-01-27 07:28:36
5922413,7111,23577802,52,this is a bad name. Can you use `curCmp` or something?,210819080,2015-01-27 07:29:30
5922413,7111,23577816,60,Integer.compare instead here.,210819080,2015-01-27 07:29:44
5922413,7111,23577867,72,"let's use java.util.Arrays.sort and take an Ordering here, which is a comparator, and can be passed all the way down.",210819080,2015-01-27 07:30:45
5922413,7111,23577954,80,"let's get the size from the arrays, which will be basically free. Also, this is incorrect. You are taking a traversableonce but using it twice (toArray and size).",210819080,2015-01-27 07:32:33
5922413,7111,23578273,118,"this is weaker than taking `List[(T, T)]` unzipping them and comparing in binary being the same as in memory. In yours you are always exercising the equality check, which always has to read all the bytes no matter what.  I'd like to see this strengthened.",210819080,2015-01-27 07:39:24
5922413,7111,23578303,108,"I've seen these before, and they exist in OrderedSerialization.",210819080,2015-01-27 07:39:46
5922413,7111,23578313,103,Let's remove this duplication in test code.,210819080,2015-01-27 07:39:58
5922413,7111,23578468,347,list of these would be good too.,210819080,2015-01-27 07:42:25
5922413,7111,23578537,157,"there are a few more tests we want to add:

1) transitivity. I added it to the laws in OrderedSerialization: a < b && b < c implies a < c. Same for equality.
2) a sequence of comparisons in the same stream. You do that in checkMany, but only for equali",210899057,2015-01-27 07:43:24
5922413,319889,23579358,24,"Nope, not needed, the OrderedSerialization handles the skipping to the end, so once they don't compare equal they can just return that result",210819080,2015-01-27 08:00:15
5922413,319889,23579406,212,"Yes, maybe it should really just call that to be clear",210819080,2015-01-27 08:01:30
5922413,319889,23579533,232,Yes,210819080,2015-01-27 08:04:28
5922413,319889,23579522,203,"It possibly gives us back a tree that will get the size of that element. So by itself it does nothing, the tree is guarded by isEmptyies in the two MaybeLengthCalculations below",210819080,2015-01-27 08:04:19
5922413,319889,23579577,88,"Without auto indenting the indentation in some of the quasiquotes is questionable. I've most sane, but... any you see not",210819080,2015-01-27 08:05:16
5922413,319889,23579592,65,As below we can just leave it to the ordered serialization we are in to handle that,210819080,2015-01-27 08:05:31
5922413,7111,23792671,157,this was done.,210899057,2015-01-30 01:58:27
5978700,7111,23409555,430,"can you change the type below on next:

`def next[K]: (K => Boxed[K], Class[_ <: Boxed[K]])`

That is actually more correct since Class is invariant. ",209425792,2015-01-23 04:03:56
5978700,7111,23409577,25,let's not println if it is working.,209425792,2015-01-23 04:04:16
5978700,7111,23409766,61,change bufferable to serialization or something.,209425792,2015-01-23 04:06:36
5978700,7111,23410417,9,"this will hurt complexity if we get too large. Might be better to keep a `Set[Pipe]` too:

```scala
import scala.collection.immutable.Queue

case class ToVisit[T](queue: Queue[T], inQueue: Set[T]) {
  def maybeAdd(t: T): ToVisit[T] = if (inQueue(t))",209425792,2015-01-23 04:15:00
5978700,319889,23410474,430,"That i have trouble working in WrappedSerialization, since this spreads out over there as this return type is basically passed in. Unless we want to erase it to Class[_] grouped maybe?",209425792,2015-01-23 04:15:57
5978700,7111,23410585,430,never mind then. It's all casts anyway.,209425792,2015-01-23 04:17:23
6027245,7111,23584981,22,"actually it is better to fix this to be a `CMS[Array[Byte]]` and make implicit hasher following this approach:

https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/CountMinSketch.scala#L1113

The way we h",210954254,2015-01-27 10:23:53
6027245,622449,23586950,22,OK thanks will do,210954254,2015-01-27 11:44:16
6027245,622449,23642791,22,"Does this have any implications for persisted data, or is this OK to change?",210954254,2015-01-28 04:06:37
6027245,7111,23648792,22,"Those CMS values are not persisted beyond a single join.  Of course,
someone could do something crazy and save them, but the migration is their
problem at that point.

On Tue, Jan 27, 2015 at 11:06 AM, Alex Levenson <notifications@github.com>
wrote:",210954254,2015-01-28 05:24:39
6027245,622449,23649267,22,K thanks just wanted to double check,210954254,2015-01-28 05:30:27
6027245,7111,23660523,42,why is this here?,211352837,2015-01-28 08:52:57
6027245,7111,23660543,42,"ahh, because hash is no longer public.",211352837,2015-01-28 08:53:26
6027245,622449,23661537,42,"actually I removed the hash() method entirely, we actually need to share the serialization function with the estimation code that happens below so we can pass the right key into the cms",211352837,2015-01-28 09:20:35
6028301,319889,23588150,24,"This is some dependency pollution, all parquet users will end up picking this up. Maybe mark this as provided. Downstream users who want to use avro will then need to bring their own parquet-avro",210984356,2015-01-27 12:31:59
6028301,319889,23588245,79,Why are these being set here/hard coded? What is AvroWriteSupport.java? ,210984356,2015-01-27 12:35:43
6028301,622449,24385556,24,"I think it would make more sense to split into a separate sub module per format, so that dependencies don't grow here.",210984356,2015-02-10 09:46:53
6028301,319889,24385922,24,"We might end up with module creep in dependencies with lots of modules then
for all combinations. Could we maybe go the provided route to keep them
separate ? It's own form of uglyness... But avoids build file growing hugely

On Monday, February 9, 2015, ",210984356,2015-02-10 09:59:42
6028301,622449,24386584,24,"well maybe go the other direction then -- treat parquet as a common thing, and push this up into scalding-avro, and put parquet-thrift in scalding-thrift?",210984356,2015-02-10 10:19:38
6147311,622449,24127099,5,could be a val right?,214262635,2015-02-05 05:38:31
6147311,1825352,24128280,5,".from is a def, what will be benefit of making this a val?",214262635,2015-02-05 05:54:18
6147311,7111,24129751,5,"If it is a val, then you only have one of them, and don't reallocate them
(that said, Executions are not in the hot path, so no big deal).

On Wed, Feb 4, 2015 at 12:54 PM, Kevin Lin <notifications@github.com> wrote:

> In scalding-core/src/main/scala/com",214262635,2015-02-05 06:16:43
6222395,7111,24441070,9,"you want to drop the type of line? `.flatMap { line => line.split(""\\s+"") }`

Also, I think `.map(_ -> 1L)` is a bit too compact for an example. Can we do: `.map { word => (word, 1L) }`?",216434130,2015-02-11 02:15:35
6222395,7111,24441125,12,"you could drop the types here, or comment that we list the types to get the compiler to error if we are writing something other than what we expect.",216434130,2015-02-11 02:16:08
6222395,319889,24441325,12,Useful to put a comment on each line saying the type of the typed pipe there?,216434130,2015-02-11 02:18:08
6222395,319889,24441354,12,"Another variant of this in one of your sets of slides has a custom tokenizer method, should that be included to show udf calling? ",216434130,2015-02-11 02:18:29
6222395,7111,24441433,12,"if you you like, as it is a tutorial, but it could get confusing since .sumByKey will return an UnsortedGrouped.",216434130,2015-02-11 02:19:19
6222395,319889,24441655,12,"I would have relied on the implicit back to typed pipe and pretended it was back as the pipe. But yes, might be better without...",216434130,2015-02-11 02:21:36
6222395,622449,24457218,9,"could add:
`// the compiler knows line is a string, so we can call split without specifying a type unlike in the fields API`",216439625,2015-02-11 05:25:51
6245786,7111,24620544,15,do we need a whole separate project here?,217056243,2015-02-13 04:11:22
6245786,7111,24620688,34,can we add this to the script that runs the tutorials to make sure this stays tested?,217056243,2015-02-13 04:12:57
6245786,7111,24620710,22,where is this used?,217056243,2015-02-13 04:13:15
6245786,7111,24620808,50,"can we add a comment that we could have gotten a similar effect with:

`.writeExecution(TypedTsv(args(""output"")))`",217056243,2015-02-13 04:14:12
6245786,1825352,24627560,15,"We don't have a project for tutorial yet. Not sure if that's designed. I created this seprate project for execution only, because in the example I want to show how to run the job as a pure scala/java application. Therefore I need the com.twitter.scalding.",217056243,2015-02-13 05:34:38
6245786,1825352,24632279,22,Removed,217056243,2015-02-13 06:37:48
6245786,1825352,24632284,34,Added,217056243,2015-02-13 06:37:53
6245786,1825352,24632287,50,Added.,217056243,2015-02-13 06:37:57
6245786,7111,24706461,7,do we need to do this? I think just running the assembly on the next target will do.,217743037,2015-02-14 06:37:24
6245786,7111,24706484,28,do we really depend on this?,217743037,2015-02-14 06:37:56
6245786,7111,24706530,27,I don't think this is provided for this case. You will need it to run.,217743037,2015-02-14 06:38:49
6245786,7111,24706583,23,why is this here? It is unusual. Can you comment on this and the above?,217743037,2015-02-14 06:39:51
6245786,7111,24706713,10,"can we not run with scald.rb? A main goal here is to just run like a normal JVM app. Why can't we run this using `java jar`? That should be the full demo, in my view.",217743037,2015-02-14 06:42:17
6245786,622449,24706964,61,maybe comment why you need .unit?,217743037,2015-02-14 06:47:30
6245786,1825352,24707310,7,"Without build scalding-core, travis gave me this failure:
https://travis-ci.org/twitter/scalding/jobs/50681252",217743037,2015-02-14 06:55:22
6245786,1825352,24707607,27,You're right! This probably also explains why with this I need to build scalding-core in my test.sh,217743037,2015-02-14 07:02:02
6245786,1825352,24709906,10,"I was working with @ianoc on this. Previously what I put here is ""scala -classpath ..."", but travis complains it couldn't find ""scala"" command. So we figured out travis uses scald.rb to setup scala version etc. Not sure if java -jar will directly work. I ",217743037,2015-02-14 08:14:47
6245786,7111,24868820,8,do we still need this with the fixes you put in place in the bash script? I'm trying to minimize the time the tests take here.,219155159,2015-02-18 07:16:51
6245786,1825352,24880810,8,"Yup, have removed this and merged with most recent develop. It's
merge-green now.

On Tue, Feb 17, 2015 at 4:17 PM, P. Oscar Boykin <notifications@github.com>
wrote:

> In .travis.yml
> <https://github.com/twitter/scalding/pull/1196#discussion_r24868820>:",219155159,2015-02-18 13:07:09
6257813,7111,24630169,35,aren't you disregarding the chillConf here? Don,217359943,2015-02-13 06:04:32
6257813,7111,24630234,2,2015,217359943,2015-02-13 06:05:38
6257813,7111,24630277,29,views are kind of deprecated. I think .iterator would work here and be less unclear.,217359943,2015-02-13 06:06:29
6257813,622449,24630482,31,want any validation on ary not having length greater than 2 here?,217359943,2015-02-13 06:09:42
6257813,622449,24630572,28,"does this turn into java.lang.String.split?
String.split isn't very flexible on corner cases (like repeated commas, trailing commas, etc.) Not sure how complicated the input string here will be.",217359943,2015-02-13 06:10:56
6257813,319889,24631028,35,"Yep, i just realised this myself after staring at some failing hadoop jobs for too long :/ Good catch",217359943,2015-02-13 06:18:14
6257813,319889,24631085,28,"No idea, i guess we've been running with this for a while ok. You mean it includes blank entries in the event of repeated commas? We could filter them out here too",217359943,2015-02-13 06:19:05
6257813,814892,24633940,28,"split excludes blank entries, repeated commans iirc. I had to use .split("","", -1) once because I wanted to keep the blank entries.",217359943,2015-02-13 07:07:18
6257813,7111,24634931,28,"we should move this to `Config.getCascadingTokens: Map[Int, String]` We might want unit test it.",217359943,2015-02-13 07:28:51
6257813,7111,24635118,45,I don't think we need the .toList here.,217370451,2015-02-13 07:32:45
6257813,7111,24635674,18,should these be here? Seems weird to force the filter in getKryoRegisteredClasses. I think we should filter the result when we are making tokens if this is a public method.,217370451,2015-02-13 07:42:56
6257813,319889,24636379,18,"Any preference on the top options? keep public and move filters, or make private and leave as is, maybe changing the comment/function name to match the fact its filtered?",217370451,2015-02-13 07:56:09
6257813,7111,24636413,47,"Let's add a comment here to the effect of:

The serialization of your data will be smaller if any classes passed between tasks in your job are listed here. Without this, strings are used to write the types IN EACH RECORD, which compression probably take",217359943,2015-02-13 07:57:00
6257813,7111,25039293,28,"This input string is always well formed and always looks like: ""a=b,c=d,e=f"" I don't think we need to freak out here and as Ian says this has been running at Twitter for years now.",217359943,2015-02-20 07:05:10
6257813,814892,24633980,28,wouldn't work for other whitespace though.. tabs etc.,217359943,2015-02-13 07:08:01
6276555,164018,24846950,64,"I'm curious, why do you use ""."" to capture nesting instead of actually nesting groups?",218120759,2015-02-18 02:45:32
6276555,6923512,24858818,64,"@julienledem Hi Julien, totally agree with you, it will be better to use nesting groups. The reason I make the generated schema flat is because today [TupleWriteSupport](https://github.com/Parquet/parquet-mr/blob/master/parquet-cascading/src/main/java/par",218120759,2015-02-18 05:02:27
6276555,319889,24859809,9,comment,218120759,2015-02-18 05:13:46
6276555,319889,24859817,58,"doing tuple converters/setters like this if you have macros in the fray is dangerous, you could get one macro generated and not the other making them incompatible",218120759,2015-02-18 05:13:47
6276555,319889,24859854,8,Do you need macros and macro implicits?,218120759,2015-02-18 05:14:12
6276555,319889,24859887,82,"You should just import this, you've used it with and without root. So importing it up the top is safer",218120759,2015-02-18 05:14:43
6276555,319889,24859927,62,drop the braces for a single statement,218120759,2015-02-18 05:15:16
6276555,319889,24859957,41,"these are mostly repetition, can we not make a helper function here?",218120759,2015-02-18 05:15:40
6276555,319889,24859995,30,why is it lazy?,218120759,2015-02-18 05:16:05
6276555,319889,24860085,42,you should use the platform tests framework for these. None of this code seems too needed/ideal to replicate here?,218120759,2015-02-18 05:17:08
6276555,319889,24860561,74,Does this cover all the data types?,218120759,2015-02-18 05:22:47
6276555,6923512,24864638,74,"Hi @ianoc, the current version of [TupleWriteSupport](https://github.com/Parquet/parquet-mr/blob/master/parquet-cascading/src/main/java/parquet/cascading/TupleWriteSupport.java) only supports primitive type. And in its implementation Strings is mapped to ",218120759,2015-02-18 06:13:21
6276555,319889,24864735,74,"Great thanks, looks like here you might want to include Long and Short for completeness?",218120759,2015-02-18 06:14:41
6276555,6923512,24865380,74,"@ianoc, yes exactly. You are right, this is not clear, I will add a test with a case class that contains all the primitive types to make this clear. ",218120759,2015-02-18 06:23:20
6276555,6923512,24865465,74,@ianoc Thank you so much for this detailed review. I will come with commits to fix all the problems you've mentioned. ,218120759,2015-02-18 06:24:34
6276555,319889,24866337,74,"Thank you for this PR, some great work. Nice new macro",218120759,2015-02-18 06:36:42
6276555,6923512,25536968,8,"Hi @ianoc , you are right. There's no need for macro implicits. I keep macros and delete these macro implicits in my latest commits.",218120759,2015-02-28 03:38:02
6276555,6923512,25537031,41,"Hi @ianoc , refacto done, please check my latest commits.",218120759,2015-02-28 03:39:08
6276555,6923512,25537059,30,"No reason to make this lazy, bad habit of mine, shamed.",218120759,2015-02-28 03:39:38
6276555,6923512,25537120,42,"Refacto done, and have used hadoop platfrom tests framework in the lastest commits.",218120759,2015-02-28 03:40:40
6276555,105067,26878411,26,"You can call a macro inside a macro, so you could actually have the `ReadSupport` types generated as well.",224048513,2015-03-21 03:35:02
6276555,105067,26878574,26,"Oh, hm, I just saw your comment about this, sorry.",224048513,2015-03-21 03:37:32
6276555,164018,27901416,10,"none of those macros depend on scalding and could be in the parquet project.
You could use them with Spark for example.",224048513,2015-04-07 22:42:08
6276555,164018,27901608,57,You should mention in the doc that the support for lists is not implemented yet.,224048513,2015-04-07 22:44:23
6276555,319889,27901632,19,can you lift the quasiquotes version up the top of the file here and in the other usages,224048513,2015-04-07 22:44:35
6276555,164018,27901648,45,and Byte?,224048513,2015-04-07 22:44:44
6276555,164018,27901844,32,Am I missing something or should the startField/endField calls be around the startGroup/endGroup and not the other way around?,224048513,2015-04-07 22:46:37
6276555,164018,27902361,27,we should be able to do better than creating through reflection. After all it's a macro.,224048513,2015-04-07 22:51:19
6276555,164018,27902647,17,"The downside of this is boxing primitives.
temporarily storing the value before creating the case class instance could be delegated to the PrimitiveConverter children. Each can have a field of the right type. There's no need to store it as an Option as w",224048513,2015-04-07 22:54:02
6276555,6923512,28202079,10,"hi @julienledem , I will commit a PR in parquet project once it comes to release then I will commit a PR in scalding to delete these macros. Right now could we let these macros stay in Scalding?",224048513,2015-04-12 14:26:14
6276555,6923512,28202082,32,fixed in the latest commits,224048513,2015-04-12 14:26:48
6276555,6923512,28202086,17,"Hi @julienledem , thanks a lot for your good advice, this is improved in the latest commit, please check.",224048513,2015-04-12 14:27:56
6276555,6923512,28206742,27,Fixed in the latest commit,224048513,2015-04-13 00:57:39
6276555,7111,28284828,6,"what does this type do? It is unclear to mo. Why use currentValue and hasValue, not Option[T].",243932647,2015-04-14 03:15:18
6276555,7111,28285523,6,I guess I'm asking two things: 1) can you add a comment to this type. 2) why not use Option rather than two methods.,243932647,2015-04-14 03:25:32
6276555,6923512,28314804,6,"Hi @johnynek thanks a lot for the review. This trait is here to model parquet tuple field reading converter. As a field in parquet tuple can be ""REQUIRED"" and also ""OPTIONAL"". Not using Option[T] is to avoid Option boxing overhead for those fields that ar",243932647,2015-04-14 15:08:45
6276555,6923512,28551870,6,"Hi @johnynek , I've added some comments for the trait. Is that ok for you? Please let me know your thoughts. ",243932647,2015-04-17 02:31:06
6276555,7111,32167540,42,this macro is not hygenic. We need the fully qualified path here.,247795266,2015-06-11 02:17:50
6276555,6923512,32211051,42,"Hi @johnynek , this is fixed in this commit: https://github.com/JiJiTang/scalding/commit/60e7390ea018f291728aab65414e125108541e79 merged with PR #1303 ",247795266,2015-06-11 16:19:01
6284315,7111,24784045,41,should probably fix this. Looks like someone updated the comments.,218128639,2015-02-17 07:05:36
6284315,7111,24784073,32,"my joke word, sensical, was removed as it is nonsensical.",218128639,2015-02-17 07:06:14
6284315,7111,24784160,120,"this should just be .sorted, sortBy(identity) is indirect.",218128639,2015-02-17 07:08:58
6413421,7111,25303816,25,Looks like we are committing an extra space. Let's remove that.,222356672,2015-02-25 06:18:16
6413421,7111,25363596,25,"I'll commit it, but see in line 64, where before it said: ""new AveragedValuSerializer"" now it has two spaces: ""new  AveragedValueSerializer"".

The larger point is that your diff should be as minimal as possible when making a functional change (such as t",222356672,2015-02-26 01:14:30
6413421,2408876,25373954,25,Sorry. I didn't notice space. Thanks for advice. I will remember it.,222356672,2015-02-26 03:06:59
6424967,1825352,25370742,5,Alphabetical order.,222956122,2015-02-26 02:33:20
6424967,1825352,25370837,61,"hits is an an absolute counting, not a percentage.",222956122,2015-02-26 02:34:14
6424967,1825352,25370982,61,Never mind. We only put a Map of size 1 here.,222956122,2015-02-26 02:36:02
6424967,24443,36268951,111,"What if this is an empty string? (Presumably that's possible, since we check for that with `fp.getStringProperty(SIZE_CONFIG_KEY)` on line 206 above.) Or if someone gets creative and sets it explicitly to false?

I'd think it should be something like `v",260638708,2015-08-05 09:41:06
6424967,24443,36269081,64,"Speaking of performance, since we're concerned to the point of wanting iterators instead of closures, using maps at all seems like it'd be slower than using objects here. I haven't done the benchmarking, but might it be worth switching to stats objects in",260638708,2015-08-05 09:45:03
6424967,319889,36271095,64,In general I think it would be great to get some benchmarks down on this code if we can before merge if we can. Cascading local mode might be good enough to sense check the overheads here,260638708,2015-08-05 10:45:32
6431876,622449,25403224,13,"random: I think there's also .map(_.toBoolean), which throws for invalid boolean strings, compared to:
```
scala> java.lang.Boolean.parseBoolean(""heyyy"")
res2: Boolean = false
```",223122306,2015-02-26 10:54:05
6431876,622449,25403604,35,override def?,223122306,2015-02-26 11:06:43
6431876,622449,25403790,459,"If I'm reading this right, it's a concurrent queue / stack?
java.util.concurrent comes with already built things like this, eg: http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html

then next could just be: 
`def ne",223122306,2015-02-26 11:14:51
6431876,622449,25403815,459,"or, if you want blocking, http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/BlockingQueue.html",223122306,2015-02-26 11:16:09
6431876,622449,25403931,45,is this a question?,223122306,2015-02-26 11:20:53
6431876,622449,25403986,56,RuntimeException? IllegalStateException?,223122306,2015-02-26 11:22:36
6431876,622449,25404053,63,"prefix w/ more context? ""X is not a CascadingBinaryComparator""",223122306,2015-02-26 11:25:24
6431876,622449,25404058,61,why only look at the 0th element? ,223122306,2015-02-26 11:25:40
6431876,7111,25404142,459,"We are using a built in feature: atomicreference. Do you think we gain by using ConcurrentLinkedQueue? I like using AtomicReferences with immutable data structures, personally. I find it really enjoyable.",223122306,2015-02-26 11:28:30
6431876,622449,25404155,71,GroupBy and CoGroup are the only types that incur hadoop sorting? Would there ever be another type in the future and we could forget to update this here? (probably not right?),223122306,2015-02-26 11:28:51
6431876,622449,25404196,71,How does total sort happen in scalding / cascading? Does it go through groupby / cogroup?,223122306,2015-02-26 11:30:38
6431876,7111,25404474,71,"We only use these two, and as per our discussion: we could imagine only using GroupBy. I do not think cascading has another primitive that does this sorting.

If by total sort, you mean secordary sort on the values, that is handled by GroupBy. I am not ",223122306,2015-02-26 11:42:08
6431876,622449,25404520,46,"comment as to why these choices were made would be useful to other readers (like me).
Why largest two mersenne primes? 
Why are floats boxed into Floats() and then converted to Ints and then hashed, but doubles are converted to Longs and then hashed?",223122306,2015-02-26 11:44:35
6431876,622449,25404705,24,"baos.toByteArray involves a copy of the internal buffer used by ByteArrayOutputStream -- if the usage pattern is to write to a ByteArrayOutputStream, then fully consume it as an input stream, then we could avoid the copy by creating a ByteArrayInputOutput",223122306,2015-02-26 11:52:43
6431876,622449,25405053,143,readPositiveVarInt?,223122306,2015-02-26 12:05:46
6431876,622449,25405068,158,RuntimeException / IOException w/ more context?,223122306,2015-02-26 12:06:25
6431876,622449,25405094,168,what's this for? does the caller already have s and can call this on s directly?,223122306,2015-02-26 12:07:51
6431876,622449,25405102,183,writePositiveVarInt?,223122306,2015-02-26 12:08:12
6431876,622449,25405253,42,"What's the issue with DataInputStream? You have to allocate it as a wrapper too frequently?
If a lot of this comes directly from DataInputStream, can you add property tests that asserts that RichInputStream behaves like DataInputStream? There's a lot of ",223122306,2015-02-26 12:14:48
6431876,622449,25405294,59,"do we expect to hit non-markable streams, or is this just here for completeness? Would we want to log when this happens?",223122306,2015-02-26 12:16:58
6431876,622449,25405384,18,comments as to why this trait defines satisfied on 3 inputs but Law1 and Law2 ignore some of those inputs?,223122306,2015-02-26 12:20:33
6431876,622449,25405404,27,do we need to copy their License file / header or something here too?,223122306,2015-02-26 12:21:42
6431876,622449,25405414,31,"seed is clearly a seed, but what's C1 and C2?",223122306,2015-02-26 12:22:12
6431876,622449,25405463,31,"nvm, this is directly from the guava file",223122306,2015-02-26 12:24:09
6431876,622449,25405595,96,"what does the x in the syntax:
```
try x {

} catch {

}

do?

I would have thought this would need to be:

try {
  resultFrom {
    ... 
  }
} catch {

}",223122306,2015-02-26 12:29:34
6431876,622449,25405677,107,any reason these laws are in the source tree not the test tree?,223122306,2015-02-26 12:32:13
6431876,622449,25405778,109,"you could check that it's also true for:
compare(b, a) == writeCompare(b, a)
compare(null, a) == writeCompare(null, a)
etc.",223122306,2015-02-26 12:34:53
6431876,622449,25406320,118,"I had to stare at this for a while to convince myself that this is the same as:
```
if (ordb.lteq(a,b) && ordb.lteq(b,c)) {
  ordb.lteq(a, c)
} else {
  true
}
```
Do you think that is more clear?

Similarly here do we want to check that it's tr",223122306,2015-02-26 12:55:18
6431876,622449,25406541,50,"can't imagine that it matters, but the abstract class InputStream defaults to delegating this method to read(bytes, off, len) but allows it to be overridden, which means some wacky input stream *might* handle read(bytes) differently than read(bytes, 0, by",223122306,2015-02-26 13:02:19
6431876,622449,25406898,68,"fun fact did you know that at once point (not sure if still true)
`new String(bytes, Charsets.UTF_8)` was 40% slower than `new String(bytes, ""UTF-8"")`",223122306,2015-02-26 13:13:21
6431876,622449,25407170,72,an instance of Serialization could do this better if it knew the size to allocate ByteArrayOutputStream right?,223122306,2015-02-26 13:21:52
6431876,622449,25407228,108,"the contract is stronger than this right? Not that we can enforce it, but we should document that these laws should be true across JVMs right? Or I guess that's only true of keys in groups / joins and not necessarily here?",223122306,2015-02-26 13:24:03
6431876,622449,25407333,25,"serA and serB are going to do fancy murmur hashing, but then they are combined more simply -- is that OK? Or is this how the murmur hashes are combined in that class from guava as well?",223122306,2015-02-26 13:27:45
6431876,622449,25407395,34,"we silently ignore b's exception here, can it be combined into some kind of composite failure of 2 exceptions?",223122306,2015-02-26 13:29:38
6431876,622449,25407485,54,is this out of date? you have to read both as you mention on the next line right?,223122306,2015-02-26 13:32:25
6431876,622449,25407588,101,what does try with no catch do?,223122306,2015-02-26 13:36:09
6431876,622449,25407667,26,"so this implements the same ordering as java.lang.String.compareTo, on bytes assumed to be UTF-8 encoded strings?

I think that'd be worth documenting, and maybe explain the algorithm a bit as well",223122306,2015-02-26 13:38:54
6431876,622449,25407805,26,"This works because UTF-8 interpreted as a series of *unsigned* bytes sorts correctly when sorted on its bytes, right?

What's the advantage of comparing as many longs as we can, then ints, then bytes? Logically comparing just bytes would be correct, rig",223122306,2015-02-26 13:44:00
6431876,7111,25407861,24,"This is only used in tests, if I'm not mistaken.",223122306,2015-02-26 13:45:55
6431876,7111,25407900,158,what more context can we get than the stack? This should never happen.,223122306,2015-02-26 13:47:10
6431876,622449,25407917,35,why not  a Set? order matters?,223122306,2015-02-26 13:47:40
6431876,622449,25407926,52,No serializer for class c found?,223122306,2015-02-26 13:48:02
6431876,622449,25407953,64,you don't want to `out.close()` because it is the caller's responsibility? ,223122306,2015-02-26 13:48:56
6431876,7111,25407956,42,"Have you looked at the code in DataInputStream? It is not a just a wrapper, it has lots of internal buffers. Allocating those in a tight loop will not be free. This, being an AnyVal, will not require any allocations.",223122306,2015-02-26 13:49:02
6431876,7111,25407996,42,"Also note, this code is tested pretty heavily as we have some heavy duty property tests going on that call this (scoverage can be used to verify this claim).",223122306,2015-02-26 13:50:09
6431876,7111,25408015,59,It's a generic method. It's here for completeness. This code only depends on InputStream.,223122306,2015-02-26 13:51:03
6431876,7111,25408123,96,"It does what you wrote. Just with less `{ }`. `try` is an expression, so, `try x` evaluates the expression `x` in the try block. That expression might be a block itself, or in this case a method call, `resultFrom`. Keeping in mind you can use `{ }` and pa",223122306,2015-02-26 13:54:35
6431876,7111,25408160,107,"1. the laws document in code the requirements here. They are like executable comments.
2. any testing system can use them without putting a dependency on a particular system and version (this has burned us in the past with the algebird laws which we want",223122306,2015-02-26 13:56:04
6431876,7111,25408177,109,null will probably throw. Generally scala code is not null-safe.,223122306,2015-02-26 13:56:54
6431876,7111,25408234,109,"checking `a, b` and `b, a` is probably not needed since this code is expected to be used in random generation cases (a la scalacheck). So, by doing that you are just sampling twice as many with a weird bias. If you want more test cases, just turn them up,",223122306,2015-02-26 13:58:34
6431876,622449,25408256,43,Is having 99 Box classes needed because something outside of our control (kryo?) requires a Class to be the key in some map?,223122306,2015-02-26 13:59:38
6431876,7111,25408295,72,Good call and we actually do have such a method: dynamicSize.,223122306,2015-02-26 14:01:03
6431876,7111,25408339,108,"Yes that's true that we expect serialization to be a pure function (which only depends on the input, which does not include the identity of the computer running the code). Would you like a comment that effect?",223122306,2015-02-26 14:02:53
6431876,7111,25408436,64,"seems like, but we're not 100% sure the contract is well defined between Hadoop and what Cascading does. Want to check into that?",223122306,2015-02-26 14:07:03
6431876,7111,25408496,43,Both Cascading and Kryo dispatch on class.,223122306,2015-02-26 14:08:47
6431876,622449,25408837,459,"What does immutability buy us here if we're swapping out the variable in an atomic reference?
```
val boxes = ConcurrentLinkedQueue[...](allBoxes)
def next = Option(boxes.poll()).getOrElse(sys.error(""Exhausted the boxed classes""))
```
I think that is",223122306,2015-02-26 14:18:22
6431876,622449,25408958,109,"well, for both of these points, I'm getting at the java Comparator / equality laws that are defined, which includes what comparisons with null are supposed to return, as well as transitive laws etc. I see the transitive parts covered later, but I think ja",223122306,2015-02-26 14:22:24
6431876,7111,25408972,459,"so, in your example, the reader has to know that this API is not going to block when it polls, and that poll when empty indeed returns null. I'm not sure I see that the compare and swap is any more error prone than code you wrote (which we can still get w",223122306,2015-02-26 14:22:47
6431876,7111,25409046,109,"since we use scala Orderings all the time in the typedAPI, I guess cascading does not care. Thankfully, it does not quietly pass nulls you didn't write in your data to your comparator.

This library is following scala conventions, so I think exception o",223122306,2015-02-26 14:25:21
6431876,7111,25409152,34,"We could, and I've done this kind of thing before. It does not fit really well with java since you can't compose the stack traces, but I guess you can print two error messages and maybe put the second stack trace into the error message.",223122306,2015-02-26 14:29:07
6431876,7111,25409157,101,looks like a bug.,223122306,2015-02-26 14:29:23
6431876,7111,25409190,26,"This works because comparing the binary of utf-8 as unsigned bytes gives the same sort as comparing the unicode code-points by index, which is what String.compare does. This is only coupled to the encoding in that the serialized data was written with UTF-",223122306,2015-02-26 14:31:10
6431876,7111,25409135,25,serA and serB might do any kind of hashing. There is no contract on that at all. Would you like a stronger combining of hashes here? I don't know how Guava combines hashes (though I don't think it is gospel). We looked at how scala does and cascading does,223122306,2015-02-26 14:28:09
6431876,7111,25409238,35,"order does not matter, but it is private and Iterable is cheaper. If you get a duplicate, there is a bug somewhere because this code both generates and reads these lists (and as you recall with the atomicreference, each Boxed is only used for one type.",223122306,2015-02-26 14:32:57
6431876,622449,25411009,118,"if I defined an ordering: `def compare(a: T, b: T) = -1` it would pass this check.
Maybe we need a check:
```
ab = Integer.signum(compare(a,b))
ab == 0 || ab == -Integer.signum(compare(b,a))
```",223122306,2015-02-26 15:22:49
6431876,319889,25442180,118,"It would pass the check, but i don't think this check is designed/should necessarily catch that. Its catching a transitive property, which if you have a constant result from compare is actually a valid transitive compare ? 

If we don't have it then i g",223122306,2015-02-26 23:43:57
6431876,319889,25442553,346,"We could do this i guess easily, but maybe it wouldn't be common enough for much of a win? Should probably add an issue around the todo i suppose if we want to do it or just kill the todo?",223122306,2015-02-26 23:48:02
6431876,319889,25442712,45,"Yeah, seems like we could just kill this comment, adding the implicits locally seems like a fine/good thing.",223122306,2015-02-26 23:49:51
6431876,319889,25442774,56,Does that really buy us anything? its not specific enough to match on really?,223122306,2015-02-26 23:50:30
6431876,319889,25443200,168,"only write is defined on s(where write is overloaded with several arg signatures), these actually really aid code readability. ",223122306,2015-02-26 23:54:50
6431876,319889,25443705,54,"Each has a built in skip when it goes, so they do stop reading and fire a skip in once they are done. Each OrderedSerialization should fully consume a,b but i guess not necessarily read it all",223122306,2015-02-27 00:00:04
6431876,319889,25442300,45,"Lets just move this to one of the other PR's? and remove from here -- if its not in those PR's we might forget to uncomment, and if its in them doesn't need to be here",223122306,2015-02-26 23:45:13
6431876,319889,25442420,43,can kill TODO,223122306,2015-02-26 23:46:40
6431876,7111,25449355,56,Agree with Ian on this. I'll change it to RuntimeException (is there another kind? :) but note the purpose of this method: to fail with an unrecoverable error if the user has declared that they require OrderedSerialization on every grouping.,223122306,2015-02-27 01:08:36
6431876,7111,25460711,50,good catch. This should be a pass through.,223122306,2015-02-27 03:21:57
6431876,7111,25460604,109,"Actually I'm missing 2 out of three laws on Orderings, so I'll add those:
http://en.wikipedia.org/wiki/Total_order",223122306,2015-02-27 03:20:52
6431876,7111,25460656,118,I'll use this clearer style.,223122306,2015-02-27 03:21:17
6431876,7111,25461160,68,"thanks, Java.",223122306,2015-02-27 03:27:42
6431876,7111,25466901,45,I think I uncommented in the follow up (I think). I'm just as worried we won't remember to add it (since that happens to). I'll do what you prefer.,223122306,2015-02-27 04:36:00
6431876,7111,25476041,108,added a comment on the class.,223122306,2015-02-27 06:27:18
6431876,7111,25476187,68,"actually, staticSize and dynamicSize need to be added. I wonder if they should not have default implementations. Its too easy forget about them.",223466882,2015-02-27 06:29:31
6431876,319889,25476658,68,"Seems reasonable not to have them have any defaults, make someone think about the cost involved if they don't supply them if they write something manually. ",223466882,2015-02-27 06:36:54
6431876,7111,25453049,13,good call.,223122306,2015-02-27 01:52:57
6431876,622449,25551306,459,"not a big deal, but, we need to test that this feature works, but we don't need to test that ConcurrentLinkedQueue works as described since we get that for free. We need to test that we're using it correctly though. Writing tests for multithreaded coded i",223122306,2015-02-28 08:06:23
6431876,622449,25551383,56,">> is there another kind?

Yes! 1/2 of the exceptions are not RuntimeExceptions :)
RuntimeExcept should be named ""UncheckedException"" -- the difference matters more in java, but it is the base class for all unchecked exceptions. IOException is not a Ru",223122306,2015-02-28 08:08:54
6431876,622449,25551480,71,"No I didn't mean sort on secondary values, I meant if you wanted a total sort on all your data, though I guess in scalding you just do groupAll for that? We don't have a distributed total sort operator (that samples and partitions and merges?)",223122306,2015-02-28 08:11:47
6431876,622449,25551528,168,"oh I see, writeBytes is a better name than write, yes",223122306,2015-02-28 08:13:17
6431876,622449,25551554,42,"OK, didn't know that DataInputStream had lots of internal buffers",223122306,2015-02-28 08:13:57
6431876,622449,25551596,107,makes sense,223122306,2015-02-28 08:15:38
6431876,622449,25551695,108,well it also includes Set / Map ordering as well -- you've got to serialize those deterministically ,223122306,2015-02-28 08:19:13
6431876,622449,25551745,25,"no, just don't have any intuition on if it matters. This is a common way to combine though so seems fine.",223122306,2015-02-28 08:21:06
6431876,7111,25551750,108,"yeah, I'm thinking actually this may be too strict. If you are this strict, I'm not sure why you would not want to go all the way to OrderedSerialization.

Dropping this strictness might be something we would do in the future if we require Serialization",223122306,2015-02-28 08:21:24
6431876,622449,25551762,34,"yeah, pretty silly that stacks don't compose. I'd say ""just log it"" but we're not really in the right place to do logging here.",223122306,2015-02-28 08:21:43
6431876,622449,25551772,101,odd that it compiles,223122306,2015-02-28 08:22:19
6431876,622449,25551797,35,It's cheaper memory-wise but we use it for lookups by traversing it right (slower)? We don't expect this to be large or in the hot path right so probably doesn't matter?,223122306,2015-02-28 08:23:46
6431876,622449,25551806,64,OK,223122306,2015-02-28 08:24:12
6431876,7111,25551836,35,"I *think* this is not in the hot path. But if it is, we should use a Map. I guess using a Map may be the right thing to do just in case. Lots of times we got burned on Hadoop or cascading doing something repeatedly that you might guess only happens a hand",223122306,2015-02-28 08:25:44
6431876,622449,25552102,35,"OK -- I remember I fixed a Pig UDF that used an ArrayList instead of a Set, expecting it to make a big difference and then it didn't because for a certain size of ArrayList, just iterating is about as fast as a map look up (that certain size being very sm",223122306,2015-02-28 08:36:28
6431876,7111,25551553,71,"Right. There is no total sort or even controlling partitions in scalding (beyond keys).

With this new code, you can control hashing, but even then who knows how cascading will make hashcodes to reducers.",223122306,2015-02-28 08:13:57
6432262,622449,25897451,43,nice,225933674,2015-03-06 03:14:10
6432262,622449,25898458,57,"macro noob question, does `ConstantLengthCalculation` get evaluated once at compile time, or every time `length` is called at runtime? I see the `q""...""` syntax is used to put some scala code into the output of the macro, but that's not the only way to ac",225933674,2015-03-06 03:26:58
6432262,622449,26344521,46,"require is defined as:
`require(requirement: Boolean, message: ⇒ Any)`

Does that mean that the string interpolation won't happen unless `i<0`? Does it also mean that every time this method is called, a closure is created to hold the string interpolati",228274848,2015-03-13 03:06:43
6432262,622449,26348046,31,"just curious, is 24 a guess or something from your benchmarks?",228274848,2015-03-13 03:50:54
6432262,622449,26356859,30,does this mean that case classes with generic params are not supported? Just trying to see if I'm reading this right.,228274848,2015-03-13 06:19:27
6432262,622449,26357709,147,"we don't have control over baos, so moot point",228274848,2015-03-13 06:40:07
6432262,622449,26356444,147,"this writes to a side buffer, then copies it into the final buffer right?
Parquet handles this case in a few places by using something similar to a BAOS that instead just collects byte arrays instead of copying them into an internal array. Not sure if th",228274848,2015-03-13 06:10:32
6432262,622449,26358902,82,we could wrap this in a java method w/ `@SuppressWarnings`,228274848,2015-03-13 07:08:07
6432262,622449,26358908,82,not a blocker though,228274848,2015-03-13 07:08:17
6432262,622449,26360095,53,not an issue,228274848,2015-03-13 07:42:57
6432262,622449,26360098,31,not an issue,228274848,2015-03-13 07:43:02
6432262,622449,26360106,61,not an issue,228274848,2015-03-13 07:43:16
6432262,622449,26360648,87,"maybe add a comment here along the lines of
`// TODO: Investigate benefit of using getBytes(Charset) on jvms > 1.6`",228274848,2015-03-13 08:03:42
6432262,622449,26360764,27,"Do the tests for this create arbitrary strings by forming arbitrary sequences of chars? Because some UTF characters in UTF-16 representation are actually two consecutive chars, we should make sure we're covering this case.",228274848,2015-03-13 08:07:47
6432262,622449,26361126,68,"Why do we have to list all the collection types here instead of taking anything Traversable, with a special case for Map / Set / Array? Like we the case for all the other kinds of Traversables / Iterables?",228274848,2015-03-13 08:20:58
6432262,622449,26361214,41,don't a lot of these cases overlap? Sets are Iterable aren't they? And the Set case comes later?,228274848,2015-03-13 08:24:17
6432262,622449,26361774,84,"shouldn't this just be:
```
case o: MyData => true
case _ => false
```
?

The docs for canEqual aren't that clear, but it sort of sounds like they want to know if something could possibly equal something else?",228274848,2015-03-13 08:45:18
6432262,622449,26361967,189,also known as `i.signum` !,228274848,2015-03-13 08:53:01
6432262,622449,26362116,287,"Somewhere I missed where arbitrary strings are generated I think -- do we know for sure it covers all the strange types of characters, including UTF characters that take up 2 jvm chars ?",228274848,2015-03-13 08:57:57
6432262,622449,26362167,379,"if we're generating the sets from the same jvm, chances are equal sets will have equal orderings, do we exercise equal sets with unequal order anywhere? ",228274848,2015-03-13 08:59:27
6432262,7111,26365624,41,```Set[Any] <:< Iterable[Any]``` not `=:=`.,228274848,2015-03-13 11:21:26
6432262,7111,26365655,27,"Scalacheck generates strings by taking random characters and putting them in arrays. It could be more robust, but it is pretty good. The downside is it is biased pretty strongly toward non-ascii strings by default. It would be nice to actually have a larg",228274848,2015-03-13 11:23:07
6432262,7111,26365681,68,"You are thinking in terms of subclasses, but these macros will generate an invariant `OrderedSerialization` that guarantees that the output type is the same as the type resolved. We have to generate the right type signature in that `OrderedSerialization`.",228274848,2015-03-13 11:24:26
6432262,7111,26365726,53,"yes. UTF-8 is a superset of ascii, and the alphaStr is only ASCII.",228274848,2015-03-13 11:26:51
6432262,7111,26365750,209,"no, we don't. JDK does not, so we let that go. The OrderedSerialization.Result.unsafeToInt does return -1, 0, 1 though.",228274848,2015-03-13 11:28:05
6432262,7111,26365788,379,Good point. We could make an a ListSet here with a random permutation. I'll add that.,228274848,2015-03-13 11:29:28
6432262,7111,26365763,287,"in scalacheck, as I describe above: random chars (16 bit numbers) in an Array, converted to String.",228274848,2015-03-13 11:28:37
6432262,622449,26348569,53,"are these streams usually backed by a byte array? If not, reading 1 byte at a time vs. chunks of bytes could matter, though maybe BufferedInputStreams handle that case for us too?",228274848,2015-03-13 03:57:49
6432262,622449,26356732,61,do you have to worry about fully consuming the record from the stream? Or is that handled somewhere via mark() / reset() / skip() ?,228274848,2015-03-13 06:16:10
6432262,622449,26360108,30,not an issue,228274848,2015-03-13 07:43:21
6432262,622449,26361619,53,"for my own understanding, this should be the same as `s.getBytes(""ASCII"")` right?",228274848,2015-03-13 08:39:12
6432262,622449,26362025,209,"do we enforce the constraint that compare returns (-1, 0, 1) or is it valid to return some other negative or positive values, which might trip this check?",228274848,2015-03-13 08:54:47
6432262,7111,26433753,379,"Actually, I already have a listset in the tests, and it uses the same code path. I think we're safe here. Can we drop this issue?",228274848,2015-03-14 07:34:49
6432262,622449,26520153,209,"Yeah, so that was my point:
`assert(oBufCompare(a, b) + oBufCompare(b, a) === 0`
is too strict right?
Should be:
`assert(oBufCompare(a, b).signum + oBufCompare(b, a).signum === 0`

unless these compare methods always wind up going through `unsafeToI",228274848,2015-03-17 01:41:55
6432262,622449,26520456,287,"so that approach, as best I can tell, would generate strings with invalid characters in it. Not all 16 bit numbers are valid jvm characters -- some of them are only valid when immediately followed by certain other characters.

http://docs.oracle.com/jav",228274848,2015-03-17 01:45:59
6432262,622449,26520622,379,ok,228274848,2015-03-17 01:48:12
6448329,7111,25472437,8,"can we do this:
```scala
def rowL1Normalize(implicit num: Numeric[V], mj: MatrixJoiner2): Matrix[R, C, Double] = {...
```
then use `num.toDouble(x).abs` on line 151? This will let us work with Int, Long, Float, etc...

Also if you could make the sam",223451980,2015-02-27 05:39:06
6448329,7111,25542047,19,"let's use `TypedTsv` here and not use Pipe at all (just go right to `TypedPipe.from(TypedTsv[(Int, Int, Long)](""long_normalized"")`)",223480935,2015-02-28 04:52:34
6448329,7111,25920736,12,why is there `.abs` here?  I think it is only needed for L1 normational.,225890186,2015-03-06 09:00:23
6448329,7111,25541894,22,you don't need the asInstanceOf anymore right? Can we remove that?,223480935,2015-02-28 04:50:15
6448329,7111,25541908,10,this cast needs to be removed as you did below.,223480935,2015-02-28 04:50:28
6468354,7111,25561748,1,let's not add this change.,224271479,2015-03-01 05:05:14
6468354,7111,25561754,17,let's not use the ClassTag. That will complicate the use of the code.,224271479,2015-03-01 05:05:34
6468354,7111,25561768,34,"actually, I think it is as easy as removing the `U` and `V` and not adding the ClassTags.",224271479,2015-03-01 05:06:54
6514940,7111,25991479,5,you want `Local(true)` here right? `strict = true`?,226824494,2015-03-07 08:42:20
6514940,7111,25991501,5,"I guess not. The previous (perhaps questionable) logic is that strict means something is there, but maybe not all the paths. Nothing being present still won't run. Since currently Local only supports one path (even though it could support more), I suppose",226824494,2015-03-07 08:43:32
6547516,7111,26068893,5,"1) let's make this a def (avoid having two fields with the same data).
2) to decrease the chances with collide with another name can we give it a longer name? `_implicitJobArgs` or something?",226836934,2015-03-10 01:52:13
6550996,319889,25959961,45,"Should probably try catch around this and print a good error message, why we are loading it and that it comes from that field in the jobconf",226965656,2015-03-07 00:13:34
6550996,319889,25959994,46,can this fail? should we try add a good error if so?,226965656,2015-03-07 00:14:06
6550996,319889,25960082,45,Can we use the config passed into this method instead of the jobConf? ,226965656,2015-03-07 00:15:07
6550996,1202170,25984372,45,"Yes, it'd make sense to wrap classloader exceptions here and at least steer the user to the wiki, as already done on other exceptions. And on the wiki, a longer explanation that the user should provide the appropriate cascading fabric jar.

Will update ",226965656,2015-03-07 05:37:11
6592017,319889,26061007,5,"jar mode i think expects things to be a fatjar. Adding modules just to the hadoop classpath, but not also on libjars is likely to cause it to fail on the mappers/reducers?",228176705,2015-03-10 00:21:51
6724375,319889,26713908,13,Do we know how this will be serialized? Kryo field serializing this I think would serialize the Head element followed by a function0 which has the Iterator in its closure?,232958065,2015-03-19 04:23:02
6724375,319889,26713973,13,"I believe a platform test could validate it, though i don't think it can validate easily the excessive reading problem",232958065,2015-03-19 04:24:03
6724375,7111,26714428,13,"Good point, when this using the KryoHadoop instantiator that I updated, so for Stream it should serialize by iterating all the data and forcing the stream. That might not be ideal, but since there is no contract that Iterable is lazy, this should be fine.",232958065,2015-03-19 04:29:49
6724375,319889,26715044,13,"Ok, i guess there's some special case in that its a traversable in there. Do we need a test around this? Its probably fine/tiny.",232958065,2015-03-19 04:39:15
6724375,7111,26715217,13,"This line here:

https://github.com/twitter/scalding/pull/1230/files#diff-950283e698e7d0a9b2bb04551c277715R60

uses the fact that Stream is traversable to use the Traversable serializer in chill. I tested that in the chill pull request:

https://git",232958065,2015-03-19 04:41:52
6724375,44017,26715451,13,"Hm, so I can remember being pretty happy when I realized that this was getting read separately on each mapper (though certainly, it's *much* to easy right now to accidentally read it 1000s of times on each mapper). I think it's easy to have data here that",232958065,2015-03-19 04:45:11
6724375,7111,26715580,13,"Well, there is this:

http://docs.cascading.org/cascading/2.6/javadoc/cascading-hadoop/cascading/tap/hadoop/DistCacheTap.html

Maybe that's the way to go?",232958065,2015-03-19 04:47:20
6724375,44017,26715851,13,"Yep, that looks right. We'll want to make sure it's cached in memory on each mapper vs. reading from the tap on every iteration through it. (The argument here being that if it's larger than memory, you should be leaving it as a TypedPipe, not making an It",232958065,2015-03-19 04:52:08
6724375,44017,26715980,13,... and using DistCacheTap might do some funky things if we try to read it from the submitter? So need to test that usecase as well.,232958065,2015-03-19 04:53:55
6724375,7111,26775470,13,This is starting to sound pretty complex actually. I'm not actually sure of a reliable way to see if a function is being called on the submitter or in a task. The only way I can think of right now is to add some static method to update some state variable,232958065,2015-03-19 23:12:16
6724375,319889,26776118,13,How big are the things your reading avi that putting it in the job conf is bad? I guess if your concerned with filling up memory quite large. We are running into the issue of possibly reading it multiple times. But also the previous step can have 100's to,232958065,2015-03-19 23:17:48
6724375,7111,26776564,13,"Also note: cascading should use the distributed cache for large JobConfs (if not, that's a bug). On the other hand, I guess it will deserialize it once per map-task rather than once per machine (not sure if once per machine will even be doable with Hadoop",232958065,2015-03-19 23:22:11
6724375,44695,26776848,13,It does use the dist cache if they are largish.,232958065,2015-03-19 23:24:42
6724375,44017,26779699,13,"@ianoc Yes, if it's 100s of part files, being read over HDFS by 10,000 mappers, that's gonna suck - but if that becomes a single distributed cache file that they're each reading from local disk, not so bad. (And it's not like the reads magically go away j",232958065,2015-03-19 23:49:30
6724375,319889,26713674,4,"Should we open some issue to kill this again, lest we forget... Though we'll probably forget about the issue too",232958065,2015-03-19 04:19:22
6811653,7111,27233370,9,"```scala
def distinctSize: This[K, Long] = toSet[T].mapValues(_.size)
```
should work, right?",236237402,2015-03-26 23:07:52
6811653,1825352,27247223,15,Sure thing. Updated.,236608796,2015-03-27 01:27:47
6811653,1825352,27237665,9,"Yup, this should work. Just updated the code.

On Thu, Mar 26, 2015 at 10:08 AM, P. Oscar Boykin <notifications@github.com>
wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/typed/KeyedList.scala
> <https://github.com/twitter/scalding/pull/12",236237402,2015-03-26 23:49:00
6811653,7111,27238031,15,"actually, can't we do the same trick here so that we always return `This[K, T]`? Since keyedlistlike is covariant in the value, this is just as good, and it simplifies the use case for the caller.",236608796,2015-03-26 23:52:13
6862203,7111,27339527,4,yes. This was crazy.,237501804,2015-03-28 06:09:24
6870955,319889,27351490,15,is this actually compatible with 2.10.3 -> 2.10.5? ,237798561,2015-03-29 10:02:51
6870955,125984,27351583,15,"My understanding (based on the [README](https://github.com/milessabin/shapeless)) is that shapeless 2.1.0 is only compatible with 2.11.x and 2.10.4, but I might be mistaken.  I think the relevant bits are as follows:

>Builds are available for Scala 2.1",237798561,2015-03-29 10:26:27
6870955,125984,27351595,29,This forces the TupleEntry to have exactly the same size as the HList.  I'm not sure if it needs to be this strict or if it would be ok for the TupleEntry to have more entries in it than the HList.,237798898,2015-03-29 10:29:39
6870955,125984,27351597,65,"Probably not the best to just ""get"" the Option here. Open to other suggestions.",237798898,2015-03-29 10:31:11
6870955,7111,27436132,29,shouldn't we run `toInt` once before creating the instance to guarantee that is only run once? We definitely don't work to run that on each tuple.,237798898,2015-03-31 02:58:58
6870955,7111,27436263,16,"should be a val, to be sure we only call once.",238113879,2015-03-31 03:00:52
6870955,146404,27437519,15,"Shapeless 2.1.0 has full cross-versions for 2.10 ([e.g for 2.10.5](https://repo1.maven.org/maven2/com/chuusai/shapeless_2.10.5/2.1.0/)), so it'd be better to use this:

    ""com.chuusai"" %% ""shapeless"" % ""2.1.0"" cross CrossVersion.full

So that we get",237798561,2015-03-31 03:19:43
6870955,146404,27438859,59,"I'm still getting a sense of the design here, but any reason you don't constrain the `FromTupleEntry` instances so that the `I` (which could be a type member) matches the length of the `HList`? That should allow you to omit the `N` type parameter here alt",238113879,2015-03-31 03:38:47
6870955,146404,27438984,26,`T` is unused here.,238113879,2015-03-31 03:40:37
6870955,7111,27511125,65,"So, TupleConverter and TupleSetter are the places where types are added and removed before handing to cascading. It can't be type-safe at that point because cascading is not type-safe. There is really nothing you can do but call .get. That said, in a well",237798898,2015-03-31 23:58:01
6887477,7111,27548632,50,"can you also add a test for the Typed-API? We recommend that one now (and it uses a different code path than the field API for joins).

To test, you should be able to add a stat in a `.reduce` following a join in the Typed-API.",238819393,2015-04-01 12:04:52
6914129,319889,27621492,6,if(true) ?,238965666,2015-04-02 04:19:18
6914129,2221968,27621906,29,"Not so related, but this should be wraps.skip(n)?",238965666,2015-04-02 04:26:39
6914129,7111,27621900,6,":) I should have changed that. Sorry. That was a quick hack to force that branch (rather than cutting all the code out). Let me see if the unit tests pass here, then I'll fix this.",238965666,2015-04-02 04:26:33
6914129,7111,27622043,29,shit. Yes.,238965666,2015-04-02 04:28:55
6914129,2221968,27622851,28,Should update this,238965666,2015-04-02 04:42:55
6914129,319889,27625398,30,how did this work before? do we never hit skip?,238965665,2015-04-02 05:36:08
6914129,7111,27625465,30,"no, we don't use it. We use skipFully, which calls the right one. Just hear to be a complete wrapper.",238965665,2015-04-02 05:37:33
6914129,319889,27625701,30,Ok cool,238965665,2015-04-02 05:43:51
6941578,7111,27751671,4,can these fields be private? ReplImplicits is imported by everyone using the REPL. ,239593024,2015-04-04 00:56:20
6941578,1443419,27760605,4,"Yes, done!",239593024,2015-04-04 03:35:32
7053712,7111,28188191,36,"for this case, let's instead use a property check. It will be much easier:

```scala
property(""fastSplit on comma is correct"") = forAll { (s: String) =>
  s.split("","") == fastSplit(s, "","")
}
```
see some of the other property check style tests in t",243349974,2015-04-11 04:37:04
7053712,7111,28188369,5,"this method will be called on every key in a group now (to fix a bug in counters inside of joins).

so, we really need to optimize this method.

1) let's not use .foreach. We should write a while loop.
2) we should check if flowMappingStore has the k",243349974,2015-04-11 04:41:12
7053712,7111,28188418,14,"use an IndexedSeq here, not a List. List is O(N) to access.",243349974,2015-04-11 04:42:50
7053712,7111,28188539,3,"do we have some benchmarks to show this is faster? I'm concerned that there are a few things in this code that look slow (List ++, foldRight on the string).",243349974,2015-04-11 04:46:08
7053712,7111,28188555,9,"rather than putting on the back and calling reverse, why not: `trailing :: tilNow` which is O(1) and then you don't need the reverse?",243349974,2015-04-11 04:46:37
7053712,7111,28188744,19,"this is probably the common case. I'd like to see us optimize for this case so in that case our only call is text.indexOf(key).

Also, why isn't something like this good enough:

```scala
def fastSplit(s: String, sep: String, from: Int): List[String]",243349974,2015-04-11 04:52:38
7053712,809255,28198830,19,"Hmm.. I was trying to make the fastSplit function to be exactly the same with the regex split function. 

One thing is that, for a string trailing with the separator, regex split drops all of them. 

i.e. ""a:b::"" would be ""a"", ""b"". But this would give",243349974,2015-04-12 03:01:43
7053712,809255,28199596,3,"I just implemented a new one after reading your comments. Will post soon:
             mean, std, median running time (nano seconds)
Java's: (7770.3,13256.792142520753,4000.0)
Fast:    (4087.7,39296.86258100002,3000.0)

using a small epoc of 100 stri",243349974,2015-04-12 05:31:00
7053712,7111,28293280,5,not using this anymore right? Or java.util?,243676099,2015-04-14 05:49:20
7053712,7111,28293424,13,"can you make this:

```scala
if(!flowMappingStore.contains(uniqueId)) {
  logger.debug(""Adding flow process id: "" + uniqueId)
  flowMappingStore += (uniqueId -> new WeakReference(fp))
}
```
The lazy parameter does an allocation that we could skip ",243676099,2015-04-14 05:52:43
7053712,7111,28367966,13,"My fault: I was wrong. .contains won't work here because the WeakReference may be out of scope (and is in the tests), I think. We just need to put each time.

To save the work, maybe keep a
```scala
private[this] var prevFP: FlowProcess = null
```
a",243676099,2015-04-15 01:38:28
7053712,622449,28368735,13,"why change `.put` to `.getOrElse` ? that seems very different, was that intentional? ",243676099,2015-04-15 01:46:49
7053712,7111,28368840,13,I think .getOrElseUpdate was intended.,243676099,2015-04-15 01:47:50
7053712,622449,28369244,5,"how about a test / property test that says ""fast split should behave the same as String.split?",243676099,2015-04-15 01:52:02
7053712,809255,28369799,5,"@isnotinvain Now that I dropped the part to match java's split, I'm dropping this test for comparing fastSplit and java's regex split. ",243676099,2015-04-15 01:57:41
7053712,622449,28370247,5,"wait, why?
I think we should assert that this matches String.split, or `String.split(s, -1)` if you want that behavior. But we have a reference that we know works.",243676099,2015-04-15 02:02:11
7053712,7111,28370832,5,we don't want to support regexs for splits. So it should match as long is the separator is not a regex.,243676099,2015-04-15 02:08:03
7053712,622449,28371053,5,"yes, that's what I meant.

assert that it matches `String.split(Arbitrary[String], OneOf("","", ""foo"", "":""), -1)`

the -1 makes split behave the way you'd expect, eg, just splits on the delimiter, includes empty strings when there are double delimiters ",243676099,2015-04-15 02:10:38
7053712,809255,28372773,5,@isnotinvain see your point now. Will fix it. Thanks :+1: ,243676099,2015-04-15 02:29:31
7053712,7111,28443834,21,"actually, this line should be moved outside of the if on line 129. We want to record that we processed this, even when there is no UniqueID.",244918284,2015-04-15 22:45:27
7053712,7111,28444035,55,"let's give this a better name. What about ""fastSplit(s, sep) should match s.split(sep, -1) for non-regex sep"" ",244918284,2015-04-15 22:47:39
7053712,7111,28456950,11,"actually, we want:

```scala
if (!(prevFP eq fp)) {
```
because we just want to use reference equality on this check (to make sure we never trigger some expensive structural equals method that could exist or be added to FlowProcess). Sorry, just noti",245296701,2015-04-16 01:03:06
7053712,7111,28463896,3,"the std. dev is probably huge due to occasionally hitting GC. Properly benchmarking is a bit of an art. There are some packages to make it easier, but this is fine for now.",243349974,2015-04-16 02:16:56
7073664,7111,28276089,8,"Let's not do the runtime exception. Instead can we do this:

```scala
trait MustHaveReducers extends HasReducers {
  def reducers: Some[Int]
}
```
This should show that reducers is a Some[T] which is a subclass of Option[T]. That should allow us at",244090552,2015-04-14 01:32:45
7073664,7111,28293173,20,"this is both, right? HasReducers and MustHasReducers? Or MustHasReducers should extend HasReducers.",244437830,2015-04-14 05:47:13
7073664,7111,28293188,20,I actually prefer the latter (MustHas extends Has).,244437830,2015-04-14 05:47:31
7073664,1825352,28295745,20,"I meant to make MustHas extends Has, but forgot to actually do it in the code.
Will update this.",244437830,2015-04-14 06:52:51
7073664,7053,28299437,7,Sorry to be picky. Can we call this `MustHaveReducers` instead?,244437830,2015-04-14 09:05:59
7073664,1825352,28303832,7,Of course!,244437830,2015-04-14 11:47:40
7073664,7111,28349358,7,why do we need the F-bounded polymorphism here? The trait never references `This`. I think this complicates things a bit. Can it be removed?,244532317,2015-04-14 22:28:34
7083847,319889,28275949,100,"Not an issue, but shame Await API doesn't cover returning a try instead of throwing and having to catch it. liftToTry on twitter futures is nice for that",244339472,2015-04-14 01:31:04
7083847,7111,28276684,100,agree.,244339472,2015-04-14 01:39:18
7083847,319889,28276833,35,should we open an issue for this? ,244339472,2015-04-14 01:40:49
7083847,7111,28285798,35,Looks like #390 is related.,244339472,2015-04-14 03:30:28
7083847,622449,28374825,198,"you probably want NonFatal here, this will catch InterruptedException, ThreadDeathError and so on. Often this can make a progam un-cancellable via control-c, because you are squashing interrupted exceptions from a non-daemon thread.",244339472,2015-04-15 02:54:57
7083847,622449,28374922,193,"if completeWith itself throws, this thread will die, which is why it's common to wrap all of run() in a try catch",244339472,2015-04-15 02:55:58
7083847,7111,28444414,193,"if completeWith throws, there is a serious logic error. That should never happen unless there is a fatal error. I didn't think I should catch that. What do you think? Should we try catch and exit if there is an exception?",244339472,2015-04-15 22:51:24
7083847,7111,28444616,198,"Okay. I got nervous about using NonFatal because I know it catches less than Twitter's version of that does, and if we don't complete that future, we are going to deadlock elsewhere, but in the unlikely event someone does control-c when we are at this sta",244339472,2015-04-15 22:53:12
7118429,319889,28456071,6,I think we should be catching this and possibly re-throw after we satisfiy the future. Your inclination i think i right in that will manifest poorly otherwise with hung programs with no visible reason why.,245258897,2015-04-16 00:53:37
7137054,7111,28547136,8,I don't like passing an Option just to call .getOrElse(Nil). I'd rather require the duration here and have callers do that.,245746004,2015-04-17 01:34:40
7137054,7111,28547167,22,`this` is weird on an object.,245746004,2015-04-17 01:35:07
7137054,7111,28547224,30,we are well past 0.9.0 now. Need to update this comment.,245746004,2015-04-17 01:35:43
7137054,7111,28547741,13,"`this` is not needed here, right?",245746004,2015-04-17 01:41:57
7137054,814892,28549823,30,Any idea why this was required?,245746004,2015-04-17 02:04:28
7137054,814892,28549959,30,Seems to me like this is actually needed to globify read paths but has to be removed for the write path?,245746004,2015-04-17 02:06:26
7151395,7111,28616673,5,why the bump here?,246130400,2015-04-17 23:09:09
7151395,319889,28617033,5,I was seeing failed builds due to 404's -- looks like the 0.5.0 version is no longer listed on maven central.. too old i guess,246130400,2015-04-17 23:13:27
7151395,7111,28617733,5,why can't we have an append only artifact cache? Sadness.,246130400,2015-04-17 23:21:34
7157982,7111,28637869,15,"where we are at it, java.lang.Long.compare will be faster here (no boxing).",246292993,2015-04-18 04:45:00
7339332,622449,29410457,105,this might not be worth keeping -- what do you think?,251570548,2015-04-30 13:13:29
7339332,622449,29410466,116,this might not be worth keeping -- what do you think?,251570548,2015-04-30 13:13:34
7352705,319889,29484360,4,mima is already in this file,251914046,2015-05-01 06:05:30
7352705,7111,30923424,71,what is up with the three values on the right in this column?,254254947,2015-05-23 00:17:13
7352705,7111,30923478,75,this seems to stop abruptly: case classes... ? what? I think you are going to explain that case classes are also flattened in left to right order. You might want to show an example of that.,254254947,2015-05-23 00:18:01
7352705,7111,30923573,71,"Seems like the SQL type is BOOLEAN, from reading the code below.",254254947,2015-05-23 00:19:26
7352705,814892,31104659,75,Added a nested case classes example.,254254947,2015-05-27 10:42:49
7352705,7111,33825651,29,what's the last step? How to I read or write from a Database? Seems like we are stopping short of clearly explaining the use of the whole package here.,277797164,2015-07-03 02:40:48
7352705,814892,33826068,29,"Yes, the sources will be added in a follow-up PR. So this is a little incomplete in that sense.",277797164,2015-07-03 02:44:34
7361511,360025,29774342,67,"""$providerConfKey is not set in configuration""",253388128,2015-05-06 21:16:46
7361511,360025,29775021,96,"conv.getClass would be ""BinaryConverter"", not the type parameter for ScroogeBinaryConverter, right? it does not matter except for stats, but just checking. ",253388128,2015-05-06 21:23:10
7361511,360025,29775405,112,would 'implicitly[ClassTag[M]].runtimeClass' be the thrift class? Can we use that in sourceConfInit too? This will help with stats and logging (where we would see the actual thrift class),253388128,2015-05-06 21:26:35
7361511,814892,29784130,112,Fixed in the read path. Thanks.,253388128,2015-05-06 22:58:10
7361511,7111,29785460,37,"this is actually more complex if you are going to support Unions at the outer most layer:

https://github.com/twitter/chill/blob/develop/chill-scrooge/src/main/scala/com/twitter/chill/scrooge/ScroogeThriftStructSerializer.scala#L45

",254137903,2015-05-06 23:11:19
7361511,7111,29785523,5,"Externalizer is already doing the equivalent of lazy, isn't it? Do we need it twice?",254137903,2015-05-06 23:12:00
7361511,7111,29786001,49,"this is not super precise. It could be Base64, but not compressed, but it's fine, I think we'll catch it in the decompression Injection.",254137903,2015-05-06 23:16:35
7361511,7111,29786126,40,"why not make this:

`def inj[T]: Injection[Externalizer[T], String] = { ...`

so we don't have to deal with ugly `_` issues. Should work fine, right?",254137903,2015-05-06 23:17:42
7361511,7111,29786257,69,we could avoid the cast here if we put the type on inj above.,254137903,2015-05-06 23:18:58
7361511,814892,29786882,37,"could have re-used that code if the codec methods were public. What do you think? Or maybe add support for BinaryThriftStructSerializer there.

Not sure if we're planning a chill release. I can copy over the code for union here for now.",254137903,2015-05-06 23:24:36
7361511,7111,30256574,40,"I don't think this is needed anymore. This was fixed. These is no need for the assert, is there?",255921831,2015-05-13 22:51:31
7361511,7111,30256896,71,"we often cache things like this if it happens a lot (and on hadoop, such things often happen a lot). Something like:

```scala
private[this] var last: Option[(String, BinaryConverter[M])] = None
last match {
  case Some((k, bc)) if k == data => bc
 ",255921831,2015-05-13 22:55:00
7361511,7111,30649080,74,"I think we need `case Some((d, conv)) if d == data => conv` matching on data, I think, will just shadow the data on line 71.

I think we need this because without it, a different conf passed could give different data.",258777343,2015-05-20 02:25:04
7361511,7111,30649438,88,"is the ClassTag serializable? Have we tested that this actually round-trips a java serialization (which should happen when cascading uses this on Hadoop).

I wonder if instead of keeping the ClassTag here if it is safer to just take a Class, which is se",258777343,2015-05-20 02:28:18
7361511,7111,30649559,29,"what if we just add `def class: Class[T]` instead of wiring to ClassTag? What do we gain by using the ClassTag here, since concrete subclasses could chose either way if we go with `Class[T]`.",258777343,2015-05-20 02:29:37
7361511,814892,30651660,74,"Oops, yes that's what I meant to do. Will fix.",258777343,2015-05-20 02:50:50
7366585,622449,29613698,5,why drop the types?,252451567,2015-05-05 00:14:51
7366585,7111,29614422,5,"Those give warnings (I think) by the compiler since scala can't see that the type MUST be U, and U is also erased. Scala type inference does not work great with case matches.",252451567,2015-05-05 00:24:41
7366585,38527,29614465,5,"scala can't verify the type, and I imagine it throws an error
",252451567,2015-05-05 00:25:14
7366585,7111,29615933,6,"This does not seem like an error to me. `Unit` is the type or the companion object where as `()` is the value of type `Unit`. This code is different, although it does not matter because we discard the side value at the end. 

Why the change?",252451567,2015-05-05 00:42:55
7366585,809255,29616906,6,"@johnynek I think I'm mixing two PR. One is to remove as many warnings as possible(https://github.com/twitter/scalding/issues/1139). For that purpose I'm seeing scala 2.11 gives warning when using () instead of Unit

[warn] /Users/exie/learn/ScaldingGit",252451567,2015-05-05 00:54:24
7366585,809255,29617322,5,"@isnotinvain Dropping the types since there're warnings about type erasure here. 



[warn] /Users/exie/learn/ScaldingGithub/scalding/scalding-core/src/main/scala/com/twitter/scalding/CumulativeSum.scala:42: abstract type pattern U is unchecked since ",252451567,2015-05-05 00:58:41
7366585,7111,29617648,6,"Ahh, this is what we want here. So, let's change it to:

```scala
(Some(s""$clsName,$lst""), ())
(Some(clsName), ())
```
and just not use the `->` enrichment.",252451567,2015-05-05 01:02:27
7366585,622449,29621841,5,"can it tell enough to know the ""shape"" is `(k, (u, v))`?

This is one thing I'm often confused about with case matching in scala, how to make sure you aren't accidentally doing reflection in a case match in a way that will never even match.",252451567,2015-05-05 01:45:31
7383081,7111,29616445,27,"can we do:
```scala
taps match {
  case Nil => throw new InvalidSourceException(""LocalPaths is empty"")
  case oneTap :: Nil => oneTap
  case many => new ScaldingMultiSourceTap(many)
}
```
This way, we don't use the multisource path, which is new i",252937609,2015-05-05 00:48:34
7383081,7111,29616541,53,let's use: `localPaths.map { p => new java.io.File(p) }` to be more consistent with scalding's style.,252937609,2015-05-05 00:49:45
7383081,7111,29616586,77,put this on the previous line.,252937609,2015-05-05 00:50:15
7383081,7111,29616618,80,let's only use the multisource if there is more than one path.,252937609,2015-05-05 00:50:34
7383081,7111,29616690,6,add space after `p` before `{`,252937609,2015-05-05 00:51:41
7383081,7111,29616718,7,`def localPaths = hdfsPaths` is better here. no `{}`,252937609,2015-05-05 00:52:03
7383081,7111,29731335,10,let's not put this as an inner object. Can we make it a `private[scalding]` object in FileSource.scala?,253751461,2015-05-06 07:48:57
7383081,7111,29731405,62,"why not add:

```scala
 Data is missing from: ${localPaths.filterNot { p => (new java.io.File(p)).exists}}
```
so the user can see exactly what is missing?",253751461,2015-05-06 07:51:13
7450656,7111,30555403,19,"so, we can't do this (because it would force everything to memory), but what about something like this:
```scala
class CountingIterator[T](wraps: Iterator[T]) extends Iterator[T] {
  private[this] var nextCalls = 0
  def hasNext = wraps.hasNext
  def",259800629,2015-05-19 03:56:52
7450656,7111,30555478,34,"probably better to use a group like ""scalding.debug"" since I think we want to group them up so they are easy to see next to each other in the job tracker UI.",259800629,2015-05-19 03:58:15
7450656,7111,30555527,31,"looks like a copied comment, don't want `2^2` right?",259800629,2015-05-19 03:59:12
7450656,809255,30555794,31,Ah you're right. it's a copied commend ,259800629,2015-05-19 04:04:14
7450656,809255,30555800,19,good point,259800629,2015-05-19 04:04:22
7450656,7111,30842780,45,"I don't think we want the group and counter to be the same string. We want the group to be something like ""scalding debug"" and the counter value is fine.",259808263,2015-05-22 01:18:27
7450656,7111,30842932,6,this is bug by itself. Can you confirm this is still true and not due to another issue? We don't want to make a bunch of groups.,259808263,2015-05-22 01:19:54
7450656,7111,30843039,24,let's remove println statements.,259808263,2015-05-22 01:21:01
7450656,7111,30842972,38,can we remove this change?,259808263,2015-05-22 01:20:16
7450656,7111,30843084,11,`.map {` note the space.,259808263,2015-05-22 01:21:31
7450656,7111,30843130,9,you could do `.forceToReducers.sum` and it should get the same effect.,259808263,2015-05-22 01:21:58
7450656,809255,30847400,6,"This seems to be a bug. if you simply put 

flowProcess.increment(""TestGroup"", ""TestKey"", 1)

in     def operate(flowProcess: FlowProcess[_], call: BufferCall[Any]) {

and this should print 3 in the test

ReduceValueCounterTest. However it prints",259808263,2015-05-22 02:03:28
7450656,809255,30847410,38,Fixed. ,259808263,2015-05-22 02:03:36
7450656,809255,30847433,24,Fixed. Dup-test. Thanks for the catch,259808263,2015-05-22 02:03:47
7450656,809255,30847442,11,Fixed. ,259808263,2015-05-22 02:03:53
7450656,809255,30847448,9,Good point. FIxed. ,259808263,2015-05-22 02:03:59
7451353,7111,29912834,49,"why is this on its own in 2.10, but not 2.11?",254721057,2015-05-08 07:08:35
7451353,7111,29912881,15,I'm nervous we need a test to be sure we are running all the tests. It would be really easy to leave a target out. Any ideas on how we can be sure we have everything other than just manually checking that all the targets appear somewhere?,254721057,2015-05-08 07:09:49
7451353,319889,29960844,49,"In consistency, will move about",254721057,2015-05-08 22:50:29
7451353,319889,29960743,15,I think I can hack that in with a bash script that will validate this file refers to each target twice maybe -- other than some blacklists. Its not pretty but I think it should work? Thoughts?,254721057,2015-05-08 22:49:44
7451353,7111,29961558,15,"I think that's fine. We can also run that bash script as part of the tests, so the tests use the .travis.yml and the Build.scala as inputs before we run any of the other tests it makes sure we are going to run all the tests.",254721057,2015-05-08 22:57:45
7451353,7111,30843546,3,is this 2.10 or 2.11? How does it know?,255789019,2015-05-22 01:25:55
7451353,7111,30844646,105,"what does this syntax mean? ""test tutorials *and* .. *and*""?

What is consuming the BUILD variable?",255789019,2015-05-22 01:36:31
7451353,319889,33493048,15,"Yeah its wired in as its own test target, we sort of had a free simple target we didn't use. so its in there.",254721057,2015-06-29 23:06:07
7451353,319889,33493077,3,"It doesn't alas, simple hack where it just says we only want one of them..",255789019,2015-06-29 23:06:24
7451353,7111,33522173,7,why are these changing at the same time?,277435592,2015-06-30 03:35:18
7451353,7111,33522691,21,should we use mktemp or tempfile here?,277435592,2015-06-30 03:41:30
7451353,319889,33522848,21,"Unfortunately those are pretty crappy across OSes, different on osx vs linux vs etc.. :/",277435592,2015-06-30 03:43:21
7451353,319889,33524241,7,"I rolled in another PR people had green since it effected testing time hugely, so two birds one stone. People had reviewed independently and thought ok.",277435592,2015-06-30 04:00:49
7458302,7111,29970123,54,"don't we want something like:

```scala
implicitly[Ordering[CaseClassWithOrdering]].isInstanceOf[OrderedSerialization[_]]
```
to be true? Because scalding is going to resolve using Ordering.",254860511,2015-05-09 00:39:55
7469402,7111,30356643,21,let's make this a private method on `object ExecutionContext`.,255038262,2015-05-15 00:59:03
7469402,7111,30356974,53,"```scala
def getDesc(v: Any): Seq[String] = v match {
  case vPipe: Pipe => RichPipe.getPipeDescriptions(vPipe)
  case _ => List() // no descriptions
}
```
then call that rather than the test + cast (do it in one go and no explicit cast).",255038262,2015-05-15 01:03:11
7469402,7111,30357076,45,"```scala
flow match {
  case hflow: HadoopFlow =>
    // logic here
  case _ =>
    // descriptions not yet supported in other modes
}
```",255038262,2015-05-15 01:04:31
7469402,7111,30358534,13,typo: with,255038262,2015-05-15 01:20:49
7469402,7111,30358579,14,make private as much as possible to make it easier to preserve binary compatibility.,255038262,2015-05-15 01:21:13
7469402,7111,30358954,220,`descriptions :+ description` would be better.,255038262,2015-05-15 01:25:31
7469402,7111,30359230,28,"why must it have `HasDescription`? without that, we could add this to `TypedPipe[T]` which I think would be useful.",255038262,2015-05-15 01:29:10
7469402,7111,30359303,13,"should add `TypedPipe[T] extends WithDescription[TypedPipe[T]]`, don't you think?",255038262,2015-05-15 01:29:55
7469402,7111,30356588,21,can we sort these to make sure it is stable? Not really sure we should sort on second thought. It would be good if the order is roughly the order that the descriptions came in.,255038262,2015-05-15 00:58:28
7469402,7111,30356715,30,"add an issue to the issue tracker so we don't lose track of this, and link the issue here.",255038262,2015-05-15 00:59:57
7469402,7111,30358296,25,nit: our style is to only use `{ }` when needed (more than one expression). Many of your `{ }` are redundant and we'd prefer if you not add them.,255038262,2015-05-15 01:18:16
7469402,7111,30358978,261,`use :+ rather than ++`,255038262,2015-05-15 01:25:51
7469402,86248,30360781,21,agreed to make it private.  I wanted the sorting to be in order and did the distinct just to be safe.,255038262,2015-05-15 01:45:03
7469402,86248,30360797,25,sounds good,255038262,2015-05-15 01:45:12
7469402,86248,30360843,45,looks good! will change,255038262,2015-05-15 01:45:39
7469402,86248,30361554,13,"I liked this approach because it just wrapped a pipe with a description, and you can see how easy it was.  otherwise every version of TypedPipe is going to have to set the description in their "".toPipe"" ... this puts it all in one place and it didn't seem",255038262,2015-05-15 01:52:48
7469402,7111,30363785,13,"Sounds fine to me. Just wanted to see your thoughts here. I don't really see us writing a method like:

```scala
def describe[T <: WithDescription[T]](t: T, s: String): T = t.withDescription(s)
```
which is the only think I can think of us doing with",255038262,2015-05-15 02:14:15
7469402,86248,30448656,30,"I'll also add it in the comment.
https://github.com/twitter/scalding/issues/1294",255038262,2015-05-16 02:44:05
7469402,319889,30449022,13,The other PR going in now puts a common toPipe wrapper in the TypedPipe trait for setting some state on our pipes before handing them out. When that merges doing the TypedPipe extends... will be more straight forward since all typed pipe instances are jus,255038262,2015-05-16 02:50:15
7469402,319889,30449785,38,"This will mostly work, but... our OrderedSerialization issues seem to have popped up that these won't always go together :/  -- we tried to use these to configure serializers for each step. Do an op that would do some transform then added the config to th",255038262,2015-05-16 03:02:08
7469402,86248,30450403,38,"I see your point, and I wonder if we remove ""withDescription"" from typedPipe and only allow it after you "".group"" if that would guarantee better that it is attached to the step where it occurs ... but then it is also less powerful and it is nice to annota",255038262,2015-05-16 03:13:43
7469402,319889,30452805,38,Funnily enough after a group by is exactly where we've been seeing it fail :/ I'm not sure its worth altering the plan here. This is a big step up in info/usability. We might just want to include a little note about YMMV i guess in a readme,255038262,2015-05-16 04:04:25
7469402,7111,30544300,23,this should be asPipe now.,258810526,2015-05-19 01:30:07
7469402,7111,30841126,27,can we get a log.info or debug here instead of a println?,261048504,2015-05-22 01:01:32
7469402,7111,30841287,27,"also, this looks like it is changing how all jobs are named. That is somewhat orthogonal to descriptions, right?

We have a lot of tooling that assumes the job names are not changed. Could we instead just add a key to the jobConf?",261048504,2015-05-22 01:02:59
7469402,7111,30842463,15,"can we factor `254.toChar` into a private val? Also, can you comment on the choice here? What impact does this have for UTF-8 descriptions? A guess since means that the 254 code point:  http://www.fileformat.info/info/unicode/char/fe/index.htm can't appea",261048504,2015-05-22 01:14:52
7469402,86248,30854223,15,"1.toChar is just as good, I can switch to that.",261048504,2015-05-22 03:23:09
7469402,86248,30854338,27,"hmmm, we actually like it to show it in hadoop jobtracker, what about we make it configurable so we will keep it setting name and we can default to something else?",261048504,2015-05-22 03:25:11
7469402,86248,30920912,27,"also, the ""job name"" always had ""(X/Y)"" appending to it, all this is doing is appending extra stuff after that, not changing the prefix.",261048504,2015-05-22 23:45:40
7469402,7111,31293683,27,"We have some analytics that run on our jobs and they match on the job name. For instance, we have a reducer estimator that runs and looks at the names to get the history of the particular step. Others might have other systems running.

I think changing ",261048504,2015-05-29 06:43:07
7469402,86248,31343543,27,I already pushed a change that would put the descriptions in a different config and not update mapred.name.  Since we want it appended to the name I will add a steplistener on our side that will just add the value to that config to the job name on our sid,261048504,2015-05-29 22:04:37
7469402,7111,31758750,62,"looks like you are still updating the job name. Like I said, I don't want to change that without more thought and buy in. Our existing job monitoring will be impacted and probably other systems will as well. I know we should have a test for anything we ca",265942145,2015-06-05 00:56:32
7469402,86248,31771582,62,"The mapred.name is already set by the time it gets here, so the job.xml file for hadoop will not have any mention of the descriptions. However, the ""stepName"" needs to be updated for the dot file generation to have the descriptions",265942145,2015-06-05 03:15:59
7469402,7111,32365980,23,"descriptions is unused, right?",268725265,2015-06-13 06:04:22
7469402,7111,32366011,29,can you comment on what is going on here?,268725265,2015-06-13 06:06:36
7469402,7111,32366041,31,"Option(encodedResult)
 .filterNot(_.isEmpty)

might be simpler. But no biggie if you don't want to do this.",268725265,2015-06-13 06:08:08
7469402,86248,32432361,23,good catch! thanks will fix,268725265,2015-06-15 20:29:42
7469402,86248,32441658,31,"oh good idea, will change.",268725265,2015-06-15 21:56:15
7469402,86248,32441703,29,"yep, will add note.",268725265,2015-06-15 21:56:42
7518114,319889,30373434,5,Did you manage to test this?,258214772,2015-05-15 04:21:28
7518114,7111,30373486,5,"No, I didn't, but it should not be hard to do. I'll add such a test.",258214772,2015-05-15 04:22:09
7530299,7111,30282307,5,"0) this looks really scary and architecturally bad news. I hope we can find some other way.

1) this should be `private[scalding]` at the very least.

2) can we add plenty of comments here as to what the use case is here.",256750332,2015-05-14 03:24:34
7530299,7111,30282420,37,why only add these when we require ordered serialization? We want to get the benefit even when we don't require all of them to be ordered. Some of them can still be a win.,256750332,2015-05-14 03:25:59
7530299,7111,30282462,37,ExecutionApp does not hit this code path. We should go deeper and look inside ExecutionContext.run to get to the shared code path.,256750332,2015-05-14 03:26:43
7558684,7111,30441913,29,"this is only testing for no exception, right? Can we add a comment so we don't lose track of that later (or add also a logic test of what the results should be)?",258683369,2015-05-16 01:11:56
7558684,7111,30442050,5,what about changing flowBoxes to `flowConfigUpdates` or something. It seems like it is not really to do with the serialization and could be used for any global flow config key/value updates.,258683369,2015-05-16 01:13:29
7558684,7111,30442090,17,can we change this to `applyFlowConfigProperties` or something?,258683369,2015-05-16 01:13:58
7558684,7111,30442161,5,should this be `private[scalding]`? Seems super low level to me.,258683369,2015-05-16 01:14:54
7649292,7111,30835793,21,"there are only 256 bytes, so taking 100 of them, the chance of collision seems pretty high. Seems like we should use the formula, pass the cardinality of T into checkCollisions, and then have it pick the k (100 in your example).",261044238,2015-05-22 00:04:05
7649292,7111,30836480,21,"actually, if we are hashing 256 things into 32 bits, it should probably not collide actually.

So, this test is fine (assuming it passes).",261044238,2015-05-22 00:11:29
7698550,7111,31265580,133,"these might not be serializable. You might want to use `@transient` here and `com.twitter.chill.Externalizer` which attempts both Java and Kryo serialization. Cascading needs schemes to be serializable, I think.",262640517,2015-05-28 23:51:40
7698550,7111,31265413,89,"Let's make one Injection and use that:

something like:
```scala
val injection: Injection[Any, String] = KryoInjection.andThen(Injection.connect[Array[Byte], GZippedBase64String, String])
```

",262640517,2015-05-28 23:49:51
7698550,7111,31265731,24,"this should be an implicit argument and users should do something like:

```scala
import Macros.caseClassParquetReadSupport
```
in any file they use the implicit. If they want to be explicit, that's fine, implicit parameters can be passed explicitly.",262640517,2015-05-28 23:53:28
7698550,7111,31265877,25,"this is not a great pattern which we have, but should avoid. A better one is:

```scala
def toMap[T](i: Iterable[T]): Map[T, Int] = i.groupBy(identity).mapValues(_.size) 

toMap(_) shouldBe toMap(values)
```
The toSet version hides cases were outpu",262640517,2015-05-28 23:55:08
7698550,7111,31266344,31,same comments as for readSupport.,262640517,2015-05-29 00:00:03
7698550,7111,31266409,37,readSupport should be an implicit arg.,262640517,2015-05-29 00:00:45
7698550,7111,31266327,23,"why is the schema here? Why not call the toParquetSchemaImpl macro? Seems it just requires extra work for the user.

Can this be implicit?",262640517,2015-05-28 23:59:51
7698550,7111,31266403,45,readSupport should be an implicit arg.,262640517,2015-05-29 00:00:42
7698550,7111,31266375,64,readSupport should be an implicit argument.,262640517,2015-05-29 00:00:26
7698550,7111,31266622,110,generally in scala it is better to make `def` abstract. making an abstract `val` can cause some issues (val init order bug).,262640517,2015-05-29 00:02:52
7698550,7111,31266359,97,writeSupport should be an implicit argument.,262640517,2015-05-29 00:00:17
7698550,7111,31266782,14,"When would we use something other than the string created by the macro to generate schemas from case classes?

If we think this is very rare, why not skip the schema here and just call your existing macro?",262640517,2015-05-29 00:04:33
7698550,7111,31266939,87,maybe this should be `scalding.parquet.read.support.instance` to be sure we don't collide with something from Parquet.,262640517,2015-05-29 00:06:02
7698550,7111,31267148,69,"Make this work with:

```scala
val input = TypedParquet[SampleClassC](inputPath)
```",262640517,2015-05-29 00:08:17
7698550,7111,31267102,60,"this should be:

```scala
TypedParquetSink[SampleClassB](outputPath)
```
if it is not that easy, it is too much code.",262640517,2015-05-29 00:07:53
7698550,6923512,31286157,110,fixed,262640517,2015-05-29 03:56:45
7698550,6923512,31286393,23,"Fixed. At the beginning, I thought if user wanted to create a source/sink for the same I/O path the the schema generation macro will be called twice...so I put it as a parameter so that source/sink could share the same schema instance. But you are right  ",262640517,2015-05-29 04:01:06
7698550,6923512,31286423,14,fixed,262640517,2015-05-29 04:01:31
7698550,6923512,31286452,87,"Agree, fixed.",262640517,2015-05-29 04:01:55
7698550,6923512,31286612,25,Fixed,262640517,2015-05-29 04:05:22
7698550,6923512,31286587,133,Not sure I understand this well. TypedParquetTupleScheme extends Scheme which implements java serializable and both ParquetReadSupport and WriteSupport have implemented serializable interface.,262640517,2015-05-29 04:04:56
7698550,6923512,31286486,89,"fixed, that's how injection should be used:P",262640517,2015-05-29 04:02:40
7698550,6923512,31286648,69,"Now it works, please check my latest commit.",262640517,2015-05-29 04:06:04
7698550,6923512,31287007,97,fixed,262640517,2015-05-29 04:12:42
7831827,7111,31659324,14,"what is `primitive` about this? Also, can we stop using the `OrderedBuffer` name which is the old name before `OrderedSerialization`. Why not `orderedSerialialization[T]`",266442028,2015-06-04 00:16:34
7831827,319889,33070731,14,Can we not get this from the package itself? not have a macros reference here,266956797,2015-06-23 22:55:05
7831827,7111,33087537,5,this looks like a merge fail. It is backing out the sketched fix.,273228036,2015-06-24 01:24:28
7831827,622449,33099720,5,unintentional? ,273281863,2015-06-24 03:20:38
7852621,319889,31781731,13,Were these changes from your GUI or the formatting script? ,266996754,2015-06-05 06:24:29
7852621,809255,31783334,13,"That's strange. I didn't notice the change. 

That seems to be changed when I ran 

./sbt test",266996754,2015-06-05 07:13:27
7852621,7111,31833807,13,probably from scalariform.,266996754,2015-06-05 22:34:42
7869084,7111,31856999,4,"I think we need to override `override def sinkFields = f` and `override setter[...]` with the subsetter of `TupleSetter.of[(Long, V)]`

And also below.

Might be good to run a quick job (even using local HDFS), to see if it works.",267424762,2015-06-06 03:27:08
7913954,7111,32043174,54,"let's move this to an object in scalding-serialization. We keep putting this code where we need it, which is needless duplication.",268620843,2015-06-09 22:58:14
7913954,2523602,32047924,54,@johnynek Cant move it to scalding-serialization as `OrderedSerializationProviderImpl` is in scalding-serialization-macros which depends on scalding-serialization. Cant move it to scalding-serialization-macros either as macro implementation and its usage ,268620843,2015-06-09 23:39:51
7913954,319889,32081588,5,scaldingSerialization was already here?,268620843,2015-06-10 06:22:04
7913954,319889,32081600,24,These look like formatting changes only? should revert ,268620843,2015-06-10 06:22:31
7913954,319889,32081607,35,revert formatting change,268620843,2015-06-10 06:22:41
7913954,319889,32081641,54,"You can put it in scalding-serialization-macros. You can't call it there, but you can define it there, we have it in most of our macro modules.",268620843,2015-06-10 06:23:39
7913954,2523602,32081726,54,"I am calling it in intKeyOrd method



    _____________________________
From: ianoc <notifications@github.com>
Sent: Tuesday, June 9, 2015 6:23 PM
Subject: Re: [scalding] Make SketchJoin ordered serialization aware (#1316)
To: twitter/scalding <scalding@",268620843,2015-06-10 06:26:18
7913954,319889,32081764,54,right... you can put this method in scalding-serialization-macros and call it from scalding-core fine though,268620843,2015-06-10 06:27:24
7916925,2221968,32062268,14,"Is this catching some ""multiple lines in a function application should be aligned"" thing?  If so, maybe declare val processedArgs = args... ahead of this, so the processing chain isn't inside the Args()",268654517,2015-06-10 01:50:31
7990697,7111,32456182,44,"don't we want one that does:

```scala
  check[SealedTraitTest]
```
the test below looks like it is just using the case class stuff you had before.",270809492,2015-06-16 00:21:14
7990697,319889,32456873,44,sorry cleanup typo. updated,270809492,2015-06-16 00:28:39
7990697,7111,32585825,26,"can you comment what is in the subData. I am trying to figure that out, but I'll probably forget by the time I look at it again.",271174496,2015-06-17 05:17:57
7990697,7111,32585939,54,how could this happen? Can you add a comment?,271174496,2015-06-17 05:19:48
7990697,7111,32586007,66,"this branch implies valueA == valueB, so in the code above we only check `valueA` against `idx`, right?",271174496,2015-06-17 05:20:55
7990697,7111,32586161,54,"I guess the way you are building this, it will be the most nested thing and it can only be reached if somehow none of the ids match, which should be impossible.

If that is right can you put a different message, something like: `unreachable code`.

Al",271174496,2015-06-17 05:23:28
7990697,7111,32586299,78,"instead of commonPut, what about a name like `elementHash` or something?",271174496,2015-06-17 05:26:20
7990697,7111,32586327,84,this is repeated for the same reason on line 100. Could we share that Tree?,271174496,2015-06-17 05:26:58
7990697,7111,32586522,171,"why to we always jump out to dynamic here? If you did:
```scala
sealed trait Or
case class Left(left: Int) extends Or
case class Right(right: Int) extends Or
```
You'd have a constant size of `5` bytes. Just not worth it to do that optimization yet ",271174496,2015-06-17 05:30:40
7990697,7111,32586549,230,should this be `thrift` here?,271174496,2015-06-17 05:31:08
7990697,7111,32586577,268,"like above, this is actually unreachable code, right?",271174496,2015-06-17 05:31:44
7990697,7111,32586721,43,"what about case objects, are they supported?",271174496,2015-06-17 05:34:20
7990697,7111,32586776,55,"looks like the tbuf here is always Some. Do we have cases where it can be None? If not, we are carrying some extra complexity around.",271174496,2015-06-17 05:35:40
7990697,7111,32586841,57,"the question mark makes this confusing. Can you restate? Are you saying that it makes no sense to have subData be empty, yet have a sealed trait? So is this indicative of a logic bug in that it should never happen unless you have an uninhabited type?

A",271174496,2015-06-17 05:36:58
7990697,7111,32586903,31,"can we deal with `case object?` For instance, I guess this macro generated code could subsume `Option` and `Either` serializers as they are just special cases of these, right?",271174496,2015-06-17 05:38:09
7990697,7111,32585890,36,space after map.,271174496,2015-06-17 05:18:59
7990697,319889,32648544,171,"Its been a while since i wrote this, but the thinking goes if i remember, if a given instance of a sealed trait itself has a constant len then we are still stuck at dynamic len since we are working on the trait level, and we may end up with another instan",271174496,2015-06-17 21:55:39
7990697,319889,32670755,54,"Yeah not sure, maybe it does? but i guess maybe it would be good to see that in benchmarks first? ",271174496,2015-06-18 01:26:46
7990697,319889,32670798,66,Yep exactly ,271174496,2015-06-18 01:27:13
7990697,7111,32769027,95,"`_root_.com.twitter.scalding.serialization.Hasher.int.hash($idx)` is a constant known at compile time. Can we evaluate that using something like:

```scala
val treeHash: c.Tree = c.resetLocalAttrs(q""_root_.com.twitter.scalding.serialization.Hasher.int.",272395464,2015-06-19 00:31:48
7990697,319889,32769264,95,"Evals are pretty much totally broken and unreliable.  -- we've tried to use them for a few things before, its never worked :/ ",272395464,2015-06-19 00:34:46
7990697,319889,32769352,95,"But your points valid, i'm not sure we need to eval or do anything special here. We can probably just call the method itself",272395464,2015-06-19 00:35:52
7990793,7111,32553407,12,"can't we just do:

```scala
val m = s.getKeySelectors.asScala ++ s.getSortingSelectors.asScala
```
since the check is exactly the same? then we don't have to duplicate the checking code.",270810083,2015-06-16 23:23:41
7990793,319889,32553903,12,"We can, actually I had a note here to ask you if you think this should be a separate option entirely? Given we never really expose the key sorting ability to users in a real manner just using our sorting should be fine for them. But secondary sort is wher",270810083,2015-06-16 23:27:48
7990793,7111,32554964,82,"we never use it with the default arg, can we not use the default arg at all to make it more clear?",270810083,2015-06-16 23:35:50
7990793,7111,32555423,12,"Yes, good point.

I don't think we should require it here since `.sortBy` will be broken in that case, right?
",270810083,2015-06-16 23:39:52
7990793,319889,32555611,12,"Happy to just drop it entirely, is it worth adding a new option for? I'm not sure it is, secondary sorting is rare enough we can have users manually specify it if in doubt? ",270810083,2015-06-16 23:41:34
7990793,7111,32778066,12,"yes, I agree. Let's drop this and have the user's take responsibility for this one.",270810083,2015-06-19 02:02:14
7990794,123326,32436302,24,Why do you increment `writtenRecords` both here and in the `write` method?,270810131,2015-06-15 21:02:51
7990794,319889,32439974,24,"its really a poorly named variable, will modify. -- Its counting points at which we would measure the length of our payload. So either by calling dynamic size as an accessor or via the write method. ",270810131,2015-06-15 21:38:55
7990794,7111,32448350,56,what case is this? I thought this was a sealed trait and we already had a complete match.,271117040,2015-06-15 23:02:08
7990794,319889,32448513,56,I should/will revert this. I was moving towards only allowing callDynamic being used here if the length of the code in it was less than some threshold. In practice that proved too hard to tune though. ,271117040,2015-06-15 23:03:56
7990794,7111,32551889,104,why not manually inline this be doing `${withLenCalc(argTree)` here? Can you add a comment about this choice?,271146349,2015-06-16 23:10:40
7990794,7111,32552302,38,"just realized the macros are not hygienic when it comes to Option/Some/None. Maybe put an:

`import _root_.Predef.{Option, Some, None}` on line 235?

testing for clean imports is such a pain with macros.",271146349,2015-06-16 23:14:16
7990794,319889,32552357,104,"Could do it either way, this hasn't really changed in this RB. I'm not really sure making this inline was a wonderful idea to begin with. just easier to inline than put it as its own private function right now. 

Context: In XProf for large objects seei",271146349,2015-06-16 23:14:41
7990794,7111,32552676,104,"Ahhh.. This was a worry we had before (we could be hampering the jit by making methods too large).

Got it. That's probably a TODO for us: look at logs to see if we are hurting the JIT.",271146349,2015-06-16 23:17:25
8047338,814892,32701285,19,I think you meant `fs.globStatus` here?,272271250,2015-06-18 11:07:50
8052588,814892,32749788,7,"Should this be a new type like `TransformedOrderedSerialization`? Might be useful for optimizing serialization chains, or maybe this is not applicable.",272385519,2015-06-18 21:31:58
8052588,319889,32749998,7,I'm not sure how we could use that feature right now? we could always add that in later though if we find a use,272385519,2015-06-18 21:34:05
8052588,7111,32753495,4,"what about a variant that takes `U => Try[T]` for the deserialization side? For instance, cases where you serialize to strings (Json for instance), but clearly that can sometimes fail if we are reading random strings.",272385519,2015-06-18 22:12:01
8052588,319889,32753593,4,"Sure, can do",272385519,2015-06-18 22:13:14
8052588,7111,32753341,22,"when taking an implicit Bijection, we need to use the `ImplicitBijection` type because it handles the fact that `Bijection[U, T]` would also work here.",272385519,2015-06-18 22:10:18
8052588,319889,32753930,4,"Think it probably makes sense to just make this the base/normal variant. We only hit the Try when we are doing deserialization, wherein we have a try anyway. Not sure there is likely much overhead to another allocation for this path?",272385519,2015-06-18 22:16:59
8052588,319889,32754482,4,"Actually avoiding allocations and nerding in these paths makes sense, i'll just add it and the Injection one in scalding core",272385519,2015-06-18 22:22:37
8052588,7111,32754270,9,"I wonder if we should implement a simple cache since we might call write, hash, and dynamicSize in quick succession.

Something like:
```scala
private[this] var cache: (T, U) = null
private def packCache(t: T): U = {
  val readCache = cache
  if (n",272385519,2015-06-18 22:20:21
8052588,319889,32754609,9,Thats not thread safe right? And we can't use the equiv from the other serialization since we'll need to compare the pre-transformed version ?,272385519,2015-06-18 22:23:57
8052588,2523602,32759106,21,"Looks good! 

Thinking out loud about usage in a scalding job, user will at the very least need to know that she has a type that does not have OrdSer and there is a Bijection from that Type to another Type for which OrdSer does exist and will have to im",272389752,2015-06-18 23:01:17
8052588,319889,32759415,21,"Its only ever going to be best effort in the default case I think, if you have a complex JVM type this isn't a good solution either. Though there is a reasonable notion that for new jobs we should force them to re-write in compatible types for the perform",272389752,2015-06-18 23:04:07
8052588,7111,32767377,9,"I think it is safe: we do one read (which may be old). Then that one read has linked two values: `(T, U)`. If the `T` matches, you're safe to use the `U` no matter what.

If you are out of date, the worst case is you recompute needlessly, right?

You'",272385519,2015-06-19 00:14:12
8052588,7111,32773397,25,looks like you did not import Injection. Maybe even more coffee? :),272385514,2015-06-19 01:18:24
8052588,319889,32773632,25,In my meager defense i got sidetracked and didn't drink the extra coffee yet ;),272385514,2015-06-19 01:20:38
8145117,319889,33218402,32,prefer private[this] over private unless you need to share with a class,273830215,2015-06-25 08:00:54
8145117,319889,33597355,55,kill commented code,277801372,2015-06-30 22:08:49
8145117,7111,33606585,55,"I had to look up how to get a println here, since scalatest hides them. Do you really want to drop this or can we leave it for when someone wants to inspect the actual output of the descriptions?",277801372,2015-06-30 23:27:35
8145117,319889,33606897,55,"Nah, if you have a reason to have it here that'll help future debugging i'm cool with keeping. ",277801372,2015-06-30 23:30:17
8173691,2523602,33383112,16,I thought this is how you skip tests in sbt but `./sbt clean test` under root still ran the tests for this module. What am i missing? ,275245068,2015-06-26 23:36:47
8177194,7111,33401709,23,"can we change the name of this to say, `orderedSerialization`? Scala has this issue (bug?) where if you have two implicits in scope of the same name you get issues:
```
scala> object Test { implicit val name: String = ""object"" }
defined module Test

",275461453,2015-06-27 03:29:12
8177637,7111,33406179,7,is there any way we could not check in generated code?,275528048,2015-06-27 05:09:01
8177637,2523602,33406385,7,@ianoc Do you still have the original thrift file? We will have to generate these on the fly if we dont want to check them in.,275528048,2015-06-27 05:16:22
8177637,7111,33406934,7,"I'd rather just use the scrooge plugin and generate these, personally (also it is a better test, because scrooge will evolve).",275528048,2015-06-27 05:38:11
8177637,7111,34193042,10,"Can you add a comment to make it clear that this is here for people that use scrooge, but otherwise is identical to the one in scalding-core. ",279511487,2015-07-09 01:16:11
8184341,7111,33494459,18,could this be moved to BaseScaldingShell so there is only one place to configure if it makes sense?,276603653,2015-06-29 23:17:55
8184341,7111,33494479,5,could this be in BaseScaldingShell? Seems to make sense there too.,276603653,2015-06-29 23:18:08
8184341,7111,33495095,15,"seems strange to have this called BaseReplImplicits. The implicit part is about the imports. What is the core function here? If we are refactoring, I'd like to improve it, seems we make be making it worse here.",276603653,2015-06-29 23:24:06
8184341,7111,33608628,52,I really don't think we need this. I think it was just cargo culted from Dsl by the (wibidata folks that started the REPL).,277481108,2015-06-30 23:45:09
8184341,7111,33608949,36,seems we are changing the way this works. What's the story?,277481108,2015-06-30 23:47:53
8208947,1443419,33494921,28,We probably need to allow non-strict mode with HdfsLocal as well.,277327809,2015-06-29 23:22:30
8235942,7111,33638897,15,"we generally use `TraversableOnce[V]` here, can we stick to that style?",277959988,2015-07-01 05:22:56
8235942,7111,33639902,14,"I think we want `TypedPipe[(K, U)]` to be the return type. In other words, you have another copy of mapValues here, which you can use if you don't want the flattening, but I think this one should behave exactly as it does on KeyedListLike.",277964747,2015-07-01 05:45:26
8235942,1146482,33640075,14,But if I use `fn(v1).map { v2 => k -> v2 }` This returns a Traversable[U] (or Traversable[V2] from example above),277964747,2015-07-01 05:50:15
8235942,7111,33641301,14,look at my code. It had a flatMap yours does not have.,277964747,2015-07-01 06:23:11
8235942,1146482,33642143,14,":dizzy_face: Of course, fixed",277964747,2015-07-01 06:48:06
8256134,7111,33742627,5,why did you leave the space after `)`? Can you fix that too?,278444829,2015-07-02 07:13:03
8304437,814892,36450309,23,"This needs to check for `TestMode` along with the flag here, right? and always add `StatsFlowListener` in other modes.",279012170,2015-08-06 23:44:30
8304437,7111,36450805,11,can we instead return `Try[Unit]` here so we can allow the user a chance to give an exception message?,279012170,2015-08-06 23:48:38
8304437,7111,36451044,49,"if we used `f: Map[StatKey, Long] => Try[Unit]` we could just do: `f(values).get` here.",279012170,2015-08-06 23:50:29
8304437,263956,36457387,23,Good catch. Forgot to port this from our internal fork.,279012170,2015-08-07 00:49:53
8304437,263956,36457821,11,"I was trying to keep this interface simple. The user can include message with `assert(_, msg)` or throw exception directly. Does that make sense?",279012170,2015-08-07 00:54:18
8304437,7111,36465481,11,"We really try now to keep the type signature guiding how it is used. We don't want users throwing exceptions to the framework because these compose very poorly.

I think:
```
def verifyCounters(m: Map[StatKey, Long]) = Try {
  assert(isGood(m), s""Sta",279012170,2015-08-07 02:04:53
8304437,263956,36468837,11,You're right. This does look better :),279012170,2015-08-07 02:34:21
8312587,3485758,36538818,149,"This is too much debugging. Will get rid of ""$history"".",279102224,2015-08-07 22:06:09
8312587,3485758,36538890,2,I will revert this,279102224,2015-08-07 22:06:56
8312587,3485758,36538998,37,"Will make this less verbose by changing it to ""IgnoreInputSize""",279102224,2015-08-07 22:08:05
8312587,814892,36543652,70,Should the `toDouble` conversion be moved to `getReduceTimes`?,279107405,2015-08-07 22:55:49
8312587,814892,36543211,6,Any reason for removing these? Might be useful for outside code to fetch the defaults.,279107405,2015-08-07 22:51:56
8312587,814892,36545180,28,So looks like this was a bug affecting the existing HRavenRatioBasedEstimator as well?,279107405,2015-08-07 23:11:02
8312587,814892,36545555,6,Ah scratch that. This looks fine actually.,279107405,2015-08-07 23:14:58
8312587,814892,36545763,14,nit - excludes to be in separate lines,279107405,2015-08-07 23:16:56
8312587,814892,36546562,36,recoverWith here should still apply to the outer Try right?,279107405,2015-08-07 23:24:05
8312587,319889,36546671,36,"Also always use .'s between methods. (I see the old didn't have it, but it should have had)",279107405,2015-08-07 23:25:07
8312587,814892,36549120,25,Should we just throw here? I feel it's better for users to be precise if they are providing the scheme than us silently picking median.,279107405,2015-08-07 23:48:29
8312587,3485758,36550217,36,"Sure, I'll add the dot.
recoverWith still applies to the outer Try, I just indented incorrectly so it looks like it changed. I'll fix the indentation.",279107405,2015-08-07 23:59:21
8312587,3485758,36549910,28,I don't think the ratio-based estimator uses task-level data,279107405,2015-08-07 23:56:24
8312587,3485758,36552770,70,"Sure, might as well since it's common to both places where getReduceTimes is used",279107405,2015-08-08 00:27:13
8312587,3485758,36554635,6,"This will be useful for writing unit tests, so I think I'll move it out of the method.",279107405,2015-08-08 00:51:02
8312587,3485758,36552551,25,"Sure, that makes sense",279107405,2015-08-08 00:24:23
8312587,814892,36660695,22,"Probably good to also add test cases for 'empty history' and 'failed to fetch history', given we not share anything with RatioBasedEstimator so don't have coverage for that here.",293161033,2015-08-10 22:42:42
8312587,814892,36660808,103,Just wondering if logging the whole sequence might be too verbose? The other values below are `Option`s so should be fine.,293161033,2015-08-10 22:43:35
8312587,3485758,36662983,103,"Sure, I can remove this",293161033,2015-08-10 23:01:33
8312587,3485758,36663292,22,Fixed in latest commit,293161033,2015-08-10 23:04:21
8312587,814892,36771360,20,I think most of these excludes would not have been needed if there was a separate `hraven-client` module. There is none sadly.,293284015,2015-08-11 22:16:36
8319072,3485758,34071203,65,"scaldingMacros used to depend on scaldingHadoopTest for some reason.
I didn't copy this dependency over to scaldingCore because that would create a circular dependency (scaldingHadoopTest depends on scaldingCore). This didn't cause any problems. So maybe",279267456,2015-07-07 23:11:02
8319072,319889,34071510,65,"See if the tests all work here? We might need to move a few tests from the macros if it has platform tests over to the scaldingHadoopTest test suite.
",279267456,2015-07-07 23:13:33
8325426,7111,37130747,15,"we should use proper logging here (same as cascading, not sure which framework they use).",279351261,2015-08-15 05:48:16
8325426,319889,37147570,16,Can we put a better type on this? Is there no interface/root class for flow listeners? ,279351261,2015-08-16 21:38:44
8335058,7111,34086218,4,"nope. We don't want to make this a dependency of scalding-core. It is a dependency of scalding-commons. This means you should move the LZO related text stuff into scalding-commons, but the other stuff can stay here.",279444633,2015-07-08 01:28:40
8335058,7111,34086272,26,let's move these to LzoTypedText in scalding-commons. All the non-lzo can stay.,279444633,2015-07-08 01:29:07
8335058,7111,34086408,17,"does this work with a tuple `(Int, Int)` or a raw type like `String`? We need that if we are going to replace `TypedTsv`.",279444633,2015-07-08 01:30:18
8335058,3485758,34094369,17,"Would it be sufficient to add more tests exactly like these two, but with tuples and strings instead?

I wanted to write a test that creates a pipe from a TSV file, converts the pipe to a list, and compares the list to the expected value.
However, it l",279444633,2015-07-08 02:39:40
8335058,319889,34095926,17,"It would be good to just write out with those types (Int, Int), and String. Manually verify to yourself once. But then in the test you can read them back into matching case classes to see things round trip as you expect. Or for String cases use the TextLi",279444633,2015-07-08 02:56:06
8335058,7111,34193945,12,"I'm a bit nervous about this. a lot of people do `import com.twitter.scalding._`. If they also import an implicit for TypedDescriptor (as our internal code has been doing) they will now have a compile error (scala won't find either implicit, I'm pretty su",279510959,2015-07-09 01:24:49
8335058,7111,34194500,15,let's add a return type to all public methods.,279510959,2015-07-09 01:29:32
8335058,7111,34194739,12,"I guess if we don't do this we can't replace TypedTsv, right?

What if we put this method in the `object TypedDescriptor`? I think then it would be found by default if not explicitly overridden by another import.",279510959,2015-07-09 01:31:44
8335058,7111,34194836,5,"do we need to make this change? Ideally, we don't need to make any change because we don't want to break a ton of code.",279510959,2015-07-09 01:32:44
8335058,319889,34195822,12,"Yes this is there for the TypedTsv, it was in the package for typedtext. The companion object might/should work I think...",279510959,2015-07-09 01:41:14
8335058,319889,34195885,5,This change is made just because this code is in scalding core so it can't use the macros,279510959,2015-07-09 01:41:47
8335058,7111,34196151,148,"we could support `Char`, which `t.getChar` should work. For whatever reason, `Byte` is not supported by cascading.",279510959,2015-07-09 01:44:18
8335058,7111,34196433,5,let's write this as: `T: Manifest: TypeDescriptor` likewise below.,279510959,2015-07-09 01:47:01
8335058,7111,34196709,5,"add, this is not in the tests itself. Same package. Got it.",279510959,2015-07-09 01:49:33
8335058,3485758,34198355,15,Fixed in latest commit.,279510959,2015-07-09 02:04:44
8335058,3485758,34198370,5,Fixed in latest commit,279510959,2015-07-09 02:04:55
8335058,3485758,34206709,12,I moved the macro to the companion object in d4a99e5. This actually fixes a test compilation error.,279510959,2015-07-09 03:34:47
8335058,7111,34271469,4,still needed?,279510961,2015-07-09 21:03:27
8335058,7111,34271833,12,"Can we instead just override the methods in TypedSeparatedFile for maximum source code compatibility?

I think we could pretty easily implement the 4 apply methods there, then we are fairly sure this change won't break anyone, which is nice.",279510961,2015-07-09 21:06:59
8335058,7111,34272074,13,"let's not make this change. This will appear in a code in science and elsewhere, and if it is easy for us to just support it, we should.",279510961,2015-07-09 21:09:48
8335058,7111,34272478,1,maybe this should not be in an extra level of package. Just com.twitter.scalding.source seems to be more consistent with what is already there.,279510961,2015-07-09 21:13:51
8335058,7111,34275332,5,do we need the Manifest still? I don't think so.,279510961,2015-07-09 21:41:01
8335058,7111,34275341,14,don't think Manifest is needed.,279510961,2015-07-09 21:41:09
8335058,7111,34275786,13,"Can we add a pretty beefy comment here. Something like

```scala
/**
 * This type descriptor flattens tuples and case classes left to right, depth first. It supports supports any type T where T is Boolean, String, Short, Int, Long, Float or Double, or",279510961,2015-07-09 21:45:17
8335058,3485758,34286364,4,Nope. I'll remove it,279510961,2015-07-09 23:21:58
8335058,3485758,34287831,12,"Would we just call `new FixedTypedText[T](seperator, paths)`, discarding the Fields parameters?",279510961,2015-07-09 23:35:14
8335058,3485758,34288611,1,"Sure, I'll do this. I'll also move LzoTypedText from com.twitter.scalding.commons.source.lzotypedtext to com.twitter.scalding.commons.source",279510961,2015-07-09 23:41:40
8335058,3485758,34289312,5,I'll remove it,279510961,2015-07-09 23:47:38
8335058,3485758,34289317,14,I'll remove it,279510961,2015-07-09 23:47:42
8335058,3485758,34290445,13,Sure,279510961,2015-07-09 23:58:14
8335058,7111,34291294,12,"we could take the fields passed in, require that they have the same size as the fields from the TypedDescriptor, then make a new TypeDescriptor that takes just the names from the input fields (but copies the types out).",279510961,2015-07-10 00:06:18
8335058,3485758,34321088,12,"So I'm thinking we could add a new macro (not implicit) in TypeDescriptorProviderImpl which is like caseClassTypeDescriptorCommonImpl, but which takes fields as a parameter and uses that value of fields, instead of using the helper macro.

We would then",279510961,2015-07-10 06:13:24
8335058,319889,34322873,12,"You won't have the type information there. You probably want to take the
implicit as is but maybe copy it with fields changed.

On Thursday, July 9, 2015, Sidharth Kapur <notifications@github.com> wrote:

> In scalding-core/src/main/scala/com/twitter/scal",279510961,2015-07-10 07:01:42
8335058,7111,34351394,12,"I agree with Ian here. We try to only use macros when we really have to. We should be able to solve this problem without a macro, since we already have a macro for the more general case (which we need to get the `Class[T]` for each column of the flattened",279510961,2015-07-10 17:48:18
8335058,3485758,34380731,21,"top lel, every instance of `TypedSeperatedFile` in our code base misspells the word ""separated""!",279510961,2015-07-10 23:13:38
8335058,7111,34383385,21,":) too bad we don't have smart spell check for code.

Let's leave it as is for compatibility.

On Friday, July 10, 2015, Sidharth Kapur <notifications@github.com> wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/TypedDelimited.scala
> <https",279510961,2015-07-10 23:38:59
8335058,3485758,34383909,5,"In the process of adding Fields support to the apply methods in TypedSeperatedFile, I made both `TypedSeperatedFile.apply` and `FixedPathTypedDelimited.apply` depend on the macro and use `FixedTypedText` instead of `new FixedPathTypedDelimited`. I wanted ",279510959,2015-07-10 23:44:16
8335058,7111,34579743,37,"see: https://github.com/Cascading/cascading/blob/3.0/cascading-core/src/main/java/cascading/tuple/Fields.java

I think we want:

```scala
val newFields = new Fields(f.get, td.fields.getTypes)
```
we don't want to lose the types, just keep the names",279510963,2015-07-14 20:17:50
8335058,7111,34580030,65,"wait, we should not duplicate this code with the above. Can't the code above just be:
```scala
apply[T: TypedDescriptor](path: Seq[String], f: Fields): TypedTextDelimited[T] = apply[T](path, f, separator)
```",279510963,2015-07-14 20:20:18
8335058,7111,34581053,5,"Actually, I think the easiest fix is to define a simple mock `TypeDescriptor` since this code actually is not using any features of the macro. Then we shouldn't hit the macro path:
```scala
implicit val td: TypeDescriptor[Tuple1[OutputType]] = new TypeD",279510959,2015-07-14 20:28:36
8335058,7111,34581198,17,not sure these should be private.,279510963,2015-07-14 20:29:40
8335058,7111,34581336,5,let's revert this change to test the version that has Fields as the second parameter.,279510963,2015-07-14 20:30:45
8335058,7111,34581406,37,incorrect string. Should be `Test with an Int`.,279510963,2015-07-14 20:31:17
8335058,3485758,34595469,65,"This would require having `TypedSeperatedDelimited.apply` call the `FixedPathTypedDelimited.apply` method.

Since we're planning to deprecate FixedPathTypedDelimited and TypedDelimited, this means we'll get deprecation warnings. Is that okay?",279510963,2015-07-14 22:33:51
8335058,3485758,34595662,17,"Sure, I'll remove the private",279510963,2015-07-14 22:35:44
8335058,7111,34631469,33,"this is copy-paste, right? the string here is always ""element"" right? And there is never a list of trees, just a `Option[Tree]` would have been enough, right?

Since we can make `Fields` with `Comparable` which should really be `Either[Int, String]` but",279510966,2015-07-15 04:17:07
8335058,7111,34631635,121,"note this is cast to `Comparable` below, so actually using `Comparable[_]` instead of `String` would have worked, I think.",279510966,2015-07-15 04:20:24
8335058,3485758,34631657,33,@ianoc ,279510966,2015-07-15 04:20:46
8335058,7111,34631685,121,need a `_root_.java.lang.Comparable` below. Note the missing `_root_`.,279510966,2015-07-15 04:21:06
8335058,7111,34631817,55,"I think we should have `maybeHandlePrimitive` return `Option[Tree]` then here we can do:

```scala
val expanded: List[(Tree, Comparable[_])]  = maybeHandlePrimitive(T.tpe)
  .map { tree =>
    List((tree, Integer.valueOf(0)))
  }
  .getOrElse { ...",279510966,2015-07-15 04:23:41
8335058,3485758,34633126,55,"Why 0 instead of ""element""?",279510966,2015-07-15 04:45:56
8335058,7111,34633559,55,"see the link to the old TypedTsv code. It used numbers not names and I
think cascading treats numbers differently.

So, if we use 0, we are doing the same thing we were doing before, so
hopefully the tests would pass.

Also, we may need to do the same thi",279510966,2015-07-15 04:53:38
8335058,7111,34778269,80,"should be TypedTextDelimited I think. Also, can we add a date in the since portion (so people can be reminded how long it has been deprecated).",279510970,2015-07-16 16:33:45
8335058,7111,34778288,88,TypedTextDelimited,279510970,2015-07-16 16:34:00
8335058,7111,34778412,132,"I don't think I see the benefit in adding with MacroGenerated on the Fields instance, since this will cause us to create a new class for each macro, whereas we could have just created an instance. I think we should remove this.",279510970,2015-07-16 16:36:31
8335058,7111,34778423,139,I think we should move MacroGenerated on Fields.,279510970,2015-07-16 16:36:48
8335058,3485758,34813124,88,"I believe this one should be FixedTypedText? 
since 
FixedTypedText extends FixedPathSource with TypedTextDelimited
and 
FixedPathTypedDelimited extends FixedPathSource with TypedDelimited",279510970,2015-07-16 22:19:21
8335058,7111,34816908,88,"Sounds good.

On Thursday, July 16, 2015, Sidharth Kapur <notifications@github.com> wrote:

> In scalding-core/src/main/scala/com/twitter/scalding/TypedDelimited.scala
> <https://github.com/twitter/scalding/pull/1356#discussion_r34813124>:
>
> > @@ -124,6",279510970,2015-07-16 22:52:50
8343018,814892,34177879,44,`.flatMap` prefer dots for non-symbolic methods,279501382,2015-07-08 22:57:31
8343018,814892,34177944,47,`case Nil` ?,279501382,2015-07-08 22:57:59
8343018,814892,34178171,75,can this be `protected`? Looks like it.,279501382,2015-07-08 22:59:35
8343018,3485758,34179231,30,"This class hierarchy is too deep.

One solution is to rename this trait to something like `Averager` and making it not extend `HistoryReducerEstimator`. Then `OrdinaryRuntimeReducerEstimator`and `InputScaledRuntimeReducerEstimator` could mixin (or take ",279501382,2015-07-08 23:08:00
8343018,814892,34182899,30,"Yes, keeping the estimation logic out of the hierarchy makes sense to me. How about something like the following?
```scala
trait RuntimeEstimationScheme {
  def estimateTaskTime(times: Seq[Long]): Option[Long]
  def estimateJobTime(times: Seq[Long]): ",279501382,2015-07-08 23:38:46
8343018,7111,34191551,98,do we want sealed or final here? sealed means all subclasses are in this file.,279501382,2015-07-09 01:00:33
8343018,3485758,34191945,47,"Yep, that would look better",279501382,2015-07-09 01:04:32
8343018,7111,34192427,30,+1 to Ruban's suggestion here.,279501382,2015-07-09 01:09:51
8343018,3485758,34192524,98,"Whoops, I didn't realize that Scala has a final keyword!
I think final would be more appropriate.",279501382,2015-07-09 01:10:52
8343018,3485758,34194676,61,"We could easily refactor this to use composition instead of inheritance.
Should `HistoryReducerEstimator` be a class that takes `HistoryService` as a parameter?",279501382,2015-07-09 01:31:07
8343018,7111,34196996,61,it could still be a trait with a `def history: HistoryService` then in subclasses you `override def history = ...`,279501382,2015-07-09 01:52:12
8343018,7111,34200558,11,"runtime per reducer sounds strange. This means if you have `n` reducers you expect `n * time` to finish?

I think a good approach is to set a goal time for how long the reducers run, say 10 minutes. Then we look at the history and get a sequence of pair",279501382,2015-07-09 02:24:58
8343018,3485758,34203921,11,"Yep, runtime per reducer isn't a great name. ""How long the reducers run"" is along the lines of what I meant.

The history gives us a sequence of pairs (reducers, list of times for each reducer). `estimateTaskTime` takes each (reducers, list of times for",279501382,2015-07-09 03:00:31
8396461,3485758,34814225,15,"I believe this one should be FixedTypedText
since 
FixedTypedText extends FixedPathSource with TypedTextDelimited
and 
FixedPathTypedDelimited extends FixedPathSource with TypedDelimited",279845834,2015-07-16 22:30:07
8408424,7111,34941855,40,I think we should still deprecate.,279845814,2015-07-18 05:46:10
8551191,814892,35146055,24,Did you mean `==` here. Or is this a legit operator in scala?,283291196,2015-07-22 00:51:55
8551191,7111,35146588,24,That's a scalatest implicit overload type-safe equals.,283291196,2015-07-22 00:56:45
8560610,622449,35277049,38,If anyone has a better suggestion to differentiate `withColumns` (deprecated) from `withColumnProjections` (new api) let me know. Could be something shorter like `withColumns2` :( ,283457548,2015-07-23 04:31:49
8572879,319889,35456613,81,maybe mention the option here that controls this behavior?,283743859,2015-07-25 00:14:57
8572879,319889,35456889,1,apache header,283743859,2015-07-25 00:18:37
8572879,319889,35456721,20,"comment looks wrong, nothing to do with Lzo here right? ",283743859,2015-07-25 00:16:23
8572879,319889,35456780,1,should have apache header,283743859,2015-07-25 00:17:24
8572879,319889,35457005,1,apache header,283743859,2015-07-25 00:19:57
8572879,319889,35456984,27,comment looks wrong?,283743859,2015-07-25 00:19:42
8572879,319889,35457016,9,comment,283743859,2015-07-25 00:20:03
8572879,319889,35456692,157,maybe add an issue instead of the todo? ,283743859,2015-07-25 00:16:01
8572879,319889,35456772,17,could do with a java doc,283743859,2015-07-25 00:17:13
8572879,319889,35456761,11,comment is bad here too,283743859,2015-07-25 00:17:01
8572879,7111,35592676,58,what happens if you have two Persons? How are the fields assigned? Can you manually rename with annotations?,283942901,2015-07-28 03:00:48
8572879,7111,35593082,53,isn't this class duplicative with one in scalding-jdbc?,283942901,2015-07-28 03:04:54
8572879,814892,35593346,53,"Yes. Should we add a dependency on scalding-jdbc instead, or for long term move everything into one module? https://github.com/twitter/scalding/issues/1385",283942901,2015-07-28 03:07:15
8572879,7111,35593400,32,can you add a comment why we need the Manifest? It looks like we are converting to JSON. Why is that? Why not take an Injection in writeToHdfs and then set that injection up here or let the user supply?,283942901,2015-07-28 03:07:48
8572879,7111,35593604,33,can we get some comments here. What is json2CaseClass doing? The role of JSON is unclear to me.,283942901,2015-07-28 03:10:12
8572879,7111,35593963,33,I don't think you need the type parameter. I think you can just return `Try[T]` which since it is covariant will already be a `Try[U]` if needed.,283942901,2015-07-28 03:14:02
8572879,7111,35594297,67,"would be awesome if we didn't need Manifest here (especially given that we have the DBTypeDescriptor). Manifest is deprecated and is going to cause us pain sooner or later.

Also, do we really need the `T <: AnyRef`? Ideally just the TypeDescriptor woul",283942901,2015-07-28 03:18:01
8572879,7111,35610253,53,I'd say move to one module.,283942901,2015-07-28 07:47:31
8586239,7111,35591990,6,"when we move to 2.11 + 2.12, this will probably need to be updated. but as will many other things.",283942471,2015-07-28 02:53:23
8599633,319889,35780428,7,"This i believe is the default, can remove this line",284170247,2015-07-29 21:31:21
8599633,814892,35783975,29,We don't reverse the list anymore. Is that no longer needed?,284170247,2015-07-29 22:02:36
8599633,3485758,35784402,29,Hmm. I guess reversing the list guarantees that local settings override higher-up settings? So maybe we should add back the reverse.,284170247,2015-07-29 22:06:27
8599633,319889,35784632,29,Yeah i think the reverse is intentional,284170247,2015-07-29 22:08:22
8599633,3485758,35784906,12,"To instantiate the settings, I had to provide an `errorFn :: String -> Unit`.
Does this seem like a suitable error function? I could not copy the error function from the default settings because, by default, ILoop's `settings` is null.",284170247,2015-07-29 22:10:45
8599633,3485758,35787161,29,Fixed,284170247,2015-07-29 22:30:33
8599633,319889,35787766,12,"I think thats ok, echo should inform the user of any error, so that seems ok.


Can we access the parent settings without overriding them like this? ",284170247,2015-07-29 22:35:31
8599633,3485758,35787939,12,The parent settings is null,284170247,2015-07-29 22:36:52
8600297,319889,35788949,110,That bug was fixed for 2.10.0 by the link ? ,284179715,2015-07-29 22:45:17
8600297,319889,35789162,57,What you can do is look for an implicit in a method with a default -- see the tests in bijection macros. You can assert that the implicit is the dummy implicit such that the implicit wouldn't work.,284179715,2015-07-29 22:47:12
8609962,622449,35932083,4,"does fetchHistory return a List or a Seq? I'm wondering if Success(Nil) will still match say, Success(Vector()) if the underlying Seq type ever changes? ",284325651,2015-07-31 04:10:56
8609962,3485758,35932497,4,"It returns a Try[Seq[FlowStepHistory]].
Scala Seqs match by contents, so List() == Seq(), but yeah I guess it's possible for that to change.",284325651,2015-07-31 04:16:58
8714722,622449,36027011,2,"Yeah, but we *do* probably need to leave the license headers as-is from files that we are copying from apache projects",292507339,2015-08-01 05:04:42
8714722,123326,36012204,2,Shouldn't we update these copyright notices to 2015?,292507339,2015-08-01 01:18:42
8714722,319889,36012445,2,Half the scalding repo has 2012. How about I do a follow up PR after this and update all of them?,292507339,2015-08-01 01:21:06
8714722,123326,36012532,2,Sounds good,292507339,2015-08-01 01:22:11
8714722,7111,36014811,2,"actually, I don't think we need to keep adding copyright notices. Seems like make work, and the repo LICENSE should be enough (I think @travisbrown signed off on this statement).",292507339,2015-08-01 01:47:40
8714722,319889,36020123,2,"Oh, ok cool.",292507339,2015-08-01 02:53:37
8723931,814892,36111944,36,"So we don't want to set the converter here when it's already been set earlier. I'm guessing this is because we want it to be configurable via the new method, before this scheme code is executed?",292629312,2015-08-03 23:00:40
8723931,319889,36113084,36,"Exactly, if something else has gotten there first and wanted to set how the deserialization between the two fixed types is done we don't want to override. I'd view this as the default path per say. 

Use case so far is that I can swap out different thri",292629312,2015-08-03 23:11:15
8723931,7111,36116690,12,we should move this to `ExternalizerSerialization.testRoundTrip(i: Any): Try[Unit]`,292629312,2015-08-03 23:43:55
8725972,7111,36137379,23,can we use this for `.shard` now?,292666341,2015-08-04 03:06:51
8731684,123326,36222951,18,Maybe use a `Try`/`Maybe` instead of throwing an error.  How likely is it that there will be a mode other than those three?,278818209,2015-08-04 23:20:29
8731684,319889,36223126,18,"Extremely unlikely, the other methods in this class seem to just cast under the wildcard case",278818209,2015-08-04 23:21:45
8731684,7111,36255208,4,we should have return types on public methods.,278818209,2015-08-05 04:33:25
8731684,7111,36255159,18,"Yeah, there is little type safety around Mode, and no way to recover from a bad mode, so I'd leave it as is (Mode is generally configured at runtime).

",278818209,2015-08-05 04:32:59
8765705,7111,36772249,10,"don't think we need the `T` here, actually. Your design makes that clearer. Nice.",293284371,2015-08-11 22:24:29
8765705,7111,36772592,75,what if we add the old method back here rather than change in TypedPipe?,293284371,2015-08-11 22:27:02
8765705,319889,36772831,75,Sure,293284371,2015-08-11 22:28:53
8765705,7111,36807554,51,"can we factor this into:
```scala
def path(c: Config): String = 
  ...
```
at line 492, and call it in both read/write?",293284328,2015-08-12 03:31:14
8765705,7111,36807333,149,"should we also add `this` to the cache? The only reason I can see is to make sure we call `fn` fewer times (we can still call it twice in the case of `.map` on an execution, but supposedly `.map` is for pure functions, so that should be okay.",293284328,2015-08-12 03:28:39
8767404,7111,36799079,16,do we need the `implicit ec`?,293312881,2015-08-12 02:07:58
8767404,7111,36799324,96,`if(weDo.nonEmpty) {`,293312881,2015-08-12 02:09:48
8767404,7111,36799525,96,"actually what about:
```
weDoOperation match {
  case all@(h :: tail) =>
    // no need to call head and tail

  case Nil => Future.successful(...)
}
```",293312881,2015-08-12 02:11:14
8767404,7111,36799951,106,"we should use the `failFastZip` and probably our own `sequence` that does the same:

```scala
def failFastSequence(t: Iterable[Future[T]]): Future[List[T]] = {
  t.foldLeft(Future.successful(Nil: List[T])) { (f, i) =>
      failFastZip(f, i).map { ca",293312881,2015-08-12 02:14:51
8767404,7111,36800750,94,"sorry for the geekout, but can we get the types right here:
````val (weDoOperation, someoneElseDoesOperation): List[(ToWrite, Promise[...]), (ToWrite, Future[..])])``` without a cast?

I think something like:
```scala
def go[A, B, C](it: List[(A, Eit",293312881,2015-08-12 02:21:56
8767404,319889,36801059,94,"Which cast are you seeing? or you mean without doing the unwraps lower down for right and left?
",293312881,2015-08-12 02:24:22
8767404,319889,36801224,94,"Updated with the go function, I think thats what you want it used for?",293312881,2015-08-12 02:26:03
8767404,7111,36801623,133,you could `override def map` and get better composition I think.,293315990,2015-08-12 02:29:37
8767404,7111,36801251,94,just the `.left.get`,293312881,2015-08-12 02:26:18
8767404,7111,36802306,23,"do we want to make our two subclasses of ToWrite case classes since they are used as hashkeys now?

```
case class SimpleWrite[T](pipe: TypedPipe[T], sink: TypedSink[T]) extends ToWrite {
 ...
}

case class PreparedWrite[T](fn: (Config, Mode) => Si",293315990,2015-08-12 02:35:59
8767404,7111,36802454,133,"`a.map(fn).zip(b)` would not get this optimization now, but if you inline map it would.",293315990,2015-08-12 02:37:25
8767404,319889,36802015,133,Does it avoid anything to inline Map instead of having the MappedExecution? if its in the presentation function we won't cache it anyway. (Indeed if the map function is expensive we would want to cache it as we do MappedExecutions right?),293315990,2015-08-12 02:33:01
8767404,7111,36802629,133,"right, there is a trade-off of how expensive the map function is. Right now, since you could execute prefixes twice. No big deal either way if you ask me. Maybe keep it simpler now and just stick with what you have.",293315990,2015-08-12 02:39:05
8767404,7111,36803486,122,"is it worth checking if

```
  val otherResult = failFastSequence(someoneElseDoesOperation.map(_._2))
  otherResult.value match {
    case Some(Failure(err)) => Future.failed(err)
    case _ =>
      // not complete yet, or successful:
      // sc",293317960,2015-08-12 02:47:31
8767404,319889,36804211,122,"Thats a good idea, can just fail fast the whole process",293317960,2015-08-12 02:54:49
8770598,7111,36892728,4,"these were public, can we leave them? Why incur any migration cost?",293402663,2015-08-12 23:02:29
8770598,7111,36893047,23,"can we name these something else, so they don't conflict with the old strings?",293402663,2015-08-12 23:05:12
8770598,7111,36893084,29,let's add a type here or make it private.,293402663,2015-08-12 23:05:30
8770598,3485758,36893826,40,Looks like this is a public method. So maybe it would be a better idea to add a new method of signature `String -> Option[Format]` rather than changing the return type of this method?,293402663,2015-08-12 23:11:31
8770598,7111,36914544,20,"while we're at it, can you add `private val emptyBegin = """"""^\s*""""""` and use it below. Also, can you refer to the `DateOps.DATETIME_...` strings instead of repeating them below?",293402659,2015-08-13 02:12:29
8770598,7111,36915169,40,"can we add this method to `Format` directly:

```scala
def matches(s: String): Boolean = validator.findFirstIn(s).isDefined
```
so this becomes
```scala
formats.find(_.matches(prepare(s)))
```",293402659,2015-08-13 02:18:06
8770598,3485758,36917689,40,Done,293402659,2015-08-13 02:40:47
8770598,3485758,36917789,20,"Done. I was able to factor out `emptyEnd = """"""\s*$""""""` as well",293402659,2015-08-13 02:41:49
8896657,319889,37202333,62,"Since the constructor setting up the null for the list is private, and we only seem to care if the path is empty or not. Can we just default subPaths to an empty list and not need to do null checking? ",299083251,2015-08-17 20:51:39
8896657,7111,37334287,54,can you add with `TypedSink[T]`? Is there any reason why you can't write to this?,299179089,2015-08-18 23:23:00
8901241,814892,37251892,4,"An error message here would be nice
```scala
require(start <= end, ""end of date range must not occur before the start"")
```",299139335,2015-08-18 05:07:39
8905381,7111,37341696,46,"why take the mode as a parameter if we only pass it a HadoopMode?  Why not do all these in any case and let the user attach an empty FlowListener/etc... (which we can even provide, as there is a monoid on these things).",299183211,2015-08-19 00:24:04
8905381,7111,37341778,5,"just to be clear, we wouldn't merge this yet, right? This is just to get comments?",299183211,2015-08-19 00:24:40
8905381,319889,37342043,46,"Can move it to hadoop mode sure.

You mean have a default strategy so its not an option below? ",299183211,2015-08-19 00:27:11
8905381,319889,37342121,5,"Yes exactly, this version isn't on maven central, so this won't pass tests.  -- branch hasn't merged in Chill either, and no rls there. ",299183211,2015-08-19 00:27:54
8905381,7111,37445411,90,"while we're at it, why not stack in GzippedBase64String:

https://github.com/twitter/bijection/blob/develop/bijection-core/src/main/scala/com/twitter/bijection/BinaryBijections.scala#L33

Might make the jobconfs slightly smaller.",299183211,2015-08-19 22:53:18
8905819,7111,37347465,61,"does the order matter here? Seems to me, each unwrapping might be a different line number. Is that not the case? Do we not want a `List[Array[StackTraceElement]]` and just concat all of them and try to get line numbers out of each?",299083180,2015-08-19 01:14:24
8905819,319889,37347789,61,"We could get a line number out of each, possibly getting several line numbers. That might be better really, but it could appear more noisey. This was just attempting to do a priority of the first thing you did to the last, but thats pretty arbitrary",299083180,2015-08-19 01:17:10
8905819,319889,37349618,61,"Attempts to preserve everything we know now, other than the line numbers being off a little I think in the scala compiler it looks decent

TypedPipe.from(List(1,2,3))
   .map()

reports both line numbers are with the .map",299083180,2015-08-19 01:32:54
8905852,7111,37347902,11,"minor style. can we do:

```scala
case pp: Operator =>
  pp.getOperation match {
    case sp: ScaldingPrepare[_] => sp.descriptions ++= combinedDescriptions
    case _ => ()
  }
  case _ => ()
```",299187112,2015-08-19 01:18:02
8905852,7111,37347855,13,can this be `private[scalding]` or something?,299187112,2015-08-19 01:17:43
9024936,814892,39772811,44,Can you add back the return type here,301241362,2015-09-17 22:21:03
9024936,814892,39773048,10,I think we still need the Nil case. There can be steps with non-Hfs source taps only. How about keeping the `unrollTaps` implementation for logging purposes here and using the new `inputSizes` for computing input sizes?,301241362,2015-09-17 22:23:00
9072429,622449,38022828,6,"I don't think you need this object, nor SinkConfigBinaryConverterProvider

just put these vals in:
```
object ConfigBinaryConverterProvider {
  val sourceKey = ""com.twitter.scalding.lzo.converter.provider.source""
  val sinkKey = ""com.twitter.scaldin",306591902,2015-08-27 00:14:09
9072429,622449,38022969,6,"oh i see, you need these so you can have a class to put in the conf. nevermind.",306591902,2015-08-27 00:16:02
9388372,2523602,40120702,23,I think strategies will be applied in a sequence so it is associative (and not commutative)? /cc @ianoc  as he wrote this.,315327034,2015-09-22 23:01:05
9388372,123326,40121320,23,"Yep, this is a semigroup because `plus` is assocative",315327034,2015-09-22 23:05:13
9388372,7111,40121365,56,"I prefer the style:
```scala
.foreach {
  case Success(fn) => flow.addListener(fn(mode, configWithId))
  case Failure(err) => throw new Exception(s""Failed to decode flow listener: $err"")
}
```",315327034,2015-09-22 23:05:37
9388372,7111,40121409,61,"similar, can we use the case approach here?",315327034,2015-09-22 23:05:54
9388372,7111,40121525,23,It's not side-effecting. Nothing happens in plus. It is just creating a new strategy. Looks correct to me.,315327034,2015-09-22 23:06:57
9388372,123326,40121838,23,"Making an analogy to Haskell, it's equivalent to the semigroup over this type:

```haskell
newtype FlowStepStrategy a =
    FlowStepStrategy (Flow a -> JList (FlowStep a) -> FlowStep a -> IO ())

instance Monoid (FlowStepStrategy a) where
    mempt",315327034,2015-09-22 23:09:22
9388372,814892,40122279,23,"Ah ok. What I was confused about was if plus(a, plus(b, c)).apply and plus(plus(a, b), c).apply will have the same effect.",315327034,2015-09-22 23:12:46
9388372,814892,40120068,23,Should this be a Semigroup? Looks like a side-effecting function here. Are we guaranteed associativity?,315327034,2015-09-22 22:57:12
9388372,7111,40129985,46,why didn't you use the case style here?,316435045,2015-09-23 00:08:03
9388372,7111,40130121,63,"inconsistent with above (you only put the exception, here you put the Failure wrapper).

I think it is better to do:
```scala
case Failure(err) => new Exception(""Failed to decode flow step listener"", err)
```
so we can see that this exception was ca",316435045,2015-09-23 00:09:17
9388372,7111,40130177,58,"think we should use the caused by constructor, see below.",316435045,2015-09-23 00:09:46
9388372,7111,40130209,46,"also, use caused-by constructor (see below).",316435045,2015-09-23 00:10:01
9980154,319889,42643669,27,"This isn't really correct for scalding, the comment mentions the method is realted to the associated operations which wires down to https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/Operations.scala#L126 wh",333964401,2015-10-21 21:00:16
9980154,319889,42643742,23,"This is going to break lots of users, so lets try not do this. any usage of -D on the commandline will be broken",333964401,2015-10-21 21:00:54
9980154,319889,42643856,5,"Please undo non scala 2.10 compatible changes, they don't seem like they should be in this PR anyway",333964401,2015-10-21 21:01:52
9980154,7111,42655840,27,"+1 to what @ianoc said. I'd rather us take the max value of the two keys in Operations.scala, and here set the non-deprecated internally, but not deprecate our API (instead explain what it means to the user, not necessarily in cascading terms).",333964401,2015-10-21 22:37:02
9980154,7111,42656159,23,I'd rather take the max in cacheSize (maybe logging a warning if two are set).,333964401,2015-10-21 22:39:03
9980154,7111,42656385,5,"we can possibly use https://github.com/milessabin/macro-compat if we want to escape any 2.11/2.12 warnings here, but I'd really like to keep 2.10 support as long as we can easily do so (even though twitter is actually on 2.11 these days).",333964401,2015-10-21 22:40:35
9980154,1202170,42844967,5,"Indeed, this was reckless. Reverting now.",333964401,2015-10-23 13:52:31
9980154,1202170,42845275,23,"Trick is, AggregateBy.AGGREGATE_BY_THRESHOLD has disappeared from the Cascading API. We can of course read it and carry that value forward if AggregateByProps.AGGREGATE_BY_CAPACITY has been left unset by the user; is that what you'd like me to do?

Do y",333964401,2015-10-23 13:56:13
9980154,7111,49809603,37,any reasons for this?,373065505,2016-01-15 08:59:33
9980154,7111,49809664,84,#1473 should fix this,373065505,2016-01-15 09:00:47
9980154,7111,49809939,27,Why not call the capacity variant?,333964401,2016-01-15 09:05:43
9980154,7111,49810064,15,extends Any,373065505,2016-01-15 09:07:34
9980154,1202170,49838861,84,"#1473 sounds like a good idea, do you want me to pull https://github.com/rubanm/scalding/tree/rubanm/dfs_datastores into this?",373065505,2016-01-15 18:20:06
9980154,1202170,49838954,37,"no, oversight. reverting.",373065505,2016-01-15 18:21:11
9980154,814892,49876515,84,"@cchepelov  I'm running some tests against that branch, so it should get merged to develop soonish. Go ahead and merge that branch if that keeps this PR moving though. Thanks.",373065505,2016-01-16 00:56:01
10260698,123326,43915601,24,I don't understand this explanation of the test.  What is this testing?,340824816,2015-11-05 01:05:10
10260698,7111,43919985,24,"I didn't edit it properly. There was originally a normal join and a sketch join in the job, but I removed the normal join since it was just easier to assert the output was a particular thing. This particular input and output caused an exception before, so",340824816,2015-11-05 01:41:06
11093942,7111,48099644,5,can you remove TDsl while you are at it?,360874057,2015-12-20 12:35:42
11093942,7111,48099655,23,"Can we not repeat this code 3 times? What if we have this function in the companion object of `OrderedSerialization2` in this file:

https://github.com/twitter/scalding/blob/develop/scalding-serialization/src/main/scala/com/twitter/scalding/serializatio",360874057,2015-12-20 12:39:53
11093942,7111,48293575,39,"this style is not recommended any more (.toTypedPipe), so let's just use TypedText.tsv the whole way:
```scala
val tp1 = TypedPipe.from(TypedText.tsv[(Int, Int, Double)](""mat1""))
```",363384581,2015-12-23 04:17:54
11093942,7111,48293623,60,did you verify that this test fails if you don't have the intOS in scope?,363384581,2015-12-23 04:18:28
11093942,7111,48293651,23,"let's not import Pipe, Fields, or TDsl.",363384581,2015-12-23 04:18:50
11093942,7111,48293787,28,"can you add a comment that this is just for a test, normally you would use: 
https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/serialization/RequiredBinaryComparators.scala#L21

```scala
import Required",363384581,2015-12-23 04:20:26
11093942,7111,48293988,5,"can we actually rename this `maybeOrderedSerialization2`. Sorry, in scala you can't have implicits with colliding names (but you can have normal methods with colliding names as long as their parameters are different). We might want to add `maybe...[2-22]`",363384581,2015-12-23 04:22:28
11093942,1825352,48307380,60,"Yup, it failed if I don't declaim intOS in scope.
",363384581,2015-12-23 06:48:18
11093942,7111,48313202,60,Cool. Just making sure. :),363384581,2015-12-23 08:23:34
11093942,1825352,48317621,60,"Of source! :)
I will have another update to address other comments shortly.",363384581,2015-12-23 10:12:02
11093942,1825352,48318334,28,"I changed intOS as ```implicit val intOS = orderedSerialization[Int] ```.
I guess it's better to use the normal macro here.",363384581,2015-12-23 10:37:16
11138050,814892,47954888,8,This can extend just SourceTap.,361799294,2015-12-18 04:12:29
11138050,814892,48278122,5,goodHdfsPaths will return Nil in this case right? We need to pass hdfsPaths here I think so that openForRead throws with the right message. Can you also update the comment above.,363545800,2015-12-23 01:44:36
11138050,814892,48278256,6,This one seems unused,363545800,2015-12-23 01:45:51
11138050,814892,48278428,25,"A more realistic test case could be we set some dummy paths here, and override def pathIsGood to always return false. What do you think?",363545800,2015-12-23 01:47:37
11138050,1825352,48282260,5,Good catch!,363545800,2015-12-23 02:28:02
11138050,1825352,48283280,25,"Yeah, makes sense.",363545800,2015-12-23 02:38:07
11206947,7111,48212256,44,"scala style in to use `def modeBanner(): Unit` to have `()` for methods that have side effects (strange style, but the compiler will warn you otherwise).",363440853,2015-12-22 09:13:18
11206947,7111,48212338,70,Let's not use `_` style mixed. Can we just do `fsLs`here? Similarly below?,363440853,2015-12-22 09:14:48
11206947,7111,48212398,70,What's the return type here? Looks like Any to me. Can you put a type and make it `Try[FsShell]` I guess?,363440853,2015-12-22 09:15:33
11206947,7111,48212417,84,similar comment here about return type (which we want on all public methods).,363440853,2015-12-22 09:15:54
11206947,7111,48212451,44,also can we call this something like `printModeBanner` to make it clear what the side effect is?,363440853,2015-12-22 09:16:33
11206947,7111,48212492,45,"can we do

`val (modeString, homeDir) =`

so it is more clear what is in each part of the tuple?",363440853,2015-12-22 09:17:34
11206947,7111,48212511,9,is this change due to using a different version of jline?,363440853,2015-12-22 09:17:52
11206947,1443419,48228397,9,"I undid the change with the jline dependency. It belongs to a different patch I tried for intercepting ""Ctrl-C"" to stop the last submitted scalding flow without exiting the REPL.

This change was originally in connection to the first version where I was",363440853,2015-12-22 15:41:39
11206947,1443419,48229120,9,"that's actually what's failing on travis but not locally:
```
[error] /home/travis/build/twitter/scalding/scalding-repl/src/main/scala/com/twitter/scalding/ScaldingShell.scala:98: value setPrompt is not a member of scala.tools.nsc.interpreter.ILoop
[er",363440853,2015-12-22 15:55:20
11206947,401065,48751430,54,Is the working directory for the default `FileSystem` always the user's home directory?,367865362,2016-01-05 00:49:57
11206947,1443419,48765509,54,"It is typically for cluster FileSystem such as HDFS. For the local fs used in hdfsLocal and local modes, the working dir is the $PWD (""user.home"" system property) of the OS process (JVM). ",367865362,2016-01-05 02:58:14
11301020,1026143,48541020,1,"I think `reducer_estimation` package object should be in `com.twitter.scalding` package.
http://www.scala-lang.org/docu/files/packageobjects/packageobjects.html
http://docs.scala-lang.org/style/naming-conventions.html#packages",365979811,2015-12-29 21:47:32
11301020,1026143,48541052,33,"```scala
scala> com.twitter.scalding.reducer_estimation.mean(Seq(1000.0D, 200.0D, 2400.0D).map(_ * 3))
res0: Option[Double] = Some(3600.0)

scala> com.twitter.scalding.reducer_estimation.median(Seq(1000.0D, 200.0D, 2400.0D).map(_ * 3))
res1: Option[D",365979811,2015-12-29 21:48:18
11301020,7111,48982607,1,"Yes, but I wonder why the compile didn't fail before. Ahh, because it was a root package. :/ Good catch.",365979811,2016-01-07 01:16:30
11554511,319889,49531456,24,"Generally we avoid mutable stuff like this where at all possible, this config could persist/grow or do different things now depending on re-executions of this execution? ",372145676,2016-01-13 07:31:59
11554511,319889,49531603,51,"This is only setting step configs on a single step for each ToWrite, that won't set the config options globally for a given run. Its not really clear what it would mean since it won't apply for a full execution.",372145676,2016-01-13 07:33:27
11554511,319889,49531762,5,"This means adding several configuration options is going to make a deep nested set of typed pipe classes, could we not stick a map in here? ",372145676,2016-01-13 07:34:53
11554511,87021,49532554,5,"You mean instead of:

    def withExtraConfig(key: String, value: String): TypedPipe[T]

something like this:

    def withExtraConfig(extraConf: Config): TypedPipe[T]
 ",372145676,2016-01-13 07:42:54
11554511,87021,49533102,24,"Yes the extraConfig var can grow in different moment see my unit test, we could have 

    val exec1 = TypedPipe.from(TypedTsv[(String, Int)](args(""input1""))).writeExecution(TypedTsv[(String, Int)](args(""output1"")))
    val exec2 = TypedPipe.from(Typed",372145676,2016-01-13 07:49:10
11554511,87021,49533354,51,"Yes I'm not trying to set the Config globally, but only to the stepFlows that will be generated by this execution, see my explanation above ^^",372145676,2016-01-13 07:51:47
11554511,319889,49533386,24,"So in general you've a mutable API, this is a no-no in most of our settings. Any call on an execution should return a new execution, not mutate the existing one. Thread safety and other things are all issues once you start down the mutation route, what ha",372145676,2016-01-13 07:52:20
11554511,319889,49533749,51,"But this doesn't push it down to that, it attempts to push it onto the final rich pipe thats doing the write out, which won't effect any intermediate mappers , reducers or other things in this execution.

I'm not really sure this is workable, I don't th",372145676,2016-01-13 07:56:06
11554511,7111,49535718,24,+1 to the comment of no mutation being a requirement here.,372145676,2016-01-13 08:17:59
11554511,622449,49535925,51,"Yeah lots of corner cases here. You can already set config options per-source and per-sink, which has at least more easily understood semantics ",372145676,2016-01-13 08:20:26
11554511,319889,49536143,87,Need a platform test here too,372145676,2016-01-13 08:22:36
11554511,7111,49536193,5,"What is the scope of this? There needs to be really precise contracts here to make a new API. I'm pretty nervous what this will mean, and that users will start coding to accidental implementation details which will be really hard to keep stable.",372145676,2016-01-13 08:23:06
11571238,319889,49614075,37,"This change in behavior should probably be in its own PR and more flagged for discussion I think as to how it should be ANN. Requiring more successfiles seems very safe, dropping the non-hidden paths 'weakens' the test (even if its maybe more correct). Pr",372524980,2016-01-14 00:35:07
11571238,319889,49614570,21,"You can just do (dir, OrVal(true)) (dir, OrVal(false))

and then MapAlgebra.sumByKey(listOfPaths) will do the right thing",372524980,2016-01-14 00:38:44
11571238,319889,49614714,4,"The use of Committed in scalding here is new, i'd rather it was something related to success files so we keep the naming constant",372524980,2016-01-14 00:39:33
11571238,7111,49614817,27,.nonEmpty is redundant here (forall on an empty list is true).,372524980,2016-01-14 00:40:13
11571238,319889,49615079,27,isn't that the opposite of what he has tho? This says the list must be non-empty and all true. I think just forall would let through the empty list,372524980,2016-01-14 00:42:00
11571238,319889,49615286,4,Is there any reason this shouldn't just replace the globHasSuccessFile ? ,372524980,2016-01-14 00:43:26
11571238,7111,49615627,27,yes you are right. Sorry for the noise.,372524980,2016-01-14 00:46:12
11599419,319889,49762948,5,Is t05 a public release? ,373127265,2016-01-15 02:20:45
11599419,814892,49763540,5,"Yep it's on maven central and sonatype 
https://oss.sonatype.org/content/repositories/releases/com/twitter/hraven/hraven-core/",373127265,2016-01-15 02:25:03
11599419,7111,49764166,32,can this be factored out to a method call? The line is super long.,373127265,2016-01-15 02:29:12
11599419,814892,49764266,7,We could make this overridable as Option[List[String]] so any external cases still work with the older hraven version.,373127265,2016-01-15 02:29:59
11749711,319889,50426965,12,"Is it worth having a flavor like
```
def checkOutputTransform[T, U](input: List[T])(transform: TypedPipe[T] => TypedPipe[U])(assertions: List[T] => Unit) =
  assertions(checkOutputInline(transform(TypedPipe.from(input))))
```

Or doing TypedPipe.fro",376678179,2016-01-22 00:45:50
11749711,1852479,50427581,12,Sure that actually may be nice to have.,376678179,2016-01-22 00:49:51
11749711,1852479,50429257,12,Function added,376678179,2016-01-22 01:00:23
11749711,7111,50434831,12,"can we put a return type on all methods?

also, what about mre general:
```scala
def checkOutputTransform[T, U, R](input: List[T])(transform: TypedPipe[T] => TypedPipe[U])(assertions: List[U] => R): R =
```
then you could use methods that return oth",376690513,2016-01-22 01:41:18
11749711,7111,50435069,12,same comment here: make the return generic please.,376678179,2016-01-22 01:43:07
11749711,7111,50467504,26,any reason not to call this `inMemoryToList` or something?,376714106,2016-01-22 05:30:46
11749711,7111,50467639,20,maybe ` def mapAll` is a name closer to what we are doing?,376714106,2016-01-22 05:31:43
11749711,7111,50467749,12,`def transformMapAll`?,376714106,2016-01-22 05:32:35
11749711,1852479,50469058,26,I like this name for this function.  I kind of like idea of keeping the names for the others though since it really is just a nice to have utility function for running some asserts on a typed pipe and the name indicates that it probably should only be use,376714106,2016-01-22 05:43:34
11749711,1852479,50470997,20,"Mentioned above, I don't mind this name too much since it indicates that it should probably only be used for tests.  With mapAll we should also warn that it pulls everything into memory.  mapAllAsList?  If we can imagine people using this function in norm",376714106,2016-01-22 05:59:19
11749711,1852479,50471027,12,Same point as checkOutput.  ,376714106,2016-01-22 05:59:31
11911844,814892,51170764,32,needs another test for multiple libjar dirs?,380495324,2016-01-29 03:09:54
11911844,319889,51177427,32,Added,380495324,2016-01-29 03:52:08
12000125,7111,51479021,47,why don't we need this exclude?,382646239,2016-02-02 04:54:50
12000125,814892,51486696,47,Added back the exclude. There was an unused pig import in the original code which we don't need.,382646239,2016-02-02 05:51:03
12003735,7111,52246500,4,"if this is lazy, the arg in the constructor needs to be, otherwise this should not be lazy.",386508175,2016-02-09 07:40:30
12026230,319889,51638599,11,Does this need to be mutable? seems unfortunate to stick a mutable thing in place here,383195753,2016-02-03 05:31:21
12026230,7111,51639196,3,can we use `sealed abstact class` and `object` subclasses instead? `Enumeration` has a lot of issues and many consider it non-idiomatic.,383195753,2016-02-03 05:35:33
12026230,7111,51639398,11,+1 no mutability here. Have the methods below return new instances.,383195753,2016-02-03 05:36:37
12026230,7111,51639551,8,why not put this in scalding-args package?,383195753,2016-02-03 05:37:30
12026230,1852479,51640159,11,"Removed the mutable, instead went with a List of case classes.",383195753,2016-02-03 05:41:31
12026230,319889,51640761,5,"case object and sealed abstract trait are normally used here.

Should these all be private? ",383284106,2016-02-03 05:45:12
12026230,319889,51641001,10,"Would using a builder style pattern not be cleaner/closer to what you had before?

DescribedArgs(args).withRequired(""key""...).withRequired(...)",383284106,2016-02-03 05:46:45
12026230,319889,51641094,7,"If going this route I think the API would be cleaner if these were case classes extending ArgOptions, taking key and description. ",383284106,2016-02-03 05:47:21
12026230,1852479,51641562,7,"Good point, I wasn't a huge fan of exposing that parameter.  I also thought about the builder pattern but I liked the List because I can share a list of Described Args more easily between jobs.",383284106,2016-02-03 05:50:37
12026230,7111,51642384,36,"rather than a mixin style could we do:
```
object ArgHelp {
  def with(describedArgs: Seq[DescribedArg], ex: Execution[Unit]): Execution[Unit] = 
    // your code here?
}
```
Then it could be used with other Execution combinators.",383284106,2016-02-03 05:56:05
12026230,7111,51642490,12,still like moving this to `scalding-args` project,383284106,2016-02-03 05:56:52
12026230,319889,51648500,41,"This isn't used now, is it needed with the help string? is it maybe the usage string?",383295873,2016-02-03 06:40:27
12026230,319889,51648624,21,Should we be doing validation in here? we don't validate at all anymore right? ,383295873,2016-02-03 06:41:20
12026230,1852479,51642583,36,"Good idea, I was imaging some cases where the mixin style could be odd for users.",383284106,2016-02-03 05:57:47
12026230,7111,51642600,17,could this be a method on `DescribedArg`? say `def descriptionMessage`?,383290689,2016-02-03 05:57:53
12026230,1852479,51662016,41,"Is is still output for the command line option.  I wanted the output to look like

--key required [--key optional] 

Then output the detailed help below.",383295873,2016-02-03 08:38:15
12026230,1852479,51662097,21,Maybe a second method that does validation and leave it up to the user to decide if they want to describe all the arguments or not?  ,383295873,2016-02-03 08:39:07
12026230,319889,51662255,21,"A second method sounds reasonable, or a flag here. None of the information is passed onto the output execution here so chaining is likely difficult.",383295873,2016-02-03 08:41:10
12026230,319889,51662296,21,Also maybe describe should be typed on T and passthrough that type T rather than Unit? ,383295873,2016-02-03 08:41:34
12026230,319889,51662324,41,"Ok cool, lets make it private[this] if we just expect it to be used above, since we won't have to worry about binary changes later",383295873,2016-02-03 08:41:55
12026230,1852479,51730418,41,Made it package private so I could override it for the unit tests.,383295873,2016-02-03 22:55:56
12026230,319889,51745279,3,Why abstract class than abstract trait? seems an unusual choice. No real problem with it...just an unusual pattern,383664892,2016-02-04 00:25:57
12026230,1852479,51746023,3,Didn't give it too much thought.  I made the second one a trait so I can easily extend it for my unit tests.  I could make it an abstract class though. ,383664892,2016-02-04 00:28:40
12026230,319889,51746007,20,Any reason not to put a type T on the Executions so you can pass through your state here? ,383664892,2016-02-04 00:28:35
12026230,319889,51747055,3,Well more usually we have these all be sealed traits. Given its sealed I don't actually know if it makes a difference really. ,383664892,2016-02-04 00:33:58
12026230,1852479,51748191,20,"Unsure of how to handle help.  I could mark the Execution as a failure when help is given but that doesn't seem correct and the user would have to handle the Help Error upstream.  I could also output the T wrapped by Option but that always seem awkward.
",383664892,2016-02-04 00:40:16
12026230,319889,51749948,20,Mmm I think maybe an exception is the way to go here. I think this API will be a bit funky otherwise. Since if you continue on from the returned execution from this in a chain it will throw away the fact the help was printed since its not represented in t,383664892,2016-02-04 00:50:06
12026230,319889,51756677,33,"throw here is wrong, this is actually throwing inside the outer execution I believe, the failed method never gets called. Just drop throw and should be good",383751915,2016-02-04 01:35:03
12026230,319889,51756771,66,as above,383751915,2016-02-04 01:35:46
12026230,319889,51756828,8,also here,383751915,2016-02-04 01:36:09
12026230,7111,51785330,59,this should return `Execution[Nothing]` and not have a `T` anywhere.,383763029,2016-02-04 04:54:44
12026230,7111,51785388,59,actually it should return `Nothing`.,383763029,2016-02-04 04:55:17
12026230,7111,51785963,52,"can we factor this bit into a method that could be used with Job?
```scala
def describe(describedArgs: Seq[DescribedArg], args: Args): Unit =
  if (args.boolean(""help"")) helpRequest(describedArgs)
  else ()
```
then call that in your code above?",383763029,2016-02-04 04:58:40
12026230,1852479,51787259,59,Not sure what you mean here.  No longer pass in the Execution in the method or just wildcard it and return Nothing? ,383763029,2016-02-04 05:08:21
12026230,1852479,51787342,52,So keep describe as above but call this new method for help?  ,383763029,2016-02-04 05:08:58
12026230,1852479,51787701,59,"Ah for helpRequest, was looking at describe.  ",383763029,2016-02-04 05:11:32
12026230,319889,51787759,52,"For both describe and validate we can have functions that go Seq[DescribedArg] => Nothing, Then we can call those from job's or anywhere else I think would be his idea. But can still have the execution variants too",383763029,2016-02-04 05:12:00
12026230,319889,51787468,59,"I think what he means is just a function signature like:
```
def helpRequest(describedArgs: Seq[DescribedArg]): Nothing = {
```

Since you never actually return an Execution",383763029,2016-02-04 05:09:49
12026230,319889,51791840,73,"drop the [T] here, looks unused",383871297,2016-02-04 05:42:06
12080448,7111,51934089,10,"Ahh, yes. Thank you for correcting me there.

:+1: ",384229786,2016-02-05 04:41:37
12080448,7111,51928403,8,can we use `Execution.failed` here?,384229787,2016-02-05 03:54:24
12080448,7111,51928488,8,"also, should be `map(e => Success(e))` no need for `Try`.",384229787,2016-02-05 03:55:04
12080448,7111,51929000,4,can you explain that this Execution should never be failed? Only the Try might be failed.,384229787,2016-02-05 03:58:44
12080448,1852479,51929933,8,"Can't actually use Execution.failed here because it will fail the Execution itself when what we really want is the Failure object inside of a good Execution. 

Success was a good catch though and is fixed.",384229787,2016-02-05 04:06:01
12080448,7111,51930423,10,@richwhitjr I made a second request (use Exception.failed). Was there a reason you didn't take that suggestion?,384229786,2016-02-05 04:09:53
12080448,1852479,51932209,10,You mentioned Execution.failed.  The issue is that doing that will fail the Execution itself.  On an exception being thrown we want a non-failure execution with a Failure Try inside of it.,384229786,2016-02-05 04:24:50
12081986,7111,51949681,2,back dating it? :),384241098,2016-02-05 06:38:10
12081986,7111,51950267,22,can we keep this called `next` for binary compat and have a `defNextCached(o: EquivSerialization[_]): ...` which handles the cache logic?,384241098,2016-02-05 06:42:34
12081986,7111,51950376,8,what about just `EquivSerialization[T]` so we could do this for non-ordered later?,384241098,2016-02-05 06:43:26
12081986,7111,51963233,13,"if you did the `Any` here instead of `K` you would not need the cast in putIfAbsent, right?",384299984,2016-02-05 08:59:00
12081986,7111,51963317,8,can this extend Serialization?,384299984,2016-02-05 08:59:38
12081986,7111,51964907,9,is this the full type? Can you test for that in the test? I have anxiety about it not being the fully qualified name.,384299984,2016-02-05 09:17:47
12081986,319889,51965174,8,Sorry yes my typo. ,384299984,2016-02-05 09:19:56
12081986,319889,51965304,9,"I can't see an easy way to say it must be the FQN, it seems in manual testing to be the FQN when its not a built in type",384299984,2016-02-05 09:21:35
12081986,319889,51965730,13,"Yep, that works",384299984,2016-02-05 09:25:57
12081986,319889,51965965,9,I have a test in there that for a custom type it is the FQN now,384299984,2016-02-05 09:28:30
12081986,7111,51963682,24,"do we need the `()` to call now (because we added, probably rightly since there is a side-effect here)",384299984,2016-02-05 09:04:02
12083861,7111,51926199,66,evictions is misspelled.,384257776,2016-02-05 03:39:26
12083861,7111,51926245,36,this is duplicated.,384257776,2016-02-05 03:39:44
12084766,319889,51955797,12,Could we keep them explicit and just fix it to (),384266363,2016-02-05 07:30:42
12084766,123326,51955890,12,Will do,384266363,2016-02-05 07:31:30
12084766,7111,51955949,12,+1 to replace with `()`,384266363,2016-02-05 07:32:07
12112027,123326,52093002,4,Whoops.  This reversion is a mistake due to some `git` mistakes on my part.  Let me fix this.,385203173,2016-02-06 08:57:10
12112194,319889,52093440,9,This i think might actually be performance critical code,385206786,2016-02-06 09:07:25
12112194,7111,52093933,9,that is not the same logic. Note `prev` is a var that is updated.,385206786,2016-02-06 09:19:05
12112194,7111,52094061,18,"put these in the case:
```scala
case None if args.positional.isEmpty =>
 ...
case None => // has at least one arg
```",385206786,2016-02-06 09:22:08
12112194,7111,52094097,9,Iterators are always mutable.,385206786,2016-02-06 09:23:29
12112194,7111,52094140,18,also write `job(args)` rather than `job.apply(args)`.,385206786,2016-02-06 09:24:44
12162029,319889,52241229,26,Should we not be releasing on success or failure? ,386444910,2016-02-09 06:56:30
12162029,7111,52241304,23,"doesn't this block? We don't want that. The twitter one provides a Future for when we can act.

We want something like async semphore using scala futures.",386444910,2016-02-09 06:57:05
12162029,319889,52241899,23,"That deserves a good test, the Execution.from implementation is such I'm not sure if it does, there is a lot of lazy creation of things that its possible its deferred into a future pool. -- However its still not great since it will block a thread in the f",386444910,2016-02-09 07:01:43
12162029,1852479,52259792,23,"Let me see what I can come up with without the complexity and added dependencies of pulling in twitter futures etc.  I was trying to avoid that above but you are correct about the blocking.  I agree about the unit tests, hard to think of a simple fast tes",386444910,2016-02-09 10:12:15
12162029,7111,52663368,63,rather than `map(... get)` can we call `flatMap(... fromTry( )...)`,386826371,2016-02-12 04:40:49
12162029,7111,52663659,61,this should never happen right? because acquire returns a non-failed future. Can we do `Failure(e) => throw e // should never happen or there is a logic bug`.,386826371,2016-02-12 04:42:52
12162029,7111,52664369,120,can we use a semigroup here since there is no empty DateRange that really makes sense (error if the `Seq` is empty),386826371,2016-02-12 04:48:08
12162029,7111,52663870,52,I don't see why not to put this in `object Execution`. Seems almost as general as sequence.,386826371,2016-02-12 04:44:29
12166273,7111,52271135,109,"I've heard java mutable maps are a little faster, might be worth trying that (can use `.asScala` to return the `CollectionBackedMap`. Just an idea.",386635547,2016-02-09 14:17:01
12166273,7111,52271244,186,is this logic correct? I don't think so. `1` was the number of keys before. I think you need `kvs.size` instead of `1`,386635547,2016-02-09 14:19:27
12166273,7111,52271260,220,same comment on key size.,386635547,2016-02-09 14:19:51
12166273,319889,52314660,109,"Seems scala's OpenHashMap is faster again from a quick look around

https://gist.github.com/pchiusano/1423303",386635547,2016-02-09 22:37:12
12167078,7111,52256719,11,what about SINK? Also `setVersion` is called in the old code.,386551716,2016-02-09 09:32:01
12167078,319889,52352854,15,can we change this to be string interpolation instead while I see the diff...,386551716,2016-02-10 02:40:05
12167078,7111,52357797,15,+1,386551716,2016-02-10 03:12:42
12167078,7111,52773493,4,"this it not perf critical at all (planning code). You could fix this with:
```scala
 val withSort = sortOpt match {
  case Some(s) => inGb.sortBy(s)
  case None => inGb
}
```",388255953,2016-02-13 01:46:01
12167078,7111,52773575,4,or: `val withSort = sortOpt.fold(inGb)(inGb.sortBy)`,388255953,2016-02-13 01:46:49
12167078,7111,52773217,4,that's not perf critical as much as the invariant that one of the iters has an item is not communicated in the types by cascading,388255953,2016-02-13 01:43:32
12167078,123326,52773830,4,"Whoops.  When I wrote that I assumed that Scala had some sort of safe way to get the head that returned an `Option` and that you weren't using it for performance reasons, but now I see that there is no such function in the API.  I'll change the wording to",388255953,2016-02-13 01:48:58
12167078,123326,52773996,4,Ignore my last comment (I was talking about the wrong thing).  I'll implement your suggestion.,388255953,2016-02-13 01:50:17
12167078,7111,52774177,4,"could use `flatMap` here:
```scala
def getExecution: Execution[T] = toOptionExecution.flatMap {
  case Some(t) => Execution.from(t)
  // same exception as scala.None.get
  // https://github.com/scala/scala/blob/2.12.x/src/library/scala/Option.scala#L",388255953,2016-02-13 01:51:56
12179818,7111,52347863,89,"I forgot about this. This will create two concurrent cascading threads, which is not safe. We need to share that cascading thread between the two, I think.",386836990,2016-02-10 02:06:04
12179818,7111,52347921,7,can we add some documentation on the purpose of this?,386836990,2016-02-10 02:06:36
12179818,7111,52347995,4,can we add docs on the semantics of this and expected use cases?,386836990,2016-02-10 02:07:03
12179818,319889,52350041,89,Good catch... will add something to share,386836990,2016-02-10 02:22:09
12220337,319889,52558392,6,"Should we call the compare function inside the richdate's instead? just so as we avoid any potential future drift.

(Curious I didn't think defining both Ordered and Ordering would get around the bug totally, but good!)",387707124,2016-02-11 10:27:26
12243418,319889,52816076,5,The comment mentions that equality could be buggy (I guess jvm classes and what have you). I don't see why this would fix that? ,388204269,2016-02-13 08:16:45
12243418,1146482,52816684,5,"@ianoc Before this change, the toString would generate MultipleTextLineFilesListinputname for ""inputname"" path. It doesn't match when JobTest is given a source, which outputs MultipleTextLineFilesWrappedArrayinputname",388204269,2016-02-13 08:27:08
12243418,123326,52817747,5,I recommend adding what you just said as a comment since it's non-obvious from just reading the code why `mkString` is being used here,388204269,2016-02-13 08:47:50
12243418,814892,52817865,5,The test you added passes for me on develop. Is there a better one that currently fails on develop and this branch fixes it? That might help clarify what this fix does (I don't quite understand it either).,388204269,2016-02-13 08:50:20
12243418,1146482,52818145,5,"@rubanm I'll double check it - maybe if it only has one input source it fails
@Gabriel439 good call, I'll add that info. Not sure why WrappedArray is used though.",388204269,2016-02-13 08:53:32
12243418,2221968,53057281,5,"It's a Scala thing:

```
scala> def foo(path: String*) = path.toString
foo: (path: String*)String
scala> foo(""a"", ""b"", ""c"")
res5: String = WrappedArray(a, b, c)
```",388204269,2016-02-17 02:46:11
12243418,2221968,53057311,6,"Does the order of paths on this source matter?  If not, should we also sort this before concatenation?",390652969,2016-02-17 02:46:23
12243418,1146482,53075267,6,I don't think so - since since both List & WrappedArray preserve order - but I may be mistaken.,390652969,2016-02-17 04:44:11
12243418,319889,53117376,5,"I hadn't noticed what was doing this before, its really that the equals relies on toString (usually toString really is just for human's and doesn't matter.). The change looks good to me, but you change this to mention that equals is relying on toString an",390652969,2016-02-17 11:33:17
12243418,319889,53206488,5,"Yes, I think we should include the note that the equals method calls this. The comment reads strange otherwise, since ordinarily toString won't be used for equality",390652969,2016-02-18 02:17:53
12243418,1146482,53204457,5,"@ianoc That's my understanding as well, and yes, I've confirmed that toString is the primary means of [doing equality check](https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/FileSource.scala#L424) (hence t",390652969,2016-02-18 02:03:01
12245805,7111,52781072,31,can we move this raw version string with the rest at the top of this file?,388690910,2016-02-13 02:48:01
12245805,7111,52781883,80,"shouldn't we merge this with `scaldingParquetScroogeCascading`? Same dependencies, same use case, right?",388690910,2016-02-13 02:53:47
12245805,7111,52783332,23,"ok, so the point here is that this target only depends on cascading + parquet, not scalding. Can we add a comment so that is not overlooked as to the purpose?",388690910,2016-02-13 03:03:59
12245805,7111,52783478,64,"again, this only depends on cascading, parquet and scrooge, right? Comment?",388690910,2016-02-13 03:04:59
12245805,814892,52782717,80,"I separated these so that the cascading schemes go in a different sub-project. parquet-scrooge, after this change would contain only the ParquetScrooge trait and related time pathed sources (which need scalding-core). If this is too thin to be its own sub",388690910,2016-02-13 02:59:27
12245805,814892,52785278,31,"Updated. The global thriftVersion is already present and set to 0.5.0, which I think should be okay.",388690910,2016-02-13 03:18:29
12419975,123326,53495235,14,"What about the case where the path is just ""*"" (i.e. a relative path pointing to all files within the current directory)?",392113907,2016-02-20 02:08:43
12419975,7111,53497375,14,What should we do there? It is a weird path. I'm not sure what the intent would be. Maybe error in that case?,392113907,2016-02-20 02:25:32
12419975,7111,53497235,12,"can you add a link to the `TimePathedSource` method `writePathFor`?

It seems like that code is dropping the trailing `/`. Should we not do the same thing here? I think that was done to accomodate local mode which writes to one file. Hadoop seems to cre",392113907,2016-02-20 02:24:24
12419975,6636815,53498271,14,"Yeah I was wondering the same as well. Getting rid of the '*' would seems like it wouldn't work. We could potentially replace the ""*"" with ""."" or error out like @johnynek suggested. ",392113907,2016-02-20 02:32:01
12419975,6636815,53501128,12,"@johnynek I guess you're referring to adding a link to that method in the source? If yes, I can make that change. 

I can make this code consistent with TimePathedSource and also drop the `/`. ",392113907,2016-02-20 02:53:08
12419975,7111,53503842,14,I'd say error.,392113907,2016-02-20 03:12:31
12419975,123326,53682436,8,Could you use `stripTrailing` here to avoid code duplication?,394157850,2016-02-23 03:56:57
12419975,123326,53689279,8,Never mind.  On closer reading this behavior is not the same,394157850,2016-02-23 04:41:09
12419975,622449,53701322,14,should these asserts be requires instead? ,394157850,2016-02-23 06:06:14
12419975,6636815,53717767,14,Yeah that might be a good idea as a followup. Ended up choosing assert as the existing code in FileSource & TimePathedSource was already using it and I thought it might be nice to keep it consistent.,394157850,2016-02-23 08:22:23
12423479,7111,53497611,27,can we move this to where the versions are? `elephant-bird-artifact` so we can keep all these switches in one place?,392215772,2016-02-20 02:27:16
12423479,7111,53498195,24,"```scala
def getInt(k: String): Option[Int] = Option(fp.getStringProperty(k)).filterNot(_.isEmpty).map(_.toInt)
val cascading2Property = get(CASCADING2_SIZE_CONFIG_KEY)
val cascading3Property = get(CASCADING3_SIZE_CONFIG_KEY)
```",392215772,2016-02-20 02:31:29
12423479,7111,53498731,34,"```scala
case (Some(a), Some(b)) => Some(Ordering[Int].max(a, b))
```
rather than the two cases.",392215772,2016-02-20 02:35:49
12423479,7111,53498892,29,is this used at Twitter?,392215772,2016-02-20 02:37:09
12423479,7111,53499562,44,"this is probably going to break some jobs. What is the work around? Would a `.forceToDisk` fix it? Would you need `.forceToDiskExecution` to put it in a new flow? That is a bummer, because it is obviously plannable. /cc @cwensel",392215772,2016-02-20 02:42:15
12423479,7111,53499737,59,"ahh, here is the workaround. we probably need to add this to the comments on `joinWithTiny` and `hashJoin`",392215772,2016-02-20 02:43:28
12423479,7111,53499949,59,"I wonder if we could automatically put this in the graph inside the merge? I hate for syntactically legal things to be errors. Compiles should me ""works"" as much as possible.",392215772,2016-02-20 02:45:08
12423479,7111,53500159,5,I see both `_ <: Configuration` and `_ <: JobConf` what is the difference?,392215772,2016-02-20 02:46:35
12423479,814892,53502803,59,"For the fields api, we could probably encode this in the Pipe name and automatically add a forceToDisk. In the typed api, we could just encode it in a new typeclass? I'm wondering how frequent such operations are and if it's worth adding code to handle th",392215772,2016-02-20 03:04:47
12423479,7111,53511241,59,"The `HashJoin` is a subclass of `Pipe`. I think we could walk up the nodes in a merge, see if there is this case, and add a `Checkpoint` node.

Pretty much (or exactly) the same code could be done in the Typed case. The only challenge is inserting an ex",392215772,2016-02-20 04:03:45
12423479,814892,53522914,59,"Looks like there is no way to access the underlying Pipes in a Merge right now. The closest is getPipePos which returns (name, position) pairs:
https://github.com/cwensel/cascading/blob/wip-3.1/cascading-core/src/main/java/cascading/pipe/Splice.java#L944",392215772,2016-02-20 05:46:36
12423479,814892,59227194,29,"There was one instance of TemplateSource being used, which I've migrated to PartitionedSource.",392215772,2016-04-11 22:41:43
12423479,814892,59227556,59,I'll post a follow-up PR against cascading3 branch for this. I think @piyushnarang's hashjoin + forceToDisk change already has most of the code to deal with this.,392215772,2016-04-11 22:43:50
12423479,814892,59228040,5,"JobConf is the old hadoop1 api and Configuration is hadoop2. In cascading3, Hfs taps and descendents were moved to the hadoop2 api. Cascading's MultiInputFormat still looks at the hadoop1 key for the input formats though (see https://github.com/twitter/el",392215772,2016-04-11 22:46:42
12423479,7111,59260494,59,"yeah, I think so too, but probably not for the fields API. Ideally we could use something like that here so we don't break any super old jobs.",392215772,2016-04-12 01:55:02
12469521,319889,53562400,18,can we put a better name on this? dateWithoutSep maybe?,393384657,2016-02-21 14:32:48
12469521,319889,53562409,40,"given the length of this list now i think it makes sense to do a 1 per line style

List(
 entry1,
 entry2,
 entry3
)",393384657,2016-02-21 14:34:01
12469521,3883873,53562420,18,Sure. my bad!!.. I will change that..,393384657,2016-02-21 14:35:30
12469521,3883873,53563126,40,I will make this change,393384657,2016-02-21 16:07:47
12469521,7111,53665193,18,isn't this just `\d{8}`?,393407952,2016-02-23 02:05:42
12469521,7111,53665383,26,can you use `\d{10}` here rathe the the define. Similarly below `\d{12}` etc...,393407952,2016-02-23 02:07:04
12469521,7111,53665457,24,lets just use `\d{8}` directly here and delete above.,393407952,2016-02-23 02:07:35
12469521,7111,53665569,41,please put `WITH_DASH` first and all the new formats after so existing use cases are not slowed down.,393407952,2016-02-23 02:08:31
12469521,7111,53665709,7,add `rd1 === rd3`,393407952,2016-02-23 02:09:36
12469521,3883873,53896368,7,sure...il add this,393407952,2016-02-24 13:37:05
12469521,3883873,53896414,18,Yeah...il do that.. My bad !!,393407952,2016-02-24 13:37:39
12469521,3883873,53896344,41,sure,393407952,2016-02-24 13:36:41
12534240,7111,53846046,10,"this API seems really easy to misuse. Not sure it should be public in scalding-core.

1. assumes executions can't fail.
2. uses side effects, and applies the function an unknown number of times (once per item).
3. replaces a somewhat uncommon pattern ",394726127,2016-02-24 04:39:18
12534240,7111,53846531,26,"you can't change signatures like this in general. This breaks both source and binary compatibility. If you want the date inside, return in with fn. Seems not worth the change.

Dropping parallelism seems good since it was unused.

Maybe this should be",394726127,2016-02-24 04:42:45
12534240,1852479,53860022,26,"Yea I worried about that, wasn't sure if this made it out on a release or not.  Thought the release was held up by some dependency problems.  

Let me refactor a bit to avoid breaking the API.",394726127,2016-02-24 06:16:36
12534240,1852479,53860380,10,"It really is a side effect function, there are a few cases where I can see it being useful for alerting/logging failures especially on adhoc jobs. 

I can drop if you find the API confusing and move it internally into my code base.  ",394726127,2016-02-24 06:19:04
12534240,7111,53864820,26,"0.16.0 final is not out yet, but several RCs have gone out.

Ideally, we never remove an API, but in this case if we want to tighten it a bit (and given the consumers can reimplement on their side).

The parallelism feature was the biggest win here, i",394726127,2016-02-24 06:52:05
12689773,7111,54671548,35,"I don't think we want these two, do we? We are breaking the contract that the forceToDisk happens before the cross, right?",399333832,2016-03-02 10:30:07
12689773,7111,54671554,38,same.,399333832,2016-03-02 10:30:13
12689773,7111,54671606,28,can this be private?,399333832,2016-03-02 10:31:06
12689773,7111,54671642,28,"what is `R, V1` here? They are not needed right?",399333832,2016-03-02 10:31:36
12689773,7111,54671978,30,"this is confusing. Do the above in the match:
```scala
val unwrapped = mapped match {
  case ForceToDiskTypedPipe(p) => p
  case p => p
}
unwrapped.toPipe(('key1, 'value1))(fd, mode, tup2Setter).forceToDisk
```",399333832,2016-03-02 10:34:46
12689773,6636815,54672281,28,"Update to make this private & remove the [R, V1]. Missed removing the generic args after refactoring some stuff.",399333832,2016-03-02 10:38:54
12689773,6636815,54673252,35,"Hmm yeah we do end up breaking the contract. I guess the problem is we do need to override these two methods if we want our class to be concrete (as they're not defined in the parent - TypedPipe). 
I think I'll need a way to force the checkpoint on the '",399333832,2016-03-02 10:55:15
12689773,7111,54673443,30,"the better solution looks something like:
```scala
def forceBeforeFlatMap[T](tp: TypedPipe[T]): TypedPipe[T] = tp match {
  case f@ForceToDiskTypedPipe(_) => f // can't move something the user did
  case tpi : TypedPipeInst[_] =>
    // need to clean",399333832,2016-03-02 10:59:11
12689773,6636815,54673661,30,updated,399333832,2016-03-02 11:02:52
12689773,7111,54790099,35,"see `TypedPipeFactory` for this use case then.

Do wish we had a nice AST here.  :/",399333832,2016-03-03 04:58:37
12689773,7111,55109318,49,can this just return Boolean?,401221529,2016-03-05 08:37:43
12689773,7111,55109390,51,"I'm worried that if there are multiple previous this logic does not hold.

Can we stop in that case or `.filter(_.size == 1)` below?",401221529,2016-03-05 08:38:50
12689773,7111,55109592,62,"```scala
.collect {
  case (_: Each) => true
  case (_: Every) => false
}
.toList
.headOption // should be on iterator, grrrrrrr
.getOrElse(false) // assume we are not checkpointed if we something other that `Every`
```",401221529,2016-03-05 08:42:53
12689773,6636815,55109601,51,Yeah I'll add the filter for size,401221529,2016-03-05 08:43:12
12689773,7111,55109675,62,"actually, isn't all this logic just:
```scala
pipe match {
  case _: Every => true
  case _ => false
}
```
what is the difference?",401221529,2016-03-05 08:44:24
12689773,7111,55109728,42,"let's not add the val, but a `private[scalding] def getPipe: Pipe` to be 100% clear this is not a public method.",401221529,2016-03-05 08:45:33
12689773,7111,55109927,76,what about `case TypedPipeFactory(next) => TypedPipeFactory(next.andThen(forceBefore))` (or something),401221529,2016-03-05 08:49:20
12689773,7111,55109963,80,another materialized case is a Pipe with no parent. This is a source.,401221529,2016-03-05 08:50:05
12689773,7111,55109994,5,can you add a comment as to why we expect two steps here?,401221529,2016-03-05 08:50:38
12689773,6636815,55110021,42,"sounds good, done",401221529,2016-03-05 08:50:47
12689773,7111,55110089,5,"actually, I expect 1 step still. This is a good unit test because we should not be adding an extra step in the hashjoin here, as far as I can tell.",401221529,2016-03-05 08:52:06
12689773,7111,55110689,72,"```scala
case typedPipeInst: TypedPipeInst[_] if isMaterialized(typedPipeInst.inpipe) => 
case _ => physicalForceToDisk
```
is clearer",401221529,2016-03-05 09:03:54
12689773,7111,55110950,68,"actually, I think we don't want forceBefore at all. Don't we always want: `physicalForceToDisk.flatMap(f)`?

If the user has a `groupBy`, that is materialized, but `groupBy.map(f)` will glue the `f` into the reducer. That is not what they mean when they",401221529,2016-03-05 09:08:19
12689773,7111,55110973,15,I think maybe this is the only change we want to make.,401221529,2016-03-05 09:08:52
12689773,6636815,55112241,62,"In this case if we encounter any other Pipe before an Every we'll return false and hence forceToDisk. The prior logic was to see between Each and Every which one we saw first. If it was an Every, skip forceToDisk and if it was an each write to disk. ",401221529,2016-03-05 09:38:48
12689773,6636815,55112315,49,"Yeah, I've updated this based on your suggestion below with the .collect.toList ...",401221529,2016-03-05 09:40:39
12689773,6636815,55112920,80,"ah nice. To confirm, this is indicated getPrevious array being empty right? (and not the `parent` field on the Pipe :-) )

On stepping through using a debugger it seems like the parent field is always null. I see previous seems to have data in most case",401221529,2016-03-05 09:59:29
12689773,6636815,55113177,5,"Yeah so what's happening here as of now is that the rhs is a Pipe wrapping an IterableSource. Since we don't currently have a check for Pipe without parent, we end up falling back to checking if there's an Every before an Each and that ends up defaulting ",401221529,2016-03-05 10:11:59
12689773,6636815,55113251,72,"agree, done",401221529,2016-03-05 10:15:06
12689773,6636815,55147941,68,"So if I understand correctly, the `ForceToDiskTypedPipe` seems to be giving us:
1) Protection against a user calling multiple forceToDisk operations successively by mistake
2) Type encapsulation which we could use maybe in the future if we have a fancie",401221529,2016-03-07 04:53:17
12689773,7111,55255613,68,"yeah, I think these are two issues the users care about:
1) as you say: `t.forceToDisk.forceToDisk == t.forceToDisk`, which is: make `forceToDisk` idempotent. Nice to have, not a huge deal.

2) make sure all `hashJoin` calls happen with a right that ha",401221529,2016-03-08 03:18:27
12689773,6636815,55256510,68,"Yeah for 2, we don't need a new ForceToDiskTypedPipe. We're already ensuring that the rhs has either been forcedToDisk prior to the Cascading hashJoin call or we end up explicitly calling it (when we can verify that). ",401221529,2016-03-08 03:23:56
12689773,7111,55743280,74,"I don't think this ever comes up, but `Empty` is basically like filter all. I think we should treat like `FilterFn`.",404140953,2016-03-11 04:20:29
12689773,7111,55744075,25,"let's change this to `scalding.hashjoin.autoforceright` : if true, scalding will guess when to try to force to disk before a hashjoin, if false (the default) do exactly what the user says to do.",404140953,2016-03-11 04:26:19
12689773,7111,55744265,45,I think we first check that `! autoForceRight` at this point so we have a way to totally trigger the old behavior.,404140953,2016-03-11 04:27:39
12689773,7111,55744559,72,"we could look back in the `MapFn` and see if there are only filter and map parents. If there is a flatMapParent don't force, else do?

",404140953,2016-03-11 04:29:55
12689773,7111,55744928,92,"does
```scala
TypedPipe.from(TypedTsv[(Int, Int)](""input1"").group.foldLeft(0)(_ + _)
```
not work here? I don't care much about the fields API. Let's test the typed API.",404140953,2016-03-11 04:32:58
12689773,6636815,55749261,74,"yes, that makes sense. ",404140953,2016-03-11 05:05:55
12689773,6636815,55751372,25,"sounds good, done",404140953,2016-03-11 05:20:56
12689773,6636815,55751677,45,done,404140953,2016-03-11 05:22:59
12689773,6636815,55756758,92,"Hmm seems like the line you've listed does not create an `Every` pipe. I end up with an Each -> source Pipe. Not super familiar with this but from what I can make out debugging, seems like when we do typedPipe.group we end up with a Grouped object instead",404140953,2016-03-11 05:58:47
12689773,6636815,55766322,72,"Actually, I’m wondering now that we have the top level autoForceRight toggle, if it makes sense in HashJoinable.canSkipEachOperation to just say forceToDisk for map & flatmap. That way we end up skipping force to disk when we definitively know the work / ",404140953,2016-03-11 07:15:47
12689773,814892,55852266,52,"If the parent pipe does not exist, this will return false. We still want to skip in that case though right? Should this be `forall`?",404770258,2016-03-12 00:27:12
12689773,7111,55865859,52,"Good question. This relies on the fact that there is at least on `Each` on all pipes in a TypedPipe to do the work of pulling from cascading Tuple to scala type.

@piyushnarang when do you see more that one previous? Is that only on a splice?",404770258,2016-03-12 02:13:59
12689773,6636815,55875492,52,"Based on my limited understanding of this, it seems as though we shouldn't end up with an Each without an previous Pipe. Can we say that's true (or am I missing something)? 

Regarding the case with two previous pipes - I don't think I've encountered a ",404770258,2016-03-12 03:23:36
12689773,7111,55883189,52,That sounds good to me.,404770258,2016-03-12 04:19:51
12689773,814892,55885681,52,:+1: ,404770258,2016-03-12 04:41:44
12689773,622449,55900121,30,maybe call this `forceToDiskIfNecessary` or something like that?,405297256,2016-03-12 06:42:39
12689773,6636815,55907773,30,"sure, will update",405297256,2016-03-12 08:13:15
12805269,319889,55109487,22,Can only enter an implicit class if you meet all of its criteria,401237402,2016-03-05 08:40:35
12805269,319889,55109523,75,"Once you do, your bound to its method, so the lower priority TypedPipe only being the requirement here means this one is always available. So the errors remain the same if users don't have the implicits for this method for instance",401237402,2016-03-05 08:41:23
12805269,7111,55110279,22,"can we drop `T` entirely here and just do `(K, V)`?",401237402,2016-03-05 08:55:46
12805269,7111,55110457,22,"can we just do `SketchJoinMethods` similar to https://github.com/twitter/scalding/blob/ianoc/addSketchOrderedSerializationInterface/scalding-core/src/main/scala/com/twitter/scalding/typed/TypedPipe.scala#L92 so we can fix `(K, V)` and simpify a bit",401237402,2016-03-05 08:59:29
12805269,319889,55110425,22,Looks like the tests here pass with that yep,401237402,2016-03-05 08:58:53
12805269,319889,55110642,22,"We can put the classes somewhere else, but I think to keep the same sort of source feel/compatibility we need this low priority implicit stuff to fall back to the old one. If we would be happy to make it disappear in the event of no matching signature i t",401237402,2016-03-05 09:02:49
12805269,814892,57756053,49,This job looks unused in the test specs below.,401248099,2016-03-29 23:39:57
13221285,7111,56912410,14,"can we put this in a new key and keep the old one for people that might what to read those keys?

It it nice for human debugging and cheap to add a new key.",410954177,2016-03-22 06:01:45
13234470,7111,57090772,13,let's not have this,411594420,2016-03-23 07:00:35
13234470,81366,57130895,13,"Uncommented. It would be failing even if I would remove the comment, but then the validness of the test would depend on that implicit tz on the top level (which someone someday might decide to remove, rendering my test trivial). ",411594420,2016-03-23 16:39:12
13404003,814892,57750416,80,.forall passes if the Option is empty. Should this be .exists?,415136883,2016-03-29 23:05:58
13404003,814892,57750744,23,Maybe make this private [scalding] ?,415136883,2016-03-29 23:07:58
13404003,401065,57756278,80,Oh wow good point. Will change.,415136883,2016-03-29 23:41:12
13404003,622449,57977961,73,"you can use the intercept helper here, eg:
```
val e = intercept[FlowException] {  
  HadoopPlatformJobTest....run
}
```",415715728,2016-03-31 05:58:27
13404003,7111,58096603,73,"do you want this change, or just a note? To me, using the standard Try here is not so bad, and requires less scalatest knowledge.",415715728,2016-04-01 00:46:13
13404003,7111,58096963,80,can we have an assert in here? otherwise scalatest won't count it in the test count.,415715728,2016-04-01 00:48:21
13404003,622449,58105421,73,"well, it changes it from:

```
val result = Try {
  HadoopPlatformJobTest(new ReadPathJob(_), cluster)
    .arg(""input"", ""/sploop/boop/doopity/doo/"")
    .run
}

result match {
  case Failure(fe: FlowException) if Option(fe.getCause).exists(_.is",415715728,2016-04-01 01:38:34
13498790,622449,58121633,40,probably a bad name,417158081,2016-04-01 03:26:00
13498790,7111,58130394,65,we use reflection to create these. Why not just leave it as is? Sometimes people get confused with reflection and objects because their name (due to mangling) is not always clear.,417158081,2016-04-01 04:25:49
13498790,622449,58136883,65,yeah that's fine.,417158081,2016-04-01 05:15:34
13498790,1847115,58158277,8,"100K seems way too many, no? Pig's max is 999.",417314962,2016-04-01 10:23:15
13498790,1847115,58158447,29,"Do you want to throw here or just cap it at the max? I would prefer to cap it to the max, or at least add a flag to change that behavior.",417314962,2016-04-01 10:26:39
13498790,622449,58159778,8,"Yeah I have no idea. I guess I can spot check some jobs in our hadoop cluster.
But if you can have 30k mappers, why not 30k reducers? and if 30k is somewhat normal, then 100k isn't that far off in terms of being ""way too much""

I don't know whether pig",417314962,2016-04-01 10:55:16
13498790,622449,58159899,29,"We had talked about this internally I think. Pig just caps at 999. The result is that almost all jobs ran with 999. The job that stumbled across this bug and got us to think about fixing things was found sort of by accident, if it had thrown an exception ",417314962,2016-04-01 10:57:09
13498790,622449,58159931,5,"you can ignore this file, it got hit by the auto-formatter. ",417314962,2016-04-01 10:57:48
13498790,1847115,58160445,8,"One reason I can think of - too many reducers equals too many files. 

Yeah, I don't know the historic reason for 999 reducer. I think Hive has the same too.",417314962,2016-04-01 11:10:29
13498790,1847115,58160508,29,"Yeah, although it is not ideal behavior from the standpoint of a user. So if there is a bug, it ends up paging the user, not the developers of the reducer estimator. In this case, failing fast would be a bad user experience IMO.",417314962,2016-04-01 11:12:13
13498790,7706318,58164417,29,"Yes, let's not throw an exception to the user.

I don't think all kinds of cluster sizes can converge to one suitable default value for max number of reducers. As such I believe, we should have max number of reducers <= max number of mappers, presuming ",417314962,2016-04-01 12:45:51
13498790,1443419,58164700,29,"I too prefer not to fail jobs. As for max, I suggest theoretical max mappers / 5. We could set  it 10000 for clusters with 50K-split jobs. Anyways I am not worried too much of the default in the code here because I expect we'll configure it explicitly for",417314962,2016-04-01 12:52:16
13498790,7706318,58165834,29,"Thanks Gera! In the context of layering of estimator, it is done at a higher level like Scalding or Pig since they can query for the historical runs and thereby better estimate the number of reducers for this run, which as such is right on the money. But ",417314962,2016-04-01 13:14:27
13498790,1847115,58275619,50,Is this comment still valid? Move it down maybe before you log it?,417830660,2016-04-02 05:18:50
13498790,622449,58276008,50,I guess this could be moved to below where it become -1,417830660,2016-04-02 05:23:20
13498790,814892,58421326,71,This could go in an if-else block above?,417836776,2016-04-05 01:15:20
14093209,7111,60685006,38,did this fail without this patch?,431490564,2016-04-22 09:45:05
14093209,2221968,60686283,38,"Yeah the breaking point varied (and could change within the life of a process), but hits rather consistently.

Against clean develop, all actually die on `hashCode`:
```
[info] Exception encountered when attempting to run a suite with class name: com.",431490564,2016-04-22 10:11:13
14093209,7111,60686973,38,"To be clear: if we override hashCode to be eager (e.g. a `val`), would this solve the problem?

Is that what you meant by fix just that problem?",431490564,2016-04-22 10:25:15
14093209,2221968,60712150,38,"It won't solve the problem, and it is indeed what I meant for the last part.  We (still) see the latter error if we (only) override hashCode to be eager.",431490564,2016-04-22 16:21:17
14093209,7111,60758429,222,"I don't think you are caching here. A second run, if the user makes an Execution that is different would not be cached.

Can we do:
```scala
Trampoline(cache.getOrElseInsert(conf, this, {
   val (uid, nextConf) = conf.ensureUniqueId
   Trampoline.ca",431490564,2016-04-22 22:35:21
14093209,2221968,60770638,222,"Ah, of course.  I guess it would be possible then to still blow the stack via nested `withId`.  That could be addressed by having an ID map/cache, but maybe that's overkill for a relatively contrived use case?",431490564,2016-04-23 00:01:35
14093209,7111,60819586,33,"can we add a test that this is still working like normal case class equality and hashCode?

For instance, `val e1 = Execution.from(1); val e2 = Execution.from(2); e1.zip(e2).hashCode == e1.zip(e2).hashCode`.

I'm worried this could break caching if so",432048572,2016-04-23 07:55:12
14093209,2221968,61000467,33,"You're correct that this currently defers to `Object`, so it breaks caching.  In theory we could build custom `hashCode`s on each subclass and make it a val, but I don't feel great about that approach.",432048572,2016-04-26 05:24:04
14093209,7111,61011864,33,"can't we just manually add a strict hashCode on all the subclasses that take `Executions`? That will stop it from recursing forever, right?

Of course, it does not address equality checks (but this PR didn't do that anyway).",432048572,2016-04-26 07:13:30
14093209,7111,61012069,33,"so, `Mapped, FlatMapped, Zipped, OnComplete` would have strict `hashCode` that calls `p, but the others would not need it? We could just call this: https://github.com/scala/scala/blob/2.12.x/src/library/scala/runtime/ScalaRunTime.scala#L145 and store it i",432048572,2016-04-26 07:16:04
14093209,2221968,61013711,33,"Yeah, that's what I meant (not sure if ""strict"" means something other than eager/val).

And `ScalaRunTime._hashCode` seems to be exactly what we want here.  All of the subclasses are `Product` anyway; so maybe it could stay in the base trait too.",432048572,2016-04-26 07:36:26
14093209,7111,61016375,33,"yeah, using `lazy val hashCode = ScalaRunTime._hashCode(this)` might work. I'm nervous about putting a `val` there due to init order bugs.

Yes, by `strict` I meant eager/val or even lazy val (which means strict is bad terminology to use). Just don't wa",432048572,2016-04-26 08:17:31
14093209,2221968,61021987,33,"Looking into this further, there are actually a few other obstacles to having this work.  For example, even `Execution.from(5)` is going to create a closure object, and multiple calls won't make things that are ""equal""; on develop:

```
scala> Executio",432048572,2016-04-26 09:47:48
14093209,7111,61128293,33,"@jnievelt any time we have call-by-name, equality is not going to work, but we only use call-by-name in a couple of places. In your example, we are just forcing the `Try` which, if we are going to do that, why make it call by name?

The idea was that ca",432048572,2016-04-27 00:28:30
14093209,2221968,61131501,33,"Ah, of course.  It's perhaps an argument for const semantics, but I suppose that's getting well out of the immediate scope.",432048572,2016-04-27 00:46:05
14093209,2221968,61187357,33,"Okay, reworked this with `ScalaRunTime`, also to preserve the `hashCode`/`equals` contract.  Note that I've introduced a few more bits to expand the cases where we can reconstruct and achieve equality.

Also added a bunch of tests around reconstruction ",432048572,2016-04-27 07:28:22
14093209,7111,61192041,293,"what's the motivation here?
",434485546,2016-04-27 08:33:48
14093209,7111,61192421,312,"a note, you could, like you have with `nil` make `val cons = { p: ((Any, List[Any])) => (p._1) :: (p_.2) }` then cast it to `Function1[(T, List[T]), T]` with `def seqFn[T] = cons.asInstanceOf[((T, List[T])) => List[T]]`. This won't fail on the jvm due to ",434485546,2016-04-27 08:36:36
14093209,2221968,61193051,293,"If we leave the anonymous closure, we won't get equality/etc.  So even for a fixed sequence, we won't have `Execution.sequence(a) == Execution.sequence(a)`.  As I'm sure you'd imagine, the same principle is behind `ReversingFn` and `nil`.

This does hav",434485546,2016-04-27 08:46:54
14093209,7111,61193959,293,"I see, yours actually does the same as mine without casting due to the way equals works on case classes.

That's better (casts are ugly).",434485546,2016-04-27 09:00:07
14239652,7111,61362020,22,"explicit return is generally avoided in scala (makes the code harder to read).

Can we just add an `else { }` for the rest of the code or put that block into a private method and call it there?",434579712,2016-04-28 08:11:33
14396082,7111,61825282,94,this should be \`percent\` I think.,437956014,2016-05-03 07:10:02
14396082,7111,61825493,135,is this change really in this branch? Same with other `[cascading3]`,437956014,2016-05-03 07:13:03
14396082,6636815,61825944,135,looks like they're not. Removed them,437956014,2016-05-03 07:20:00
14396082,6636815,61825921,94,fixed,437956014,2016-05-03 07:19:39
14408007,2221968,61891266,32,This should be updated (or removed),438174024,2016-05-03 21:34:28
14433484,7111,61935970,34,"can we change this to:
```scala
if ($rsTerm.wasNull) null else { val $valueTerm = $primitiveGetter; $boxed }
```
do we need the `primitiveGetter` in the null case?",438647776,2016-05-04 01:56:27
14433484,814892,61938281,34,The contract here is a little weird. The java.sql.ResultSet getter needs to be called first for the wasNull call to then say correctly if the value we just read was null in the database or not. Added a comment to clarify that.,438647776,2016-05-04 02:11:24
14433484,7111,61938736,34,"ahh, that is confusing.

Glad we have some clean scala macros to hide all this! :) Nice work.",438647776,2016-05-04 02:14:36
14439566,319889,61978131,3,i think this should just be 0.16.1 ? ,438699230,2016-05-04 07:26:26
14439566,7111,61978244,3,Agree with Ian maybe (0.16.1-SNAPSHOT),438699230,2016-05-04 07:28:12
14439566,6636815,61979350,3,"ok, updated due to popular demand.",438699230,2016-05-04 07:44:16
14462313,7111,62099988,19,"generally looks good, only anxiety is lack of unit tests on this and the fact this has been here for years (and it is not in the critical path of perf).",439202047,2016-05-05 02:31:54
14462313,1240572,62188713,19,Not sure I follow - isn't this code already covered by [these unit tests](https://github.com/fgcallari/scalding/blob/develop/scalding-commons/src/test/java/com/twitter/scalding/commons/datastores/VersionedStoreTest.java)? One of them even uses a HashSet a,439202047,2016-05-05 20:47:47
14462313,7111,62275282,19,"Well, I'll be. :) We just copied this code in and I assumed like much of the source code it lacked tests. :)

Looks good to me. 

Thanks for the clean up!",439202047,2016-05-06 07:17:48
14526816,6636815,62396699,32,"rename p1 to hashJoinPipe and p2 to hashJoinOperandPipe (or something on those lines?). Tends to be hard to keep track of p1, p2..",440677507,2016-05-07 04:59:27
14526816,814892,62532274,32,renamed,440677507,2016-05-09 23:50:40
14680328,7111,63218878,14,PS: i'm actually not even sure we need `finish` anymore. That was just a type trick that I think is not needed with Scalatest. ? Can to try just removing a few and seeing that it still compiles and tests?,443328364,2016-05-14 00:18:27
14680328,7111,63219113,23,note this has no `finish`.,443328364,2016-05-14 00:20:04
15188683,814892,65640589,5,Just curious why this was flagged?,456563487,2016-06-03 07:16:20
15188683,814892,65640821,5,Looks like the return type is Try[Unit] and def error returns a Failure. Should this stay unchanged? ,456563487,2016-06-03 07:19:39
15188683,7111,65792806,5,"the linter does not like ranges with floats. I think this is the same logic, but maybe side steps some confusing cases with float ranges (not that anyone uses that code).",456563487,2016-06-04 07:23:03
15188683,7111,65792887,5,ahhh This was a bug!!!! Our error was out of scope here so it was hitting `Predef.error` which is not what we intended!  :),456563487,2016-06-04 07:25:05
15410740,814892,66678920,4,So this was being used just to form type aliases before? Was this some macro workaround that's no longer needed? ,462636114,2016-06-11 03:49:44
15410740,814892,66680026,51,innerDispatcher seems unused. Should that be chained here?,462636114,2016-06-11 03:58:30
15410740,814892,66681046,51,Ah nevermind. I see it being call from baseScroogeDispatcher,462636114,2016-06-11 04:06:15
15410740,319889,66681601,4,"It was being used to block infinite recursion on the implicit. So instead of asking for type X, you as for the alias, and then the macros could see you were looking for an alias and would nop out of it. But if we just only use the implicit code paths on i",462636114,2016-06-11 04:10:54
15410740,814892,66681702,30,Is val scroogeDispatcher consumed anywhere?,462636114,2016-06-11 04:11:34
15410740,319889,66684062,30,"Not that I can see, killing",462636114,2016-06-11 04:32:05
16114603,814892,74091931,31,Is this the right expression to use? IP icked this up form the pre-existing HashJoin rules in https://github.com/cwensel/cascading/tree/wip-3.1/cascading-hadoop/src/main/shared/cascading/flow/hadoop/planner/rule/expression,488109843,2016-08-09 23:19:18
16114603,814892,74092078,37,This currently does not ignore HashJoins that are self-joins iiuc.,488109843,2016-08-09 23:20:03
16114603,44695,74097822,72,the return value is not getting assigned.,488109843,2016-08-09 23:51:47
16114603,44695,74098089,31,"It should be, running the Cascading platform tests would confirm this.",488109843,2016-08-09 23:53:01
16114603,44695,74098462,37,You might make the match class TempHfs if the rule is last in the phase. This would also simplify the factory logic.,488109843,2016-08-09 23:55:00
16114603,7111,74813829,29,"could this string be anything, or does it have to have some form?",491528758,2016-08-16 01:56:08
16114603,6636815,74815458,29,Seems to be the convention for entries added to the `ruleRegistry` - https://github.com/cwensel/cascading/blob/wip-3.2/cascading-hadoop2-tez/src/main/java/cascading/flow/tez/planner/Hadoop2TezPlanner.java#L161. Those two also start with `cascading.registr,491528758,2016-08-16 02:05:47
16114603,6636815,75022096,37,"Chris, do you mean something like:
```
super(
      new SyncPipeExpressionGraph(),
      new ExpressionGraph()
        .arc(
          new FlowElementExpression(ElementCapture.Primary, TempHfs.class),
          PathScopeExpression.BLOCKING,
      ",488109843,2016-08-17 04:17:42
16114603,44695,75032136,37,"yeah, that should do it. Now the factory doesn't have to do so much work. But make this the last rule in the phase.",488109843,2016-08-17 05:23:50
16172191,11097008,163985877,5,"@piyushnarang looks like the package name does not match the file name. not scrooge/cascading, but we have cascading.scrooge.",898596776,2018-01-26 06:22:06
16172191,6636815,163993376,5,I can push a follow up fix for this tomorrow. ,898596776,2018-01-26 06:57:59
16552738,7111,76296263,18,"I'm a bit worried about `T: Ordering` here. This will have the `Ordering` serialized with each edge, sadly. Can we move the `T: Ordering` to methods that actually require an ordering?",482465514,2016-08-26 01:13:03
16552738,7111,76296336,18,same comment about `T: Ordering`,482465514,2016-08-26 01:13:25
16552738,7111,76296462,20,why do we need this? Seems like spark cargocult.,482465514,2016-08-26 01:14:08
16552738,7111,76296612,22,given that this has an `Ordering[T]` I don't think you need each `Edge` or `Vertex` to.,482465514,2016-08-26 01:14:54
16552738,7111,76299365,83,"should we not keep the previous label? Make this return `Graph[T, S, (Q, Neighbors[T])]`?

Also, I don't like the sorting. If you want to sort, can't we just mapVertices at effectively the same cost?",482465514,2016-08-26 01:29:17
16552738,7111,76299936,18,"should not have an implicit `Ordering`.

You should do:
```scala
object Vertex {
  implicit def ordering[T: Ordering, S: Ordering]: Ordering[Vertex[T, S]] = ...
}
```
I am not a fan of saying two things are equal in an ordering, but they have diff",482465514,2016-08-26 01:32:23
16552738,7111,76300050,106,can't the above call this one and just `mapVertices` and a `mapAttr` on `Vertex`?,482465514,2016-08-26 01:33:03
16552738,7111,76300092,132,same sort comment. Move that to a method on `Neighbors`.,482465514,2016-08-26 01:33:21
16552738,7111,76300290,156,why not filter before the distinct? Can't that save time?,482465514,2016-08-26 01:34:37
16552738,7111,76300510,186,why do we need `ClassTag`?,482465514,2016-08-26 01:35:56
16552738,7111,76300631,220,let's not use `ClassTag`.,482465514,2016-08-26 01:36:33
16552738,7111,76300769,22,"let's take `Ordering` in the methods that use it, not on the class.",482465514,2016-08-26 01:37:20
16552738,7111,76301073,19,why an `Array` here and not `Set[T]` or `Vector[T]`? Why do we need the mutation?,482465514,2016-08-26 01:39:01
16552738,7111,76301178,65,this needs legit tests complete with scalacheck.,482465514,2016-08-26 01:39:45
16552738,1852479,76309688,18,"Sure, never really thought about the overhead of ordering but it could probably be pretty large.",482465514,2016-08-26 02:32:05
16552738,1852479,76310160,83,"Thats a good point.  I put sort there because Neighbors has two subclasses, one called Sorted and Unsorted.  This code is coming from a branch where I was doing lots of work with Neighbor intersection where being sorted has a huge advantage and have a typ",482465514,2016-08-26 02:35:18
16552738,1852479,76310997,19,"Don't need mutation but what is really important here is the least amount of memory overhead for the Neighbors.  Moving from Set -> Array saves a lot of memory.  Does Vector have memory characteristics close to native arrays?

Also about the classtags a",482465514,2016-08-26 02:40:44
16552738,7111,76326395,19,can we move the `ClassTag` closer to where it is used so we don't pay that cost everywhere?,482465514,2016-08-26 04:17:13
16676800,622449,77106367,18,"This isn't quite right is it? The partition key needs to be exposed right?
how about:

```
val data: TypedPipe[MyScroogeObject] = ???
data.map { obj => 
  ((obj.country, obj.city), obj) 
}.write(PartitionedParquetScroogeSource[(String, String), MyS",502984112,2016-09-01 09:35:30
16676800,622449,77106425,26,"for reads, is it required that P be a String or a TupleN of Strings? Seems like it'd have to be?",502984112,2016-09-01 09:36:23
16676800,622449,77107202,32,is this the TBase reader? should be able to use the scrooge reader here right?,502984112,2016-09-01 09:50:24
16676800,6636815,77221735,18,"Yep, missed the map step there. Updated in the partitioned scrooge + thrift src docs. ",502984112,2016-09-02 00:53:13
16676800,6636815,77221930,26,"Can also be a string (if its just ""%s""). If you see the unit tests, there P ends up being a String. ",502984112,2016-09-02 00:54:14
16676800,6636815,77222911,32,Yeah this is the TBase reader. Can try and hook up the scrooge reader. Do you want to use the scrooge reader in both the partitioned thrift & partitioned scrooge tests?,502984112,2016-09-02 00:59:02
16676800,6636815,77223575,26,Wonder if we should clarify that in the docs? Could add an example for the %s case cause it isn't a tuple?,502984112,2016-09-02 01:03:03
16676800,622449,77254737,26,so P must be either: String or tuple of Strings right? That'd be good to clarify.,502984112,2016-09-02 04:12:07
16676800,622449,77254809,32,"sorry I misread, didn't realize this was the thrift test not the scrooge test",502984112,2016-09-02 04:12:29
16676800,6636815,77257201,32,"Ok, so I updated the scrooge test to use the scrooge reader. Left this one as is",502984112,2016-09-02 04:27:30
16676800,622449,77257424,32,"cool, can you update the docs to explain the requirements on P being a String or tuple of Strings? I guess that might not be true if you provide a different TupleSetter, but at least taht part should be clarified too (that P and the TupleSetter need to ma",502984112,2016-09-02 04:28:50
16676800,6636815,77257122,26,"Ok, I'll update the docs to indicate this and also include an example ",502984112,2016-09-02 04:26:58
16676800,7111,78260822,26,"is it possible, maybe a geek out, to have a macro that checks the format string at compile time?

this would allow it to be really clear that the string matches the tuple type?",502984112,2016-09-10 05:55:52
16676800,7111,78260918,32,can we remove `fields` and `Manifest[T]`? Manifest is deprecated. And we really try to focus on the typed API now.,505223526,2016-09-10 05:56:55
16676800,6636815,78263758,32,"Hmm, seems like both were required based on the traits I was mixing in. 
Manifest[T] as we're mixing in [ParquetThriftBase](https://github.com/twitter/scalding/blob/develop/scalding-parquet/src/main/scala/com/twitter/scalding/parquet/thrift/ParquetThrift",505223526,2016-09-10 06:37:21
16676800,6636815,78264428,26,I can look into this. Not super familiar with Scala macros so this can be a learning opportunity :-). Currently we do check this (at runtime though) - in [TemplatePartition](https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com,502984112,2016-09-10 06:47:51
16676800,6636815,78264497,26,"So if you do something like:
```
val partitionSource = PartitionedParquetScroogeSource[String, Address](path, ""%s/%s"") // should be just %s

you get an error:
assertion failed: Number of partition fields '1' does not correspond to template (%s/%s)
j",502984112,2016-09-10 06:49:01
16676800,7111,78264803,32,"can't we always fix given `Fields` to be `PartitionUtil.toFields(0, implicitly[TupleSetter[T]].arity))`? Also, can we fix `ParquetThriftBase`?

I don't want to confuse users with parameters they should really never change.",505223526,2016-09-10 06:54:33
16676800,7111,78264862,26,"yeah, it would be nice to just call the code cascading uses to verify it at compile time.",502984112,2016-09-10 06:55:42
16676800,6636815,78264939,26,"Ok, I'll dig into this",502984112,2016-09-10 06:56:59
16676800,6636815,78267367,32,Yeah can set Fields to that. Can override it in PartitionedParquetScroogeSource and PartitionedParquetThriftSource unless you'd rather have it set in PartitionSchemed and not exposed to PartitionedParquet{Scrooge|Thrift}Source and PartitionedDelimitedSour,505223526,2016-09-10 07:55:09
16676800,7111,78270712,32,"Yeah, any new code should certainly not expose it. How much to remove/lock
down of old code is a question.
On Fri, Sep 9, 2016 at 14:55 Piyush Narang <notifications@github.com> wrote:

> In
> scalding-parquet-scrooge/src/main/scala/com/twitter/scalding/pa",505223526,2016-09-10 11:08:33
16676800,7111,79052543,17,why are we accepting `ct` as a parameter if we already have it on line 40?,513498943,2016-09-16 03:20:12
16676800,7111,79053377,19,can't we just do `val clazz = ct.runtimeClass.asInstanceOf[Class[T]]` here,513498943,2016-09-16 03:24:24
16676800,6636815,79057719,19,"Hmm yeah, that's cleaner. ",513498943,2016-09-16 03:45:20
16676800,6636815,79057999,17,"Shall remove this, added this on one of my prior passes over the code when I was seeing some compile errors. Not needed anymore. ",513498943,2016-09-16 03:46:45
16927960,7111,78261073,26,"why are you deleting the method? Generally, unless we really need to, it is nice to keep things around and not break compatibility.",509554721,2016-09-10 05:58:49
16927960,7111,78261288,41,"this is a bit wild. So we are explicitly changing the result of a function that we had tested.

One wonders if anyone will be hit by this. I think that empty with _SUCCESS should be okay, I think. Without _SUCCESS, I would say no.",509554721,2016-09-10 06:01:43
16927960,622449,80539264,26,"We can keep it, but it's not useful. I need to check, but it might be hard to keep it and have it retains it's old behavior.",509554721,2016-09-27 01:21:05
16927960,622449,80540095,41,"So, SuccessFileSource had a very complicated pathIsGood contract, and we had some (but not complete) tests to verify that contract, including its oddities that were maybe not desirable but were part of the contract, and we did encode them as tests (which ",509554721,2016-09-27 01:24:53
16927960,7111,80545328,41,agree it is a broken window.,509554721,2016-09-27 01:49:13
16927960,7111,80546998,41,"I agree this is a better contract. Basically, `_SUCCESS` should imply the path is good. This whole jank was about cases where there was no `_SUCCESS` and it was a crazy attempt to at least warn on totally missing data (mostly for people that had job sched",509554721,2016-09-27 01:57:01
16927960,7111,80546747,136,"what is the `<ticket>` Can we add some examples of how this is broken and even warn people off of the whole design?

Ideally, we want this sanity checking in the mappers, I think. And we fail the tasks if they can't read the data. But this is getting at",509554721,2016-09-27 01:55:43
16927960,7111,80546359,96,"can we change this to:
```scala
taps match {
  case  Nil => new IterableSource[Any](Nil).createTap(Read)(hdfsMode).asInstanceOf[Tap[JobConf, _, _]]
  case one :: Nil => one
  case many => new ScaldingMultiSourceTap(many)
}
```
rather than using si",509554721,2016-09-27 01:53:46
16927960,622449,80779829,96,sure,509554721,2016-09-28 02:54:48
16927960,622449,80781617,136,"well, if you supply the glob: `a/b/c/{x,y,z}` it is clear to a human that you expect x, y, and z to all exist and have SUCCESS files. But actually, what happens is:

1) If only one of {x,y,z} exists, and it has a success file, we will call this ""good"" b",509554721,2016-09-28 03:03:26
16927960,622449,80825558,26,"How strongly do you feel about keeping this method? It probably should not have been public, and I think it's functionality has been removed.",509554721,2016-09-28 07:45:46
17009017,401065,78608100,18,`.sum` only requires associativity?,511503071,2016-09-14 00:39:34
17009017,401065,78608269,18,"Oh right, this uses a `Semigroup`. NVM.",511503071,2016-09-14 00:40:29
17395839,7111,80778495,35,what is this doing here?,520746861,2016-09-28 02:47:39
17395839,7111,80779602,73,can we write `case None` to be explicit?,520746861,2016-09-28 02:53:39
17395839,6636815,80781458,35,just got rid of the variable here as it wasn't used and was showing up as a warning in intellij,520746861,2016-09-28 03:02:37
17395839,6636815,80781502,73,"yep, can do that. ",520746861,2016-09-28 03:02:46
17395839,7111,80782972,35,"yeah, but `implicitly[Foo]` without keeping the response is not doing anything. Why not just remove the line?",520746861,2016-09-28 03:10:11
17395839,6636815,80784089,35,yeah that's true. Got rid of this one and the other one as the test seems to pass without them. ,520746861,2016-09-28 03:15:20
17471231,7111,81257760,5,"I *think* these are blackbox macros, or should be.",521379970,2016-09-30 06:48:11
17471231,7111,81257564,4,why is it safe to remove this?,521379970,2016-09-30 06:46:24
17471231,7111,81257504,28,"are you sure this works? Unfortunately, I think this may be untested. If you want to change this code, we should point to the test.

I'm nervous about changing untested code without adding tests.",521379970,2016-09-30 06:45:52
17471231,31250964,81263689,4,"Because the original call to the method doesn't do anything.

```
  /**
   * Originally intended to enable symlinks, but currently symlinks cannot be
   * disabled. This is a NO-OP.
   * @param conf the jobconf
   * @deprecated This is a NO-OP. 
 ",521379970,2016-09-30 07:51:32
17471231,31250964,81263848,5,"It's whitebox macros because this is how the original Context being implemented.

```
package object macros {
  /** The Scala macros context.
   *
   *  In Scala 2.11, macros that were once the one are split into blackbox and whitebox macros,
   * ",521379970,2016-09-30 07:53:46
17471231,31250964,81263958,28,"You are right.

I will look into adding a new test or modifying the existing test.",521379970,2016-09-30 07:55:18
17471231,7111,81606321,4,"I wonder if on older versions of hadoop it did something, and so some users will have a bad experience after this.",521379970,2016-10-04 01:07:22
17471231,7111,81606149,10,why not move this directly to be inside complete? Why keep the indirection at all?,523356710,2016-10-04 01:06:26
17471231,31250964,81870885,10,"I hesitated to inline the method because I am not sure if the code is used by any client code, as `com.twitter.scalding.FoldAggregator.emit` seems to be a public method.

Moreover, the original emit method could have been inlined as well, but hadn't. So",523356710,2016-10-05 05:51:43
17471231,31250964,81872438,4,"HDistributedCache.createSymlink is from hadoop-mapreduce-client-core-2.5.0.jar

We have specified the below version dependency on hadoop in build.sbt for our version of Scalding: 
> val hadoopVersion = ""2.5.0""

Do we need to maintain backward compati",521379970,2016-10-05 06:03:49
17471231,622449,81873412,14,"can we avoid two calls to getFileSystem(conf) ?
",523356710,2016-10-05 06:12:10
17471231,622449,81873205,5,what warning does this fix? this is going from hmm.apply to hmm.create -- are they the same?,523356710,2016-10-05 06:10:20
17471231,7111,81873518,4,"yes we do generally try to maximize compatibility because upgrading hadoop is a painful process. When it is easy, we try to maximize compatibility.",521379970,2016-10-05 06:13:04
17471231,7111,81873397,10,"well, you have changed the signature, so any old callers are broken. Keeping it with a new signature does not reduce breakage.

Let's not assume we have a hidden reason if there is no comment and no broken test with improving the code.",523356710,2016-10-05 06:12:02
17471231,622449,81875549,4,I guess we need to find out if this method ever did anything. Maybe it never did.,521379970,2016-10-05 06:30:41
17471231,31250964,81887304,14,"Good catch.
Fixed.",523356710,2016-10-05 08:32:54
17471231,31250964,81887606,5,"`HyperLogLogMonoid.apply` is deprecated.

Here's the definition: `def apply[T <% Array[Byte]](t: T) = create(t)`",523356710,2016-10-05 08:37:02
17471231,31250964,81890014,4,"Here's a complete history of HDistributedCache:

> * 23c3ff8 - HADOOP-13209. replace slaves with workers (John Smith via aw) (3 months ago) <Allen Wittenauer>
> * 605b4b6 - MAPREDUCE-6719. The list of -libjars archives should be replaced with a wildcar",521379970,2016-10-05 09:06:34
17471231,31250964,81887694,10,"Sure.
Will do the inlining.",523356710,2016-10-05 08:38:17
17471231,7111,82024063,20,"note, we generally don't do a type annotation, especially if we need an import to do so, when it is not returned from a public method.",525258532,2016-10-06 00:18:11
17471231,7111,82024227,4,"yeah, I think 4 years is good enough.",521379970,2016-10-06 00:19:00
17471231,622449,82084213,4,"yeah, sounds good to me ",521379970,2016-10-06 05:23:42
17471231,31250964,82084890,20,"Sure.
Will follow the project convention and remove the FileSystem annotation.",525258532,2016-10-06 05:28:49
17471231,622449,82084292,5,thanks,523356710,2016-10-06 05:24:12
17585691,814892,81585490,24,"I think one issue here might be that this can add more Checkpoints compared to the earlier version that uses `reduce`. (If we've already added a checkpoint to `left`, then we do not need another per `isHashJoinedWithPipe`)",525107738,2016-10-03 23:23:13
17585691,6636815,81859463,36,"this method seems a bit hard to understand. Trying to think of the best way we can refactor to make it more readable. Could we break it up into smaller methods with more descriptive names?
We have a few nested methods and checks in here, we could refacto",525107757,2016-10-05 04:36:38
17585691,6636815,81847910,3,"Wondering if we can this this comment block to the top of the function / match statement? It's not really specific to the hashJoin case. 
Would also be nice to add a comment on the hashJoin case on why its being handled differently for folks reading the ",525107757,2016-10-05 03:36:46
17585691,6636815,81852734,23,no need to set to val prepared as we're returning in the next line?,525107757,2016-10-05 04:00:16
17585691,7111,81870640,23,+1,525107757,2016-10-05 05:49:53
17585691,7111,81871990,5,can we remove this. Generally unneeded.,525107757,2016-10-05 05:59:50
17585691,7111,81873215,40,"so, basically we are building a directed graph: `a -> b` if `a isHashJoinedWith b`. Then pipes with no edges are in the uncolliding set.

Then, we need to deal with the colliding set. For that, we just checkpoint all the colliding nodes, then do one big",525107757,2016-10-05 06:10:25
17585691,7111,81871463,40,instead of `.find(fn(_).isDefined)` can we use `.exists(fn(_))`?,525107757,2016-10-05 05:55:19
17585691,1202170,81923376,23,a relic from a debugging session; done.,525107757,2016-10-05 15:29:19
17585691,1202170,81925854,36,"Yep, I'll try to tidy this up. I was initially fearing I needed recursion, and aimed for tailrec (which I couldn't achieve). 
Now planning to break ```val safedColliding = match``` as a ```resolveCollidingHalf(colliding)``` method, but unsure how far dow",525107757,2016-10-05 15:43:40
17585691,1202170,81928261,40,"Not sure. I initially needed recursion to deal with more complex examples, until I ended up splitting the ```case other @ (hj: HashJoin) =>``` case in  getChainOfEachs(). 
Now I need to verify whether the recursion still ever does anything (I suspect tha",525107757,2016-10-05 15:57:57
17585691,1202170,81953014,40,"OK, I tried something. Now outputs ```new Merge(new Merge(a,c), b, d)``` in the example, still passes the Complex and the Twisted tests",525107757,2016-10-05 18:35:20
17585691,7111,82109744,34,"can we use private rather than protected? Also, these are all really static methods, right? Can we move them to an object that is `private[scalding]`? I'd rather not add them to `TypedPipe` since they seem to be working just on `Pipe`. Maybe `RichPipe`'s ",525282760,2016-10-06 09:54:25
17585691,7111,82109463,61,"can you comment why we need a checkpoint here, but not in the `else` case?",525282760,2016-10-06 09:50:45
17585691,7111,82109689,81,"don't we need to add to the `names` set? or are you relying on `assignName` to make a unique name (which I *think* it does). If so, can we comment?

Also, can we wrap this line?
```scala
if (names.contains(p.getName)) (RichPipe.assignName(p) :: result",525282760,2016-10-06 09:53:33
17585691,7111,82109435,73,"same pattern:
```scala
def merge(h1: Pipe, h2: Pipe, tail: List[Pipe]): Pipe = {
  // we know there are at least 2 pipes, so we are bound to create a merge:
  (h1 :: h2 :: tail).foldLeft(....
}
```
there is no need to consider the case where there ",525282760,2016-10-06 09:50:19
17585691,7111,82109014,48,"can we wrap:
```scala
val safedInnerUncolliding =
  if (innerUncolliding.isEmpty) Nil
  else Seq(checkpointOrMergeAvoidingNameClashes(innerUncolliding))
```",525282760,2016-10-06 09:43:07
17585691,7111,82108771,35,"can we instead of the `require` have this method take `head: Pipe, tail: List[Pipe]` then when we call we can do:
```scala
merged match {
  case Nil => sys.error(""we can never merge to create 0 pipes"")
  case h :: Nil => h
  case h :: tail => mergeAv",525282760,2016-10-06 09:39:33
17585691,7111,82109157,59,"let's take a `p: List[Pipe]` and do a pattern match:
```scala
def check(head: Pipe, tail: List[Pipe]): Pipe = tail match {
  case Nil => new Checkpoint(head)
  case h :: t => mergeAvoidingNameClashes(head, h, t) // we have at least 2
}
```",525282760,2016-10-06 09:45:26
17585691,7111,82109553,79,"Let's use `List` and `::` if order does not matter (since it is fast), where as `:+` is `O(N)` cost on `Seq`.",525282760,2016-10-06 09:51:35
17585691,1202170,82138182,35,"Uh, since the first operation is to perform a partition over (List(head) :: tail), this is going to be a little ugly, but OK",525282760,2016-10-06 15:22:37
17585691,1202170,82140518,81,"indeed, assignName generates a guaranteed unique name (which it won't ever generate again)",525282760,2016-10-06 15:36:32
17585691,1202170,82147554,61,"Turns out the Checkpoint is always necessary, which dissolves the need for ```checkpointOrMergeAvoidingNameClashes()``` entirely (I had cases where running without the checkpoint around the inner merge worked, but I couldn't always reliably rule out a vio",525282760,2016-10-06 16:18:26
17585691,7111,82265871,7,"I like this, but i wonder why not just do:
```scala
def getFormerNameBit(p: Pipe): Option[Int] = p.getName match {
  case FormerNameBitPattern(pipeNumber) => Some(pipeNumber.toInt)
  case _ => None
}
```
Then use it with: `new Pipe(s""$getNextName-""",525337988,2016-10-07 02:32:09
17585691,1202170,82269037,7,"meta: indeed (yes, riding on a PR isn't very good form). I'll move that tomorrow morning (UTC+2)
content: indeed too (pattern matching on extractors beyond Some(_) isn't yet on my toolbox' top drawer), will do it that way in the other PR.

Thanks for t",525337988,2016-10-07 02:48:26
17585691,6636815,82302934,87,do we need add the assignName(p) values to names as well?,525337988,2016-10-07 05:59:31
17585691,1202170,82349047,7,moved into https://github.com/twitter/scalding/pull/1608 ,525337988,2016-10-07 15:36:57
17585691,1202170,82350461,87,"we don't, since the result of assignName() is guaranteed unique (so it won't collide with pre-existing items from names) and will never be assigned again (so no pipe yet to be evaluated in the foldLeft will have a name that collides with the freshly-assig",525337988,2016-10-07 15:47:20
17585691,6636815,82647656,87,Yeah would be nice to reiterate with a comment to folks reading the code in the future. ,525337988,2016-10-11 00:28:09
17585691,1202170,81923234,3,"Hmm. The comment was specific to the case other @(_: Checkpoint ... SubAssembly) case, which used to cover the HashJoin case as well. 
Ideally, the comment applies to both cases (HashJoin and the other Checkpoin...SubAssembly), but not sure now how best ",525107757,2016-10-05 15:28:32
17585691,1202170,82154866,61,"Diggigng a little bit, the ""flip flop"" was due to a typo in mergeAvoidingHashes(), which sometimes (depending on random factors) led to unintentionally outputting (a,b,c,Merge(Checkpoint(d), Checkpoint(e)) 

Now the typo's fixed, we started to reliably ",525282760,2016-10-06 17:03:56
17706354,401065,82684231,13,When would we expect this?,526001491,2016-10-11 04:14:47
17706354,1202170,82768271,13,"The number would never be too long in the case of already auto-assigned names such as ""_pipe_123"" (that'd mean way much than Int.MaxValue *pipes* created within the DAG) 

However, some pipe names will not be named _pipe_123 (e.g. the input heads); thos",526001491,2016-10-11 17:53:16
17814454,1202170,82805267,24,"

The resulting object can seem quite thin now; however, as it's been part of the public scalding API, I assume it's best to keep it? It has one added value compared to c.u.TraceUtil, which is to know what are the scalding-related API boundaries.
",530855200,2016-10-11 21:29:07
18021036,622449,83975345,33,"as is, this should fail, so I'm surprised that it doesn't :(

TestEmptySource doesn't mix in SuccessFileSource, so it shouldn't be happy with an empty directory. Any idea why this isn't failing?",537155932,2016-10-19 06:55:30
18021036,6636815,83979186,33,Yeah so that's cause we're currently not calling validateTaps in the HadoopJobTest. Updated the code to mixin SuccessFileSource as well. ,537155932,2016-10-19 07:33:14
18275142,7111,85252955,5,can we not commit style changes like this on the side?,543222924,2016-10-27 08:33:48
18275142,7111,85252492,52,we try to use `scalding.Config` where possible. Can we use that instead?,543222924,2016-10-27 08:28:22
18275142,7111,85252455,48,have you tested this on the cluster? Seems like serialization woes are possible here.,543222924,2016-10-27 08:27:54
18275142,7111,85252666,52,that or make this private please.,543222924,2016-10-27 08:30:28
18275142,7111,85252971,4,can we remove this from the diff?,543222924,2016-10-27 08:33:56
18275142,7111,85252860,54,"can this take `shouldLog: Boolean` instead? And maybe make a
```scala
private def ifVerboseConf(conf: Configuration)(msg: => String): Unit =
  ifVerboreLog(verboseLogEnabled(conf))
```
to minimize exposing `Configuration` on our APIs.",543222924,2016-10-27 08:33:02
18275142,6636815,85383595,50,should we declare this in `Config`? ,543222924,2016-10-28 00:09:21
18275142,6636815,85384605,50,"maybe add a short line describing the use of this param? Add if we have a sense of the overhead it causes, that as well? ",543222924,2016-10-28 00:14:39
18275142,6636815,85384258,56,could we instead do `Thread.currentThread().getStackTrace()` ?,543222924,2016-10-28 00:12:44
18275142,622449,85410997,52,I can make it private. Is it better to use scalding.Config even if it's private? It seems that what I'll have access to is a Configuration -- does it make sense to convert that to a scalding.Config (probably not?),543222924,2016-10-28 02:36:10
18275142,622449,85411173,54,"these can actually all be private, or maybe private[scalding] -- would that be enough? ",543222924,2016-10-28 02:37:08
18275142,622449,85411340,5,"Ah, so this is what happens when you run the unit tests (scalafmt) -- I wasn't sure whether to keep this. If I don't commit this, next time someone runs the unit tests, it'll do this again. So I thought I'd just keep the changes. I can back them out thoug",543222924,2016-10-28 02:38:09
18275142,622449,85411467,50,"yes maybe, let me see how that works",543222924,2016-10-28 02:38:54
18275142,622449,85411440,50,"yeah good idea, i'll document this",543222924,2016-10-28 02:38:45
18275142,622449,85411375,4,"same as above, what do you think?",543222924,2016-10-28 02:38:24
18275142,622449,85410828,48,"I have the same worry. I'm in the middle of testing it out. It's also really hard to get these logs to show up in the tests. Something to do w/ slf4j configuration. So I also want to confirm these logs actually get printed on a real cluster.

I *think* ",543222924,2016-10-28 02:35:18
18275142,622449,85411550,56,Maybe -- I need to check if there's a difference. I think there might be but I'm not 100% sure.,543222924,2016-10-28 02:39:25
18549825,11097008,86655703,72,"this `typeTag[T]` will always match `ev` no? I think so. Why not just explicitly cast in this method:
```scala
def downCast[T <: U](u: U): T = u.asInstanceOf[T]
```
Also, this is a downcast, no?",549336462,2016-11-05 08:55:34
18549825,11097008,86655258,159,can we prefix new scalding options with `scalding.`?,549336462,2016-11-05 08:33:52
18549825,11097008,86655472,274,I don't think this should be in this file. Can we break `StorageMode` out? Also can we put it in a new namespace/dir? `scalding.fabric` or something?,549336462,2016-11-05 08:44:05
18549825,11097008,86655594,343,should this not return `ConfigType`?,549336462,2016-11-05 08:49:14
18549825,11097008,86655533,330,we have user code that assumes this. Can we find a way not to break those folks?,549336462,2016-11-05 08:46:46
18549825,11097008,86655514,299,this looks like an infinite loop. What am I missing?,549336462,2016-11-05 08:45:51
18549825,11097008,86655229,61,I'd rather not hide `Map` with an import or use `scala.collection.immutable.Map` here.,549336462,2016-11-05 08:32:09
18549825,11097008,86655388,90,"I wonder if we should just have a contract that a `Mode` needs a constructor that takes exactly one `Args` and exactly one `Configuration`, or even, possibly `Config` which is immutable. Wouldn't that work? I don't want to add too much flexibility if we d",549336462,2016-11-05 08:39:42
18549825,11097008,86655492,281,can we add a comment about the requirement of constructors for reflective construction?,549336462,2016-11-05 08:44:51
18549825,11097008,86655525,321,no need for `{ }`,549336462,2016-11-05 08:46:15
18549825,11097008,86655580,341,"maybe we actually want an abstract type here:

```scala
trait HadoopExecutionModeBase {
  type ConfigType <: Configuration
}
```
since then we can refer to it: `mode.ConfigType`. We might do this to put more of the cascading types and not use `_` s",549336462,2016-11-05 08:48:51
18549825,11097008,86655208,46,can we avoid `scala.collection.Map` and explicitly use `Map` for immutable map (standard) and `mutable.Map` when we need a mutable one?,549336462,2016-11-05 08:31:35
18549825,11097008,86655657,60,let's use `getOrElseUpdate` rather than the nested put.,549336462,2016-11-05 08:52:58
18549825,11097008,86655483,277,I don't really know what this means. Can you comment?,549336462,2016-11-05 08:44:27
18549825,11097008,86655376,82,can we make these maps instead?,549336462,2016-11-05 08:38:51
18552303,6636815,86632002,40,"should we create a fields version of this source to decouple the fields and typed source?
e.g.
```
// use this in the existing tests
class TestEmptySource extends FileSource with Mappable[(String, Long)] with SuccessFileSource {
..
} 

// use in t",549421365,2016-11-05 04:03:55
18552303,622449,86635990,40,Yeah I can separate them,549421365,2016-11-05 04:30:02
18821766,11097008,87874591,62,can you comment what the boolean means at this call site?,556108898,2016-11-15 03:30:24
18821766,11097008,87874408,27,can you test a `.zip` to be sure we don't lose files there?,556108898,2016-11-15 03:29:34
18821766,11097008,87873750,110,don't you need to merge the sets from the left and right? Seems like we are losing `this.tempFilesToCleanup`.,556108898,2016-11-15 03:26:20
18821766,11097008,87874661,58,can we prefer the `.` style and use `filesToCleanup.foreach {`,556108898,2016-11-15 03:30:48
18821766,32369416,87877030,58,???? ,556108898,2016-11-15 03:42:16
18821766,32369416,87877040,62,???? ,556108898,2016-11-15 03:42:20
18821766,32369416,87877228,110,"Ah good catch, I do need that here.",556108898,2016-11-15 03:43:16
18821766,6636815,87908965,26,"since we're just iterating over the filesToCleanup in this case class, maybe we can make this a more generic interface rather than mutable.Set? Iterable / Seq / Set?",556210056,2016-11-15 06:34:56
18821766,6636815,87910557,42,"as this is part of a shutdown hook, should we add a catch all clause?",556210056,2016-11-15 06:44:23
18821766,6636815,87908666,44,can we pass e to the log statement? that way we get the message and stacktrace? Also should this be a warn?,556210056,2016-11-15 06:33:03
18821766,6636815,87911018,26,maybe also call out that if the job is aborted this will not cleanup stuff (if folks haven't read / know about shutdown hook semantics),556210056,2016-11-15 06:47:21
18821766,11097008,87927698,26,+1 to taking an immutable `Iterable` here. Can we make the class private?,556210056,2016-11-15 08:51:56
18821766,11097008,87927956,42,Do you mean `catch { case e: Throwable => ` so we catch anything? Is that what you mean?,556210056,2016-11-15 08:54:12
18821766,6636815,87930428,42,@oscar-stripe yeah. If we for whatever reason throw an caught exception in this code that will result in the shutdown code not being run completely as I understand it.,556210056,2016-11-15 09:14:51
18821766,32369416,88009365,26,???? ,556210056,2016-11-15 20:52:19
18821766,7111,88085453,69,"don't we need to override the `addFilesToCleanup` to forward back to the parent list? I think any files added to the child will not be deleted, right?",556817529,2016-11-16 02:49:15
18821766,32369416,88086059,69,"Yeah, that does need to be added",556817529,2016-11-16 02:52:10
18821766,7111,88093160,60,"actually, I think we should keep this private and override the add method. The reason is we forgot one more thing: this is not thread-safe, but we have so many threads in play, we should make this thread-safe.

I think we are modifying this value from s",556858199,2016-11-16 03:25:09
18821766,622449,88099933,46,"style-wise I think `case e => LOG.warn(s""Unable to delete temp file $file"", e)` is the same (without the `:Throwable` part)",556887853,2016-11-16 03:57:20
18821766,622449,88100781,28,should this extend Runnable instead? Does it have to extend Thread?,556887853,2016-11-16 04:01:52
18821766,32369416,88101250,28,`addShutdownHook` will only take a `Thread` unfortunately,556887853,2016-11-16 04:04:13
18821766,32369416,88101474,46,"It is the same, but leaving out the `: Throwable` generates a compiler warning requesting that you be explicit. I see a mix of both in the codebase now, but I'm happy to go with whatever's the preferred style.",556887853,2016-11-16 04:05:26
18821766,32369416,88097160,60,"Good point, I'll switch that up.",556858199,2016-11-16 03:44:15
18968381,11097008,88722567,38,this is pretty old and points to the fields API. I'd nuke it.,559055233,2016-11-19 03:26:19
18968381,11097008,88722700,42,"this is no longer accurate. There is Execution and ValuePipe, both are related to this problem.",559055233,2016-11-19 03:27:04
18968381,6636815,88746227,16,does this need to be a link?,559151150,2016-11-19 05:49:49
18968381,11097008,88761907,46,can we make this a tut compiled thing? Would be awesome to have that checked.,559208086,2016-11-19 07:57:23
18968381,32008959,88772949,46,"Yes, definitely - next PR!",559208086,2016-11-19 13:18:05
18968381,32008959,88751311,16,"yes, good call! added a todo to convert a wiki page over.",559151150,2016-11-19 06:23:18
19251216,7111,90714244,17,where is `hdfsPaths` coming from now? Why aren't you using `e` as a causedBy exception?,566645939,2016-12-03 04:29:06
19251216,7111,90714031,5,"can we not have a default argument and instead add a second constructor:
```scala
  this(message: String) = this(message, null)
```",566645939,2016-12-03 04:27:38
19251216,622449,90746235,5,"Yeah, wasn't sure if there's a difference.

It turns out that it's hard to extend Exception in scala because of the difference in how multiple constructors work in scala vs. java. The only hack that makes this possible is that passing null as the throwa",566645939,2016-12-03 09:22:12
19251216,622449,90746337,17,"this is a 2ndary constructor, so there is no `e` on line 56/57, we are creating `e` and passing it to the primary constructor.

So hdfsPaths comes from the caller, eg:

```
new InvalidSourceTap(somePaths)
```

This is for backwards compatibility a",566645939,2016-12-03 09:24:18
19251216,7111,90746424,17,"ah, yes. Overlooked that somehow.",566645939,2016-12-03 09:26:25
19251216,622449,90973976,17,I don't know if it's actually binary compatible though. Should be source compatible. ,566645939,2016-12-06 06:47:57
19416375,7111,90761359,8,What's going on here?,570295468,2016-12-04 01:36:21
19416375,44018,90761400,8,"oh shit, sorry, this must have been polluting my branch.",570295468,2016-12-04 01:38:22
19610649,7111,91861582,101,"I thought a later version had been released.

We should write code to just compute the previous version if the current version does not end in 0",573664667,2016-12-12 02:25:20
19610649,44018,91863297,101,"No later version's out, according to Maven Central.",573664667,2016-12-12 03:35:05
20737707,622449,97697310,9,if you could revert the style changes here that'd be great. I think scalafmt will put them back anyway.,605116833,2017-01-25 10:12:21
20737707,622449,97698052,38,"`addDistributedCacheFile(uri: URI, config: Config)` below makes sense to me, but this one I don't quite follow. If someone already has a CachedFile, that's only possible if they provided DistributedCacheFile with a mode, and that mode has already been mut",605116833,2017-01-25 10:20:15
20737707,622449,97698120,62,"as mentioned above, I think this could just be an instance method?",605116833,2017-01-25 10:21:02
20737707,622449,97698170,64,there's some logic in DistributedCacheFile for making paths fully qualified -- should we expose those too and and use them here too?,605116833,2017-01-25 10:21:27
20737707,622449,97698232,67,maybe add a comment linking the lines from the hadoop codebase this is taken from so that when we read this we can know where it came from,605116833,2017-01-25 10:22:06
20737707,622449,97698598,9,"Do you think we need this method? Since this only ""sticks"" for just 1 execution, maybe using `Execution.withConfig` is more clear? I'm worried this makes it looks like you could do:

```
myExecuiton
  .addConfig(a)
  .addConfig(b)
  .addConfig(c)
`",605116833,2017-01-25 10:25:30
20737707,622449,97698741,19,This one I really don't think we need. It has the same name as `Execution.withConfig` but it's very different. I don't think we ever really want to ignore the old config. Can you think of a use case where this is necessary?,605116833,2017-01-25 10:26:48
20737707,622449,97698777,8,"won't this fail, as there is no implicit mode available for DistributedCacheFile?",605116833,2017-01-25 10:27:15
20737707,7111,97699755,9,Why does a and b get ignored @isnotinvain? I don't read the code that way.,605116833,2017-01-25 10:38:31
20737707,94390,97712821,38,"yes, I want to have some API to work with `CachedFile` for backward capability, because I sure that many people already use `DistributedCacheFile` (`DistributedCacheFile` will work fine with execution because `Execution` has method `getMode/getConfigAndMo",605116833,2017-01-25 13:41:09
20737707,94390,97712913,62,this method useful because I need to specify which config I want to modify in `foldLeft`. I'll make it as private method.,605116833,2017-01-25 13:42:25
20737707,94390,97712993,64,we will assume that in this method we work only with qualified uri.,605116833,2017-01-25 13:43:34
20737707,94390,97713037,67,ok. thanks,605116833,2017-01-25 13:44:01
20737707,94390,97713344,9,"@isnotinvain no, a,b,c will pass to `myExecution`.

but in case:
```
myExecuiton
  .addConfig(a)
  .addConfig(b)
  .addConfig(c)
  .flatMap(item => doSomething(item))
````
`doSomething` don't get a,b,c.",605116833,2017-01-25 13:47:39
20737707,94390,97713461,19,"Just as optimization for the case when you use addDistributedCacheFiles on current config, it means that in new config you already have the old one and you don't need ++",605116833,2017-01-25 13:49:37
20737707,94390,97713487,8,"yes, sorry for typos, I'll update example ",605116833,2017-01-25 13:50:05
20737707,94390,97713497,9,"ok, thanks",605116833,2017-01-25 13:50:14
20737707,401065,97847791,19,"Agree with @isnotinvain . Breaks expectations users have about the overloaded method. If we were to accept something like this, it should be named like `#replaceConfig` or something.",605116833,2017-01-26 02:39:08
20737707,401065,97847819,9,Agree with @isnotinvain that this method is unnecessary (or should be added in a separate PR). ,605116833,2017-01-26 02:39:16
20737707,622449,97899173,38,No but the DistributedCacheFile class just doesn't make sense in the context of Executions. It has to be called from code that is intended for use only in a Job. Even getting access to the Execution's mode does't help as the mutations are ignored. I reall,605116833,2017-01-26 06:54:44
20737707,622449,97899305,64,"ok maybe that should be in the comments then, as that's not the case in DistributedCacheFile right? ",605116833,2017-01-26 06:55:40
20737707,622449,97899561,9,"Oh, I guess I misunderstood then. In that case addConfig seems fine.",605116833,2017-01-26 06:57:13
20737707,94390,97904533,38,"`CachedFile` itself not depended on `DistributedCacheFile`, it just encapsulates information about qualified URI and has shortcuts for file and path.",605116833,2017-01-26 07:32:12
20737707,94390,97904644,64,I fixed comments and name of variable.,605116833,2017-01-26 07:33:02
20737707,94390,98132791,19,"@benpence I think, replaceConfig give more misunderstanding, will removed it.",605116833,2017-01-27 09:48:11
20737707,401065,98518072,38,"Hmm, I'm a little conflicted on this. My preference would be a method on `Execution` like `def addDistributedCacheFile(path: String): Execution[CachedFile]` or something similar. That way, the user doesn't have to worry about the `Mode`. Internally, we ca",605116833,2017-01-31 03:18:13
20737707,401065,98514814,9,"I like this style better than the static `.withConfig`, but I think it will only serve to clutter the API. If you want this style, my preference would be to have a method of the same name or perhaps `#transformConfig` on `trait Execution` that makes it tr",605116833,2017-01-31 03:03:18
20737707,94390,98530242,9,"@benpence in this case, it's huge refactoring to support `extraConfig` in next operations. I think it should be another PR.",605116833,2017-01-31 04:13:05
20737707,94390,98532312,38,"@benpence I have 2 concerns about API like that:
1. DistributedCacheFile is the property of config, not an execution.
2. at now we don't have the ability to pass any changes in config to next operations, so we should create distributed cache before exec",605116833,2017-01-31 04:23:38
20737707,401065,98579123,38,"I mostly agree with you, except for using the same code for Job & Execution API. They seem so different at this point that I don't think that matters.

Anyway, while it's conceptually something in the Config, I think the fact that the current API requir",605116833,2017-01-31 08:57:29
20737707,401065,98579207,9,"OK, I think it's fine to drop this for another PR.",605116833,2017-01-31 08:58:13
20737707,94390,98581190,38,the main problem to have that kind of API is that we can not modify config between executions.,605116833,2017-01-31 09:15:44
20737707,7111,99190945,12,can we add a comment that you cannot return `CachedFile` in `T`. You must use `CachedFile` inside something inside the `Execution[T]` (like a map/reduce function).,611095492,2017-02-03 02:47:00
20737707,7111,99192981,14,"can we add a comment that this does have the side effect of adding a key to the Configuration, but that should not matter.

On the other hand, maybe we can refactor:
https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twit",611095492,2017-02-03 02:56:05
20737707,401065,99190737,91,"Hmm, will this be problematic if we try to get these in local mode?",611095492,2017-02-03 02:46:06
20737707,7111,99190426,36,we don't actually have a test that checks you can get the file. Can we make one?,611095492,2017-02-03 02:44:42
20737707,7111,99185192,70,should we use both the old `map-red` and `mapreduce` keys (if they are different)? Maybe we don't need to.,611095492,2017-02-03 02:20:21
20737707,401065,99185472,40,I don't think `@return` adds anything here. I would remove it.,611095492,2017-02-03 02:21:42
20737707,401065,99192802,12,"Add a comment here that shows how to use this with multiple files. Consider adding a reminder comment about `CachedFile` expectations i.e. if you're using `Hdfs` mode, the `CachedFile` path will only be valid in the `TypedPipe`/`KeyedList` closures (right",611095492,2017-02-03 02:55:18
20737707,94390,99228430,70,it doesn't have alternative.,611095492,2017-02-03 05:49:39
20737707,94390,99228865,36,"@johnynek what do you mean ""get the file""? tests above test `getDistributedCachedFiles` and `withCached`, they should actually execute `Execution.withCached`. ",611095492,2017-02-03 05:51:47
20737707,94390,99231162,12,"done, thanks",611095492,2017-02-03 06:02:30
20737707,7111,99233741,36,"well, in hadoop mode, hadoop has to do some extra steps, so actually using the `CachedFile.file` is a test that step is actually working.",611095492,2017-02-03 06:15:16
20737707,94390,99233774,14,"@johnynek sounds good, but I did a little bit by another way. look, please.",611095492,2017-02-03 06:15:24
20737707,94390,99234079,40,"done, thank",611095492,2017-02-03 06:16:31
20737707,94390,99234350,12,done,611095492,2017-02-03 06:17:47
20737707,94390,99234228,91,we don't add files to config in local mode at all. same thing in older code.,611095492,2017-02-03 06:17:18
20737707,94390,99236865,36,@johnynek I found that `scalding-hadoop-test` support only `Job` based tests. Can we do it in other PR(support of run Execution base tests in local cluster)?,611095492,2017-02-03 06:31:42
20737707,6636815,99238135,60,can probably skip the {} as its a single line function,611124311,2017-02-03 06:39:00
20737707,6636815,99239855,36,"Seems like some of the tests here are using Hadoop local mode. If it does support storing and retrieving the cached files, it would be nice. ",611095492,2017-02-03 06:48:13
20737707,6636815,99238168,66,here too,611124311,2017-02-03 06:39:14
20737707,6636815,99237220,18,should we add a short snippet indicating how users can do this here?,611124311,2017-02-03 06:33:59
20737707,94390,99242020,60,ok,611124311,2017-02-03 07:02:02
20737707,94390,99242027,66,ok,611124311,2017-02-03 07:02:05
20737707,94390,99242007,18,"snippet available in DistributedCacheFile, and I put the link to it. do you want copy to here also?",611124311,2017-02-03 07:01:56
20737707,94390,99243178,36,"@piyushnarang which one? test for a cached file is using `Hdfs` mode. but this test doesn't execute anything on real hadoop, it test only changes in config, for integrated test we should add them to `scalding-hadoop-test` how I understand, but for do it, ",611095492,2017-02-03 07:09:26
20737707,94390,99251820,19,"ok, but basically `fn` can not change config what use `withConfig`",611124311,2017-02-03 08:08:26
20737707,94390,99251838,50,thanks done,611124311,2017-02-03 08:08:34
20737707,94390,99252289,66,it does not hurt compatibility because we don't return this class anywhere and he has the private constructor. Nobody can't use his directly.,611124311,2017-02-03 08:12:37
20737707,7111,99252546,1,can't you just do `Execution.getMode.flatMap { mode =>` now?,611626419,2017-02-03 08:14:53
20737707,94390,99252666,1,"sure, sorry.",611626419,2017-02-03 08:16:05
20737707,7111,99253030,66,"okay, fair enough.",611124311,2017-02-03 08:19:06
20737707,622449,99265782,18,"should this be `doSomething(file.path)` ? 

do we need to give the user a `CachedFile` and make them call `.path` on it, or should we just give them a `new File(cached.path)` directly? ",611694197,2017-02-03 10:14:01
20737707,622449,99265656,20,how about `withCachedFile` ? ,611694197,2017-02-03 10:12:33
20737707,94390,99417463,18,@isnotinvain `CachedFile` has `.path` and `.file`,611694197,2017-02-04 04:34:11
20737707,94390,99417826,20,done,611694197,2017-02-04 04:36:33
21574131,94390,102278828,6,it will raise `ArrayIndexOutOfBoundsException`,626702211,2017-02-22 02:19:27
21574131,1443419,102308896,6,Use [FileInputFormat#addInputPaths](https://github.com/apache/hadoop/blob/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapred/FileInputFormat.java#L437),626702211,2017-02-22 04:26:38
21574131,2735428,102317712,6,"Thanks for the suggestion. 
Because inputPaths[inputPaths.length] is so obviously broken, I wonder if the tests I did on my versioned sources did actually execute this code. I will switch to FileInputFormat#addInputPaths and add a broken test that become",626702211,2017-02-22 05:07:09
21660042,6636815,102848210,15,wondering if we should be a bit defensive here in case HRaven returns an empty counters list / the map output bytes counter isn't found. We can't really proceed with the hraven reducer estimator without this value but we could throw a better exception tha,630838524,2017-02-24 07:43:27
21660042,6636815,102847836,5,"if this isn't being used anymore, we could drop it?",630838524,2017-02-24 07:40:51
21660042,1443419,102848388,4,"Drop this. Let us use depending on Hadoop version:
```
com.twitter.hraven.Constants#TASK_COUNTER
```
or 
```
com.twitter.hraven.Constants#TASK_COUNTER_HADOOP2
```
instead. Ideally hraven should have a generic getWhateverCounter method abstracting ",630838524,2017-02-24 07:44:47
21660042,1443419,102849493,5,Probably not worth a constant for one time usage,630838524,2017-02-24 07:52:33
21660042,1443419,102848096,15,"Too prominent, and inconsistent with the way the other fields are inited. Let us inline.
I think you want getMapCounters here:  
```
step.getMapCounters.getCounter ...
```

",630838524,2017-02-24 07:42:41
21660042,94390,102866189,15,this value stored in both counters,630838524,2017-02-24 10:10:58
21660042,94390,102869321,5,"many of them don't being used, I'm not sure that needs to delete.",630838524,2017-02-24 10:42:40
21660042,94390,102869479,15,I added the check where it used.,630838524,2017-02-24 10:44:23
21660042,94390,102869503,4,done,630838524,2017-02-24 10:44:33
21660042,94390,102869555,5,at now twice :),630838524,2017-02-24 10:45:01
21660042,94390,102869579,15,moved to map counters,630838524,2017-02-24 10:45:14
21660042,1443419,103009489,62,"nit: maybe more concise to write as

`Option(counter).gerOrElse(0L)`",630969144,2017-02-25 03:03:57
21660042,1443419,103008618,56,Can we move MapOutputBytesKey inside the method or inline it?,630969144,2017-02-25 02:59:46
21660042,94390,103010714,56,@gerashegalov why? JVM will inline it. ,630969144,2017-02-25 03:09:33
21660042,94390,103011082,62,"I think this is `Option(counter).map(_.getValue).getOrElse(0L)` less readable, isn't?",630969144,2017-02-25 03:11:22
21660042,1443419,103011148,56,"I only meant to put it in the scope of where it's actually used, since it's only in this one method. ",630969144,2017-02-25 03:11:41
21660042,94390,103011800,56,My preference to keep it in constant as well as other constant values.,630969144,2017-02-25 03:14:53
21660042,1443419,103011845,62,"my Option comment is marked nit, so optional to consider :)",630969144,2017-02-25 03:15:09
21660042,1443419,103014103,56,noted!,630969144,2017-02-25 03:25:52
21739857,7111,103086198,1,mima `0.1.14` is also out with some bug fixes.,630950078,2017-02-26 03:24:43
21739857,6636815,103750907,1,"Ok, I'll pick it up as well. ",630950078,2017-03-02 02:12:04
21739857,6636815,103814869,1,done,630950078,2017-03-02 07:16:36
21739857,7111,107064948,5,another merge issue.,649876301,2017-03-21 10:11:55
21739857,7111,107064925,39,this looks like another merge issue.,649876301,2017-03-21 10:11:39
21739857,7111,107064508,20,"are we sure we want to bump to `0.8.x` vs `0.7.7`? Seems summingbird on storm 1.0 has still not landed, so we might want to have one last summingbird with 2.12? (I'm working a lot with summingbird and that may help me).",649876301,2017-03-21 10:06:15
21739857,7111,107064715,10,"can we wrap this line:
```scala
 case y: Product if x.productArity == y.productArity =>
   x.productIterator sameElements y.productIterator
```",649876301,2017-03-21 10:09:05
21739857,7111,107064847,17,this looks like some kind of bad merge. I don't think this is part of this. Can you rebase develop and see if this goes away?,649876301,2017-03-21 10:10:42
21739857,6636815,107224746,10,"sure, seems cleaner will do. ",649876301,2017-03-22 00:40:40
21739857,6636815,107227533,20,"@johnynek I can switch this to 0.7.7. If I understand correctly the plan would be:
1) Merge this PR with chill 0.7.7 (might need to revert the test fix here: https://github.com/twitter/scalding/pull/1634/files).
2) Cut a 0.17.0 release 
3) You can use ",649876301,2017-03-22 00:50:06
21739857,134219,107281361,20,"@johnynek summingbird with storm 1.0 support wasn't released because I'm waiting on scalding/storehaus to be released with 0.8.x chill.

In order to release SB with 0.9 storm and 2.12 scala support we also need to release tormenta with the same. Latest ",649876301,2017-03-22 04:33:21
21739857,11097008,107304855,4,why did this need to get nuked?,650115337,2017-03-22 06:55:03
21739857,6636815,107306186,4,The scrooge generator was cribbing cause this was being declared twice. The old version seem to not mind. ,650115337,2017-03-22 07:05:43
21739857,6636815,107306334,4,In this file: https://github.com/twitter/scalding/blob/7ed0f92a946ad8407645695d3def62324f78ac41/scalding-parquet-scrooge-fixtures/src/test/resources/test.thrift it's on 89 and 107,650115337,2017-03-22 07:07:01
21739857,11097008,107306738,4,ahh. Cool.,650115337,2017-03-22 07:10:38
21739857,134219,107502128,9,I prefer to have this method  inlined and without the comment.,650115337,2017-03-23 01:54:16
21739857,7111,107504888,20,"Okay, I think moving forward with 0.8 chill seems fine then. Let's move forward and go ahead to get on 1.0 storm.",649876301,2017-03-23 02:06:09
21739857,280540,107518818,16,could these lists be `private[serialization]`?,650115337,2017-03-23 03:10:51
21739857,280540,107499350,48,"What's the purpose of this method? It doesn't use the `scalaVersion` parameter, maybe it should be a `val`?",650115337,2017-03-23 01:43:19
21739857,280540,107519659,9,+1,650115337,2017-03-23 03:14:19
21820575,1443419,103390495,20,I don't think it's a good idea to hardcode Hadoop's CombineSequenceFileInputFormat especially since we normally use [the one from ElephnantBird](https://github.com/twitter/elephant-bird/blob/87efd8c5358614888791fc2ce6b68675bac32239/core/src/main/java/com/,633756199,2017-02-28 15:26:04
21820575,94390,103527982,20,I did little refactoring to keep backward capability. ,633756199,2017-03-01 03:03:31
21820575,1443419,103558828,20,My one-line change suggestion for VersionedKeyValSource is not sufficient?,633756199,2017-03-01 05:44:13
21820575,94390,103564709,20,"I believe that it should be opt-in and affect not only VKVS.

And also, it better to moves to hadoop implementation instead elephantbird.",633756199,2017-03-01 06:15:28
21820575,1443419,103567126,20,"EB is opt-in, you have to set elephantbird.use.combine.input.format=true 
How do you measure ""better"" for hadoop's impl. The code change is simpler in the EB case.

You can make input format configurable.",633756199,2017-03-01 06:27:48
21820575,94390,103569324,20,"Hadoop has better community support, EB used only inside Twitter.

@isnotinvain / @johnynek what do you think?",633756199,2017-03-01 06:38:34
21820575,1443419,105284457,13,@johnynek what's your take on our favorite subject of transitive dependencies? If they are allowed we can remove eb entries from scaldingCommons.,640892000,2017-03-10 06:14:11
21820575,7111,105310849,13,"so, strictly speaking, I thought elephant-bird had GPL'd dependencies (lzo). That was actually one of the original reasons for not putting this in the core.

Do we need both of these dependencies here? 

I start to wonder if there is a single consumer",640892000,2017-03-10 09:11:07
21820575,94390,107312957,13,"@johnynek got it, let's keep elephantbird isolated in commons for now and use combined for VKVS and have separated CombinedSchemas for sequence files as helpers.",640892000,2017-03-22 08:03:13
21820575,7111,107998056,16,why the fully qualified name here but not on line 10?,650777577,2017-03-25 03:58:43
21820575,94390,108000096,16,"done, thanks",650777577,2017-03-25 04:09:41
22177766,622449,105253066,6,"maybe `""cannot compute size of one of:\n""`",641520786,2017-03-10 03:41:45
22177766,622449,105253520,8,haha where does this come from? ,641520786,2017-03-10 03:43:35
22177766,622449,105252870,5,"an easy way to do this is:

```
FileInputFormat
      .getInputPaths(conf)
      .flatMap { path =>
        val fs = path.getFileSystem(conf)
        Option(fs.globStatus(path)).map { files => 
          val size = files
            .map(status =",641520786,2017-03-10 03:41:02
22177766,622449,105253483,48,"can you make this more descriptive? Maybe ""Don't fail when a memory source is used"" or ""Ignore memory source in input size estimation"" or something like that? ",641520786,2017-03-10 03:43:26
22177766,94390,105253767,6,done,641520786,2017-03-10 03:44:41
22177766,94390,105253985,5,"I actually rethinking this and use `Try`, because in many ways it can throw IOException ",641520786,2017-03-10 03:45:38
22177766,94390,105254041,8,hipster.txt :),641520786,2017-03-10 03:45:55
22177766,94390,105254340,48,done,641520786,2017-03-10 03:47:20
22177766,6636815,105253647,24,this isn't being used right? Should we add a test to include this scenario? Source is a Hfs source but the path points to a file that doesn't exist?,641520786,2017-03-10 03:44:11
22177766,6636815,105252598,11,add a comment here for when we could end up with null?,641520786,2017-03-10 03:39:43
22177766,6636815,105255272,6,maybe expand that this can be due to a memory tap / tap with missing files?,641520786,2017-03-10 03:51:46
22177766,94390,105255377,24,removed,641520786,2017-03-10 03:52:17
22177766,94390,105255661,6,"we need change API a little bit to show what we can not estimate, I can do it if you want",641520786,2017-03-10 03:53:27
22177766,94390,105255727,11,rewrited it.,641520786,2017-03-10 03:53:42
22177766,6636815,105256896,6,I'm ok with leaving the API as-is for now. Maybe just update the text to say that we typically can't compute sizes of memory taps / files not found. That will make debugging in the future easier. ,641520786,2017-03-10 03:58:34
22177766,94390,105257401,6,like that `cannot compute size of one of (usually it's memory taps or files not found)`?,641520786,2017-03-10 04:00:57
22177766,6636815,105259181,6,how about `cannot compute size of one of (is it a memory tap / are files not found?): ... ` ?,641520786,2017-03-10 04:09:25
22177766,94390,105265915,6,done,641520786,2017-03-10 04:41:06
22177766,622449,105304920,37,we should still check for null so that we can have better error messages right? Actually this Try {} block is going to swallow exceptions quietly which doesn't seem great? The explicit check for null via the Option constructor seemed better -- if we do ge,641684588,2017-03-10 08:25:02
22177766,7111,105311491,37,"That said, I'm not sure you want to be failing the job here if you have an exception. Presumably we want to just log and give warnings that reducer estimation may be off and go ahead assuming they were empty?",641684588,2017-03-10 09:16:15
22177766,7111,105311100,37,"+1. If the NPE is the issue, let's handle it directly:
```scala
val size = fs.globStatus(path) match {
  case null => 0
  case items => items.map(...).sum
}
```",641684588,2017-03-10 09:13:07
22177766,622449,105317206,41,"why the Try / toOption? can we just let errors bubble up? This shouldn't throw in a normal case right? 

At a minimum we should probably log these exceptions",641741920,2017-03-10 10:06:46
22177766,622449,105317248,47,check for nulls here too,641741920,2017-03-10 10:07:15
22177766,622449,105317148,15,still need our null checks here probably ,641741920,2017-03-10 10:06:08
22177766,622449,105317315,40,"lets document how this works:

1) Ask the tap for its size
2) If the reported size is 0, as the tap for it's path and check the size ourself",641741920,2017-03-10 10:07:55
22177766,94390,105317471,15,done,641741920,2017-03-10 10:09:27
22177766,94390,105317483,40,ok,641741920,2017-03-10 10:09:34
22177766,94390,105317697,41,"because cascading implementation can throw an error even if we can calculate size, first we try to get the size from the tap then fallback to our method to calculate, we don't need to log the error because it will log in next step if it the stable error.",641741920,2017-03-10 10:11:47
22177766,94390,105319351,47,done,641741920,2017-03-10 10:24:24
22177766,622449,105319570,15,Does this get called after validateTaps? Hopefully otherwise there will be race conditions where this returns  0 but the file shows up later and then we estimate poorly ,641741920,2017-03-10 10:27:05
22177766,622449,105319667,47,lets just let this fail if it fails? ,641760947,2017-03-10 10:28:04
22177766,94390,105320832,47,"I know the case when we can calculate by ourself, because generic Hfs getSize doesn't handle paths glob.",641760947,2017-03-10 10:41:25
22177766,6636815,107940484,46,"seems like we currently only fail if:
1) There's some exception thrown while computing the size of a tap
2) We can't compute the size of all the taps in a step. In case case we end up with an empty list and log the warning. 

If I understand correctly",650617696,2017-03-24 23:09:04
22177766,6636815,107934828,16,"Lets add a couple of lines of javadoc on why this class is needed. 
Not sure if SizeableHfs is the best name for this as sizeable sounds it you could adjust the size which isn't the case here. Don't have too many great alternatives - GlobSizeHfs ?
",650617696,2017-03-24 22:48:46
22177766,6636815,107940312,6,"this is back to `cannot compute the size of(is it a non Hfs tap): Tap1, Tap2` right? cause we can have a JDBC tap in there with a HDFS based tap and we'd just skip the jdbc one. ",650617696,2017-03-24 23:08:19
22177766,550921,107941241,44,"nit: May be do this to avoid indentation to the right:

if (status == null) {
  throw new FileNotFoundException...
}

long size = 0;
...",650617696,2017-03-24 23:12:32
22177766,550921,107941847,46,nit: keep '.' i.e. unrollTaps(step).flatMap to be consistent with rest of the file and twitter coding conventions.,650617696,2017-03-24 23:15:30
22177766,94390,107978602,6,"yes, this case handle when we have only non Hfs taps.",650617696,2017-03-25 02:06:32
22177766,94390,107978856,46,"yes it back to prior behavior, and we don't care about non Hfs taps.",650617696,2017-03-25 02:07:58
22177766,94390,107978884,46,done,650617696,2017-03-25 02:08:07
22177766,94390,107978871,44,done,650617696,2017-03-25 02:08:03
22177766,94390,107979850,46,let's logging non Hfs taps.,650617696,2017-03-25 02:13:18
22177766,94390,107979910,16,done,650617696,2017-03-25 02:13:38
22177766,6636815,108229148,11,seems like the scalding setting is to include a space after the `{` and before `}`. You might want to update your intellij. ,653853958,2017-03-28 00:26:30
22177766,6636815,108229416,60,maybe make this a warn?,653853958,2017-03-28 00:27:39
22177766,6636815,108230436,5,this should be `cannot compute size of (is it a non hfs tap?)` ?,653853958,2017-03-28 00:31:42
22177766,7111,107992210,43,do we need to change the type of the result here? Could we keep it be `Path`?,653853958,2017-03-25 03:24:32
22177766,7111,107992448,13,can we call this `def runAndHandle` or something?,653853958,2017-03-25 03:25:41
22177766,94390,108239022,60,"ok. done. I thought about warn, but then thought that is normal path.",653853958,2017-03-28 01:06:17
22177766,94390,108239383,5,done,653853958,2017-03-28 01:07:53
22177766,94390,108239804,43,"yes, because we are calculating input size for taps, instead for paths.",653853958,2017-03-28 01:09:44
22177766,94390,108240049,13,done,653853958,2017-03-28 01:10:48
22177766,7111,108243560,14,"wait, is this what you expect? If the job succeeds, `.failed` still gives an exception. Can you comment then intent of this method? Interestingly, here is a case where adding a type parameter helps explain.

If you wrote:
```scala
def runAndHandle[T](",655921464,2017-03-28 01:24:50
22177766,94390,108238917,11,done,653853958,2017-03-28 01:05:51
22177766,94390,108249860,14,"So, this method needs when you expect an exception to check exception path, in this case success unexpected behaviour and user should catch it as exception.

not sure about type parameter, but let's do it.",655921464,2017-03-28 01:49:58
22395277,27685,106299735,24,either this method or the object should be `private[scalding]`,646150039,2017-03-16 05:33:42
22395277,27685,106300547,48,"Could avoid loading the classes if I refactored `CascadingTokenUpdate.updater` to take just the names instead of the classes, since it just calls `.getName`",646150039,2017-03-16 05:39:15
22395277,11097008,106543711,24,"why do we need `jobClass: Class[_ <: Job]` rather than `outerClass: Class[_]`? Why does `Job` matter?

For instance, I'd like to use this with `Execution` as well, and we might want to pass an `ExecutionApp` to get the same result (if you can find items",646150039,2017-03-17 05:09:38
22395277,11097008,106544793,7,"I don't think `Job` has anything really to do with this. Can we just say `ReferencedClassFinder` or something? Also, we might add a method like:
```scala
object ReferencedClassFinder {
  /**
   * Add the given type, as well as all referenced types to ",646784028,2017-03-17 05:15:49
22395277,11097008,106543273,9,"can we remove the `additionalSerializedClasses` here? I think callers should just do:
```scala
.setSerialization( ... )
.addCascadingClassSerializationTokens(additionalSerializedClasses)
```

But another concern is that sadly both cascading and kryo",646784028,2017-03-17 05:06:51
22395277,11097008,106543328,4,can we make this a `private def`?,646784028,2017-03-17 05:07:08
22395277,11097008,106543863,42,"why not `.fullName.startsWith(""scala.Tuple"")` to support all tuples?",646784028,2017-03-17 05:10:35
22395277,11097008,106543766,11,do we not want `TypedSource[_]`?,646784028,2017-03-17 05:09:57
22395277,11097008,106544235,24,"Also, could we possibly also walk the methods and look at the input and return types? This could cover all the cases perhaps?",646150039,2017-03-17 05:12:24
22395277,27685,106555417,24,"Its not really job-related specifically, thats just what I started with to self-limit usage. I'll change it

I passed on methods for this pr to simplify things, but could probably add them. For methods, we might care about ones that return `A` in additi",646150039,2017-03-17 06:29:03
22395277,27685,106555532,11,I'll add,646784028,2017-03-17 06:30:05
22395277,27685,106553281,9,"I thought about doing Kryo as well but I'm not super familiar on things so I've punted for this pr.

My main confusion/concern is: how does the KryoRegistrar know the job class to inspect (Hadoop config? I don't see the full scalding job name anywhere),",646784028,2017-03-17 06:12:49
22395277,27685,106556907,42,"No reason beyond reducing the scope, I'll add",646784028,2017-03-17 06:41:03
22395277,6636815,107929261,11,"do we need to add some tests for:
1) Java types? 
2) Thrift / protobuf types?
3) Testing that if we have some primitive types (like Int) referenced, we don't end up adding their tokens? (Or is that the same scenario as the BytesWriteable?)",650603981,2017-03-24 22:27:01
22395277,6636815,107928804,12,"could we add this to Config.scala: https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/Config.scala#L431
with details on what users get when they turn this on / off? ",650603981,2017-03-24 22:25:03
22395277,6636815,107931140,30,should we be checking if the number of these tokens exceeds what cascading supports? (max int?). Wondering if there are some really complex types that end up referencing a large graph of types. ,650603981,2017-03-24 22:34:23
22395277,6636815,107926570,25,Reflect over a scalding container type?,650603981,2017-03-24 22:16:42
22395277,27685,107959625,11,"1 and 2 should be fine, at least based on my testing.

Primitives seem to work, but in `setSerialization` it filters out primitives and array types:
```
    val kryoClasses = withKryo.getKryoRegisteredClasses
      .filterNot(_.isPrimitive) // Cascad",650603981,2017-03-25 00:37:05
22395277,27685,107959885,30,"`TupleSerialization` writes out the token as a varint, so there shouldn't be any concerns about assigning too many tokens",650603981,2017-03-25 00:38:20
22395277,27685,107959938,12,???? ,650603981,2017-03-25 00:38:31
22395277,27685,107970002,12,"Actually now that I look at it, I'm not sure that makes sense? the `Config` params are for stuff that go into the hadoop config. This is just being read from the `Args`. Other things being read from args in the `Job` (eg `scalding.nocounters`, or `scaldin",650603981,2017-03-25 01:23:30
22395277,6636815,107976544,11,could we add tests for these scenarios? ,650603981,2017-03-25 01:55:23
22395277,6636815,107977175,12,How about we add it to the companion Args object? We don't need to move refactor the other Args in this review but it seems nicer than having them scattered in a bunch of places right?,650603981,2017-03-25 01:58:40
22395277,27685,107985000,12,"Args companion object seems pretty reasonable, I'll add it there",650603981,2017-03-25 02:43:00
22395277,27685,107986247,11,Yea I'll add some tests,650603981,2017-03-25 02:49:55
22395277,94390,108543492,11,"also, let's have tests for InnerClasses (Case classes in Object)",650603981,2017-03-29 04:38:16
22619011,7111,107759020,37,do we need the comment hanging out?,650316742,2017-03-24 02:11:59
22655217,7111,107580429,8,I'm confused by this. Can you comment how this works for Vertica if it expects non upper cased?,650591525,2017-03-23 10:14:52
22655217,7111,107580548,8,Oh. It's matched in the case matching below.,650591525,2017-03-23 10:16:22
22973045,280540,109243561,28,seems to be github's syntax highlighter having problems to render scala symbols,659669097,2017-04-01 03:27:30
22973045,7111,109243808,5,I think this is `Ordering[SizeHint]`,659669097,2017-04-01 03:28:53
22973045,7111,109243466,5,I don't think we need `CumulativeSum.` here.,659669097,2017-04-01 03:26:59
22973045,7111,109244134,6,OrderedSerialization[String],659669097,2017-04-01 03:30:49
22973045,7111,109244016,5,probably import these.,659669097,2017-04-01 03:30:04
22973045,7111,109243335,5,"I think this is really `Injection[Externalizer[T], Array[Byte]]`.",659669097,2017-04-01 03:26:05
22973045,7111,109244167,7,"`OrderedSerialization[(String, String)]`",659669097,2017-04-01 03:31:03
22973045,7111,109243869,5,"I think this is `Injection[Externalizer[U], Array[Byte]]`",659669097,2017-04-01 03:29:14
23331182,622449,111271534,17,do you think we need this? what are we being compatible with? I'd rather we did the same thing regardless of set size. What if the next version of scala adds more or less special Set implementations? ,667601982,2017-04-13 05:06:20
23331182,6636815,111437391,17,yeah it might be simpler to always sort,667601982,2017-04-13 23:59:08
23374912,7111,111267048,103,"`Execution[T]` should be.

Can we use `tut` here: https://github.com/tpolecat/tut to catch these kinds of compilation errors?",668446226,2017-04-13 04:39:35
23374912,622449,111273412,99,maybe explain what lifting means? ,668446226,2017-04-13 05:17:17
23374912,622449,111272356,16,"maybe add loops here (line 16 implies loops, but not obvious to someone new)",668446226,2017-04-13 05:11:08
23374912,622449,111275052,252,"I think practical notes about ""you should never, ever, call .run or .waitFor. Let ExecutionApp do that for you. If you're calling .run or .waitFor, you're probably doing it wrong""

so many users reach for .waitFor when they need .flatMap because types-w",668446226,2017-04-13 05:27:59
23374912,622449,111274398,164,"somewhere we should mention that ""orphaned"" or ignored executions never execute",668446226,2017-04-13 05:23:43
23374912,622449,111272835,20,maybe mention that Executions are like Futures for anyone familiar w/ futures,668446226,2017-04-13 05:13:49
23374912,622449,111274567,170,"Seq.flatMap is kind of confusing compared to Option.flatMap, which works more like Execution/Future .flatMap. Maybe stick with Option? ",668446226,2017-04-13 05:24:49
23374912,622449,111273373,99,frequently ,668446226,2017-04-13 05:17:01
23374912,622449,111272057,1,"I like the title :)

It gets rendered a little strange though, maybe add some new lines? ",668446226,2017-04-13 05:09:29
23374912,622449,111274204,146,maybe inline transform here? ,668446226,2017-04-13 05:22:24
23374912,622449,111273438,103,+1,668446226,2017-04-13 05:17:28
23374912,622449,111274301,151,maybe a separator between these two examples explain the difference ?,668446226,2017-04-13 05:22:59
23374912,622449,111273062,70,would `this.doSomething` make this clearer? ,668446226,2017-04-13 05:15:05
23374912,622449,111273877,140,"I think (here and elsewhere) examples are easier to follow when you don't use primitive types. Eg, make this:

`TypedPipe[User]` and `val getAddress = u: User => u.address` etc. (and use `Address` instead of String for address). No need to actually defi",668446226,2017-04-13 05:20:32
23374912,622449,111273581,129,"here, and everywhere else you call .run() can you show what the returned result is? I think tut will do that for you",668446226,2017-04-13 05:18:28
23374912,11097008,111286485,20,"not crazy about this at all.

This is all also true of `List`. Should we also be worried about using `List`? I think we should, as Alex suggests, instead describe `Execution` as a `Future` for big data jobs.",668446226,2017-04-13 07:00:48
23374912,6636815,111433426,164,yeah that's an important one. Lots of users have been tripped by that. ,668446226,2017-04-13 23:40:22
23374912,6636815,111430804,20,yeah I think the Future analogy is really useful. Helps folks with a more imperative background conceptualize this as well. ,668446226,2017-04-13 23:27:26
23374912,6636815,111431179,20,"So on the one may want to avoid Executions point, should we say that if you don't have a usecase that warrants it (e.g. calling a service before / after or iterative jobs etc) you could stick to using a job? Or do we want to nudge users towards Executions",668446226,2017-04-13 23:29:15
23374912,6636815,111431777,24,"I'm not sure I understand the ""although we can access the `Config` properties when creating a Scalding `Execution`, so theoretically they can be used for anything"" bit. ",668446226,2017-04-13 23:32:06
23374912,6636815,111434142,231,maybe link to the scala doc of `fromFuture`?,668446226,2017-04-13 23:43:54
23374912,6636815,111432384,26,"I'm wondering if this portion (building a simple execution) should be in a separate section. It seems great to have if users want to understand executions in depth, but it doesn't seem essential to know from a usage standpoint. I'd imagine there'd be a bu",668446226,2017-04-13 23:34:59
23374912,6636815,111430615,16,yeah would be nice to mention iterative ML style workflows often use execution.,668446226,2017-04-13 23:26:28
23374912,6636815,111434892,308,s/waring/warning,668446226,2017-04-13 23:47:31
23374912,401065,111475796,231,I added a link to the `Execution` documentation at the top.,668446226,2017-04-14 03:09:04
23374912,401065,111463136,170,Done.,668446226,2017-04-14 02:00:58
23374912,401065,111458311,26,I think building a mental model is extremely important and diving into the code or skipping to looking at uses of `Execution` won't necessarily do that for most users. Although I can be convinced otherwise.,668446226,2017-04-14 01:39:29
23374912,401065,111476650,252,"@johnynek, what are your feelings on this? We use `ExecutionApp` pretty much exclusively at Twitter, so I don't want to misrepresent best practices across the community. E.g. are there teams that make use of services like `A => Future[(Config, Mode)]` to ",668446226,2017-04-14 03:13:19
23374912,401065,111477322,308,Done.,668446226,2017-04-14 03:16:33
23374912,401065,111457709,24,I meant that sometimes we use the `Config` properties outside of Scalding to make decisions when planning `Execution`s. I'll remove this statement.,668446226,2017-04-14 01:36:41
23374912,401065,111454538,1,"What do you mean by ""strange""?",668446226,2017-04-14 01:22:22
23374912,401065,111458561,70,Added.,668446226,2017-04-14 01:40:31
23374912,401065,111460886,103,"OK sounds cool. I can make the undefined stuff just use `???`; however, a lot of the examples have `// ... other previously defined methods ...`. Should I expand this by copy-pasting these methods in?",668446226,2017-04-14 01:50:09
23374912,401065,111461380,164,Added.,668446226,2017-04-14 01:52:40
23374912,401065,118139055,129,I'm going to skip `tut` for now. I will try to make it as obvious as possible what the return types are.,668446226,2017-05-24 07:50:44
23374912,401065,118325739,99,Removed.,668446226,2017-05-25 01:08:48
23374912,401065,118325754,140,"We could look into changing this in a followup PR. For now, I think I'm going to keep the primitives, but I like the idea.",668446226,2017-05-25 01:08:52
23374912,401065,118325768,146,Done.,668446226,2017-05-25 01:08:54
23374912,401065,118325775,151,Done.,668446226,2017-05-25 01:08:56
23480979,280540,112076036,36,"It seems that some of the AST nodes have values that use the identity hash code (e.g. `CascadingPipe.flowDef`), so even though nodes may represent the same computation they may not match the same hashmap entry. I'm not sure that's a problem, but I thought",672393764,2017-04-19 05:07:44
23480979,280540,112078655,74,"How often is `.debug` used? Is it useful? Reading the code, it seems that the new implementation will output way less information.",672393764,2017-04-19 05:23:07
23480979,280540,112076207,23,Wdyt about moving the caching logic to a separate class?,672393764,2017-04-19 05:08:40
23480979,280540,112074275,23,"a global static cache for mutable values is pretty scary :) Is there a way that we could reduce its scope? For instance, if the flow def creation calls `TypedPipe.toPipe` multiple times but using the same thread, we could use a `ThreadLocal`-bound cache t",672393764,2017-04-19 04:56:58
23480979,280540,112071916,19,I'm not sure I understand the flow here. Isn't `TypedPipe.toPipe` called only once given a job?,672393764,2017-04-19 04:44:04
23480979,280540,112077900,62,This transformation seems much simpler than the previous implementations of `cross`. Is it a safe change? Would it be worth keeping the old behavior to reduce the scope of the change?,672393764,2017-04-19 05:18:36
23480979,280540,112071709,265,would it be possible to move the line numbers to the `TypedPipe` AST instances to keep the information precise?,672393764,2017-04-19 04:42:57
23480979,7111,112079985,23,what values are mutable here?,672393764,2017-04-19 05:31:57
23480979,7111,112080089,19,No. It is called on each `.write` and some jobs write many outputs. It is probably also called somewhere inside Twitter by someone doing some mixing of the fields and typed API.,672393764,2017-04-19 05:32:49
23480979,7111,112080375,23,"I kind of want to keep it as local as possible and hopefully kill it eventually. If you prefer, I can make a class that encapsulates this WeakHashMap and lookup.

Note this previously existed in some form (and was needed to get tests to pass) in the pre",672393764,2017-04-19 05:34:34
23480979,280540,112080592,23,"aren't the cascading values mutable? (fields, flowDef)",672393764,2017-04-19 05:35:48
23480979,280540,112080816,19,"I see, thanks for the clarification.",672393764,2017-04-19 05:36:44
23480979,7111,112080975,36,"I believe that in fact we will never put a `CascadingPipe` directly into this cache. We could assert that to make it clear. It could come in as a grouping from someone that uses `from(pipe: Pipe, f: Field)...`. That said, in that case, I think we want ide",672393764,2017-04-19 05:37:46
23480979,280540,112081179,23,"Fair enough, I agree that it's better to keep it limited to this scope ???? ",672393764,2017-04-19 05:39:09
23480979,7111,112081366,74,"can you explain? The old implementation just called cascading Debug pipe on things that were already scheduled, which does this:
https://github.com/Cascading/cascading/blob/3.1/cascading-core/src/main/java/cascading/operation/Debug.java#L234

which, si",672393764,2017-04-19 05:40:21
23480979,7111,112081474,265,I think we should. I would like to add another AST node to annotate with line numbers rather than add it to each node. I wanted to keep this diff as small as possible though so people can read it.,672393764,2017-04-19 05:41:09
23480979,7111,112082038,62,"you mean here:
https://github.com/twitter/scalding/pull/1666/files/a76865d69948a2fef0953b8a061a95da9c070bf0#diff-fbe95168deecb5a4b5e9ace30182593eL981

I'm happy to add more optimization rules here, but I think all of those (other than the Merged change",672393764,2017-04-19 05:45:09
23480979,7111,112082346,23,"while they are technically mutable, we are not mutating any of them as we store them in here. This is kind of the whole game with this API. We are putting immutable fascades over mutable types, but we are being sure to make sure they are not mutated.

N",672393764,2017-04-19 05:47:04
23480979,280540,112085475,23,Cool! I thought they'd be mutated by the cascading calls. Maybe we could encapsulate the mutable values and expose only safe methods? I worry if someone mutates the values by mistake since they are accessible as `CascadingPipe` fields.,672393764,2017-04-19 06:10:52
23480979,280540,112086891,36,"I'm probably missing the big picture, but it seems fragile to rely on the identity hash code of values to determine that two AST nodes represent the same computation. Maybe this discussion doesn't make sense, though. What's the impact if eventually a hash",672393764,2017-04-19 06:21:50
23480979,7111,112087233,36,"if we have to semantically equal but not identical flowDefs it means we may wind up recomputing something (if cascading does not dedup at its level). We could implement a `FlowDef` wrapper that implements a hashCode and equality, but I don't think it is h",672393764,2017-04-19 06:24:34
23480979,280540,112087465,74,"I see. I saw https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/PipeDebug.scala and https://github.com/twitter/scalding/pull/559/files, and thought that we could be losing relevant debug information.",672393764,2017-04-19 06:26:39
23480979,7111,112087513,23,"it would be interesting to think about that, but it is not totally simple. Since we have to get them back out periodically to pass to cascading. We could copy at that point since the performance of planning is not really critical (it is very fast), the ru",672393764,2017-04-19 06:27:07
23480979,280540,112087515,265,???? ,672393764,2017-04-19 06:27:08
23480979,280540,112087638,62,"sounds good, thanks for the clarification",672393764,2017-04-19 06:28:13
23480979,6636815,112098830,44,s/FlattMappings/FlatMappings ?,672393764,2017-04-19 08:19:11
23480979,6636815,112094708,23,Actually I was thinking a inner class would be nice too. I don't mind keeping it in this class (rather than breaking to a separate file),672393764,2017-04-19 07:31:56
23480979,6636815,112270181,82,same for the others below?,672393764,2017-04-20 00:50:14
23480979,6636815,112273915,14,delete? ,672393764,2017-04-20 01:05:14
23480979,6636815,112266201,13,should we move this to a separate package (`cascading`?),672393764,2017-04-20 00:33:40
23480979,6636815,112265853,55,I'm wondering if we could split this up. This method is a super big case match which is a bit hard to read. Would it make sense to move the loop method to each of these specific subclasses? So we'd have overrides for each type of pipe? ,672393764,2017-04-20 00:32:12
23480979,6636815,112278162,46,let's also update the comment at the top of this method. It refers to the old converter / emptyFn etc.,672393764,2017-04-20 01:22:42
23480979,6636815,112269519,82,maybe give this method a nicer name? doFilterKeys? / filterKeys?,672393764,2017-04-20 00:47:21
23480979,6636815,112098694,34,should we move these up? or you wanted to keep them within this object?,672393764,2017-04-19 08:17:50
23480979,7111,112342668,55,"I would really rather not do that since that puts the Pipe on the subclasses of TypedPipe which we are trying to avoid.

The case match is big, but each is a pretty clear block and we have a check that we have a total match.",672393764,2017-04-20 07:20:30
23480979,7111,112342817,82,I don't want to do that because I think it actually obscures things. If scala were smarter with type inference this would not even be needed (note we just define a method to call it). I think keeping a standard pattern here actually serves to tell the rea,672393764,2017-04-20 07:22:00
23480979,7111,112342883,34,I like keeping subclasses of a sealed trait in the companion object to avoid polluting the outer namespace with things that should be implementation details.,672393764,2017-04-20 07:22:36
23480979,7111,112342969,44,???? ,672393764,2017-04-20 07:23:25
23480979,6636815,112496767,34,"ok, sounds good. ",672393764,2017-04-20 23:18:08
23553261,6636815,112587043,52,why not leave the check as earlier in the first filter `t.finishTime > t.startTime`? ,674944095,2017-04-21 07:17:42
23553261,6636815,112584015,76,wondering if this should be parameterized. Is yarn's limit 8GB or is that just the twitter yarn limit? ,674944095,2017-04-21 06:47:28
23553261,6636815,112587785,30,lets keep the comment that was here earlier,674944095,2017-04-21 07:25:58
23553261,6636815,112584402,39,what do you think about breaking out the reducer est related code into a reducer subdirectory and memory estimation code into a memory dir? We can keep the common stuff in the parent,674944095,2017-04-21 06:51:18
23553261,6636815,112586461,64,debug?,674944095,2017-04-21 07:11:05
23553261,6636815,112587601,110,memory estimator?,674944095,2017-04-21 07:23:55
23553261,6636815,112587614,111,memory?,674944095,2017-04-21 07:24:05
23553261,6636815,112587557,89,not set memory?,674944095,2017-04-21 07:23:21
23553261,6636815,112585373,52,how about wrapping the loadClass in a try catch and in case of failures logging an error and failing? ,674944095,2017-04-21 07:00:23
23553261,6636815,112584115,84,there might be a yarn constant for this we should probably use?,674944095,2017-04-21 06:48:28
23553261,6636815,112585896,92,wondering if we could break out the code in these 2 methods into smaller ones. Both of them are doing pretty much the same thing just over different sets of configs - map / reduce. ,674944095,2017-04-21 07:05:23
23553261,6636815,112584590,14,maybe add some docs this trait? what it estimates and constraints on subclasses?,674944095,2017-04-21 06:53:13
23553261,401065,112792192,52,+1,674944095,2017-04-22 06:17:17
23553261,401065,112791736,39,+1,674944095,2017-04-22 06:11:37
23553261,401065,112793427,77,Make this a static method on the companion object?,674944095,2017-04-22 06:33:41
23553261,401065,112792878,8,Suggestion: Add `Mb` to the field names to reduce chance of misusing these params,674944095,2017-04-22 06:26:02
23553261,401065,112792615,87,Can you put this in a separate function so we can add a unit test? This sounds like the thing that will break in the future on some edge case.,674944095,2017-04-22 06:22:33
23553261,401065,112794024,48,"It might be interesting to expose something like these methods as protected methods, as I can imagine we may be interested in trying out different ideas for this:

```
trait MemoryHistoryEstimator extends HistoryEstimator[MemoryEstimate] {
  // ...
 ",674944095,2017-04-22 06:41:58
23553261,401065,112792330,69,Specify units here,674944095,2017-04-22 06:18:51
23553261,401065,112793335,53,"If this isn't something you're going to do in this PR, can you create and link an issue?",674944095,2017-04-22 06:32:26
23553261,401065,112791893,21,Default & estimate of what?,674944095,2017-04-22 06:13:29
23553261,401065,112792535,81,Should we report this change in the logging?,674944095,2017-04-22 06:21:29
23553261,94390,112794220,39,done,674944095,2017-04-22 06:44:25
23553261,94390,113064326,76,done,674944095,2017-04-25 04:44:23
23553261,94390,113075608,84,I don't found any parameter for that. let's make it configurable.,674944095,2017-04-25 05:54:57
23553261,94390,113075973,52,"this exception will be logging by cascading, it's not enough?",674944095,2017-04-25 05:57:39
23553261,94390,113076019,92,done,674944095,2017-04-25 05:58:05
23553261,94390,113076075,64,done,674944095,2017-04-25 05:58:31
23553261,94390,113076319,52,because then I still need `finishedTime` and `startTime` and I need zip them twice. ,674944095,2017-04-25 06:00:37
23553261,94390,113081332,30,done,674944095,2017-04-25 06:43:33
23553261,94390,113083624,14,"added, but I don't see any constraints, acutally.",674944095,2017-04-25 07:04:56
23553261,94390,113083649,89,done,674944095,2017-04-25 07:05:10
23553261,94390,113083719,110,done,674944095,2017-04-25 07:05:52
23553261,94390,113083730,111,done,674944095,2017-04-25 07:05:56
23553261,94390,113083870,21,done,674944095,2017-04-25 07:07:19
23553261,94390,113083932,69,done,674944095,2017-04-25 07:07:59
23553261,94390,113083987,81,not sure that this is useful ,674944095,2017-04-25 07:08:17
23553261,94390,113084210,87,done,674944095,2017-04-25 07:10:17
23553261,94390,113084217,8,done,674944095,2017-04-25 07:10:23
23553261,94390,113084282,48,we can do it in future if somebody will need that.,674944095,2017-04-25 07:11:01
23553261,94390,113084449,77,"not sure, most of the private methods can be static, but I don't see why we need to move them.",674944095,2017-04-25 07:12:24
23553261,6636815,113590021,56,might be a good idea to file an issue for this,677827430,2017-04-27 07:00:24
23553261,6636815,113588585,52,"if the message looks sane (we / users can quickly infer the problem), I'm fine with it. ",674944095,2017-04-27 06:48:38
23553261,6636815,113591417,8,maybe also add a test for when the xmx / xms isn't already set,677827430,2017-04-27 07:12:46
23553261,6636815,113587668,58,do we need the getClass?,677827430,2017-04-27 06:41:16
23553261,6636815,113586898,24,"if this is only used in the reducer estimator we could think of moving it. If not, we should update the log line in the method. ",677827430,2017-04-27 06:34:57
23553261,6636815,113588279,39,null or empty?,677827430,2017-04-27 06:45:49
23553261,6636815,113587940,9,s/map/reduce,677827430,2017-04-27 06:42:58
23553261,401065,114394545,103,Separate arguments and body,677827430,2017-05-03 01:45:36
23553261,401065,114394135,65,Separate arguments from body,677827430,2017-05-03 01:44:10
23553261,401065,114391129,53,"How about `s""No matching history found for $info""` or something? In an execution, I can imagine this getting confusing.",677827430,2017-05-03 01:31:44
23553261,401065,114395330,4,Why are we doing the HRaven upgrade?,677827430,2017-05-03 01:49:02
23553261,401065,114393064,22,What's the convention for naming default implementations? I think we should make it obvious that this is a specific algorithm for estimating the next memory allocations and not the only one.,677827430,2017-05-03 01:39:43
23553261,401065,114391174,56,Same as above,677827430,2017-05-03 01:31:56
23553261,401065,114391599,12,Suffix these with `Millis`?,677827430,2017-05-03 01:33:51
23553261,401065,114394590,135,Separate arguments and body,677827430,2017-05-03 01:45:49
23553261,401065,114393420,34,Can you change the spacing here to separate method arguments from body?,677827430,2017-05-03 01:41:08
23553261,401065,114395043,112,Separate arguments and body,677827430,2017-05-03 01:47:46
23553261,401065,114390723,44,How about `maxHistoryItems`,677827430,2017-05-03 01:30:01
23553261,94390,115382107,58,to understand which one is estimated at now.,677827430,2017-05-09 07:04:02
23553261,94390,115382322,9,done,677827430,2017-05-09 07:05:45
23553261,94390,115382541,39,"yes, done",677827430,2017-05-09 07:07:36
23553261,94390,115382566,56,already have.,677827430,2017-05-09 07:07:51
23553261,94390,115382712,8,done,677827430,2017-05-09 07:09:17
23553261,94390,115382921,44,done,677827430,2017-05-09 07:11:10
23553261,94390,115383032,53,done,677827430,2017-05-09 07:11:57
23553261,94390,115383070,56,done,677827430,2017-05-09 07:12:16
23553261,94390,115383171,12,done,677827430,2017-05-09 07:13:09
23553261,94390,115383450,22,"not sure what name is best for here, do you have something in mind?",677827430,2017-05-09 07:15:27
23553261,94390,115383554,34,done,677827430,2017-05-09 07:16:22
23553261,94390,115383600,65,done,677827430,2017-05-09 07:16:52
23553261,94390,115383647,103,done,677827430,2017-05-09 07:17:14
23553261,94390,115383731,135,done,677827430,2017-05-09 07:17:56
23553261,94390,115383801,112,done,677827430,2017-05-09 07:18:33
23553261,94390,115383887,4,because it has changes in the client to support gzip.,677827430,2017-05-09 07:19:11
23553261,401065,115519760,22,`Default` prefix is OK or `SmoothedHistoryMemoryEstimator`. I'm not sure.,677827430,2017-05-09 22:24:47
23553261,94390,115560767,22,done,677827430,2017-05-10 01:09:29
23553261,401065,115860043,40,What are these `details` for? Could we replace this with a type parameter or inner type variable?,689122962,2017-05-11 04:42:31
23553261,94390,115863098,40,details -- details about `Task` that interesting for each estimator and extracted from `TaskDetails`.,689122962,2017-05-11 04:58:16
23553261,1443419,120188512,52,"Please catch Throwable around estimation, such that even fatal falls back on user-specified values.",674944095,2017-06-06 02:29:00
23553261,1443419,120189001,52,Let us disable estimation for hdfs-local and small jobs where small is defined with some parameter. E.g: don't bother memory-estimate jobs with less than 10 containers.,674944095,2017-06-06 02:31:25
23553261,1443419,121316488,15,there should be some configurable max like 5% for GCTImeMs/CpuMs to correct under-provisioned Xmx.,695427278,2017-06-12 13:19:25
23715565,6636815,112994828,65,maybe cite the github issue so that we dont lose track of it?,676964011,2017-04-24 23:34:16
23793247,401065,113072053,9,Can you add a reference to an issue or Kryo API or something?,677736550,2017-04-25 05:29:21
24116907,319889,114673821,150,"Since i'm reading this, any thoughts on how we should handle this instead. Not for doing in this PR obviously. I'm guessing we don't run the cleanup right now because we might have done a toIterableExecution and are using it post the run? ",684721888,2017-05-04 06:09:05
24116907,7111,114676870,150,"It's a good question. I'm currently thinking of making some methods like:
```scala
object Execution {
  def forceToDisk[T](t: TypedPipe[T]): Execution[TypedPipe[T]] = ...
  def toIterable[T](t: TypedPipe[T]): Execution[Iterable[T]] = ...
}
```
and ",684721888,2017-05-04 06:33:12
24116907,7111,114677054,150,"I wasn't that clear: if we do the above, the logic about cleanup files can happen when you do forceToDisk, which Writer is driving, so it can keep the list of clean-up files it needs.",684721888,2017-05-04 06:34:34
24116907,319889,114699652,150,"Yeah i like this ^^ makes it more pluggable, and ultimately separating the 2 notions inside the execution feels like a good place to handle it. The question of maybe when to do the delete is still rough but not sure what to do there. I don't know if we ca",684721888,2017-05-04 11:47:24
24116907,401065,114890606,233,Do we need to change the visibility of these?,684721888,2017-05-05 04:20:50
24116907,401065,115096768,71,"""submit run""",684721888,2017-05-06 05:12:21
24116907,401065,115099802,148,Why the addition?,684721888,2017-05-06 05:40:29
24116907,401065,115097657,159,This is already defined elsewhere. Can we just put it in some central place or use bijection's or inline it?,684721888,2017-05-06 05:20:55
24116907,7111,115104226,233,"Yes, the idea is that we want to be able to write new backends. To do that, you will need to be able to see these types (so, in this case AsyncFlowDefRunner needs to be able to pattern match on them).",684721888,2017-05-06 06:27:49
24116907,7111,115104265,148,The previous stuff was not thread safe.,684721888,2017-05-06 06:28:19
24116907,7111,115104355,159,"It's so simple, I hear you, but I don't want to make a public API which we can't delete, not use add a bunch of syntax to call bijection here. Can we let this minor duplication slide?",684721888,2017-05-06 06:29:25
24201544,401065,115508123,63,This is much easier to read :),686535467,2017-05-09 21:43:47
24201544,401065,115334857,77,Why not also make this part of the interface like in `#start()` instead of matching? Do we anticipate handling writers differently?,686535467,2017-05-09 02:40:57
24201544,401065,115510179,71,I find this a little hard to read because of the use of `S` and `s` and I anticipate people unfamiliar with this construct will find it confusing. Can we use `R` and `result` instead or some more verbose in the naming?,686535467,2017-05-09 21:51:29
24201544,401065,115508338,28,Duplicate comment,686535467,2017-05-09 21:44:40
24201544,319889,115539309,77,I'm not sure we can easily do this differently with the current interface -- in that FlowDefExecution is tied to cascading. this match would eventually go away with a more cross platform interface I would think. Since we would want to eventually get refer,686535467,2017-05-09 23:41:46
24201544,7111,115551250,77,what Ian said. The goal here is to make hopefully all of the typed API not depend on cascading and just make the cascading backend one implementation. I think no one uses this function anyway (creating an Execution from a FlowDef) and I want to just remov,686535467,2017-05-10 00:31:45
24201544,7111,115551358,63,:),686535467,2017-05-10 00:32:13
24201544,7111,115551443,28,that's a merge issue I think... :/,686535467,2017-05-10 00:32:32
24201544,7111,115552094,71,"can you be concrete about how you want to change this? These is only one variable here, the state and you are copying that to be the result. Can you write the code you want me to replace it with because I don't follow your comment.",686535467,2017-05-10 00:35:00
24201544,7111,115553237,196,"First note, I didn't change that, I just captured the future into a name so I could use a for comprehension and have it read nicer, in my opinion.

About how this works, I hope the code is somewhat readable, but it is not simple. This is where a lot of ",686535467,2017-05-10 00:39:40
24201544,319889,115565972,36,do we need the mutex rather than self? ,686535467,2017-05-10 01:29:25
24201544,7111,115566265,36,personal OCD. I don't like to lock things others can see. I always like to lock a private val.,686535467,2017-05-10 01:30:33
24201544,401065,115575758,196,"Ya I was just a little confused by what was going on here in the old code. I think it makes sense now. I think the concept of ""we"" and ""someoneElse"" was not clear to me before.",686535467,2017-05-10 02:07:58
24201544,401065,115570950,71,"Sure something along the lines of

```scala
private def updateState[R](modify: State => (State, R)): R =
  mutex.synchronized {
    val (newState, result) = modify(state)
    state = newState
    result 
  }
private def getState: State =
  // Ex",686535467,2017-05-10 01:49:14
24201544,401065,115579089,77,"We do have a few `#fromFn` uses in our code, specifically in a couple places where we have `FlowDef => Unit` functions to accommodate both `Job` & `Execution`. Deprecation is definitely a good idea though.",686535467,2017-05-10 02:20:32
24201544,401065,115581754,77,"Something along these lines:

```scala

def planScaldingJob(flowDef: FlowDef): Unit = ???

Execution.fromFn {
  val flowDef = new FlowDef
  planScalding(flowDef)
  flowDef
}

class MyJob extends Job {
  override def buildFlow = {
    planSca",686535467,2017-05-10 02:33:14
24201544,401065,115506745,196,So this `localFlowDefCountersFuture` is a `Future` for the stats from finishing the cascading flow?,686535467,2017-05-09 21:38:44
24201544,7111,115630365,71,I'll sweep this change into the next one if that's okay.,686535467,2017-05-10 07:07:22
24201544,401065,115753134,71,Sure.,686535467,2017-05-10 21:20:03
24244924,319889,115267190,2,"Do you think we can pull this method out into an implicit on the typed pipe type in a cascading package/some other package possibly and delurk them from here entirely? its not binary compatible, but if we split scalding-core into some sort of scalding-typ",687538904,2017-05-08 21:52:28
24244924,319889,115268075,39,"might be worth a quick comment on this and loop below just to say what they do.

This i think means we merge our new flow def from the cascading pipe with an historical one, flatMap with the function we kept inside the pipe, finally applying the descrip",687538904,2017-05-08 21:55:34
24244924,7111,115312052,2,"I do think so, the only question is when to do that. I think we can basically pull all the cascading specific stuff into an enrichment now and stay source compatible. I think your plan is exactly what I want to drive towards: scalding-typed is a dependenc",687538904,2017-05-09 00:58:35
24244924,280540,115318364,2,:+1: to postponing the decision on how we're going deal with the cascading dependency. I think it's a separate discussion.,687538904,2017-05-09 01:25:10
24749306,134219,117800175,16,`TypedPipe.empty` makes more sense to me.,698374698,2017-05-23 00:21:34
24840369,7111,118604674,14,`tut`!!!!,700161380,2017-05-26 06:04:52
24840369,401065,118604969,14,Haha,700161380,2017-05-26 06:07:30
25059840,280540,119690381,30,"I think it's fine to catch the errors and fall back to empty Set, but we should make the try block as specific as possible. It seems that it could wrap only `mirror.classSymbol` and catch only these cases:

1. RuntimeException with message containing th",705169961,2017-06-02 01:15:44
25059840,6636815,119693042,30,"Yeah I don't mind a specific try block and only catching those 2 exceptions. We'd work around the 2 issues we've seen so far. Risk is if there are others, we'll find out with job failures rather than an error in the logs. Given that this feature / functio",705169961,2017-06-02 01:26:32
25141059,401065,120424295,43,Will this `Map` work if we read from and write to the same path at different points during the flow?,706794305,2017-06-07 00:22:20
25141059,401065,120422139,33,Just to clarify: This is like STM where you're only making the change if the initial conditions when calling `fn` are met? Could this loop forever if there is another thread that consistently gets scheduled between the read and write?,706794305,2017-06-07 00:13:02
25141059,401065,120423701,50,These are just not implemented yet? Is there an exception we could throw instead of using undefined? Or is this the standard for scala?,706794305,2017-06-07 00:19:57
25141059,401065,120427742,152,Can we rename for clarity to like `valuesGroupedByKey` or something?,706794305,2017-06-07 00:35:25
25141059,7111,120432754,33,"yes. But I don't think that can happen because we only mutate it when jobs finish and there are only a finite number of jobs running at a time, so I think it is exponentially unlikely that they do spin forever.",706794305,2017-06-07 00:54:07
25141059,7111,120433047,43,"yes, because the sinks and sources are separate. You can't make a source EXCEPT something that is already a list on this platform.",706794305,2017-06-07 00:55:17
25141059,7111,120433379,50,"These cannot be implemented because this platform does not know about cascading. Ultimately I'd like to remove these methods from `Mode` and move them down to a class like `CascadingBackedMode`, but I want to do that with your help since you likely have s",706794305,2017-06-07 00:56:29
25141059,280540,120456014,280,unnecessary? ,706794305,2017-06-07 02:22:25
25141059,280540,120456338,315,it might be worth adding a `map` method to avoid creating one list for each element.,706794305,2017-06-07 02:24:02
25141059,280540,120455423,227,ditto,706794305,2017-06-07 02:20:01
25141059,280540,120454937,80,"I find the naming here confusing. `flatMap` indicates a monad, but function doesn't return a monad instance. Also, it's strange the implementation creates a `Map` for a `flatMap`. Maybe the method could be called `mapValues` and the implementation be on t",706794305,2017-06-07 02:17:59
25141059,280540,120456150,305,unnecessary?,706794305,2017-06-07 02:23:05
25141059,280540,120455157,181,inline as well?,706794305,2017-06-07 02:18:50
25141059,280540,120456625,326,wdyt about explaining how the user can fix the error in the exception message?,706794305,2017-06-07 02:25:24
25141059,280540,120455385,218,add a comment or a specific exception with more context,706794305,2017-06-07 02:19:47
25141059,280540,120457580,438,could it be `private[this]`?,706794305,2017-06-07 02:28:52
25141059,280540,120455033,83,wdyt about `transform` instead of `mapAll`?,706794305,2017-06-07 02:18:23
25141059,280540,120448972,50,@johnynek could you add a comment or a specific exception with this explanation?,706794305,2017-06-07 01:52:58
25141059,280540,120450138,78,Would this new mode be used only for testing? I think a simpler synchronous implementation without parallellism would suffice for that.,706794305,2017-06-07 01:57:49
25141059,280540,120457560,432,could it be `private[this]`?,706794305,2017-06-07 02:28:47
25141059,280540,120452486,119,Why not inline these? They will run in parallel regardless.,706794305,2017-06-07 02:07:52
25141059,7111,120715998,78,I want to actually make this production grade as we move forward. I don't think it will be *that* hard. So I don't want to back out the design of using Futures since a better system will have more explicit parallelism.,706794305,2017-06-08 01:58:57
25141059,7111,120716337,80,"I hear you on `flatMap`. I can rename concatMap, but the fact is we used `flatMap` for scalding to make it a bit easier for newbies to scala (since it is like flatMap on List in that List accepts a similarly broad return type). `TypedPipe[T]` is definitel",706794305,2017-06-08 02:00:23
25141059,7111,120716364,83,sure.,706794305,2017-06-08 02:00:30
25141059,7111,120716490,119,"bad comment from when I did `for { }` which is not parallel unless we start the futures first. Now, it doesn't matter (using zip).",706794305,2017-06-08 02:01:04
25141059,7111,120716576,280,"yeah, left over copypasta.",706794305,2017-06-08 02:01:25
25141059,7111,120716617,315,+1.,706794305,2017-06-08 02:01:35
25141059,7111,120716742,438,yes.,706794305,2017-06-08 02:02:07
25141059,7111,120716708,432,yes.,706794305,2017-06-08 02:02:00
25141059,280540,120726415,78,"Fair enough. I think `Future` might not be the best tool to achieve parallelism given its high execution overhead, but I think it's fine to use `Future` for now and revisit the decision if necessary.",706794305,2017-06-08 02:45:59
25141059,280540,120726920,80,thanks!,706794305,2017-06-08 02:48:21
25141059,6636815,120168725,48,throw an exception instead? this will evaluate to a NotImplementedError which might lead the caller / user to think it's a implementation bug?,706794305,2017-06-06 00:55:08
25141059,6636815,120791625,80,could we name the generic type something else rather than O1? ,706794305,2017-06-08 10:07:52
25141059,6636815,120792983,360,here too?,706794305,2017-06-08 10:24:20
25141059,6636815,120792947,352,throw not yet implemented exception?,706794305,2017-06-08 10:24:05
25141059,6636815,120791737,83,"something apart from O1, O2?",706794305,2017-06-08 10:09:33
25141059,6636815,120793121,387,should this be a todo?,706794305,2017-06-08 10:25:09
25141059,6636815,120790838,32,do we need to worry about fn being computationally expensive? We could call and cache the value in the enclosing method if that's the case,706794305,2017-06-08 09:59:51
25141059,7111,123665658,352,`???` means not implemented.,706794305,2017-06-23 10:30:36
25141059,7111,123665667,360,same.,706794305,2017-06-23 10:30:42
25141059,280540,123798896,32,"If I understood correctly the purpose of this class, caching doesn't seem possible since `fn` depends on the current value and needs to be computed on each retry (the value will be different on each retry). @johnynek maybe renaming `loop` to `retry` would",706794305,2017-06-24 00:07:50
26443190,7111,127100247,7,"wait, didn't we lose `2.12` CI here?",735737118,2017-07-13 06:50:43
26443190,7111,127100312,7,oh nope. sorry.,735737118,2017-07-13 06:51:03
26443190,7111,127100430,1,would be nice to turn mima back on in this PR or I guess the next and make sure we are compatibile with `0.17.0`.,735737118,2017-07-13 06:51:53
26443190,6636815,127104687,1,Yeah I was going to follow up with a PR to set mima against 0.17.0 and also enable it in the `run_test.sh` script,735737118,2017-07-13 07:29:30
26492341,7111,127521076,5,we should automate this: we could have the build create a file and we could import that file to get the version (I have seen people do something similar for the git-sha which would also be nice.,737183339,2017-07-15 01:30:19
27192089,134219,131240072,23,"Do we really want to keep it inheritance based here? Why don't do class instead (with `nodes` and `dependenciesOf` (or even just `Map[T, List[T]]`) as an input)?",752164774,2017-08-04 02:38:04
27192089,134219,131289931,32,"This represents something similar `Expr` but without `Id`s, right? Do we want to carry both of them?",752164774,2017-08-04 07:28:17
27192089,134219,131289749,20,Should be addressed I guess?,752164774,2017-08-04 07:26:20
27192089,134219,131290247,72,I don't really understand why it's `trait`.,752164774,2017-08-04 07:31:36
27192089,134219,131291081,22,Same as `DependantGraph`,752164774,2017-08-04 07:39:38
27192089,134219,131288715,52,"We don't really need to override `evaluate` here, right?",752164774,2017-08-04 07:16:34
27192089,134219,131290520,85,"This class is expected to be immutable, right? nit: Then this `nextId` is misleading. I guess something like `maxId` is better, but not sure.",752164774,2017-08-04 07:34:25
27192089,134219,131287929,52,I don't think it should be `Option[Int]`,752164774,2017-08-04 07:09:09
27192089,134219,131279244,39,Why `graph` made this way while other things (ie `transitiveDependantsOf`) made other way?,752164774,2017-08-04 05:55:29
27192089,134219,131287966,49,Just `List[T]`?,752164774,2017-08-04 07:09:26
27192089,134219,131287996,47,Just `Int`?,752164774,2017-08-04 07:09:42
27192089,134219,131290174,23,"This class in general is something unrelated to other classes, I don't think we want to copy it here.",752164774,2017-08-04 07:30:42
27192089,7111,131522295,23,I think we do want it. It allows you to reverse the dependency graph to see what depends on a given node. That is often useful when doing graph walks.,752164774,2017-08-05 20:47:31
27192089,7111,131522302,47,Option because the node may not be in the graph.,752164774,2017-08-05 20:48:07
27192089,7111,131522305,49,same comment about Option.,752164774,2017-08-05 20:48:15
27192089,7111,131522307,52,same comment... Node may not be in the graph.,752164774,2017-08-05 20:48:31
27192089,7111,131522543,72,"well, this is a common scala issue. `sealed abstract class` is fine too. I'm happy to make that change in a following PR. In scala 2.12, I don't think there is a big cost. Honestly, this trait/abstract class distinction is a real issue in learning scala. ",752164774,2017-08-05 21:03:55
27192089,7111,131522404,20,"I think so, I can fix in a follow up PR.",752164774,2017-08-05 20:53:35
27192089,7111,131522392,39,"this is expensive, so it was made lazy in case you don't actually need it. You may only want depths, for instance.

We could reconsider that, but I'm reluctant to refactor while copying the code since it makes the history harder to follow. An exact copy",752164774,2017-08-05 20:52:36
27192089,7111,131522559,85,"this is immutable, yes. This will be the id of the next `Id` node: https://github.com/twitter/scalding/pull/1711/files/f4b77ce5a70c76568117b9b24f534bea8b124ac5#diff-8fde3d3d5fd7e43cad322bdbb784c5eaR213 which I think is an accurate name.",752164774,2017-08-05 21:05:12
27192089,7111,131522463,32,"Yeah, I think we could not have both of them if we really want to remove them. The difference is `Expr` has variables and can point with `Var`. Literal does not have that and everything has been fully evaluated.

Again, we can try to rewrite this code a",752164774,2017-08-05 20:58:42
27192089,7111,131522396,52,I guess not. But I'd rather do refactoring separately from the copy.,752164774,2017-08-05 20:53:05
27192089,134219,131735690,23,"Yes, it's useful, sure, just feels completely separate. I'm not against of copying it actually. Let's do that.",752164774,2017-08-08 01:53:42
27192089,134219,131735914,39,"I see the point of ""just copy"", but I'm afraid we will not change it then forever =) ",752164774,2017-08-08 01:54:44
27192089,134219,131736172,47,"Hm, I see. Then I prefer to have a comment about this.",752164774,2017-08-08 01:55:46
27192089,134219,131736441,72,My question was more - why it should be abstract at all?,752164774,2017-08-08 01:56:59
27192089,134219,131736735,85,"Yes, I understand how it used, but I think it's better to describe what is it, not how it used because former contains mutability semantic.

But I'm ok to keep it as is.",752164774,2017-08-08 01:58:16
27391885,6636815,133831418,18,should we extract this to a helper method in TypedPipe? it's identical to the code in CascadingBackend for `dependants` right?,756480522,2017-08-18 04:16:46
27391885,6636815,133829215,9,"to confirm, you're using Any here cause we don't know of the types of the dependency TypedPipes right?",756480522,2017-08-18 04:07:35
27391885,7111,133845512,9,"yes (and TypedPipe is covariant, so all of them can be considered as Any).",756480522,2017-08-18 05:33:44
27391885,7111,133845713,18,"it's not. This one has a number of written pipes, the CascadingBackend works for a single pipe.",756480522,2017-08-18 05:35:15
27391885,7111,133845935,18,"actually, you are right. It's the same (we just call it with a single pipe). I will combine.",756480522,2017-08-18 05:36:43
28943220,7111,140630279,34,this is a very rarely used method but it was giving me trouble with the two type parameters. I think this is a cleaner implementation anyway since it makes it clear that it returns the exact same type as the original pipe.,789476189,2017-09-23 16:45:46
28943220,6636815,140794544,42,"I'm not clear as to why the implicit class is needed here. Why not leave as a method in the TypedPipe trait (as before, just with the `T` param)? ",789712706,2017-09-25 21:36:33
28943220,6636815,140748304,6,how about naming this LiteralPipe?,789712706,2017-09-25 18:17:20
28943220,6636815,140802508,92,what do you think about breaking out the handle* methods in different src files? Feel it might improve readability as we won't have a ton of code in one src file. ,789712706,2017-09-25 22:00:59
28943220,7111,140842937,92,"If we do that, they can't be private. That has binary compatibility issues and also just general API issues.

I'd prefer to keep them private.",789712706,2017-09-26 00:28:42
28943220,7111,140843605,42,"Since `TypedPipe[+T]` is covariant, and so it `TupleConverter[+T]`, you can't accept a TupleConverter as a parameter to TypedPipe. That is why we had `[T, U >: T]` and took `TupleConverter[U]`. However, this really complicates the case class on matches.
",789712706,2017-09-26 00:31:08
28943220,6636815,140983215,42,"Ah ok, thanks for clarifying. ",789712706,2017-09-26 15:06:46
28943220,6636815,140983753,92,"Hmm yeah, that's true.",789712706,2017-09-26 15:09:04
28943220,17013,141163589,186,"We don't need this comment, because we aren't casting here.",792735862,2017-09-27 02:46:48
28943220,17013,141164118,193,"Some of these widens might not be needed, since the `go` method is returning `LiteralPipe[(K, V)]` already.",792735862,2017-09-27 02:48:53
28943220,17013,141165498,34,+1,789476189,2017-09-27 02:54:29
28943220,319889,141239887,36,`a` and `b` are types here right? any reason they aren't upper case?,793349391,2017-09-27 10:57:15
28945611,6636815,140639958,5,might have been nice if we could tie this to a scalding version. E.g. deprecated since 0.17.1 or so..,789495396,2017-09-24 02:19:49
28945611,7111,140640294,5,I can fix that.,789495396,2017-09-24 02:40:38
29008341,319889,140911469,88,"This rule i'm not sure in a MR context what the gain is. I think deferring the merge is only useful for filters maybe? since if you have two steps

M -> R1
M -> R2
and do some (R1 ++ R2).filter(...) we know it should be good. But doing flatmaps and ma",791067896,2017-09-26 05:05:13
29008341,319889,140912178,116,Very nice! this is a great optimization to get in,791067896,2017-09-26 05:08:26
29008341,7111,140913989,88,"as I mentioned in the comment, if you can defer the merge until a groupBy, scalding can skip doing any work. In tez, if not, that is actually an extra materialization. On MR, cascading applies this same optimization under the hood (but not, for some reaso",791067896,2017-09-26 05:18:07
29008341,319889,140917154,88,"Which side do the functions goto in a group by, this might change how things get planned on MR negatively?

I.e.
```
M -> R1
M -> R2
(R1 ++ R2).flatMap { huge data cubing function}.sumByKey
```
If the flat map is pushed through the merge its more ",791067896,2017-09-26 05:35:51
29008341,6636815,141551959,5,is the `@unchecked` something we can move to the start of the case?,791067896,2017-09-28 15:12:00
29008341,6636815,141553721,79,This is something that has tripped a lot of first time users of scalding. Should we add a warning log line when this rule is being applied to say that we're ignoring the group? ,791067896,2017-09-28 15:20:24
29008341,6636815,141552585,20,wondering if it would be a good idea to include a short snippet of code as a comment on the top of each rule showing which scenario it gets applied in? ,791067896,2017-09-28 15:15:19
29008341,6636815,141554896,88,@ianoc - yeah I think I ran into the merge + map + groupBy issue in cascading 3 - https://github.com/cwensel/cascading/pull/59. From what I remember there was an extra merge node. ,791067896,2017-09-28 15:25:48
29008341,7111,142018798,79,"Adding a warning log line is not a bad idea in general. Not sure the right place to do that. I kind of hate to do it in the optimizer, since you might not even be running the result. Let me think about it.",791067896,2017-10-01 08:50:35
29008341,319889,142487580,11,"Can you add a comment on this method? (motivation as much as anything -- not sure why we would normally want to turn a hash join into a JoinFn normally?) 

also I think we can use the `HashJoinFn[K, V, U,R]` type alias as the type of the arg to this met",798185492,2017-10-04 01:42:46
29008341,319889,142490593,58,when/where do we use an OnComplete (i.e. given its a side effect do we need to ensure all of these are ran // do try/error handling around each invocation?),798185492,2017-10-04 01:54:49
29008341,7111,142535450,58,"I don't think we ever do. Users at Twitter used this to make some call to an API after they finished doing some side-effecting map or reduce. Other users have asked for it. I kind of hate the API now since I think it is an anti-pattern, but alas, I don't ",798185492,2017-10-04 05:00:41
29008341,7111,142541022,11,"will do these in the follow up, if that's okay.

We never use this method in fact, but I didn't want to remove it in the interest of being a nice guy to users that may be.",798185492,2017-10-04 05:30:09
29008341,319889,142570003,11,Yep totes. and makes sense to leave or kill for the obvious reasons to do either,798185492,2017-10-04 09:33:59
29034587,7111,140842256,13,I don't *think* you need `{}`,790895829,2017-09-26 00:26:14
29034587,7111,140856736,207,"I had to remove a bunch of these since they were calling `toTermName` on things that were already `TermName`, but I guess with `blackbox` this changed?",790957110,2017-09-26 01:19:09
29034587,32164772,140884407,207,I suspect i've glossed over some of those warnings migrating in bulk the code with the fixes in it. I'll do a clean compile or two to make sure i've not added new warnings.,790957110,2017-09-26 03:11:39
29037555,319889,140861630,13,this should be private (but not private[this]),790935302,2017-09-26 01:36:53
29037555,319889,140861752,22,"If we can skip all the logging maybe we can make it more idomatic/shorter? (is the logging useful/going to be read? 

```
Option(fp.getReporter).flatMap { reporter =>
   Option(reporter.getCounter(statKey.group, statKey.counter)).flatMap(identity)
}",790935302,2017-09-26 01:37:11
29037555,7111,140865536,22,"or even:
```scala
(for {
 rep <- Option(fp.getReporter)
 cnt <- Option(reporter.getCounter(statKey.group, statKey.counter))
} yield cnt).fold {
  logger.warn(s""Cannot increment counter(${statKey.group}, ${statKey.counter}) because HadoopFlowProcess.",790935302,2017-09-26 01:51:49
29037555,390182,140887777,22,"I have more logging in my company's fork of Scalding in order to try and track down the issue. I didn't want to include that full logging in this PR, but that makes this logging not useful. I'll remove the logging.",790935302,2017-09-26 03:25:32
29037555,390182,140888284,22,Although a warning the first time would be useful so people can figure out why the counter was not incremented.,790935302,2017-09-26 03:27:31
29100526,7111,141226910,18,I don't understand this pattern. Can you document it or link to an explanation? I know @travisbrown likes it.,793427190,2017-09-27 08:39:50
29100526,7111,141227181,7,are we actually calling this anywhere?,793427190,2017-09-27 08:42:01
29100526,7111,141226760,2,"can we skip the bogus copyright?

1) year is wrong
2) stripe is maybe paying you to write this code.",793427190,2017-09-27 08:38:10
29100526,319889,141229135,18,"The general gist is just that by supplying instances of `Exported` you can import an object/package supplying them and inject them at a lower priority than a normal import.

So here if you import the default object it would just supply low priority impl",793427190,2017-09-27 09:03:02
29100526,319889,141229230,7,"Nope, i think its killable/not sure if adds something. Was discussing that with @travisbrown towards EOD here. ",793427190,2017-09-27 09:04:00
29100526,319889,141229521,2,Yeah i was going to ask you if you thought we need to put the licence and/or copyright in these at all,793427190,2017-09-27 09:07:11
29100526,146404,141374212,77,Is the `_root_` just an artifact of a previous macro context?,793427190,2017-09-27 22:09:26
29100526,146404,141376847,14,It'd be nice to have a test confirming that an explicit instance doesn't get overridden by the `DefaultOrderedSerialization` import.,793427190,2017-09-27 22:17:51
29100526,146404,141376451,7,"Right now the only exported instance has a concrete type, but once you have generically derived ones the macro here will be necessary (although it turns out it doesn't need to be whitebox, I believe). I've got some notes on this from when I was prepping [",793427190,2017-09-27 22:16:33
29100526,32164772,141390392,14,"Done, did a test with a companion object defined ordered serialization not being overridden",793427190,2017-09-27 23:00:23
29100526,32164772,141390454,77,"Yep, i've cleaned these up i think so it should be more sane now",793427190,2017-09-27 23:00:41
29100526,7111,141416912,52,"here, `unsafeWrite` could have a size if the original did, but then I guess you could add two sizes, couldn't you (since above we might call `noLengthWrite`)?",794145237,2017-09-28 00:43:01
29100526,7111,141415924,45,this implies that `unsafeWrite` means no size. Can we add that to the comments below?,794145237,2017-09-28 00:39:05
29100526,7111,141416375,24,"can we drop `java.io`? Also, I think this has to be the unsized output if there is ever a size header added, right? It seems confusing above since it is used that way, but it is not clear.

It may or may not be sized? Can you add some laws about how to ",794145237,2017-09-28 00:40:55
29100526,7111,141416443,26,what is the contract here? Again similar concerns as above.,794145237,2017-09-28 00:41:12
29100526,7111,141417701,37,do we write an additional length header on this thing currently?,794145237,2017-09-28 00:46:06
29100526,32164772,141419657,37,"Yep we always write a length header for ByteBuffers in the existing master
https://github.com/twitter/scalding/blob/develop/scalding-serialization/src/main/scala/com/twitter/scalding/serialization/macros/impl/ordered_serialization/providers/ByteBufferOrd",794145237,2017-09-28 00:53:26
29100526,32164772,141420331,45,"It implies no outer size, it can be a bit wasteful. I'm adding a comment to the definition of this method that I hope will help here a little:
```
  // This will write out the interior data as a blob with no prepended length
  // This means binary comp",794145237,2017-09-28 00:55:57
29100526,7111,143098259,9,"I get really worried about how to compose methods like this that lack a strong contract. Also, I don't see that we ever call this.",794274476,2017-10-06 09:17:19
29100526,7111,143098313,57,should this be final?,794274476,2017-10-06 09:17:58
29100526,7111,143098324,66,can this be final?,794274476,2017-10-06 09:18:04
29100526,7111,143097900,18,"I think we may want `def skip(count: Int, in: InputStream): Try[Unit]`  so in say `List[T]` we can skip the rest of the collection. If `count <= 0` do nothing, and otherwise in the worst case just read and throw them away as you do below.",794274476,2017-10-06 09:12:26
29448124,319889,142978971,70,In Dagon rule optimization does it support this notion? I.e. do you run each rule to stability or do you run all the rules in a loop? ,800159519,2017-10-05 22:49:19
29448124,319889,142979349,76,ooc how type safe are these rule writing's? if you swapped f and g here would this still compile? ,800159519,2017-10-05 22:50:46
29448124,319889,142980205,131,"For this one, i think we need to do this to enable function coalescing in Dagon/scalding right?",800159519,2017-10-05 22:53:51
29448124,319889,142985616,46,merge from doesn't mutate `localFlowDef` i imagine? ,800159519,2017-10-05 23:13:54
29448124,7111,142985755,76,"It’s type-safe. It would not compile if you swapped the functions since the result type wouldn’t be a `TypedPipe[T]`

That’s the exciting part of Dagon!",800159519,2017-10-05 23:14:25
29448124,7111,142985981,70,"Rules don’t, but you can apply a sequence of rules to do this (although, I forgot to use that API in this PR. Using it will clean it up a bit)",800159519,2017-10-05 23:15:21
29448124,7111,142986682,131,"Yeah. That’s why I added it. Actually, traps seem to require function coalescing due to the strange way they work. Traps are not totally safe currently it seems and can still throw runtime exceptions if the user confuses cascading.

I think we can make ",800159519,2017-10-05 23:18:07
29448124,319889,143004932,163,"This seems odd here, maybe a comment as to why its not just in the optimizer flow and we need it here too? ",800159519,2017-10-06 00:32:16
29448124,319889,143006701,131,Ha i remember you not being a huge fan of them when they were added. I believe we could implement them in scalding land instead at some point -- and actually just make them work on spark too in the same way ish? some sort of withSideEffectingTry() which i,800159519,2017-10-06 00:39:23
29448124,7111,143006957,163,"the reason is Merge has arity 2, but cascading merge can take a list. I don't *think* cascading is happy if you pass it a merge with no items, and I didn't want to do one with a single merge, but that maybe is a call.

So, we really have to unroll or we",800159519,2017-10-06 00:40:32
29448124,7111,143007072,46,"that's right. We have been using that for a while. It mutates the left, but not the right.",800159519,2017-10-06 00:41:03
29448124,319889,143010320,163,So it might be leaky but i'd have thought that maybe in an ideal we would be able to have the invariant for this operator that if we see a MergedTypedPipe post optimization it should always just be 2 pipes. But it does mean we would need to introduce a ne,800159519,2017-10-06 00:53:16
29448124,319889,143010819,46,???? ,800159519,2017-10-06 00:55:21
29448124,319889,143010866,76,???? !,800159519,2017-10-06 00:55:31
29591419,319889,143535829,20,is this force a Force from a force to disk or a force to disk execution?,803434768,2017-10-10 00:50:38
29591419,319889,143537706,10,why did we make this change? I guess it should be ok now with the better optimizer? i'm guessing before we needed to do it the first way to avoid re-computation? ,803434768,2017-10-10 00:58:17
29591419,319889,143539518,20,could we comment on this field,803434768,2017-10-10 01:06:50
29591419,319889,143539525,31,"could you expand on this comment

Returns true if we will add to our forced pipes, false if cache hit and noop. I think? ",803434768,2017-10-10 01:06:51
29591419,319889,143544342,21,"probably worth ensuring we have good comments on all the state fields here (i know this is old, but helps review/reading). i.e. does force mean the same as in terms of the TypedPipe force to disk. Is it something we need to materialize as an output. And i",803434768,2017-10-10 01:28:29
29591419,7111,143556258,20,ForceToDiskExecution.,803434768,2017-10-10 02:25:31
29591419,7111,143556547,10,"I'm not sure why it was ever the other way. Many `.writes` are not consumed. But by putting the fork before, you are always going to do some extra boxing in and out of a single tuple.

I can revert it, I don't think tests pass or fail either way. We rea",803434768,2017-10-10 02:26:47
29591419,7111,143556769,31,"yes. The thing is, writes are side-effects. We only want to take that side effect once. So, if you return true, we should actually do the side effect. I'll update the comment.",803434768,2017-10-10 02:27:46
29591419,319889,143566730,76,If we are optimizing on toPipe does the optimization rules in the Execution have any effect?,803434768,2017-10-10 03:16:46
29591419,7111,143566974,76,we are careful to avoid calling `toPipe` in Execution. We call `toPipeUnoptimized`. This is because we want to do the optimization on the whole graph (multiple sinks) that Execution can see. This is likely to be better and allow more aggressive optimizati,803434768,2017-10-10 03:18:11
29591419,319889,143568531,76,Do we not hit toPipe going in and out of groupBy's? ,803434768,2017-10-10 03:25:59
30615707,7111,148155267,6,"can we remove this and instead do:
`override def setter[U <: String] = TupleSetter.asSubSetter[String, U](TupleSetter.of[String])` taking the implicit in the constructor changes the binary compatibility without a need that I see.",824030400,2017-11-01 06:44:20
30615707,7111,148117981,15,does this need to be implicit? And can it be `private[this] val...`,823908339,2017-11-01 03:28:15
30615707,41405,148159542,6,oh cool! kk,824030400,2017-11-01 07:16:42
30773147,7111,148919413,91,"this was unsafe. If `Fork(nonFork)` already exists, then replacing `nonFork` with `Fork(nonFork)` creates an infinite loop.",826960687,2017-11-04 08:29:17
32107092,7111,155315890,30,"do we need to add this, or can you put it in your personal `~/.sbt` directory?",856760671,2017-12-07 02:11:03
32107092,7111,155316769,13,can you add a comment why we need the `q` here? This is not a method users should really ever be using (only people writing backends).,856760671,2017-12-07 02:14:43
32107092,7111,155316841,22,same question. Can you add a comment to why we need q here?,856760671,2017-12-07 02:15:00
32107092,280540,155654097,13,I had added it because `FilterKeys.input` creates a `TypedPipe`. I reverted these methods and used `Quoted.internal`.,856760671,2017-12-08 06:03:05
32107092,280540,155654524,30,"it's convenient for me because I work on projects that require different versions of the plugin so it can't be on `~/.sbt`. It's fine, I'll revert this change.",856760671,2017-12-08 06:05:04
32107092,7111,162752414,19,"can we put the return type on this public method?

I'm confused where Quotations are coming into the picture here. Can you comment?",883048286,2018-01-20 06:57:28
32107092,7111,162753660,95,"wow, this is pretty nice...

Okay...",883048286,2018-01-20 07:05:09
32349058,7111,156231900,4,can we move the default implementation here? Looks like both cases have the same implementation.,862127051,2017-12-12 07:25:15
32349058,7111,156239698,4,"I also wonder if we should use some `AnyVal` wrappers here instead of `String`. Something like:
```scala
case class Accessor(asString: String) extends AnyVal
case class TypeName(asString: String) extends AnyVal
```",862127051,2017-12-12 08:16:05
32349058,7111,156240479,24,I'm confused what `name` is here? How is this compiling?,862127051,2017-12-12 08:21:35
32349058,7111,156240612,11,"ahh, here it is. Can we not do this and instead add an explicit import? It makes it harder to read the tests without a clear benefit if you ask me.",862127051,2017-12-12 08:22:31
32349058,7111,156443192,136,"Also, the property you want to maintain, how are we maintaining it through `++`? Can't you have two different projections in two different sets that need to have one filtered after a `++`? Can you spell out the invariant above the class in the comments?",862127051,2017-12-13 01:46:23
32349058,7111,156437773,64,can we use `Left(_) => ` here since we are not using `path`?,862127051,2017-12-13 01:25:41
32349058,7111,156440415,48,can we put the return type? I think `Option[Projection]`?,862127051,2017-12-13 01:35:54
32349058,7111,156442692,136,"not clear to me this algorithm works. It seems the order you add things in matters here. It seems you need to add shortest paths first and just going through the set may cause you to add a path that later you will not want in there.

Do you follow my po",862127051,2017-12-13 01:44:21
32349058,7111,156437319,58,can we add `@annotation.tailrec`?,862127051,2017-12-13 01:24:06
32349058,7111,156442838,141,why not `Iterable` here since `++` is commutative right? We don't care about an particular order do we?,862127051,2017-12-13 01:45:01
32349058,7111,156437106,39,can we add the `@annotation.tailrec` here?,862127051,2017-12-13 01:23:23
32349058,7111,156441687,95,"`Some(p) == Some(base)` in this branch right? Can we write it that way so we can see in both branches we are returning `Some(base)` or `None`. In fact, maybe we should return Boolean instead so it is easier to follow and use filter below?",862127051,2017-12-13 01:40:18
32349058,280540,156500260,58,this method is not tail recursive,862127051,2017-12-13 05:28:06
32349058,280540,156502219,95,"`loop` here does more than just filter the projection. It reconstructs the projections on top of the base projections using the type as the matching criteria. Take a look at line 99, where it uses option.map to recreate the property on top of the new base",862127051,2017-12-13 05:35:53
32349058,280540,156508777,136,"I'm not sure what you mean by ordering since it filters an unordered set based on the same complete unordered set, but indeed this algorithm has a bug. It doesn't consider nested intersections. For instance, `person.contact` and `person.contact.phone.numb",862127051,2017-12-13 06:02:29
32349058,280540,156508837,39,done,862127051,2017-12-13 06:02:45
32349058,280540,156508859,48,done,862127051,2017-12-13 06:02:53
32349058,280540,156508882,64,done,862127051,2017-12-13 06:02:57
32349058,280540,156509141,141,done,862127051,2017-12-13 06:04:04
32349058,280540,156509643,4,done,862127051,2017-12-13 06:06:17
32349058,280540,156509720,11,I've moved the projections to the `Person` companion object,862127051,2017-12-13 06:06:37
32349058,280540,156510259,136,"The invariant holds for `++` since it also uses the `apply` method. I'm not sure the invariant needs to be in the class comments since it's already in the apply method, but I don't feel strongly about it.",862127051,2017-12-13 06:08:39
32349058,7111,156536131,58,duh.  yep.,862127051,2017-12-13 08:33:01
32349058,7111,156537702,97,don't we want `startsWith` here?,863231015,2017-12-13 08:44:23
32349058,7111,156537220,61,I think `Projections` is spelled wrong.,863231015,2017-12-13 08:41:05
32349058,7111,156537336,77,"okay, I guess you are using unapply here. Can we just comment on the object.",863231015,2017-12-13 08:41:50
32349058,7111,156539128,105,Another scalacheck might be that `Projections(someSet).toSet.size <= someSet.size`,863231015,2017-12-13 08:54:22
32349058,7111,156538985,92,"seems like we could do a scalacheck test here. We could test that for all `List[Projections]` then if we `++` all of them, we have a final result where there are not Projections which are ""suffixes"" of another.",863231015,2017-12-13 08:53:27
32349058,7111,156538732,82,"in this case, does `typeReference` mean we are keeping the whole thing (when we see that, we can't do any projections)?",863231015,2017-12-13 08:51:41
32349058,7111,156536261,95,right. I missed that branch. But line 95 could be `Some(base)`  right (since we are checking equality)?,862127051,2017-12-13 08:34:07
32349058,7111,156537011,35,why is this an object rather than just an `def unapply(t: Tree): Option[Tree]` method? Can you comment?,863231015,2017-12-13 08:39:38
32349058,7111,156536786,64,do we need to use `_root_.com` here? I thought we needed to.,863231015,2017-12-13 08:37:51
32349058,280540,156541385,95,"Yes, it could. It doesn't seem to matter, though?",862127051,2017-12-13 09:11:11
32349058,280540,156543444,64,"It's good to have it for hygiene. If the user has a `com` object it'll fail, for instance. Note that even `_root_` doesn't guarantee hygiene because that's a value that the user could define, but that should never happen :)

I'll add `_root_` to all tre",863231015,2017-12-13 09:26:43
32349058,280540,156543605,77,I've renamed it to `ProjectionExtractor`. Is it clear enough to avoid the comment?,863231015,2017-12-13 09:28:03
32349058,280540,156543685,82,"Yes, it must assume that all properties are used since the function isn't introspectable",863231015,2017-12-13 09:28:42
32349058,280540,156543864,92,I'm not a big fan of property-based testing. Is there something that would have better coverage if I use it?,863231015,2017-12-13 09:30:10
32349058,280540,156543883,105,ditto,863231015,2017-12-13 09:30:22
32349058,280540,156543983,97,good catch. Fixed,863231015,2017-12-13 09:31:09
32349058,280540,156544075,61,fixed,863231015,2017-12-13 09:31:46
32349058,7111,156549147,92,"WHAT!?!? Who is not a big fan of property based checks!? Why don't you like it? I love it. It gives you an ability to clearly state properties and a decent approach at checking if what you claim is true actually is. Of course, with poor generators, it oft",863231015,2017-12-13 10:13:44
32349058,7111,156549236,95,I think it is easier to read that both branches are returning the same thing. I feel that is a value to someone understanding the algorithm.,862127051,2017-12-13 10:14:37
32349058,280540,156563147,95,Makes sense. I've changed it,862127051,2017-12-13 12:42:13
32349058,280540,156565081,92,"If the code is refactored into simple functions that don't require complex structures, unit tests are easier to implement and reason about. Property-based tests take longer to implement, are much harder to debug, and don't bring many benefits if compared ",863231015,2017-12-13 13:05:29
32349058,7111,156823206,92,I guess the reason I brought it up is that I thought I noticed a bug which I think a scalacheck would have caught.,863231015,2017-12-14 08:14:18
32349058,280540,156826586,92,"Sure, if I had thought about that scenario and checked the property :) The same is valid for unit tests. I can implement the property-based test if you feel strongly about it, though.",863231015,2017-12-14 08:39:33
32349058,7111,156830352,13,"this confuses me. How do we distinguish an `andThen` projection inside or outside an `Option`? Seems like we need to record the input type we are dealing with also. We have `Option[Contact]` as the output of the previous Projection, but how do we jump acr",863480023,2017-12-14 09:07:23
32349058,7111,156830048,32,what about using a `List.newBuilder[T]` and using `+=` on it which I think gives O(1) append (because they cheat and mutate the list). Currently I think this code is `O(N^2)` since it is using append on a list.,863480023,2017-12-14 09:05:11
32349058,280540,156835663,13,"Note that this is a failing test with `pendingUntilFixed`. The projections in this scenario are `Person.alternativeContact` and `Contact.phone`, which are unrelated and thus don't get filtered out by `Projections`. Ideally, the macro should apply a transf",863480023,2017-12-14 09:50:26
32349058,280540,156836836,32,fixed,863480023,2017-12-14 09:58:55
32349058,134219,157577826,23,"`typeName` is type of this `Projection`? It sound like something which belongs to any `Projection`, does it make sense to put it on the level of `Projection` then?",864414745,2017-12-19 03:28:04
32349058,134219,157583498,58,`typeName` in comment instead of `tpe`?,862127051,2017-12-19 03:50:23
32349058,134219,157588309,77,And/or rename it and put on `Projection` itself?,864414745,2017-12-19 04:09:57
32349058,134219,157576321,5,Can we add comment on what `Liftable` means?,864414745,2017-12-19 03:22:54
32349058,134219,157589487,90,"Clarifying for myself: we loose correspondence between function arguments and their `Projection`s and because of that we do this match between all `base` and all `set` projections?

Can we rename `loop(base, p)` and put it to `Projection` class?",864414745,2017-12-19 04:14:54
32349058,134219,157585504,38,Can we do `rootProjection(Projection): TypeReference` and match on it? I think logic will be clearer then.,864414745,2017-12-19 03:58:16
32349058,134219,157584949,36,`of` sounds like method on companion object for me and I was reading this method this way. Maybe `filterBySuperClass`? ,864414745,2017-12-19 03:55:56
32349058,134219,157591950,31,"This is kinda hard to read because you can't easily see alternatives together, can we extract bodies into separate functions?",864414745,2017-12-19 04:26:24
32349058,134219,157588231,77,I read this couple of times and have issues with understanding what `bySuperClass` does. Can we add a comment on it?,864414745,2017-12-19 04:09:41
32349058,280540,158089704,5,done,864414745,2017-12-21 01:41:25
32349058,280540,158089975,23,"I don't think so, there isn't immediate benefit in abstracting it and the `typeName` of a `TypeReference` doesn't really have the same meaning as the `typeName` of a `Property`.",864414745,2017-12-21 01:42:44
32349058,280540,158090214,36,`filterBySuperClass` doesn't represent well what this method does. Would you have another suggestion? I find `of` a good name to be honest.,864414745,2017-12-21 01:43:48
32349058,280540,158090233,38,done,864414745,2017-12-21 01:43:55
32349058,280540,158090556,77,done,864414745,2017-12-21 01:45:26
32349058,280540,158091356,90,done,864414745,2017-12-21 01:49:10
32349058,280540,158091404,31,done,864414745,2017-12-21 01:49:23
32503035,7111,157078575,9,mode is confusing here since it is almost always `scalding.Mode` named that. Can we rename?,865261363,2017-12-15 06:22:38
32503035,7111,157078682,36,should this be an error or warning? I kind of feel warning.,865261363,2017-12-15 06:23:12
32503035,401065,157100271,13,What's the `.toString` supposed to output here? Aren't we matching on lowercase in `getRequireOrderedSerializationMode ` above?,865295148,2017-12-15 08:40:25
32552020,11097008,157326333,6,can we add this setting to `Config.scala` as well? `.setRequireSuccessFile(value: Boolean): Config` or something to make it easy also for people to programmatically set the option?,866228060,2017-12-16 08:35:11
32552020,11097008,157326426,6,"actually, not. Let's leave it as it is so we don't cause any binary incompatibility by cherry picking this for scalding 0.17.4",866228060,2017-12-16 08:36:26
32552020,795386,157326436,6,Ack ????. Adding it.,866228060,2017-12-16 08:36:39
32552020,795386,157327324,6,Okay.,866228060,2017-12-16 08:49:07
32650430,319889,157861761,6,uh this seems fine given this is a cherrypick pr... but probably should be using a constant? ,868292993,2017-12-20 04:06:30
32650430,7111,157862766,6,"we didn't want to break binary compatibility, but a constant would be a nice follow up.",868292993,2017-12-20 04:11:13
32732170,134219,158119494,103,Move to `Projection` as well?,868916599,2017-12-21 03:50:16
32732170,280540,158123639,103,done,868916599,2017-12-21 04:07:41
32732170,134219,158150830,12,"nit: `type` should start with capital letter.

Personally I prefer to see rootProjection method here and just inline `rootProjection(this).typeName == typeName` at callsite.",868916632,2017-12-21 06:16:30
32732170,280540,158169968,12,done,868916632,2017-12-21 08:20:09
33275738,7111,162231931,30,can we replace this with an equivalent test that we can see the caller correctly?,883203455,2018-01-18 10:01:11
33275738,7111,162231483,171,why do we need a `Quoted` here. Not clear to me. Just to get position information of the caller?,883203455,2018-01-18 09:57:19
33275738,7111,162754567,263,"we can't filter here, can we?",883203455,2018-01-20 07:11:55
33275738,7111,162754298,130,"since semigroups emit the whole object, do we really need the quoted here? Seems like we can assume there can be no projection/filtering here.",883203455,2018-01-20 07:09:59
33275738,7111,162754533,207,can we look inside the Fold?,883203455,2018-01-20 07:11:39
33275738,7111,162754382,76,"we can't really filter here, can we? why to we need quoted?",883203455,2018-01-20 07:10:32
33275738,7111,162754453,40,"I don't think we can look inside the aggregrator and filter, can we? Can we really use the quoted meaningfully?",883203455,2018-01-20 07:11:06
33275738,7111,162754505,175,"we can't filter here, can we?",883203455,2018-01-20 07:11:29
33275738,7111,162754014,14,"I'm a bit confused why we need the implicits here. Can you comment? Can't we statically see anything we need for the purposes of projection? Is this just to collect line numbers?
",883203455,2018-01-20 07:07:45
33275738,7111,162754222,43,we can't project/filter here right since we know sorting is 1 in 1 out.,883203455,2018-01-20 07:09:19
33275738,7111,162754189,25,"I'd rather not take an implicit here if it can't contribute to row/column filtering, which I can't see how it can in the case of take.",883203455,2018-01-20 07:08:57
33275738,7111,162754399,68,can't we avoid quoted here?,883203455,2018-01-20 07:10:41
33275738,7111,162769679,169,"why don't we want `Quoted` here. Can you add the comment why? Is it the assumption that users get full control of the note, and there is no need to add the line/file info that Quoted can give?",883203455,2018-01-20 10:03:56
33275738,7111,162770199,12,"similar to above, can we not keep dummy implicit Quoted around. I fear we won't know where we are actually sending them. I prefer to be explicit with the dummies (and add a comment to that effect).",883203455,2018-01-20 10:15:05
33275738,7111,162769453,13,should we take a `Quoted` in the constructor actually? That should be created where we call `.sketch` which I think could improve reporting on internal methods.,883203455,2018-01-20 09:58:34
33275738,7111,162769494,21,same comment: should we take `implicit q: Quoted` on the constructor?,883203455,2018-01-20 09:59:35
33275738,7111,162769641,142,I don't think we are using `m` here are we? This is really just a typesafe cast.,883203455,2018-01-20 10:02:50
33275738,7111,162770175,26,don't we need to accumulate the `quoted`? Seems like we need a `Semigroup` on quoted (maybe a `Monoid`).,883203455,2018-01-20 10:14:10
33275738,7111,162769847,529,Can we pass `m` explicitly to `Sketched` so we can see that it is not discarded?,883203455,2018-01-20 10:07:44
33275738,7111,162770136,10,"I'm nervous about this hanging out implicitly. Can we not use it implicitly and instead explicitly call it: `interalQuoted` where needed? I fear this will actually destroy our `Quoted` information when we are doing composing operations, and defeat the who",883203455,2018-01-20 10:13:21
33275738,280540,163999600,26,@johnynek `desc` already has the description information from `quoted` (see `TypedPipe.withQuoted`). I think we don't need to accumulate `quoted` at this point since the purpose is to set the description only (no projections).,883203455,2018-01-26 07:32:24
33275738,280540,164001158,21,fixed,883203455,2018-01-26 07:42:09
33275738,280540,164001166,142,removed,883203455,2018-01-26 07:42:15
33275738,280540,164001227,169,just updated the scaladoc,883203455,2018-01-26 07:42:32
33275738,280540,164001253,529,fixed,883203455,2018-01-26 07:42:43
33275738,280540,164001267,10,fixed,883203455,2018-01-26 07:42:51
33275738,280540,164001313,12,fixed,883203455,2018-01-26 07:43:07
34159781,319889,164481389,22,"should we leave this commented out/enabled ? (just don't know if we have any concerns over debug's correctness, we won't test it like this. But that might be fine)",901254584,2018-01-30 00:18:28
34159781,319889,164492681,67,did you mean to drop these to 500 in the commit/merge ? ,901254584,2018-01-30 00:53:52
34159781,7111,164495959,67,"I pretty much hate scalatest. It was ignoring this parameter until I made this extend PropertyChecks. After I did this, 500 checks takes a while (200 seconds). I figured that would be enough for now.",901254584,2018-01-30 01:04:22
34159781,7111,164496175,22,We almost never use debug in real life and it was making test logs unreadable.,901254584,2018-01-30 01:05:00
34159781,319889,164503881,67,"Yeah its a great exemplar of something with 2 many ways to do anything/everything and then its just too hard to do things right.

???? 
",901254584,2018-01-30 01:30:25
34422084,7111,165803936,9,"with this, `Mode` is really just an Execution.Writer factory (the thing that holds the mutable state while an Execution is running).

This should be source compatible with everything we have now since Mode was never sealed, so case matching always had t",905835295,2018-02-03 11:47:35
34422084,7111,165803980,168,make sure to call `op.result` exactly one time.,905835295,2018-02-03 11:50:42
34422084,7111,165803963,59,we can clean up these `???` by simplifying `Mode` in this PR.,905835295,2018-02-03 11:49:26
34422084,7111,165803975,77,dagon improving type-safety! :),905835295,2018-02-03 11:50:17
34422084,6636815,166435357,77,nice!,905835295,2018-02-07 04:39:22
34422084,6636815,166437382,487,needed? ,905835293,2018-02-07 04:47:56
34422084,7111,166467013,487,"maybe not, but CI being what it is, we can remove later.... I am also trying to address some possible performance issues with giant graphs.",905835293,2018-02-07 06:45:39
34688476,7111,167085225,19,this won't get called in the case where we write DOTs in Tool. Need to fix.,908622394,2018-02-09 06:18:58
34688476,319889,167110056,19,:( i guess we lack a test for that path,908622394,2018-02-09 08:28:47
34688476,7111,167115362,19,"actually, I was wrong, we call `buildFlow`, which will make sure this stuff gets built, but we don't have a test for DOT generation, I don't think.",908622394,2018-02-09 09:03:18
34688476,319889,167292999,19,"Shame no test, but its not a critical path",908622394,2018-02-10 01:27:07
34706979,44017,167311989,56,"This is where I get a little bit lost - the rest of this looks great. I'm assuming this doesn't handle a case that would need to be a `writeThrough` in `Execution`? If so, I'm missing how, and if not, it's not clear to me what the failure would look like;",908977285,2018-02-10 02:42:51
34706979,44017,167310324,66,Nit: this comment seems to have gotten truncated (though it's clear from context),908977285,2018-02-10 02:36:27
34706979,7111,167319699,56,"That is already handled by Executions:
```scala
pipe1.writeExecution(sink1)
  .zip(pipe1.map(fn).writeExecution(sink2))
```
will work. Internally the optimizer sees the fork and that is exposed to cascading (they share everything above the fork).

",908977285,2018-02-10 03:12:28
34924366,319889,168181002,5,we were loosing some information before here i imagine?,917082522,2018-02-14 21:58:48
34924366,319889,168181134,5,"Oh nm i see, this logic got moved out of this file",917082522,2018-02-14 21:59:15
34924366,319889,168184613,15,Do we have enough optimization rules to pull `.map` functions into the reducer ? or does it make more sense to explicitly not do that and let user code do mapValues/etc.. to stay in the reducer?,917082522,2018-02-14 22:12:01
34924366,7111,168251364,15,"This partitioning is not yet optimal. It may wind up in more steps that cascading would have taken. It would be nice to get it so that is never the case, and we could just turn it on all the time.

Since the optimizer works, for now, on the same nodes a",917082522,2018-02-15 01:30:49
35030323,32164772,168668545,59,this is unused? ,918914584,2018-02-16 11:22:28
35030323,7111,168669981,59,Nope. I somehow forgot it and implemented without it below. Good catch.,918914584,2018-02-16 11:41:28
35068968,319889,168876573,14,conside => consider?,919577505,2018-02-17 05:38:31
35068968,319889,168877073,14,commented test?,919577505,2018-02-17 05:41:13
35068968,319889,168877155,113,commented test?,919577505,2018-02-17 05:41:37
35068968,319889,168877400,48,"This is super neet/nice, could you expand the comments here -- don't think i'd have followed other than I know what your aiming to do.

(Motivation/why we are tracking/what we are aiming to do with it)",919577505,2018-02-17 05:42:49
35068968,319889,168877820,91,why is a counter pipe `| Write` ? ,919577505,2018-02-17 05:44:38
35068968,7111,168879454,91,"it doesn't need to be, `Write` is the bottom, so `x | Write = x`.",919577505,2018-02-17 05:52:06
35074876,7111,168899031,69,"this was an added safety check to make sure we didn't overlook type of Execution (we didn't, but could in the future I guess). Since this would only get hit if we have correct code in the case that two items have collided, but are really different, it is ",919672713,2018-02-17 07:58:23
35102456,319889,168936304,56,we probably should block on this thread competing here?  -- or i'd be more inclined that this didn't use a thread at all but we could swallow the errors. (Threads have the unfortunate problem that either its a foreground thread and we'll have some unexpec,920281591,2018-02-18 08:01:25
35102456,7111,168936765,56,"sure. Sounds good. Only note: this is triggered in a thread anyway: it is called by `.onComplete` of a Future, so already it is on the threadpool independent of blocking the result on the Future. ",920281591,2018-02-18 08:35:50
35102456,319889,168937566,56,"From some light googling it feels like that will eventually be its own sort of bug around this -- its not a huge one in the sense cleaning up is an optimistic operation.

We could do a try {} around the cleanup block and put the Stop into the message qu",920281591,2018-02-18 09:38:50
35102456,7111,168938099,56,"I don't think I understand. We are already doing a try {} call inside the state cleanup. And the STOP message has already been sent (and that thread is not a daemon thread anyway).

https://github.com/twitter/scalding/blob/develop/scalding-core/src/main",920281591,2018-02-18 10:20:56
35102456,319889,168938665,56,"Concretely what i mean is we do want to block the final future returning for this i believe, which means we want to move the stop from 
https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/typed/cascading_bac",920281591,2018-02-18 11:06:09
35102456,7111,168940458,56,"That won’t block the final future from returning. The final future returning *calls* finished. We register an onComplete of the final future to call finish.

We could convert onComplete to a transform and synchronously call this, but I’m not really sure",920281591,2018-02-18 13:36:20
35102456,319889,168964228,56,"Sorry your quite right, i hadn't quite tweaked that the STOP is really just occuring in the on complete itself. Now in practice i believe moving it below, or indeed I think undoing my first comment on this would make the issue go away -- since both thread",920281591,2018-02-19 04:24:08
35102456,7111,168965861,56,"Okay. I'll revert the fix keeping in mind this is easy to change in a point release since it does not change the API at all.

Thanks for thinking through some of these subtler issues.",920281591,2018-02-19 05:16:50
35246838,280540,169539718,10,"I find `FlowStateMap.mutate` too fragile, even after the fix. If someone changes the implementation of any of the other method calls to also mutate the global state, we'd have another potential bug.

Maybe `FlowStateMap.mutate` could take functions that",923059263,2018-02-21 13:44:13
35246838,7111,169542563,10,"I don’t think thread-local is safe because Execution is multi-threaded (via Future/ExectionContext). I don’t think your proposed fix will be correct.

I agree I don’t like FlowStateMap. Since you are at Twitter you could change the use of FlowDef to a G",923059263,2018-02-21 14:10:10
35246838,280540,169736248,10,"> I don’t think thread-local is safe because Execution is multi-threaded (via Future/ExectionContext). I don’t think your proposed fix will be correct.

This bug doesn't involve concurrency. It occurs when the same thread acquires the lock and does nest",923059263,2018-02-22 02:37:17
35246838,7111,169743107,10,"I know this bug does not involve concurrency, but I don't see how we can use a ThreadLocal since planning is done in multiple threads. The FlowState cannot be thread-local state, it has to be accessible across threads.",923059263,2018-02-22 03:00:15
35246838,280540,169746724,10,My proposal was to hold the deltas in a `ThreadLocal` and merge them if the `mutate` call is not nested. `FlowStateMap` would continue to use the weak hashmap.,923059263,2018-02-22 03:13:27
35246838,7111,169747912,10,"PS: about Diffy note TypedPipeDiff which was created when we attempted something like this before. The E2E tests were a basic version of what you describe, but they are a selected set of jobs.",923059263,2018-02-22 03:17:36
35246838,319889,169748089,10,"To me these changes seem like a clear improvement in the state of the world. Cleaner interfaces , more comments. 

If someone wants to figure out multi-threaded interactions , or removing this entirely those feel like separate PR's?

Anyone -1 on just",923059263,2018-02-22 03:18:08
35246838,280540,169751836,10,"> If someone wants to figure out multi-threaded interactions , or removing this entirely those feel like separate PR's?

It's not really a concurrency/multi-thread issue. If we keep this global mutable state unprotected, it's easy to introduce other bug",923059263,2018-02-22 03:30:39
35246838,7111,169756579,10,"Since we have made the unsafe mutate method private, I think we are in a good shape.

We don't seem to be communicating very well here. It seems like you comment implies that we haven't made the dangerous method private, also it seems like you are not c",923059263,2018-02-22 03:47:03
35246838,319889,169759004,10,@fwbrasil I think you should press ahead and try build another PR and we can debate the pro's and con's of that approach on that PR. And just merge this since it fixes some handling/and improves things here. Incremental improvements should really be accep,923059263,2018-02-22 03:55:13
35246838,280540,169771317,10,"> We don't seem to be communicating very well here.

I've just replied on gitter. I think ""protected"" wasn't a good word. I'd like to restrict the implementation so developers can't introduce bugs like this one.

> It seems like you comment implies th",923059263,2018-02-22 04:42:44
35357201,7111,170405345,70,this is 2 steps without ComposeReduceSteps,925932988,2018-02-24 09:36:32
35357201,7111,170405354,74,this is 2 steps without ComposeReduceSteps,925932988,2018-02-24 09:36:40
35357201,7111,170405360,78,this is 3 steps without ComposeReduceSteps,925932988,2018-02-24 09:36:57
35357201,7111,170405367,81,this is 3 steps without ComposeReduceSteps,925932988,2018-02-24 09:37:06
35357201,280540,170704928,73,Is there a guarantee that there aren't nested descriptions here?,928198042,2018-02-27 03:20:40
35357201,7111,170714871,73,"There is not, but there is another optimization rule that collapses those, so this rule should run after that rule.",928198042,2018-02-27 03:52:22
35432501,319889,170483806,47,"probably good to add a comment describing some of the logic here around the input sizes

This is that the RHS is composed of N streams and we only cache the far right of those streams in this case? ",927469636,2018-02-26 10:43:01
35432501,319889,170483879,47,Ohhh its how many of the rightStreams are already covered in prior joins by the left hand multijoin function? so we need to feed them in there?,927469636,2018-02-26 10:43:58
35432501,7111,170490634,47,"It is just an extra check (which should never possibly fail unless we have a programming bug) that the number of streams we are joining matches the the total joining operation we have.

Since we have one stream in leftMost, the others should be in right",927469636,2018-02-26 12:08:57
35705591,319889,172539639,16,i think they just register these to kryo so i imagine this should just hit the inefficient paths. For a normal execution app though this i guess does drop some sort of performance.,935559253,2018-03-06 22:50:18
35705591,319889,172540765,140,"don't need to bother updating this here, but i'd leave these to DISK_ONLY until we can figure out how/when we can upgrade the state. (Spark also has the output of shuffles persisted, so we might be able to get the planner to realize when we should have sh",935559253,2018-03-06 22:53:38
35705591,319889,172542650,160,since these partitions are ~usually ondisk or can fit in memory we might just want MapAlgebra.sumByKey possibly (or sort and fold i guess..). ,935559253,2018-03-06 22:58:51
35740960,17013,171951458,27,"It makes sense to have the `ToWrite` companion object be serializable if we are going to capture/serialize it, but it's not obvious to me how that would happen? Is that something we've observed?",932618106,2018-03-03 04:12:20
35740960,17013,171951817,30,"It might be worth documenting (here or in `KryoHadoop.scala`) that our strategy for serializing captures pipes/executions is to skip these fields (so they're initialized to `null`) and to explicitly serialize them as `null`. At least, I think that's the s",932618106,2018-03-03 04:14:05
35740960,7111,171952102,27,they were captured inside the ToIterable Execution.,932618106,2018-03-03 04:15:30
35740960,17013,171952148,27,"OK, makes sense.",932618106,2018-03-03 04:15:46
35740960,7111,171952285,30,"yeah, that's a good idea, since they are only used in planning, it should be safe, as the note in KryoHadoop says, but copying here is probably good too.",932618106,2018-03-03 04:16:28
35881026,7111,172347894,27,this was actually the only test that could repro the issue.,935367204,2018-03-06 06:16:41
35958353,319889,172874008,5,"small nit, but we should make this opt something longer, took me reading the impl to see it ment optimized and not some reference to optional",936792688,2018-03-07 23:14:36
36060574,280540,173265683,1,Are there changes to these classes or were they just moved?,938594299,2018-03-09 03:30:09
36060574,7111,173270011,1,just moved.,938594299,2018-03-09 03:45:17
36060574,7111,173271916,126,"@fwbrasil note this pattern, like the case of FlowStateMap could fail if fn also calls update. We never do that, and this is a private method, but to be paranoid we check that state has not changed during the call to fn.",938594299,2018-03-09 03:52:03
36060574,7111,173270488,66,"@fwbrasil note this was a potential bug: we were ignoring the Config in the mapping from original to optimized pipe, but Config can control the optimizations, so this would not be safe in general. We need to include the Config as part of the key as we do ",938594299,2018-03-09 03:46:55
36162249,319889,173661814,16,what does start do? ,940721387,2018-03-12 00:03:47
36162249,7111,173663442,16,"It’s on the base trait. They are called to begin and end the Execution. Obviously I didn’t implement them yet.

Start probably does nothing on this Writer but finish will likely need to call unpersist on some RDD.",940721387,2018-03-12 01:01:24
37270127,7111,178697179,16,can we exercise this in a test where we throw in a FlowListener?,964232096,2018-04-03 09:10:40
37270127,7111,178696954,15,"let's use a single atomic call here and do `result.tryFailure`:
https://www.scala-lang.org/api/2.12.3/scala/concurrent/Promise.html#tryFailure(cause:Throwable):Boolean",964232096,2018-04-03 09:08:31
37270127,94390,178970377,15,"done, thanks",964232096,2018-04-04 04:39:56
37270127,94390,178970400,16,"done, thanks",964232096,2018-04-04 04:40:02
38022463,94390,182519720,63,"nit: very confusing signature of `removeWrites`, without knowledge that `removeWrites` return original `flowState` is hard to understand this line. ",980829005,2018-04-19 01:08:33
38022463,94390,182522541,75,"nit: again confusing name and usage, `FlowState.merge` is an immutable operation, but `FlowStateMap.merge` is mutable, maybe we need use different name or somehow be more clear that we mutate fd here.",980829005,2018-04-19 01:17:29
38022463,94390,182523959,75,"nit: why we need here `Monoid.plus`? if `subFlowState.flowConfigUpdates` should be empty, we can do just `copy`.",980829005,2018-04-19 01:21:52
38022463,94390,182524677,31,"nit: why some arguments have `@transient`, another don't have it? do we serialize ast at all?",980829005,2018-04-19 01:24:10
38543881,280540,185106060,48,`final` for consistency?,993012376,2018-05-01 03:49:33
40270381,7111,192545245,25,Can you comment what this macro is and why it is needed?,1028901458,2018-06-02 09:06:13
40270381,7111,192545257,2,This version is out of date.,1028901458,2018-06-02 09:06:59
40270381,7111,192545224,24,What is this?,1028901458,2018-06-02 09:05:25
40270381,7111,192545281,9,If we introduce a new type here I’d like to be a sealed trait and either be an Ordering or an OrderedSerialization.,1028901458,2018-06-02 09:07:50
41200410,1443419,196894910,3,Note you can use listStatus to avoid additional fileStatus RPC later on for directory contents.,1047025474,2018-06-21 01:22:12
41200410,134219,196930858,3,"I agree, but I don't want to intercept into current logic around `LocalFileSystem` in `listDir`.",1047025474,2018-06-21 03:26:48
44305574,7111,211151248,116,I solved this in #1869 using broadcast.,1106368895,2018-08-20 13:28:03
44305574,319889,211282486,131,not sure if it particularly matters since calling next on an empty iterator usually just throws an exception -- but this will stack overflow on next called on empty?,1106368895,2018-08-20 21:28:38
44305574,319889,211283940,148,Do we not need to call the MapGroup operator here? or are we guaranteed that its already been cogrouped/shuffled? ,1106368895,2018-08-20 21:32:31
44305574,7111,211340940,131,"`next` is tailrec, so it won't stack overflow. If it is empty it will loop forever. Good catch.",1106368895,2018-08-21 00:18:30
44305843,319889,211287068,4,"you can/probably should destroy the broadcast when your done with it... not sure if you can easily know that here though...

(I've only found one case where its caused problems not destroying them, they usually are eventually GC'd anyway ) ",1106374738,2018-08-20 21:40:31
44305843,319889,211287298,5,"if your defining these things, these days i'd take a SparkSession than a spark context, you can get a context from a session but not vice versa",1106374738,2018-08-20 21:41:09
44305843,7111,211344200,4,"yeah, adding clean ups it a bit challenging, I was thinking of punting for now.

Basically, the `Op[A]` would need to return ` Future[(RDD[_ <: A], () => Future[Unit])]` or something so the right hand function is a cleanup on finish?",1106374738,2018-08-21 00:28:10
44305843,7111,211344964,5,"wouldn't that suggest we should take the least power, not most power? For instance, if you have a session, you can make a SparkMode now, but if you have a context you couldn't if I require session.",1106374738,2018-08-21 00:30:34
44305843,319889,211366512,4,"Yeah for best optimization you'd want to some how gc this thing when the resulting stuff goes away, but how/when to invoke oncleanup seems hard to know it won't be referenced again",1106374738,2018-08-21 01:40:22
44305843,319889,211367275,5,"Well except it would mean users need to thread both through, a bunch of API's say for doing I/O will want a session. So using any of the datasource v2 api's or to write out via a dataset. I think the view is normally that SparkSession is the one you hand ",1106374738,2018-08-21 01:42:55
44305843,7111,211408963,5,"okay, can I make this change in a follow up PR? I didn't know that it was better to require SparkSession.

Also, I guess it is better since you can use sql first to produce smarter sources, which I think needs the Session.

Can I merge this and follow",1106374738,2018-08-21 04:12:30
44305843,319889,211430989,5,"Yep on all fronts -- I think you'll get into the DatasourceV2 stuff to do custom stuff before long.

but totally do in a follow up, its all alpha anyway! :) ",1106374738,2018-08-21 05:47:52
32966,441563,757289,8,"That is fine, please comment that after you pull. It would be difficult to
comment that section on my fork as we build that artifact.

On another note, I've seen a few posts where people are interested to
contribute to Finagle but are confused about s",3922853,2012-05-01 22:35:49
37019,64320,833128,17,"I'd like to avoid having timeouts like this in the test. It is not very reliable. (The rest of specs in this file have pretty bad style wrt this, too). Perhaps you can test receive ordering explicitly?

```scala
val of = Offer.choose(clientRes.messages ma",4014733,2012-05-16 22:25:42
37019,25867,834676,17,"I don't like it either, but the above solution doesn't test the bug that was fixed. If I revert the changes in HttpDechunker, the current test fails. However, your suggested test passes in either case.

The issue isn't that the EOF is sent to `error` befo",4014733,2012-05-17 01:27:04
51703,64320,552558,6,"fix the weird indentation: prefer

    .. val defaultSSLContext: SSLContext = {
      val ctx = ...
      ctx.init(..)
      ctx
    }",4288002,2012-03-13 22:50:11
64030,64320,1217007,29,style: use // comments except for scala docs.,428148,2012-07-23 21:51:04
64030,64320,1217020,41,"style:

```scala
class AuthenticationProxy(
    underlying: ServiceFactory[Request, Result], 
    username: String, 
    password: String,
    database: Option[String]) 
  extends ServiceFactoryProxy(underlying) {
```",428148,2012-07-23 21:52:11
64030,64320,1217028,42,`private[this] val ..`,428148,2012-07-23 21:53:03
64030,19440,1217064,32,println--,428148,2012-07-23 21:56:58
64030,19440,1217068,15,println--,428148,2012-07-23 21:57:23
64030,64320,1217067,49,"style: using x = x stutters a lot, try instead

```scala
def makeLoginReq(sg: ServerGreeting) = 
  LoginRequest(username, password, database, sg.serverCap, sg.salt)
```",428148,2012-07-23 21:57:21
64030,19440,1217114,23,I'm concerned that this code is too functional at such a low level. I can imagine it being a hotspot. Obviously we will see when we do performance testing but usually you want C-like code when doing operations like this one to avoid a lot of CPU and memor,428148,2012-07-23 22:02:02
64030,19440,1217125,68,I'm surprised there is no reference to the charset here. I think this only works if the server and client are both in the same one?,428148,2012-07-23 22:03:21
64030,19440,1217129,85,This definitely needs a reference to the charset encoding.,428148,2012-07-23 22:03:39
64030,19440,1217137,113,"String.format is very inefficient. I suggest using a StringBuilder.

Edit: On second thought you might use a Calendar object instead that doesn't require us to format and then parse a string to get a timestamp.",428148,2012-07-23 22:04:18
64030,19440,1217145,135,Again using Calendar here?,428148,2012-07-23 22:05:22
64030,19440,1217151,184,Need an explicit charset. I suggest that we require UTF-8 on both sides.,428148,2012-07-23 22:06:09
64030,64320,1217182,68,"here it’s a little difficult to keep track of the scope of the futures and flatMaps. it might help to separate out concerns a little, and flatten things out eg.:

```scala
def acceptGreeting(res: Result) = sg match {
  case sg: ServersGreeting if sg.serve",428148,2012-07-23 22:09:06
64030,19440,1217184,108,"Making a new buffer, and a new writer per parameter seems pretty expensive. Can we refactor this to use a single buffer? Also, it generates multiple copies per parameter.",428148,2012-07-23 22:09:18
64030,64320,1217254,16,"It does: Endianess is Netty (and in Java generally) is handled by the underlying `ChannelBuffer`. So to do this “properly” you could either demand a little endian `ChannelBuffer` factory, or override the `LengthFieldBasedFrameDecoder` and wrap the incomin",428148,2012-07-23 22:17:30
64030,64320,1217256,20,whitespace: `if (`,428148,2012-07-23 22:17:52
64030,64320,1217261,32,spurious println,428148,2012-07-23 22:18:33
64030,64320,1217276,32,"btw-- if you want to retain the debugging information here -- it's often useful -- you should probably either (1) use logging at a debug level, or (2) pass a debug flag into the codec constructor.",428148,2012-07-23 22:19:37
64030,64320,1217384,31,You'll need to save the reader index here so that it is restored next time. See the [FrameDecoder example](http://docs.jboss.org/netty/3.1/api/org/jboss/netty/handler/codec/frame/FrameDecoder.html),428148,2012-07-23 22:30:14
64030,64320,1217406,27,"When tuples aren't natural, use sequence the statements instead. While correct, it isn't obvious to the reader that the order is br.readInt24, br.readByte).

Also, since these are side-effecting, they should be furnished with `()`'s:

```scala
val length ",428148,2012-07-23 22:32:29
64030,64320,1217413,35,spurious statement?,428148,2012-07-23 22:33:12
64030,64320,1217434,17,spurious?,428148,2012-07-23 22:35:01
64030,64320,1217439,16,"define toChannelBuffer instead, which would allow the implementation to avoid extra copies.",428148,2012-07-23 22:35:34
64030,64320,1217452,23,"let's measure first, cut later. i'd like to focus on correctness and clarity first, then performance later -- and of course to make sure that the codec isn't structured in a way that wouldn't allow us to squeeze all the performance we can out of it later.",428148,2012-07-23 22:36:14
64030,64320,1217466,9,idiomatic to use traits: `sealed trait State`,428148,2012-07-23 22:37:34
64030,19440,1217488,148,More copies.,428148,2012-07-23 22:38:46
64030,19440,1217498,46,I'm not sure if we can assume that error codes and messages are in ASCII.,428148,2012-07-23 22:39:20
64030,64320,1217506,39,"volatiles on same line: `@volatile private[this] var ..`

",428148,2012-07-23 22:39:47
64030,64320,1217540,77,"whitespace

```scala
// Do ...
```",428148,2012-07-23 22:42:11
64030,64320,1217553,71,this is mysterious to the reader: comment on this behavior. also you probably did mean:  `buffer.readableBytes`? are there valid packets that are fewer than 5 bytes?,428148,2012-07-23 22:43:37
64030,19440,1217557,56,Does this regular expression work if I have ? within quotes? I also don't know why we are doing the replacement rather than leaving it to the server? This seems pretty dangerous.,428148,2012-07-23 22:44:10
64030,64320,1217573,19,consistent naming (what is the decoder *doing*?): `DefraggingPackets`,428148,2012-07-23 22:46:08
64030,64320,1217656,89,"This suggests that the decoder is not separable from the encoder. Perhaps you should just conflate them in the code? It would avoid this extra decoding step and make the code clearer, I think.",428148,2012-07-23 22:54:40
64030,83701,1217719,56,"For prepared queries, the '?' are just expanded and the replacement happens on the server. This allows for calling prepare(""select * from table where id in (?)"", 1 to 10) as opposed to prepare(""select * from table where id in (?,?,?,?..."", 1 to 10)

For r",428148,2012-07-23 22:59:56
64030,83701,1217745,89,"In some cases, they are not separable. I don't think it would be a problem to conflate them especially since the encoder is so simple.",428148,2012-07-23 23:02:05
64030,83701,1217881,113,I was wondering where all the set* methods went for Dates. I'll change these methods to use Calendar instead.,428148,2012-07-23 23:13:11
64030,64320,1217894,19,I think this would be clearer if it were split into more states. Right now there seems to be a lot of mutually exclusive configurations of `PacketDefragger`. Here's a suggestion based on my very primitive understanding of the protocol: depending on the ty,428148,2012-07-23 23:14:44
64030,64320,1217925,23,(though i do agree-- this seems likely to be a hotspot),428148,2012-07-23 23:18:07
64030,64320,1217937,39,these should all have ()s since they modify state (offset),428148,2012-07-23 23:18:55
64030,342872,1217947,46,It uses the same character set as query results (character_set_results).,428148,2012-07-23 23:20:21
64030,83701,1217992,46,Is this also the same as server_language sent during handshaking?,428148,2012-07-23 23:24:30
64030,342872,1218169,135,"Also, you need to convert days to hours. I guess using Calendar will solve.",428148,2012-07-23 23:41:34
64030,83701,1218247,108,"Yes, this can be solved by precomputing the size the parameters will take and using 1 buffer writer. This would eliminate the copying and the object creation.

In retrospect, I am not sure how I reasoned that all this object creation was okay.",428148,2012-07-23 23:47:52
64030,64320,1218339,11,(for future performance optimization) - we should try to use `ChannelBuffer`s as much as possible throughout as it allows us to reduce the amount of copying we do.,428148,2012-07-23 23:54:53
64030,64320,1218344,184,"i'm sure the protocol has something to say about this, right?  probably it's even configurable? :-(",428148,2012-07-23 23:55:33
64030,64320,1218358,20,"Constants should start with UpperCase -- this is actually not only a matter of style, but the pattern matching does not bind uppercase names, so it allows you to match against constants without further ado. And I also believe the optimizer only folds Uppe",428148,2012-07-23 23:56:39
64030,342872,1218411,46,"The variable is initialized to the charset number sent by the client.

See [Connection Character Sets and Collations](http://dev.mysql.com/doc/refman/5.5/en/charset-connection.html) and [Character Set for Error Messages](http://dev.mysql.com/doc/refman/5.",428148,2012-07-24 00:03:07
64030,342872,1218480,46,"As suggested above, better to enforce UTF-8 both ways.",428148,2012-07-24 00:12:27
64030,19440,1218482,56,I would like this to not be in the API at all. It is very difficult to get this right such that you don't introduce SQL injection attacks like the current implementation allows.,428148,2012-07-24 00:12:40
64030,83701,1218606,56,"As in, a rogue library that has a malicious toString method?

We can completely remove it but the problem of sql injection is still there if the a user builds their own sql statement.",428148,2012-07-24 00:25:17
64030,19440,1218745,56,"If user data is ever passed to this method it is vulnerable. Also, it
has a bug related to ? appearing in the query in a string value. If we
can't make the method safe for user data and have it work in the
presence of non-interpolated strings I would rath",428148,2012-07-24 00:41:41
64030,83701,1218758,11,"Agreed. I visited the idea of having this just wrap a netty ChannelBuffer, but I remember running into a lot of issues. It could have been my lack of experience of working with netty Buffers / nio Buffers.",428148,2012-07-24 00:43:41
64030,83701,1218825,56,That makes sense. I agree it would need more work to be more robust and safe. But if you don't think it is worth having we can scrap it and let the user explicitly build the queries. ,428148,2012-07-24 00:50:16
64030,64320,1220636,50,"comment on what this constant is, or better yet, name it.",428148,2012-07-24 03:46:25
64030,64320,1220653,14,constants are Capitalized,428148,2012-07-24 03:48:20
64030,64320,1220661,32,any reason to not use a case class?,428148,2012-07-24 03:49:02
64030,64320,1220669,8,case class?,428148,2012-07-24 03:50:02
64030,64320,1220687,24,`new' not needed.,428148,2012-07-24 03:52:50
64030,83701,1220711,8,I wanted to leave room for different implementations.,428148,2012-07-24 03:55:33
64030,64320,1220716,56,"I agree with Sam -- let's not include this in the API. Let's make it pure SQL. There are many other approaches to building queries, including DSLs that exploit type safety -- but those can and should be built on top of finagle-mysql",428148,2012-07-24 03:56:22
64030,64320,1220718,8,then we can make room when they come :),428148,2012-07-24 03:57:03
64030,83701,1220743,8,case class it is.,428148,2012-07-24 04:00:19
64030,342872,1220763,50,[List of character set names and numbers](https://github.com/jeremycole/mysql_binlog/blob/master/lib/mysql_binlog/mysql_character_set.rb),428148,2012-07-24 04:03:47
64030,342872,1220777,48,Would be better to refer to capabilities by name.,428148,2012-07-24 04:05:09
64030,199939,1220809,45,"private[this] val fService = factory.apply()
2 comments:
- use private[this] by default
- The lazy feature here is not very useful",428148,2012-07-24 04:09:10
64030,83701,1220888,45,"Why is it so important to make private members private to the instance?

Also, my reasoning for the lazy val here was allowing the creating of a client without doing the connection leg work until the user actually used the client. A replacement for having",428148,2012-07-24 04:23:14
64030,199939,1220895,14,You should also create/update the pom.xml,428148,2012-07-24 04:23:54
64030,342886,1221697,122,Do I understand correctly that this conflates NULL and empty string by always translating empty string to None? If a legitimate empty string were returned would it result in None and thus be indistinguishable from NULL? That would not be a good thing.,428148,2012-07-24 07:02:30
64030,342886,1221726,56,"Not totally sure I'm following the above conversation, but if we're to use this in production it will need to support some form of prepared statement substitution. Server-side prepared statements are slower for many use cases and much more difficult to re",428148,2012-07-24 07:08:53
64030,342886,1221751,63,"This is not really correct. I would think it better to explicitly case 251 as SQL NULL, and throw an exception for 255, as it implies corrupted data or out of sync client/server, since it's not a valid value. Continuing your read after getting a 255 here ",428148,2012-07-24 07:15:00
64030,342886,1221757,80,Blank string and SQL NULL should never be conflated.,428148,2012-07-24 07:16:41
64030,342886,1221763,76,This seems to not actually implement the length-coded string. What am I missing?,428148,2012-07-24 07:18:53
64030,342886,1221765,98,"If it is not readable, then what? Certainly this needs an else and should probably throw an exception of some sort.",428148,2012-07-24 07:20:18
64030,342886,1221769,50,"It's also worth noting that MySQL conflates character sets and collations at the protocol level, so 33 is ""utf8_general_ci"" collation, and you could see many other values here for utf8 character set.",428148,2012-07-24 07:23:38
64030,342886,1221777,9,There are a lot of other SQL queries which don't return result sets. To avoid confusion it's probably better not to try to list them here.,428148,2012-07-24 07:28:32
64030,342886,1221792,44,"In terms of naming, this is not really correct. Type BIT represents a bitmap of 1 or more bits. It's really an integer type of varying length, and only in the minimal case of BIT/BIT(1) is it potentially a boolean.",428148,2012-07-24 07:32:40
64030,19440,1221798,56,"It sounds to me then that we need a well tested way of doing prepared statement encoding client side. In order to support this, the MySQL driver appears to have a SQL parser along with all the escaping rules once the context of the ? is well understood th",428148,2012-07-24 07:33:51
64030,342886,1221809,9,"This is, of course, far too simple. I would argue that regular expression substitution is itself too complex to be part of this library though, and should be delegated to something else.",428148,2012-07-24 07:35:12
64030,342886,1222323,56,"In general I would say to avoid using server-side prepared statements at all. Even if they are perfectly monitored, they are still in very many cases generating 3 round trips (prepare, execute, close) when 1 would suffice (query). In most of our apps that",428148,2012-07-24 10:46:50
64030,83701,1226409,76,I read the spec wrong. This of course managed to work because I haven't dealt with string lengths that don't fit into a unsigned byte. I'll fix it to use the length coded binary.,428148,2012-07-24 21:00:57
64030,83701,1226533,76,Is there an upper bound on the length of a string? Can I assume that the size will never need to be represented with 8 bytes?,428148,2012-07-24 21:10:50
64030,83701,1226729,98,"I need to find a better way to represent corrupt data. From what I understand, it isn't idiomatic to throw exceptions that are not future encoded within Finagle.",428148,2012-07-24 21:31:36
64030,83701,1230345,19,"I've implemented your suggestions. Removing the noise caused by wrapping the sets in Option[...] and not passing around the decoder in the Defragging class cleaned up the code a lot.

The changes actually reduced the amount of cases by 1, but I think it d",428148,2012-07-25 03:09:14
64030,64320,1353331,7,version needs update.,3198729,2012-08-10 21:59:59
64030,64320,1353335,29,ditto for these.,3198729,2012-08-10 22:00:15
64030,64320,1353351,76,explicitly annotate return type here.,3198729,2012-08-10 22:03:06
64030,64320,1353382,169,"for all public interfaces here: include return types. it serves both as (in code) documentation and it also fixes the types, which is important; otherwise refinement types may be exposed unintentionally, causing API conflicts later:

  http://twitter.gith",3198729,2012-08-10 22:07:04
64030,64320,1353603,141,love this.  we'll move it under finagle-example when it's ready for prime time.,3198729,2012-08-10 22:28:29
64030,64320,1353766,177,very nice. FOR LATER: i think we could improve this a bit further by embedding expectOK and defragDecoder into the state as well; but let’s leave it as-is for now.  (I find it much easier to understand than the previous version),3198729,2012-08-10 22:42:38
64030,64320,1353822,17,The reader will be curious as to why you wouldn’t just use a `ChannelBuffer` (why didn’t you?),3198729,2012-08-10 22:48:46
64030,64320,1353984,13,"for side effecting methods like this, convention dicatates the use of {}:

```scala
def bindParameters() { hasNewParams = false }
```

otherwise it’s difficult to discern whether you mean to do do the assignment, or if it’s a bug and you instead meant:

`",3198729,2012-08-10 23:03:22
64030,83701,1353987,17,"There are several reason why I thought it would be better to wrap ChannelBuffer and provide a separate interface.

1. Each time a user intends to read from a MySQL packet, a ChannelBuffer needs to be created with the correct ByteOrder. It just seemed more",3198729,2012-08-10 23:03:47
64030,64320,1354858,79,"it might make sense to name ""valueOf"" -> ""apply"".

by convention in scala, maps use that for their keys, then you can access columns thus:

```scala
val row: Row
row(""theColumn"")
```",3198729,2012-08-11 00:43:37
64030,64320,1355035,52,since this parameter expansion technique is currently unsafe; can we drop this feature alltogether until we figure out a better way?  we could simply require the user to provide fully expanded parameter lists for now?,3198729,2012-08-11 01:06:28
64030,83701,1238902,135,"It seems like the SQL Time type is more accurately represented by a duration because time can also be negative. Unless I am missing something, the current Connector/J driver does not support negative Time. It will throw a SQLException if you try to getTim",428148,2012-07-26 01:45:57
174987,83913,1173581,23,Could you add comments in a similar style to the other functions? And could you also add some test cases in ClientSpec.scala for the new commands?,6293103,2012-07-17 02:36:55
174987,554034,1173694,23,"Will do that. I was not able to run ClientSpec.scala.. I will give it
another shot.

Saurabh

On Mon, Jul 16, 2012 at 2:36 PM, Anirudh Srinivas
<reply@reply.github.com>
wrote:
>> @@ -348,6 +360,38 @@ class Client(service: Service[Command, Reply]) {
>>    ",6293103,2012-07-17 02:52:11
174987,83913,1173851,23,"Thanks! For the ClientSpec, you need to have the redis binary installed for it to run",6293103,2012-07-17 03:08:14
292271,199939,1466000,4,"We should recommend to use Scrooge instead https://github.com/twitter/scrooge
We will deprecate the custom thrift compiler in favor of Scrooge.",8086434,2012-08-27 21:38:07
292271,622449,1470388,4,Whichever is currently preferred should go in the docs I think. Do we currently use scrooge?,8086434,2012-08-28 05:05:05
292271,401065,1470793,4,scrooge worked OK for me. I think it's important that the scrooge docs mention they need sbt v0.11.2 (or is that fixed by sbt-scrooge?). sbt v0.11.3 did not resolve when working against twitter dependencies.,8086434,2012-08-28 06:18:38
292271,199939,1471698,4,"We use scrooge in birdcage but not yet in science (the migration should happen in a very near future).

And yes, you need to mention that sbt use a plugin that call scrooge to compile thrift files. 
The latest plugin has only been release for sbt 0.11.2 
",8086434,2012-08-28 10:25:18
292271,401065,1481704,4,"""To create a Finagle Thrift service, Finagle requiers you to generate, in addition to the regular Thrift `Iface` interface, a `ServiceIface` interface that wraps all return values in a `Future`. Use either <a href=""https://github.com/twitter/scrooge"">scro",8086434,2012-08-29 06:48:25
292271,622449,1488486,4,"I didn't know there is a maven plugin. Let's add that to the sample maven
file too.
On Aug 29, 2012 8:30 AM, ""Steve Gury"" <notifications@github.com> wrote:

> In README.md:
>
> > @@ -182,6 +182,8 @@ Apache Thrift is a binary communication protocol t",8086434,2012-08-29 23:10:54
292271,401065,1492591,4,"""""""
To create a Finagle Thrift service, you must implement the `ServiceIface` Interface that <a href=""https://github.com/twitter/scrooge"">Scrooge</a> (a custom Thrift compiler) generates for your service. Scrooge wraps your service method return values wi",8086434,2012-08-30 05:51:15
292271,199939,1497865,4,"The source of the maven-finagle-thrift-plugin is in the internal repo ""birdcage"" in the maven-plugins directory, we currently use the version 0.0.5
It seems that it is not yet open sourced, you should talk to tools team about that.",8086434,2012-08-30 20:26:29
292271,622449,1501412,4,"+1 / Ship It! for @benpence's latest revision. It is clear and accurate regardless of whether maven-finagle-thrift-plugin is open sourced yet (the binaries are available right?)

@stevegury We can work on open sourcing maven-finagle-thrift-plugin separate",8086434,2012-08-31 01:38:06
292271,199939,1486589,4,"I would write something like that:
""""""
To create a Finagle Thrift service, you just need to implement an Interface generated for Finagle by [Scrooge](https://github.com/twitter/scrooge). [Scrooge](https://github.com/twitter/scrooge) is Thrift code generat",8086434,2012-08-29 20:19:45
377163,199939,1603626,7,"It would be more scala idiomatic to use the apply() method
.codec(Http())

Like here:
https://github.com/twitter/finagle/blob/master/finagle-example/src/main/scala/com/twitter/finagle/example/http/HttpServer.scala#L78",11357489,2012-09-14 04:29:57
377163,199939,1603627,16,ditto,11357489,2012-09-14 04:30:07
377163,199939,1603631,35,ditto,11357489,2012-09-14 04:30:22
377163,199939,1603629,26,ditto,11357489,2012-09-14 04:30:15
681069,156983,10453,47,"If it enters this else, does it ever release the underlying connection? Or is that not a requirement?",22627760,2011-03-22 00:21:04
681069,313632,10460,47,"good question. the idea is to allow the current request to finish. The next request will get a exception. 
    if (expired) {
      return Future.exception(
        new WriteException(new ChannelClosedException))
    }

Wilhelm, is it required to release ",22627760,2011-03-22 00:33:11
681069,313632,10528,47,"On Mon, Mar 21, 2011 at 11:21 AM, arya <
reply@reply.github.com>wrote:

> > @@ -37,6 +51,19 @@ class ExpiringService[Req, Rep](
> >      }
> >
> >      if (justExpired) didExpire()
> > +    justExpired
> > +  }
> > +
> > +  private[this] def maybeIdleExpi",22627760,2011-03-22 02:21:19
681069,64320,10552,28,"for both of these, you can use `map`:

    private[this] var idleTimeTask = maxIdleTime map { idleTime => timer.schedule(idleTime.fromNow) { maybeIdleExpire() }) }

etc.",22627718,2011-03-22 03:10:58
681069,313632,10571,28,"this is much better. fixed.

On Mon, Mar 21, 2011 at 2:11 PM, mariusaeriksen <
reply@reply.github.com>wrote:

> > -    Some(timer.schedule(maxIdleTime.fromNow) { maybeExpire() })
> > +  private[this] var idleTimeTask: Option[com.twitter.util.TimerTask] =
",22627718,2011-03-22 03:27:42
681070,156983,9430,65,This method can be removed since it is replaced by the FIND_SPACE implementation.,22627839,2011-03-18 02:49:54
681070,64320,9776,65,"yep, you're right. i killed it.",22627839,2011-03-18 22:58:44
1292084,1427209,3536295,85,Should this moved to messageReceived? I thank super.channelConnected should be called after the response for the HTTP CONNECT request is received.,37517968,2013-03-26 23:52:56
1292084,86254,3537491,85,"i don't know netty well enough to say. if we change this behavior we should also change it in SocksConnectHandler.scala, which i cribbed it from.",37517968,2013-03-27 00:49:04
1292084,64320,3517708,0,Let's make this package name `httpproxy` so it doesn't collide with `finagle-http`.,36884499,2013-03-26 00:20:32
1305372,21084,3666194,5,"I would do this:

    if (arg.hasArray) {
      new String(arg.array, arg.arrayOffset, arg.readableBytes, charset)
    } else {
      arg.toString(charset)
    }",37590171,2013-04-05 05:05:28
1305372,30433,3674079,5,"`arg.toString(charset)` will always work, right ([javadoc](http://netty.io/3.6/api/org/jboss/netty/buffer/ChannelBuffer.html#toString(java.nio.charset.Charset%29))? Is your first branch just to avoid a few function calls?",37590171,2013-04-05 19:42:12
1305372,21084,3688455,5,"Yeah, `arg.toString(charset)` will always work. However, the first branch should be faster due to less object allocations.",37590171,2013-04-08 08:24:14
1853598,132262,5439110,12,"for completeness, we should probably make count an Option.  ",51119084,2013-07-28 07:37:31
1853598,118768,5461065,12,updated the code to make count an option and adapted the tests,51119084,2013-07-30 01:44:40
1853598,199939,6214467,12,I would change the type of `count` to `Int` and change the default value to 1.,54634300,2013-09-06 22:49:38
1853598,132262,6216461,12,"I argued in the opposite direction so it's closer to the actual redis API, which takes count as an optional parameter.

from [SRANDMEMBER](http://redis.io/commands/srandmember)
""Return value
Bulk reply: without the additional count argument the comman",54634300,2013-09-06 23:51:07
1853598,199939,6218288,12,"I take my comment back, I agree with @mosesn .",54634300,2013-09-07 00:58:07
1953859,199939,5856219,6,I don't think we should have this parameter.,55902456,2013-08-20 03:14:50
1953859,67102,5856413,6,"My goal is to make sure that the tests are deterministic.  Without adding some predictability to the rng, the test will fail randomly, which can be a frustrating experience.  I could do this another way. Do you have a preference?",55902456,2013-08-20 03:25:52
1953859,199939,5874515,6,"Yes I realized that after hitting enter.
It would be nice if we could have a consistent test without exposing this internal details, let me think about that.",55902456,2013-08-20 22:15:10
1953859,64320,5894674,26,"Ah yes. The code here was actually correct, but didn’t behave well for size=2.

What’s being changed, effectively, is sampling with replacement instead of without. I agree this is probably better.

The comments need to be changed, though. Something li",55902456,2013-08-21 18:16:00
1953859,67102,5898651,26,Thanks for the explanation.  I fixed the comment.  Let me know if you want me to change the rng seeding mechanism to something else.,55902456,2013-08-21 20:34:08
1953859,199939,5912361,6,"What about passing rng as a paramter:
`rng: Random = new Random`",55902456,2013-08-22 04:09:14
1953859,67102,5927859,6,"sounds good, updated.",55902456,2013-08-22 20:46:12
2095780,132262,6314143,18,nitpick: you only need one set of parentheses here,57995511,2013-09-12 10:47:22
3103570,132262,9999102,30,has the error message changed in a more recent version of redis?  which version of redis are you testing against?  we might want to change this test to be a little more resilient against this kind of change.,91726256,2014-02-24 23:57:44
3103570,132262,9999329,7,fix indentation,91726256,2014-02-25 00:03:35
3103570,132262,9999345,19,Does this need to be special cased? It looks like the behavior is identical in these two cases.,91726256,2014-02-25 00:03:54
3103570,417274,10022205,30,"Yes, It did. My test redis version is 2.8.1",91726256,2014-02-25 09:31:56
3103570,417274,10023083,30,"From the **[Redis 2.8 release notes](http://download.redis.io/redis-stable/00-RELEASENOTES)**:

> Migrating from 2.6 to 2.8
> =========================
> 
> Redis 2.6 is mostly a strict subset of 2.8. However there are a few things
> that you should",91726256,2014-02-25 10:20:15
3103570,417274,10023324,19,I'm afraid it is. A `readBytes(replySz)` with `replySz=0` will cause an Exception to be thrown.,91726256,2014-02-25 10:34:53
3103570,132262,10024445,30,"For now, let's change it so that it doesn't check for an exact string match, and we can add a TODO or FIXME to fix it.  Ideally we'll also specify that you must have a more modern version of redis than X installed to test, but let's not get ahead of ourse",91726256,2014-02-25 11:59:55
3103570,132262,10025062,19,"The internet at my home just cut out, so I'm having trouble verifying why.
Could you explain briefly? Seems like it should be fine.
On Feb 24, 2014 10:34 PM, ""zhanggl"" <notifications@github.com> wrote:

> In
> finagle-redis/src/main/scala/com/twitter/fina",91726256,2014-02-25 12:44:17
3103570,132262,10025433,19,"I was able to try it locally, and it seems to work fine.  Can you try removing the 0 case again?",91726256,2014-02-25 13:14:27
3103570,417274,10026869,19,"Yeah, it works now. And I can't remember why it didn't
Will just remove it.",91726256,2014-02-25 14:52:52
3103570,132262,10034135,14,"this is pretty nitpicky, but could you remove the whitespace at the end of this line?",92038545,2014-02-25 19:54:39
3181196,132262,10302589,16,"To keep the api consistent, this should return an immutable Set.",94030030,2014-03-05 22:12:23
3181196,132262,10302629,5,please make sure your lines are < 100 characters long,94030030,2014-03-05 22:13:13
3181196,132262,10302825,11,"This comment seems to suggest that it will throw an exception if we try to query a key where there isn't a Set, but the tests contradict that.",94030030,2014-03-05 22:18:00
3181196,132262,10333326,14,"It won't throw an exception if the values included in the `keys` Seq are empty, I think.",94093010,2014-03-06 14:00:28
3181196,132262,10333355,22,style nit: avoid postfix operators.  `ReplyFormat.toChannelBuffers(messages).toSet` is more legible.,94093010,2014-03-06 14:03:21
3181196,145447,10335031,22,"Yep, I don't really like that syntax either and will fix it. I was just following the rest of the code in the file though :)",94093010,2014-03-06 15:51:08
3181196,145447,10335141,14,"From reading the code in [KeysCommand](https://github.com/twitter/finagle/blob/master/finagle-redis/src/main/scala/com/twitter/finagle/redis/protocol/commands/CommandTypes.scala#L20), it looked like empty key values would throw an exception as well. My [u",94093010,2014-03-06 15:56:32
3181196,145447,10335733,14,"Just noticed that the comment should probably read ""any"" instead of ""all"" in the ""if all of the values included in the `keys` Seq are empty"" part of the comment.",94093010,2014-03-06 16:20:53
3181196,132262,10353509,14,"Ah, when you said the values of the key, I thought you meant if the Sets that the keys are pointing to are empty, not the key string.  It's a bug in finagle-redis that they throw though, is that something that we can stick in this commit to fix, or do you",94093010,2014-03-07 01:27:13
3181196,145447,10358532,14,"I don't feel confident enough about the finagle-redis codebase to get started on that and besides, I would probably want to do that in a separate pull request.

I'll update the comment as you suggested.",94093010,2014-03-07 03:16:27
3657091,64320,12556100,61,"strange style: arguments should be on the same line as the opening brace.

try

```
factory flatMap { _ =>
  didRun = true
  Future.exception(exc)
}
```",110226503,2014-05-13 02:57:15
3657091,64320,12556155,11,"not needed.

also, please put all the imports in one group",110226503,2014-05-13 02:58:30
3657091,64320,12556206,20,"no space between tokens & braces.

```
  IntegrationBase {
…

  test(“…”) {
```

and so forth.",110226503,2014-05-13 02:59:30
3657091,64320,12556406,229,weird argument formatting,110226503,2014-05-13 03:04:19
3657091,64320,12556484,12,weird indentation.,110226503,2014-05-13 03:05:59
3657091,64320,12556489,19,weird indentation,110226503,2014-05-13 03:06:10
3657091,61365,12562069,30,Why do we issue a request *after* calling `.close()`?,110226502,2014-05-13 05:39:45
3657091,61365,12562078,43,"omit parens around ""foo""",110226502,2014-05-13 05:40:04
3657091,61365,12562098,15,SkepticalClusterFilter? Shouldn't these be NonShrinkingCluster?,110226502,2014-05-13 05:40:37
3657091,61365,12562125,17,"Capitalize Helper, here and elsewhere in the newly-migrated tests. And maybe make it an object, in which case all of the vals become defs.",110226502,2014-05-13 05:41:33
3657091,3490006,12774048,15,Yes that was incorrect in the original test. Correct now.,110226502,2014-05-18 20:23:00
3657091,132262,12926309,12,this indentation is still weird.,110226503,2014-05-22 03:13:48
3657091,132262,12926394,30,@p-antoine do you know the answer to evnm's question?,110226502,2014-05-22 03:15:40
3657091,3490006,12939642,30,"No idea, this is from the [original test](https://github.com/twitter/finagle/pull/268/files#diff-cecf21f33e1c7c3f4ee21effa2cc2778L25) . The proxied service should be closed and not able to apply the request, however I don't really see how the Closable tra",110226502,2014-05-22 13:28:38
3657091,61365,13018557,55,"There seem to be a number of cases like this where braces aren't padded by spaces. We typically leave a single space after opening and before closing braces:

    ... { case i if i % s == 0 => i * 2 }

Can you fix cases like this so that they match th",115874392,2014-05-24 01:54:33
3657091,3490006,13019712,55,Ok done.,115874392,2014-05-24 02:27:06
3779661,12202,13205099,1,"Would just say ""Finagle Adopters"" and include Twitter in the list and link to https://blog.twitter.com/2011/finagle-a-protocol-agnostic-rpc-system",115515892,2014-05-30 02:15:57
3779661,12202,13205120,8,"maybe an an ""Adopters"" section... list about 5 and then link to the full ADOPTERS.md :)?",115515892,2014-05-30 02:16:24
3779661,132262,13213142,6,maybe better to remove the part about asking them to contact us--it's very low friction to submit a pull request.,115515892,2014-05-30 06:12:43
3779661,132262,13213169,5,"rather than ""feel free to"", might as well change this to ""please"" while we're in here.",115515892,2014-05-30 06:13:42
3779661,146404,13214010,6,"How about I link it to [@finagle](https://twitter.com/finagle)—then we cover people with GitHub accounts _and_ people with Twitter accounts, and I'm happy to handle more traffic there (at least for now).",115515892,2014-05-30 06:57:54
3815702,132262,13342007,4,"I think it would be more appropriate for these to be in your global gitignore, rather than the finagle one.",119259564,2014-06-03 20:51:37
3815702,423711,13342365,4,"OK, do you want both lines relating to vagrant to head into my global gitignore?
```shell
.vagrant/*
Vagrantfile
```
or just the hidden vagrant folder?",119259564,2014-06-03 20:57:27
3815702,132262,13342405,23,Why does this return a Seq[Byte] instead of a ChannelBuffer?,119259564,2014-06-03 20:58:11
3815702,132262,13342485,4,"both of them, thanks",119259564,2014-06-03 20:59:06
3815702,423711,13342579,23,"I was undecided on this and wanted feedback.  Exposing the ChannelBuffer felt a big API~leaky to me, since the DUMP command returns simply a Byte sequence.  However, simply returning a ChannelBuffer does simplify a lot of things.",119259564,2014-06-03 21:00:46
3815702,423711,13342675,4,Done,119259564,2014-06-03 21:02:28
3815702,132262,13343354,23,"Yes--our netty 3 is showing :) However, there's not much we can do today.  Every other redis endpoint returns ChannelBuffers.  In the long run, we're going to move them all over to c.t.io.Buf, but until then, I think it's best to be consistent. :musical_s",119259564,2014-06-03 21:14:08
3815702,423711,13345671,23,Understood - I'll replace those endpoints then update this PR when it's done.,119259564,2014-06-03 21:59:37
3815702,132262,13347362,23,"Assuming by ""those endpoints"" you mean the ones that return Seq[Byte], since changing all of the existing ones to Buf would be a breaking change and will require a lot of coordination.",119259564,2014-06-03 22:29:00
3815702,423711,13350014,23,"Hah, yes, sorry.  I'm not looking for *that* much work",119259564,2014-06-03 23:16:11
3845361,132262,13509346,7,is this true?  I thought it would run easy_install for you to install sphinx.,121058712,2014-06-07 01:42:16
3936576,132262,13916304,21,"I think we can simplify this by just using a defaultTtl and the networkaddress.cache.ttl.  

I think a reasonable default is `Duration.Top`.",127780393,2014-06-18 19:09:45
3936576,132262,13917207,42,"we already have most of this behavior in `[InetSocketAddressUtill][0]`.  Maybe just change InetSocketAddressUtil to use getAllByName in parseHosts?

[0]: https://github.com/twitter/finagle/blob/master/finagle-core/src/main/scala/com/twitter/finagle/util",127780393,2014-06-18 19:23:46
3936576,132262,13917550,53,we can use `timer.schedule(ttl) { fn }` here.,127780393,2014-06-18 19:29:22
3936576,132262,13917734,53,"this looks like a memory leak, and a timer task leak.  could we schedule this when the Var is observed and destroy it when the observation is closed?",127780393,2014-06-18 19:32:58
3936576,132262,13917822,37,could you add scaladocs here?,127780393,2014-06-18 19:34:18
3936576,132262,13917834,19,scaladocs?,127780393,2014-06-18 19:34:26
3936576,132262,13917866,55,"idiomatically, this is just `varAddr() = Addr.Bound(addrs)`",127780393,2014-06-18 19:34:59
3936576,214020,13918339,53,"Thanks for the review. I think I can change the code to align all the comments by tomorrow. 
But for this comment, I am not very sure about the problem(memory leak and timer task leak). Can you help to explain more on this? Any example code in existing c",127780393,2014-06-18 19:41:47
3936576,30433,13918660,21,How about something finite and small instead of `Duration.Top` for the default cache ttl? I think caching forever is a surprising default behavior in the setting of web services where dns names are typically used to (a) hide IPs that change over time and ,127780393,2014-06-18 19:46:21
3936576,30433,13919826,21,"On second thought, the second part of my comment above isn't a good idea: the jvm is already caching dns resolutions for us, so we shouldn't try to ""replicate"" any of it.

One odd behavior above: if we reuse `networkaddress.cache.ttl`, then we effective",127780393,2014-06-18 20:04:01
3936576,132262,13924628,57,"maybe make this use `log.log(Level.WARNING, ""failed to resolve hosts"", ex)`",127780393,2014-06-18 21:24:34
3936576,132262,13925058,21,"Oh, whoops, I thought the default in java was to cache forever.

My impression is that the way the cache works is that it checks whether it was last checked within `networkaddress.cache.ttl`, and if it was, it won't update.  DefaultTimer.twitter is a ne",127780393,2014-06-18 21:33:00
3936576,132262,13925174,53,"Basically, the problem is that after I've scheduled this, it will sit around on the timer forever, even if I no longer care about these `InetSocketAddress`es.  Imagine that I have a web crawler which takes hostnames and crawls them.  Every time I do a DNS",127780393,2014-06-18 21:35:32
3936576,64320,13926122,31,"This is a bit of an overkill. I think it'd be simpler & clearer with more boring code:

```
val ttl = Security.getProperty(""networkaddress.cache.ttl"")
if (ttl == null) defaultTtl
else ttl.toInt.seconds max minttl min maxTtl
```",127780393,2014-06-18 21:51:59
3936576,64320,13926159,31,"(Also, is there ever any chance this string is not an integer, and .toInt could throw?)",127780393,2014-06-18 21:52:33
3936576,64320,13926262,54,"```
futurePool { parseHosts } 
```

to make it syntactically clear that this is a call-by-name",127780393,2014-06-18 21:54:33
3936576,64320,13926308,19,the newly introduced fields should all be marked ``private``,127780393,2014-06-18 21:55:20
3936576,64320,13926372,40,don't construct the array every time -- factor it out,127780393,2014-06-18 21:56:31
3936576,64320,13926444,43,"this would fail in another thread, and the error would not propagate back. shouldn't result in an ``Addr.Failed``?

better yet, pre-parse ``hostPorts``, to do input validation on ``bind``",127780393,2014-06-18 21:57:42
3936576,214020,13951044,53,"Ok, I got your point. So what is the proper way to get notified when observation is closed?
I looked at the code here:https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/util/Var.scala#L414-L418,
but I didn't get the point h",127780393,2014-06-19 07:23:02
3936576,83701,13951965,53,"try something like:

    Var.async[Addr](Addr.Bound(parseHosts)) { u =>
      timer.schedule(...) { 
        futurePool(parseHosts) onSuccess { addrs =>
          u() = Addr.Bound(addrs)
        } onFailure { ... }
      }
    }",127780393,2014-06-19 08:17:50
3936576,214020,13970448,53,"Thank you @roanta .
I've tested using Var.async and it works fine now.",127780393,2014-06-19 19:30:37
3936576,30433,13970663,21,"- Caching forever [was the default in java 5](http://docs.oracle.com/javase/1.5.0/docs/api/java/net/InetAddress.html), but [they changed it in java 6](http://docs.oracle.com/javase/6/docs/api/java/net/InetAddress.html).

- Yeah, I think I agree that reu",127780393,2014-06-19 19:33:53
3936576,132262,13975251,21,"I looked into what [java] does for this case, and it looks like it uses a `PrivilegedAction` to check, and doesn't try/catch on `SecurityException` (either it's impossible in a Privileged action or they're content to crash the process).  Maybe we should f",127780393,2014-06-19 20:39:42
3936576,30433,13976793,21,"Sgtm.

Re `SecurityException`: Note that if we don't pick a ttl (= timer period) then we're stuck with caching forever, which is the opposite of your `""dns caching turned off""` message above—it would need to instead say something like `""dns cache refres",127780393,2014-06-19 21:06:51
3936576,132262,13977805,63,"make this parseHosts() since it's not purely [functional][0].

[0]: http://docs.scala-lang.org/style/method-invocation.html",128485653,2014-06-19 21:23:43
3936576,132262,13977839,58,maybe we should move this parsing stuff into `InetSocketAddressUtils`?  It seems like we're repeating ourselves.,128485653,2014-06-19 21:24:13
3936576,132262,13977901,64,"this seems cleaner as `case (host, port) =>`",128485653,2014-06-19 21:25:08
3936576,132262,13977931,76,drop the trailing space,128485653,2014-06-19 21:25:34
3936576,132262,13978087,30,"@jdanbrown let me know if I got it wrong, but I think that we agreed that the right way to do this was:

```
java.security.AccessController.doPrivileged(

)",128485653,2014-06-19 21:28:03
3936576,132262,13978569,16,"this will only do something when there's a change, and there will never be a change.  how about instead using `Var.sampled` to check that addrs is what you expect it to be?",128485653,2014-06-19 21:35:42
3936576,30433,13980465,30,@mosesn lgtm!,128485653,2014-06-19 22:09:51
3936576,214020,14005560,16,"From my testing, it seems the ""assert"" is executed and means there is a change.
Looking at the code here: https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/util/Var.scala#L214,
the value will always be published each time ",128485653,2014-06-20 08:03:25
3936576,132262,14010272,16,"Ahh, I see, because changes is a wrapper around observe.  Yes, that makes sense.  However, I think we should use `Var.sample` anyway, because it communicates our intent more clearly.",128485653,2014-06-20 13:10:24
3936576,132262,14024267,55,"We don't need to leak the implementation details here.  Something along the lines of, ""Binds to the specified hostnames, and refreshes the DNS information periodically"" would be better.",128773935,2014-06-20 20:07:44
3936576,132262,14024362,64,this also belongs in `InetSocketAddressUtil`.,128773935,2014-06-20 20:09:27
3936576,64320,14029248,30,"I think that in this case, it's a lot clearer to use standard constructs.

```
val d = try {
  val ttl = java.security.AccessController.doPrivileged(
    new PrivilegedAction[String]() {
      def run(): String = Security.getProperty(""networkaddress",128485653,2014-06-20 21:45:24
3936576,64320,14029343,30,Should we have some reasonable bounds on TTL?,128485653,2014-06-20 21:47:35
3936576,64320,14029359,64,This is more appropriately called 'resolveHostPorts' or some such.,128773935,2014-06-20 21:48:09
3936576,64320,14029460,60,"This isn't really a valid destination address, right? What does it mean?",128773935,2014-06-20 21:50:38
3936576,64320,14029508,80,"TimerTask is itself a Closable, just return it directly.",128773935,2014-06-20 21:51:51
3936576,132262,14029992,73,"actually, it occurs to me that we should handle the -1 (never refresh) case by just not making a timer task.",128773935,2014-06-20 22:02:53
3936576,132262,14030062,30,"Since this is the way that the jdk learns about its cache ttl, I don't know that it would make sense to have an upper bound on the ttl (since it can't possibly have changed before the upper bound).  A lower bound would probably be reasonable--a TTL of 0 w",128485653,2014-06-20 22:04:54
3936576,214020,14050317,60,"This is I came up to align the behavior of ""InetSocketAddressUtil.parseHosts"". I also don't know the scienario of this case.",128773935,2014-06-21 21:10:39
3936576,64320,14098477,64,This address does not make sense to me.,129335626,2014-06-24 01:36:43
3936576,64320,14098676,71,"This could run into a problem if the DNS resolution takes a long time. (This can happen -- what are the timeouts used here?).

In this case, you could have several DNS updates piling up (and one thread allocated for each).

I suggest you use ``com.twi",129335626,2014-06-24 01:39:53
3936576,64320,14098749,45,I still think we should set a minimum TTL here. (Maybe 1 second?),129335626,2014-06-24 01:41:05
3936576,64320,14098764,45,(Note that small TTLs exacerbate the problem I pointed out below.),129335626,2014-06-24 01:41:17
3936576,132262,14098976,45,"One second is implicitly a minimum TTL with this API, because we turn 0s into Duration.Top.",129335626,2014-06-24 01:45:07
3936576,83701,14099274,64,"@jixu This was part of InetSocketAddressUtil.parseHosts as a special case to allow servers to use ephemeral ports with the "":*"" syntax. It's not needed for clients.",129335626,2014-06-24 01:50:55
3936576,214020,14185420,64,"Ok, I will remove this line from here.",129335626,2014-06-25 18:38:42
3936576,214020,14188707,71,"@mariusaeriksen Do you mean we should use <code>com.twitter.finagle.util.Updater</code> to prevent duplicated DNS resolution on one host?
Any examples I can refer to create the <code>Updater</code>?",129335626,2014-06-25 19:30:56
3936576,214020,14188771,45,Agree that we have 1 second as minimum implicitly.,129335626,2014-06-25 19:31:56
3936576,748181,14286810,38,"`AccessController.doPrivileged` may throw `AccessControlException` in some configurations. I suggest catching it here. Not catching it will render `InetResolver` unusable in those configurations. 

I'm not sure other parts of Finagle would work correctl",131403495,2014-06-27 15:18:39
3936576,214020,14293499,38,"From the doc: http://docs.oracle.com/javase/7/docs/api/java/security/AccessController.html#doPrivileged(java.security.PrivilegedAction)
<code>AccessController.doPrivileged</code> may only throws <code>NullPointerException</code>
@sirmax Do you have any ",131403495,2014-06-27 18:58:56
3936576,748181,14294775,38,"Personally no, I don't have such experience. But it seemed odd to me that one can safely elevate permissions, so I googled ""AccessController.doPrivileged AccessControlException"" and found a some cases when it does happen. One was a sandboxed applet, anoth",131403495,2014-06-27 19:25:37
3936576,214020,14387531,38,"ok, I think I got the same page which described the possibility of throwing out ""AccessControlException"" and I agree that it should be caught.
Anyway, I will catch any exception from that ""Try"" and turn off DNS cache refresh if exception is thrown.",131403495,2014-07-01 08:37:04
3936576,64320,14563497,82,"This isn't quite going to work since the update itself is asynchronous (you ferry it off to a future pool).

Simply moving the updater to inside the future pool invocation should be sufficient.",132541068,2014-07-04 20:36:33
3978765,64320,14217177,25,"We don't use syntax highlighting in our docs; make it just 

```
::
<tab>code..
```

for consistency.",129996627,2014-06-26 03:52:52
3978765,64320,14217225,13,"Not to mention *possible* for files that could not fit in memory, or for infinite streams. ",129996627,2014-06-26 03:54:02
3978765,64320,14217269,23,Can we fix this before committing these docs?,129996627,2014-06-26 03:55:24
3978765,198588,14218723,25,"Sure.

In the future are we looking to colorize? It's a much nicer read.",129996627,2014-06-26 04:36:22
3978765,198588,14218732,13,I'll add that.,129996627,2014-06-26 04:36:37
3978765,198588,14218750,23,"I'm not clear on this, what are you referring to?",129996627,2014-06-26 04:37:03
3978765,3490006,14219901,23,"I think it's about using the new 6.0 style to create a new instance, it requires to get rid of `ServerBuilder` and `ClientBuilder`. 
Example for client  : `def newClient(codec: Codec): HttpClient` or using `def withCodec(codec: Codec): HttpClient` . 
[F",129996627,2014-06-26 05:12:27
3978765,64320,14246827,25,Personally I find the exact opposite. But I realize I'm in the minority there.,129996627,2014-06-26 20:21:47
3978765,64320,14252740,23,@luciferous right. we should make it work with the new-style APIs.,129996627,2014-06-26 22:07:09
3978765,198588,14257476,23,"Ok, I'll look into that.",129996627,2014-06-26 23:32:21
3978765,198588,14327219,25,"I'm happy to decolorize this branch, but if we're writing documentation for wide distribution, is it reasonable that we should want to optimize its presentation for the majority?",129996627,2014-06-29 07:37:11
3978765,64320,14332447,25,"It's a separate issue. The most important thing is to keep things consistent. If you're passionate about colors, then create a separate change for that which changes all examples

(I'll be against it, but I suspect I'll lose out.)",129996627,2014-06-30 04:40:13
3978765,5437425,14334921,4,"While technically correct, I don't think ""fixed length"" is quite the right phrase here. Usually that implies it is fixed across *all* requests. (E.g. in protocols, we talk about 'fixed-width' fields)

Maybe instead say something like: "".. encountered so",129996627,2014-06-30 09:00:13
3978765,64320,14334928,4,"Another term for this is .. ""fully buffered"", but that might be a little too jargony.",129996627,2014-06-30 09:00:45
3978765,5437425,14334936,44,"I think it's important to highlight the fact that the *interface* doesn't change -- it's valid, and encouraged(!) to use the byte stream interface even if you're aggregating chunks.

Presumably this is the only option in the new http codec and the user ",129996627,2014-06-30 09:02:22
3978765,64320,14334945,44,"more generally: the notion of a 'chunk' is a rather implementation specific thing; the important thing is byte streams.  (and, again, ideally this would work -- and i think can be made to work even in today's netty -- with large messages that aren't actua",129996627,2014-06-30 09:03:10
3978765,64320,14334958,86,`Reader.writable()` does have this property as well; the `Future[Unit]` from `write()` isn't satisfied until the previous write has been fully read.,129996627,2014-06-30 09:04:42
3978765,5437425,14334966,120,and i don't think we should even guarantee this in Finagle.,129996627,2014-06-30 09:05:31
3978765,64320,14334986,149,"Of course in practice, you'd just use `com.twitter.io.InputStreamReader`, which you should probably note.",129996627,2014-06-30 09:07:03
3978765,5437425,14335002,177,why not just `finished ensure { h.close() }`  (no `.unit`),129996627,2014-06-30 09:07:53
3978765,132262,65008387,102,we need to close the response here to see an EOF,129996627,2016-05-30 00:18:54
3996364,146404,14665054,4,Is there a reason these MySQL tests are rearranged here? Could you undo (and move to a separate pull request if intentional) to keep this focused on the SMTP work? Thanks!,134809495,2014-07-08 21:54:16
3996364,146404,14665833,9,"It'd be better to keep this example out of the project proper (and definitely out of the root of the `com.twitter.finagle` package). The best place at the moment would be `finagle-example`, but I'll follow up over email about other ideas.",134809495,2014-07-08 22:09:02
3996364,146404,14666628,16,"It's worth noting that `onFailure` takes a `Function`, not a `PartialFunction`, so this will blow up for any exceptions that don't match here.",134809495,2014-07-08 22:20:24
3996364,146404,14667017,24,Can you clarify the intention here? I'm not sure what you'd be handling.,134809495,2014-07-08 22:25:46
3996364,146404,14667256,16,"Also, is there a reason you're explicitly returning `Future[Unit]` here? The inferred return type of `res` would be `Future[Reply]`, and the `Future[Unit]` return type only works because of Scala's value discarding, which is frequently very confusing.",134809495,2014-07-08 22:29:16
3996364,146404,14667494,22,The indentation is a little confusing here—can you align definitions at the same level?,134809495,2014-07-08 22:32:19
3996364,146404,14667752,16,"One more—could you clarify where `send` comes from here, since without context it's not entirely clear that it's a `Service`? It looks like a method, and we don't want to send users digging for something they're not going to find.",134809495,2014-07-08 22:35:56
3996364,146404,14667978,4,These should be `def`s?,134809495,2014-07-08 22:39:52
3996364,146404,14668134,43,Can you motivate the class hierarchy here a bit? Seems odd to me to have `Reply` as a subtype of `UnspecifiedReply`.,134809495,2014-07-08 22:41:45
3996364,146404,14671269,9,After some conversation on this end it sounds like we should just move this to `finagle-example` for now.,134809495,2014-07-08 23:25:58
3996364,1517252,14699774,4,"I believe it was accidental due to a bug somewhere. Thanks for noticing, I must have missed that.",134809495,2014-07-09 14:08:42
3996364,1517252,14700292,16,"`send` and `Future[Unit]` come from `Example.scala`, where it was copied from. I can make it more general.",134809495,2014-07-09 14:23:27
3996364,1517252,14700341,24,This is just another way to handle errors. Should I comment that explicitly?,134809495,2014-07-09 14:25:02
3996364,1517252,14703236,43,"I intended `UnspecifiedReply` to be a 'protoreply', not classified yet, which is formed during decoding, and `Reply` to be a supertype for all final reply classes. Since final replies have the same characteristics as a protoreply, except they are classifi",134809495,2014-07-09 15:41:42
3996364,146404,14715143,24,I'm not sure you need to show multiple ways of handling failure here (although it certainly doesn't hurt!). My question was more about the fact that you know `res` has succeeded if you get to this point—you've either handled the errors in the preceding `o,134809495,2014-07-09 20:14:25
3996364,1517252,14732106,24,"It seems I should clarify that these are two separate pieces of code, not a single program part.",134809495,2014-07-10 00:54:29
3996364,358743,15538669,21,"leave a blank line above
comment text starts with a space after the '//'

here and everywhere",142678861,2014-07-29 22:32:57
3996364,358743,15538792,33,"isn't it necessary to block? otherwise this thread ends and since all other threads are daemon threads, the program exits shortly thereafter",142678861,2014-07-29 22:34:57
3996364,358743,15538899,41,I think this section should be moved to the top (as the first sub-section of Usage) as this is what the typical use case will be,142678861,2014-07-29 22:36:34
3996364,358743,15538935,19,prefer to do log.error(...) instead of println(...),142678861,2014-07-29 22:37:20
3996364,358743,15539009,25,log.error(...) instead of a println(...),142678861,2014-07-29 22:38:29
3996364,358743,15539291,107,"this text doesn't seem to align (perhaps indicates presence of a hard-tab)
prefer to use all spaces in your code and no hard-tabs",142678861,2014-07-29 22:42:34
3996364,358743,15541754,45,"Surprised to see email-headers are missing:
http://tools.ietf.org/html/rfc2076
http://kb.mediatemple.net/questions/892/Understanding+an+email+header

As a first step, it might be enough to offer headers as Seq[String]",142678861,2014-07-29 23:18:32
3996364,200065,15547713,45,"1. Generally the ""getFoo"" names aren't used in Scala due to the Uniform Access Principal. You can simply implement `def foo` (and `def foo_=` for a setter).
2. It seems that general header access of the form `def headers: Seq[(String, String)]` is desira",142678861,2014-07-30 00:54:55
3996364,1517252,15638707,33,"That was what I meant, I just supposed that in practice the program would probably not end like this, but have something else done in background.",142678861,2014-07-31 17:22:24
3996364,132262,15892963,3,sort imports alphabetically please (within the same line it's OK to be unordered),144386462,2014-08-06 23:25:29
3996364,132262,15893013,14,"Please add an explicit return type annotation.  All public methods should have explicit return types.  In this case, Unit.",144386462,2014-08-06 23:26:18
3996364,132262,15893040,17,"we don't use this style elsewhere in finagle, please just indent by two spaces rather than aligning.",144386462,2014-08-06 23:26:42
3996364,132262,15893104,21,"in general, we use 0-arity methods without parentheses if it acts like a field.  `build()` doesn't act anything like a field, so let's use parens.",144386462,2014-08-06 23:27:25
3996364,132262,15893150,29,please indent two spaces in these kinds of blocks.,144386462,2014-08-06 23:28:14
3996364,132262,15893209,34,this should match the indentation level of the line that started the block.,144386462,2014-08-06 23:28:57
3996364,132262,15893247,36,log these instead of just sending them to stdout.,144386462,2014-08-06 23:29:29
3996364,132262,15893282,36,"also there isn't a guarantee that it will be printed before the future returns, since it might buffer.",144386462,2014-08-06 23:30:01
3996364,132262,15893324,3,Please make all of these line lengths < 100 characters.,144386462,2014-08-06 23:30:37
3996364,132262,15893360,4,Why only plaintext?  What kinds of restrictions are there?,144386462,2014-08-06 23:31:02
3996364,132262,15893399,11,add a link to EmailMessage.scala.,144386462,2014-08-06 23:31:35
3996364,132262,15893572,13,add a link.,144386462,2014-08-06 23:34:03
3996364,132262,15893607,17,"fix indentation to just two spaces, instead of aligned.  should look like:

```scala
val email = EmailBuilder()
  .sender....
```",144386462,2014-08-06 23:34:32
3996364,132262,15893663,24,Why does it return `Future.Done` on an error?  Wouldn't you expect it to return a failed `Future`?,144386462,2014-08-06 23:35:23
3996364,132262,15893716,3,Is this RFC the best resource to learn about smtp?  Might be useful to include general resources to help n00bs get started.,144386462,2014-08-06 23:36:08
3996364,132262,15893748,30,"""every next try"" => ""every subsequent try"".",144386462,2014-08-06 23:36:36
3996364,132262,15893793,34,"It's a little messy to use the inline linking, might be easier to read the raw file if you use the [0] linking instead.",144386462,2014-08-06 23:37:18
3996364,132262,15893832,53,I think this should be log.error.  ditto a few lines up.,144386462,2014-08-06 23:38:01
3996364,132262,15893942,50,"My impression of these styles of logging is that you need to format the string to be ready to get arguments, à la ""Error processing request: %s"", info.",144386462,2014-08-06 23:39:26
3996364,132262,15894043,65,"""but does not send greeting to it"" => ""but does not return a greeting""
""without that"" => ""without it"".

By incorrect, do you mean malformed?",144386462,2014-08-06 23:40:52
3996364,132262,15894070,67,"What kind of closing?  If I send a kill -9, presumably it won't send a quit command.",144386462,2014-08-06 23:41:11
3996364,132262,15894114,18,"The way this works has changed slightly--right now, `StackClient` is the new way of doing this.  I know you're near the end of your summer, so you might not have time to change this, but might be worth looking and seeing if switching over is simple.",144386462,2014-08-06 23:42:11
3996364,132262,15894126,12,"we don't need to know it's implemented with a DefaultClient, it's an implementation detail.",144386462,2014-08-06 23:42:24
3996364,132262,15894131,3,sort imports,144386462,2014-08-06 23:42:28
3996364,132262,15894158,13,this comment probably goes without saying.,144386462,2014-08-06 23:42:52
3996364,132262,15894228,42,is it OK to send many of these?  it seems like it would be easy for many threads to try to close this service many times.,144386462,2014-08-06 23:43:50
3996364,132262,15894240,40,return type,144386462,2014-08-06 23:43:59
3996364,132262,15894249,37,return type,144386462,2014-08-06 23:44:04
3996364,132262,15894253,33,return type,144386462,2014-08-06 23:44:10
3996364,132262,15894289,35,"add a space before the {, this line is > 100 characters.",144386462,2014-08-06 23:44:36
3996364,132262,15894401,42,I'm not sure this is the right layer to have this at.  Maybe it would make more sense in your dispatcher?  Then you wouldn't entail a new allocation every time you requested a new connection.,144386462,2014-08-06 23:46:06
3996364,132262,15894453,38,instead of ```flatMap  { ... Future.value(x) }``` just do ```map { ... x }```,144386462,2014-08-06 23:46:51
3996364,132262,15894640,57,"We don't need to describe what it doesn't do, describing what it does is sufficient.  However, for my edification, could you explain how you chose to just return a Future.Done?  Is the reply in the smtp spec anemic?",144386462,2014-08-06 23:49:34
3996364,132262,15894661,69,return type annotation,144386462,2014-08-06 23:49:58
3996364,132262,15894725,72,map instead of flatMap,144386462,2014-08-06 23:50:58
3996364,132262,15894767,73,"not sure this is in the right location.  I don't know SMTP that well, is there any reason why we wouldn't want to start a connection with this?  maybe it should just be in the dispatcher?",144386462,2014-08-06 23:51:45
3996364,132262,15894800,6,"indentation, switch over to two spaces.  Also, put the `from: Seq[String]` on the next line.",144386462,2014-08-06 23:52:14
3996364,132262,15894839,11,please switch from snake_case to camelCase.,144386462,2014-08-06 23:52:44
3996364,132262,15894848,14,put the end paren on the next line.,144386462,2014-08-06 23:52:54
3996364,132262,15894853,18,"*/ should be on the next line.

""Constructs"" might be more clear than ""composes"".",144386462,2014-08-06 23:53:02
3996364,132262,15895002,19,Let's collapse EmailBuilder and Payload.  I don't see a clear benefit here to separating our data and our behavior.,144386462,2014-08-06 23:55:27
3996364,132262,15895050,25,"looks like we don't do any validation on email addresses.  this is probably worth documenting somewhere, or else adding a TODO.",144386462,2014-08-06 23:56:09
3996364,132262,15895135,95,camelCase instead of snake_case.,144386462,2014-08-06 23:57:18
3996364,132262,15895266,138,add parens,144386462,2014-08-06 23:57:41
3996364,132262,15895377,148,"we don't assume anything is null by default, why do we assume date might be null?  if it's OK to not set it, let's make it an Option.",144386462,2014-08-06 23:59:06
3996364,132262,15895400,139,return type annotation,144386462,2014-08-06 23:59:29
3996364,132262,15895406,154,return type annotation,144386462,2014-08-06 23:59:34
3996364,132262,15895428,172,"in idiomatic scala, we usually use Options for optional arguments.",144386462,2014-08-06 23:59:50
3996364,132262,15895435,167,two spaces indentation,144386462,2014-08-06 23:59:58
3996364,132262,15895497,182,fix indentation,144386462,2014-08-07 00:00:56
3996364,132262,15895506,181,add return type,144386462,2014-08-07 00:01:03
3996364,132262,15895511,177,line length,144386462,2014-08-07 00:01:08
3996364,132262,15895521,166,return type annotation,144386462,2014-08-07 00:01:16
3996364,132262,15895555,9,fix indentation,144386462,2014-08-07 00:01:45
3996364,132262,15895587,10,add return type annotation.  is there any reason to not just make this a val?  presumably both of these calls are cheap/free.,144386462,2014-08-07 00:02:22
3996364,132262,15895619,9,this would also make sense as a val.,144386462,2014-08-07 00:02:41
3996364,132262,15895634,18,syntactically correct according to what?,144386462,2014-08-07 00:02:58
3996364,132262,15895661,24,elaborate on the issue in your assertion.,144386462,2014-08-07 00:03:19
3996364,132262,15895675,18,mention the kinds of exceptions that you will throw if it's not syntactically correct.,144386462,2014-08-07 00:03:34
3996364,132262,15895705,25,I think String has a nonEmpty method on RichString.,144386462,2014-08-07 00:04:08
3996364,132262,15895806,25,"This might also be more idiomatic if you destructured it like this:

```scala
val arr: Array[String] // we've already checked it's of length 2
val Array(first, second) = arr
```",144386462,2014-08-07 00:05:26
3996364,132262,15895864,40,either filterNot or nonEmpty.  also you can combine your filter and map in a collect.,144386462,2014-08-07 00:06:05
3996364,132262,15895875,40,add return type annotation.,144386462,2014-08-07 00:06:17
3996364,132262,15895920,51,should we make this final?  or can you imagine a case in which you might want to override it?,144386462,2014-08-07 00:06:54
3996364,132262,15895951,51,"since this is one expression, we can remove the {} if you want, but it's just a stylistic thing.",144386462,2014-08-07 00:07:21
3996364,132262,15895975,59,is proper capitalization part of the spec?,144386462,2014-08-07 00:07:39
3996364,132262,15895989,67,rm {},144386462,2014-08-07 00:07:49
3996364,132262,15896033,70,`Time.now` is more idiomatic in finagle-y code.  Is that hard to use here for some reason?,144386462,2014-08-07 00:08:23
3996364,132262,15896112,11,"should be def toString(): String = cmd.  since cmd and toString are the same, maybe you should just make rename the argument to Request toString?  or do you think that would be confusing.",144386462,2014-08-07 00:09:25
3996364,132262,15896150,3,sort imports,144386462,2014-08-07 00:09:56
3996364,132262,15896170,12,"indentation, put a space before the {.",144386462,2014-08-07 00:10:13
3996364,132262,15896201,17,getClass.getName is more explicit.,144386462,2014-08-07 00:10:36
3996364,132262,15896221,23,what defines correctness?,144386462,2014-08-07 00:10:54
3996364,132262,15896243,25,private[this] or scala will generate an accessor method.,144386462,2014-08-07 00:11:05
3996364,132262,15896289,26,"read definitely doesn't act like a field, let's add parens.",144386462,2014-08-07 00:11:50
3996364,132262,15896337,28,"since we never use unit, maybe just use `before` instead of flatMap?",144386462,2014-08-07 00:12:33
3996364,132262,15896416,193,"maybe this should be FINE or TRACE.  this seems like a lot to log at INFO, although maybe because it's email you expect it to be lower throughput?",144386462,2014-08-07 00:13:42
3996364,132262,15896464,201,"given that this is totally synchronous, maybe this should return Unit instead of Future[Unit]?",144386462,2014-08-07 00:14:30
3996364,132262,15896484,49,before,144386462,2014-08-07 00:14:54
3996364,132262,15896658,57,"I can guarantee you that signal will be Future.Unit.  Is that correct behavior?  If it is, let's inline this.",144386462,2014-08-07 00:17:53
3996364,132262,15896719,74,"there's a ton of duplicated code here, which doesn't seem strictly necessary.  let's also unalign this, we don't use that style elsewhere in finagle.",144386462,2014-08-07 00:18:40
3996364,132262,15896759,3,sort imports,144386462,2014-08-07 00:19:18
3996364,132262,15896766,3,sort imports,144386462,2014-08-07 00:19:24
3996364,132262,15896864,45,"Thinking about this more, what's the point of separating EmailMessage from EmailBuilder.",142678861,2014-08-07 00:20:49
3996364,132262,15896888,20,richmsg => richMsg,144386462,2014-08-07 00:21:11
3996364,132262,15896897,21,fix indentation,144386462,2014-08-07 00:21:17
3996364,132262,15896922,5,sort imports,144386462,2014-08-07 00:21:35
3996364,132262,15896964,31,"`flatMap { _ => Future.Done }`

is isomorphic to

`.unit`",144386462,2014-08-07 00:22:12
3996364,132262,15896983,31,"Actually, in this case you can just use `Future.join`.",144386462,2014-08-07 00:22:33
3996364,132262,15896998,25,no need to break this up onto a few lines.  just one line is fine.,144386462,2014-08-07 00:22:52
3996364,132262,15897090,6,@roanta @mariusaeriksen thoughts?  how does this fit in with the new exception hierarchy?,144386462,2014-08-07 00:23:53
3996364,132262,15897111,17,"this is a nop, since info === content.",144386462,2014-08-07 00:24:16
3996364,132262,15897128,16,we can move this into an object.  no need to put it in the case class.,144386462,2014-08-07 00:24:32
3996364,132262,15897177,16,"uh, ignore this, I see the issue now.",144386462,2014-08-07 00:25:27
3996364,132262,15897230,61,"let's put this next to UnspecifiedReply, since they're related.",144386462,2014-08-07 00:26:17
3996364,132262,15897310,3,this line is > 100 characters,144386462,2014-08-07 00:27:29
3996364,132262,15897315,3,sort lines,144386462,2014-08-07 00:27:33
3996364,132262,15897331,9,this line is > 100 characters,144386462,2014-08-07 00:27:47
3996364,132262,15897382,9,does this need to be at the netty layer?  it will be a little messy if we want to swap out a different backend (like netty 4),144386462,2014-08-07 00:28:28
3996364,132262,15897409,20,"camelCase, not snake_case.",144386462,2014-08-07 00:28:54
3996364,132262,15897426,27,"this is the same as before, DRY please.",144386462,2014-08-07 00:29:04
3996364,132262,15897470,38,incredibly similar to the ones that came before.  I bet you can make this more clear and concise.,144386462,2014-08-07 00:29:46
3996364,132262,15897541,30,Standart => Standard,144386462,2014-08-07 00:30:46
3996364,132262,15897558,21,wrap this in an Option and we can just match on it.,144386462,2014-08-07 00:31:00
3996364,132262,15897580,24,what other type can this be?,144386462,2014-08-07 00:31:18
3996364,132262,15897625,26,we can use destructuring to do this more concisely.  do we want to do some validation here to avoid an array out of bounds issue?,144386462,2014-08-07 00:31:54
3996364,132262,15897669,13,add return type annotation,144386462,2014-08-07 00:32:32
3996364,132262,15897722,17,why is this ascii?,144386462,2014-08-07 00:33:15
3996364,132262,15897765,3,sort lines,144386462,2014-08-07 00:33:54
3996364,132262,15897770,6,sort lines,144386462,2014-08-07 00:34:00
3996364,132262,15897793,5,sort imports,144386462,2014-08-07 00:34:21
3996364,132262,15897837,40,indent these by two spaces.,144386462,2014-08-07 00:35:00
3996364,132262,15897872,14,let's use MockitoSugar (from scalatest) instead of MockitoStubs (from specs).,144386462,2014-08-07 00:35:30
3996364,132262,15897907,20,why is this commented out?,144386462,2014-08-07 00:36:11
3996364,1517252,15940365,24,It doesn't. It returns `Future.done` in case of success. In case of failure it returns the first encountered error wrapped in a `Future`.,144386462,2014-08-07 19:56:13
3996364,1517252,15943087,57,"The logic behind this is such: you either send the email successfully, or there is some error that prevents it to be sent. The request type here is an email, not an SMTP command. Which of the many replies SMTP server sent during the mail session should be",144386462,2014-08-07 20:33:23
3996364,1517252,15943847,73,"A hello request identifies the client, and the RFC recommends that SMTP sessions are started with it. It can be moved to the connection phase in the dispatcher, though.",144386462,2014-08-07 20:46:21
3996364,1517252,15944197,25,"If you mean that email addresses should be checked to look like `user@domain.com`, this is done when constructing MailingAddress'es from them. I can add this type of requirement here too.",144386462,2014-08-07 20:51:15
3996364,1517252,15946506,45,"This was meant to be used for the possibility of integration with other email libraries, e.g. preparing email payload in javamail and sending it through finagle-smtp.",142678861,2014-08-07 21:27:33
3996364,1517252,15946787,11,"I do think that would be confusing. Also, this is an intuitive hint that cmd is precisely the text command that will be sent to SMTP server.",144386462,2014-08-07 21:31:45
3996364,1517252,15946979,74,"I changed that when I was working on the more complete version, should I also make changes here?",144386462,2014-08-07 21:35:37
3996364,1517252,15947280,57,"It is indeed correct, since `dispatch()` method returns `Future[Unit]`, and this signal is returned by it. ",144386462,2014-08-07 21:41:26
3996364,1517252,15947345,201,It is used as a return value in `dispatch()` method (see the comment there).,144386462,2014-08-07 21:42:41
3996364,1517252,15947502,17,"Because the default charset for SMTP is 7-bit ASCII. This version doesn't implement any extensions dealing with 8-bit and binary data, it is to be in the next one.",144386462,2014-08-07 21:46:02
3996364,1517252,15947619,20,"I thought about making a wrapper for this library in the beginning but decided not to do that yet, so I commented this out and forgot to clean, sorry.",144386462,2014-08-07 21:48:12
3996364,132262,15955283,24,"OK, the docs make it sound like it returns Future.Done regardless.  Can you fix the docs?",144386462,2014-08-07 23:45:07
3996364,132262,15955378,57,Why does smtp have so many different replies?  Or does it only have one success reply per command?  Do replies add granularity to success?,144386462,2014-08-07 23:46:17
3996364,132262,15955519,73,"Hurk, how long do SMTP sessions last?  Do we start an SMTP session with a tcp connection and tear it down when we turn down the SMTP session, or do we set it up / tear it down with the request?",144386462,2014-08-07 23:48:15
3996364,132262,15955552,25,"No need, just document the contract.",144386462,2014-08-07 23:48:49
3996364,132262,15955607,45,Can we make EmailBuilder an implementation of EmailMessage then?,142678861,2014-08-07 23:49:29
3996364,132262,15955670,11,"OK, let's just change this to `def toString(): String` then.",144386462,2014-08-07 23:50:19
3996364,132262,15955701,74,"no, I can just wait for the next release.",144386462,2014-08-07 23:50:47
3996364,132262,15955917,57,"what I'm saying is that there's no point in saving signal off into a val.  this code is equivalent to:

```scala
decodeReply(rp, p)
p onFailure {
 ...
}
Future.Done
```

This also makes it more clear that decodeReply is mutating, and doesn't ret",144386462,2014-08-07 23:53:50
3996364,132262,15955964,25,should this be ascii?,144386462,2014-08-07 23:54:27
3996364,132262,15955998,17,"OK, I got confused because you use utf8 elsewhere in the codebase.  I commented on the bit where you use utf8.",144386462,2014-08-07 23:55:06
3996364,1517252,15982774,42,"The problem is, when I put this in the dispatcher, nothing is actually sent at the end of the session. And the quit request must be sent before closing the connection.",144386462,2014-08-08 13:38:51
3996364,1517252,15983408,57,"The success replies to different commands usually have different informational strings, so for each command there is actually a specific success reply. Not all of them even have the same reply code. However, the email can be sent only if all the commands ",144386462,2014-08-08 13:56:30
3996364,1517252,15983813,73,The first case. The session lasts until quit command is sent (and then the server closes the connection) or some connection error occurs.,144386462,2014-08-08 14:08:25
3996364,1517252,15989773,40,"`isEmpty()` here is the method of `MailingAddress`, not `String`, but I can add `nonEmpty()` too, if it seems necessary.",144386462,2014-08-08 17:21:20
3996364,1517252,15991700,51,"If we wanted to implement it the other way (constructing headers from fields, as there is access for fields and no access for headers - as far as I can remember, this is the case with javamail, for example), we would need to override it. Actually, it is m",144386462,2014-08-08 18:16:20
3996364,1517252,15992438,59,"Yes, it is. For example: [originator fields](http://tools.ietf.org/search/rfc5322#section-3.6.2)",144386462,2014-08-08 18:31:01
3996364,132262,15993515,59,"I might be misreading, but it looks like it doesn't specify case in the section you linked to, and in the section on [synctactic notation][0] they say that if it's in quotes, that means that it's case insensitive.  Is there something I'm missing?

[0]: ",144386462,2014-08-08 18:53:37
3996364,132262,15993548,51,"OK, sounds good to me.",144386462,2014-08-08 18:54:17
3996364,132262,15993583,40,"no, it's fine.  just use filterNot instead of filter.",144386462,2014-08-08 18:55:00
3996364,132262,15993785,42,"So I think by default, finagle will hold open a tcp connection until you actually shut down the client.  From what you said about the length of smtp sessions, it sounds like that's correct behavior, no?  Or is the problem that you are destroying the clien",144386462,2014-08-08 18:59:30
3996364,132262,15993851,57,"Got it.  Seems like it would be useful for implementors, but not useful for users of a client library.",144386462,2014-08-08 19:00:42
3996364,1517252,16007814,42,"Yes, when testing with SMTP server stub and looking at its logs, I found out that this request is not actually sent from dispatcher, so I sought the way to enforce service(Request.Quit) before service.close(deadline).",144386462,2014-08-08 23:16:02
3996364,1517252,16008663,59,"The definition of `From` field is this:
   from            =   ""From:"" mailbox-list CRLF
I understand it so that the name of this field should start with a capital letter.",144386462,2014-08-08 23:29:16
3996364,1517252,16008805,9,"OK, after some thought, I agree that it can be in dispatcher.",144386462,2014-08-08 23:32:09
3996364,1517252,16008858,25,"Yes, I must have missed that one, thanks.",144386462,2014-08-08 23:33:09
3996364,132262,16015722,41,"I don't think `service(Request.Quit) before service.close(deadline)` will work, because we want to close even if we can't Quit properly, but maybe `ensure` would be the right semantic.  Can you use wireshark and check that the tcp connection is actually b",147619652,2014-08-09 01:51:09
3996364,132262,16015862,59,"NB:
   This specification uses the Augmented Backus-Naur Form (ABNF)
   [RFC5234] notation for the formal definitions of the syntax of
   messages.  Characters will be specified either by a decimal value
   (e.g., the value %d65 for uppercase A and %d97 f",144386462,2014-08-09 01:53:37
3996364,1517252,16049046,59,"OK, I believe you're right. I will transform all the headers to lowercase, then.",144386462,2014-08-11 17:07:32
3996364,1517252,16049465,45,Done.,142678861,2014-08-11 17:19:16
3996364,1517252,16055714,41,"According to wireshark:
1. QUIT is sent
2. Server responds
3. Server closes connection
4. Client closes connection

Seems like what should be expected.",147619652,2014-08-11 19:28:02
3996364,132262,16056109,59,"don't transform them to lowercase, just make sure they can handle headers case-insensitively :+1: ",144386462,2014-08-11 19:35:30
3996364,132262,16056250,8,"thinking about java compatibility, default arguments make this really hard to use from java.  I think it's fine to keep these, but could you make a couple other nice builder methods that can be used from java?  Maybe something that doesn't take any argume",147619652,2014-08-11 19:38:00
3996364,132262,16056346,27,where does this trailing underscore syntax come from?  is this an smtp thing?,147619652,2014-08-11 19:39:58
3996364,132262,16056439,8,"I'm not sure EmailBuilder is the right name for this anymore, since we never call build on it.  How about `DefaultEmail`?",147619652,2014-08-11 19:41:22
3996364,132262,16056704,41,"Wait, I thought you were saying that it wasn't behaving properly in the dispatcher?  I think I got confused as to what was going on . . . I was trying to reply to a message you posted that said, 

>Yes, when testing with SMTP server stub and looking at ",147619652,2014-08-11 19:44:59
3996364,1517252,16060097,27,"It is just to not confuse with methods from EmailMessage, but to allow composing email fields naturally, like `to_(addr1, addr2)`. 
As for varargs - I supposed that methods like setFrom should be used more like a way to prepend or remove addresses, so it",147619652,2014-08-11 20:33:14
3996364,1517252,16061476,27,"I found out that I also forgot to change `Example` this way, I'll fix that.",147619652,2014-08-11 20:54:20
3996364,1517252,16064806,41,"Oh, sorry, I thought you were asking to check the behavior it has right
now, not with sending QUIT in the dispatcher. I'll check the latter, but I
can say that the server doesn't receive the request in that case, because
in its logs the connection is t",147619652,2014-08-11 21:49:38
3996364,132262,16065017,87,"another way of doing this would be to use an extractor, then you can keep the more natural case style.  just a style choice though, it's up to you.",148376051,2014-08-11 21:52:58
3996364,132262,16065126,35,"thinking about this more, I think this is incorrect.  we don't want to close the connection when we close this service, we just want to relinquish the connection so that it can be used elsewhere.  this should definitely be moved into the dispatcher.",148376051,2014-08-11 21:54:46
3996364,132262,16065248,41,"right--if you do `service(Quit) ensure service.close(deadline)` I think that will have the correct behavior, since it will wait for a response before tearing down the connection.  the two tcp connections will race to tear down, but I think that's OK.",147619652,2014-08-11 21:57:09
3996364,1517252,16134130,35,"Ok, I've tried to use wireshark with QUIT sent in dispatcher, and it shows that the request is indeed not sent. The connection is just closed without even attempting to send it. Maybe I'm just doing it wrong? It appeared to me that I should override `clos",148376051,2014-08-12 23:51:51
3996364,132262,16138860,35,Have you tried what I suggested about `service(Quit) ensure { service.close }`?  Did that have the same behavior?,148376051,2014-08-13 01:08:44
3996364,1517252,16144776,35,"It's what I've recently pushed (look below), and it has correct behavior.",148376051,2014-08-13 02:40:07
3996364,1517252,16144865,35,And in dispatcher the behavior is still incorrect when using `ensure`.,148376051,2014-08-13 02:41:33
3996364,1517252,16145170,47,"Here is what you suggested, I believe. Correct me if I misunderstood, I may have lost track of thought here.",148376051,2014-08-13 02:46:12
3996364,132262,16146767,47,"Sorry, I'm having trouble reasoning about the dispatcher code without seeing it.  Could you link me to a branch which has the quit in the dispatcher?",148376051,2014-08-13 03:20:05
3996364,1517252,16171584,47,"Ok, I've created a new branch. Here are [the changes](https://github.com/suncelesta/finagle/commit/6a7c6afeb4b66081f510b7d14a922bc35d90d6eb) for you to review.",148376051,2014-08-13 17:12:59
4048712,423711,14478468,35,"Do we want the triple equals for asserts?
```scala
assert(cookie.value === ""value"")
```
It gives a more informative error message.  Also, the more you have, the better your equality tests will be.*

*That's science.  Or javascript.
",132952759,2014-07-03 00:34:10
4048712,132262,14478672,35,"Good catch!  Yes, that would be better.",132952759,2014-07-03 00:37:35
4048712,15494,14487468,35,Updated the PR.,132952759,2014-07-03 03:18:36
4068206,61365,15614234,20,Rm the ** while we're in here.,136942654,2014-07-31 02:39:54
4068206,61365,15614243,51,ditto,136942654,2014-07-31 02:40:04
4068206,61365,15614338,18,"Empty newline before this line, please.",136942654,2014-07-31 02:41:38
4068206,61365,15614372,22,Rm this extra line.,136942654,2014-07-31 02:42:20
4068206,61365,15614561,12,Only two spaces of indentation within this class.,136942654,2014-07-31 02:45:37
4068206,61365,15614592,48,space after the `if`,136942654,2014-07-31 02:46:07
4068206,61365,15614687,5,Why skip these tests?,136942654,2014-07-31 02:47:37
4068206,45856,15738589,5,"These are skipped because they break.  I am unclear whether they should be deleted or left to pass later (with future dtab work).  

Please advise.  Failures output here: https://gist.github.com/bajohns/7f9c4db337164e6a0faf",136942654,2014-08-04 07:08:39
4068206,132262,16030538,18,"I don't love the style of OneInstancePerTest, it's not particularly idiomatic scalatest.  Generally we just make a context class and import its contents in each test.  By sticking to one style, it's easier for us to reason about different tests, and by ha",145024160,2014-08-10 15:14:34
4068206,132262,16030564,12,probably don't want to share this between tests,145024160,2014-08-10 15:20:55
4068206,132262,16030567,38,maybe make a context class?,145024160,2014-08-10 15:21:10
4068206,132262,16030568,60,fix indentation,145024160,2014-08-10 15:21:21
4068206,132262,16030574,8,"I don't like this style, but probably not worth changing, since you don't need to change it for any other reason.",145024160,2014-08-10 15:23:05
4068206,132262,16030578,20,you could move these into a context class.,145024160,2014-08-10 15:23:33
4068206,132262,16030585,13,let's not share these between tests.,145024160,2014-08-10 15:26:18
4068206,132262,16030586,15,I don't think this is threadsafe?  let's not share it between tests.,145024160,2014-08-10 15:26:48
4068206,132262,16030597,5,"Weird, it works for me.  Does it work for you from master?  Which sbt are you using, the provided one?  How are you running the test?",136942654,2014-08-10 15:30:32
4068206,132262,16030599,20,"oooh, I see now, they were implicitly skipped before because of this.  OK, carry on :+1:",145024160,2014-08-10 15:32:04
4068206,132262,16030603,48,"instead of do it or not do it, can we do `test` vs. `ignore`, so that it appears in the log output and we're at least reminded that there's all of this stuff we've disabled?",145024160,2014-08-10 15:33:50
4068206,132262,16030605,15,context class?,145024160,2014-08-10 15:34:08
4068206,45856,16316077,48,Let me see if I can make a function that combines test/ignore and observes SKIP_FLAKY.  This should be possible,145024160,2014-08-16 02:20:24
4068206,61365,17075517,20,"This indentation's a bit weird. Let's use:

    case class MyStreamResponse(
      httpResponse: HttpResponse,
      messages: Offer[ChannelBuffer],
      error: Offer[Throwable]
    ) extends StreamResponse {",156758856,2014-09-04 00:57:44
4068206,61365,17075541,30,"Class header on one line, since it's less than 100 chars.",156758856,2014-09-04 00:58:06
4068206,61365,17075557,45,Same class header style as above.,156758856,2014-09-04 00:58:24
4068206,61365,17075676,47,"Space between ) and {, here and below",156758856,2014-09-04 01:00:33
4068206,61365,17075743,13,Same class header style as above.,156758856,2014-09-04 01:01:39
4068206,61365,17075779,16,"    def thriftToBuffer(
      method: String,
      `type`: Byte,
      seqid: Int,
      message: { def write(p: TProtocol) }
    ): ChannelBuffer = {",156758856,2014-09-04 01:02:26
4132671,132262,14817519,4,Could you use the ssl-enabled version url to your website?,136412931,2014-07-11 17:13:08
4132671,373787,14832896,4,"yup, added",136412931,2014-07-11 22:28:18
4133529,132262,14826313,26,"instead of calling an init method, the style we typically use is to either make a Context class that we construct and import members from, or make a wrapper method that can do the construction for us.  this means that we don't have to worry about sharing ",136441740,2014-07-11 20:21:35
4133529,15494,14826681,26,"Alright, I'll switch it over to that style.",136441740,2014-07-11 20:27:17
4133529,199939,15260975,27,"There's no need for a Context class, you should just run the code inside `Context` before executing the test.
(I think this is the cause of the test failure on TravisCI)",136495306,2014-07-23 03:39:58
4133529,199939,15260992,66,You can remove that.,136495306,2014-07-23 03:40:19
4133529,199939,15261005,152,ditto.,136495306,2014-07-23 03:40:29
4133529,132262,15270985,27,"Haha, I literally told him the opposite.  I like having a Context class because it makes it clear that you're not sharing any mutable state.  Why do you think it would cause a test failure?",136495306,2014-07-23 09:48:50
4133529,199939,15271285,27,"The `CertChainOutput` that you create at line 56 will fail because you never create this context (never execute the constructor to be precise).
In general, I agree with you, but here you don't share anything with the instance of `Context`, you're just co",136495306,2014-07-23 10:06:58
4133529,15494,15404945,27,"Just to make sure I'm reading this right you're saying to just run the code in Context, rather then newing up the class? Shouldn't the block in the class be ran upon instantiation?",136495306,2014-07-25 20:00:48
4133529,199939,15411692,27,"You read me correctly.
The block in the class should be ran before initializing `CertChainOutput`.",136495306,2014-07-25 21:58:30
4141168,132262,14858309,4,could you change this file back to the way it was before?  I'm not sure why you changed it.,136814767,2014-07-13 17:46:55
4141168,132262,14858313,31,Do these all need to be combined into the same suite?  Maybe it would make sense to just split them up.,136814767,2014-07-13 17:51:13
4141168,132262,14858315,274,"Since you broke up this test into different little parts, let's separate each class into its own file.",136814767,2014-07-13 17:51:53
4141168,132262,14858320,4,remove this,136814767,2014-07-13 17:54:08
4141168,132262,14858326,27,separate files,136814767,2014-07-13 17:56:33
4141168,132262,14858327,20,maybe remove the suite?,136814767,2014-07-13 17:56:48
4141168,132262,14858331,14,"the preferred style is to wrap these up in a Context object, and import the context into the test.

a la

```scala
class Ctx {
  val valu1 = mock[Value]
  ...
}

val ctx = new Ctx
import ctx._
...
```

This makes it easier to reason about t",136814767,2014-07-13 17:58:35
4141168,132262,14858338,10,"instead of BeforeAndAfter, let's just use the context class style here, since we're not consuming any resources.",136814767,2014-07-13 18:01:41
4141168,132262,14858339,14,this is unused,136814767,2014-07-13 18:01:46
4141168,132262,14858347,14,let's not share this state between tests.  let's use the Context class style.,136814767,2014-07-13 18:04:22
4141168,132262,14858349,17,context class,136814767,2014-07-13 18:04:51
4141168,132262,14858355,27,"looks like you can get table-driven property checks in scalatest too

http://www.scalatest.org/user_guide/table_driven_property_checks",136814767,2014-07-13 18:07:44
4141168,132262,14858356,27,why is this line commented out?,136814767,2014-07-13 18:07:55
4141168,132262,14858359,44,this is missing an assert,136814767,2014-07-13 18:09:19
4141168,42829,14860498,4,"I've just added a new line between the if statement and the test case:

```scala
if (!Option(System.getProperty(""SKIP_FLAKY"")).isDefined) 
  test(""add and remove"") {
```
But I'll change this back. :)
",136814767,2014-07-14 03:05:06
4141168,132262,14860535,4,"Ahh, I see.  It ended up being a lot of whitespace changes, so thanks for changing it back :+1:",136814767,2014-07-14 03:12:47
4141168,42829,14888403,4,"I didn't remove this line, probably a white space change. :smile: ",136814767,2014-07-14 21:46:32
4141168,132262,14892396,4,"Right--I'm pointing out that this whitespace change is trivial and can be reverted, since nothing else has been changed in the file.",136814767,2014-07-14 22:53:48
4141168,42829,14893846,4,You're right. I've just reverted this file back. :innocent: ,136814767,2014-07-14 23:18:01
4141168,132262,14895219,4,"Ahh, I see, my mistake. :+1:",136814767,2014-07-14 23:38:21
4141168,61365,15252090,4,"These sections don't appear to actually be changed, but rather indented two characters. Can you revert them to the proper indentation, please?",137561680,2014-07-23 01:00:46
4141168,61365,15252817,545,Rm these extra empty newlines.,137561680,2014-07-23 01:11:19
4141168,61365,15252983,1,"Let's name this file/test `ClientTest`. As far as I can tell, the ""ClusterClient"" terminology in test case names is arbitrary.",137561680,2014-07-23 01:13:55
4141168,61365,15253010,22,Fix indentation of these Scaladoc lines.,137561680,2014-07-23 01:14:15
4141168,61365,15253127,18,ditto scaladoc indentation,137561680,2014-07-23 01:16:18
4141168,61365,15253137,23,ditto,137561680,2014-07-23 01:16:28
4141168,61365,15253147,19,you get the idea :),137561680,2014-07-23 01:16:37
4141168,61365,15253263,5,"I realize this was in the Specs version, but renamed imports are typically put first before normal by-name ones.

    import com.twitter.finagle.memcached.protocol.{
      Error => MemcacheError, ClientError, NonexistentCommand, ServerError}",137561680,2014-07-23 01:18:21
4141168,42829,15431223,1,Thanks! :+1: ,137561680,2014-07-26 06:28:05
4141168,42829,15431227,19,done! :),137561680,2014-07-26 06:28:52
4389319,583486,16637028,5,"```contentType.split(';', 2)```to handle more than one "";"" in the string.",148363953,2014-08-24 22:50:58
4389319,583486,16637033,6,"Can replace ""charset"" with just ""_"".",148363953,2014-08-24 22:51:29
4494565,132262,16632563,16,let's make sure the test output similarly reminds you to run them manually.,153411010,2014-08-24 01:25:42
4494565,132262,16632566,34,ditto here,153411010,2014-08-24 01:25:52
4494565,132262,16632586,242,"let's keep in the commented out test, but instead of commenting it out, just ignore it.",153411010,2014-08-24 01:28:36
4494565,132262,16632590,11,we never seem to use this.  let's remove it.,153411010,2014-08-24 01:29:40
4494565,3490006,16632604,16,Simply by adding more details to the test name right ?,153411010,2014-08-24 01:34:34
4494565,132262,16632621,16,yep,153411010,2014-08-24 01:36:51
4556344,199939,17343612,51,I would prefer having a standard class with members instead of default constructor arguments.,155729778,2014-09-10 10:34:00
4556344,199939,17343749,13,ditto here,155729778,2014-09-10 10:39:18
4556344,199939,17343788,13,"ditto
",155729778,2014-09-10 10:41:07
5145915,198588,19819031,19,"I think this makes sense, but is a little confusing to me. Is there a larger, more in depth section we can link to, maybe the Metrics?",180987453,2014-11-05 00:24:46
5145915,146404,19843181,19,"Hi @luciferous, yes—I'm talking to @mosesn about some additions to this paragraph, and am hoping to get them written up tomorrow.",180987453,2014-11-05 05:51:46
6114470,132262,23953383,4,can you add a return type here?  public methods should be annotated (it's OK not to fix up the rest of the file).,213378733,2015-02-03 03:01:37
6171462,132262,24249050,36,"these should be `Mapper`, not `Mapeer`",214924373,2015-02-06 22:52:58
6171462,301,24249186,36,"that's right, sorry for that. fix is coming in a sec.",214924373,2015-02-06 22:54:32
6315366,132262,24846059,8,can we add an explicit annotation here?,219016909,2015-02-18 02:36:07
6315366,685224,24856453,8,Done,219016909,2015-02-18 04:36:51
6443683,72999,25448918,5,"I looked at the failed assert:

```java
  assert !inNetBuf.hasRemaining() || engine.isInboundDone();
```

I'm not sure if we run the tests with assertion enabled. So, could you please add the following configuration to the mock engine:

```java
w",223365641,2015-02-27 01:02:46
6443683,193897,25647959,20,I know you didn't add it but the 'case' keyword isn't needed so do you mind cleaning it up while you're here?,223550697,2015-03-03 06:04:14
6443683,193897,25648232,47,"can you please reformat per http://docs.scala-lang.org/style/indentation.html so that the line doesn't exceed ~100 chars?

also, can you use named params to give that boolean literal some context?",223550697,2015-03-03 06:08:38
6443683,193897,25730915,5,"not necessary but if you're feeling ambitious... you could write a test case covering the symptom you describe in https://github.com/twitter/finagle/issues/345, specifically, a hung ssl handshake causing the channel to get stuck in the connecting state an",225357929,2015-03-04 04:55:02
6683900,132262,26573174,17,"instead of making this mutable and adding a method in LoadService to update it, let's just add ignoredPaths directly when we declare ignoredPackages.",231487317,2015-03-17 19:49:28
6683900,132262,26573485,24,"seems like you wanted to expose this for testing, but we could instead make ignoredPackages a method, or else add a private[util] method version of ignoredPackages.",231487317,2015-03-17 19:53:14
6683900,132262,26573023,36,"Instead of a String-flavored Flag, this should be a Seq[String] flavored flag.  That way you don't need to read the code to guess how to parse it.",231487317,2015-03-17 19:47:45
6683900,4994547,26646950,21,This method was done as suggested along with adding of the val for the default ignored packages. We are not sure how much of a performance hit it would be to calculate this as a def on each call but this would definitely ensure no regressions as well as a,232232078,2015-03-18 15:08:31
6683900,132262,26689336,8,please keep imports sorted,232232078,2015-03-18 23:57:53
6683900,132262,26689423,22,the if statement isn't necessary.  we can just add ignoredPaths without checking.,232232078,2015-03-18 23:58:53
6683900,132262,26689449,4,keep imports sorted,232232078,2015-03-18 23:59:11
6683900,132262,26689506,21,"Yeah, my guess is that it's very inexpensive.  If it starts being a bottleneck, we can work on it.",232232078,2015-03-18 23:59:45
6683900,199939,26709118,12,"I would like to see a more advanced test.
e.g. ignore ""com.twitter.finagle.util"" and try to load all the instances of `LoadServiceRandomInterface`, the result Seq should be empty",232232078,2015-03-19 03:22:19
6683900,4994547,26741293,12,"I tried to run a test with the requirements you specified. For some reason, even though the addition of the package ""com.twitter.finagle.util"" to the list of ignoredPackages used in the browseUri it still seemed to pick up the LoadServiceRandomInterfaceIm",232232078,2015-03-19 16:06:08
6683900,132262,26748855,12,Could you paste the test you wrote?,232232078,2015-03-19 18:27:09
6683900,4994547,26824102,12,"test(""LoadService should ignore packages according to ignoredPaths GlobalFlag"") {
  ignoredPaths.let(Seq(""com.twitter.finagle.util"")){
      assert(LoadService[LoadServiceRandomInterface]().isEmpty)
   }
 }

I used a similar LoadService call as done",232232078,2015-03-20 14:16:55
6683900,4994547,26918306,12,"I suspected it could have been something of that sort so i had commented out all previous tests and ran only the one i wrote but with the same results. Regardless, i would need to look into this and see how i can work around it (probably trying to use the",232232078,2015-03-23 13:54:58
6683900,4994547,27025799,12,"Alright, so after further investigation as to why it was not picking up classes as expected based on the ignoredPackages, i tried the new Classloader as Steve suggested but that also yielded the same result.

I, however, did stumble across some interest",232232078,2015-03-24 19:18:46
6683900,132262,35045245,12,You should be able to set it as a java flag (ie -Dcom.myproject.flag=3).,232232078,2015-07-21 02:17:05
6683900,132262,35045327,12,I think it's fine to just add an explanation.,232232078,2015-07-21 02:17:55
6683900,199939,26876181,12,"I think I see why it doesn't work.
We are caching the classes meta-data per classloader, and LoadService has already scanned the classpath in a previous test.
Maybe adding a method to flush the cache (private to the package) or setting a new Classloader",232232078,2015-03-21 03:01:54
6683900,132262,35967709,22,"this is still the case, but I won't block this if you feel really strongly about it.",232232078,2015-07-31 17:07:59
6683900,64314,35988908,25,"do you mind making this flag's name more specific? 

right now its ""com.twitter.finagle.util.ignoredPaths"" which is a bit opaque for my tastes. perhaps ""com.twitter.finagle.util.loadServiceIgnoredPaths"" ?

",293225974,2015-07-31 21:17:28
6898772,64314,27503632,14,should we mention what you need to do in order to build off of util as well?,238634126,2015-03-31 22:45:39
6898772,146404,27510368,14,"I guess we probably should, although once the new round of releases comes out it shouldn't be necessary for a while, and once we've started publishing snapshots it'll be unnecessary for good. I could go either way.",238634126,2015-03-31 23:50:01
6898772,64314,27517656,14,"ok, lets leave it as is.",238634126,2015-04-01 01:07:31
6965852,198588,27812871,11,is this intentional?,240947177,2015-04-06 22:31:37
6965852,198588,27812917,14,ignore?,240947177,2015-04-06 22:32:12
6965852,198588,27813042,47,"scaladoc @throws?

(side: is this how we do things in finagle-redis, otherwise I'd prefer Try/Option)",240947177,2015-04-06 22:33:30
6965852,146404,27813566,11,"Yes, we're not currently running the finagle-redis integration tests in Pants. This `@Ignore` has no effect on the SBT build, but these tests are also excluded by default in `Build.scala`.

It would be nice to have them run as proper integration tests i",240947177,2015-04-06 22:40:12
6965852,146404,27813976,47,"Yes, this is consistent with how other finagle-redis commands work. It'd be nice to clean up the API, but in my view that can wait until we spin this off into its own project in the Finagle org (and we don't have a definite timeline for that).",240947177,2015-04-06 22:45:12
6965852,72999,27814051,3,Does it actually need `_root_` prefix? Seems to me just `java.lang` should work fine.,240947177,2015-04-06 22:46:01
6965852,146404,27814602,3,"Looks unnecessary to me as well, but it's in all the other `*Commands.scala` files, too.

There's a fair amount of noise and historical baggage in finagle-redis, and since it's more or less in maintenance mode until we move it to the Finagle org it's be",240947177,2015-04-06 22:52:40
6965852,72999,27815020,3,"I see. Sorry. Thanks for the explanation Travis! In this case we definitely should ""follow the style"" at least in this PR.",240947177,2015-04-06 22:57:39
6965852,198588,27813058,19,"scaladoc @throws?

(side: is this how we do things in finagle-redis, otherwise I'd prefer Try/Option)",240947177,2015-04-06 22:33:43
7018884,132262,28032196,13,"I don't know ruby, so please be patient with me :)

It looks like this is sticking the stack into a thread-local variable.  Is our guarantee for ruby tracing that you won't ever switch threads?",242285613,2015-04-09 08:02:19
7018884,159090,28374279,13,"@mosesn indeed it is a thread local variable.  I hope I'm understanding your question correctly, I think we are trying to do one trace object per thread.  We were getting race conditions on the stack obj.  I think Ruby does context switching from what I r",242285613,2015-04-15 02:48:23
7018884,132262,28701770,13,"My concern is what happens after a ruby server gets a request.  Is it ever legal to have something like:

t1: receives a request
t1: makes a request to a different server
t1: does some different work
t1: puts some work on a different thread, t2
t2: ",242285613,2015-04-20 20:59:05
7018884,159090,28704693,13,"I see your point, definitely this issue could happen.  A few possible approaches here:
1.  Thread local - the architecture would require requests to be handled in T1 and if it requires additional work, it would pass the Trace data necessary to T2. 
2. G",242285613,2015-04-20 21:31:58
7018884,132262,28708226,13,"We handle it by requiring that you use twitter's util libraries if you switch thread in java, but it won't be so simple in ruby.  I think for now we should just document the behavior, and then we can deal with it later if you actually need it.  Explicitly",242285613,2015-04-20 22:13:07
7018884,132262,28723771,1,"s/finable thrift/finagle

No need to specify thrift

s/saftey/safety",247263944,2015-04-21 01:07:06
7018884,132262,28723820,13,"Instead of one long line, could you truncate at 80 characters?",247263944,2015-04-21 01:07:54
7018884,132262,28723905,4,"I'm not sure this makes sense from a user perspective.  Most folks reading the README probably don't care terribly about the design decision, and probably care more about how to use it.  If you want to document the design decision, probably best to do tha",247263944,2015-04-21 01:09:00
7018884,3414694,32775031,1,"I don't think this belongs in a README. This is already explained in the comment below. Remove this file altogether?

(A README file should give an idea of what this code is doing and how it should be used)",247735492,2015-06-19 01:34:11
7048017,132262,28163721,12,"instead of locally blocks, can we just separate these out into clearly named tests?  that will help us understand what a test failure means if it happens.",243208702,2015-04-10 22:28:24
7048017,132262,28163771,4,please keep imports sorted,243208702,2015-04-10 22:28:52
7048017,146404,28164102,20,"I'm nitpicking here, but maybe we could go with the `A0`, `value0` convention since `_` is already so massively overloaded in Scala? I'm not sure there's precedent for either convention in Finagle right now.",243208702,2015-04-10 22:32:50
7048017,6902,28164359,12,@mosesn Good suggestion. Will do.,243208702,2015-04-10 22:36:07
7048017,132262,28164553,101,"please keep line length < 100.

if you need to do this sanitization for every request, you should disallow creation otherwise.  does this need to be here though?  could we just put it in the constructor of ExecuteRequest?",243208702,2015-04-10 22:38:13
7048017,132262,28164611,9,imo let's keep this a case class.  why does it need to change?,243208702,2015-04-10 22:38:51
7048017,132262,28164670,31,prefer ps.foreach,243208702,2015-04-10 22:39:36
7048017,6902,28164749,20,"@travisbrown I am not sure there is a precedent for either convention in Scala, since it's not a very widely used pattern. But I agree that `A0` might be a better convention that `_A`. Will change.",243208702,2015-04-10 22:40:44
7048017,132262,28164870,59,"feel free to ignore: maybe simpler as

```scala
parameters.map(_.size).sum
```

",243208702,2015-04-10 22:42:10
7048017,6902,28165325,101,"Okay re: line length. 

Putting it in the constructor will be messy because of how Scala does constructors. Every parameter to class is accessible in its entire body, and also it's immutable. We will have something like:

```scala
class ExecuteReques",243208702,2015-04-10 22:47:30
7048017,132262,28165441,16,"how about we make this return `BufferWriter`, like the `writeX` methods in BufferWriter?",243208702,2015-04-10 22:48:55
7048017,132262,28165466,14,this doesn't seem to need to take an argument.,243208702,2015-04-10 22:49:12
7048017,6902,28165535,9,"@mosesn Because of the sanitization that's needed beforehand. With a regular class, I could mark the constructor private. With a case class, I still could do that, but the `apply` auto-generated in the companion object will be publicly available, and it c",243208702,2015-04-10 22:50:00
7048017,6902,28165550,31,Okay.,243208702,2015-04-10 22:50:07
7048017,6902,28165573,59,Yes. Also just a tiny bit more expensive. :),243208702,2015-04-10 22:50:27
7048017,132262,28165690,24,"prefer bytes.length, doesn't create an extra allocation",243208702,2015-04-10 22:51:32
7048017,6902,28165757,16,"@mosesn That seems to give a wrong impression that this is a pure function, which it is not. It's executed purely for its side-effects. And if it's just going to return the same writer at the end, the return doesn't mean much. If a function is side-effect",243208702,2015-04-10 22:52:21
7048017,6902,28165812,14,"It does, for byte arrays and `Value`.",243208702,2015-04-10 22:52:58
7048017,72999,28165810,9,"Why do we need this `evidence` here? Can we propagate it via closure? Something like this:

```scala
trait Parameter {
  type A
  def value: A
  def writeTo(writer: BufferWritter): Unit
}

object Parameter {
  implicit def wrap[_A](_value: _A)(i",243208702,2015-04-10 22:52:57
7048017,6902,28165917,24,"@mosesn Good point. I changed it in many places, but missed this one. (In current Finagle MySQL, `Array#size` is more prevalent than `Array#length`.",243208702,2015-04-10 22:54:11
7048017,6902,28166084,9,"@vkostyukov The members of `Parameter` will increase with the number of methods in `CanBeParameter`, and all of them will be pure delegators. What's the value?",243208702,2015-04-10 22:55:50
7048017,6902,28165931,20,@mosesn Okay.,243208702,2015-04-10 22:54:18
7048017,132262,28166142,14,"oh, I see, you need it for disambiguating between TinyBlob, etc.  Is that correct behavior?  Will mysql be OK if you pass it mismatched kinds of blobs?",243208702,2015-04-10 22:56:25
7048017,132262,28166201,105,prefer bytes.length,243208702,2015-04-10 22:57:06
7048017,132262,28166283,113,why provide a fallback case here but not in typeCode?,243208702,2015-04-10 22:57:58
7048017,132262,28166334,140,"is silence the correct behavior here?

what about nulls?",243208702,2015-04-10 22:58:35
7048017,132262,28166427,5,why do you want this variance annotation?,243208702,2015-04-10 22:59:38
7048017,132262,28166662,5,prefer factory().flatMap,243208702,2015-04-10 23:02:19
7048017,132262,28166745,7,can we make this a generic instead?,243208702,2015-04-10 23:03:21
7048017,132262,28166761,11,can we return a BufferWriter instead?,243208702,2015-04-10 23:03:41
7048017,6902,28166774,105,@mosesn Okay.,243208702,2015-04-10 23:03:48
7048017,132262,28166843,20,"instead of the _ prefixed things, can we rename the variables?",243208702,2015-04-10 23:04:36
7048017,6902,28166860,113,@mosesn `Value` is a sealed trait and `typeCode` covers all of the cases explicitly. There is no case that's left out. In case of `sizeOf` I am just keeping the existing behavior as-is. ,243208702,2015-04-10 23:04:47
7048017,6902,28166878,5,@mosesn It's been that way since before.,243208702,2015-04-10 23:05:04
7048017,6902,28167011,140,"@mosesn I have tried to mirror the existing behavior as faithfully as possible. I think other values are skipped in current implementation too. As for `null`s, we are not handling them here. Should they be handled here? Handling `null`s everywhere on a ca",243208702,2015-04-10 23:06:45
7048017,6902,28167244,5,"@mosesn If I have a custom data type `X` such that `X <: Y`, and there's evidence `CanBeParameter[Y]` available, I would want to be able to pass `X`. The fact that it typechecks means such a usage is valid. Why not have the flexibility?",243208702,2015-04-10 23:09:33
7048017,6902,28167294,7,@mosesn It wouldn't make sense. It's supposed to be used as an existential type.,243208702,2015-04-10 23:10:13
7048017,6902,28167328,11,@mosesn Please refer to my reply to a similar comment before.,243208702,2015-04-10 23:10:31
7048017,72999,28167560,9,"My opinion is that we probably want to keep the API surface as small as possible. And also, once you have an instance of `Parameter` you don't need an evidence that it can be parameter, since it's already it :)

As far as I know it's a common practice d",243208702,2015-04-10 23:13:22
7048017,6902,28164698,4,"@mosesn Tried removing that line and re-auto-importing. For some reason, IDEA keeps putting it on the same line! Will move it manually and push.",243208702,2015-04-10 22:40:03
7048017,132262,28165777,20,please add type annotations to public methods (here and elsewhere),243208702,2015-04-10 22:52:33
7048017,132262,28167911,5,"right, the style has changed.  since you're changing the line, could you please fix it?  we're changing the style lazily, so we ask that folks fix style as they change code.",243208702,2015-04-10 23:17:09
7048017,132262,28168050,5,"Almost all of the parameter types are very specific types that can't be subclasses, like Int.  What is it useful for?",243208702,2015-04-10 23:18:46
7048017,132262,28168119,140,"I meant NullParameters, but yes, you're right that it looks like this is how they're done elsewhere too.  Strange!",243208702,2015-04-10 23:19:37
7048017,132262,28168154,113,prefer consistency over existing behavior imo,243208702,2015-04-10 23:20:03
7048017,132262,28168450,16,"I think consistency is better here.  If we're going to change the `write*` style methods, let's do them all at once.  Having some of them which follow one convention, and others that follow another is a bummer.  Also, this matches the way that the `java.n",243208702,2015-04-10 23:23:24
7048017,132262,28168539,9,maybe just keep a `private[this] val sanitized = ....` on the case class?,243208702,2015-04-10 23:24:35
7048017,132262,28168572,101,"yes, this is cleaner imo.",243208702,2015-04-10 23:24:56
7048017,83701,28168893,5,"I'm not sure we should have the variance either. Even if we have a X <: Y relationship, we should still be forced to think about how that serializes into a Parameter (e.g. sizeOf, typeCode, etc. are likely to be different).",243208702,2015-04-10 23:29:22
7048017,6902,28184523,9,@mosesn That will expose unsanitized params in the (auto-generated) `unapply`.,243208702,2015-04-11 03:13:35
7048017,6902,28185081,16,"Okay, agreed. I will change this.",243208702,2015-04-11 03:24:24
7048017,6902,28185199,14,"@mosesn Sorry, I am out of my depth here. I have tried to retain the existing behavior here as well.",243208702,2015-04-11 03:26:20
7048017,6902,28185502,113,Okay.,243208702,2015-04-11 03:31:33
7048017,6902,28185550,140,"Okay. I will try making it more explicit at the least, what cases specifically are skipped. :)",243208702,2015-04-11 03:32:42
7048017,6902,28185599,5,@mosesn I was thinking this could be useful for custom data types. But @roanta here has raised some very valid points. I will make the type-class invariant.,243208702,2015-04-11 03:33:25
7048017,6902,28185618,5,Okay. :),243208702,2015-04-11 03:33:59
7048017,83701,28205646,14,"It probably wasn't the best idea to derive the blob type from the size of the array, but we should revisit this separately. I think retaining current behavior is a good idea!

@mosesn The blobs are length encoded, but they still need to match your schem",243208702,2015-04-12 22:50:56
7048017,83701,28205675,5,"Some scaladoc that briefly explains what Parameter is would be nice. Note, that all usage of Parameter should be via CanBeParameter.",243338658,2015-04-12 22:53:39
7048017,83701,28205692,6,Would it make sense to seal this? Or is it not possible because we instantiate it anonymously in wrap?,243338658,2015-04-12 22:55:25
7048017,83701,28205699,8,"style nit: our scaladoc blocks are closed with */ instead of **/
 ",243338658,2015-04-12 22:57:05
7048017,83701,28205715,105,"style nit, drop params to new line:

    def apply(
       stmtId: Int,
       ...
    ): ExecuteRequest = ...",243338658,2015-04-12 22:59:55
7048017,6902,28207830,6,"@roanta I usually only use `sealed` when declaring ADTs/GADTs, but using it to prevent extension of `Parameter` from outside this unit seems like a great idea. 

Anonymous instantiation is okay as long as it's in the same unit.",243338658,2015-04-13 02:42:51
7048017,198588,28378916,24,Any way to make this `implicit class` and drop the implicitConversion import?,243962834,2015-04-15 03:48:27
7048017,6902,28459466,24,"There are two things here that make that not possible: A conditional inside the `wrap`, and a type member. `implicit class`es can be substituted for implicit conversions in most cases, but this isn't one of them.",243962834,2015-04-16 01:29:54
7048017,198588,28461195,24,"What I mean is:

```scala
implicit class Wrap[A0](val value0: A0) extends AnyVal {
  def asParam(implicit evidence0: CanBeParameter[A0]): Parameter =
    if (value0 == null) {
      NullParameter
    } else {
      new Parameter {
        type A ",243962834,2015-04-16 01:47:51
7048017,6902,28461765,24,"I see. With this, though, the client is burdened with code like following:

```scala
client.prepare(""..."").apply(3.asParam, ""jd"".asParam)
```

I think it adds no value and hampers readability.",243962834,2015-04-16 01:53:37
7048017,6902,28466437,24,Thanks @luciferous.,243962834,2015-04-16 02:47:16
7048017,198588,28467875,24,@missingfaktor Thank _you_. This is good work.,243962834,2015-04-16 03:05:28
7111834,64314,28706380,14,same.,246995844,2015-04-20 21:51:52
7111834,1271679,28749329,14,@kevinoliver can you explain more? how to change?,246995844,2015-04-21 09:29:19
7111834,64314,28797530,14,"apologies. didn't realize the Source api doesn't expose that.

i'll try to get this merged in soon.",246995844,2015-04-21 21:45:24
7133206,83701,28528430,15,"As @mosesn mentioned, we recently added this internally and it's available as part of the develop branch.

Note though, this may have surprising results. Because of how the mysql client operates on the this `ServiceFactory` you aren't guaranteed exclusi",245649622,2015-04-16 21:59:44
7414978,132262,29721406,6,do we ever define what residual means?,253765247,2015-05-06 03:47:07
7414978,193897,29724795,9,*during,253765247,2015-05-06 04:42:06
7414978,132262,29725431,6,"er, to be more precise, I don't know what a residual path is.  Can we add a description of what a residual path is, and what it might be used for?",253765247,2015-05-06 04:53:07
7414978,200065,29725911,6,"I was hoping *bound* and *unbound* were the operative words and residual was simply an adjective.  Basically, given a path like `/s/buoyant/proxy/s/svc/app/path/to/resource`, a Namer may only bind a prefix like `/s/buoyant/proxy` and leave the residual pa",253765247,2015-05-06 05:02:30
7414978,193897,33210754,5,s/are^2/are/,273775435,2015-06-25 04:49:26
7526383,132262,30470487,8,"I'm a little dubious that this makes it easier to read.  Maybe just keep it ""SCRIPT EXISTS"", here and below.",258018130,2015-05-17 18:43:48
7526383,132262,30470492,32,maybe add SCRIPTLOAD etc here too?,258018130,2015-05-17 18:44:26
7526383,132262,30470497,5,ditto,258018130,2015-05-17 18:44:47
7526383,132262,30470498,16,ditto,258018130,2015-05-17 18:44:52
7526383,132262,30470499,27,ditto,258018130,2015-05-17 18:45:01
7526383,132262,30470500,38,ditto,258018130,2015-05-17 18:45:08
7526383,132262,30470502,40,"since we need to do this so many places, is there a way to help get it done generically?",258018130,2015-05-17 18:45:39
7526383,132262,30470496,5,"rm NOTE
rm by timxzl",258018130,2015-05-17 18:44:42
7526383,132262,30470504,4,sort imports,258018130,2015-05-17 18:45:53
7526383,132262,30470506,13,"rm NOTE
rm by timzxl",258018130,2015-05-17 18:46:13
7526383,132262,30470510,4,"rm NOTE
rm by timxzl

maybe just have an `@param` which explains what f does",258018130,2015-05-17 18:46:54
7526383,132262,30470515,27,"rm NOTE
rm by timxzl",258018130,2015-05-17 18:47:38
7526383,132262,30470520,43,ditto,258018130,2015-05-17 18:47:59
7526383,132262,30470538,8,"feel free to ignore: I think this would be cleaner to return a Closable instead of () => Unit, which more explicitly points out that there's a resource that needs closing, rather than that some mutation needs to be done, which is more generic.",258018130,2015-05-17 18:49:39
7526383,132262,30470579,9,"feel free to ignore: I think these functions read better as just unit, long, bool, etc.  unit.orElse(long) seems just as clear as handleUnit.orElse(handleLong) but less verbose.",258018130,2015-05-17 18:54:48
7526383,132262,30470588,34,rm NOTE,258018130,2015-05-17 18:55:54
7526383,132262,30470601,34,"Do you mean ""call-by-name""?

I'm not sure that I follow your reasoning, especially since I think call-by-name is implemented the same way under the hood as what we're doing now.",258018130,2015-05-17 18:57:32
7526383,132262,30470608,41,s/explicity/explicit,258018130,2015-05-17 18:57:59
7526383,132262,30470609,37,rm NOTE,258018130,2015-05-17 18:58:07
7526383,132262,30470615,33,when would this happen?,258018130,2015-05-17 18:58:54
7526383,132262,30470621,13,can we make everything the end-user doesn't need to use directly `private[this]`?,258018130,2015-05-17 18:59:40
7526383,132262,30470625,46,rm NOTE,258018130,2015-05-17 19:00:35
7526383,132262,30470673,46,"I'm not sure that I love this API.  Maybe it would be better to expose a Reply, and then provide typeclasses to make casting easy?  I think

```scala
client.eval(script, keys, argv).map(_.cast[Unit])
```

makes it more clear that we're not type-chec",258018130,2015-05-17 19:06:47
7526383,132262,30470692,64,either inline this or rm the comment.  no reason to duplicate the logic.,258018130,2015-05-17 19:09:33
7526383,132262,30470698,55,"rm NOTE
if you expect end-users to want to know this, make this scaladoc.  not everyone reads the code, but most folks read scaladoc.",258018130,2015-05-17 19:10:27
7526383,132262,30470706,27,put this on the previous line,258018130,2015-05-17 19:11:55
7526383,132262,30470708,30,"might as well duplicate this comment for flush, load, etc.",258018130,2015-05-17 19:12:38
7526383,132262,30470711,44,why is only this one a ScriptCommand?  should the others ones be too?,258018130,2015-05-17 19:13:15
7526383,132262,30470713,3,sort lines,258018130,2015-05-17 19:13:28
7526383,132262,30470716,8,"don't import Await.result directly, just import Await.",258018130,2015-05-17 19:14:18
7526383,132262,30470719,17,"please don't use MustMatchers unless you get something really cool out of it, in scalatest 2.x the assert macro means we can get really good error messages easily out of assert.",258018130,2015-05-17 19:15:00
7526383,132262,30470724,63,`handleUnit.orElse(retryOnNoScript....)`,258018130,2015-05-17 19:15:43
7526383,132262,30470728,35,buffers.map(bufferToString),258018130,2015-05-17 19:15:58
7526383,132262,30470731,23,`s.map(stringToBuffer)`,258018130,2015-05-17 19:16:15
7526383,132262,30470732,22,no need for braces for a single expression,258018130,2015-05-17 19:16:24
7526383,132262,30470734,27,pairs.map(...),258018130,2015-05-17 19:16:49
7526383,132262,30470735,38,rm,258018130,2015-05-17 19:16:54
7526383,132262,30470741,108,"indentation, here and below",258018130,2015-05-17 19:17:39
7526383,132262,30470742,111,scripts.map(SHA1hex),258018130,2015-05-17 19:17:48
7526383,132262,30470746,114,`assert(!result(client.scriptExists(sha1s: _*)).reduce(_ || _))`,258018130,2015-05-17 19:18:24
7526383,132262,30470749,118,assert,258018130,2015-05-17 19:18:34
7526383,132262,30470751,143,assert(x == y),258018130,2015-05-17 19:19:06
7526383,132262,30470753,175,indent,258018130,2015-05-17 19:19:22
7526383,132262,30470755,215,indentation,258018130,2015-05-17 19:19:39
7526383,132262,30470757,245,assert,258018130,2015-05-17 19:20:10
7526383,132262,30470759,259,indent,258018130,2015-05-17 19:20:22
7526383,132262,30470760,269,assert,258018130,2015-05-17 19:20:28
7526383,132262,30470764,333,indent,258018130,2015-05-17 19:20:49
7526383,132262,30470766,6,revert please,258018130,2015-05-17 19:21:09
7526383,132262,30470768,5,merge into develop,258018130,2015-05-17 19:21:25
7526383,132262,30470773,80,s/ )/),258018130,2015-05-17 19:21:44
7526383,132262,30470780,61,s/ )/),258018130,2015-05-17 19:22:21
7526383,132262,30470783,94,s/ )/),258018130,2015-05-17 19:22:47
7526383,132262,30470784,108,s/ )/),258018130,2015-05-17 19:22:57
7526383,132262,30470788,123,s/ )/),258018130,2015-05-17 19:23:14
7526383,1651547,30470945,46,"I agree with this approach, and I think that would be clearer. The only concern is that this will expose an internal detail (Reply) to the user, which is not done by any other finagle-redis API before. Do you think that is OK?",258018130,2015-05-17 19:44:33
7526383,132262,30470974,46,"Hmm, that's a good point. I feel like it's OK to start exposing Reply here, especially if we comment clearly how we expect folks to use it.",258018130,2015-05-17 19:49:24
7526383,1651547,30758831,34,retryOnNoScript is no longer needed in the re-designed API.,258018130,2015-05-21 04:04:15
7526383,1651547,30758956,44,"ScriptCommand is a command that takes a script as a parameter, such as EVAL and SCRIPT LOAD. ScriptDigestCommand is a command that takes a digest of a script as a parameter, such as EVALSHA and SCRIPT EXISTS. The SCRIPT FLUSH does not take any parameter a",258018130,2015-05-21 04:06:06
8264991,132262,33810434,5,"this line is very long, can we chop it up?",278618634,2015-07-02 23:52:25
8264991,132262,33810830,5,let's explicitly return `): Unit = {`,278618634,2015-07-02 23:56:15
8264991,132262,33811150,11,"instead of turning these into strings, why not just keep them `File`s?  Java supports rich equality / hashCode for them, so they also allow things like checking if two pathnames are the same on case-insensitive filesystems.",278618634,2015-07-02 23:59:41
8264991,972039,33838768,11,The concerning here is about symbolic link.,278618634,2015-07-03 08:27:25
8264991,132262,33846302,11,Could you elaborate?,278618634,2015-07-03 13:04:31
8264991,972039,33888693,11,"Assume we have a test.jar, which references dot/test.jar by the Class-Path manifest attribute, where dot is a symbolic link to the current directory. In this case, test.jar will be processed repeatedly, because test.jar is not equal to dot/test.jar as Fil",278618634,2015-07-04 22:02:06
8304718,193897,41306791,13,sort please,279017179,2015-10-06 23:57:37
8304718,193897,41306835,43,: Unit =,279017179,2015-10-06 23:57:59
8304718,193897,41307144,61,"can you break this method up w/ one param per line as in:

def lotsOfArgs(
  number: Option[String],
  typeOfPhone: String
  hoursOfAvailability: Range = 9.to(12)
)",279017179,2015-10-07 00:00:18
8304718,193897,41307277,66,we can just pass the block to foreach without the parens,279017179,2015-10-07 00:01:01
8304718,193897,41307329,71,no parens for map,279017179,2015-10-07 00:01:17
8410936,132262,34953044,4,what do the variance annotations buy us here?,279932884,2015-07-19 05:08:59
8410936,200065,34953054,4,nothing.  copy-pasta. will remove.,279932884,2015-07-19 05:10:03
8410936,132262,34953055,8,"since these generics are erased, this is implicitly a cast.  could we instead make it:

```scala
  case ServiceFactorySocketAddress(sf: ServiceFactory[_, _]) => sf.asInstanceOf[ServiceFactory[Req, Rep]]
```

so that the cast becomes explicit?",279932884,2015-07-19 05:10:38
8410936,132262,34953064,12,"can we either verify that the transporter isn't called, or change the name of this test?",279932884,2015-07-19 05:13:21
8554360,685224,35171176,5,"I think calling tokens.tail on an empty seq throws an UnsupportedOperationException(""empty.tail"")",283363386,2015-07-22 05:39:25
8554360,72999,35171204,5,Right. Just use [`drop(1)`](https://github.com/puffnfresh/wartremover#listops) then.,283363386,2015-07-22 05:39:58
8554360,685224,35171528,5,Done,283363386,2015-07-22 05:47:29
8554360,72999,35171106,5,"And why the empty `tokens` considered as a special case? `Nil.mkString("" "")` will produce a """" string as expected.",283363386,2015-07-22 05:38:09
8554360,72999,35171030,5,"I believe the style is `tokens.tail.map {}.mkString("" "") `.",283363386,2015-07-22 05:36:19
8554360,193897,35354341,21,no postfix ops please,283570256,2015-07-23 23:25:13
8554360,132262,35355873,23,"no need for triple equals, == is fine.  scalatest 2.x has an assert macro that's the :bomb: ",283570256,2015-07-23 23:38:41
8571660,72999,35441033,2,Perhaps renaming this `module` to `clientModule` to make things symmetric? Should be safe to do since it's package-private for `[finagle]`.,283722937,2015-07-24 21:49:05
8571660,892906,35445892,18,"Why not annotate on failures (with a new `WireSendError(error: String)`) here and reuse `AnnotatingTracingFilter`?

Otherwise LGTM.",283722937,2015-07-24 22:34:49
8571660,200065,35470517,18,"There is no such `Annotation` type as `WireSendError`, and I was trying to minimize the scope of this change--it would cause changes on the zipkin thrift struct, etc.  Furthermore, this wouldn't really be a ""wire send error""--exceptions here would typical",283722937,2015-07-25 03:08:10
8571660,64314,36764126,50,"`.onSuccess` 

can you lift this function into a member to avoid an allocation on every `filter.apply`?",283722922,2015-08-11 21:14:41
8571660,193897,41653789,52,This filter still allocates on each request. Can you pull the onSuccess closure into a val outside the apply?,328183196,2015-10-09 22:08:36
8571660,193897,42199569,52,so unfortunately this doesn't do the trick because the method will be eta-expanded into a function value on each request and that costs an allocation. anything but a function value burns us. I'll fix it up locally if that's cool with you.,331074231,2015-10-16 05:53:43
8590971,132262,35657230,4,"git doesn't require that the cloned directory be named finagle, maybe we should say the root directory of the finagle repository?",284021033,2015-07-28 19:58:47
8590971,149050,37372560,4,"Also there is a typo in `finangle`, it should be `finagle`.",284021033,2015-08-19 06:32:57
9081337,132262,38157960,4,"for consistency, could you change this to http://www.despegar.com/?",306678268,2015-08-28 04:23:47
9081337,132262,38158006,4,"also, could you put this line about the DICE line so we can stay in alphabetic order?",306678268,2015-08-28 04:24:16
9105955,132262,38496875,4,could you make this https and add a trailing slash?,306920499,2015-09-02 08:49:53
9287471,193897,39887196,4,pretty sure it's spelled Buoyánt,308919982,2015-09-18 23:40:03
9287471,12202,39891112,4,"yes, can someone fix this?",308919982,2015-09-19 00:16:52
9287471,67624,39910385,4,Buøyant is actually our preference (in honor of Finagle's Norse heritage). But we're fine with whatever.,308919982,2015-09-19 04:20:57
9383100,64314,40034322,17,"the top of this file states:
```
/**
 * Autogenerated by Thrift
 *
 * DO NOT EDIT UNLESS YOU ARE SURE THAT YOU KNOW WHAT YOU ARE DOING
 */
```

your changes seem fine to me, so i just want to bring this up.",315276904,2015-09-22 03:22:40
9383100,64314,40034143,5,"i generally prefer leaving the fields, but no big deal.

can you explicitly state that this field number cannot be reused?",315276904,2015-09-22 03:20:37
9383100,120104,40036652,5,"sure.. maybe like this..

```
// don't reuse 4: optional i32 OBSOLETE_duration // how long did the
operation take? microseconds
```
",315276904,2015-09-22 03:49:56
9383100,120104,40037841,5,done,315276904,2015-09-22 04:03:35
9383100,64314,40038290,4,i think this should go around line 28,315279225,2015-09-22 04:08:51
9383100,120104,40038460,4,done,315279225,2015-09-22 04:10:59
9383100,120104,40038325,4,will do,315279225,2015-09-22 04:09:09
9830907,132262,41908723,4,could you add a trailing slash here for consistency?,330313321,2015-10-13 23:55:05
9881806,132262,42194714,4,"for consistency, could you https and add a trailing slash?",331026252,2015-10-16 04:33:44
9881806,1502621,42195929,4,Sure thing,331026252,2015-10-16 04:52:07
9881806,1502621,42195978,4,Fixed in  3870599,331026252,2015-10-16 04:53:08
9907372,132262,42310443,23,"for what it's worth, scoping new stats receivers, and creating new counters should never be done on the hot path unless it's impossible to know the name of the counter until runtime.  since we know the names in advance, we can do better.",332389108,2015-10-17 20:35:01
9921661,132262,42322405,2,"actually, since we no longer expose netty types in the public finagle API, how about we change this to http.Response?",332810178,2015-10-18 20:54:25
9921661,137854,42327820,2,I'm a finagle noob. I just get this recursion without the return.,332810178,2015-10-19 03:48:03
9921661,132262,42332083,2,"sorry, I should have been more clear.  could we change the return type to http.Response?  HttpResponse is a netty3 type, and finagle no longer exposes netty3 types in the public API, since we're trying to switch to netty4.  So the change here will look li",332810178,2015-10-19 07:17:02
9921661,137854,42333196,2,Yes @mosesn. And will use the same type of the quickstart.,332810178,2015-10-19 07:50:43
9933085,64314,42390729,47,nit pull the paren up to the prev line,333099682,2015-10-19 21:08:18
9933085,132262,42395479,36,is it worth even supplying this case?  how frequently is identity used?,333099682,2015-10-19 21:48:14
9933085,132262,42395912,61,"we can skip some of the boilerplate with `ServiceFactoryProxy`, and then override apply.",333099682,2015-10-19 21:52:05
9933085,198588,42397513,36,"> how frequently is identity used?

this will be difficult for me to determine. would you rather i left it out? it supports this neat equality:

    filter andThen identity eq filter
    (identity andThen filter) eq filter",333099682,2015-10-19 22:05:03
9933085,198588,42400118,61,"either i'm not sure how to do this, or it doesn't actually improve the boiler plate as you imagine. don't i still need to create a `new ServiceFactory[ReqIn, RepOut]` to pass into the `ServiceFactoryProxy`?",333099682,2015-10-19 22:27:57
9933085,83701,42401688,23,It seems like we've dropped this behavior? Do we need to lift exceptions in `build` to Futures?,333270789,2015-10-19 22:40:30
9933085,132262,42403709,61,"ah, I see, the type parameters are wrong to use factory directly.  :+1: ",333099682,2015-10-19 22:56:37
9933085,132262,42403811,36,"yeah, it seems unlikely that it matters.  :+1: ",333099682,2015-10-19 22:57:28
9933085,198588,42404842,23,We are safe because of `Service.rescue` in the `andThen` which takes a Service argument.,333270789,2015-10-19 23:04:55
9967885,132262,42568491,41,"oh god.  thanks for doing this, this is crazy.  could you add a comment as to why we need this?",333676961,2015-10-21 04:35:40
10031103,132262,46250046,6,I think this should be `if (!c.onClose.isDefined)`,352709798,2015-12-01 16:18:08
10051019,132262,42940060,79,should be queuing,336098873,2015-10-25 06:51:31
10051019,132262,42940062,85,ditto,336098873,2015-10-25 06:51:42
10051019,132262,42940072,146,"because only one parent can be specified, this is necessarily a tree, right?  maybe more clear to specify a latency tree.",336098873,2015-10-25 06:53:35
10051019,120104,42940839,146,"Good point. Will update.
",336098873,2015-10-25 10:25:44
10051019,132262,42952530,56,"sorry, should have caught this before, this should be ""sr"", I think",336389490,2015-10-26 05:56:57
10752959,132262,46523778,4,please don't add these (I think these are eclipse files?) can you instead add these to your global gitignore?,351781572,2015-12-03 16:24:12
10752959,132262,46524015,51,"can you add these methods to `BaseClient` instead of `Client`, to be consistent with the regular style here?",351781572,2015-12-03 16:27:27
10752959,132262,46524100,81,"if this is optional, let's make this `Option[ChannelBuffer]` instead?",351781572,2015-12-03 16:28:27
10752959,132262,46524205,78,"could you mention the values that the parameters can be?  if you don't think it's appropriate to paste it, could you link to the relevant documentation on the redis website?",351781572,2015-12-03 16:30:00
10752959,132262,46524545,84,in what cases does it return an EmptyBulkReply?  can we just return `Future[ChannelBuffer]`?,351781572,2015-12-03 16:34:38
10752959,132262,46524584,102,"could you add a return type annotation here?  I can guess, but it's nice to have it spelled out.",351781572,2015-12-03 16:35:15
10752959,132262,46524627,16,"could you instead use the finagle 6 API to construct this?  that way we get to use pipelining, etc.",351781572,2015-12-03 16:35:54
10752959,132262,46524729,30,"scaladoc? in particular, props must have a role-reported key, or this will throw.",351781572,2015-12-03 16:37:31
10752959,132262,46524767,30,feel free to ignore: may call this fromMap or fromProperties?,351781572,2015-12-03 16:38:01
10752959,132262,46524810,41,"why make these all lazy?  these are all cheap operations, let's strict 'em.",351781572,2015-12-03 16:38:33
10752959,132262,46524916,3,I don't think this needs to be fully qualified.,351781572,2015-12-03 16:40:04
10752959,132262,46524931,11,"sort imports, please",351781572,2015-12-03 16:40:13
10752959,132262,46524956,20,let's prefer `Seq` over `List`,351781572,2015-12-03 16:40:34
10752959,132262,46524989,23,let's prefer `masters.map {` here,351781572,2015-12-03 16:40:56
10752959,132262,46525145,102,"since this needs to be Strings eventually, can we take Seq[String] as an argument and use ReplyFormat.toString instead of ReplyFormat.toChannelBuffer?",351781572,2015-12-03 16:43:18
10752959,132262,46525206,58,`names.map {`,351781572,2015-12-03 16:44:00
10752959,132262,46525365,35,"is it possible that there's no master, for example if the master just died and the dead master has been detected, but leader election hasn't finished yet?",351781572,2015-12-03 16:46:21
10752959,132262,46525476,103,s/ckquorum/ckQuorum,351781572,2015-12-03 16:47:26
10752959,132262,46525737,121,feel free to ignore: unless you use `InetSocketAddress.createUnresolved` this will entail a DNS resolution.  Maybe it would be simpler to require that users specify a host and port separately?,351781572,2015-12-03 16:50:37
10752959,132262,46525887,10,merge me,351781572,2015-12-03 16:52:42
10752959,132262,46525856,17,could you follow the style here and and put these commands in Command.scala?  That way folks only need to look one place to see all the implemented commands.,351781572,2015-12-03 16:52:10
10752959,132262,46525964,19,why doesn't this match up with the command?,351781572,2015-12-03 16:53:55
10752959,132262,46526088,24,case object?,351781572,2015-12-03 16:55:32
10752959,132262,46526228,178,string interpolate?,351781572,2015-12-03 16:57:36
10752959,132262,46526432,38,could you add a timeout to the Await.ready?  it's a pain when something hangs and we don't have a timeout on it.,351781572,2015-12-03 16:59:50
10752959,132262,46526440,45,rm println,351781572,2015-12-03 16:59:59
10752959,132262,46526541,53,use parens–this isn't an accessor by any means,351781572,2015-12-03 17:01:07
10752959,132262,46526696,44,"github shows that this line is gone, but I'm not sure how that could be possible . . . weird.",351781572,2015-12-03 17:02:54
10752959,132262,46526829,44,"actually, I think I was just selecting it and it seemed reddish.  nvm.  seems fine now.",351781572,2015-12-03 17:04:44
10752959,132262,46526888,62,prefer == since scalatest 2.x the assert macro is dope,351781572,2015-12-03 17:05:22
10752959,132262,46526932,74,== (here and elsewhere),351781572,2015-12-03 17:05:55
10752959,132262,46526911,67,timeout (and for all other Awaits in this file),351781572,2015-12-03 17:05:40
10752959,132262,46526726,56,timeout,351781572,2015-12-03 17:03:29
10752959,972039,46577166,51,"They were in BaseClient. I moved them to Client, because they are not available in sentinel and/or cluster mode.",351781572,2015-12-04 00:48:18
10752959,972039,46577563,84,EmptyBulkReply is returned when the section is unknown to the redis server.,351781572,2015-12-04 00:51:10
10752959,972039,46578771,35,"It always returns something about the master, including its status, unless it is removed. In that case, an exception will be thrown.",351781572,2015-12-04 00:59:44
10752959,972039,46579429,19,"""MASTER"" is a subcommand of ""SENTINEL""",351781572,2015-12-04 01:04:26
10752959,972039,46580107,45,It is to avoid long running tests without any feedback. Shall I replace it with logging?,351781572,2015-12-04 01:09:10
10752959,972039,46580718,24,"I think it's better not put them together.

    case class SentinelMasters() extends Sentinel(SentinelMasters.channelBuffer, Nil)

    object SentinelMasters extends SentinelHelper {
      val command = ""MASTERS""
      def apply(args: Seq[Array[Byte",351781572,2015-12-04 01:13:56
10752959,132262,46581490,24,"case classes with no parameters were deprecated, so we should find some kind of solution to this–if it really bothers you to put them under the same object (I think it's fine) we can rename the object in this case.",351781572,2015-12-04 01:19:04
10752959,132262,46581577,45,"yes, that's a good idea",351781572,2015-12-04 01:19:34
10752959,972039,46582485,17,"These are subcommands of ""SENTINEL"", which is added in Command.scala. I followed the ""CONFIG"" command's style here.",351781572,2015-12-04 01:26:08
10752959,132262,46582772,19,"So the main places where this command are used seem to be in stats and tracing.  Do you want them to appear as ""SENTINEL"" or ""MASTER"" or ""SENTINEL MASTER""?  In Config, it seems that we chose ""CONFIG"".",351781572,2015-12-04 01:28:16
10752959,972039,46650772,16,"Is it ok with the following piece of code?

    def apply(host: String): SentinelClient = {
      val client = com.twitter.finagle.Redis.client
      SentinelClient(
        client
          .configured(client.params[DefaultPool.Param].copy(high = 1",351781572,2015-12-04 13:35:53
10752959,132262,46650928,16,"Daemonize is already true by default in the finagle 6 API.

there's  no need to configure DefaultPool in the finagle 6 API because it uses the pipelining pool, so there will only ever be one outstanding connection anyway.

LGTM otherwise!",351781572,2015-12-04 13:40:40
10752959,972039,46651441,19,"    abstract class Config(sub: ChannelBuffer, args: Seq[ChannelBuffer]) extends Command {
      // I think you're mentioning this one.
      def command = Commands.CONFIG
      def toChannelBuffer = RedisCodec.toUnifiedFormat(Seq(CommandBytes.CONFIG, s",351781572,2015-12-04 13:53:54
10752959,972039,46651616,24,"They both have a ""command"" property, with different values. Instead of using a different name, can we just use a dummy param?

    case class SentinelMasters(dummy: Int = 0) extends Sentinel(SentinelMasters.channelBuffer, Nil)

    object SentinelMast",351781572,2015-12-04 13:58:51
10752959,132262,46652438,19,"yep, you're right, I was confused.",351781572,2015-12-04 14:18:44
10752959,132262,46652493,24,that seems even sillier than case class with no constructor args.  how about you leave it this way and we'll change it when we change the other case classes with no constructor args.,351781572,2015-12-04 14:20:18
10752959,1925,46767510,38,This should probably be sealed as well.,353556546,2015-12-06 15:23:03
10752959,1925,46767543,142,Probably should add sealed here as well.,353556546,2015-12-06 15:26:33
10752959,1925,46767574,160,"This is going to use the platform's default charset when constructing the string. I'm not sure if this is an actual problem in this scenario or not, but it would likely be best to make it explicit (e.g. UTF-8).",353556546,2015-12-06 15:29:49
10826109,132262,46716846,11,"maybe, ""signals that the work was never done, so it's safe to reenqueue""?",352979497,2015-12-05 02:51:04
10826109,132262,46717093,12,"let's also add a strongly-worded warning that if you're just trying not to be overwhelmed, you almost certainly want to use RequestSemaphoreFilter instead, because RequestMeterFilter doesn't work well with ""real"" resources that are sometimes faster or slo",352979497,2015-12-05 02:52:47
10826109,132262,46717166,15,use mocktimer instead,352979497,2015-12-05 02:53:17
10826109,132262,46717185,19,Time.withCurrentTimeFrozen is useful for manipulating time here,352979497,2015-12-05 02:53:33
10826109,132262,46717213,27,Time.withCurrentTimeFrozen,352979497,2015-12-05 02:53:45
10826109,132262,46717233,36,Time.withCurrentTimeFrozen,352979497,2015-12-05 02:53:49
10826109,132262,46717486,16,"it might make sense not to mark it as rejected if you get an IllegalArgumentException, or a CancellationException?  Probably only RejectedExecutionException should be marked as rejected.",352979497,2015-12-05 02:55:44
10826109,132262,46719500,14,"now that I think about it, how about we don't make permits configurable?  the point of having a permits argument in await is for folks who want to sometimes await on a different number of permits–since we always await on the same number, it's fine to just",352979497,2015-12-05 03:11:40
10826109,232451,46726025,14,"Yes, initially it was not configurable. Only did that for testing purposes. Now using MockTimer I might revert that. Ta.",352979497,2015-12-05 04:05:21
10826109,232451,46728229,36,"Not sure I got the idea of using `MockTimer`. It proceeds with `svc(1)` succesfully but when it calls `svc(2)` it gets stuck on the `meter.await(1)` part. It hangs forever...

```scala
  test(""mark dropped requests as rejected"") {
    val timer = new ",352979497,2015-12-05 04:25:52
10826109,232451,46729192,16,"But we should wrap it in a Failure anyway right? So it can retried? If so, `Future.exception(Failure.wrap(noPermit))` would do the trick, right?
",352979497,2015-12-05 04:35:38
10826109,232451,46729848,12,"Didn't get what you mean by ""resources that are artificially bounded"". ",352979497,2015-12-05 04:42:07
10826109,132262,46754773,12,"suppose you're talking to the foursquare API.  they can handle more traffic than you're throwing at them, but as a policy, they have a ratelimit of N / second.  so you want to rate limit in order to protect them–if you were talking to a service that you o",352979497,2015-12-05 14:17:39
10826109,132262,46754797,16,"Well, you wouldn't want to retry it if it had been cancelled or you had passed in bad arguments.  Failure is also mostly used for signaling inside of finagle, so not sure what wrapping in `Failure` buys you.",352979497,2015-12-05 14:20:34
10826109,232451,46759362,36,"The idea of this test is to make the meter throw an exception because I'm trying to acquire more than 1 permit within a second, and check the exception type, etc. I've changed it to advance after the first call to meter. I've tried advancing a couple hund",352979497,2015-12-05 23:19:46
10826109,232451,46759401,16,"Yes you are right. The client is already controlling the request rate, so if it goes beyond that rate, it should throw an exception. Will change that.",352979497,2015-12-05 23:24:00
10826109,132262,46760741,36,"So the way that AsyncMeter works is that it allows `burst` through at a time–if you examine the first future, it has already been satisfied.  So only the second one is waiting, which means that there is only one waiter.  It would be incorrect for it to th",352979497,2015-12-06 01:25:11
10826109,232451,46908008,36,Pushed earlier today a new version. ,352979497,2015-12-08 10:19:12
10826109,132262,46910929,12,"Let's be precise here: ""Requests that cannot be enqueued to await a permit are failed immediately""",356537898,2015-12-08 11:13:12
10826109,132262,46910963,26,`.andThen(echoSvc)` here and elsewhere (infix style is only for symbolic operators),356537898,2015-12-08 11:14:04
10826109,132262,46910998,25,"feel free to ignore: `AsyncMeter.perSecond(1, 1)` here and elsewhere",356537898,2015-12-08 11:14:51
10826109,132262,46911039,47,"ffti: maybe cleaner as:
```scala
intercept[RejectedExecutionException] {
  throw failure.getCause
}
```",356537898,2015-12-08 11:15:41
10826109,132262,46911065,3,"this should go at the bottom of the imports, so that they're in sorted order",356537898,2015-12-08 11:16:17
10826109,232451,46946283,47,"I loved this syntax but it, actually I was looking for a nicer way of expressing this assertion, but it didn't work.

```scala
val failure = intercept[Failure] { Await.result(f3, 5.seconds) }
intercept[RejectedExecutionException] { failure.getCause }",356537898,2015-12-08 20:21:34
10826109,232451,46946780,12,Done,356537898,2015-12-08 20:27:38
10826109,232451,46946788,26,Done,356537898,2015-12-08 20:27:45
10826109,232451,46946797,25,Done,356537898,2015-12-08 20:27:49
10826109,232451,46946865,47,Quite liked it! Was looking for a cleaner way of expressing this assertion! Thanks!,356537898,2015-12-08 20:28:26
10826109,232451,46946873,3,Done,356537898,2015-12-08 20:28:31
10826109,132262,46754780,36,NB it hangs at Await.result(svc(2)) which is a blocking call.  You need to advance it before that.,352979497,2015-12-05 14:18:53
10934974,972039,46965292,19,"It looks strange to put the listener here in the command, but I don't know how to pass it to the dispatcher at construction time.",357079931,2015-12-08 23:18:59
10934974,132262,46984369,3,never used,357079931,2015-12-09 01:26:41
10934974,132262,46984433,6,"let's write this as {Future, Time}",357079931,2015-12-09 01:27:10
10934974,132262,46984450,7,merge me!,357079931,2015-12-09 01:27:20
10934974,132262,46984560,3,sort imports,357079931,2015-12-09 01:28:17
10934974,132262,46984692,30,"ffti: no need to nest these, we can make this top-level",357079931,2015-12-09 01:29:10
10934974,132262,46984772,31,"I think the style is `Subscribe`, no?",357079931,2015-12-09 01:29:29
10934974,132262,46984811,23,should be Subscribe client,357079931,2015-12-09 01:29:48
10934974,132262,46985101,46,"instead of `onSuccess`, should we use `ensure` here instead?",357079931,2015-12-09 01:31:52
10934974,132262,46985148,63,let's use `close` and `Closable` here instead.,357079931,2015-12-09 01:32:17
10934974,132262,46985205,67,let's not expose this publicly: `private[this]`?,357079931,2015-12-09 01:32:43
10934974,132262,46985247,71,don't love imports in the middle of the file.  can we put these at the top?,357079931,2015-12-09 01:33:03
10934974,132262,46985269,76,ditto,357079931,2015-12-09 01:33:16
10934974,132262,46985261,75,private[this]?,357079931,2015-12-09 01:33:11
10934974,132262,46985824,85,the timer should be configurable,357079931,2015-12-09 01:37:43
10934974,132262,46985870,102,"let's pass a useful string to IllegalArgumentException, here and elsewhere",357079931,2015-12-09 01:38:01
10934974,132262,46985993,96,why do we not want to do anything here?,357079931,2015-12-09 01:39:01
10934974,132262,46985564,78,be explicit here about the type you're returning: `: Unit = {`.  Are you sure you don't want to return `: Future[Unit]`?,357079931,2015-12-09 01:35:32
10934974,132262,46986083,12,should be val,357079931,2015-12-09 01:39:37
10934974,132262,46986417,14,"let's move this closer to the implementation–I had to do quite a bit of looking to find it.  also, let's not call it SubscribeListener, since we use Listeners for things that listen for connections and then respond to requests (ie Netty3Listener).  This i",357079931,2015-12-09 01:42:13
10934974,132262,46987255,20,"could you document why we need a special subscription client, here and elsewhere?  presumably it's because finagle doesn't have native support for object-streaming-style computation.  it's also worth noting that if instead of a Service[Req, Rep] we had a ",357079931,2015-12-09 01:47:53
10934974,132262,46987958,36,"actually, do we need a separate client at this layer?  could we type it at the other client layer?",357079931,2015-12-09 01:52:57
10934974,132262,46988065,75,"these maps need to be synchronized, or else support concurrent access (à la ConcurrentHashMap)–as it is, it's not threadsafe.",357079931,2015-12-09 01:53:50
10934974,132262,46988383,35,does this mean that dispatchers must be discarded after each use?,357079931,2015-12-09 01:56:25
10934974,132262,46988447,35,can we add a test to check that we're behaving correctly here?  it would be a bummer to just silently keep using the old listener.,357079931,2015-12-09 01:57:01
10934974,132262,46988534,49,"could you mention in CHANGES that you've added support for pubsub, and also that you're changing these APIs?",357079931,2015-12-09 01:57:42
10934974,132262,46988826,19,"hmmm, would you be OK with doing it at construction-time?  or do you think it's important to be able to do it request-time?",357079931,2015-12-09 01:59:58
10934974,972039,47053618,35,"All commands created by the same SubscribeClient instance carries the same listener, which is the SubscribeClient instance itself. It would be better if the SubscribeClient can be passed as a constructor argument for the dispatcher.",357079931,2015-12-09 13:51:32
10934974,972039,47053838,36,I don't quite understand what you mean.,357079931,2015-12-09 13:57:33
10934974,972039,47052841,31,"Upper case is used in CommandBytes, so I followed the same style here. MessageBytes is used only in SubscribeClient, so I made it private, and it would be safe to rename them later.

BTW: Sometimes, I find it hard to decide the case the name of a val sh",357079931,2015-12-09 13:30:59
10934974,972039,47053044,46,"Why should we register a handler, if the subscription is not succeeded?",357079931,2015-12-09 13:35:51
10934974,972039,47053218,96,"I found during testing that the acknowledgement message may come after messages for the subscribed channel. So the handlers are registered when the subscription request is sent successfully, instead of waiting for the acknowledgement messages. I added som",357079931,2015-12-09 13:41:01
10934974,972039,47056115,49,"Updated. I don't figure out what a 'RB_ID' is, so I did not add them, is that ok?",357079931,2015-12-09 14:49:45
10934974,132262,47056797,31,"finagle-redis was an external contribution, so it uses a slightly different style.  we usually try to adhere to the scala style guide, although we have a few different rules, which aren't all published externally unfortunately.  probably best to follow th",357079931,2015-12-09 15:02:42
10934974,132262,47056807,46,good point :+1: ,357079931,2015-12-09 15:02:50
10934974,132262,47056891,36,"my understanding is that we need a redis client when we create the rich subscribe client with all the fancy subscription methods, but I think we might be able to still use a regular redis client, and might not need the special subscribe redis client.",357079931,2015-12-09 15:04:36
10934974,132262,47056921,35,"ahh, I see. could you add a comment?",357079931,2015-12-09 15:05:17
10934974,132262,47056933,49,"yes, RB_ID is only for internal changes.",357079931,2015-12-09 15:05:28
10934974,972039,47182778,36,"It is necessary because when a client enters the pub/sub state, it can no longer issue commands other than the (un)subscribe ones, until it exits from the pub/sub state. We have to create two clients if we want to use pub/sub and still be able to access t",357079931,2015-12-10 10:34:16
10934974,972039,47182826,20,Comments add on c.t.f.redis.SubscribeClient,357079931,2015-12-10 10:35:15
10934974,132262,47182946,36,"could we still use clients of the same type, and just document this?",357079931,2015-12-10 10:38:08
10934974,972039,47184825,36,"In that case, we'll have to keep track of the client state, and prevent users from issuing ordinary commands to a pub/sub client by throwing IllegalStateException. I think it's better to keep them separate for type safety.",357079931,2015-12-10 11:13:23
10934974,132262,47257182,36,Don't we already have that problem today in that someone could call two subscribe commands?  Seems like we need to document it anyway (shrug),357079931,2015-12-11 01:34:22
10934974,972039,47323089,36,"That's not the same. We may subscribe multiple times, but it will not change the way how we communicate with the server. In the subscribe mode, there's no correspondence between the outgoing and incoming messages, while in the ordinary mode, the outgoing ",357079931,2015-12-11 13:31:55
10934974,132262,47324227,36,"I think the right way of doing this would be to keep using the same redis protocol, but ensure that if a connection is subscribed to, then it can't be used for pipelining, and vice versa.  This way we actually can share the client between subscription and",357079931,2015-12-11 14:04:09
10934974,972039,47327655,36,"Could you give some details about the transaction affairs? I thought it had no relation with the subscribe commands, but I'm not pretty sure on that.",357079931,2015-12-11 15:20:14
10934974,972039,47458914,36,"Some more thoughts on adding subscribe support to the existing pipelining client:

1. It is hard to tell whether a client has quit from pub/sub mode successfully, because we are not replied when we issue an unsubscribe command. When we issued  an unsubs",357079931,2015-12-14 11:26:09
10934974,132262,47534157,36,"Yes, transactions are unrelated to subscription, except in that when you're in a transaction, you can't use that connection for anything else, the same way that you can't use a subscription connection for anything else.

If we changed the connection poo",357079931,2015-12-15 02:14:06
10934974,972039,47598928,36,"Subscription is more complicated than transactions. Consider the following scenario:
   
    send: subscribe foo      <-- The client subscribes to a channel,

    recv: subscribe foo 1    <-- and receives an acknowledgement like this. The
           ",357079931,2015-12-15 13:51:42
10934974,132262,47613737,36,"oh, I see now.  we would need two kinds of reusable connections, one for subscriptions, and one for regular (non-transaction) redis.  but this should still be doable.",357079931,2015-12-15 17:27:41
10934974,132262,47614265,51,"this should be on the previous line, and let's wrap ex => in NonFatal(ex) =>",359913060,2015-12-15 17:33:02
10934974,132262,47614348,46,shouldn't we check at some point in time that this loop has finished?  let's return Future[Unit] here.,359913060,2015-12-15 17:33:50
10934974,132262,47614362,47,let's flatMap here instead.,359913060,2015-12-15 17:33:59
10934974,132262,47614428,52,it's idiomatic to use foreach for side-effects.,359913060,2015-12-15 17:34:50
10934974,132262,47614941,56,should we fail the promise if we fail the write?,359913060,2015-12-15 17:39:43
10934974,972039,47745489,36,"I think it's ok to share the same connection among all subscribers, and share another for all regular uses. And perhaps we can also use the for-regular-use connection for transactions, if we make sure that all commands for the same transaction will be sen",357079931,2015-12-16 15:56:22
10934974,132262,47747267,36,"hmm, interesting.  I guess it depends on the implementation–the downside is that if you send the parts of a transaction eagerly instead of lazily, then if some of the work is nontrivial, like sending a big request, you don't delay it until the last moment",357079931,2015-12-16 16:25:26
10934974,972039,47749249,36,"Yes, you're right. And another thing I failed to take into account is the WATCH command. It's not part of the transaction, but affects the transaction result. So, we're gonna need individual connections for each concurrent transactions.",357079931,2015-12-16 16:47:35
10934974,972039,47750613,46,I think it's not necessary. We do the work in the onFailure callback.,359913060,2015-12-16 17:03:38
10934974,132262,47800578,46,my concern is that we have no way of checking if it hangs forever and leaks memory.  admittedly it's probably not terribly likely.,359913060,2015-12-17 00:46:30
10934974,972039,47864516,46,"It may be better to check it at somewhere underlying, in the transport, perhaps.",359913060,2015-12-17 11:01:22
10934974,132262,47870153,46,"I think it's a valid use case to close but still be reading in the transport though.  Well, we can keep it this way for now, and fix it if it causes a problem.",359913060,2015-12-17 13:16:56
10934974,972039,47986583,36,It seems that the current TransactionalClient implementation is not thread safe for the same reason - WATCH's are no guaranteed to use the same connection that the transaction is going to use.,357079931,2015-12-18 09:53:17
10934974,1925,48689766,7,Supports => Support,365876881,2016-01-03 11:36:29
10934974,1925,48689768,157,Let's add an explicit return type here.,365876881,2016-01-03 11:37:23
10934974,1925,48689773,168,Use .flatMap and add a return type to the method please.,365876881,2016-01-03 11:37:56
10934974,1925,48689782,40,Add return type.,365876881,2016-01-03 11:41:55
10934974,1925,48689785,44,Add return type.,365876881,2016-01-03 11:42:54
10934974,1925,48689786,66,Add return type.,365876881,2016-01-03 11:43:07
10934974,1925,48689784,38,Add return type.,365876881,2016-01-03 11:42:50
10934974,1925,48689764,131,"```code
client.reset().ensure(singleton.close())
```",365876881,2016-01-03 11:35:59
10934974,1925,48689787,27,Add return types here and below.,365876881,2016-01-03 11:43:26
10934974,132262,55235269,77,"let's add parens for this function so it's clear that it's a function, and not an accessor.",367853310,2016-03-08 01:06:29
10934974,132262,55235955,57,my suspicion is that we can do a little bit better than this by using a conventional serial pool (like DefaultPool) but we can make this optimization in the future.,367853310,2016-03-08 01:11:20
10949675,132262,47056174,88,why parameterize A?,357250129,2015-12-09 14:51:06
10949675,132262,47056216,15,looks like `In` is never used?,357250129,2015-12-09 14:51:59
10949675,132262,47056231,92,`.onSuccess {`,357250129,2015-12-09 14:52:14
10949675,132262,47056258,80,s/ServerDispather/ServerDispatcher,357250129,2015-12-09 14:52:40
10949675,132262,47056319,79,"""A wrapper type"" isn't terribly descriptive.  How about something like:

""Wraps a ServerDispatcher, adding annotations when a request is read from the wire, and later is written to the wire.""",357250129,2015-12-09 14:53:56
10949675,132262,47056345,80,"let's also be clear about what kinds of ServerDispatchers it can wrap.  this is only OK for RPC, right?",357250129,2015-12-09 14:54:21
10949675,132262,47056393,28,why not keep this protected?,357250129,2015-12-09 14:55:27
10949675,423711,47122067,88,"It shouldn't be - that was leftover from a functional attempt to return the same `type` passed in, and I had just `yy` the original method definition.

Fixed.",357250129,2015-12-10 01:22:47
10949675,423711,47122088,92,Done,357250129,2015-12-10 01:22:54
10949675,423711,47122815,80,My desire is to have this only wrap anything that is a sub-type of `ServerDispatcher`. That would mean mixing in the type on things like [finagle-http](https://github.com/twitter/finagle/blob/develop/finagle-http/src/main/scala/com/twitter/finagle/http/co,357250129,2015-12-10 01:28:27
10949675,423711,47122830,79,Done.,357250129,2015-12-10 01:28:35
10949675,423711,47122968,28,If it's protected it's not visible to the `AnnotatedServerDispatcher`. I went back and forth on this - I'm open to other solutions.,357250129,2015-12-10 01:29:36
10949675,423711,47123207,15,"Yeah, it's not. Same as above - I had `yy` that definition from another implementation that was an abstract class that need a Transporter.

Fixed.",357250129,2015-12-10 01:31:33
10949675,132262,47124833,80,"OK, let me be more precise.  There are at least three models of request / response interactions that we're considering in finagle right now.  We support two of them, byte streaming (over http) and object RPC today, and we're considering support for a thir",357250129,2015-12-10 01:43:40
10949675,132262,47126532,28,"We can't make it `private[dispatch]` because we have `ServerDispatchers` outside of the `dispatch` package.  Let's make it public and call it a day–I don't think scala has the ability to say, ""let subclasses fiddle with this method on other instances of t",357250129,2015-12-10 01:56:25
10949675,64314,47140461,13,s/ServerDispatherAnnotator/ServerDispatcherAnnotator/,357298103,2015-12-10 03:37:51
10949675,64314,47140483,11,s/Dipatcher/Dispatcher/,357298103,2015-12-10 03:38:01
10949675,64314,47140827,70,"this and `handle` don't actually override anything. we only use override for overriding implementations, not when its only an interface.",357298103,2015-12-10 03:40:48
10949675,64314,47140892,89,same comment re overrides here,357298103,2015-12-10 03:41:17
10949675,64314,47141252,90,"in order to avoid the closure allocation on every call, we can store it in a member variable.

```
private[this] val RecordWireSend: Unit => Unit = 
  _ => Trace.record(Annotation.WireSend) 

...
dispatcher.handle(rep).onSuccess(RecordWireSed)",357298103,2015-12-10 03:43:55
10949675,64314,47141403,86,"minor style notes:
* -1 indent for the scaladoc block please.
* pull the `(dispatcher: ServerDispatcher[Req, Rep, Out])` up to the prev line.",357298103,2015-12-10 03:45:06
11220633,64314,48289118,4,please add scaladoc for what this is for and that it defaults to on.,363761817,2015-12-23 03:33:43
11220633,64314,48289171,18,this is a breaking API change so it should be listed in CHANGES.,363761817,2015-12-23 03:34:12
12013488,132262,51646458,24,"would you mind using a finagle 6-style client?  This instead becomes:

```scala
Http
  .client
  .withSessionPool.maxSize(10)
  .newService(ServiceProvider.buildConsumerPath(EchoServer.servicePath), ""http-client"")
```

The new version of finagle ",382933870,2016-02-03 06:24:43
12013488,132262,51646735,41,"Ditto here:

```scala
Http.server.withLabel(""echoserver"").serve("":8080"", new EchoServer)
```",382933870,2016-02-03 06:27:00
12013488,132262,56057202,24,can we move the . to be in front?  that's the typical style we use inf inagle,383537540,2016-03-15 02:05:12
12013488,132262,56057292,3,do you mind sorting your imports?,383537540,2016-03-15 02:05:52
12013488,132262,56057327,49,dots in front :+1: ,383537540,2016-03-15 02:06:07
12084387,64314,51955340,4,leave this next version out please. our release tooling automatically bumps the 6.x to the next version when its release time.,384261365,2016-02-05 07:26:44
12084387,64314,51955534,25,nit: space before the {,384261365,2016-02-05 07:28:25
12084387,64314,51955699,20,"mind adding trivial scaladoc to these public objects? can be as simple as:

```
/** Matches when the status code is between 100–199. */
```",384261365,2016-02-05 07:29:55
12084387,1925,52064118,12,Do we really need this to be curried?,384261365,2016-02-06 03:50:06
12084387,1925,52064281,13,On the off chance somebody passes in a null Status it would be nice if this were ```Option(status)``` here rather than ```Some(status)```. Same comment applies to line 45.,384261365,2016-02-06 03:51:32
12084387,149050,52082200,25,fixed,384261365,2016-02-06 06:35:07
12084387,149050,52082217,20,Done,384261365,2016-02-06 06:35:17
12084387,149050,52082241,4,Done,384261365,2016-02-06 06:35:29
12084387,149050,52082367,12,"No, not really. It was like that because I wanted to write the unapply function like this:
```scala
def unapply: Status => Option[Status] =
  inRange(100,200)
```
But it appears that leads to several compile errors.",384261365,2016-02-06 06:36:47
12084387,149050,52082402,13,"Good point, fixed.",384261365,2016-02-06 06:37:03
12084387,64314,52083789,18,"sorry to nitpick: but our style used for scaladoc is 1 less indent on *s.

```
/**
 * ...
 * ...
 */
```",385130927,2016-02-06 06:52:21
12084387,149050,52100083,18,Is there something that automatically formats this way? My auto-layout destroys it back to the layout in the PR. Was this comment style also described somewhere?,385130927,2016-02-06 17:18:19
12084387,132262,52108775,18,"Yep, we adhere to the comment style here: https://twitter.github.io/effectivescala/#Formatting-Comments",385130927,2016-02-07 06:57:41
12084387,132262,52108799,58,can you just put all of this on one line? we typically don't wrap until 100 columns.,385315278,2016-02-07 07:00:00
12084387,132262,52108829,12,"can you break this up into separate tests for each thing you're testing?  ie, ""matches unknown"" ""matches informational"" etc.",385315278,2016-02-07 07:02:33
12084387,132262,52108842,13,"why test this?  null isn't a valid input, is it?  if it is, we should instead accept an Option[Status], imo.",385315278,2016-02-07 07:03:05
12084387,132262,52108848,6,s/convience/convenience,385315278,2016-02-07 07:03:37
12084387,149050,52115130,13,"`null` isn't a status, therefore, it shouldn't be matched by any of the category matchers.",385315278,2016-02-07 17:48:56
12084387,132262,52120436,13,"Right, but my impression is that in scala we typically assume that null is not a valid argument to pass.  If an instance might be null, it's up to the user to use it safely.  If that weren't the case, we would need to null-check every argument ever.

We",385315278,2016-02-08 01:00:35
12084387,132262,52120441,49,"this should be `Some(status)`, I think.",385702872,2016-02-08 01:01:14
12084387,149050,52120490,49,Fine by me. :),385702872,2016-02-08 01:04:35
12084387,1925,52211863,49,"I had commented that it should be ```Option(status)``` in case it was null by some chance. That's what I usually do stylistically out of paranoia, but not a huge deal either way.",385702872,2016-02-09 03:21:50
12084387,1925,52212092,13,"This should match line 77 to be consistent. I prefer ```Option```, but I may be the only one so consistency is more important.",385819719,2016-02-09 03:23:38
12084387,72999,52224897,11,How about to rename it just `Unknown`? We already have prefix `Status` so `Status.UnknownStats` feels redundant.,385819719,2016-02-09 05:05:04
12084387,132262,52267839,49,"Ah, we typically only use `Option` in finagle when we're using an API that can definitely return `null` sometimes.  We treat `Option` like the Nullable annotation in findbugs–if it's not marked Option, it definitely exists.",385702872,2016-02-09 12:58:01
12084387,149050,52526175,11,"Good point, fixed.",385819719,2016-02-11 05:16:22
12185205,132262,55917126,59,rm this line,405449783,2016-03-12 14:14:35
12185205,132262,55917132,21,"this doesn't use ServerDispatcherInitializer, as far as I can tell.  let's not make it a constructor parameter until the layer where we need it.",405449783,2016-03-12 14:15:49
12185205,132262,55917146,132,let's not do this kind of special spacing,405449783,2016-03-12 14:20:28
12185205,132262,55917147,140,ditto,405449783,2016-03-12 14:20:32
12185205,132262,55917182,136,do responses often have the trace id embedded in them?,405449783,2016-03-12 14:23:11
12185205,423711,55942665,59,Done,405449783,2016-03-14 02:54:56
12185205,423711,55942707,21,"I agree - at the time, I thought it would be beneficial for all clients to know that a `ServerDispatcherInitializer` was required to properly construct a SeverDispatcher. Coming back to it a month later though, it just feels like extra noise that should b",405449783,2016-03-14 02:57:15
12185205,423711,55942711,132,"Removed, sorry, old habits and what not.",405449783,2016-03-14 02:57:36
12185205,423711,55942714,140,Done,405449783,2016-03-14 02:57:42
12185205,423711,55942782,136,"Honestly? ¯\_(ツ)_/¯

I don't have strong opinions on this at all - we have use cases where we like the Trace id embedded in a response, but I can absolutely see this as being something handled on a per-protocol basis.",405449783,2016-03-14 03:03:09
12185205,132262,55945619,136,Could you elaborate on your use case?  Will it ever be a different trace id than the one in the request?,405449783,2016-03-14 06:02:05
12185205,423711,56027275,136,"Yeah, I wasn't thinking clearly here - we use some http services internally that we would like to have the ID embedded, but those would

- Never have a different ID that than the request
- Wouldn't be affected by the SerialServerDispatcher anyways

T",405449783,2016-03-14 23:17:48
12275283,64314,53121936,6,"for backwards compatibility with java users (who don't get the benefits of default arguments) can you add it as forwarding method instead:

```
def apply(protocolFactory: TProtocolFactory) =
  apply(protocolFactory, true)

def apply(protocolFactory:",388846174,2016-02-17 13:16:34
12275283,64314,53121972,34,and here too.,388846174,2016-02-17 13:17:18
12275283,64314,53121981,6,and here.,388846174,2016-02-17 13:17:32
12275283,64314,53122003,30,rename `x` to `enabled`.,388846174,2016-02-17 13:18:02
12275283,64314,53122011,49,and here.,388846174,2016-02-17 13:18:17
12275283,64314,53121961,15,"similar deal here. 

add:

```
def this(protocolFactory: TProtocolFactory) = 
  this(protocolFactory, true)
```",388846174,2016-02-17 13:17:06
12275283,64314,53121828,6,"mind linking to the docs since this is a bit opaque. something like:

```
@see The [[https://twitter.github.io/finagle/guide/Protocols.html?highlight=Twitter-upgraded#thrift user guide]] for details on Twitter-upgrade Thrift.
```",388846174,2016-02-17 13:14:07
12275283,72999,53979440,11,Why we still need this?,395406463,2016-02-25 02:04:44
12275283,72999,53979484,31,I don't think we need ` _attemptProtocolUpgrade` anymore.,395406463,2016-02-25 02:05:07
12275283,72999,53980191,41,Why we need to extract `AttemptProtocolUpgrade` from params and pass it separately? Preparer already takes `params` so you can extract them later.,395406463,2016-02-25 02:09:50
12275283,72999,53980384,120,Just extract your new param here.,395406463,2016-02-25 02:10:57
12275283,72999,53980273,54,We don't need it here - preparer has it already through `params`.,395406463,2016-02-25 02:10:20
12275283,664422,53996279,11,My intent with the changes to `ThriftClient(Buffered|Framed)Codec(Factory)` was to provide a way for client code that was still using the builder interface with `.codec(...)` to make use of the new option. I'm more than happy to remove all of them if you ,395406463,2016-02-25 03:51:06
12275283,72999,54011035,11,"Oh, you're right. I was thinking we can add method to a client builder `attemptProtocolUpgrade`, but realized that it's Thrift-specific. We're planing to remove all the codecs from Finagle in the nearest future (we even have a ticket for that and it's pla",395406463,2016-02-25 05:39:35
12275283,72999,54014108,11,Okay. I chatted with people at the team. Let's drop the codec support for now and only add stack param available via the `with`-method.,395406463,2016-02-25 06:00:56
12275283,72999,54014614,43,"Let's name that `withNoProtocolUpgrade` as per [item 2 in design principles](http://twitter.github.io/finagle/guide/Configuration.html#design-principles). But please, leave the stack param as is.",395406463,2016-02-25 06:04:11
12275283,193897,54611516,35,please add a short timeout to this await to pre-empt indefinitely blocking tests.,396351495,2016-03-02 02:30:20
12275283,193897,54611840,18,bikeshed: `AttemptTTwitterUpgrade` is more informative imo,396351495,2016-03-02 02:32:24
12275283,193897,54616022,13,"this is sufficient I think but if you're feeling motivated, the upgrade request will show up in tracing as well so we could verify that disabling upgrades yields 1 fewer request trace.",396351495,2016-03-02 02:57:55
12591013,64314,55392893,4,can we mark this `private final`? good to have good code hygiene even in sample code.,396160855,2016-03-09 01:20:33
12591013,64314,55392942,6,same `private final` here too.,396160855,2016-03-09 01:20:49
12591013,64314,55393096,13,s/Finagle/Filter/,396160855,2016-03-09 01:21:46
12591013,64314,55393218,29,"feel free to ignore, but i prefer not teaching people to log, so can we omit this line?",396160855,2016-03-09 01:22:35
12591013,64314,55394063,19,"bummer that we don't have a nicer java API for `Stopwatch`. i'll try to address that for the future.

that said, you should capture the `Elapsed` from calling `start()`. then call `apply()` inside the `map` function below.",396160855,2016-03-09 01:28:03
12591013,64314,55394166,16,`private final` here too please.,396160855,2016-03-09 01:28:38
12591013,198588,56596673,30,I'm surprised this works – I thought finagle-http API was Netty free. Is this about Java subverting Scala access modifiers?,407188199,2016-03-18 06:55:33
12746652,132262,56038477,15,ffti: if statement may be more clear here.,404946715,2016-03-15 00:18:34
12746652,132262,56039056,10,"unused, we can rm it",404946715,2016-03-15 00:21:44
12746652,132262,56039515,148,Let's avoid the `scala.Any` name conflict if possible,404946715,2016-03-15 00:24:07
12746652,132262,56039949,44,"can we make this a val'd up function?  as it is, we're entailing an allocation when we placeholder syntax the method right now.",404946715,2016-03-15 00:26:22
12746652,132262,56042849,100,"How about `showElems.mkString("","")` here?",404946715,2016-03-15 00:42:38
12746652,132262,56042822,99,"How about `showElems.mkString(""/"")` here?",404946715,2016-03-15 00:42:28
12746652,200065,56438808,44,"When you say ""val'd up function"" you mean:
```scala
val showElem: Buf => String = ...
```
?",404946715,2016-03-17 07:21:11
12746652,132262,56443069,44,yes,404946715,2016-03-17 08:16:44
12746652,200065,56450678,10,used on L69,404946715,2016-03-17 10:22:44
12746652,200065,56450725,99,updated both Path and Prefix to use dotted style,404946715,2016-03-17 10:24:05
12746652,132262,57091493,10,of which file?,404946715,2016-03-23 07:08:54
12746652,200065,57234818,10,"Oh, oh, sorry.  I thought you were referring to prefixFailure -- I'll remove decodePath",404946715,2016-03-24 03:51:33
12746652,892906,57343430,125,"I'm having trouble interpreting this, what is this supposed to mean? /foo//*//bar/baz?",412298747,2016-03-24 23:20:51
12746652,583486,57383708,85,"I don't see take, drop, ++, etc being used anywhere for prefixes. Any reason to keep them?",412298747,2016-03-25 03:38:06
12746652,200065,57611726,85,I was just trying to keep this totally in line with Path api.  I can omit them if you think that would be better,412298747,2016-03-29 01:36:46
12746652,200065,57612376,125,"you can't have `/*` or `*/` in a javadoc, since it messes with comment structure.  This renders as ` /foo/*/bar/baz` in rendered javadocs.",412298747,2016-03-29 01:41:07
12746652,892906,57613640,125,"Ha yes! /foo&#47;*&#47;/bar/baz reads as foo/*//bar/baz with a double slash though, no?",412298747,2016-03-29 01:48:54
12746652,583486,57630824,85,Keeping it consistent with Path seems reasonable to me. I don't feel strongly about it.,412298747,2016-03-29 03:46:50
12746652,200065,57636401,125,"good catch, I'll remove the dupe slash",412298747,2016-03-29 04:24:41
12746652,892906,57639291,132,"Also as pointed out by dschoebel it will parse into `Prefix(Label(foo),AnyElem,Label(bar),Label(baz))`",412298747,2016-03-29 04:46:17
12746652,583486,57652567,42,"""grammar""",414994953,2016-03-29 06:41:16
12746652,583486,57653283,63,"ffti: 
`def showElem(buf: Buf): String`",414994953,2016-03-29 06:48:45
12746652,200065,57812884,63,@mosesn told me that the def incurs an unnecessary allocation!,414994953,2016-03-30 05:38:51
12746652,200065,57813246,42,oopsie!,414994953,2016-03-30 05:41:54
12746652,132262,57824753,63,ya,414994953,2016-03-30 07:57:01
12746652,583486,57926857,63,wow :confounded: ,414994953,2016-03-31 00:15:20
12793132,64314,56573707,31,"the default encoding will be the platform if unspecified, so we should use `c.t.io.Charsets.UsAscii` i believe.",408195583,2016-03-18 03:38:57
12793132,64314,56573730,38,nitpick: use `private[this]`,408195583,2016-03-18 03:39:09
12793132,64314,56573849,43,style nit: add a space after `yield`,408195583,2016-03-18 03:39:51
12793132,64314,56574261,101,do you think we should document that these will return the keys in a normalized form (here and below)?,408195583,2016-03-18 03:42:36
12793132,64314,56574745,41,"hmm i realize why you left it, but i think its a bit deceptive to the end-user. given that they pass in a mutable map, there is likely some expectation that their modifications to the map are reflected in this `HeaderMap`. but they won't.

this is a big",408195583,2016-03-18 03:46:01
12793132,164726,56655863,31,"I was aware of that point, I saw no harm in leaving it to the default because I think as long as it is consistent through out the life cycle of the running app (or most likely within the life cycle of a single request) it *should* be fine. So that was my ",408195583,2016-03-18 20:35:42
12793132,164726,56657299,101,"Correct me if I am missing something here. The purpose of the rework was to make sure that we return the original header names, not the normalized ones. [There is a test case specifically for that](https://github.com/grandbora/finagle/blob/make-headermap-",408195583,2016-03-18 20:46:43
12793132,164726,56658423,41,"You have a valid point here. I was going to suggest adding a deprecation here. But I personally prefer breaking the api by removing this constructor. Reasons:
* there is already an apply method which takes tuples. I would expect that most people are usin",408195583,2016-03-18 20:54:26
12793132,64314,56685406,101,"yeah, you're right.",408195583,2016-03-18 23:42:08
12793132,64314,56685598,40,"please either deprecate or remove. as mentioned, i think this API is too weird now.",409229101,2016-03-18 23:43:27
12793132,164726,56687850,40,Removed https://github.com/twitter/finagle/pull/473/commits/8f01e6bf3b02809cc60b242ea9d6c1aea1640d26,409229101,2016-03-18 23:57:41
13036708,132262,56035555,3,please sort your imports,406584962,2016-03-15 00:02:22
13036708,132262,56035633,14,love to see these imports ????,406584962,2016-03-15 00:02:52
13036708,132262,56035882,19,"twitter style guide on scaladoc:

```
/**
 * Blah blah blah
 * @blah blah blah
 */
```

here's an example: https://github.com/twitter/util/blob/develop/util-core/src/main/scala/com/twitter/util/Future.scala#L16-L20",406584962,2016-03-15 00:04:01
13036708,132262,56035992,21,wrap at 80 columns please https://github.com/twitter/finagle/blob/develop/CONTRIBUTING.md#style,406584962,2016-03-15 00:04:37
13036708,132262,56037185,48,feel free to ignore: the short name we use for address is usually `addr`,406584962,2016-03-15 00:11:14
13036708,132262,56037575,91,can you add a timeout to `Await.result` so this won't hang even if we regress while developing?,406584962,2016-03-15 00:13:23
13036708,132262,56037865,28,"feel free to ignore: I'd just spin up a new client and server for the test if I were you, and then we don't have to worry about spinning it down in an afterAll, we can just do it directly in the test.",406584962,2016-03-15 00:15:00
13036708,851815,56066536,91,"This makes sense, but I feel I must point out I failed to do so because `EndToEndTest` mostly does not specify timeouts - I assumed this was the way things were done in Finagle.

By which I do not mean to say I won't fix this problem - I will, you're ob",406584962,2016-03-15 03:06:05
13036708,851815,56068637,28,"I'm fine with that, but how do you ensure everything is properly closed down if the test fails? `afterAll` has the advantage of being executed even if individual tests throw exceptions, which is why I tend to implement resource cleanup that way when I can",406584962,2016-03-15 03:19:53
13036708,132262,56073823,91,":+1: yeah, our style has evolved since we first started adding end to end tests, but we typically make these kinds of style fixes lazily.",406584962,2016-03-15 03:53:11
13099080,83701,56383801,48,"It's not really relevant if this is between data centers or not. I'm not sure if it was, looking at some notes from steve gury who collected the data, it just says ""distribution of ping latency on some remote server"". If we want more control over the dist",407934838,2016-03-17 00:55:42
13099080,132262,56385302,18,ffti: use a counter and decrement on close?,407934838,2016-03-17 01:04:15
13099080,132262,56385181,9,how would you feel about moving this into finagle-core?  we have a few use cases which could use this for real.,407934838,2016-03-17 01:03:27
13099080,2863,56387425,48,"Ok, I've updated this paragraph to describe the data (median, stddev, max) instead.",407934838,2016-03-17 01:17:36
13099080,2863,56388586,9,"Sure, I can move it and improve the scaladoc to match what you'd expect from something in finagle-core. I'm surprised you have a serious use case for Round Robin that isn't better served by almost any other choice currently in finagle. Would you also want",407934838,2016-03-17 01:23:45
13099080,83701,56389355,9,I think Moses is referring to a few systems that want to optimize for equity (and have other means of detecting and mitigating the effects of unhealthy nodes). Although I don't think we need round-robin for that. We could use P2C with a constant cost per-,407934838,2016-03-17 01:28:22
13099080,193897,56404491,61,private[this],407976694,2016-03-17 03:02:31
13099080,132262,56406868,9,"Why use P2C with a constant cost per-node?  There's no benefit, right?  RoundRobin is very simple, it probably adds about as much complexity as P2C with constant cost per-node, and it seems easier to reason about.",407934838,2016-03-17 03:18:12
13099080,193897,56408529,80,why expend this much effort as opposed to a single scan over the nodes and getting to the rebuild sooner?,407976694,2016-03-17 03:28:24
13099080,83701,56409047,9,The only benefit is having fewer implementations to maintain. I'd just prefer waiting to promote it into core until we are sure that it solves the use cases you have in mind.,407934838,2016-03-17 03:31:40
13099080,132262,56412051,9,The RoundRobin implementation is simple enough that I don't think it significantly complicates things.  I'll ask someone from search to take a look.  Happy to merge this in as-is.,407934838,2016-03-17 03:49:12
13099080,2863,56421116,80,"I went ahead and set it to 5 which is the default in Balancers. Based on your comment, I'd ideally set it to the size of the vector but I don't have access to that here. Maybe activity.values.size? That doesn't seem totally right to me.",407976694,2016-03-17 04:44:34
13099080,7875,56437849,9,I'm with @mosesn on moving this into finagle-core. I have at least one (major) use-case that would benefit from this and we've been hoping to get this LB for a while. cc @roanta ,407934838,2016-03-17 07:10:36
13099080,83701,56451134,9,Sounds good to me if @stevej is up for it.,407934838,2016-03-17 10:28:42
13099080,83701,56895446,18,latency or endpoint status.,410913247,2016-03-22 03:55:41
13099080,83701,56895600,18,"whoops, just saw that you added it to the implementation.",410913247,2016-03-22 03:56:35
13099080,83701,56896418,78,why do need to rebuild if we find a down node?,410913247,2016-03-22 04:00:59
13099080,83701,56896679,54,How so? Seems correct to me.,410913247,2016-03-22 04:02:30
13099080,2863,56897757,54,"That's a good question, I cribbed this method from P2CBalancerTest and marius wrote this comment in 1179a23b. I mean, it seems fine to me.",410913247,2016-03-22 04:09:21
13099080,83701,56898668,54,I think it's vestigial from when the balancers supported weights.,410913247,2016-03-22 04:14:54
13099080,2863,56898950,78,"If I rebuild, will the Closed node still be in the list? If yes, then rebuilding is not an effective strategy here. The lifecycle for the list of nodes is not entirely clear to me. 

If a rebuild is the wrong choice here, I can either partition the list",410913247,2016-03-22 04:16:24
13099080,83701,56907199,78,"Yes, the status != open node will still be in the list as written. Rebuild only signals to the `Balancer` trait to schedule a call to your distributors rebuild method (with the same nodes). It is effectively like calling `new Distributor(vector)` but it i",410913247,2016-03-22 05:15:31
13099080,2863,56909447,78,"Ok, I'm now partitioning into down and up Vectors and triggering rebuild if a member of either should be moved. That's a lot nicer and separates concerns neatly. If somebody really needs a consistent ring across rebuilds, I think it's best if they add tha",410913247,2016-03-22 05:35:07
13099080,132262,56914868,37,"we don't use them for balancing, but they could be useful for metrics, since they're used to calculate load on a service.  maybe worth mentioning that the stats we export for ""load"" is not right.

https://github.com/twitter/finagle/blob/develop/finagle-",411033611,2016-03-22 06:25:07
13099080,132262,56914583,15,"do these need to be protected val?  do we have to specify a visibility for them, or is it OK to be default / private?",411033611,2016-03-22 06:22:16
13099080,132262,56915239,69,ffti: cache up.size?  I'm not sure if vector.size is efficient.,411033611,2016-03-22 06:28:40
13099080,132262,56915421,81,"we don't reassign node, let's make this a val",411033611,2016-03-22 06:30:45
13099080,132262,56916036,78,"I don't think having multiple exit points for this method makes it easier to read.

rewriting it to avoid multiple exits:

```scala
if (up.isEmpty) failingNode(emptyException)
else {
  val node = up(chooseNext())
  node.status match {
    case St",411033611,2016-03-22 06:36:40
13099080,132262,56916384,47,"do we need App here?  looks like we need it in p2c because we parse flags, but since we don't here, we shouldn't need it.",411033611,2016-03-22 06:39:48
13099080,2863,57348552,47,"thanks, removed App.",411033611,2016-03-24 23:51:59
13099080,2863,57348586,78,"Thanks, I changed that.",411033611,2016-03-24 23:52:13
13099080,2863,57348690,81,this is now gone due to the other change you suggested.,411033611,2016-03-24 23:52:52
13099080,2863,57353214,69,I'm digging into whether vector.size is efficient.,411033611,2016-03-25 00:20:45
13099080,2863,57354148,69,"Vector.size looks efficient, it is integer subtraction.

https://github.com/scala/scala/blob/2.11.x/src/library/scala/collection/immutable/Vector.scala#L81",411033611,2016-03-25 00:26:00
13099080,2863,57355531,15,the convention of the other balancers is to make these protected. I don't know why that choice was made but it's not strictly required so I've reverted back to default access modifiers for RoundRobinBalancer,411033611,2016-03-25 00:33:57
13099080,2863,57355567,37,noted in the comment now.,411033611,2016-03-25 00:34:06
13158670,198588,56707711,10,What do you think of adding this to [StreamingTest.scala](https://github.com/twitter/finagle/blob/develop/finagle-http/src/test/scala/com/twitter/finagle/http/StreamingTest.scala)?,409384399,2016-03-19 02:10:35
13158670,198588,56709150,13,"Do you also need `prepConn`?

I was going to propose making these changes look more like ClientBuilder, e.g.:

```
    val clientStack = {
      val stack0 = stack
        .replace(StackClient.Role.prepConn, prepConn)
        .replace(StackClient.",409384399,2016-03-19 02:21:12
13158670,72999,56711298,11,Let's make that `private[finagle]` by analogy with `DelayedReleaseService`.,409384399,2016-03-19 02:39:31
13158670,72999,56711908,39,"What do you think about moving `DelayedReleaseResponse.apply` here as `def private[this]`? This would not only reduce the diff, but would allow as to access `latch` directly (w/o passing a closure) so we can save those 8 bytes per closure allocation on ea",409384399,2016-03-19 02:44:12
13158670,200065,56720610,39,"Yeah, I can revert this.  DelayedReleaseResponse seemed like a nice utility to have outside of this implementation, but now that I'm no longer using it in two places it seems best to merge back..",409384399,2016-03-19 03:52:37
13158670,200065,56721103,13,"`prepConn` seems to be orthogonal:

```scala
    val prepConn = new Stack.ModuleParams[ServiceFactory[Req, Rep]] {
      override def parameters: Seq[Stack.Param[_]] = Nil
      override val role = StackClient.Role.prepConn
      override val descri",409384399,2016-03-19 03:56:41
13158670,198588,56722825,13,"Leaving prepConn out will mean HTTP clients built using Stack and ClientBuilder have be different – see: https://github.com/twitter/finagle/blob/develop/finagle-http/src/main/scala/com/twitter/finagle/http/Codec.scala#L154.

This comment is more for pos",409384399,2016-03-19 04:10:41
13158670,200065,56723964,13,"Oh, interesting. finagle-http's codec _does_ install DelayedReleaseService in the prepConn:
```scala

      override def prepareConnFactory(
        underlying: ServiceFactory[Request, Response],
        params: Stack.Params
      ): ServiceFactory[",409384399,2016-03-19 04:20:14
13158670,198588,56724423,13,"Right, the relevant (to this issue) difference between Stack and ClientBuilder clients is that ClientBuilder has access to the codec, via which it can inject codec-specific logic as prepConn and prepFactory. In the HTTP codec, this is implemented as Delay",409384399,2016-03-19 04:24:40
13158670,198588,56728113,13,fingers crossed,409457249,2016-03-19 04:57:55
13179136,72999,56847111,11,Super nice catch! Thanks!,410782837,2016-03-21 22:59:28
13179136,132262,57774557,11,We need to fix this elsewhere too–TwitterServer is failing because of this.,410782837,2016-03-30 01:26:43
13179136,1925,60330608,5,"Any reason not to use container based builds for Finatra, T-S, Scrooge, and util as well?",410782837,2016-04-20 06:39:55
13594735,64314,58451843,6,what does this do to dtabs using #s?,419287162,2016-04-05 04:26:49
13594735,892906,58470018,19,nit: `/s => /a | (/b & /c)`,419287162,2016-04-05 07:13:13
13594735,132262,58490549,4,maybe add a note that `#` must be preceded by a space or must be the first thing in a line?,419287162,2016-04-05 13:02:35
13594735,583486,58497990,6,Using a non-dtab character (like ;) for comments would avoid this ambiguity.,419287162,2016-04-05 14:38:44
13594735,200065,58556920,6,"As illustrated in the test case, /#foo names are safe. The comment character has to be found in the context of whitespace and not in a name. eatWhitespace isn't called while processing names.

Re: character, `;` is meaningful as a delimiter which Is pro",419287162,2016-04-05 22:17:00
13594735,64314,58577039,6,"i saw the test case after i commented.

seems reasonable to me, but i'll defer to others working more closely on dtabs.",419287162,2016-04-06 00:10:20
13594735,9618061,58622277,5,"typo: ""delimeter"" should be ""delimiter""",419922159,2016-04-06 05:11:51
13594735,193897,58622833,5,this is up for review internally so I'll fix it there.,419922159,2016-04-06 05:16:36
13594735,5437425,58759623,6,"it's a little confusing to treat comments in this way.  how about using '%'? 
",419287162,2016-04-07 01:42:44
13955738,132262,60174351,16,break this off into its own test?,427601451,2016-04-19 12:21:36
13955738,200065,60242438,16,"The test name, _histogram snapshot respects refresh window_, seemed appropriate...  i'll split it out if that's clearer, though.",427601451,2016-04-19 21:35:44
13955738,132262,60250642,16,"I don't mind the test name, but I don't like tests that are too long.  it makes it hard to tell what has broken when a test fails, and it's harder to tell what a test is trying to do when you read the code.",427601451,2016-04-19 22:16:08
14026538,132262,60413015,12,please motivate here,430269695,2016-04-20 21:07:01
14026538,132262,60413091,15,do these all need to be public fields?,430269695,2016-04-20 21:07:30
14026538,132262,60413243,24,you never satisfy this promise,430269695,2016-04-20 21:08:10
14026538,132262,60413725,38,make these vals instead of defs if they're never updated.  please also add type annotations.,430269695,2016-04-20 21:10:49
14026538,132262,60414094,55,"function literals should have spaces at the beginning and the end, like so: `{ node => node.isAvailable }`.  I'm also personally allergic to using placeholder syntax with curly braces, but feel free to ignore that nit.",430269695,2016-04-20 21:12:56
14026538,132262,60414446,65,"because this isn't synchronized, we may not see updates to currentNode.  you should either mark it volatile or synchronize the read.",430269695,2016-04-20 21:14:47
14026538,132262,60415227,35,please check that load balancer `status` is the best of its constituent nodes,430269695,2016-04-20 21:18:41
14026538,132262,60415684,53,"I don't think the TrafficDistributor reorders nodes, so everyone will start on the same node if their host list or service discovery gives them the nodes in the same order.",430269695,2016-04-20 21:20:58
14026538,132262,60415887,73,"check status instead, imo.  it's more clear–`isAvailable` was a mistake.",430269695,2016-04-20 21:21:59
14026538,132262,60416670,68,"since this is written in an imperative style anyway, let's go whole hog.  let's use multiple exits, which will simplify the code.

```scala
var idx = 0

while (idx < nodes.size) {
  if (nodes(idx).isAvailable) {
    currentNode = idx
    return no",430269695,2016-04-20 21:26:04
14026538,132262,60417652,68,"This synchronized block is either at the wrong point, or we should check whether status is open again.  Even if someone else beats us in the race here, we're still going to do all of this work as soon as they they let go of the lock.

Some alternatives:",430269695,2016-04-20 21:30:53
14026538,132262,60418380,74,"it's not clear to me that incrementing the index is the right approach here, because I don't think the traffic distributor reorders nodes.  if clients are evenly distributed across remote peers but one peer goes down, suddenly the subsequent peer will get",430269695,2016-04-20 21:34:12
14026538,132262,60418501,27,this counter is never used,430269695,2016-04-20 21:34:41
14026538,132262,60418685,12,"let's also add a note that if many nodes go down, and then later are revived, but the old nodes never go down, there's no mechanism to later move load back to the revived nodes.",430269695,2016-04-20 21:35:35
14026538,132262,60419464,18,why let maxEffort be configurable?  don't we check all of the nodes anyway?,430269695,2016-04-20 21:39:26
14026538,132262,60419687,72,the way this is phrased means that it won't ever go back and recheck nodes that have been marked busy or dead.,430269695,2016-04-20 21:40:41
14026538,132262,60419838,35,please add a test that checks that adding a new node to the cluster doesn't change which node is stuck to.,430269695,2016-04-20 21:41:27
14026538,132262,60419957,88,this doesn't preserve `currentNode` so we might end up choosing a completely different `currentNode`.,430269695,2016-04-20 21:42:12
14026538,132262,60419150,35,please add a test to check that it behaves correctly if traffic distributor hands you the same nodes as everyone else in the same order.,430269695,2016-04-20 21:37:56
14026538,132262,60420260,80,"this isn't actually empty, right?  it's that everyone is dead.  instead of failing we typically just pick one in that case, because we're optimistic =)",430269695,2016-04-20 21:43:31
14026538,132262,60420422,55,"also this val seems unused, as far as I can tell.",430269695,2016-04-20 21:44:08
14026538,132262,60420599,47,indentation,430269695,2016-04-20 21:44:54
14026538,132262,60420644,60,indentation,430269695,2016-04-20 21:45:06
14026538,132262,60420708,60,add a note that this is where we're sticky too.,430269695,2016-04-20 21:45:23
14026538,132262,60420925,35,"please add a test that checks that if a node is marked dead, it can later be marked alive again.",430269695,2016-04-20 21:46:24
14376269,72999,61755450,19,"ffti: `NettyFuture[Any]` and `GenericFutureListener[Any]` should work as well.

I have an internal patch that also fixes that but it's been soaking for review for a long time so I'm totally fine to merge this in.",437485596,2016-05-02 22:35:11
14376269,72999,61756233,22,"Ah that's interesting! I guess you're right and we should totally ratain those objects.

What do you think about fixing `ChannelTransport` to do `ReferenceCountUtil.ratain(msg)` before offering the message into `AsyncQueue`, instead of introducing a new",437485596,2016-05-02 22:40:52
14376269,788219,61825237,22,"I thought of that as well, but wasn't sure about maybe mixing concerns",437485596,2016-05-03 07:09:33
14440216,64314,62533875,17,lets not give a default argument since we do not need to keep backwards compat for package private changes.,438823811,2016-05-10 00:00:52
14440216,64314,62533306,11,please don't reformat — we follow the standard scala style guide: http://docs.scala-lang.org/style/declarations,438823811,2016-05-09 23:57:41
14440216,200065,62587032,11,oops!,438823811,2016-05-10 05:54:23
14838763,193897,64437613,30,can you reproduce `channelInactive` firing when `channelActive` didn't?,449231498,2016-05-25 00:28:40
14838763,200065,64440691,30,i believe that this happens if there are errors in the write() call (which precedes channelActive in clients),449231498,2016-05-25 00:46:25
15151214,120104,65291878,1,weird this didn't get caught as a rename..,455770918,2016-06-01 08:51:36
15151214,120104,65292100,11,one option is to drop this dep and instead use io.zipkin.java:zipkin:1.0.0 as that includes an implicit codec. In other words change to use the canonical model library.,455770918,2016-06-01 08:54:41
15151214,120104,65292187,135,"ex in my local workspace, I made this a map of zipkin.Span.Builder.. not required, as such a change is internal-only and could be layered as easily later",455770918,2016-06-01 08:56:13
15151214,120104,65292289,23,Is there a META-INF change needed? or is the service loader unaffected by the rename,455770918,2016-06-01 08:57:59
15151214,623078,65340957,1,"yes, it did in my local git diff",455770918,2016-06-01 18:04:40
15151214,623078,65356626,23,"Yes it should be unaffected.
`META-INF/services/com.twitter.finagle.tracing.Tracer` in finagle-zipkin points to [`com.twitter.finagle.zipkin.thrift.SamplingTracer`](https://github.com/twitter/finagle/pull/513/files#diff-06cb96e4d4229bad23c2e59316178504R6",455770918,2016-06-01 20:11:44
15151214,623078,65357105,11,Very good point. Although I'm going to try keeping the scope of these changes as small as possible. Let's look into it when the rest is done.,455770918,2016-06-01 20:14:51
15151214,120104,65363305,20,cool basically the extender just needs to implement sendSpans,456225460,2016-06-01 20:51:17
15151214,64314,65569314,4,fyi merge conflict?,457256719,2016-06-02 23:05:57
15151214,64314,65570330,2,"moving the package is a breaking change. i think its probably worth it, but please note these in the ""Breaking"" section of `CHANGES`.",457256719,2016-06-02 23:11:41
15151214,64314,65570404,2,ditto re breaking change.,457256719,2016-06-02 23:12:04
15151214,64314,65570565,15,"can you update the comment, as this isn't tied to scribe anymore, right?",457256719,2016-06-02 23:13:05
15151214,64314,65570798,29,"since you are modifying this file, if you don't mind making the world ever so slightly better, can you annotate this with the return type?",457256719,2016-06-02 23:14:26
15151214,64314,65570844,47,ditto re return type annotation,457256719,2016-06-02 23:14:44
15151214,64314,65570834,40,ditto re return type annotation,457256719,2016-06-02 23:14:38
15151214,64314,65570860,124,ditto re return type annotation,457256719,2016-06-02 23:14:50
15151214,64314,65570941,142,ditto re return type annotation,457256719,2016-06-02 23:15:06
15151214,64314,65570904,133,ditto re return type annotation,457256719,2016-06-02 23:15:01
15151214,64314,65571017,2,ditto re breaking change.,457256719,2016-06-02 23:15:37
15151214,64314,65571089,71,ditto re breaking change.,457256719,2016-06-02 23:16:02
15151214,64314,65571171,71,and likewise for the other public classes in this file,457256719,2016-06-02 23:16:34
15151214,64314,65571228,2,ditto re breaking change.,457256719,2016-06-02 23:16:53
15151214,64314,65572260,19,"the pants build file also has a dep on util-app and util-core. util-core should def be added here. if this doesn't have a direct util-app dependency, then can you remove from the pants build file? (or vice-versa add it here).",457256719,2016-06-02 23:23:38
15151214,64314,65572330,1,thanks for doing all the pants build files! above and beyond what's exepcted! ???? ,457256719,2016-06-02 23:24:06
15151214,623078,65619019,4,:$,457256719,2016-06-03 04:10:11
15151214,623078,65621286,2,"In the breaking section I listed the public classes (and companion objects) affected.:

>   * finagle-zipkin: Moved case classes `Span`, `ZipkinAnnotation`,
>     `BinaryAnnotation`, `Endpoint` and `Sampler` to finagle-zipkin-core.

https://github.co",457256719,2016-06-03 04:24:00
15151214,623078,65622060,15,good catch ???? ,457256719,2016-06-03 04:29:24
15151214,64314,65624144,2,indeed you did! apologies for the noise.,457256719,2016-06-03 04:43:44
15151214,623078,65625723,1,"btw, I fixed up the commits so this appears as a rename",455770918,2016-06-03 04:54:28
15151214,623078,65629560,71,I replaced `c.t.f.zipkin.thrift.SamplingTracer` with a `SamplingTracer` that extends `c.t.f.zipkin.core.SamplingTracer` with a default constructor. This is because the [service loader](https://github.com/twitter/finagle/blob/develop/finagle-zipkin/src/mai,457256719,2016-06-03 05:23:48
15151214,623078,65629884,19,"Gotta run, I'll fix this tomorrow ???? ",457256719,2016-06-03 05:26:26
15151214,1925,65780026,33,@kevinoliver @mosesn Should we move this to the stack equivalent?,458069071,2016-06-04 04:41:17
15151214,1925,65780240,133,"FFTI, but could add a return type here.",458069071,2016-06-04 04:43:15
15151214,1925,65780349,179,FFTI but could add a return type.,458069071,2016-06-04 04:44:16
15151214,64314,65784286,33,"it should, but its not appropriate for this commit.",458069071,2016-06-04 05:22:54
15151214,64314,65786369,37,"this moved up, you should remove this one.",458069071,2016-06-04 05:45:04
15151214,64314,65786522,26,lets leave the indentation as it was for the constructor params,458069071,2016-06-04 05:47:06
15151214,64314,65786558,133,ditto re formatting,458069071,2016-06-04 05:47:33
15278938,200065,66155481,40,"I just commented out for the purposes of discussion. As I mentioned earlier, I think that this error reporting should be removed, since it does not play well with retries.",460418412,2016-06-08 04:22:30
15278938,892906,66156464,33,"Good catch. Could we check if the Dtab has already been injected? 
You could simply add a value in `request.ctx` for that (or perhaps you have a better idea?).",460418412,2016-06-08 04:29:16
15278938,892906,66157176,33,"The fact that Dtab headers were silently removed from finagle requests has cost many hours of debugging, I would prefer that we keep it if it's not too hairy.",460418412,2016-06-08 04:34:22
15278938,200065,66159920,33,Good idea! I didn't know about request.ctx -- let me know what you think.,460418412,2016-06-08 04:53:12
15278938,892906,66319438,68,since this is a constant it should be capitalized and go into the companion object.,461021163,2016-06-09 02:07:29
15312003,64314,67722015,9,s/set/list/,464171010,2016-06-20 23:36:19
15312003,64314,67722255,13,its good to call out that the value must be `[0.0 - 1.0]`,464171010,2016-06-20 23:37:52
15312003,64314,67722379,12,can we minimize visibility?,464171010,2016-06-20 23:38:43
15312003,64314,67722798,44,rm `override` since its abstract in the base class,464171010,2016-06-20 23:41:10
15312003,64314,67722999,51,"we try to hoist function literals into member variables to avoid allocations at runtime.

so this would be:

```
private[this] val onSendFailure: Throwable => Unit = 
  e => errorReceiver.counter(e.getClass.getName).incr()
```",464171010,2016-06-20 23:42:39
15312003,64314,67724832,60,"feel free to ignore: is there a decent guess at an initial size? even if its wrong, i suspect it'll be better than 0.",464171010,2016-06-20 23:53:52
15312003,64314,67725118,61,feel free to ignore: in finagle-thrift we have `Protocols.binaryFactory` which has stats and does some optimizations.,464171010,2016-06-20 23:55:40
15439622,193897,67082273,50,doesn't sequencing this request dispatch before the rpc trace below leave the trace out of order with regards to any tracing lower in the stack?,463526757,2016-06-15 07:34:52
15439622,193897,67082828,56,no infix notation please.,463526757,2016-06-15 07:41:15
15439622,193897,67082853,64,"ditto, no infix",463526757,2016-06-15 07:41:35
15439622,193897,67083331,65,pulling this trace call into a function literal shaves an allocation on the request path,463526757,2016-06-15 07:48:30
15439622,624851,67473223,50,"I think we are fine with these changes.
The order in which tracing events happen for memcached with this commit in place:

1. Initialize span (TraceInitializerFilter part of StackClient)
2. Add Client Send annotation (AnnotatingTracingFilter set-up in",463526757,2016-06-17 15:04:16
15439622,193897,67588281,50,"Step #3 represents the rest of the client stack and we have no guarantees
that there's no tracing happening there so ideally we'd do the request
level tracing before dispatching the request through the rest of the stack.

I'm okay with leaving it as-is bu",463526757,2016-06-18 06:33:32
15439622,624851,67602769,50,"I certainly want to add a comment but I would like to understand the problem. 

What could happen is that additional tracing annotations are added lower in the memcached client stack but I don't see why this would give a problem with adding the cache hi",463526757,2016-06-18 23:04:15
15439622,193897,67963409,50,"Sorry I should have been more specific, the hit/miss annotations are fine, the issue is sequencing `Trace.recordRpc(command.name)` in line 47 after potential tracing lower in the stack. It seems like we'd want the cache command name to be traced before th",463526757,2016-06-22 05:22:43
15575750,200065,68283508,31,this is the important part,468612841,2016-06-24 00:58:28
15575750,132262,68521876,105,rm println plx,469164427,2016-06-27 11:39:01
15575750,132262,68521917,107,"ffti: I like to make eta expansion explicit so that I feel bad about the allocation, but it's your call.",469164427,2016-06-27 11:40:02
15575750,132262,68521925,115,rm println,469164427,2016-06-27 11:40:17
15575750,132262,68521932,124,rm println,469164427,2016-06-27 11:40:24
15578537,200065,68330136,59,"It might be preferable to implement a `com.twitter.tracing.Tracer` that's backed by `io.opentracing.Tracer` -- this way all of finagle's built-in annotations will be automatically integrated, without requiring duplication.  This also would make the opentr",468704381,2016-06-24 05:57:54
15594967,132262,68599880,13,"I don't *think* we need this anymore, since we have the new Filter now.  What do you think?",469994053,2016-06-27 22:41:48
15594967,132262,68600237,15,"How about `ComplianceFilter`, and that way we can continue to stick things in here if we decide to put in more changes?  For example, we could consider moving the content length setting in HttpServerDispatcher here.",469994053,2016-06-27 22:43:23
15594967,132262,68600395,21,doing this silently makes it sort of difficult for our users.  we should probably either fail or log loudly (at least WARNING level).,469994053,2016-06-27 22:44:23
15594967,132262,68600479,19,"we prefer to avoid infix-style now, so if you could make this `service(request).map { rep =>` that would be appreciated ????",469994053,2016-06-27 22:44:53
15594967,132262,68600582,24,ditto here,469994053,2016-06-27 22:45:30
15594967,132262,68600923,36,why extend HeadFilter here?,469994053,2016-06-27 22:47:05
15594967,132262,68601239,7,"could you add a test for this filter too?  end to end tests are rad, but for finding new bugs quickly, nothing beats a tightly scoped unit test =)",469994053,2016-06-27 22:48:47
15594967,2458663,68778389,13,"AFAIU, (Http)ServerDispatcher#[handle](https://github.com/twitter/finagle/blob/finagle-6.35.0/finagle-core/src/main/scala/com/twitter/finagle/dispatch/ServerDispatcher.scala#L63) is called after all the filters are applied? In `handle()`, we add a Content",469994053,2016-06-28 22:20:17
15594967,2458663,68778831,15,"Yeah, good name! :+1:
Fixed it! ",469994053,2016-06-28 22:22:14
15594967,2458663,68779138,21,"Sure. Though I've added a log here in a new commit, (as you suggested) it might be better to just `fail` here instead of modifying and sending a message? So that users can notice that there's something wrong happening?",469994053,2016-06-28 22:23:38
15594967,2458663,68779227,19,Done! :grinning:,469994053,2016-06-28 22:24:03
15594967,2458663,68779382,36,"Oops, sorry my bad! Fixed it!",469994053,2016-06-28 22:24:45
15594967,2458663,68779631,7,"Sure, I've added the corresponding test! :D",469994053,2016-06-28 22:25:54
15594967,2458663,69144729,33,"Oops, I think I was wrong. As RFC 7230 section3.3.2 says, if we do want to send a Content-Length header field, we should return the Content-Length value of the cached content which has been returned to a client in a 200 response. I thought a value of Cont",471178520,2016-06-30 21:41:16
15594967,132262,69153261,33,"Oof, this doesn't feel like it's easy to know.  I guess this is something that users must set?  I guess it's better to just not modify the content length in this case.",471178520,2016-06-30 22:22:09
15594967,2458663,69160302,33,"> I guess this is something that users must set?

I think so if users really want to send the header field in a 304 response... I'm not sure how to _validate_ that they've chosen the _correct_ Content-Length value. As the RFC says, if the field-value do",471178520,2016-06-30 22:58:15
15594967,2458663,69314163,33,Fixed it :),471178520,2016-07-01 22:12:19
15594967,1925,69491268,13,I have the same question as @mosesn. What's the verdict here?,469994053,2016-07-05 04:00:12
15594967,2458663,69747686,13,"Hi @taylorleese  cc: @mosesn ,
I might be wrong but it seems like [handle(res: Reponse)](https://github.com/monkey-mas/finagle/blob/4002b80fe5b124459beaa8a3c8f364c3cb0762a2/finagle-http/src/main/scala/com/twitter/finagle/http/codec/HttpServerDispatcher.s",469994053,2016-07-06 22:01:53
15594967,1350674,72171637,13,"Hi @monkey-mas, I'm new to this code so feel free to let me know if what follows is incorrect!
I don't think that `handle(res: Response)` is called multiple times: it's responsible for writing the message to the wire so if it's called multiple times we'r",469994053,2016-07-26 07:49:30
15594967,2458663,73800501,13,"Hi @bryce-anderson,
Thanks for your advice! (and sorry for my late reply!) Well I think I don't fully follow your strategy, can you give me more details please?

> I do think you're right in that its going to be called after all the filters so in its c",469994053,2016-08-07 18:44:15
15594967,1350674,73806630,13,"TLDR: I've had some more time to think about it, and I'm not certain of an easy solution.

> Umm.. I think Content-Length header field is not set to 0 for a 204 response when there's no message-body. (But I think it's correct that the header field is ad",469994053,2016-08-08 01:24:57
15594967,2458663,73911627,13,"> Sorry, its not clear to me if we agree. I believe at a Response with an empty body will get assigned a content length header of length 0. I haven't added tags to the handle function to check, but a raw Response should not be chunked and will not have a ",469994053,2016-08-08 23:55:24
15594967,1350674,73915402,13,"I would definately wayt for @mosesn to chime in before going down the netty pipeline route. As a preview, I'll give my understanding of it. The code at https://github.com/twitter/finagle/blob/develop/finagle-http/src/main/scala/com/twitter/finagle/http/Co",469994053,2016-08-09 00:18:51
15594967,1350674,85767793,56,This doesn't cover the case of 1xx status codes that are not 100-Continue. Could we be inclusive of the whole range?,546051179,2016-10-31 22:48:24
15594967,1350674,85765181,6,"Reads a little strange to me. Maybe "".. Both rules are enforced even _if_ users intentionally add body data or the header field for these responses."" Maybe add something about logging violations as an error.",546051179,2016-10-31 22:37:38
15594967,1350674,85769703,47,I think we need a plan for dealing with chunked responses as well.,546051179,2016-10-31 22:56:21
15594967,1350674,85768565,65,"This has the same 1xx problem as above.
Maybe this is worth it, maybe its not, but it seems to me that this pattern match could be reused with a special case for `NotModified`. Eg
```scala
private def mustNotHaveLengthHeader(status: Status) = 
  statu",546051179,2016-10-31 22:51:41
15594967,1350674,85769057,22,Try to use `.headerMap` to remove netty types from the testing. It's also nice not to look for `null` in scala code. There are a few more instances of this below as well.,546051179,2016-10-31 22:53:45
15594967,1350674,85767223,50,"ffti: might be useful to say how many bytes were in the body. Then again, maybe not. ???? ",546051179,2016-10-31 22:46:05
15594967,1350674,85767032,48,"We are trying to phase out usage of netty types in our HTTP model so could we do a length check instead? Something like `if (rep.length > 0) {` would be good. That has the added benefit of avoiding the ambiguity of equality in Java (eg, does `!=` mean ref",546051179,2016-10-31 22:45:10
15594967,1350674,85769415,20,This could be `response.length` which is shorter and avoids netty types. A few more instances of this below.,546051179,2016-10-31 22:55:09
15594967,132262,85768777,126,cols <= 100 please,546051179,2016-10-31 22:52:39
15594967,132262,85768900,14,cols <= 100 please,546051179,2016-10-31 22:53:10
15594967,132262,85769896,89,cols <= 100 please,546051179,2016-10-31 22:57:17
15594967,132262,85770179,15,I have the same feedback as before about the structure of these tests.,546051179,2016-10-31 22:58:18
15594967,132262,85767619,119,please de-comment SwitchingProtocols,546051179,2016-10-31 22:47:33
15594967,132262,85767712,83,please de-comment SwitchingProtocols,546051179,2016-10-31 22:48:00
15594967,132262,85768679,125,does this need the NoBodyMessage feature?  or can we make this a regular test?,546051179,2016-10-31 22:52:11
15594967,132262,85768935,28,cols <= 100 please,546051179,2016-10-31 22:53:18
15594967,132262,85769025,63,cols <= 100 please,546051179,2016-10-31 22:53:34
15594967,132262,85768449,21,"I have a preference for small tests, do you mind structuring this differently so that the `test` clause is *inside* of the loop?  We can get around the duplicate names by string interpolating into the name of the test.",546051179,2016-10-31 22:51:15
15594967,132262,85768988,45,cols <= 100 please,546051179,2016-10-31 22:53:26
15594967,132262,85766697,59,cols < 100 please,546051179,2016-10-31 22:43:53
15594967,132262,85766806,51,cols < 100 please,546051179,2016-10-31 22:44:17
15594967,132262,85769803,6,"my suspicion is that this fails for ClientFailUpgradeTest because the client starts having issued an upgrade message, so it's expecting a 101 in response.  When it gets a 101, it expects upgrade headers, and netty will throw an exception if you don't have",546051179,2016-10-31 22:56:53
15594967,132262,85767996,48,please de-comment switching protocols,546051179,2016-10-31 22:49:14
15594967,2458663,85954135,47,"Do you mean we need a plan to conform to [RFC7230#section-3.3.1](https://tools.ietf.org/html/rfc7230#section-3.3.1) probably?
It says:
```
   A server MUST NOT send a Transfer-Encoding header field in any
   response with a status code of 1xx (Informa",546051179,2016-11-01 22:39:10
15594967,2458663,85954942,56,"Okay, I think you mean we need to validate `100 <= status code < 200` for 1xx condition check, correct? I thought it'd be enough to check Continue, SwitchingProtocols and Processing but (if you meant it) yes I think it's reasonable :)",546051179,2016-11-01 22:42:23
15594967,2458663,85955400,65,"Good point, thanks! I fixed the condition to check 1xx codes as well. WDYT?",546051179,2016-11-01 22:44:15
15594967,2458663,85956359,21,"Yeah, you're right. It's nice to have small tests! Hope my modification is what you suggested :)",546051179,2016-11-01 22:47:39
15594967,2458663,85957377,125,It seems like I misunderstood the concept of `Feature`. I defined `NoBodyMessage` to _pass_ some tests in finagle-http2 for example (by ignoring test cases?). What do you think I should've done here? :eyes: ,546051179,2016-11-01 22:52:17
15594967,2458663,85961999,6,"Your suspicion sounds reasonable to me. In that case, we might have _timeout_ error or exception?

> Do the tests work if you remove the 101 test from ClientFailUpgradeTest?

Yup, I think it works without 101 test. Currently, 101 test (finagle-http) a",546051179,2016-11-01 23:12:21
15594967,1350674,85977840,6,"@monkey-mas: you make tests conditional like this:

``` scala
testIfImplemented(FeatureName)(""name""){ assert(true) }
```

and you set what tests are implemented using the functions like this one: https://github.com/twitter/finagle/blob/develop/finagle-htt",546051179,2016-11-02 00:24:28
15774211,83701,70885208,86,"Let's split this up, it makes it clearer and easier to debug:

```
val probeStat = statsReceiver.counters.get(List(""probes""))
assert(probeStat.isDefined && probeStat.get >= 1)
```",477051893,2016-07-15 04:14:18
15774211,83701,70886159,58,"This comment isn't giving the reader any additional information, I think we can drop it.",477051893,2016-07-15 04:19:42
15774211,83701,70886411,26,"""The result of the subsequent request will determine...""",477051893,2016-07-15 04:21:02
15774211,83701,70886616,3,Is this used?,477051893,2016-07-15 04:22:11
15820384,1114008,71389011,13,"I don't think we need to capture, it's only used once.",478851443,2016-07-20 00:52:45
15820384,200065,71391026,13,"This is intentional.  Requests are mutable, and so I want to capture the keepalive state before the request is dispatched to a service that may, for instance, remove the Connection header to send it somewhere else.",478851443,2016-07-20 01:02:43
15820384,1114008,71392440,13,"Ah, gotchya!",478851443,2016-07-20 01:10:25
15820384,64314,71561278,13,`new Promise[Unit]` or `Promise[Unit]()` please,480085620,2016-07-20 23:41:48
15820384,72999,71563178,13,Do we need this val? I don't see we use it anywhere.,480085620,2016-07-20 23:53:05
15820384,200065,71596698,13,heh. think i copied this style from elsewhere in finagle because it surprised me. happy to standardize on new Promise ;),480085620,2016-07-21 03:06:17
15881853,132262,71001564,4,can you add a comment somewhere here that explains why it must be public so we don't make it private again?,482388494,2016-07-15 23:30:58
15949714,132262,73650413,4,I'm sort of confused.  what is this overriding?  `maxThriftBufferSize`?,485669559,2016-08-05 14:07:22
16312607,1114008,81411034,7,"Would you mind adding the TIMEOUT to these Awaits too, since you're modifying this test?",494593022,2016-10-01 03:21:18
16414687,64314,80151961,16,"for public methods, annotate with the return type",497138737,2016-09-23 05:38:53
16414687,64314,80150708,75,can you reduce the visibility?,497138737,2016-09-23 05:29:54
16414687,64314,80151354,29,why do we need to support both this and `thriftFinagleServiceFunctionMap`? (mind leaving a comment in the code as a response?),497138737,2016-09-23 05:34:25
16414687,64314,80150284,39,"style nitpick: move the `): Iface = {` down to the next line, indented to the same as the `def`.",497138737,2016-09-23 05:26:54
16414687,64314,80152069,14,explain why would you use this? i'm guessing its when you have a client that is talking to a multiplexed backend service?,497138737,2016-09-23 05:39:42
16414687,64314,80151659,98,ditto re NonFatal,497138737,2016-09-23 05:36:43
16414687,64314,80150559,68,mind omitting this and forcing these clients to specify a label? its for their own good ;),497138737,2016-09-23 05:28:57
16414687,64314,80151258,26,might be helpful to chain the Throw's exception in the failure case,497138737,2016-09-23 05:33:48
16414687,64314,80150489,60,lets do some scaladocs for these new `multiplex` methods.,497138737,2016-09-23 05:28:23
16414687,64314,80150846,14,"style nit, format for multi line class declarations:

```
class MyName(
    arg1: Type1,
    ...)
  extends ... {
```",497138737,2016-09-23 05:30:55
16414687,64314,80151643,79,"should probably only catch NonFatal's:

`case NonFatal(e) => Future.exception(e)`
",497138737,2016-09-23 05:36:34
16414687,64314,80151020,13,can you reduce visibility?,497138737,2016-09-23 05:32:19
16471833,132262,75898823,4,"It might be better to phrase this as ""we no longer support 2.10"" since we plan on adding 2.12 support when it comes out (which is hopefully soon).",498560896,2016-08-23 23:09:06
16636502,1350674,85556390,16,I really like that you've added a timeout: it seems it has been omitted from the other test cases in the suite.,504353358,2016-10-28 22:41:54
16636502,72999,90344505,22,Can you rebase your branch. I think it's called `body` in master.,568123946,2016-12-01 06:34:12
16670758,200065,76901251,5,"alternatively, we could track this as a single `pendingResponses` field (much like `activeStreams`).  I suppose this would be slightly better as it has no hope of overflowing",502941440,2016-08-31 06:49:50
16670758,72999,76901887,5,"FWIF, I'm voting for a single variable here (`activeRequests` or `pendingResponses`).",502941440,2016-08-31 06:55:23
16670758,132262,77402620,5,"since ConnectionManager can be used for both clients and servers, this might be better phrased as `pending` and we should add a note that for servers it goes negative instead of positive.",503010238,2016-09-03 02:48:31
16670758,132262,77403183,5,Can we also document the purpose of both `activeStreams` and `pending`?,503010238,2016-09-03 02:53:30
16670758,200065,77439966,5,@mosesn I don't quite understand... `pendingResponses` is always incremented in `observeRequest` and always decremented in `observeResponse`.  Isn't `pendingResponses` is an accurate name? Is there a situation where a response is observed before a request,503010238,2016-09-04 00:15:36
16670758,132262,77445927,5,"Ohhhhh . . . yeah, you're right.  Ignore me.",503010238,2016-09-04 09:42:42
17211324,120104,79588585,5,"@jcarres-mdsol I think the https://github.com/openzipkin/zipkin-ruby relies on this class, still. lemme know if my adjustment is not idiomatic",516205345,2016-09-20 18:25:37
17211324,132262,79628117,6,"why not keep doing this, but only use the last characters?",516205345,2016-09-20 21:45:31
17211324,132262,79626710,26,ffti: `c.isDigit`,516205345,2016-09-20 21:39:48
17211324,120104,79770183,6,"mainly as I noticed other performance related code in this type. retaining the last chars means a substring, which means another string. you're right, it is far less code to do it that way. wdyt?",516205345,2016-09-21 13:59:03
17211324,120104,79770362,26,"again, performance related.. the code I pasted benchmarks better. you'll find that isDigit unfolds into quite many things. no problem reverting to RichU64String, if you say go!",516205345,2016-09-21 14:00:45
17211324,120104,79771388,26,"here's the difference in the java variant:

if (c >= '0' && c <= '9') { 

Benchmark                                   Mode  Cnt   Score   Error   Units
UtilBenchmarks.lowerHexToUnsignedLong_128  thrpt   15  53.386 ± 1.810  ops/us
UtilBenchmarks.lowe",516205345,2016-09-21 14:10:08
17211324,755034,79818630,5,"I think we are good and this will work properly for us. It will work as expected, will read a string (which comes from the header) and create a SpanId class from it.",516205345,2016-09-21 19:13:26
17211324,132262,79868545,8,"in scala, we usually use `if (length <= 16) spanId else spanId.substring(length - 16)` as the ternary operator.",517007639,2016-09-21 22:57:07
17258660,72999,80094181,27,Not sure we need this blank line.,517158960,2016-09-23 00:34:40
17258660,72999,80096277,115,Please remove.,517158960,2016-09-23 00:44:15
17258660,72999,80098310,155,"Please, remove.",517158960,2016-09-23 00:52:47
17258660,72999,80098535,158,"Please, remove.",517158960,2016-09-23 00:53:45
17258660,72999,80097892,131,"Please, remove.",517158960,2016-09-23 00:51:00
17258660,72999,80097924,133,Don't need this.,517158960,2016-09-23 00:51:09
17258660,72999,80095313,53,Do we need both `fail`s?,517158960,2016-09-23 00:40:08
17258660,72999,80094834,66,Remove?,517158960,2016-09-23 00:37:45
17258660,72999,80094550,28,"No, it doesn't.",517158960,2016-09-23 00:36:18
17258660,72999,80098638,14,Can we backport the N4 test as well?,517158960,2016-09-23 00:54:12
17258660,72999,80095752,68,I think we need an extra match to cover non-downstream-channel events.,517158960,2016-09-23 00:42:10
17258660,72999,80098506,151,"It's it's fine - N3 is ""auto-read"" by default.",517158960,2016-09-23 00:53:37
17258660,72999,80095594,97,Remote address what?,517158960,2016-09-23 00:41:25
17258660,72999,80094671,23,Just feel free to remove this comment.,517158960,2016-09-23 00:36:49
17258660,72999,80094428,38,De-indent please.,517158960,2016-09-23 00:35:45
17258660,72999,80098264,145,You need to handle the success case here.,517158960,2016-09-23 00:52:35
17258660,72999,80096812,109,Let's not override it. I think we're ok assuming that nothing is writing into the pipeline on N3 until the connect future is satisfied.,517158960,2016-09-23 00:46:19
17258660,72999,80097837,123,You don't need it. Just use `connectFuture` (is what Finagle transport waiting on).,517158960,2016-09-23 00:50:44
17258660,72999,80095621,103,Remove?,517158960,2016-09-23 00:41:35
17258660,149050,80102452,97,I recall that it was `null` in some cases.,517158960,2016-09-23 01:12:33
17258660,72999,80318728,145,I think if you handle the success here you'd make it work with TLS/SSL.,517158960,2016-09-24 03:14:10
17292187,64314,80135567,8,did you consider `withHttpStats` as a name? cc @vkostyukov (here and below),517881766,2016-09-23 04:01:36
17292187,64314,80135744,12,"i know we haven't always done a good job in the past, but i'd like to have public methods and members have type annotations.
`val role: Stack.Role = ...`",517881766,2016-09-23 04:02:33
17292187,64314,80135851,17,"omit ""Register""?",517881766,2016-09-23 04:03:03
17292187,64314,80136554,19,omit `override`.,517881766,2016-09-23 04:06:31
17292187,64314,80135972,38,lets leave these hashrockets unaligned,517881766,2016-09-23 04:03:36
17292187,132262,80137080,21,we typically drop braces for single exprs.,517881766,2016-09-23 04:09:14
17292187,132262,80137723,22,"I don't think we want to have non-idempotent configuration methods on StackClients.  How about instead inserting a nop ""http stats"" module into the Http stack and then replacing it here?

It might also be useful to look at our design principles for conf",517881766,2016-09-23 04:12:35
17292187,132262,80136967,20,just two spaces please.,517881766,2016-09-23 04:08:39
17292187,149050,80176442,22,Good point. I'll also have a look at those principles.,517881766,2016-09-23 10:25:20
17292187,149050,80176505,8,Fair enough. I choose enable because there are no arguments passed in. Just like noFailFast.,517881766,2016-09-23 10:26:39
17292187,72999,80286886,14,"I honestly don't think we still need this `Req <: Request` type-param. *I think* we've done this before to support something we called ""rich http"" (which is now just `finagle-http`). Please, correct me if I'm wrong. /cc @mosesn @dschobel @roanta ",517881766,2016-09-24 00:16:32
17292187,72999,80286492,8,There is `noFailFast` on `Client/Server` (it's a client builder thing). We use `with`-prefixed methods here instead. And it's totally fine to have `with`-API w/o an argument (we do that all the time). See [Design Principles for the `with`-API](http://twit,517881766,2016-09-24 00:14:00
17292187,72999,80286542,8,"Also, please no `()`.",517881766,2016-09-24 00:14:21
17292187,132262,80305963,14,@vkostyukov I think you're right we don't need it here.,517881766,2016-09-24 01:57:50
17292187,149050,80360955,17,There are other descriptions of modules containing verbs. Why should it be gone here?,517881766,2016-09-24 20:38:32
17292187,149050,80361014,14,"I've put the type-param in there because the filter itself has it as well and limiting it in the module seemed strange. Additionally, our applications use types that inherit from `RequestProxy` so we actually like the presence of the type-param in the fil",517881766,2016-09-24 20:41:41
17292187,149050,80366903,8,Done,517881766,2016-09-25 02:11:59
17292187,149050,80366906,12,Done,517881766,2016-09-25 02:12:09
17292187,149050,80366909,19,Done,517881766,2016-09-25 02:12:17
17292187,149050,80366911,21,Done,517881766,2016-09-25 02:12:25
17292187,149050,80366915,38,Done,517881766,2016-09-25 02:12:31
17292187,64314,80512852,17,i guess we aren't consistent. lets leave as is.,517881766,2016-09-26 23:16:13
17292187,64314,80513184,4,lets add a sub heading explaining that they come from this Filter.,518992444,2016-09-26 23:17:54
17292187,64314,80513467,13,"for consistency with the rest of the file:
s/Metric/A histogram/",518992444,2016-09-26 23:19:14
17292187,64314,80513489,16,ditto,518992444,2016-09-26 23:19:19
17292187,64314,80513616,5,nit: we omit `override` for abstract methods,518992444,2016-09-26 23:20:01
17292187,64314,80513906,16,lets add a basic unit test that verifies these work as expected. something like a request populates at least one of the stats. same for the server side.,518992444,2016-09-26 23:21:27
17292187,64314,80592067,16,"sorry, should've noticed previously, please add that these two histograms are in milliseconds.",520113048,2016-09-27 06:00:00
17292187,72999,80596070,17,"Please, capitalize HTTP.",520145361,2016-09-27 06:31:12
17292187,72999,80596139,20,"Please, capitalize HTTP.",520145361,2016-09-27 06:31:52
17292187,72999,80596431,4,I think you can avoid defining a new type by just passing an `identity` function as a stack module - it should be implicitly converted. We do that in [a bunch of places](https://github.com/twitter/finagle/blob/develop/finagle-core/src/main/scala/com/twitt,520145361,2016-09-27 06:34:35
17292187,72999,80597319,15,"I still don't think you need this type-param.

Please, note that it has nothing to do with your custom HTTP types (either for request or response) since at that point they should be lifted to something Finagle can work with (i.e., `c.t.f.http.Request` a",520145361,2016-09-27 06:43:17
17292187,149050,80783096,15,Ok. I'll remove it.,520145361,2016-09-28 03:10:48
17292187,72999,80804808,4,*I think* you should be fine. There is an implicit conversion from `A => A` function to `Stackable[A]`.,520145361,2016-09-28 04:56:13
17292187,149050,80983709,16,Done,518992444,2016-09-29 01:18:39
17292187,149050,80983729,5,Done,518992444,2016-09-29 01:18:44
17292187,149050,80983752,16,Done,518992444,2016-09-29 01:18:52
17292187,149050,80983689,13,Done,518992444,2016-09-29 01:18:35
17292187,149050,80984476,4,I'm not seeing it. How would we assign a role to the identity function?,520145361,2016-09-29 01:22:02
17292187,149050,80783053,4,"Identity is only used in places where `stack.replace()` is used, not with `prepend()`, there is no prepend that takes both a role and a function. How do you recommend to do this?",520145361,2016-09-28 03:10:32
17340735,132262,80367546,14,"this doesn't memoize the counter, it will call statusReceiver every time.  note that the underlying and created maps are both immutable.",518988144,2016-09-25 02:47:36
17340735,132262,80369239,14,"I don't follow.  MemoizedSR decorates another SR, right?  Wouldn't that solve the problem here?  Why not just wrap the underlying SR with a MemoizedSR in the StatsFilter?",518988144,2016-09-25 04:41:28
17340735,149050,80371239,14,"Somehow I looked at the MetricsStatsReceiver instead of the MemoizedStatsReciever. I cannot find a MemoizedStatsReceiver in Finagle. I do find a Memoized in twitter-util, which is used by Finatra. Should we copy that solution to Finagle?",518988144,2016-09-25 07:00:29
17340735,132262,80374527,14,"Oh geez, it might not be open source.  Let me check if I just got the name wrong or if we haven't open sourced it yet.",518988144,2016-09-25 12:46:21
17340735,64314,80521371,14,@mosesn you got the name wrong *and* its not OSS-ed ???? ,518988144,2016-09-26 23:59:31
17340735,132262,80533406,14,lol double whammy.  @spockz let's go ahead with your original plan and just use a map.,518988144,2016-09-27 00:55:35
17340735,149050,80554462,14,"I tried using `Memoize` from twitter-util, which works. I've verified that by seeing the effect of println only once. However, I'm having issues verifying from the outside of `StatsFilter` that it actually works. `counter()` is being called twice for two ",518988144,2016-09-27 02:35:33
17340735,132262,80619869,35,"please use ==, instead of ===.  scalatest has an assert macro which does the right thing here.",520111620,2016-09-27 11:49:48
17340735,132262,80619777,11,"instead of appending to an existing test, can you add a new test?",520111620,2016-09-27 11:48:25
17340735,132262,80619813,29,I think if you don't mention `times(1)` it implies exactly once.,520111620,2016-09-27 11:48:59
17340735,149050,80673681,11,Sure,520111620,2016-09-27 18:47:14
17340735,149050,80673695,35,Sure,520111620,2016-09-27 18:47:20
17340735,132262,80820756,26,feel free to ignore: please add a timeout–we no longer use `Await.result` in our tests to avoid deadlocks.,520801773,2016-09-28 06:57:07
17340735,149050,80844216,26,Yes I was wondering about that. What is commonly used as timeout  value?,520801773,2016-09-28 12:13:53
17340735,132262,80955658,26,"ah, when I wrote ""we no longer use Await.result"" I meant unbounded Await.result.",520801773,2016-09-28 23:11:06
17340735,132262,80955536,26,5 seconds is fine.,520801773,2016-09-28 23:10:35
17340735,149050,80367664,14,"You are totally right!

Regarding the MemoizedStatsReceiver, I don't that would work with custom configured StatsReceivers, right? If the todo was to use the MemoisedStatsReceiver than this MR can be ignored. :)",518988144,2016-09-25 02:53:53
17360718,1350674,85006273,33,"This is more of a question than a concern, but is an empty `Host` header meaningful and/or legal per the spec? Adding a link to any relevant RFC would be a good touch, if it exists.",519548592,2016-10-26 04:33:20
17360718,1350674,85003508,16,Could we remove the default and be explicit? Its private code so I don't see any reason to be ergonomic about it.,519548592,2016-10-26 04:19:24
17360718,2477711,88249516,33,"I already added link to RFC in my commit. Here a quote from it:
```
 A client MUST send a Host header field in all HTTP/1.1 request
   messages.  If the target URI includes an authority component, then a
   client MUST send a field-value for Host that",519548592,2016-11-16 22:42:39
17360718,1350674,88287509,33,"Thanks for the clarification; this looks correct to me. By adding a link, I meant adding it as a code comment close to this logic in case others are interested in reading the spec in the future.",519548592,2016-11-17 01:32:12
17360718,1350674,88287605,4,Could you add a test that verifies that the Host header isn't overwritten if its already present?,519548592,2016-11-17 01:32:39
20089193,1350674,94629468,53,The timing here is a bit tight and might introduce some flakyness in this test case. Have you seen our `Time` api that allows you to manipulate the current time? See `Time.withCurrentTimeFrozen` etc. It's what we commonly use in finagle tests to introduce,590144945,2017-01-05 01:47:03
20089193,1350674,94627616,58,"I know this spec is inconsistent in this regard, but could you add a timeout to this `Await.result` call?",590144945,2017-01-05 01:36:08
20089193,616831,94759033,58,fixed,590144945,2017-01-05 20:25:51
20089193,616831,94760493,53,"Yes I have seen it, good idea! However, with the current test setup, advancing time isn't really required as `inetResolverWithPool.bind` will count down the latch one time immediately. In other words `pollInterval` isn't really used in the test. 

What ",590144945,2017-01-05 20:38:14
20089193,1350674,94800023,53,"I think the issue there is that `InetResolver` doesn't have a way to pass in a `Timer` and thus cannot use a `MockTimer`. It could be added as another constructor param, though that might not be worth it.",590144945,2017-01-06 00:28:01
20089193,616831,94805871,53,"True, so let's skip that test then. Out of curiosity, if I set the latch to `2` (remove the timeout in `await`) and send in a `pollInterval`, why does that never poll for updates?",590144945,2017-01-06 00:56:11
20089193,1350674,95050989,53,"Since we're not actually using the magic time features, maybe the `Time.withCurrentTimeFrozen(` isn't necessary. Sorry for the misdirection.

Regarding the latch, the `addr.changes.toFuture` call causes the polling event to get canceled after the `Futur",590144945,2017-01-07 11:21:12
20089193,616831,95119727,53,Removed `Time.withCurrentTimeFrozen`. Thanks for the hint regarding `addr.changes`.,590144945,2017-01-09 17:16:35
20089193,616831,95360203,53,@bryce-anderson changes are made,590144945,2017-01-10 21:12:42
20745990,132262,97854964,4,do you mind if we use the https url instead?,605185865,2017-01-26 03:11:35
20745990,2404880,97855451,4,Fixed,605185865,2017-01-26 03:13:32
21653627,132262,102593127,11,"we use CamelCase for constants, can you change this to Timeout?  an alternative would be to add an `await` method:

```scala
def await[A](a: Future[A]): A = Await.result(a, 5.seconds)
```",629425134,2017-02-23 06:36:38
22086713,132262,104936950,5,can you add a comment that explains why we do this?,640266923,2017-03-08 23:07:58
22086713,132262,104937332,5,"also, maybe we should call this `linkPendingCommands`  since that's its name going forward?  should be OK to break the API if you add a note to the CHANGES file.",640266923,2017-03-08 23:09:26
22086713,132262,105191651,15,can you also add a note that this is a breaking API change?  we've renamed pendingCommands to linkPendingCommands.,641119675,2017-03-09 23:33:56
22086713,66718,105910559,15,Already noted above in Line 112 to 115 under Breaking Changes,641119675,2017-03-14 20:44:28
22086713,132262,106005972,15,"ah, good point!  works for me.",641119675,2017-03-15 02:31:58
22614653,132262,107700616,4,please keep all of the imports sorted alphabetically,650285742,2017-03-23 22:29:55
22614653,132262,107703090,49,it would be nice to validate that pending actually increments.  how about adding a new filter in between StatsFilter and the service that throws the exception that checks that pending is 1.0?,650285742,2017-03-23 22:38:34
22614653,132262,107702421,15,"instead of adding all of this extra machinery to the `getService` method, we should just inline a new service.",650285742,2017-03-23 22:36:18
22614653,132262,107701469,40,"let's scope the try/catch block more narrowly.  I think we want to be able to reuse the behavior from the rest of the method, so how about we convert a `service(request)` that throws an exception into one that returns a failed future?  we could make this ",650285742,2017-03-23 22:32:43
22614653,132262,107719584,4,"sorry, do you mind sorting these with everything else?  as in, com comes before java, java comes before scala, etc.",650285740,2017-03-23 23:39:28
22614653,132262,107720272,38,can we also assert that this is failed?,650285740,2017-03-23 23:42:01
22614653,132262,107719948,33,"instead of chain, simply: `statsFilter.andThen(service)`",650285740,2017-03-23 23:40:52
22614653,132262,107720062,4,rm newline please,650285740,2017-03-23 23:41:14
22614653,132262,107720018,9,this is unused,650285740,2017-03-23 23:41:06
22614653,616831,107763420,49,yes sounds good. gonna add this tomorrow.,650285742,2017-03-24 02:32:06
22614653,616831,107763533,4,"no problem, will fix",650285740,2017-03-24 02:32:38
22614653,616831,107763563,4,will do,650285740,2017-03-24 02:32:46
22614653,616831,107764614,33,This is on purpose. If I use `andThen` then this is already [wrapping](https://github.com/twitter/finagle/blob/develop/finagle-core/src/main/scala/com/twitter/finagle/Filter.scala#L77) `NonFatal`'s. Which means that the test wouldn't trigger the problem w,650285740,2017-03-24 02:37:37
22614653,616831,107764666,38,"yes, will add it",650285740,2017-03-24 02:37:50
23086022,2240470,109703899,9,"fix example
https://twitter.github.io/finagle/guide/FAQ.html 

old: https://twitter.github.io/finagle/docs/#com.twitter.finagle.CancelledRequestException

new: https://twitter.github.io/finagle/docs/com/twitter/finagle/CancelledRequestException",662248604,2017-04-04 22:57:01
23132408,132262,109961786,21,"should be:

`if (future.isSuccess) {`",663114248,2017-04-05 23:19:29
23132408,132262,109962295,25,no space between `})`.,663114248,2017-04-05 23:21:32
23132408,132262,109963696,86,"I think we're missing a `+` here, so I don't think the label will be applied.",663114248,2017-04-05 23:27:26
23132408,132262,109963117,30,"indentation for classes should be like

```
case class ClassName(
    arg1: Arg1,
    arg2: Arg2)
```

so that each argument is indented by four spaces.",663114248,2017-04-05 23:24:56
23132408,132262,109962126,21,"we should make sure we handle non-success cases (interrupt, failure) gracefully here.

also, is it possible this will hang?  if I remember correctly, the sslhandler has a default timeout of 10 seconds?  is that right?",663114248,2017-04-05 23:20:54
23132408,132262,109962395,19,no space between `(new GenericFutureListener[NettyFuture[Channel]] {`,663114248,2017-04-05 23:21:56
23132408,132262,109962846,3,please sort the java.* with the rest of the imports.  we don't treat any imports specially.,663114248,2017-04-05 23:23:49
23132408,132262,109964251,96,can we test what happens when the ssl handshake doesn't finish successfully?,663114248,2017-04-05 23:29:47
23132408,132262,109961612,18,"spacing here should be:

`if (sslHandler != null) {`",663114248,2017-04-05 23:18:47
23132408,132262,109964690,66,"how about making a `class Ctx` and shoving this server in there?  that way we can write our tests like:

```
test(""some test stuff"") {
  val ctx = new Ctx()
  import ctx._
  server.blahblahblah()
  ....
}
```

and each test will have its own se",663114248,2017-04-05 23:31:27
23132408,132262,109964079,108,"please add a timeout to the Await, so that if we introduce a regression the test doesn't hang.",663114248,2017-04-05 23:29:07
23132408,132262,109963393,71,do you mind using a match instead of a fold here?  I think it's a bit more legible.,663114248,2017-04-05 23:26:02
23132408,72999,109973900,16,"Is there a way to make it a separate channel handler? I guess my question is can we ""delay"" channel init?",663114248,2017-04-06 00:11:32
23132408,845649,109983442,16,"Not really, if I understand your question correctly. `initChannel` will be called if `channelRegistered` event is triggered or a `ChannelInitializer` is added to a pipeline of a registered channel.",663114248,2017-04-06 00:51:01
23132408,72999,109984332,16,Oh I think we can delay `channelRegistered` then given that `channelInit` is [just a fancy version of it](https://github.com/netty/netty/blob/4.1/transport/src/main/java/io/netty/channel/ChannelInitializer.java#L73-L84). What do you think?,663114248,2017-04-06 00:54:19
23132408,845649,109985519,21,"If I understand [netty code](https://github.com/netty/netty/blob/1419f5b601ec7f50938a5e745ec2312f881a580f/handler/src/main/java/io/netty/handler/ssl/SslHandler.java#L1397) correctly, it is not necessary for netty4. `SslHandler` will shutdown `SSLEngine` a",663114248,2017-04-06 00:58:55
23132408,845649,109985699,21,"Yes, default timeout is 10 seconds.",663114248,2017-04-06 00:59:22
23132408,72999,110001233,5,"I guess when we'll actually delay the `ChannelTransport` creation, the peer certificate will be available at the moment this constructor fires and yet I still think it should be `def`, not `val`.  I like this more by two reasons.

1. I'd imagine that se",663114248,2017-04-06 02:02:55
23132408,845649,110007321,16,"Ok, I believe now I finally understand what do you mean :). So you are suggesting to implement a server `SslConnectHandler` and delay `channelRegistered` in it? It should be possible, but we also will have to change `ServerBridge` to be a handler.",663114248,2017-04-06 02:31:18
23132408,72999,110014109,16,"Exactly! Although, I don't understand why we'd need to touch ``ServerBridge`. It's a ChannelInitialize right now that [essentially an InboundHanlder](https://github.com/netty/netty/blob/4.1/transport/src/main/java/io/netty/channel/ChannelInitializer.java#",663114248,2017-04-06 03:02:45
23132408,845649,110015283,96,There is not much we can test in case of failed handshake - netty handles everything in case of failure. ,663114248,2017-04-06 03:08:39
23132408,845649,110015758,16,"Yes, but `channelInit` also will be called when we add `ServerBridge` to the pipeline in our case: https://github.com/netty/netty/blob/4.1/transport/src/main/java/io/netty/channel/ChannelInitializer.java#L99",663114248,2017-04-06 03:11:01
23132408,72999,110016857,16,Oh interesting. It looks like [we change the `isRegistered` flag on a channel before firing the `channelRegistered` event](https://github.com/netty/netty/blob/4.1/transport/src/main/java/io/netty/channel/AbstractChannel.java#L502-L509). You're totally rig,663114248,2017-04-06 03:16:04
23132408,845649,110019196,16,"Yes, making server bridge `ChannelInboundHandler` and moving code from `channelInit` to `channelRegistered`. 
Could you help me understand why if I change `ServerBridge` like this:
```scala
  def initChannel(ch: Channel): Unit = {
    val sslHandler =",663114248,2017-04-06 03:26:16
23132408,72999,110020791,16,"How do you know it never happens? This looks pretty reasonable to me. As far as I remember, the handshake is initiated on either `channelActive` or `handlerAdded`. Here you're attaching the handshake listener on `channelRegistered`, but it shouldn't matte",663114248,2017-04-06 03:33:30
23132408,845649,110027263,16,"handshake times out when I'm running the test from this PR.  Just to be explicit - the only change I did is also delaying `transportFac(ch)`.
Yes, client initiates handshake on `channelActive`",663114248,2017-04-06 04:02:12
23132408,845649,110107104,16,"@vkostyukov I think I figured it out - we are using backpressure, so channel's auto read is set to `false`.  Means `transportFac(ch)` cannot be delayed",663114248,2017-04-06 15:41:44
23132408,845649,110166102,16,"Here is an [alternate implementation](https://github.com/koshelev/finagle/commit/b86a94c669ef91148283435be00e95e13b48811a), with a handler deferring the `channelRegistered` event. As we still need ChannelTransport, it will be added in `handlerAdded`. As c",663114248,2017-04-06 20:50:43
23132408,72999,110207781,16,Interesting. I'm pretty sure SslHandler should work just fine with auto-read is disabled. Maybe it's b/c we're not issuing an initial `read` given that `ChannelTransport` is not instantiated? If so I think it's a bug in Netty and we should file a ticket a,663114248,2017-04-06 23:27:05
23132408,845649,110214955,16,Do you mean `SslHandler` should issue an initial read?,663114248,2017-04-07 00:01:08
23132408,72999,110215041,16,"Oh yeah, absolutely. And if it doesn't it's a bug.",663114248,2017-04-07 00:01:34
23132408,845649,110234698,16,"I'm not so convinced :). Why should it, if we explicitly configured channel do not read any data  unless we explicitly tell it to do so. And `SslHandler` has no idea, if we want to serve the channel or not.
But anyway, the workaround you suggested seems ",663114248,2017-04-07 01:30:04
23132408,72999,110261783,16,Sweet! Just let us know once you update this PR so we can have another look.,663114248,2017-04-07 03:38:48
23132408,72999,110275505,13,Why we need this? If that's to prevent init to be called maybe we should just rebrand it as a plain `InboundChannelHandler` to be explicit about what we want?,664190299,2017-04-07 04:47:40
23132408,72999,110275316,19,Let's just do `ctx.channelRegistered`.,664190299,2017-04-07 04:46:29
23132408,72999,110275213,4,Maybe put it in its own file? Also rename `SslConnectHandler` to `SslClientConectHandler`?,664190299,2017-04-07 04:45:49
23132408,72999,110275275,9,I guess we can't issue this read on `channelRegistred`?,664190299,2017-04-07 04:46:11
23132408,72999,110307796,9,"Also, please do `ctx.read()` instead.",664190299,2017-04-07 09:45:26
23132408,845649,110335143,9,"I believe we can't. `channelRegistered` signals that channel is registered with an `EventLoop`, `channelActive` signals that it is possible send and receive data.",664190299,2017-04-07 14:54:11
23132408,845649,110337785,13,"Yes, it is to prevent init to be called.
I also was considering to rebrand it, but after closer look at the sources of `ChannelInitializer` it seems like we will have to duplicate a lot of its code. So I decided the overriding `handlerAdded` is lesser of",664190299,2017-04-07 15:11:54
23132408,72999,110436573,16,"I'm still not sure why we need this. Also, how does `channelInit` work given that it's now `ChannelInboundHandlerAdapter` and not `ChannelInitializer`?

How do you feel about creating a channel transport on `channelActive` (in this server bridge) and de",664541087,2017-04-08 00:06:30
23132408,845649,110442206,16,"OMG, have no idea how it is landed into PR.

I think it is a good idea! Updated PR",664541087,2017-04-08 00:35:52
23132408,1114008,110449241,54,nit: Import & use FunSuite directly,664899129,2017-04-08 01:08:48
23132408,1114008,110455868,5,"we use a slightly different style here:

    private[this] def addHandlersToPipeline(
      pipeline: ChannelPipeline,
      sslHandler: SslHandler,
      sslConnectHandler: SslServerConnectHandler
    ): Unit = {
",664899129,2017-04-08 01:41:33
23132408,1114008,110449321,53,This annotation isn't necessary anymore and can be removed.,664899129,2017-04-08 01:09:12
23132408,1114008,110449841,128,Can you also add a timeout here?,664899129,2017-04-08 01:11:45
23132408,1114008,110454866,23,"clump all of the imports together, they can be friends",664899129,2017-04-08 01:36:39
23132408,35556,111460907,102,"You should be able to just use the Client Configuration here. Something like ...

.withTransport.tls(SslClientConfiguration(
  keyCredentials = KeyCredentials.CertAndKey(new File(clientCert.cert()), new File(clientCert.key())),
  trustCredentials = Tr",664982023,2017-04-14 01:50:15
23132408,35556,111460378,80,"Please change to use the Netty4ServerEngineFactory instead. Something along the lines of

val config = SslServerConfiguration(
  keyCredentials = KeyCredentials.CertAndKey(new File(serverCert.cert()), new File(serverCert.key()),
  trustCredentials = T",664982023,2017-04-14 01:47:43
23132408,2558984,169358250,5,"hello,

was this merge? i don't see it on 18.1.0 nor on develop",663114248,2018-02-20 23:38:35
23157604,132262,110191114,12,"shouldn't this be on the apply method, not the object?",663526052,2017-04-06 22:22:12
23157604,1026143,110206778,12,"Oh, exactly.
I've tried to fix it, and got compile error.

```
[error] /Users/zaneli/ws/finagle/finagle-core/src/main/scala/com/twitter/finagle/Dtab.scala:267: @tailrec annotated method contains no recursive calls
[error]       def apply(s: String): ",663526052,2017-04-06 23:23:02
23347202,35556,133326462,11,"Please make this Future => NettyFuture. Since it's the Twitter codebase, Future within it almost always means Twitter Future.",760696543,2017-08-16 06:10:45
23347202,35556,133327374,163,"Change mkClient to just take hostname: String instead of hostname: Option[String] here, so that it's not necessary to calling hostname.get later.",760696543,2017-08-16 06:16:34
23347202,35556,133325430,23,Please move this to a file named `SniSupport.scala` in the same directory.,760696543,2017-08-16 06:03:41
23347202,35556,133325213,31,"Undo this change please. If you would like to add this outside the context of this pull request, we can discuss it in a separate PR.",760696543,2017-08-16 06:02:12
23347202,35556,133325710,29,implicit val param: Stack.Param[SniSupport] = Stack.Param(SniSupport(None)),760696543,2017-08-16 06:05:36
23347202,35556,133327240,159,SniSupport(Some(serverCerts.mapValues(mkConfig))),760696543,2017-08-16 06:15:41
23347202,35556,133326655,22,promise.setSuccess(mapping.get(hostname)),760696543,2017-08-16 06:11:40
23347202,35556,133325604,23,"For `mapping`, I believe we should use `Option[Map[String, SslServerConfiguration]]` instead.
None means the parameter is off.
Some(sniMapping) is a mapping from hostnames to SslServerConfigurations",760696543,2017-08-16 06:04:58
23347202,35556,133326015,93,"    private[this] def addSniHandler(
      channel: Channel,
      factory: SslServerEngineFactory,
      sniMapping: Map[String, SslServerConfiguration]
    ): Unit = {
      ...
    }",760696543,2017-08-16 06:07:46
23347202,35556,133325795,82,Remove,760696543,2017-08-16 06:06:15
23347202,35556,133326202,111,"    val SniSupport(mapping) = params[SniSupport]

    mapping match {
      case Some(sniMapping) =>
        addSniHandler(ch, factory, sniMapping)
      case None => 
        ...
    }",760696543,2017-08-16 06:08:53
23347202,35556,133325130,25,"Undo this change please. If you would like to add this outside the context of this pull request, we can discuss it in a separate PR.",760696543,2017-08-16 06:01:37
23347202,35556,133326570,17,"mapping: Map[String, SslServerConfiguration]",760696543,2017-08-16 06:11:17
23347202,35556,133325740,41,private[ssl],760696543,2017-08-16 06:05:54
23347202,35556,133327654,201,Please change from 300 seconds to something more reasonable.,760696543,2017-08-16 06:18:22
23347202,35556,133325271,19,"Undo this change please. If you would like to add this outside the context of this pull request, we can discuss it in a separate PR.",760696543,2017-08-16 06:02:36
23347202,35556,133325628,27,Remove,760696543,2017-08-16 06:05:05
23347202,35556,133327536,191,This test failed for me until I removed the newline.,760696543,2017-08-16 06:17:37
23347202,35556,133327450,181,"30 seconds seems much too long, please reduce.",760696543,2017-08-16 06:17:05
23347202,35556,133327186,151,"    keyCredentials = KeyCredentials.CertAndKey(serverCert.certificate(), serverCert.privateKey()),
    trustCredentials = TrustCredentials.CertCollection(clientCert.certificate())",760696543,2017-08-16 06:15:17
23347202,35556,133325188,17,"Undo this change please. If you would like to add this outside the context of this pull request, we can discuss it in a separate PR.",760696543,2017-08-16 06:02:03
23347202,845649,133475692,23,"`String => TwitterFuture[Option[SslServerConfiguration]]` is more flexible, IMO. `Option[Map[String, SslServerConfiguration]]` implies the mapping is static and keys and certificates are available locally. For instance, it is not true in our case. We have",760696543,2017-08-16 22:00:32
23347202,845649,133751905,23,@ryanoneill WDYT?,760696543,2017-08-17 22:44:41
24405105,132262,116092558,23,can we add a test for a long that's bigger than what scala can fit into a long?,690925583,2017-05-12 03:23:29
24405105,132262,116092474,15,"this won't work for longs bigger than 2^63, right?  should we add a field to LongValue that we're encoding an unsigned long in a signed long?  or add a new type, UnsignedLong?",690925583,2017-05-12 03:23:05
24405105,132262,116091198,4,"these should be styled like:

```
/**
 *
 */
```",690925583,2017-05-12 03:16:54
24405105,3359873,116095448,23,sth like: 9223372036854775808 ?,690925583,2017-05-12 03:36:21
24405105,3359873,116099898,15,I didn't get. Longs bigger than 2^63 has Type.LongLong instead of Type.Long.  Should we use isUnsigned check for Type.LongLongs too?,690925583,2017-05-12 03:55:27
24405105,132262,116113591,23,that would be perfect =),690925583,2017-05-12 05:06:36
24405105,132262,116114298,15,"well, unsigned longs have the same number of bits as signed longs, they're just encoded differently, so we could conceivably encode them as signed longs in scala.  it's just a design decision.  I don't think it would make sense to make them LongLongs, sin",690925583,2017-05-12 05:10:31
24405105,3359873,116114938,15,"ok then, just to clarify. I am using isUnsigned for Type.LongLong too and add another test case for that, right?",690925583,2017-05-12 05:14:33
24405105,132262,116115418,15,"not exactly.  suppose mysql wants to return an unsigned long of 9223372036854775808 (as we talked about below).  ""9223372036854775808"".toLong fails.  How do we do this properly?  Note that mysql will consider it a long, not a longlong.",690925583,2017-05-12 05:17:33
24405105,3359873,116116406,15,"The thing is in order to store 9223372036854775808 in a column of MySQL Table, that column should be bigint. If the field is bigint then its type is Type.LongLong. Then, I guess adding another value type, let's say, BigIntValue and another function to Mys",690925583,2017-05-12 05:24:15
24405105,132262,116116604,15,@mehmetgunturkun I don't think that's the case.  The column should be able to be unsigned long.  Note that 9223372036854775808 fits in 8 bytes if you're using unsigned longs.,690925583,2017-05-12 05:25:35
24405105,3359873,116118561,15,"Yeah and if the data type of the column in MySQL, is unsigned long then the type of the field in finagle side is Type.LongLong. 

BTW by saying 
> The column should be able to be unsigned long
You mean BIGINT UNSIGNED, right. Is there a data type long",690925583,2017-05-12 05:39:46
24405105,132262,116119587,15,"yes, there's a Long type, that's the field that we match on in this code.  although reading more, I think it's actually 4 bytes, not 8 bytes.  but I'm really starting to think that all of the numeric values that we get out of mysql, we should annotate whe",690925583,2017-05-12 05:46:22
24405105,3359873,116120583,15,"I think so too because the unsigned logic applies to all numeric values. 

Think about **smallint** if it is unsigned it can go until 65535 in MySQL side, but we are converting it to **Short** which has 32767 as a MaxValue.",690925583,2017-05-12 05:53:48
24405105,3359873,116331853,15,"Hey @mosesn, should I write and send the new version that includes all numerical fields with isUnsigned check?",690925583,2017-05-13 04:58:29
24405105,132262,116346879,15,sounds good to me!,690925583,2017-05-13 08:18:16
24405105,132262,116855924,20,can we add a comment as to why we're doing this?,692069228,2017-05-17 03:58:02
24405105,132262,116856014,24,we can merge ones where it doesn't matter if it's signed or not,692069228,2017-05-17 03:58:22
24405105,3359873,116857194,20,Yeah sure.,692069228,2017-05-17 04:03:36
24405105,3359873,116857474,24,"Ok, I thought it might be good to see all cases in discrete.",692069228,2017-05-17 04:04:44
24405105,3359873,116859722,20,"I assumed that you're talking about isSigned logic, right? If it is, should I write comments for BinaryEncodedRow too?",692069228,2017-05-17 04:14:10
24405105,132262,116872415,20,"that would be rad, but I think if you add the helper method you described, that will document it well enough.",692069228,2017-05-17 05:20:42
24405105,3359873,116872707,20,"That helper method might need implicit parameters, is that OK? Some project might have rules likes ""do not use implicits"" so I want to ask.",692069228,2017-05-17 05:22:35
24405105,72999,116873392,7,"Both of these seem generally useful. Maybe we should move them under `ByteReader`, where we have O(1) get? ",692069228,2017-05-17 05:27:07
24405105,3359873,116874428,7,"Sure, it is under twitter/util repo, right?",692069228,2017-05-17 05:34:04
24405105,1114008,117035766,7,Yup: https://github.com/twitter/util/blob/develop/util-core/src/main/scala/com/twitter/io/ByteReader.scala,692069228,2017-05-17 22:32:32
24405105,83701,117535810,8,is this unused?,692069228,2017-05-20 00:42:18
24405105,83701,117536342,24,"I like them explicit too, tbh.",692069228,2017-05-20 00:44:41
24405105,3359873,117545708,8,"I have added for debugging actually but left as is, it might be helpful.",692069228,2017-05-20 01:27:30
24405105,1114008,119472560,28,"Some style nits for ya that I missed earlier:

We typically leave parens off of these types of methods (both defining and calling) unless they mutate in some way. Since this doesn't, please omit here and in isSigned",692069228,2017-06-01 04:00:07
24405105,1350674,119693427,62,"Fun fact: this has been broken for a while: we should not be reading a 4 byte int for the Int24 type, but only 3 https://dev.mysql.com/doc/refman/5.7/en/integer-types.html. This isn't a problem with this PR per say, just what we've been doing wrong for a ",705224107,2017-06-02 01:28:02
24405105,1114008,126481820,4,"Looks like an unfinished comment.

Fun side note, this broke github's syntax highlighting",732373016,2017-07-11 00:10:20
24405105,1114008,126481954,28,stray print,732373016,2017-07-11 00:11:02
24405105,1114008,126482381,8,Assert that the BigInt being written can indeed fit in 8 bytes. (Unless this is verified somewhere else that I can't see),732373016,2017-07-11 00:12:58
24405105,1114008,126482046,8,stray,732373016,2017-07-11 00:11:28
24405105,3359873,126510435,8,You mean remove TODO part (Line 51) or remove comments for unsigned test cases? ,732373016,2017-07-11 02:10:08
24405105,3359873,126513426,8,"Are you suggesting checking the size of the array, to be sure that it is shorter than or equal to 8?",732373016,2017-07-11 02:24:20
24405105,1114008,126525438,8,"Yeah, since (AFAICT) BigInt could store values that would be larger than 8 bytes.",732373016,2017-07-11 03:18:56
24405105,3359873,126531110,8,"what if it is larger than 8, take first 8 bytes or throw an exception?",732373016,2017-07-11 03:42:18
24405105,1114008,126531987,5,"haha awesome commit message :)

Sorry, I didn't mean to suggest that a comment was necessary here, only that there was a stray ""/**/""",733939390,2017-07-11 03:45:53
24405105,1114008,126533436,8,"I think throwing is the way to go. I'd rather have that then write invalid data.
@bryce-anderson what say you?",732373016,2017-07-11 03:51:36
24405105,3359873,126534574,5,"Sorry, I miswrote that, that should have been ""a sane comment""  :)",733939390,2017-07-11 03:56:05
24405105,1350674,126535513,8,"I think a `throw` is fine in this case, although I don't know where that exception will surface off hand. Also, I think you need to make sure you write *exactly 8 bytes* and right now you will write less in the majority of cases:
```scala
scala> BigInt(",732373016,2017-07-11 03:59:50
24405105,3359873,126540470,8,"I can create an array of bytes in size of 8 and fill it in little endian order, is that ok?",732373016,2017-07-11 04:21:51
24405105,1350674,126547434,8,"Sure, that or just pad with 0's via `.writeByte(0x0)`.",732373016,2017-07-11 04:56:13
24405105,1114008,127511942,10,"Can you create a new named exception for this (can define it somehwere in the file here). I suggest something like:
`
class BigIntTooLongException(size: Int) extends Exception(s""BigInt is stored as an unsigned long and thus cannot be grater than 8 bytes",735274289,2017-07-15 00:50:10
24405105,1350674,127820531,87,"`Type.Int24` and `TypeInt24 if signed need to call `reader.readMediumLE()` and `reader.readUnsignedMediumLE()`, respectively.",737790999,2017-07-18 03:46:12
24405105,1350674,127858346,17,I think we need to reverse the order of the bytes we read out of `byteArray`: the `BigInt.toByteArray` method returns the bytes in big-endian order.,739245662,2017-07-18 07:22:31
24405105,3359873,127922140,17,"Yeah, sorry I should have checked that - sending the fix.",739245662,2017-07-18 16:13:12
24405105,1114008,128056257,43,Is this ready to be uncommented now?,739523089,2017-07-19 01:23:45
24405105,3359873,128062638,43,"Honestly, not sure how to set `ignoreUnsigned` flag for StringEncodedRow and BinaryEncodedRow.

`class StringEncodedRow(rawRow: Buf, val fields: IndexedSeq[Field], indexMap: Map[String, Int], val ignoreUnsigned: Boolean = true) extends Row
class Binary",739523089,2017-07-19 01:49:43
24405105,1350674,128556021,43,"You're going to need to make an way to configure the `Client` to operate in 'support unsigned' mode. This will entail making a `Stack.Param` and threading the boolean all the way through. Which will be a bit of a pain, but it is what it is. I'd remove the",739523089,2017-07-20 22:52:25
25506273,193897,122097933,62,I wonder if we shouldn't just mark `dispatch` as final and leave `pipeline` as the extension point since sequencing responses is fundamental to pipelining. wdyt?,714937588,2017-06-15 07:44:17
25506273,193897,122097497,56,please add some docs,714937588,2017-06-15 07:40:40
25506273,193897,122098132,123,`final` ? we can always open it up later if the need arises,714937588,2017-06-15 07:45:52
25506273,193897,122098136,126,"ditto, `final`?",714937588,2017-06-15 07:45:54
25506273,193897,122097525,58,please add some docs,714937588,2017-06-15 07:40:52
25506273,1184,122111101,62,"I hesitated to do that and didn't similar to how `apply` is not final in `GenSerialClientDispatcher`. I figured that most use-cases would only need to override `pipeline`, but potentially more complex ones would need to override `dispatch` as well. I don'",714937588,2017-06-15 10:04:44
25506273,193897,122253927,4,rm space please,715087541,2017-06-15 23:50:23
25506273,193897,122252720,112,`log` can stay private I believe,715087541,2017-06-15 23:45:34
25506273,193897,122253962,18,"ditto, no space",715087541,2017-06-15 23:50:33
25506273,193897,122253087,118,I think this one can be private as well,715087541,2017-06-15 23:47:07
25506273,193897,122253149,130,docs please,715087541,2017-06-15 23:47:22
26377854,1114008,126772204,6,"Make a case class for (Double, Double, Buf) instead of a tuple for clarity",734454796,2017-07-12 01:31:50
26377854,1114008,126774919,89,How about we avoid nulls here and just use Option directly?,734454796,2017-07-12 01:43:13
26377854,72999,126830777,51,"You can inline `Buf.Utf8(lon)` in this pattern matching to get the string out of `BulkReply(lon)`. This way, you won't need to call  `BufToString` later.",734454796,2017-07-12 06:09:49
26377854,72999,126830826,59,Similar question about `JDouble`.,734454796,2017-07-12 06:10:06
26377854,72999,126829829,19,Why this has to be Java `Long`?,734454796,2017-07-12 06:02:53
26377854,72999,126830917,70,I'd prefer this w/o nulls. Also why `JDouble`?,734454796,2017-07-12 06:10:49
26377854,72999,126831028,159,"Please, inline `Buf.Utf8()` extractor instead.",734454796,2017-07-12 06:11:27
26377854,72999,126830853,61,Please inline `Buf.Utf8()` extractor here.,734454796,2017-07-12 06:10:23
26377854,72999,126830640,46,Why using Java `Double`s?,734454796,2017-07-12 06:08:41
26377854,72999,126831189,119,"What do you think about `GeoUnit.Meter`, `GeoUnit.Mile`, etc?",734454796,2017-07-12 06:13:00
26377854,1355396,127558488,119,"It's good. I've named like these as described in Redis document, but I'll modify",734454796,2017-07-15 05:11:34
27395580,1114008,132596669,35,"add something like ""for UPDATE and INSERT ... ON DUPLICATE KEY UPDATE type statements""",756543536,2017-08-11 06:54:29
27395580,1114008,132596558,8,Add a link to relevant mysql docs please.,756543536,2017-08-11 06:53:20
27676102,72999,148676796,24,How do we know `\n` follows `\r`? I don't see a check for that.,783386982,2017-11-03 05:27:19
27676102,118768,148786398,24,Its an assumption from the protocol: https://redis.io/topics/protocol#bulk-string-reply,783386982,2017-11-03 20:51:33
28889114,120104,140246060,64,For compat maybe better to add another spanid for high bits vs expand spanid to 128,788589581,2017-09-21 20:49:03
28889114,12573,141632962,71,"I switched over to my open IntelliJ to start looking at a different area of Finagle, unrelated to this PR, and this file was open.  I remembered that these were previously `toLong`, and here I have changed them to `self`. I wasn't even thinking about the ",793663359,2017-09-28 21:24:00
28889114,1350674,142442111,118,"Can we make a named case class to return these `SpanId`'s instead of using a `Tuple2`? I would have expected the low bytes to come first, but it's just a state of mind thing so giving it a name would make it unambiguous.",793663359,2017-10-03 22:48:19
28889114,1350674,142453437,69,"Also an aside,  but I'm surprised we don't have a `TraceId.Empty` instance laying about.",793663359,2017-10-03 23:30:36
28889114,1350674,142442550,122,Can you use the `if / else` block to form the whole `SpanId` instead of just the substring? That would make the match below unnecessary.,793663359,2017-10-03 22:49:49
28889114,1350674,142456829,6,"Can we do this as part of this PR? Outside of Twitter, thrift is the most heavily used RPC protocol, so it would be a shame to not have it.",793663359,2017-10-03 23:43:27
28889114,1350674,142448229,37,See comment above in Id.scala.,793663359,2017-10-03 23:10:37
28889114,1350674,142446372,166,See comment above about removing this and just using the constructor param.,793663359,2017-10-03 23:03:37
28889114,1350674,142453191,66,An aside: this is so close to being `id.copy(spanId = spanId)` but I'm worried about the subtle differences in `def traceId` etc.,793663359,2017-10-03 23:29:40
28889114,1350674,142446091,94,"Why not `Option[SpanId]` instead of `Long`? Looks like your putting a `Some(SpanId(0L))` into the `TraceId.apply` below due to this (same in Trace.scala). Is this the only situations where you would expect to find a `SpanId` of 0? If so, lets do `_traceId",793663359,2017-10-03 23:02:27
28889114,1350674,142439535,70,"Can we gate the size of the array to 32 if `!traceId.traceIdHigh.isDefined`. Otherwise, even if services are using the 64-bit trace-ids, they will need to have received this patch in order to support tracing.",793663359,2017-10-03 22:39:34
28889114,1350674,142448092,28,"Do we ever feel that we're going to have even more bytes? If the protocol supports evolving by appending more fields, it would make sense to just ensure we have enough bytes but not care if there are extra at the tail that we don't understand. That said, ",793663359,2017-10-03 23:10:06
28889114,1350674,142449472,62,"I'm not an expert, and this isn't part of this change, but I recall a comment by @adriancole saying that a span-id of 0 is not valid, but it's possible that this `rng.nextLong()` could give us a 0. Is that only true in the high bits?",793663359,2017-10-03 23:15:26
28889114,1350674,142456248,13,"`Treq` is dead to us: its only used for backward compatibility so I don't think a TODO is necessary. A note that we're not going to support 128-bit trace id's in `Treq` is enough. If someone upgrades, which they'd need to do to support the 128-bit trace i",793663359,2017-10-03 23:41:09
28889114,1350674,142447677,24,"Not part of your change, but it's really disappointing that this is essentially a duplicate of `TraceId.deserialize` other than the bytes representation the function receives. Other than we cache a 40 byte thread-local Array[Byte] in this method, we could",793663359,2017-10-03 23:08:25
28889114,12573,142459350,70,"I had thought about doing this as well, but I wasn't sure if which would be the correct approach. I'll make the change.",793663359,2017-10-03 23:53:45
28889114,1114008,142477391,8,could you please revert this?,793663359,2017-10-04 01:04:26
28889114,1114008,142480863,28,"IMO, this is OK for now. I tried to get some kind of ""state of the union"" view of where tracing is heading and came up with nothing conclusive in 10 minutes - we'd have to do some serious digging to answer this question, I think.",793663359,2017-10-04 01:17:41
28889114,1114008,142482824,85,I think this would be nice in the scaladoc instead of a comment,793663359,2017-10-04 01:24:37
28889114,1114008,142481497,13,Agreed.,793663359,2017-10-04 01:19:54
28889114,1114008,142478289,4,please revert,793663359,2017-10-04 01:07:53
28889114,1114008,142482188,71,I suggest leaving it as toLong for clarity,793663359,2017-10-04 01:22:21
28889114,12573,142555799,8,"Yeah man. I had copy/pasted the entirety of SpanId to overwrite a previous commit in which I attempted to extend all spans to 128-bit. My IDE settings auto-formatted to these changes on save, and I didn't catch it.  I also didn't catch the differing inden",793663359,2017-10-04 07:08:33
28889114,1114008,142556044,8,"Ugh, what a pain :/",793663359,2017-10-04 07:10:22
28889114,12573,142556241,118,Thanks. I meant to mark that as another question (conventions for creating one-off case classes like this) but forgot to mention it in the PR.,793663359,2017-10-04 07:11:50
28889114,1114008,142557874,8,"Ah sounds like a pain :/

I'm not too familiar with intellij, but I did some poking around and I found that we have some kind of Twitter scheme for code style here and that I could export it as XML. This is a totally unofficial solution and I'm not gonn",793663359,2017-10-04 07:25:33
28889114,12573,142565553,94,"The reason I did it this way with the special cased 0L, is that systems requiring 128bit traces may be padded with zeros. On my team at Expedia, we hacked the 64bit trace ids to fit our tracing system by transforming the traces generated by Finagle into a",793663359,2017-10-04 08:44:28
28889114,120104,142566046,70,"In rest of zipkin we treat lack of traceIDHigh as unset. There's no binary format at the moment, and at some point there will be. However, here I think it is important to remain in ""compat mode"" with 32byte context when there's no traceIdHigh (or it is ze",793663359,2017-10-04 08:49:18
28889114,12573,142568563,118,"Was just getting around to this, and remembered a major part of the question. I wanted to call that case class just ""TraceId"", but this is already taken from the case class encapsulating the traceId, parentId, spanId, etc. In other implementations, I thin",793663359,2017-10-04 09:17:36
28889114,12573,142572743,6,"@bryce-anderson I commented on this in the discussion part of the PR, but it's probably gotten buried. I tried using thrift 0.9 and 0.10 (both installed via homebrew) to regenerate tracing.thrift using the commands at the top of the file, and these result",793663359,2017-10-04 10:06:11
28889114,120104,142574567,118,"if this were a java builder, I would just say something like `TraceId.Builder.parseTraceId(String)` or similar, which internally sets one of the two. Maybe you could consider making a constructor of TraceId which takes a string form of TraceId and interna",793663359,2017-10-04 10:29:47
28889114,12573,142574858,62,"`ThreadLocalRandom.current().nextLong(1,Long.MaxValue)` could provide non-zero positive values, but as I understood it all longs are valid _except_ 0.",793663359,2017-10-04 10:33:41
28889114,120104,142575026,62,"traceIdHigh is invalid as non-zero for sure (though using the aws-convertable scheme I mentioned, it is impossible to end up with a zero traceIdHigh unless you are tracing 1970 :) ).",793663359,2017-10-04 10:36:23
28889114,120104,142575139,62,"one thing to bear in mind is that negative is needed or else you won't get full random. if trying to avoid 0, you can loop while nextLong == 0. This is unlikely to loop twice",793663359,2017-10-04 10:37:44
28889114,1350674,142697150,118,"I agree that the naming is now confusing at best, but don't think its something that should be addressed in this PR. If we want to take the easy route out of this, how about `SpanId128`. Might want to rename the method as well, since it seems (at least to",793663359,2017-10-04 22:02:01
28889114,1350674,142701871,62,"For simplicity, I'd vote for looping while `nextLong == 0`. Another alternative, but one that is probably more work and not worth it, is 
```
var spanId = ThreadLocalRandom.current().nextLong(Long.MinValue, Long.MaxValue - 1)
if (0l <= spanId) {
  spa",793663359,2017-10-04 22:17:02
28889114,1350674,142702137,6,"We use old thrift, libthrift-0.5. ☹️ ",793663359,2017-10-04 22:17:54
28889114,12573,147307747,37,"My reply to your referenced comment is kinda hidden now. I think this was the last PR feedback, so I wanted to follow up.

If 0L isn't converted to None via the getter in `Trace`, this will allow propagation of invalid 128 bit TraceIDs (such as a string",793663359,2017-10-27 08:47:28
28889114,64314,147830993,23,nit: include the type `: TraceId128` for public members,820739770,2017-10-31 03:51:18
28889114,64314,147831709,96,"can you include `bytes.length` in the failure? it can be helpful for debugging. something like:

`Throw(new IllegalArgumentException(""Expected 32 or 40 bytes, was: "" + bytes.length))`",820739770,2017-10-31 03:53:48
28889114,64314,147831575,84,another nit: space after `if`,820739770,2017-10-31 03:53:16
28889114,64314,147832536,157,same nit with whitespace after `if`,820739770,2017-10-31 03:57:02
28889114,64314,147832981,75,"feel free to ignore, but i think you can tighten it up:
```
var nextLong = rng.nextLong()
while (nextLong == 0L) {
  nextLong = rng.nextLong()
}
```",820739770,2017-10-31 03:58:39
28889114,64314,147831006,5,nit: is this a stray whitespace addition?,820739770,2017-10-31 03:51:21
28889114,64314,147832361,103,same nit re space after `if`,820739770,2017-10-31 03:56:20
28889114,1114008,147867356,42,nit - space after if,820739770,2017-10-31 07:03:44
28889114,12573,147874652,5,"Yeah man, this IntelliJ setting (as well as format on save) keeps getting reset when I reopen IntelliJ and the change has snuck past me a few times now.

I'll edit the whitespace changes in vim. Thanks for point it out. Sorry about that.",820739770,2017-10-31 08:07:18
31446190,120104,151971051,19,ps I added this check because in the file and noticed we were burning some headers for no benefit.,842152757,2017-11-20 19:54:08
36856879,64314,177242348,5,"seems good, especially about avoiding the reverse dns lookup.

i'll see about getting this merged.",955172175,2018-03-27 04:34:57
38853122,132262,192375730,7,"s/,and/, and",999459882,2018-06-01 19:08:03
38853122,7605529,192465518,15,Let's keep this Status subtitle.,999459882,2018-06-02 00:37:11
38853122,150462,193634223,15,"@yufangong sure, will do.",999459882,2018-06-07 13:09:05
38853122,7605529,194570575,13,Please add another new line to be consistent with other subtitles.,1038382835,2018-06-12 05:46:33
38904327,64314,186531452,19,same here for scaladoc and naming.,1000542525,2018-05-08 02:57:46
38904327,64314,186530372,14,"perhaps a similar comment here on naming, but i defer to @ryanoneill ",1000542525,2018-05-08 02:53:34
38904327,64314,186530854,5,style nit: please revert lining up of the `=>`s (here and below),1000542525,2018-05-08 02:55:29
38904327,64314,186529403,15,"i think the naming pattern in this file would make this method be called ""keyManagerFactory`.",1000542525,2018-05-08 02:50:07
38904327,64314,186530734,18,same sentiment here on the name,1000542525,2018-05-08 02:55:05
38904327,64314,186531791,16,"how hard is this? 

i defer to @ryanoneill ",1000542525,2018-05-08 02:59:06
38904327,64314,186531563,6,how can we answer this?,1000542525,2018-05-08 02:58:13
38904327,64314,186530450,15,lets fill this comment in.,1000542525,2018-05-08 02:53:51
38904327,149050,186545202,18,Calling this class `KeyManagerFactory` as well makes it clash with the argument type. I'm ambivalent in overriding names like that especially when making it usable from Java which does not have import renaming.,1000542525,2018-05-08 03:48:13
38904327,35556,186562389,5,Remove blank line.,1000542525,2018-05-08 04:51:53
38904327,35556,186560758,15,+1,1000542525,2018-05-08 04:44:17
38904327,35556,186567100,15,KeyManagerFactory,1000542525,2018-05-08 05:14:47
38904327,35556,186561724,3,Remove blank line.,1000542525,2018-05-08 04:48:39
38904327,35556,186562164,6,It's a good question. This was written before native engines supported TrustManagerFactor[ies]. Part of the comment is now wrong.,1000542525,2018-05-08 04:50:39
38904327,35556,186566836,16,"I'm not sure how many certs are generally in a KeyManagerFactory when it's used. I'm on the fence about whether it's worth adding.

My understanding is that you would need to do the following:
1. Create a `KeyManager` from the `KeyManagerFactory`. kmf.",1000542525,2018-05-08 05:13:30
38904327,35556,186564091,2,How about leaving this comment as 'TrustCredentials.Unspecified does not change the builder.',1000542525,2018-05-08 04:59:26
38904327,35556,186560935,3,Remove blank line.,1000542525,2018-05-08 04:45:10
38904327,35556,186564256,2,"I think we'll want to eventually change this, but it shouldn't need to happen in the same review.",1000542525,2018-05-08 05:00:07
38904327,35556,186562444,14,TrustManagerFactory,1000542525,2018-05-08 04:52:07
38904327,35556,186560870,14,+1,1000542525,2018-05-08 04:44:51
38904327,35556,186560525,3,Please sort the imports.,1000542525,2018-05-08 04:43:10
38904327,35556,186561840,19,Same. Remove extra blank line above the scaladoc definition.,1000542525,2018-05-08 04:49:12
38904327,35556,186561686,5,+1,1000542525,2018-05-08 04:48:28
38904327,35556,186560833,3,Please sort imports.,1000542525,2018-05-08 04:44:41
38904327,35556,186567229,18,Can you separate this out into a separate TrustManagerFactory test?,1000542525,2018-05-08 05:15:30
38904327,35556,186568591,1,getTrustManagers and checkTrustCredentialsNotSupported seem to be missing necessary changes.,1000542525,2018-05-08 05:22:32
38904327,35556,186568125,18,Can you add a test for this to SslConfigurationsTest?,1000542525,2018-05-08 05:20:15
38904327,35556,186567356,5,Remove blank line.,1000542525,2018-05-08 05:16:15
38904327,35556,186567429,6,Remove,1000542525,2018-05-08 05:16:38
38904327,35556,186567311,26,KeyManagerFactory,1000542525,2018-05-08 05:15:58
38904327,35556,186561550,18,"Considering that there are already specific Java compatibility classes (*Config.java), is it still an issue to name it `KeyCredentials.KeyManagerFactory`?",1000542525,2018-05-08 04:47:57
38904327,149050,186647611,15,Done,1000542525,2018-05-08 15:08:55
38904327,149050,186763947,16,I have not added the test. Depending on how the KeyManagerFactory is constructed the check is already performed there.,1000542525,2018-05-08 22:13:27
38904327,35556,187459568,21,Please undo the spacing change.,1002968706,2018-05-11 04:03:14
38904327,35556,187458908,24,Please update to the renamed version.,1002968706,2018-05-11 04:00:16
38904327,35556,187459221,5,Please undo the spacing change here.,1002968706,2018-05-11 04:01:42
38904327,35556,187459020,14,Thanks,1002968706,2018-05-11 04:00:44
38904327,35556,187460554,13,"Can you add a note to the comments for this method that indicates that unlike Cert/Key Cert/Key/Chain, that using KeyManagerFactory does not ensure that the certificates contained within the KeyManagerFactory are not expired.",1002968706,2018-05-11 04:07:21
38904327,35556,187458563,14,Remove the '@see' line.,1002968706,2018-05-11 03:59:00
38904327,35556,187459511,13,Please move the '=>' back near the closing parenthesis.,1002968706,2018-05-11 04:02:55
38904327,35556,187459634,29,Please move the '=>' back near the closing parenthesis.,1002968706,2018-05-11 04:03:30
38904327,35556,187460614,29,"Can you add a note to the comments for this method that indicates that unlike Cert/Key Cert/Key/Chain, that using KeyManagerFactory does not ensure that the certificates contained within the KeyManagerFactory are not expired.",1002968706,2018-05-11 04:07:33
38904327,35556,187459920,32,Remove. I think it's ok to not do this.,1002968706,2018-05-11 04:04:42
38904327,149050,187696107,14,Okay. Why don't we use `@see`?,1002968706,2018-05-12 01:26:43
38904327,35556,187697754,14,"TBH, I'm not sure which is better, but I'd prefer it to be consistent for now.",1002968706,2018-05-12 01:32:44
44120722,193897,210659491,6,"even though finagle-netty3 isn't going to be around much longer, we should mention that this option is netty4 specific",1102625130,2018-08-16 23:23:24
44120722,428674,210662483,6,okay will do!,1102625130,2018-08-16 23:33:43
44120722,193897,210679381,27,"does SO_REUSEPORT make sense on the client side?

the ci logs (https://travis-ci.org/twitter/finagle/jobs/416903070) show a lot of instances of

`WARNING: Unknown channel option 'io.netty.channel.unix.UnixChannelOption#SO_REUSEPORT' for channel '[id: ",1103378517,2018-08-17 00:31:05
44120722,428674,211339189,27,"agree, it should be removed",1103378517,2018-08-21 00:12:50
44120722,428674,211343491,27,@dschobel do you want me to just ignore the presence of this setting in `ConnectionBuilder`? ,1103378517,2018-08-21 00:25:58
44120722,428674,211344598,27,"Actually, along the same lines, would it be preferable if I only add the option if `nativeEpoll.enabled` is true? ",1103378517,2018-08-21 00:29:22
44120722,193897,211365111,27,both sound like the right call to me.,1103378517,2018-08-21 01:35:43
45023472,132262,214536706,5,It's usually pretty unusual and baseDtab changes this late in the game.  how about we keep `baseDtab` a field until someone needs it?,1119514786,2018-09-02 18:10:18
48098692,72999,227486887,5,Maybe keep using a single `StorageUnit` parameter and set it to `min` between the two on the call-site?,1176397753,2018-10-24 00:18:33
48098692,72999,227486375,13,"What about the client side? Here is how it looks today:

```
// 8 KB is the size of the maxChunkSize parameter used in netty3,
       // which is where it stops attempting to aggregate messages that lack
       // a 'Transfer-Encoding: chunked' heade",1176397753,2018-10-24 00:17:08
48098692,72999,227488338,13,"Thinking about this more, it seems we shouldn't probably use the `maxRequestSize` here at all and just introduce a separate parameter for it instead.

I like @luciferous' suggestion. And I would go with `minChunkSize` as a parameter name.

```
Http.s",1176397753,2018-10-24 00:22:46
48098692,921650,227493170,5,"I agree. I'm reworking this code right now and came to the same conclusion.

Initially I wasn't sure, if we can set maxContentLength to 0 and still retain all the features.
Now I looked carefully in the code, and it seems, that the only case when we re",1176397753,2018-10-24 00:35:34
48098692,921650,227495953,13,"I had no intention to implement client side, but I'm open doing this if you think we need that. I do not know, however, what is the behavior right now, and what it should be. Would need to investigate.

`minChunkSize` is a bit confusing for me.
In gene",1176397753,2018-10-24 00:43:28
48098692,198588,227497324,13,"Let's go with `minChunkSize` for now, if we think of something better during the review we can always change it.",1176397753,2018-10-24 00:47:03
48098692,72999,227498667,13,"I think we should change the client-side too as, otherwise, `Http.client.withStreaming(true, 128.kb)` would mean the `minChunkSize` is silently ignored.",1176397753,2018-10-24 00:50:50
48098692,921650,227514019,13,"I implemented your suggestions on the server-side (had to force push — I noticed that my feature branch been branched from the master).

I need some time to figure out how exactly the client-side should be changed.",1176397753,2018-10-24 01:32:50
48098692,921650,227522556,13,"@vkostyukov , just to clarify.

It seems that in your last message you assume that we already did changes to API but did not modify pipeline creation code.

While in fact I didn't change the API. Signature of the`Http.client.withStreaming` is the same",1176397753,2018-10-24 01:57:16
48098692,72999,227526401,13,"Oh you're right. I miss-remembered that `withStreaming`  configuration API is shared between client and server. I think that's fine then. It's ok not to be symmetric there (looks like we never were).

Perhaps wait for more people to chime in w.r.t. clie",1176397753,2018-10-24 02:08:26
48098692,198588,227529836,13,"Given a client `Http.client.withStreaming(true, minChunkSize = 128.kilobytes)`, what does it do when it receives a response from the server with `Content-Length: 512KB`?

Does it mean that given `loop`,

```
def loop: Future[Unit] =
  response.reade",1176397753,2018-10-24 02:19:01
48098692,921650,227543049,13,"@luciferous, I don't know the answer, but I'll reply just because I want to understand this too and I hope someone will correct me if I'm wrong.

First of all, I don't think there's `flatMap` method on `Reader`, you likely missed the call to `read` in y",1176397753,2018-10-24 03:02:07
48098692,72999,227546610,13,"It seems to me what no matter how we name it, there is still some buffering happens (at least today) for messages with known `Content-Length`. We can surely document what `minChunkSize` applies to. I'd imagine, setting `minChunkSize = 0` would effectively",1176397753,2018-10-24 03:13:21
48098692,198588,227552500,13,"> First of all, I don't think there's flatMap method on Reader, you likely missed the call to read in you code.

@edio Yes, that correct, sorry for any confusion.

> IDK if my understanding is correct, but this is exactly my concern with the name minC",1176397753,2018-10-24 03:31:21
48098692,921650,227553177,13,"@vkostyukov, buffering indeed may happen, but not in `FixedLengthMessageAggregator`.
Aggregator's buffering is all-or-nothing: we either buffer all message into a huge buffer up to `maxContentLength` or we bypass the aggregator, and emit chunks of data a",1176397753,2018-10-24 03:33:23
48098692,72999,227557860,13,"Okay, I'm convinced. Sorry for the confusion, I think I mis-understood what `FixedLengthMessageAggregator` does. `bufferSize` seems reasonable but, still, could be interpreted as ""buffer my chunks pls"".

Perhaps something as verbose as `aggregateIfLessT",1176397753,2018-10-24 03:46:47
48098692,198588,227560617,13,I don't have any better ideas. `aggregateIfLessThan` works for me.,1176397753,2018-10-24 03:55:18
48098692,921650,227561144,13,"@luciferous 
small clarification
> `bufferSize = 128.kilobytes`: buffer up to 128.kilobytes; `Reader.read` will ALWAYS return `buf` where `buf.length <= 128.kilobytes`

if 
* bufferSizez is very small. For example `bufferSize == 100.bytes`
* request",1176397753,2018-10-24 03:56:45
48098692,198588,227563492,13,"OK, I'm not sure I follow, but hopefully some test/docs will clarify. I'll think about it more too.",1176397753,2018-10-24 04:03:23
48098692,921650,227570030,8,"@luciferous , here's my attempt to explain this class. Please let me know if this makes any sense.",1176648627,2018-10-24 04:23:56
48098692,72999,227581129,15,What's the difference between HTTP chunk and chunk? What's so special about HTTP chunk besides being an N bytes?,1176714504,2018-10-24 05:01:23
48098692,72999,227583352,22,"I think this could be improved. Perhaps:

""The `maxContentLength` determines when to aggregate chunks and when to bypass the message as is. Only sufficiently small messages (smaller than `maxContentLength`) are aggregated.""",1176714504,2018-10-24 05:08:45
48098692,921650,227603516,15,"I'm not sure, that exactly ""http chunk"" phrase is defined anywhere, but at least what I mean by chunk in the context of HTTP chunked encoding is a part of http message body, enclosed in `<content length>\r\n` and `\r\n` as specified by chunked encoding fo",1176714504,2018-10-24 06:51:18
48098692,72999,227608493,15,"I understand your reasoning now, thanks for taking time to explain!

Maybe ""not to be confused with chunks as in `Transfer-Encoding: chunked`"" would make this easier to grok?",1176714504,2018-10-24 07:22:34
48098692,72999,227611221,15,"One interesting thing is, from what I read, Netty never really cares how chunks are formatted on the wire (think HEX prefix w/ a chunk size) and [just shoves whatever is available (think part of an actual chunk) into the pipeline](https://github.com/netty",1176714504,2018-10-24 07:41:37
48098692,921650,227611759,15,"That's an interesting find! I didn't know that. Thanks

Maybe for someone who's more familiar with netty than me, the meaning of _chunk_ is clear and I'm just trying to workaround my ignorance here :smile: ",1176714504,2018-10-24 07:45:26
48098692,72999,227615594,15,"As we have little to no control over how Netty decodes HTTP streams, we usually just refer to a chunk (HTTP chunk to be precise) as whatever Netty gives us in `HttpContent`.

Also, I appreciate your patience with this. I'm really excited about this PR!",1176714504,2018-10-24 08:14:29
48098692,72999,227904806,20,"@bryce-anderson and I are talked about this. It seems like we need to keep `maxRequestSize` in place as it's also get passed to a supper class, `FinagleHttpObjectAggregator`, which in turn, takes care about handling oversized messages (think HTTP 413). Ch",1178291636,2018-10-25 01:18:50
48098692,72999,227907474,38,Let's make it a separate method. Java doesn't understand default arguments.,1178291636,2018-10-25 01:26:05
48098692,921650,227908487,20,"I may be missing something, but I think, we do not need new parameter.

If message is bigger than `aggregateIfLessThen`, then there's nothing to aggregate. Messages fully bypass this handler.

Your concern would be valid if we used `FinagleHttpObjectA",1178291636,2018-10-25 01:28:29
48098692,72999,227914632,20,"Oh the `shouldAggregate` check. Yeah, I think you're right.

Maybe it's worth mentioning in the scaladoc for `withStreaming` method that `aggregateIfLessThan` could be replaced with `maxRequestSize` if the later is smaller.

Also, what do you think ab",1178291636,2018-10-25 01:44:03
48098692,921650,227929400,20,"> Maybe it's worth mentioning in the scaladoc for withStreaming method that aggregateIfLessThan could be replaced with maxRequestSize if the later is smaller.

Sorry, I'm not sure I follow.
To my understanding, `maxRequestSize` limits request size and ",1178291636,2018-10-25 02:29:35
48098692,921650,227933006,20,"> We can't omit the handler completely if maxContentLength == 0 because it handles also 2 cases that are not impacted by maxContentLength:

On the other hand, if developer enables streaming, `isChunked == true` should be expected. IDK, honestly. This is",1178291636,2018-10-25 02:41:21
48098692,72999,227933438,20,"Yeah, I'm with you on the understanding front. What I mean is, when users configure `withStreaming(true, 10.mb)` they expect fixed-length messages up to 10mb to be aggregated. Yet, as we take min between max-request-size and aggregate-if-less-than`, we ac",1178291636,2018-10-25 02:42:46
48098692,921650,227935171,20,"Ok, I got it now! Will do the fix a bit later today. Hopefully together with some new e2e tests.",1178291636,2018-10-25 02:48:17
48098692,198588,227848013,7,"Thinking more about this, an 8KB default may be a reasonable default here. What do people think?",1178291639,2018-10-24 22:44:06
48098692,198588,227921185,38,"????

Also what do you think of using `AggregateIfLessThan.aggregateIfLessThan.default` instead of `zero`",1178291636,2018-10-25 02:03:58
48098692,198588,227936802,20,"I think I prefer if we prioritize `Http.withStreaming` parameters over the `maxRequestSize`, i.e. `maxRequestSize` is ignored when `aggregateIfLessThan > 0`. It changes behavior, but I'm concerned about complicating configuration for the user. To me, this",1178291636,2018-10-25 02:53:07
48098692,72999,227939535,20,I don't think we should ignore it. There is `PayloadSizeFilter` that would reject payloads bigger than a max-size so it doesn't really make sense to aggregate more than that anyway.,1178291636,2018-10-25 03:01:36
48098692,72999,227939751,7,"Yes, I like 8kb.",1178291639,2018-10-25 03:02:20
48098692,921650,227992375,38,"I'll take this occasion to offer once again different name for the property. I promise it's the last time I'm raising this :)

`withAggregateIfLessThan`
con: does not suggest in any way, that it is realted to streaming
con: while it is very verbose an",1178291636,2018-10-25 06:24:19
48098692,72999,228022656,38,"I like all of those names but I'm still in the ""we should group this new config with `withStreaming`"" camp. As the new value only takes affect when streaming is enabled, we might want to keep them together (one configuration entry and perhaps one stack pa",1178291636,2018-10-25 10:11:33
48098692,921650,228026079,38,"Ugh, I misunderstood about separating a method.
Apparently you suggested an overloaded version of `withStreaming`...",1178291636,2018-10-25 10:40:43
48098692,72999,228027336,38,"Oh yeah, sorry I if I wasn't clear. Basically we're trying to ensure our APIs are accessible from Java which, unfortunately, means saying no to default arguments.",1178291636,2018-10-25 10:52:16
48098692,72999,228039699,7,"@luciferous talked about using 8k for a default value here. I liked that at first but maybe we're better off preserving the current ""default"" behavior and using 5.mb as a value?",1179132875,2018-10-25 12:39:16
48098692,72999,228039561,35,Love these docs! Ty!,1179132875,2018-10-25 12:38:08
48098692,198588,228258952,7,Sounds good.,1179132875,2018-10-26 00:09:13
48098692,72999,228360100,7,@edio This thread.,1179132875,2018-10-26 05:48:55
48098692,1350674,228389871,62,"Maybe forward this to the named method:
```suggestion
        .withStreaming(enabled)
```",1180187273,2018-10-26 09:27:34
33906,5101,561157,4,should just use shorthand here: `/../g`,3942962,2012-03-15 07:14:38
33906,5101,561188,12,"this function seems pretty fragile. For example you're not escaping single quotes. 

Also, couldn't this whole thing could be done with a regexp?

something like:

`.replace(ESCAPER, '\\$1')`

I'm a little nervous about accepting this pull request.",3942962,2012-03-15 07:22:44
61715,2548,1189223,57,This calls scope.get twice.,4401112,2012-07-18 21:09:51
93778,5101,698891,5,we should conditional provide the name of the module for when people output multiple definitions to a single file,330388,2012-04-18 06:10:55
93778,28589,698899,5,"Well, according to AMD best practices, you shouldn't export them into
one file. I don't know how many people do that anyways though. :/

Sent from my iPhone

On Apr 17, 2012, at 21:10, Jacob Thornton
<reply@reply.github.com>
wrote:

>> @@ -101,7 +101,7 @@",330388,2012-04-18 06:12:34
93778,5101,699257,5,"the hogan.js -> hogan still doesn't make sense to me (sorry, might be being dense). But we distribute hogan as ""hogan.js"" on npm - not as hogan. In node you require hogan as `var Hogan = require('hogan.js')`. I therefore think that hogan should stay as ho",330388,2012-04-18 09:19:33
93778,28589,701415,5,"**Edit:** My original statement is void. I slightly misread before writing it. :)

And regarding the module name, I think this may just need to be an option that can be passed through. Make `hogan.js` the default, but give me the option to change it for",330388,2012-04-18 19:43:07
285813,5101,583901,11,not sure how much you care about min with compiler.js - but it would be probably better to do something like `var tagTypes = Hogan.tags = ...` so that everywhere below where you ref `Hogan.tags` it can be minified,330478,2012-03-21 11:58:43
285813,5101,583908,96,"unless i'm missing something (nyquil) i think we could move `instructions.push(token)` out of the condition and to the bottom of the loop, as it's done on line 209, 222, and 224 (and 219 returns)",330478,2012-03-21 12:05:04
285813,5101,583914,118,are you doing joins for speed here? Should we be doing joins everywhere? Or do you just think it's cleaner instead of having `var partials = ''` and `partials +=`,330478,2012-03-21 12:08:09
285813,5101,583917,66,should we hoist this to the top?,330478,2012-03-21 12:10:09
285813,5101,583919,188,also seems odd for this to be here to me - but your call :),330478,2012-03-21 12:10:30
285813,5101,583924,207,your indent is off by 1 character n00b,330478,2012-03-21 12:12:29
285813,5101,583932,277,`func && func()` ftw,330478,2012-03-21 12:14:49
285813,5101,583934,290,"```js
return [ text, !!options.asString, !!options.disableLambda ].join('||')
```",330478,2012-03-21 12:15:42
285813,5101,583954,207,if i could favorite a function...,330478,2012-03-21 12:25:06
285813,2548,586218,66,put it here near where I use it. Will put it at the top if you insist.,330478,2012-03-21 22:50:08
285813,2548,586259,96,indeed.,330478,2012-03-21 22:55:59
285813,2548,586265,118,Just using join() so I don't have to mess with commas and loop counters.,330478,2012-03-21 22:57:24
285813,2548,586270,188,"Again using it right below, but will move it if everyone thinks it's weird.",330478,2012-03-21 22:58:10
285813,2548,586276,207,"are you new to reddit, or have you been on there since 2011?",330478,2012-03-21 22:59:22
285813,2548,586288,277,fixed,330478,2012-03-21 23:01:00
285813,2548,586296,290,fixed,330478,2012-03-21 23:01:53
285813,5101,586392,95,oh crap - globals? nice catch,330472,2012-03-21 23:17:04
1125243,5101,1120341,1,can you remove these from your pull request - thanks!,29462505,2012-07-09 11:19:37
1125243,5101,1120352,6,"Could you reorder the options to be the variable size - and clean up the white space after the colons
```js
'namespace': String, 
'outputdir': path, 
'variable': String, 
'wrapper': String, 
'version': true,
'help': true
```",29462505,2012-07-09 11:23:20
1125243,5101,1120355,25,there should be two new lines before each comment,29462505,2012-07-09 11:24:14
1125243,5101,1120360,47,looks like you're missing a space before the colons after the variable options,29462505,2012-07-09 11:25:08
1125243,5101,1120364,56,leave this on 1 line please,29462505,2012-07-09 11:25:53
1125243,5101,1120365,65,leave this \n,29462505,2012-07-09 11:26:08
1125243,5101,1120368,91,please follow the comment style in the rest of the document,29462505,2012-07-09 11:26:29
1125243,5101,1120377,81,"maybe rewrite this as:

```js
return (options.variable || 'templates') 
  + '[""' + name + '""] = new Hogan.Template(' 
  + hogan.compile(openedFile, { asString: 1 }) 
  + ');';
```",29462505,2012-07-09 11:29:57
1125243,5101,1120382,119,"```js
options.variable || 'templates'
```",29462505,2012-07-09 11:32:26
1125243,5101,1120390,95,"```js
return (options.namespace || '') + name;
```",29462505,2012-07-09 11:33:49
1125243,5101,1120393,1,what's this?,29462505,2012-07-09 11:34:29
1125243,5101,1120397,104,maybe rename `withNS` to just `namespace`,29462505,2012-07-09 11:35:07
1125243,69719,1120399,1,Sorry. It's trash. My bad.,29462505,2012-07-09 11:35:24
3796369,5101,13356898,6,do you want to make these just log? rather then noops? doesn't really matter tho,116578164,2014-06-04 01:23:56
10278296,4130694,67143779,4,Need check for null.,341170466,2016-06-15 18:22:08
5765002,288476,22887044,5,"Is the expression ""protected[this]"" meaningful?",203785148,2015-01-14 02:26:57
5765002,415626,22888210,5,"I ended up using an explicit state change check in EndToEndSpec, so I needed to bump up to protected access for that property in an anonymous extension of ParrotFeeder",203785148,2015-01-14 02:40:13
6397552,288476,34599408,9,Why do we have request.bodyInputStream.isDefined  -- what does it do that request.body.length > 0 doesn't? Is it that we want to support zero length messages?,222058290,2015-07-14 23:06:52
32088,19537,745415,12,"Could you, please, replace tabs with 2 spaces here and everywhere else where they might be? I'd suggest adjusting your editor's settings to use 2 spaces for indenting Ruby files.",3905123,2012-04-27 21:58:38
32088,83686,745481,12,+1,3905123,2012-04-27 22:10:54
32088,109310,748166,12,Got it!,3905123,2012-04-28 17:03:08
32088,83686,751953,42,The style used in the rest of this codebase for multi-line blocks is to use `do`...`end` instead of curly braces.,3916941,2012-04-30 22:57:26
32088,109310,754409,42,"Okie, I'll fix it",3916941,2012-05-01 07:00:31
38348,83686,853939,60,"Unless I misunderstood the purpose of this method, it might be better for it to explicitly return true/false instead of an int/nil.",4038453,2012-05-21 20:40:09
38348,83686,853967,112,Could you add a link to the document (if you or Andrew used one) that explains this algorithm,4038453,2012-05-21 20:44:07
38348,83686,853983,41,Love this comment.,4038453,2012-05-21 20:45:40
38348,19537,854019,112,It's nothing more than a regular bubble sort with a small optimization that stops the algorithm if nothing was swapped during the iteration.,4038453,2012-05-21 20:50:02
38348,83686,854024,21,"Ah ok.  Just so I understand completely:  this method does not handle compatibility mapping as NFKD does, so it simply returns nil if a compatibility mapping is required.",4038453,2012-05-21 20:50:32
38348,19537,854055,21,"Yes, when NFD comes across compatibility mapping it skips it, while NFKD removes compatibility tag and goes further.",4038453,2012-05-21 20:55:17
38348,19537,854081,60,"I agree that it's a good practice to return `true/false` from `?`-methods. This one is for internal use so I was less careful about this rule. Give me a couple of minutes, I'll fix it.",4038453,2012-05-21 20:57:33
38348,19537,854089,112,"Ah, @camertron, do you mean a document explaining NFD & NFKD algorithms themselves?",4038453,2012-05-21 20:58:43
38348,83686,856314,112,"It would be great to add a comment at the top of this file with a link to the NFKD spec, but I was referring to a description of the stable sort algorithm you used.  If you mention it's just a bubble sort that maintains the order of equal elements and exi",4038453,2012-05-22 01:38:36
39270,83686,870867,19,"This should be converted into a CLDR locale by calling TwitterCldr::convert_locale, otherwise stuff like: `TwitterCldr::Shared::Calendar.new(:'zh-tw').months` won't work.",4058848,2012-05-24 01:24:24
39270,19537,870894,19,"I'm going to do that. There is even a pending [test](https://github.com/twitter/twitter-cldr-rb/pull/33/files#L3R37) (not yet implemented) for that. I'm trying to move forward with TDD approach and as there were no test for that at the moment, I used defa",4058848,2012-05-24 01:27:33
39270,83686,871002,19,"Yep, just saw the pending test.  The implementation looks solid and, as usual, very neat and compact.  See my last comment for details.",4058848,2012-05-24 01:39:02
39270,83686,884101,42,Didn't we discuss using this type of hash traversal in a few other places too?  Can we move this into a module and mix it in to those places?  I'm thinking of plurals and calendars.,4058861,2012-05-26 01:30:05
39270,19537,884144,42,"Yeah, that's one of the reasons why I previously suggested extracting it. I felt like I've already seen smth similar and today I found almost the same [method](https://github.com/twitter/twitter-cldr-rb/blob/master/lib/twitter_cldr/tokenizers/base.rb#L78-",4058861,2012-05-26 01:37:47
39270,83686,884805,42,"Ok, whenever it's convenient.",4058861,2012-05-26 03:43:16
40659,19537,889805,6,"Do you have some options for this method, other than the normalization form, in mind? If not, I think it'd be better to have a single argument named `form` with a default value `:NFD` instead of this uncertain options hash. 

Another question is about ret",4084015,2012-05-29 02:56:05
40659,19537,889833,18,"I like the idea with overriding `default_format_options_for` in every subclass, but I think this `2` should be moved back into some constant because it looks too much like a magic number here.",4084015,2012-05-29 03:09:14
40671,19537,889880,19,"This hash should look nicer as a constant, don't you think?",4084356,2012-05-29 03:32:52
40671,19537,889883,32,You can use `TwitterCldr.get_resource` here for conformance with the rest of the code.,4084356,2012-05-29 03:35:35
41816,83686,912340,16,I usually compare `object_id`s for cases like this where you want to make sure you don't get duplicate objects.,4102815,2012-06-01 05:52:27
43308,83686,939848,15,"Might be nice to pass the full options hash to `#to_s` instead of just the unit.  Also, you can give `options` a default value of `{}` so it's `def ago(options = {})`  That way, `options[:base_time]` is less likely to throw an error if `options` isn't a h",4129801,2012-06-07 02:18:11
43308,83686,939935,14,These two lines can be combined so you'll have: `base_time = options[:base_time] || Time.now`.,4129801,2012-06-07 02:27:04
43308,83686,939944,5,"Still not sold on the name ""Ago"" - what do you think?  We could do something like ""TimespanFormatter"".  I'll leave it up to you.",4129801,2012-06-07 02:27:54
43308,83686,939964,9,Move these into `LocalizedDateTime#until` and `LocalizedDateTime#ago`.,4129801,2012-06-07 02:29:42
43308,83686,940016,44,"Does this really need to be a decimal?  We can assume some standard number of days or weeks in a month, like 30 or 4.",4129801,2012-06-07 02:36:01
43308,83686,940028,53,Doesn't `Float#round` use 0.5 as the cutoff point?  Why do you say it always rounds down?,4129801,2012-06-07 02:37:22
43308,83686,940031,4,Hash!,4129801,2012-06-07 02:37:36
43308,83686,940064,42,You should be able to get plural rules using the `TwitterCldr::Formatters::Plurals::Rules` class.,4129801,2012-06-07 02:41:57
43308,83686,940223,10,Why use the Buddhist calendar here?,4129801,2012-06-07 03:04:08
43308,83686,940234,11,Have you tested this locally for a timezone other than PST?  Use System Preferences to change it around and see what happens when you run the tests again.,4129801,2012-06-07 03:06:02
43308,83686,948575,17,This can be combined like: `strings = tokens.map { |token| token[:value] }`,4129817,2012-06-08 05:53:59
43308,83686,948590,16,Should be `TwitterCldr::Formatters::TimespanFormatter`.,4129817,2012-06-08 05:56:00
43308,83686,948593,4,"How about `tokens_with_placeholders_for`?  Also, this whole function can fit on one line:

```ruby
def tokens_with_placeholders_for
  self.tokenize_pattern(self.pattern_for(self.traverse(key)))
end
```",4129817,2012-06-08 05:56:42
43308,83686,948612,16,Indenting is a bit off for the first `:ago` hash.,4129817,2012-06-08 06:00:04
43308,83686,948617,61,Customary to use `||` instead of `or` operator here.,4129817,2012-06-08 06:02:01
43308,19537,952010,9,How about `direction = seconds < 0 ? :ago : :until`? It's shorter and a bit easier to read it that way.,4129817,2012-06-08 21:29:53
43308,19537,952055,11,"@camertron already commented below about preferring `||` and `&&` over `or` and `and`. Just don't forget this one too. And as the condition body is only one line you can convert into a

```ruby
unit = calculate_unit(seconds.abs) if unit.nil? || unit == :d",4129817,2012-06-08 21:35:22
43308,19537,952063,16,When a hash is the last argument in the method's call Ruby allows to omit curly braces. I think it's a good thing to do.,4129817,2012-06-08 21:37:12
43308,19537,952139,2,"I think it's a good practice to add editor-specific files that are not related to the project into your own [global git ignore file](http://robots.thoughtbot.com/post/18739402579/global-gitignore) instead of `.gitignore`. That's, for example, how my `~/.g",4129817,2012-06-08 21:48:43
43308,19537,952186,21,"Can you, please, explain what is this change about? I'm going to extract this method in the nearest future, because we have it duplicated in several places, so I'd like to know all use cases.",4129817,2012-06-08 21:55:53
43308,19537,952799,9,When I started working on the project I suggested @camertron to use methods defined with `rspec`'s `let` instead of regular instance variables. I think he liked the idea. You can read about `let` and `let!` [here](https://www.relishapp.com/rspec/rspec-cor,4129817,2012-06-08 23:20:19
43308,19537,952844,43,"Two empty lines is a bit too much for separating regular methods of the same class, don't you think?",4129817,2012-06-08 23:24:14
43308,19537,952918,21,"Unfortunately, this doesn't work in Ruby 1.9. Specs are failing with this error:

```
1) TwitterCldr::Formatters::TimespanFormatter#format#ago works for a variety of units
   Failure/Error: @formatter.format(-3273932, :year).should == 'Vor 0 Jahren'
     ",4129817,2012-06-08 23:33:41
43308,19537,952971,22,"Btw, we have Travis CI (a continuous integration system)  set up for this project. That means you can run specs on [travis-ci.org](http://travis-ci.org/) for your fork of the project too. Just go to this site, sign in with you GitHub account, flip the tri",4129817,2012-06-08 23:38:34
43308,19537,953047,51,"I think it'd look a bit nicer if you extract numeric constants from this method into a hash with time unit symbols as keys. Then you can rewrite this method into smth like

```ruby
def calculate_time(seconds, unit)
  round_to(seconds / TIME_IN_SECONDS[uni",4129817,2012-06-08 23:48:48
43308,19537,953085,2,"Does this class really belong to `shared` directory? If so, I think it's better to wrap it into `Shared` module as it's done with other classes in this directory. In most cases it's better if modules are nested in the same way as directories are.",4129817,2012-06-08 23:54:09
43308,19537,953258,8,"This one fails on my local machine saying that the returned value was `""Vor 322020420 Sekunden""`.",4129817,2012-06-09 00:14:45
43308,19537,953451,16,"For some reason it works in specs (I think because we explicitly include `TwitterCldr` in several our spec), but it fails in console for me with

```
NameError: uninitialized constant TwitterCldr::LocalizedDateTime::LocalizedTimespan
```

You should use t",4129817,2012-06-09 00:36:41
43308,19537,953594,21,"Well, I read your comment about `units.hours-ago.1` and I understand the problem now. Your fix works for this case, but it'll break if one day someone will pass a hash with `'1'` key (as a string). But right here there's no much we can do because needle i",4129817,2012-06-09 00:57:34
43308,19537,954248,21,"I tried completely removing `KeyPath` and fixed a couple of specs in this PR (to make it testable and see the whole picture). @gbadiali, @camertron, please, have a look at [this diff](https://github.com/KL-7/twitter-cldr-rb/compare/f64c9dc4a14c7363b86ef6e",4129817,2012-06-09 02:42:52
43308,19537,954549,59,"Here's the intialisation of a cache, but I don't see the place where smth is written into it. Can you, please, point it out?",4129817,2012-06-09 03:30:05
43308,83686,961738,21,"After talking to @KL-7 about this, I'd be fine with removing `KeyPath` and just passing around arrays - it makes sense because the names of the variables with key paths are clearly named in most cases, eg. `@base_path`.",4129817,2012-06-11 23:52:59
43308,451761,963220,2,"Great to know, thanks!",4129817,2012-06-12 02:48:19
43308,451761,963240,9,I tried this in my two new spec classes but there are a bunch of other places where this could be changed--I'll investigate further.,4129817,2012-06-12 02:50:50
43308,451761,963307,8,"Thanks for catching this. The problem was that LocalizedTime doesn't keep track of a date and therefore was defaulting to today's date, which varies by timezone. We discussed the possibility not allowing ""ago"" to work at all for a LocalizedTime, but decid",4129817,2012-06-12 02:57:00
43308,451761,963394,2,I put it in the shared directory because core_ext only contains objects from the original Cldr. What do you think?,4129817,2012-06-12 03:11:44
43308,19537,963413,9,"I'd really recommend to use the following formatting for things like this one:

```ruby
TIME_IN_SECONDS = {
    :second => 1,
    :minute => 60,
    :hour   => 3600,
    :day    => 86400,
    :week   => 604800,
    :month  => 2629743.83,
    :year   => 31",4129826,2012-06-12 03:14:31
43308,19537,963424,2,"I totally agree with that. This class still doesn't feel like 'shared' to me, but looks like it's the best place we can find for it =)",4129817,2012-06-12 03:17:03
46467,19537,991410,8,What do you think if we remove this intermediate `UnicodeData` module? `CodePoint` is the only class in it and I think it's nested too deep.,4200497,2012-06-15 13:23:19
46467,19537,991429,65,You can omit quotes quotes in such cases and use `:@decomposition_map` instead.,4200497,2012-06-15 13:26:02
46467,83686,994188,8,"Yeah, that's probably a good idea.  Most likely we won't be adding any new classes under `UnicodeData` so it makes sense to remove it.",4200497,2012-06-15 22:03:26
46467,83686,994191,65,Ah cool!,4200497,2012-06-15 22:03:38
46920,83686,997812,38,Are you referring to the `nfd_quick_check ` technique?,4206962,2012-06-16 23:13:33
46920,19537,997816,38,"Huh, do we have it? There's something called *Fast C or D* (or FCD) in the [ICU document](http://source.icu-project.org/repos/icu/icuhtml/trunk/design/collation/ICU_collation_design.htm#CheckFCD). They use it to skip normalization when it's not necessary.",4206962,2012-06-16 23:19:46
46920,83686,997823,13,Is this used anywhere?,4206962,2012-06-16 23:33:14
46920,83686,997825,61,"Did you follow an algorithm or a spec for this def?  If so, please give the URL here :)",4206962,2012-06-16 23:34:24
46920,19537,997831,61,"I haven't found a good description of what has to be done with CJK, so I ported this class (necessary methods and constants) from ICU4J. I'll add some notes about that later. ",4206962,2012-06-16 23:37:00
46920,19537,997833,13,It was...,4206962,2012-06-16 23:38:19
46920,83686,997834,24,"I would have expected `build` to return an instance of `SortKey` instead of a byte array.  If you're going to return a byte array, why create an instance of `SortKey` at all?  Throughout the rest of the collation code, it doesn't look like instances of `S",4206962,2012-06-16 23:38:57
46920,83686,997835,30,Cleaner (IMHO) to say `final.first`,4206962,2012-06-16 23:39:47
46920,19537,997838,24,I extracted it from `Collator` to make things separated. And I need an instance because otherwise `@bytes_array` and `@common_count` will be passed from one method into another as arguments that doesn't feel right in this particular case when we have quit,4206962,2012-06-16 23:43:15
46920,83686,997840,27,"Streaming the resource is clever, nicely done!  However, the `table` argument is a little misleading - it's not really the table you're passing in, it's a file handle.  Could we make this streaming behavior available in `TwitterCldr::Resources`?",4206962,2012-06-16 23:44:15
46920,83686,997842,8,"This is a great refactoring of the Hangul stuff, nice work.",4206962,2012-06-16 23:45:43
46920,83686,997843,23,Ha!  Nice.,4206962,2012-06-16 23:46:04
46920,83686,997844,37,"Yes, this is much better.  I was doing some other logic with this `case` before refactoring and just didn't see it this way - thanks!",4206962,2012-06-16 23:47:02
46920,19537,997846,30,"Agree, but we don't have `Array#second` from `ActiveSupport` here, so `final.first` and `node[1]` won't look nice together. That's why I thought about creating a `Node` class. But, as I said, I decided against it eventually and implemented everything with",4206962,2012-06-16 23:48:06
46920,83686,997847,49,"Ugh.  I'm getting really tired of this `.to_s(16).upcase.rjust(4, ""0"")` thing.  Maybe we can add a method to `Fixnum` or something.  Hopefully we can move away from doing string code point to int conversions in the future too.",4206962,2012-06-16 23:48:53
46920,83686,997850,38,"Yeah, I think that's the same thing.  We don't have it yet - it will require adding and loading a few more resources.",4206962,2012-06-16 23:51:55
46920,19537,997853,49,"I think the second option is the right choice. And I'd rather leave things that way until then, so we don't forget about these annoying conversions.",4206962,2012-06-16 23:54:40
46920,83686,997859,27,"I meant streaming in the sense that you're not loading the entire table into memory.  Instead, you're opening the file with `open` and reading and parsing each line individually.  The line `parse_trie(load_collation_elements_table)` doesn't pass the table",4206962,2012-06-17 00:01:23
46920,19537,997863,27,"Ah, now I see what you mean. Unfortunately, I guess, one does not simply stream a YAML file. And all our other resources are in this format.",4206962,2012-06-17 00:07:23
46920,19537,997869,27,"Well, you can actually pass a file handler (as an IO-object) into `YAML.load` or even a file name directly into `YAML.load_file`. That might be more efficient, I think.",4206962,2012-06-17 00:11:22
46920,83686,997934,27,"Oh no, I meant we could use streaming for non-yml files, but move the logic for streaming into `TwitterCldr::Resources`.  Just a thought, probably not necessary.",4206962,2012-06-17 01:57:38
46920,19537,997849,27,How do you mean streaming? I separated this method from `load_collation_elements_table` to be able to stub the latter with a string in the specs. That's why I chose a neutral `table` name for the argument.,4206962,2012-06-16 23:50:57
49346,19537,1031560,6,"What do you think if we move this fallback to the default locale into `convert_locale` method? Maybe `convert_locale` wouldn't be such a good name then, but I think this method is used in a couple of other places where fallback might be useful as well.",4249152,2012-06-22 11:02:59
49346,83686,1034811,6,Hmm yes...  that's not a bad idea.  I'll look into it.,4249152,2012-06-22 22:04:40
49346,83686,1037070,6,"On second thought, doing that actually messes a bunch of things up.  For example, `Languages.translate_language(""Russian"", :en, :blarg)` should return `nil`, but instead returns ""Russia"" because it defaulted to the English translation.",4249152,2012-06-23 03:27:12
49346,19537,1037986,15,Is this method used anywhere?,4249123,2012-06-23 15:29:32
49346,19537,1037992,19,"Instead of this `key_val` thing you can do:

```ruby
current.inject({}) do |ret, (key, value)|
  ret[key] = expand(val, haystack)
  ret
end
```",4249123,2012-06-23 15:44:39
49346,19537,1037993,13,"This whole method can be simplified to `!!locale && supported_locales.include?(convert_locale(locale))`, because `convert_locale` method converts `locale` into a symbol and returns intact locales that do not need to be converted.",4249123,2012-06-23 15:48:58
49346,19537,1037994,6,"@camertron, can you, please, explain, why do we need to go over the whole resources hash and expand all 'redirects' here? Expanding is handled in `Tokenizers::Base#expand_pattern` method when you request a specific resource. Isn't it enough?",4249123,2012-06-23 15:50:52
49346,19537,1038052,6,"Ok, let's leave it that way for now.",4249152,2012-06-23 18:30:06
49346,83686,1071717,15,Removed :),4249123,2012-06-29 01:36:01
49346,83686,1071722,19,"Oh nice, thx.",4249123,2012-06-29 01:36:16
49346,83686,1071725,13,Beautiful.,4249123,2012-06-29 01:36:29
49346,83686,1071736,6,"I think I explained this over Skype, but for completeness I'll comment here too.  I'm expanding all redirects here because the JavaScript version shouldn't have to expand the paths itself.  Plus, it turns out the Ruby version wasn't doing redirects for th",4249123,2012-06-29 01:38:46
52255,19537,1077669,1,Where is 1.5.1 and others?,4298816,2012-06-29 23:07:44
52255,19537,1077703,14,Looks like we're handling the same list of features as in `ALL_JS_FEATURES` here. Will it be nicer if we turn this constant from array into a hash (with classes as values) and replace this whole method with `ALL_JS_FEATURES[feature]`?,4298816,2012-06-29 23:11:35
52255,19537,1077786,21,"CoffeeScript has existential operator, so we can replace `unit is null or unit is undefined` with a simple `unit?`.",4298816,2012-06-29 23:21:33
52255,19537,1077844,32,"CoffeeScript automatically returns the result of the last expression as a function's return value, the same way as Ruby does. Just saying ;)",4298816,2012-06-29 23:28:37
52255,19537,1077904,19,"4 back slashes (as well as 2 in the previous file, imho) is a lot. I think `%Q(...)` will look much nicer here.",4298816,2012-06-29 23:33:17
52255,19537,1077946,25,Isn't Ruby calling `to_s` for you when you put something inside `#{...}`?,4298816,2012-06-29 23:39:18
52255,83686,1085687,1,"I haven't been choosing versions sequentially, this one just felt right.",4298816,2012-07-02 21:48:42
52255,83686,1085693,14,"Yes, that's a great idea, thanks.",4298816,2012-07-02 21:49:09
52255,83686,1085709,32,Ah good point.  I'll update the code.,4298816,2012-07-02 21:52:07
52255,83686,1085713,19,"Absolutely, I'll update it.",4298816,2012-07-02 21:52:48
52255,83686,1085718,25,"Hmm yes, I guess I was just trying to be explicit.",4298816,2012-07-02 21:53:11
52255,83686,1145604,21,Yeah I know.  I'll try it again.,4298816,2012-07-12 04:07:03
52255,19537,1165190,13,"I think for this special case we can do `File.join('custom', path)` and don't change `resource_file_path` at all.",4388874,2012-07-15 17:11:53
52255,19537,1165199,5,"I remember you said that it just feels right, but non-successive version are a bit strange, don't you think? In fact, the best approach for versioning that I know is [semantic versioning](http://semver.org/), but I'm not sure that we're following it with ",4388874,2012-07-15 17:21:19
52255,83686,1085705,21,"Yeah, I tried that and discovered the existential operator doesn't handle the `undefined` case, so I decided to chain a bunch of `or` statements instead.  I could change it to be `if !unit? or unit is undefined or unit is ""default""` but there's not much t",4298816,2012-07-02 21:51:39
52255,19537,1085833,21,"That's interesting. The docs clearly say:

> existential operator `?` returns true unless a variable is null or undefined

",4298816,2012-07-02 22:08:35
52255,19537,1165123,16,"Will [`Array#replace`](http://www.ruby-doc.org/core-1.9.3/Array.html#method-i-replace) work here? And, in fact, replacing one array with another one isn't really 'merging'. If it suits our use case, I think it'd be more transparent to limit acceptable arg",4388874,2012-07-15 16:23:48
52255,19537,1165174,6,How about `path.end_with?('.yml')`?,4388874,2012-07-15 17:04:04
52255,83686,1171000,5,"We are using semantic versioning to a certain extent.  Whenever we release a non-trivial version, I try to increase the ""minor"" part of the version number.  This PR alone probably warrants a bump to 1.6.0, but with collation it _definitely_ should be incr",4388874,2012-07-16 21:45:39
52255,83686,1171005,6,Nice!  Hadn't seen that one before :),4388874,2012-07-16 21:46:36
52255,83686,1184359,16,"We talked about this over Skype, but I'll record the answer here too:  There are conceivably times where we would want to merge arrays and not just hashes.  I'll change this code to merge arrays more intelligently - that is, iterate through all the elemen",4388874,2012-07-18 04:47:32
53023,19537,1085864,2,"I guess so. Don't worry, when I process more CLDR data and get a more complete list of locales tailorings, I'll filter these resources to the regular list of locales we support for other features.",4311829,2012-07-02 22:13:39
53023,83686,1128293,146,"Why is the value `nil` here, and why lock the returned trie?",4365325,2012-07-10 08:29:49
53023,83686,1128339,2,"Since we symbolize keys whenever a resource is loaded, there's no need to export these files with symbol keys.",4365325,2012-07-10 08:36:49
53023,19537,1128437,146,"I don't use the node itself as a root of a new trie, but instead create a new node with nil value and same hash of children, because by design root node of a trie should have `nil` as its value. Otherwise `find_prefix` works incorrectly in cases when a ke",4365325,2012-07-10 09:05:10
53023,19537,1128460,2,"I can change keys to strings, but it doesn't look like having symbols here hurts in any way at the moment. 

I remember we were talking about a serious impact of hashes deep symbolizing on the resources loading time. Have we decided to get rid of symbols ",4365325,2012-07-10 09:11:20
53023,83686,1128530,2,"We decided to eventually use symbol keys in all our yaml resources.  I commented on the use of symbol keys here because none of our other resources use them yet, so it seemed inconsistent.",4365325,2012-07-10 09:36:43
53023,19537,1128543,2,"Right, I updated tailoring resources. I'll also create an issue for converting resources to symbols usage, so it's easier to see what we have in our plans.",4365325,2012-07-10 09:42:44
53023,19537,1128614,2,"Btw, that reminded me of what I didn't like about `ya2yaml`. It's the way it dumps symbols:

```ruby
1.9.3p194 > YAML.dump :foo
 => ""--- :foo\n...\n"" 
1.9.3p194 > :foo.ya2yaml
 => ""--- !ruby/symbol foo\n""
```
Not that it's a serious issue, but result from",4365325,2012-07-10 10:13:53
53023,83686,1129117,2,"Ugh, wow I didn't notice that.  I've submitted a [pull request](https://github.com/afunai/ya2yaml/pull/2) for the ya2yaml gem that should fix the ugly symbol dumping.  You'll have to specify the `:use_natural_symbols` option, but that shouldn't be too har",4365325,2012-07-10 12:53:10
53023,83686,1085781,2,Is this English for Belgium?,4311829,2012-07-02 22:00:59
62151,83686,1194258,92,"""... bytes that are greater ...""",4407521,2012-07-19 10:54:45
62151,83686,1194259,120,"""are"" again",4407521,2012-07-19 10:55:08
62151,19537,1194306,92,"Oh, thanks.",4407521,2012-07-19 11:12:41
64026,83686,1217000,42,"This doesn't really matter, but I prefer `File.open` instead.",4438525,2012-07-23 21:50:40
64026,83686,1217016,32,`File.open` preferred.,4438525,2012-07-23 21:52:04
64026,83686,1217025,77,Extra spaces :),4438525,2012-07-23 21:52:46
64026,19537,1217512,77,Removed.,4438525,2012-07-23 22:40:18
64026,19537,1217565,32,[Updated](https://github.com/KL-7/twitter-cldr-rb/commit/7cc2f73977577f50ec0d5ffd15914c8ae40454de). Any reasons why you prefer `File.open`? I usually use `Kernel#open` because it's shorter and looks consistent with [opening remote resources](https://githu,4438525,2012-07-23 22:45:18
66694,19537,1308331,10,Why was that suddenly moved to currency formatter?,936742,2012-08-05 22:00:10
66694,83686,1308709,10,"Oh man good catch, this was kind of a hack.  As it turns out, currency is the only number format that specifies separate positive and negative formats.  For example `resources/locales/en/numbers.yml` you'll see this: `:default: ¤#,##0.00;(¤#,##0.00)` - no",936742,2012-08-06 03:19:34
69137,83686,1367326,24,Really nice.,4213557,2012-08-14 03:19:49
69137,19537,1367591,24,I just tried to reduce the number of things that we put into the load path manually. I believe we can make it even nicer by adding `js/lib` to `require_path` in [gemspec](https://github.com/twitter/twitter-cldr-rb/blob/master/twitter_cldr.gemspec#L18) and,4213557,2012-08-14 03:40:55
83011,83686,663125,4,Let's keep `self.resources` and add `self.get_resource` for backwards compatibility :),57548713,2012-04-10 04:33:41
83011,19537,663959,4,"@camertron, thanks. I should definitely learn to respect backward compatibility. Added a couple of specs to make sure next guy who deletes this method will get punished =) 

Regarding delegation I replaced variable length arguments list in `get_resourse` ",57548713,2012-04-10 10:34:42
83011,19537,664680,4,"@camertron, I thought it over and decided that delegating method should not care about signature of the method it delegates to as its role is to pass everything along to the actual method. With that in mind delegating method should look like

```ruby
def ",57548713,2012-04-10 15:34:06
88055,83686,678818,5,"Where is `locale` defined here?  I don't see any way that the body of this block will ever be executed.  Also, only one instance of `TwitterCldr::Shared::Resources` is ever created... I guess maybe I'm missing the point of this change.",4910851,2012-04-13 01:54:50
88055,83686,678828,30,"These changes feel less readable to me than the previous solution, albeit more compact.",4910851,2012-04-13 01:56:01
88055,19537,678868,5,"Are you familiar with a block form of `Hash` [constructor](http://ruby-doc.org/core-1.9.3/Hash.html#method-c-new)? It's just a way of defining default value for a hash, in that case on both levels. Though, it might be a bit tricky, so I'd understand if yo",4910851,2012-04-13 02:00:06
88055,19537,678892,30,"I just don't like those local variables that are created only to be passed somewhere else in the next moment. But you're probably right, it might be a bit less readable that way. I'll remove that if you decide to merge the other part of this PR.",4910851,2012-04-13 02:02:47
88055,83686,682703,5,Just looked this up.  You're passing it a block that handles initialization - that's actually super cool.  Let's do it.,4910851,2012-04-13 22:15:31
88055,83686,682710,30,"Yeah I completely understand what you mean.  Really, it's not that much more unreadable.  I think we can keep your changes.",4910851,2012-04-13 22:16:23
93105,110734,694952,17,"I'm not too sure if the `sort_by` is required here.
@KL-7 @camertron Since Ruby 1.8 doesn't maintain the hash keys in the insertion order, is it better to leave it in?",57549007,2012-04-17 19:35:12
96104,19537,709206,4,"`Struct.new` returns a new class so why not to treat it like a class and name it smth like `UnicodeDataAttrs` or `CodePoint`, as @camertron suggested? It's better to avoid class variable in Ruby as they have some ugly side effects when it comes to inherit",5066266,2012-04-20 00:28:08
96104,83686,717597,4,"Yeah, I think @KL-7 is right, there's no reason why unicode_data_attrs shouldn't just be a constant that you can call `.new` on.  Making it a class variable isn't wrong necessarily, but, in addition to inheritance issues, it doesn't allow you to access th",5066266,2012-04-22 04:26:40
189380,19537,1423324,6,How about extracting these three lines into a method that can be used both for `FastGettext` and `I18n`?,6465814,2012-08-21 16:23:15
258694,83686,2011953,27,"Most of this should be merged into the [ruby-cldr gem](http://github.com/svenfuchs/ruby-cldr) instead of twitter-cldr.  That's where all the CLDR xml files are parsed, plus it's nice to give back to that library and keep our implementation separate from t",22007761,2012-11-02 05:46:39
258694,83686,2011960,8,Can we fold this functionality into the existing `LocalizedNumber` class?,22007761,2012-11-02 05:47:53
258694,109310,2012063,8,"In the new pull request, we don't have this anymore. We get it directly in ```currency_formatter```.",22007761,2012-11-02 06:02:19
258694,109310,2012066,27,You're right! I will move them to ```ruby-cldr```,22007761,2012-11-02 06:02:37
265023,19537,1459629,15,"To be consistent with the standard `#each` implementation we should return a `Enumerator` when no block is given. I think this should do the trick:

```ruby
def each
  block_given? ? @base_obj.each { |e| yield e } : @base_obj.to_enum
end
```

Maybe you'll",7387422,2012-08-25 18:20:02
293979,83686,656040,7,"There's not much reason to use File.join unless you're joining more than one sub-path.  Try this instead:

`data_path = File.join(File.dirname(__FILE__), ""data"")`

Also, data files are all stored in the `/resources` directory.  Unless they pertain to ",8138230,2012-04-06 23:23:42
293979,83686,656062,9,"At Twitter, it's standard to use the `do ... end` syntax instead of curly braces for multi-line blocks.  Also, this is another great place to use File.join:

```
IO.readlines(File.join(data_path, ""UnicodeData.txt"")).map do |line|
  ...
end
```",8138230,2012-04-06 23:26:40
295135,83686,663281,15,"Ah, I see what you mean.  No, I don't think an error should be thrown here.  Instead I think we should leave the original text in the string, so instead of `""5 houses""` you get `""%{houses_count:houses}""` without any replacements.

However!  I've been cons",57548702,2012-04-10 05:30:10
295135,83686,663284,15,"The convention used throughout the rest of the specs is to assign instance variables for objects used across multiple tests:

```ruby
@patterns = { :one => 'медведь', :few => 'медведя', :many => 'медведей', :other => 'медведя' }
@plurals = ...
```",57548702,2012-04-10 05:31:55
295135,83686,663292,39,"Although this line will likely change, the convention used at Twitter (and in these specs) is to use a lambda and .should raise_error:

```ruby
lambda { subject.format(2, patterns) }.should raise_error(ArgumentError, ""Missing pattern for :few."")
```",57548702,2012-04-10 05:33:31
295135,83686,663296,12,"LOVE these refactors - much better, thanks!",57548702,2012-04-10 05:34:00
295135,83686,663297,62,Didn't know you could do this.  Very cool.,57548702,2012-04-10 05:34:26
295135,19537,667472,15,Totally agree on that: it depends on the project. I can easily imagine people that won't be very happy if some untranslated text will get unnoticed into production because of some mistake or typo that was silently skipped by the formatter.,57548702,2012-04-11 01:14:47
295135,19537,667563,15,"I see, but what if we gradually change this convention across the project? I used to use instance variables myself but recently decided to learn what rspec's `let` actually is and eventually started using it in my projects. The reason is that `let` has a ",57548702,2012-04-11 01:32:25
295135,19537,667573,39,"Ok, I'll keep that in mind.",57548702,2012-04-11 01:34:11
295135,19537,667581,62,"Didn't know either, just googled it and was very pleased when found this solution.",57548702,2012-04-11 01:36:50
295135,83686,673768,15,"Hmm... well, I suppose it couldn't hurt.  Thanks for the SO question, that helped explain things.  Let's do it.",57548702,2012-04-12 03:27:05
295135,83686,682728,9,Better to accept a hash of options here and use `TwitterCldr.get_locale` if no locale is specified.,57548704,2012-04-13 22:19:39
295135,19537,682760,9,I see most of the formatters use [`Formatters::Base#extract_locale`](https://github.com/twitter/twitter-cldr-rb/blob/master/lib/formatters/base.rb#L33-35) and `TwitterCldr.get_locale` (that also takes `FastGettext` locale into consideration) is mostly use,57548704,2012-04-13 22:26:28
295135,83686,682827,9,"Ah, right you are.  `extract_locale` is better.",57548704,2012-04-13 22:39:23
295135,83686,682830,14,"Cool, very compact.",57548704,2012-04-13 22:39:52
295135,19537,682849,30,When I add interpolation utility function from gettext this line will be replaced with a call to this function.,57548704,2012-04-13 22:42:54
295135,83686,705339,0,This file should probably not be hanging out right inside `lib` - consider moving it into a child directory.,57548706,2012-04-19 08:31:43
295135,19537,705612,0,If I restructure directories a bit as I suggested [here](https://github.com/twitter/twitter-cldr-rb/pull/14#issuecomment-5188319) this file will live under `lib/twitter_cldr`.,57548706,2012-04-19 11:55:00
416307,19537,1657449,31,"When you construct a range like that Ruby uses [`#next`](http://www.ruby-doc.org/core-1.9.3/Fixnum.html#method-i-succ) method to get the next element. For numbers this method returns `self + 1`. As you can't reach `-5` moving that way from `-3`, `(-3..-5)",12698504,2012-09-21 05:35:34
416307,19537,1657544,45,"I guess [`#each_with_index`](http://ruby-doc.org/core-1.9.3/Enumerable.html#method-i-each_with_index) would look a bit nicer here. 

Also, I believe every `gsub!` call iterates through the whole string, and you can get the same result with a single walk t",12698504,2012-09-21 05:53:46
416307,83686,1781300,45,"Great idea, will change, thanks!",12698504,2012-10-08 04:09:03
459790,83686,2092009,42,"Interestingly, running `bundle exec rake update:locales_resources` now outputs a bunch of `plurals.rb` files in each locale resource directory - is this the reason why?",16189314,2012-11-11 07:51:35
459790,19537,2015886,39,"It's up to you if you prefer it that way, but in my opinion parentheses are needless in cases like that.",16189314,2012-11-02 19:17:27
459790,19537,2016030,5,Looks like this revision is no longer in the `master` branch of your fork. Its `master` points to `5f1733b82c065ba516e4d97eefcdde8a8427f941` now.,16189314,2012-11-02 19:31:37
459790,19537,2016050,42,"Why capitalized again? I believe it [was fixed](https://github.com/svenfuchs/ruby-cldr/pull/9) in `ruby-cldr` to be consistent with other components, e.g., `numbers`. Same with `calendars` below. I think you should remove this capitalization both here and",16189314,2012-11-02 19:33:32
459790,19537,2016121,16,"Afaik most rubists [agree](https://github.com/bbatsov/ruby-style-guide) (search for `{`) that having spaces around braces makes code much easier to read. Besides, here you can easily use `map(&:to_s)`.",16189314,2012-11-02 19:40:43
459790,19537,2016139,23,"There's no need to specify `nil` explicitly – `return` without a value will return `nil` anyway. Besides, `unless` is a bit more expressive than `if !something`, and in a two-lines method I'd avoid explicit `return` altogether and rather move if-condition",16189314,2012-11-02 19:42:29
459790,19537,2016185,33,EmptyLinesOverflow!,16189314,2012-11-02 19:47:59
459790,109310,2018439,42,"There was a bug. ```Data.components```, used as defaults when ```--components``` is not specifed, is in Camel-case, but the options for ```--components``` should be entered in Snake-case. 

Therefore, if we ran ```bundle exec thor cldr:export```, ```plu",16189314,2012-11-02 22:49:40
459790,19537,2018511,42,"Ah, I see. Nice catch! In that case the only thing I'd suggest to do is to update `README`, because it contains misleading example with lowercase components names.",16189314,2012-11-02 22:57:40
459790,109310,2019424,42,"Now either ```bundle exec thor cldr:export --components Plurals CurrencyDigitsAndRounding``` or ```bundle exec thor cldr:export --components plurals currency_digits_and_rounding``` works.

All the comments are very useful. Appreciate your time. I'll get",16189314,2012-11-03 00:15:32
459790,83686,2019523,9,It might be nice to tell everyone what the replacement is for `Currencies#countries`.,16189314,2012-11-03 00:23:21
459790,83686,2019655,20,"This is kinda weird.  I know the the currency symbol for the Nuevo Sol is ""S/."" - is that not in the CLDR repo?",16189314,2012-11-03 00:33:15
459790,109310,2020670,20,"I see it now. The currency symbol is per locale, and the locale that uses ```S/.``` is ```es_PE```.

But in twitter-cldr-rb, we don't have ```es_PE```, we only have ```es```.

This currency symbol per locale is really new to me. I never knew that befo",16189314,2012-11-03 02:16:08
627111,83686,1285517,21,This is fairly platform-specific - can we use `Net::HTTP` instead?,779761,2012-08-01 23:30:06
627111,19537,1285590,21,"Sure, we can, but `ruby-cldr` [uses](https://github.com/svenfuchs/ruby-cldr/blob/master/lib/cldr/download.rb#L15) exactly the same command to download CLDR, so we're already bound to using `curl`. The reason why I decided to use it as well is that it prin",779761,2012-08-01 23:36:06
627111,83686,1285598,21,"Ah ok, no worries then :)",779761,2012-08-01 23:37:11
780842,19537,2576063,32,"Probably `@locale = old_locale` should be moved to `ensure` section. Otherwise, something like 
```ruby
TwitterCldr.with_locale(:es) { raise 'asdf' }
``` 
does not switch locale back.",24967329,2013-01-08 19:04:14
780842,19537,2576105,37,"I believe you can 'case' on an object class like that:

```ruby
case proc_or_locale
  when Symbol, String, Proc
    locale_fallback << proc_or_locale
  else 
    raise ""A locale fallback must be of type String, Symbol, or Proc.""
  end
end
```",24967329,2013-01-08 19:08:04
780842,19537,2576129,70,Wouldn't [`Array#reverse_each`](http://www.ruby-doc.org/core-1.9.3/Array.html#method-i-reverse_each) look nicer here?,24967329,2013-01-08 19:10:35
780842,19537,2576159,75,Do you think it's a good idea to hide from users exceptions inside their own lambdas?,24967329,2013-01-08 19:14:58
780842,83686,2580788,37,"Hmm, I don't think that works in 1.9 or 1.8.  Try this:

```ruby
arr = []
case arr.class
  when Array then puts ""Yep, it's an array""
end
```

The `puts` never executes.",24967329,2013-01-09 01:52:34
780842,83686,2580912,75,"Fallbacks are meant to either return a locale symbol, `nil`, or fail silently.  If they raise or return `nil`, the system ""falls back"" on the next fallback or the default locale if no other fallbacks exist.",24967329,2013-01-09 02:00:46
780842,19537,2581020,37,"Remove `.class` call. 

When you do something like this:

```ruby
case obj
  when choice then ...
end
```

Ruby executes something similar to `choice === obj` (note triple equals) for each alternative and selects the first one that returns `true",24967329,2013-01-09 02:07:08
780842,19537,2581308,35,"Wouldn't that go crazy if you pass an unsupported locale? In that case `old_locale` will be undefined, but still used in the `ensure` section.

I think you'll have to do something like that:

```ruby
def with_locale(locale)
  raise ""Unsupported loca",25032286,2013-01-09 02:24:23
780842,19537,2581764,47,Look down.,25032286,2013-01-09 02:55:29
780842,19537,2581765,57,Look up.,25032286,2013-01-09 02:55:36
780842,19537,2581777,63,Another method duplicate. Looks like git failed to merge correctly.,25032286,2013-01-09 02:56:38
780842,19537,2581850,44,"Just curious, why an explicit `nil` here?",25032286,2013-01-09 03:02:55
780842,83686,2584248,44,"Otherwise it returns the fallback proc, which isn't all that useful.",25032286,2013-01-09 06:13:21
780842,83686,2584253,63,"Woops!  Nice catch, that's my fault during the rebase :)",25032286,2013-01-09 06:13:45
780842,19537,2586784,17,"Is that necessary with the `attr_accessor` above? Besides, since a custom getter is defined below, maybe it should be just `attr_writer`.",25082173,2013-01-09 13:14:20
780842,83686,2627753,17,Good call.,25082173,2013-01-13 03:02:56
789290,83686,2597115,23,Just FYI `TwitterCldr.get_locale` is going away in favor of `TwitterCldr.locale`.  See PR #92 :),25230013,2013-01-10 04:42:48
789290,83686,2597177,13,"There's a handy RSpec matcher we wrote (`match_normalized`) that I like to use when comparing text values.  It normalizes both values before comparison, ensuring that characters like non-breaking spaces and accents are treated as equivalent even if their ",25230013,2013-01-10 04:46:47
789290,83686,2597184,58,What's up with the uppercased locale code symbols (eg. `:ES`)?,25230013,2013-01-10 04:47:31
789290,72169,2597191,23,"Ah, excellent changes! I will change to TwitterCLDR.locale when PR #92 is merged in.",25230013,2013-01-10 04:48:04
789290,72169,2597241,58,These are ISO 3166-1 alpha-2 country codes. In CLDR they are (seem to always be) uppercase.,25230013,2013-01-10 04:51:59
789290,72169,2597323,13,"I'll change all the 'should == ""...""' to 'should match_normalized(""..."")' (and I'll also change languages_spec.rb in the same way, which I modeled this file from) but I want to check one thing -- don't we actually want to test that there are no strange no",25230013,2013-01-10 04:56:28
789290,19537,2597591,58,Probably it'd make sense to downcase them for internal consistency – `TwitterCldr::Shared::LanguageCodes` works only with lower case values as you can see [here](https://github.com/twitter/twitter-cldr-rb/blob/master/spec/shared/language_codes_spec.rb). ,25230013,2013-01-10 05:09:54
789290,19537,2597604,58,Great pull request by the way! :+1: ,25230013,2013-01-10 05:11:13
789290,83686,2597628,58,"Yeah, I agree.  Lowercasing would be consistent with the rest of the locale codes in the project.",25230013,2013-01-10 05:12:47
789290,83686,2597731,13,"Normalizing the text before matching won't remove important accent marks and such, it just combines them so the bytes can be compared.  For example, the character **ñ** can either be represented in memory as **n** and **˜** separately or combined into a s",25230013,2013-01-10 05:20:22
789290,72169,2598130,58,"Ah now I see what you mean by ""consistent with the rest of the project"" -- I see that methods phone code and postal code related use lower-cased ISO 3166-1 alpha-2 codes.

I'll make it so all ISO 3166-1 alpha-2 codes are downcased before they are stored",25230013,2013-01-10 05:45:23
789290,72169,2600013,13,Ah I see -- I misunderstood what match_normalized does. Cool. I changed territories_spec.rb and languages_spec.rb to use match_normalized.,25230013,2013-01-10 08:28:31
789290,72169,2600018,58,"I made a bunch of changes to the pull request to store territory codes lower-case, and allow asking for their names from either an upper-case code or a lower-case code. Could you take another look?

Thanks!",25230013,2013-01-10 08:29:33
789290,19537,2601422,12,"I think `TwitterCldr::Utils::Territories` is a better place for these two methods, because they are related only to this feature. On the other hand, `Utils` module is supposed to contain more generic helpers that are used in multiple places across the pro",25261549,2013-01-10 12:58:47
789290,19537,2601591,8,"Looks like the problem is in the way [`ruby-cldr`](https://github.com/svenfuchs/ruby-cldr) dump data. Specifically, in the way they override [this method](https://github.com/svenfuchs/ruby-cldr/blob/master/lib/cldr/export/yaml.rb#L31-L37) of `Ya2YAML` cla",25261549,2013-01-10 13:37:27
789290,72169,2602396,12,"Good point, I moved those two methods to TwitterCldr::Utils::Territories.",25261549,2013-01-10 16:19:05
789290,72169,2608768,40,Done.,25327330,2013-01-11 01:37:17
789290,72169,2608818,12,"Makes sense, the importers are indirectly tested by all the rest of the specs!",25261549,2013-01-11 01:40:12
789290,19537,2609369,40,"Great, thanks! :+1: ",25327330,2013-01-11 02:17:13
789290,72169,2602479,8,"Thank you for the thorough investigation!

Given how many headaches YAML has already caused you (reading the ""Unicode YAML Support"" section of the readme) my guess is time would be better spent refactoring to not use YAML at all =P

Because these UN t",25261549,2013-01-10 16:31:49
789290,19537,2602566,12,"Ah, sorry, I actually meant `TwitterCldr::Shared::Territories` module – the only module (beside auxiliary importer that is used only rarely when CLDR is updated) that uses these methods :( My bad. 

Luckily, you did it step by step, so if you simply rem",25261549,2013-01-10 16:42:12
789290,19537,2602641,8,"Fair enough, I think. 

The biggest problem with YAML is that MRI 1.8.7 is pretty bad at dumping Unicode characters into YAML and most of this gem is about Unicode. @camertron tried to solve it by adopting parts of `ya2yaml` gem internally in TwitterCLD",25261549,2013-01-10 16:51:33
789290,72169,2602741,12,"Hm right I did it in two steps, because I did the first step and then thought it was pretty unclean to have
1) LocalesResourcesImporter have this one static method, and have a spec file that tests only that one method
2) TwitterCldr::Shared::Territories",25261549,2013-01-10 17:01:12
789290,19537,2602904,12,"Importers don't have specs, because they're used only by TwitterCLDR developers and in most cases it's easy enough to check the final resource files that they produce. At least that's how I justified my laziness when I added these importers without a sing",25261549,2013-01-10 17:22:37
789290,19537,2602915,40,I believe you can remove explicit `TwitterCldr::Utils::Territories` since both methods are in the same module now.,25327330,2013-01-10 17:24:30
1884339,83686,5687622,4,Are there any tokens out there that have legit quotes in them?,53055889,2013-08-09 21:51:13
4167318,83686,14980873,6,"Oops, my bad :(",138114383,2014-07-16 09:27:57
4246777,83686,15428646,14,Um...?,141424184,2014-07-26 04:04:25
4246777,83686,15428703,14,"Actually wait, I think this is my fault. The tests in `spec/data_readers/timespan_data_reader.rb` (that you deleted) should be placed here.",141424184,2014-07-26 04:05:51
4246777,19537,15428770,14,"Yeah, but they were for the old tokenizer implementation and were not even wrapped with a `describe` block. I want to get the missing locales added to JS version as soon as possible, so I didn't take care of these tests yet. I might look into it afterward",141424184,2014-07-26 04:08:18
4246777,83686,15429131,14,"They weren't wrapped in a describe block and their file didn't have the `_spec` suffix because I hadn't yet ported them, and then totally forgot. I might be able to take a look at adding them back in.",141424184,2014-07-26 04:17:45
4766661,83686,18475868,27,"We require anyone using 1.8.7 to have [oniguruma](http://www.geocities.jp/kosako3/oniguruma/) installed, which supports the second argument for `#match`. Let me suggest adding this private method to the class, then calling it in the constructor:

```rub",165252093,2014-10-06 23:35:49
4829734,19537,18319099,14,"This and the next line need to be reverted, right?",161560596,2014-10-02 06:43:26
4829734,19537,18319185,71,Can we (and should we) remove the original `plural_rules.yml` file after we save pre-processed `plurals.yml`?,161560596,2014-10-02 06:47:29
4829734,83686,18322309,14,"Oh dang, yes they do.",161560596,2014-10-02 09:55:25
4829734,83686,18322330,71,"We could, although `twitter-cldr-js` relies on that data to build its own plural code. I thought it probably wouldn't be a problem to include in the ruby version because the files are quite small. What do you think?",161560596,2014-10-02 09:57:06
4829734,19537,18358169,71,Sounds good :+1: ,161560596,2014-10-02 23:34:04
4829734,19537,18673583,7,"There is an issue with these plural rules. If you check cldr [data](http://unicode.org/cldr/trac/browser/tags/release-26/common/supplemental/plurals.xml#L16) Korean has only one plural form `other` while our resource file contains `one`, `few`, `many`, an",162327125,2014-10-10 01:55:04
4829734,83686,18676802,7,"Ok, thanks @KL-7 :)",162327125,2014-10-10 02:49:01
4852878,19537,18609387,13,binding.pry,162329051,2014-10-09 01:21:04
4904268,19537,18605286,4,"Not really related to other changes, but this constant is not used anymore, so I removed it.",167978630,2014-10-09 00:12:27
5738674,83686,22475100,5,"According to the docs, `#wear!` causes results to be sent to Coveralls whenever the project is built on Travis. I did a cursory read of the source code and it didn't look like that was true... I must have missed something.

Also, twitter-cldr-rb uses Si",202643643,2015-01-06 00:33:47
5738674,12202,22475168,5,Feel free to do that as you're more familiar with Ruby than I am :),202643643,2015-01-06 00:35:02
5738674,83686,22475253,5,"Alright, I'll see what I can do :)",202643643,2015-01-06 00:36:36
5738674,19537,22677064,5,"I'm not sure how it works, but coveralls already has [a few reports](https://coveralls.io/r/twitter/twitter-cldr-rb) for this repo.",202643643,2015-01-09 02:58:16
5738674,12202,22677885,5,"Ya, those were me pushing things locally",202643643,2015-01-09 03:11:49
5738674,19537,22679276,4,"Our readme is generated from `README.md.erb`, so all the changes should go in there. Then you run `bundle exec rake update:readme` and it updates `README.md`. Could you do that? If you don't have environment set up, I can help with that.",202643643,2015-01-09 03:31:36
5738674,19537,22679352,4,"I mean helping with updating the readme, not with setting up the environment.",202643643,2015-01-09 03:32:48
5738699,83686,22474335,5,Will this have any effect on running tests locally?,202644292,2015-01-06 00:20:13
5738699,12202,22474477,5,"trying to figure this out in Ruby land myself:
https://coveralls.zendesk.com/hc/en-us/articles/201769485-Ruby-Rails

Looks like it should magically post the results after running specs",202644292,2015-01-06 00:23:10
8128939,83686,33119557,5,Probably only a minor version bump required for this PR since your changes are purely additive.,273435572,2015-06-24 11:08:42
8128939,179888,33121949,5,"Did you mean patch? If so, patch is the last number and indicates a bug fix. Otherwise this is a minor version bump since it is an addition:

http://semver.org/",273435572,2015-06-24 12:04:55
8128939,83686,33158593,5,"Misread this, you're right.",273435572,2015-06-24 20:19:12
9381175,19537,40009236,9,"If the whole hash can't be converted to the new syntax, I usually leave it with the old one entirely. I think mixing the two doesn't look that good.",315260983,2015-09-21 23:45:11
9381175,83686,40009895,9,"Ok good call, thanks!",315260983,2015-09-21 23:50:46
9381175,19537,40011068,3,"Uh, here's another mixed hash. I think that's the last one.",315260951,2015-09-22 00:00:09
9381175,83686,40031135,3,Nice catch!,315260951,2015-09-22 02:50:24
9455910,19537,40517797,25,"You can simply do `File.write(@output_path, YAML.dump(parse_scripts))` ",316026905,2015-09-28 09:25:13
9455910,19537,40517822,10,Do you mind sorting these?,316026905,2015-09-28 09:26:07
9455910,19537,40517864,20,Can we use [Enumerable#max_by](http://ruby-doc.org/core-2.2.3/Enumerable.html#method-i-max_by) here?,316026905,2015-09-28 09:28:47
9455910,19537,40517899,53,`Hash.new(0)`,316026905,2015-09-28 09:30:16
9455910,19537,40517929,17,That's an honor :heart: ,316026905,2015-09-28 09:31:45
9455910,19537,40517963,14,"Do we ever use these distinct overlap cases? If not, can we replace these three conditions with [this implementation](https://github.com/rails/rails/blob/master/activesupport/lib/active_support/core_ext/range/overlaps.rb)?",316026905,2015-09-28 09:33:39
9455910,19537,40517897,50,"Considering how weird `protected` is in Ruby, I'd suggest to stick with `private`, unless it doesn't work.",316026905,2015-09-28 09:30:00
9455910,83686,40518920,25,Cool! Didn't know you could do that.,316026905,2015-09-28 10:19:20
9455910,83686,40519062,50,Oh really? What's weird about `protected`? I use it all the time.,316026905,2015-09-28 10:25:40
9455910,83686,40519047,20,"Yes except - and you're going to think I'm crazy - `#each_pair` is more efficient. If we use `#max_by`, a new array is created for each key/value yield. This probably falls directly into the category of premature optimization, since the `scores` hash is l",316026905,2015-09-28 10:25:06
9455910,83686,40518923,10,No problem.,316026905,2015-09-28 10:19:26
9455910,83686,40519127,17,Hehehe you're name is now immortalized ;),316026905,2015-09-28 10:27:53
9455910,19537,40520109,50,"Well, Ruby's `protected` is quite different from Java's. It has nothing to do with inheritance and its only difference from `private` is that you can call protected methods with explicit receiver if the caller is of the same type. Basically it allows an o",316026905,2015-09-28 11:01:57
9455910,19537,40520153,20,"Yeah, I'd probably prefer simplicity over premature optimization, but it's up to you.",316026905,2015-09-28 11:03:22
9455910,83686,40520637,14,"Originally no, these overlap cases were all part of a single `#overlap?` method. During the development of this branch, I added a class called `RangeHash` and extracted the overlap cases out into the `RangeHelpers` module so `RangeHash` and `RangeSet` cou",316026905,2015-09-28 11:17:22
9455910,83686,40520982,50,"Ok, that makes sense. I also read an article by Aaron Patterson who says he finds `protected` to be the most useful when writing comparison operators. I see the logic behind the existence of `protected`, but I guess all these years I've been using it more",316026905,2015-09-28 11:27:49
9581239,19537,41783867,6,"If you want these to be wrapped, I'd probably break them down line by line.",326977185,2015-10-12 23:06:58
9581239,19537,41783983,18,private?,326977185,2015-10-12 23:08:13
9581239,19537,41784320,35,"Do you think we could do

```ruby
first_lookup(locale) ||
  second_lookup(locale) ||
  third_lookup(locale) ||
  fourth_lookup(locale)
```
instead of making these methods call each other? It'd keep them separated and might make it easier to test/d",326977185,2015-10-12 23:11:58
9581239,19537,41784925,29,Might be safer to do `locale_text = locale_text.strip` here in case someone keeps using that string outside of the method.,326977185,2015-10-12 23:16:48
9581239,19537,41785075,62,private?,326977185,2015-10-12 23:18:19
9581239,19537,41785091,28,private?,326977185,2015-10-12 23:18:29
9581239,19537,41785117,28,private?,326977185,2015-10-12 23:18:40
9581239,19537,41785702,197,Any ideas why this one wasn't encoded as `:no`?,326977185,2015-10-12 23:24:50
9581239,19537,41785842,159,When would this be an array? I couldn't find any arrays in the `:language` section of `aliases.yml` file.,326977185,2015-10-12 23:25:52
9581239,19537,41785922,191,Could use `unless` or `||=` instead.,326977185,2015-10-12 23:26:38
9581239,83686,41897739,197,"Not completely sure... probably because of this:

```ruby
YAML.load(""no"")  # => false
```

Although this works:

```ruby
YAML.load("":no"")  # => :no
```",326977185,2015-10-13 22:30:19
9581239,83686,41897845,159,Hmm don't remember. I'll investigate.,326977185,2015-10-13 22:31:01
9664791,19537,41076268,29,"Hacking back in time?
![hacking](http://musictechfest.net/wp-content/uploads/2015/05/geek.jpg)",319864980,2015-10-03 03:53:02
9664791,83686,41089038,29,LOL! Should be fixed now.,319864980,2015-10-03 21:48:31
9664791,93794,41090715,54,You can get rid of a level of indentation here by using `next unless regex = get_regex_for(territory)` to get rid of the conditional :),320614844,2015-10-04 00:22:47
9664791,19537,41091932,22,Nice! :+1: ,320677620,2015-10-04 02:48:06
10718812,19537,48195451,101,I'd collapse this condition into `properties_hash[property_name] || true`,350776102,2015-12-22 05:40:50
10718812,19537,48195711,38,"Should we handle `else` somehow? This method is used in a few places that won't be able to handle `nil`, so we might as well throw an appropriate exception here.",350776102,2015-12-22 05:42:59
10718812,19537,48195795,56,Why `begin..end`?,350776102,2015-12-22 05:43:48
10718812,83686,48366055,38,"I'm actually not sure when the `else` case would ever happen, since the three possible cases are handled in the tests already (missing name, missing value, missing name and value). In all three cases the method returns an empty `RangeSet`. Just in case, I",350776102,2015-12-24 01:56:22
10718812,83686,48366134,56,I think this used to be a longer method.,350776102,2015-12-24 01:57:29
11202202,19537,48184429,58,You can use `File.write` here.,363347894,2015-12-22 03:59:09
11202202,19537,48184509,54,Might be more readable with `if`.,363347894,2015-12-22 03:59:59
11202303,19537,48185036,77,"Unless there's a difference, I'd suggest to stick with `.size`.",363350323,2015-12-22 04:05:14
11202303,19537,48185170,80,`(low + high) / 2`?,363350323,2015-12-22 04:06:35
11202303,19537,48186152,63,"Uh, I got confused for a second here with this mix of -1/0/1 and booleans. How about separating this into an early return and placing it above the condition?

```ruby
bsearch do |cur_range|
  return false if front_overlap?(..) || rear_overlap?(..)

",363350323,2015-12-22 04:15:52
11202303,83686,48280145,80,Heh can you tell this code was copied/pasted from somewhere else? :sunglasses:,363350323,2015-12-23 02:06:19
11202303,83686,48280314,63,Good idea :),363350323,2015-12-23 02:08:23
11202530,19537,48186376,6,We have `CLDR_VERSION = '26.0'` in `lib/twitter_cldr.rb`. Can we combine these two somehow? I'd also suggest moving version constants for Unicode and ICU into `lib/twitter_cldr.rb` too.,363354849,2015-12-22 04:18:21
11202530,19537,48186686,27,I think you can use `u.chomp('/')` here to avoid this scary escaping.,363354849,2015-12-22 04:20:22
11202530,83686,48280771,6,"That's a great idea. I could also move them into version.rb, or perhaps create a new module for them.",363354849,2015-12-23 02:13:30
11202530,83686,48280837,27,:fearful: escaping,363354849,2015-12-23 02:14:05
11202530,19537,48280896,6,I'd just leave them at the top of the root `TwitterCldr` module to make them easy to find.,363354849,2015-12-23 02:14:39
18426470,83686,86269120,24,March?,546592827,2016-11-03 07:08:34
18426470,20163,86333517,24,"Fixed! I revert to Swedish when I'm tired ???? 
",546592827,2016-11-03 19:42:00
78475,27684,637972,12,typo? src/java/com/twitter/common/commons/BUILD does not exist,106583,2012-04-03 14:13:23
78475,27684,637995,98,"With a new name and some docs, I'd prefer this be elevated to the fundamental public interface for the user-supplied node value materializer.  I think anytime you have a function that takes more than 1 arg in a public interface, its more clear to create a",106583,2012-04-03 14:19:57
78475,27704,638406,12,"Indeed. I meant to type ""collections"" there.",106583,2012-04-03 16:47:13
78475,27704,638427,98,"Sounds sensible. I think I'll rename 'createWithStat' to 'create'. I don't like the name, and only chose it because the compiler would use type erasure to translate Function&lt;byte[], T&gt;.

I'll add NodeDeserializer to the zookeeper package.

Updat",106583,2012-04-03 16:54:02
78475,27684,642270,104,kill extra blank line above and kill @Nullable below - looks like you never pass null,106581,2012-04-04 03:50:21
78475,27684,642275,96,"Add T docs:
[newline]
@param <T> .....",106581,2012-04-04 03:50:55
78475,27684,642280,21,this should chain to once of the creates below,106581,2012-04-04 03:52:29
368111,27697,1582996,5,"if getattr(target, 'internal_dependencies', None):
  ...

achieves the same thing",11062305,2012-09-12 07:42:06
368111,27677,1589599,5,"Fixed as requested.

On Tue, Sep 11, 2012 at 7:42 PM, brian wickman <notifications@github.com>wrote:

> In src/python/twitter/pants/targets/internal.py:
>
> > @@ -62,7 +62,7 @@ def sort_targets(cls, internal_targets):
> >      def invert(target):
",11062305,2012-09-12 22:34:23
381503,27684,631975,4,Hah - this actually fixed problems with classes being examined by checkstyle that depended on thrift gen code iirc.  I'll test on our codebase to confirm.,11513978,2012-04-02 13:36:08
381503,27684,638015,12,"you could use self.context.id
see context.identify: https://github.com/twitter/commons/blob/master/src/python/twitter/pants/goal/context.py#L32
If you wan't to change that to use sha1 instead of md5 - sgtm",11513978,2012-04-03 14:26:55
381503,27677,653697,12,"I *think* the pull request now contains a revert for the checkstyle
thing. It also contains other commits that are already in your repo,
not sure why.

On Tue, Apr 3, 2012 at 2:26 AM, John Sirois
<reply@reply.github.com>
wrote:
>> @@ -120,18 +121,3",11513978,2012-04-06 07:04:22
828289,27684,2733912,4,I think MockPantsTarget can just extend object now,25927788,2013-01-23 05:17:24
828289,27684,2733919,1,this fellow should have a license header too - Foursquare Labs lgtm,25927788,2013-01-23 05:17:43
828289,27707,2734185,4,good point. done,25927788,2013-01-23 05:35:01
828289,27707,2734188,1,done,25927788,2013-01-23 05:35:10
828289,27707,2734197,38,done,25927788,2013-01-23 05:35:37
828289,27684,2733952,38,">100 cols
  ",25927788,2013-01-23 05:18:50
1457519,27697,4162447,6,"Please build artifacts for macosx-10.4-x86_64

As it stands, 10.8-intel won't work with most Twitter laptops, including mine, whereas 10.4-x86_64 should include everything we've had in the last four years.

See https://gist.github.com/wickman/5550908 ",40387212,2013-05-10 02:52:17
1457519,27697,4162479,49,"This doesn't make sense to me.  'platform' is never populated for SourceLinks -- how could this ever be used?  SourceLinks are only e.g. .zip, .tar.gz, .tgz",40387212,2013-05-10 02:54:10
1457519,27684,4163162,49,"Yeah - so the translator can only in practice translate for the current platform.  If the pants.ini or python_binary asks for a non-native platform, without this fix, a SourceLink will happily build for the native platform and return success.  We ask for ",40387212,2013-05-10 03:37:18
1457519,27684,4163226,6,Yup - Benjy added the old eggs (https://github.com/twitter/commons/tree/binaries/pants/third_party/python/dist) so I'll fix down.,40387212,2013-05-10 03:41:26
1457519,27684,4166566,49,Oops - read better and you're right - link.platform should be Platform.current(),40387212,2013-05-10 11:09:40
1581229,61891,4665923,37,"I think, this is a typo. It should be extras_path

Otherwise, it crashes with a NameError

NameError: global name 'extra_paths' is not defined",45144690,2013-06-13 01:17:41
1870453,86230,5518846,55,Fixed,52967630,2013-08-01 04:16:32
1870453,530795,5518565,44,"Also, please be consistent about single and double quotes.",52967630,2013-08-01 04:02:03
1870453,86230,5518885,35,Fixed. I think. It looked fine in my text editor but I redid the spaces so it should have fixed it. ,52967630,2013-08-01 04:18:51
1870453,86230,5518858,59,Fixed,52967630,2013-08-01 04:17:07
1870453,530795,5518607,54,Style convention suggests a space after function parens: ```function() {```,52967630,2013-08-01 04:04:17
1870453,530795,5518558,44,"Don't space-pad attributes, e.g. ```class='selectlevels'```",52967630,2013-08-01 04:01:42
1870453,530795,5518545,40,Feel free to collapse this td tag to a one-liner: ```<td>$logger.name$</td>```,52967630,2013-08-01 04:01:11
1870453,530795,5518516,30,"Remove trailing space in ""Logger Config "".",52967630,2013-08-01 03:59:46
1870453,530795,5518520,35,Indenting is off here.,52967630,2013-08-01 04:00:03
1870453,86230,5518746,54,Fixed,52967630,2013-08-01 04:11:46
1870453,86230,5518730,44,Fixed,52967630,2013-08-01 04:11:05
1870453,86230,5518714,40,Fixed,52967630,2013-08-01 04:09:45
1870453,86230,5518700,30,Fixed,52967630,2013-08-01 04:09:04
1870453,530795,5518635,66,"Are there two newlines at the end of the file?  If so, please remove one.",52967630,2013-08-01 04:05:40
1870453,530795,5518624,59,"Space padding for arguments is generally ```arg1, arg2``` (no space before comma, space after comma)",52967630,2013-08-01 04:05:12
1870453,530795,5518614,55,"Please add comments for these chunks to aid in readability.  For example:
```// Set the value of each select to match the logger's current level.```",52967630,2013-08-01 04:04:32
1870453,86230,5518925,66,Fixed,52967630,2013-08-01 04:20:58
1888689,530795,5623611,20,I can't find any callers to CheckExclusives .get_classpath_for_group.  Can/should it be removed?,53084618,2013-08-07 09:47:04
1888689,27684,5631879,20,"Nope:
```console
$ find {src,tests}/python/twitter/pants -name ""*.py"" | xargs grep get_classpath_for_group
src/python/twitter/pants/tasks/checkstyle.py:    cp = egroups.get_classpath_for_group(etag)
src/python/twitter/pants/tasks/check_exclusives.py: ",53084618,2013-08-07 19:01:12
1987772,26920,5989303,6,You can return Collections.emptyList() instead.,57019650,2013-08-27 01:47:56
1987772,26920,5989328,13,"You don't have to add an empty list to subtokens.
if (tokens != null) {
  subtokens.addAll(tokens);
}",57019650,2013-08-27 01:48:43
2987646,61891,9607348,14,HTTPException might be better idea IMO. It may capture more http related exceptions than just BadStatusLine,88501414,2014-02-11 06:21:57
2987646,21784,9608619,14,"Good idea! See  518bb4b
",88501414,2014-02-11 07:01:07
2987646,27684,9675545,5,"Importing http.py's import of HTTPException here is a bad sign.  I think the right fix is to encapsulate all fetch errors in http.py's Web and CachedWed as FetchError's there so that here you can trap that exception type cleanly.  They handle their layer,",88739337,2014-02-13 00:01:33
2987646,21784,9693615,5,"OK, I changed and rebased so now there's a `FetchError`. How's that look?",88739337,2014-02-13 07:51:52
3312897,418424,10855033,6,"It's

as in

It's embarrassing that I don't know the Pull Request idiom for ""Ship It, but if you were gonna go in to change stuff anyhow, here's a typo.""",98068636,2014-03-22 03:17:34
3872741,27697,13832246,12,"recommend 'from twitter.common.http.server import request'
should the interface of twitter.common.http change in the future, this will make it easier to track users of the 'request' object.",125707623,2014-06-17 02:37:51
3872741,27697,13832320,27,"no trailing slashes, instead do
help = 'foo bar'
           'baz bak'
",125707623,2014-06-17 02:38:52
3872741,27697,13832400,24,"rather than making comma reserved, you could just do default=[], action='append' and then allow the user to specify the flag multiple times, e.g. --vars-stats-filter foo --vars-stats-filter bar",125707623,2014-06-17 02:40:18
3872741,27697,13832518,30,vars_subsystem (no camelCase),125707623,2014-06-17 02:42:53
3872741,27697,13832526,32,no ()s on asserts,125707623,2014-06-17 02:43:10
3872741,27697,13832546,48,no spaces before/after '=' in the keyword arguments of VarsEndpoint(),125707623,2014-06-17 02:43:34
4186169,48823,15082359,42,"I'm a -1 on the vague ""properties"" blob- instead I'd say we explicitly add fields we expect.

In that line, is there a 'server set version' proper tie somewhere? If we're starting to iterate on contents like this, we may benefit from explicit versioning",138932018,2014-07-18 01:37:13
4186169,81379,15178336,42,"what problems do you envision with having properties be a free-form Map<str, str>? we could probably document it as ""additional info"" to avoid people depending on it as stable API, but besides that i don't really see much risk and predefined keys sounds t",138932018,2014-07-21 21:17:38
8523884,48823,35902786,7,"Mind adding `autospec=True, spec_set=True` to these patches?",282364708,2015-07-30 23:23:46
8523884,48823,35903004,17,"mind moving this to:

```
assert mock_http_request.mock_calls == [mock.call( ""api/review-requests/?start=0&max-results=25"",
    None, None, {'Accept': 'application/json'}, method=None)]
```

We've found this helps make mocked calls much more explic",282364708,2015-07-30 23:25:31
9365750,61891,40158209,5,"-1.
%sr is meaningless. In case, if self.url is sent without trailing '/'. This will break. Instead, having // seems better as it can cause no harm.
",315118312,2015-09-23 04:38:32
9365750,3879260,40159721,5,did you click https://github.com/twitter/commons/blob/master/src/python/twitter/common/reviewboard/reviewboard.py#L79-L80?,315118312,2015-09-23 05:00:53
9365750,47822,40160031,5,"use os.path.join() on these two things. ""Causing no harm"" doesn't mean it's not incorrect. ",315118312,2015-09-23 05:05:36
9365750,3879260,40162169,5,"I've changed it to use urljoin, which will produce the correct result regardless of whether self.url has a '/'.",315118312,2015-09-23 05:41:12
9365750,61891,40162424,5,"@slyphon Ack. 

@landism 
* You could fix that at sender, if suitable.
* or change to ```return self.url  + 'r/%s' % (rb_id)```  which I assume was the original intention.
* os.path.join() is okay, but is a hack in my opinion as rules of url joins ar",315118312,2015-09-23 05:46:23
9365750,47822,40163008,5,"In what way are the rules of url joins different from path joins, when you're trying to join an element to the end of a url? In what instance do you see this failing?",315118312,2015-09-23 05:57:32
9365750,47822,40163257,5,"Wait

```py
>>> ""%sr/%s"" % (url, ""fungus"")
'https://foo.host/bar/r/fungus'
>>> url + ""r/%s"" % (""fungus"",)
'https://foo.host/bar/r/fungus'
```
you need to put a ',' in your tuple when using % interpolation. the ',' is what makes it a tuple, not the",315118312,2015-09-23 06:02:36
9365750,61891,40163259,2,s/2011/2015/g,315118294,2015-09-23 06:02:40
9365750,27684,40163285,5,The most obvious answer is posixpath vs ntpath - though commons makes no pretense of supporting windows in general.  That said - url tools wipe away the ambiguity.,315118312,2015-09-23 06:03:19
9365750,47822,40163356,5,"@jsirois yeah, i had that thought in backchannel conversations. It's never come up for me, but yeah, I suppose if someone ran it on windows it could cause issues.",315118312,2015-09-23 06:05:22
9365750,61891,40163358,18,"It should be
```
from twitter.common.reviewboard import ReviewBoard

import pytest
```

* That is, import reorder and a newline between first and the second.

With these two comments addressed, you could merge it in. #shipit ",315118294,2015-09-23 06:05:25
15858486,85880,74689407,39,"How are you trying to use this, can you provide a bit more surrounding code?

`use_hadoop_v1` should be passed in to the `HDFSHelper` if you want to set it to a non-default value.  The default is `False`.

This variable is only used in the initializer",472762125,2016-08-14 00:07:35
15858486,2101068,74543274,39,"This is breaking our recent build, use_hadoop_v1 does not seem to be a class member
```python
self._use_hadoop_v1 = use_hadoop_v1
```
seems to be missing initialization ",472762125,2016-08-12 12:35:54
23193214,106030,110285583,47,is this no longer useful/necessary?,664226867,2017-04-07 05:54:15
23193214,51152,110285873,47,The cache is on by default for everything now.,664226867,2017-04-07 05:56:20
31282781,290827,151318315,12,"maybe something like the following would be a bit cleaner?

```python
commands_and_docstrings = self.get_commands_and_docstrings()
if sort:
  command_and_docstrings = sorted(command_and_docstrings)
```",838283760,2017-11-16 12:21:38
33684899,106030,162155291,13,intentional?,891178479,2018-01-18 03:31:02
33684899,51152,162155839,13,"Yes: Putting something in the plugin list enables it, so having this here was enabling it twice, which now causes an error.",891178479,2018-01-18 03:33:10
33684899,106030,162162146,13,"ah, cool",891178479,2018-01-18 03:56:39
44434511,48823,212007542,8,Sweet! How’d you generate this? Mind replacing the `knjk04` with `twitter`? ????,1108879407,2018-08-22 22:47:36
44434511,12036460,212012146,8,"I typed this out by hand! Yeah, sure. Sorry, I didn't realise I was getting the links from my for :)

I can look into ways to generate the TOC. It's probably easier for everyone else.",1108879407,2018-08-22 23:00:05
44434511,12036460,212022526,8,Update: I've made the changes you asked for in a different branch. See PR: https://github.com/twitter/commons/pull/467,1108879407,2018-08-22 23:30:14
24055,84606,421322,13,Need an HTML escape here.,3604958,2012-02-07 06:00:25
24055,84606,421324,57,"Need to HTML escape beforeDisplayURL, afterDisplayURL, and displayURLSansEllipses.",3604958,2012-02-07 06:01:07
24055,26920,424653,13,It's already escaped in line 95.,3604958,2012-02-08 01:56:55
24055,26920,424654,57,Done!,3604958,2012-02-08 01:57:02
4084379,19537,14910622,4,"Can we avoid string concatenation here and just use the final `""(?:(?:co|tv)(?=[^\\p{Alnum}@]|$))""` string? ",134576821,2014-07-15 04:35:14
4084379,14016,14910915,4,"Yes, we can. I was a little worried when we will have many ccTLD in here in the future :)",134576821,2014-07-15 04:43:57
4084379,19537,14910964,4,"Oh, I see. You can put them in a separate constant right away then. It's up to you though.",134576821,2014-07-15 04:45:22
4084379,179888,14911136,4,"I like the fact that it is split, easier to read :)",134576821,2014-07-15 04:51:14
4084379,14016,14911272,4,"Indeed, having many same string like `"")(?=[^\\p{Alnum}@]|$))""` isn't cool :P",134576821,2014-07-15 04:55:23
33737,26920,772100,8,"I ran 'rake' on this branch and it failed, and I believe the following patch will fix it.

\-  require ""twitter-text/#{name}""
\+  require File.join(File.dirname(\_\_FILE\_\_), ""twitter-text"", name)`

If this look ok, can you update the pull request?",3938901,2012-05-04 07:38:37
34567,26920,469180,112,"I think it makes sense to make this method public so that clients can get entities from API (with ""include_entities=true"") and call this method to auto-link.",3324809,2012-02-21 06:54:54
34567,26920,469183,67,"s/entties/entities/

also in line 46 and 54",3324809,2012-02-21 06:56:24
34567,3214,473117,67,D: will fix.,3324809,2012-02-22 03:57:03
34567,3214,473160,112,"Okay, I'll revert them as public.
I'll talk you how we use url_entities and work with entities extracted by APIs on twitter-text later.",3324809,2012-02-22 04:10:00
42134,26920,918575,5,I guess this doesn't perform Unicode Normalization Form NCF. Is there any unicode gem we can use instead?,4108179,2012-06-02 05:38:15
370642,26920,403300,4,Can you revert this change? I'll upgrade the version when I release a new gem.,11145103,2012-02-01 02:55:00
370642,485754,404816,4,Done:),11145103,2012-02-01 08:35:39
7023,64978,1143019,5,The prior behavior should match how this library works with a real cassandra cluster. Does it not?,1132701,2012-07-11 23:26:58
7023,166590,1143540,5,"i'm getting a failure when i use the mock cassandra, which i believe i
being caused by the following:

in get(), extract_and_validate_params_for_real() gets called, which maps
the column name being looked up to the correct type as defined in the
schema, s",1132701,2012-07-12 00:21:06
7023,166590,1145672,5,"here's what i think is a better fix:

https://github.com/cardspring/cassandra/commit/90baff94d2ed032a966d79ebf259b9a68dd3650a

and here's a simple test to reproduce the bug i'm seeing:

    require 'cassandra/1.0'
    require 'cassandra/mock'
    schema_s",1132701,2012-07-12 04:15:57
62768,360025,1202350,4,"ToolRunner() sets the conf. We should just remove it here. It will give you the same effect anyway.
I hate ToolRunner.",4418206,2012-07-20 05:13:59
62768,360025,1202352,4,we will have a different patch to fix it.,4418206,2012-07-20 05:14:21
1125236,360025,444965,70,This is a bit problematic one to implement and forces us to process the whole file at once.,29462446,2012-02-14 01:34:41
1125236,360025,444970,94,"as discussed, this copies the whole file until EOF.",29462446,2012-02-14 01:35:13
1125236,360025,445121,35,"the last block could be arbitrarily small. This essentially limits overall size of a block to 32K.

We could varints, Simple varints in ProtocolBuffers takes 10bytes for negative integers. We can use ZigZag encoding ( http://code.google.com/apis/protocolb",29462446,2012-02-14 02:01:59
1125236,115552,451754,70,Fixed.,29462446,2012-02-15 13:45:05
1125236,360025,454351,90,"how about writing delta from previous block size? 
this will also adapt well to compressibility changes changes over a large file (extremely rare).

then we don't need wroteFirstBlock, since prevBlockSize would be zero.  ",29462445,2012-02-16 02:23:19
1125236,360025,454378,113,this returns an Interger?,29462445,2012-02-16 02:29:44
1125236,360025,454382,113,"oh, no. it is auto boxing.",29462445,2012-02-16 02:30:37
1125236,360025,465753,120,is.available() does return 'file_len - cur_pos' for HDFS file. But not for LocalFileSystem. I don't think we should depend on that.,29462445,2012-02-20 06:37:38
1125236,360025,465758,120,"oh, 'is' is a DataInputStream and JavaDoc says it throws EOFException for readByte() used by readSignedVarInt(). So depending on EOFException detection of EOF seems fine. So we can remove is.available() check.",29462445,2012-02-20 06:42:19
1185379,360025,3126975,10,"can you remove "" and restart your job""? The codec is outside of MR jobs as well. May be better to rephrase it to remove the first ""You "" as well.",31785552,2013-02-23 23:49:00
1555896,12202,4572610,5,should we change this to com.twitter if we plan to publish to maven central?,43893292,2013-06-06 22:23:31
1555896,12202,4572648,9,"Can you add a <description> and <developers> tag?

Just wanting to make sure we meet the Central Sync requirements:
https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-6.CentralSyn",43893292,2013-06-06 22:25:23
1555896,918962,4574122,5,"It's a good question. It's more for the ""community"" to chime in. Should we change the group id? If so, to what?",43893292,2013-06-06 23:22:15
1555896,918962,4574657,9,"What did you mean by ""add a and tag""?",43893292,2013-06-06 23:43:33
1555896,12202,4574898,9,"Ah, github stripped the HTML tags.

description and developers tags",43893292,2013-06-06 23:54:36
1555896,918962,4576046,9,Got it. Thanks. Who should be in the developers section? Who are the recognized committers? I guess Raghu and Travis should be there (and maybe I can throw my name there). Anyone else?,43893292,2013-06-07 00:45:20
1555896,12202,4576059,9,Just the recognized committers.,43893292,2013-06-07 00:46:00
1555896,918962,4803822,14,"[from Raghu] for hadoop dependency we can use 'hadoop-client' rather than common & mapred-core etc. 
in Elephant-bird: https://github.com/kevinweil/elephant-bird/blob/master/pom.xml#L246",43980306,2013-06-20 23:33:01
1555896,918962,4804142,14,"We could do that. ""Hadoop-client"" is a superset of hadoop-common + hadoop-mapreduce-client-core. However, as good hygiene, I would prefer to describe the exact direct dependencies. That would tend to keep your transitive dependencies slim and prevent depe",43980306,2013-06-20 23:44:58
2060628,360025,6198921,7,mvn clean test -P hadoop-old?,57649219,2013-09-06 05:50:50
2060628,918962,6199173,7,You're right. Mvn clean test might be bit better (although the end result is likely to be the same).,57649219,2013-09-06 06:09:25
2066553,918962,6160930,41,I'm not sure if you want to return 1 here. Wouldn't that mean it would return 1 even if all succeeded?,57786981,2013-09-04 22:49:19
2066553,918962,6160940,44,Perhaps error() might be more appropriate?,57786981,2013-09-04 22:49:42
2066553,918962,6161287,53,"Hmm, is this right? Why would we look for getCounter(String, String) when the invocation will be done with a single Enum? Wouldn't this blow up on invocation? Also, do we need to catch this exception? If it's v2, TaskAttemptContext better be there.",57786981,2013-09-04 23:00:29
2066553,918962,6161388,58,The same deal here. I think we should look for getCounter(Enum).,57786982,2013-09-04 23:03:38
2066553,918962,6161517,28,"I assume that this condition would always be true (but is there just to be on the safe side). If this were to happen, the implication is that we would miss counts, right?",57786982,2013-09-04 23:07:03
2066553,918962,6161625,88,Don't you need to increment the counter here also?,57786982,2013-09-04 23:10:42
2066553,360025,6161910,88,here 'return true' indicates there is more input.,57786982,2013-09-04 23:19:23
2066553,918962,6161959,88,Oh that's right. This is a record reader. Thanks for the clarification.,57786982,2013-09-04 23:21:16
2066553,360025,6162559,53,"you are right.. [ I should have just waited till I tested the code :) ]. I copied 'String' version from HadoopCompat and didn't update to Enum version properly.

I don't remember why I caught this exception in EB and retried this way.",57786981,2013-09-04 23:39:10
2066553,360025,6162569,53,I will EB and will remove catching the exception.,57786981,2013-09-04 23:39:31
2066553,360025,6163391,53,catching the exception was added in pull 320 (for CDH4). Should we just use EB's hadoop-compat?,57786981,2013-09-05 00:04:24
2066553,918962,6163725,53,"I think keeping our own version here is OK, in the sense that we remain conscious of adding new use of incompatible invocations.

I also suppose the exception handling is fine (I guess there are some 2.0-like distros that do not have the TaskAttemptCont",57786981,2013-09-05 00:16:13
2066553,360025,6175144,28,"practically yes. This would be true in case case of actual MR job as with DistributedLzoIndexer. It may not be true in if one actually uses this record reader outside MR (it happens with other record readers), this may not be true.",57786982,2013-09-05 12:18:23
2229010,360025,6904250,55,"conf.get(USE_BINARIES_ON_LIB_PATH)

How about a test that forces loading from jar?",59221090,2013-10-11 04:20:43
2229010,918962,6904716,55,"This is invoked as part of initializing the GPLNativeCodeLoader class, and it would be awkward to try to pass a conf object. That's why I think a system property is a reasonable choice. Is that what you meant?

Also, are you talking about adding a unit ",59221090,2013-10-11 04:48:53
2229010,360025,6904972,55,"system property is fine. I mistook getBoolean() to parseBoolean(). didn't realize getBoolean actually loads system property. 

regd test, they do exercise unpackBinaries() etc?",59221090,2013-10-11 05:04:34
2229010,918962,6905087,55,"Ah yes. It's bit of an obscure fact that Boolean.getBoolean() does that.

Yes, the tests exercise unpackBinaries() fully.",59221090,2013-10-11 05:11:34
4392384,1443419,16145119,53,"This is too restrictive. With high compression levels and a large FS block, you might still want to split the FS block to get a spill-less mapper. I would make the threshold configurable.",148553153,2014-08-13 02:45:23
4392384,1443419,16145439,99,Make this API with FileStatus instead of Path in order to avoid redundant RPC for getFileStatus. We already received FileStatus from listStatus. ,148553153,2014-08-13 02:50:50
4392384,4859990,16150481,53,"That's a good point. Does a default value (if user's config has a bunk value like ""abc"") of block size make sense?",148553153,2014-08-13 04:44:14
4392384,918962,16908445,23,"33-38: if these are meant as constants (which I think they are), they should be private static final's.",149972471,2014-08-29 21:58:51
4392384,918962,16908465,28,The same here...,149972471,2014-08-29 21:59:21
4392384,918962,16909000,53,I am not 100% happy with having to query the file status again. I know the PathFilter API doesn't help you there. I think it's perfectly fine to have a simple helper method here rather than using the PathFilter API.,149972471,2014-08-29 22:09:57
4392384,918962,16909137,58,"Why not simply
```
return status.getLen() >= lzoSmallFileSize;
```
?
",149972471,2014-08-29 22:12:41
4392384,918962,16909753,139,Why this redundant assignment?,149972471,2014-08-29 22:23:26
4392384,918962,16910076,23,"I'm not sure if Long.MIN_VALUE is the best default value here, as it would be -2**63. Note that this is printed in the usage as well. If the goal is to disable the small-file-skipping feature if this configuration is not set, isn't 0 fine as well?",149972471,2014-08-29 22:29:16
4392384,4859990,16965296,23,"Yes, those are meant to be constants. I missed the static modifier. 0 seems reasonable, I'll work that into the next commit.",149972471,2014-09-02 03:10:16
4392384,4859990,16965308,58,Good point :).,149972471,2014-09-02 03:11:10
4392384,4859990,16965318,139,"Remnant of the previous approach where the Configuration wasn't set at class instantiation, will remove in next commit. ",149972471,2014-09-02 03:12:37
4392384,4859990,16965341,53,"I used a PathFilter here because I was attempting to be consistent with the nonTemporary PathFilter use. However, since the bigFileFilter isn't passed to a listStatus() call, a simple helper method does seem like it'd be a better choice. ",149972471,2014-09-02 03:14:42
4392384,918962,43050092,19,"Nit: I think it's a common practice for hadoop and related code bases to use dots (""."") as separators for config keys; e.g. ""lzo_skip_indexing_small_files"" -> ""lzo.skip-indexing-small-files"". By the same token, how about ""lzo.skip-indexing-small-files.siz",156246066,2015-10-27 02:44:29
4392384,918962,43050271,52,"Since we have lzoRecursiveIndexing as a member variable, we don't need argument ""recursive"" for this method.",156246066,2015-10-27 02:45:48
4392384,918962,43050491,55,"Nit: the style of this code does not use the ""this."" notation. Can we remove the ""this"" reference from the changes?",156246066,2015-10-27 02:47:47
4392384,918962,43051581,78,"In the recursive case, I think we are calling Path.getFileSystem() and getFileStatus() redundantly. I know this is carried over from the original, but I think it's a little wasteful. How about something like this?

```java
private void visitPath(FileSt",156246066,2015-10-27 02:56:06
4392384,918962,43053689,75,"This requires a discussion. This behavior of ""recursive"" is a little surprising to me. If I'm not mistaken (from things like FileSystem API), recursive=false means *still* processing direct file children of the directory but not traversing into subdirecto",156246066,2015-10-27 03:11:41
4392384,918962,43054276,102,"Just curious, I noticed this changed from ""path.suffix(LzoIndex.LZO_INDEX_SUFFIX)"" to ""new Path(path, LzoIndex.LZO_INDEX_SUFFIX)"". Is this an intentional change? In what way do these differ?",156246066,2015-10-27 03:16:18
4392384,918962,43054454,106,"This is definitely *incorrect*. We should check the length of the index file, not the original lzo file. ""fileStatus"" is for the lzo file. See the corresponding line in the existing code.",156246066,2015-10-27 03:17:43
4392384,4859990,47580121,75,You're correct. We should try to be consistent with hadoop's definition of recursive and still process depth = 1 levels of child files.,156246066,2015-12-15 08:14:44
4392384,4859990,47683263,102,"I think they're roughly the same. I'm more used to using the constructor. The constructor does some additional resolution of the URIs for parent/child and normalization of the paths. The suffix method does this:
```java
public Path suffix(String suffix)",156246066,2015-12-16 03:13:43
4392384,918962,47970485,25,This isn't really an extension but rather a file/directory name. Should it be more like TEMP_FILE_NAME or TEMP_DIRECTORY_NAME (depending on whether it is a file or directory)?,361860449,2015-12-18 06:28:09
4392384,918962,47970796,44,"I must have missed this in the last pass. Path.getName() returns only the final component of the path (file/directory name) whereas Path.toString() returns the full path as a string. Since TEMP_FILE_EXTENSION starts with ""/"", path.getName().endsWith(TEMP_",361860449,2015-12-18 06:30:58
4392384,4859990,47971629,44,"Good point, I'll fix it. ",361860449,2015-12-18 06:37:57
4392384,918962,47972119,127,Determine -> Determines,361860449,2015-12-18 06:42:13
4392384,918962,47972976,65,"We should delete any file created during the unit test, like tempFile here. The same goes for other tests here.",361883580,2015-12-18 06:50:47
4392384,918962,49148610,65,Sure.,361883580,2016-01-08 09:08:16
4392384,4859990,49145584,65,Would File#deleteOnExit be appropriate?,361883580,2016-01-08 08:27:01
4550778,918962,17272741,32,"This is why your build failed. The maven antrun plugin is required for building the native binaries, and since the plugin was removed the native binaries were not generated, thus the errors.

Curious, is it necessary to make this change? If so, why?",155609768,2014-09-09 03:52:08
4550778,115552,17272788,32,"Not necessary at all, I think that was me trying to get the build to
pass....
​",155609768,2014-09-09 03:53:17
4783116,360025,19972065,15,not used?,158787724,2014-11-07 03:21:13
4783116,360025,19972152,46,even after your fix?,158787724,2014-11-07 03:22:44
4853209,918962,18420220,17,"How about simply using the html escape (&lt;) for this instead? Like

0 &lt;= block &lt; getNumberOfBlocks().",162388130,2014-10-04 02:21:24
4853209,918962,18420261,23,@return whether the checksum is valid,162388130,2014-10-04 02:22:24
4853209,918962,18420300,4,@return whether the runtime hadoop version is 2.x,162388130,2014-10-04 02:23:12
5288510,360025,21276762,36,"you should implement `read(byte b[], int off, int len)`, otherwise, reads will be very slow.
actually even better is to make it extend FilterInputStream and override only close().
Same for OutputStream.",185077590,2014-12-04 07:13:48
5288510,360025,21281925,77,"This could be something like:
```
final Decompressor decompressor = CodecPool.getDecompressor(this);
InputStream inputStream = new FilterInputStream(in) {
    @override public void close() throws IOException {               
        CodecPool.returnC",185077590,2014-12-04 09:16:12
5288510,360025,21311206,50,"when up change this to extedn FilterOutputStream, you should implement write(array, offset, len). I don't know why but FilterOutputStream implements this method by writing one char at a time!",185077590,2014-12-04 22:34:19
5288510,2048405,21317808,77,"Hi @rangadi the reason I didn't do that is because then I need to mark the parameter `final` and wasn't sure if there could be any affect on API compatibility?

(can't see how, but really just don't know any better)
",185077590,2014-12-04 23:54:43
5288510,360025,21318040,77,Right. That does not matter. It is just a way to tell Java to carry the reference in the anonymous inner class.,185077590,2014-12-04 23:57:36
5288510,360025,21319319,8,minor : I don't think hadoop code base encourage * import.,185077591,2014-12-05 00:13:11
16517391,918962,80364415,22,Typo: CustomeName -> CustomName,518722966,2016-09-24 23:48:23
16517391,918962,80364429,31,"Can we define a constant for ""Distributed Lzo Indexer"" so that it can be reused by the test?",518722966,2016-09-24 23:49:07
16517391,918962,80364494,50,I don't really think it's important to test the default length. It should be sufficient between the custom name test and custom length test IMO. I'm OK with dropping this test. The fact that this test needs to rely on the default value (200) implicitly is,518722966,2016-09-24 23:52:23
16517391,918962,80364451,36,Same typo,518722966,2016-09-24 23:49:45
16517391,918962,80368375,42,Let's use the constants in these 2 lines.,519009465,2016-09-25 03:37:49
16517391,918962,80368380,60,Use the constant.,519009465,2016-09-25 03:38:05
16517391,918962,80368370,29,Let's use the constant.,519009465,2016-09-25 03:37:16
16517391,918962,80368360,85,Same here.,519009465,2016-09-25 03:36:48
16517391,918962,80368383,81,Use the constant.,519009465,2016-09-25 03:38:17
16517391,918962,80368354,64,We can use the constant here too.,519009465,2016-09-25 03:36:31
481477,64978,2155426,7,Our style guide says no spaces between the')' and the ':'.,17074589,2012-11-17 02:00:01
481477,64978,2155467,9,"1. You probably meant to use private[this]

2. The combination of a mutable datastructure and a var doesn't make sense. If its mutable, you can make the reference constant.",17074589,2012-11-17 02:02:53
481477,64978,2155471,24,no space before the colon,17074589,2012-11-17 02:03:14
293347,83686,1467182,5,Good catch :),8117468,2012-08-27 23:38:14
3711430,83686,12904705,4,Thanks :),112544723,2014-05-21 21:02:06
3711430,83686,12904784,20,You should be able to use `@` here instead of `PostalCodes`.,112544723,2014-05-21 21:03:09
3711430,83686,12905171,12,"Let's break this out into its own private function (put above other public functions):

```coffeescript
find_regex = (territory) ->
  for territory_code, regex of @postal_codes
    return regex if territory_code == territory
...
@regex_for_territor",112544723,2014-05-21 21:09:36
3711430,83686,12905197,4,One too many indentation spaces here.,112544723,2014-05-21 21:10:05
3711430,1368548,12908409,20,"Yea, I realised that today. I'll update this in my next commit.",112544723,2014-05-21 22:15:31
3711430,1368548,12908436,4,Oops. Fixing now.,112544723,2014-05-21 22:15:49
3711430,1368548,12914669,12,"In this case, unless I'm missing something obvious, the private function will have to be something like this, right?

```coffeescript
find_regex = (territory) ->
    for territory_code, regex of PostalCode.postal_codes
    return regex if territory_c",112544723,2014-05-21 23:48:50
3711430,1368548,12918422,12,"Actually, I'm going to read up on scopes in Coffeescript to clear some of my confusion.",112544723,2014-05-22 00:54:33
3711430,83686,12934519,12,"Ah I see... there are three ways to go about this.

1. Set `@postal_codes` in the constructor. Any methods you define can then access `@postal_codes`.
2. Set `postal_codes` (without an `@`) as the first line of the class. You should then be able to acc",112544723,2014-05-22 09:23:46
3711430,1368548,12969198,12,"I was experimenting around with your suggestions. Here are my findings:

Option 1: If we set `@postal_codes` in the constructor, then we'll have to refactor the class such that the other methods (except maybe `territories`) are called through an object ",112544723,2014-05-23 00:25:22
3711430,1368548,12989252,12,"Actually, Option 1 seems a bit cleaner. It also makes the usage this class consistent with most other classes in the project. If we go with Option 1, should I refactor `PhoneCodes` to behave similarly?",112544723,2014-05-23 13:03:06
3711430,1368548,12991773,12,"I've fixed the indentation mistake and updated the assets. Once we decide which route to take with the class structure, I'll update that as well. For now, I've committed the Option 2 version.",112544723,2014-05-23 14:26:44
3711430,83686,13026951,12,"I think option 2 is more consistent with the classes in the shared namespace, plus it properly encapsulates the data fields.",112544723,2014-05-24 21:12:19
3772293,83686,13151100,24,"You should be able to hard-code this, i.e. `data_for_locale(""{{current_locale}}"")` (or something similar). There's no need to set or use `TwitterCldr.locale`, since the user can't switch locales.",115025386,2014-05-29 00:35:34
3772293,83686,13151192,46,Is this used anywhere? You should be able to just refer to `TwitterCldr.is_rtl` to determine if the locale is right-to-left.,115025386,2014-05-29 00:37:23
3772293,83686,13151240,19,"Again, I don't think we need this since `TwitterCldr.is_rtl` is already set in the bundle.",115025386,2014-05-29 00:38:39
3772293,83686,13151361,5,"Not sure we need this since the bundle can only ever contain one language. I know we're going to be separating the data from the implementation soon however, so maybe it's good to have. What do you think?",115025386,2014-05-29 00:40:55
3772293,1368548,13177127,46,"Oh! I thought the point of this method was to let one check whether any arbitrary locale was right-to-left. If that's not the case, then there is no need for this, I suppose.",115025386,2014-05-29 16:43:52
3772293,1368548,13178207,5,"It will probably help us once we're done separating the data from the implementation. So, I suppose it doesn't do any harm if we leave it in for now. Right?

[The reason I put this here, was to be able to find out which bundle one was currently in to he",115025386,2014-05-29 17:34:00
3772293,1368548,13178325,24,"Yes, I'll change this accordingly. We can either leave `TwitterCldr.locale` or remove it depending on the discussion below.

I'll update this in the next commit.",115025386,2014-05-29 17:38:49
3809530,83686,13315835,9,"Ahhh ok, now that you aren't looping through all of the postal codes there's no need to memoize here. In this case, memoization doesn't really do much except duplicate the data in another object.",118649240,2014-06-03 06:19:35
3809530,1368548,13349254,9,"Yes, that is true. I'll update this.",118649240,2014-06-03 23:01:29
3809530,83686,13353931,11,"I think this can be simplified to:

```coffeescript
locale_data[code] if locale_data?
```

It's ok if the method returns `undefined`.",122278944,2014-06-04 00:24:37
3809530,1368548,13357453,11,"How about this? This way, it can still return `null` rather than `undefined`.
```coffeescript
 if locale_data? and locale_data[code]? then locale_data[code] else null
```
We can do that if `null` is preferable to `undefined`. (Maybe for debugging?)
I",122278944,2014-06-04 01:33:51
3809530,1368548,13502951,11,"
I'll make it this for now. I'll update it according to what we decide.

```coffeescript
locale_data[code] if locale_date?
```",122278944,2014-06-06 23:09:06
4178151,576686,15072581,4,would it be better to extract this shared hash sets from each file?,138621220,2014-07-17 22:49:26
4178151,83686,15073586,4,"Yes it would! As a matter of fact, that's something @radzinzki will be taking care of at some point. For now, we inject locale-specific data into each file.",138621220,2014-07-17 23:05:28
4256350,83686,15481963,4,"I think this is causing Travis to fail, would you mind removing it?",141527973,2014-07-28 23:48:09
4256350,19537,15487604,4,"Oh, yeah, absolutely. I'm preparing a new version of `twitter_cldr`. Once it's released, I'll update the dependency in the gemspec and remove it from here.",141527973,2014-07-29 01:18:00
4460401,83686,17016847,17,Trailing whitespace.,153461218,2014-09-03 02:21:44
4460401,83686,17017011,9,What's up with all the `@.` in this file? Is that different or better than leaving it out?,153461218,2014-09-03 02:24:24
4460401,83686,17017034,43,Trailing whitespace.,153461218,2014-09-03 02:24:50
4460401,83686,17017041,45,Trailing whitespace.,153461218,2014-09-03 02:24:58
4460401,83686,17017199,70,"Let's try to break these long lines up into shorter lines, eg:

```coffeescript
result = new TwitterCldr.SegmentationParser.BreakRule(
  @parse_regex(@add_anchors(regex_token_lists[0]), options),
  @parse_regex(@add_anchors(regex_token_lists[1]), opt",153461218,2014-09-03 02:27:30
4460401,83686,17017209,73,Trailing whitespace.,153461218,2014-09-03 02:27:44
4460401,83686,17017241,77,Does this need to be uncommented?,153461218,2014-09-03 02:28:05
4460401,83686,17017288,1,Lots of trailing whitespace in this file.,153461218,2014-09-03 02:28:52
4460401,83686,17017432,15,"You can use CoffeeScript's awesome list comprehensions for this, eg:

```coffeescript
keys = (key for key, value of @grouping_pairs)
```",153461218,2014-09-03 02:30:46
4460401,83686,17017532,18,"Shorten this line, please :)",153461218,2014-09-03 02:32:26
4460401,83686,17017574,19,Shorten please :),153461218,2014-09-03 02:33:05
4460401,83686,17017664,28,"Single spaces between operators, please.",153461218,2014-09-03 02:34:44
4460401,83686,17017705,31,`.map`? Should use list comprehensions here.,153461218,2014-09-03 02:35:20
4460401,83686,17017808,13,"You've used `.map` a few times in this PR, but I don't understand where it comes from - did you include underscore.js? Is it part of Javascript or Coffeescript?",153461218,2014-09-03 02:37:13
4460401,83686,17017845,16,There must be an easier way to generate this string literal...,153461218,2014-09-03 02:37:49
4460401,83686,17017879,23,Parens please :),153461218,2014-09-03 02:38:12
4460401,83686,17018006,26,You can simply call `options.symbol_table` here since `options` is just a javascript object.,153461218,2014-09-03 02:40:36
4460401,83686,17018350,98,Is `by 1` necessary?,153461218,2014-09-03 02:45:12
4460401,83686,17018376,131,2-space indentation here please.,153461218,2014-09-03 02:45:48
4460401,83686,17018503,74,Parens please.,153461218,2014-09-03 02:48:20
4460401,83686,17018661,19,Could you explain your reasoning here? How does determining if `@first` and `@last` are arrays prove they're numbers?,153461218,2014-09-03 02:51:17
4460401,83686,17018684,12,Parens please :),153461218,2014-09-03 02:51:41
4460401,83686,17018775,130,Shouldn't need any of these parens.,153461218,2014-09-03 02:53:10
4460401,83686,17018831,55,Should these be uncommented?,153461218,2014-09-03 02:54:05
4460401,83686,17018865,5,Remove.,153461218,2014-09-03 02:54:37
4460401,83686,17018902,22,"4 is kind of a magic number, what does it mean? Could you pull it out as a constant?",153461218,2014-09-03 02:55:14
4460401,83686,17019170,108,"Why reopen this module? You can define `CodePointDataRenderer` immediately after `CodePointRenderer `, or put it in a different file (my recommendation).",153461218,2014-09-03 03:00:10
4460401,83686,17019220,1,There's quite a bit of logic duplication in this file using `inject` - is there a way to extract some of the common tasks into separate functions?,153461218,2014-09-03 03:01:13
4460401,1368548,17062290,17,Oops. My text editor started playing games with me. I'll remove all the trailing whitespaces from all the files. Sorry about that!,153461218,2014-09-03 21:45:52
4460401,1368548,17062324,70,"agreed, and changed. Will update this in the next commit.",153461218,2014-09-03 21:46:25
4460401,1368548,17062536,16,I was thinking about this but had a brain freeze at that moment. I'll revisit this now. Do you have any suggestions? This way is extremely ugly...,153461218,2014-09-03 21:49:50
4460401,1368548,17062800,15,"Right, that's really cool. Switched over.",153461218,2014-09-03 21:53:56
4460401,1368548,17062973,5,ooops. left over from the corresponding ruby file!,153461218,2014-09-03 21:56:30
4460401,1368548,17063298,23,"Hey! Sorry about these. I tried to use a little plugin to ""fancy-fy"" my coffee script. it was a really bad idea! I'll fix all instances of these.",153461218,2014-09-03 22:00:50
4460401,1368548,17063801,98,"`for i in [0...limit]` compiles to:
`for (i = _i = 0; 0 <= limit ? _i < limit : _i > limit; i = 0 <= limit ? ++_i : --_i)`

whereas `for i in [0...limit] by 1` compiles to:
`for (i = _i = 0; _i < limit; i = _i += 1)`

for ranges of the form [<variab",153461218,2014-09-03 22:09:06
4460401,1368548,17063818,131,oops!,153461218,2014-09-03 22:09:18
4460401,1368548,17064022,55,"Oh, I think I forgot to mention. I was experimenting a bit with the rendering of the segmentation data. This was one of the possibilities I wanted to discuss with you. That's why I left it there. Before merging. I'll clean all this experimental stuff up. ",153461218,2014-09-03 22:12:15
4460401,1368548,17064070,1,"Again, this is a result of the experimentation. half of it is actually redundant and not used anymore since I the segmentation data is separate. I'll clean this up.",153461218,2014-09-03 22:13:02
4460401,83686,17066640,17,No problem! It happens to me all the time...,153461218,2014-09-03 22:47:48
4460401,83686,17067687,16,"How about something like this:

```coffeescript
codes = [97..122].concat([65..90]).concat([48..57])  # lowercase, uppercase, numbers
str = (String.fromCharCode(code) for code in codes).join('') + '_'
```

I'm not convinced this is actually better, ",153461218,2014-09-03 22:59:45
4460401,83686,17067813,23,It only really matters in the sense that I'd like to keep your code consistent with the rest of the codebase :) Thanks for fixing.,153461218,2014-09-03 23:01:08
4460401,83686,17067902,98,Ahh ok sounds good! Coffeescript is pretty smart :),153461218,2014-09-03 23:02:14
4460401,83686,17067971,55,Alright makes sense.,153461218,2014-09-03 23:03:16
4460401,83686,17067992,1,"Cool, thanks :)",153461218,2014-09-03 23:03:41
4460401,1368548,17120264,9,"Unless I'm missing something, this was the best way to have `RuleMatchData`, `Rule`, `MatchRule` etc in the `TwitterCldr.SegmentationParser` namespace (so to say). Otherwise they'd have to be in the `TwitterCldr` namespace, `TwitterCldr.Rule`, `TwitterCld",153461218,2014-09-04 20:25:18
4460401,1368548,17120485,77,It doesn't need to be there at all. Removed.,153461218,2014-09-04 20:28:38
4460401,1368548,17122254,15,There's actually a naming issue here as well. `key` and `value` are switched! My bad!,153461218,2014-09-04 20:53:13
4460401,1368548,17122718,28,Oops. Don't know how that got through. Fixed.,153461218,2014-09-04 20:59:24
4460401,1368548,17122988,13,"It's a part of most implementations of Javascript. But you're right. It can be done in a simpler way using list comprehension. I was actually blissfuly unaware of this. I'll change all the instances of `map`. 
",153461218,2014-09-04 21:03:48
4460401,1368548,17123050,31,"Agreed. This should become `(""(?:"" + @to_utf8(c) + "")"" for c in arr).join("""")`. ",153461218,2014-09-04 21:04:40
4460401,1368548,17123063,13,Makes life way easier and cleaner.,153461218,2014-09-04 21:04:57
4460401,83686,17131457,9,"Ah ok, I get it. I guess I'm used to Ruby where the nesting determines the context. Thanks for the explanation :)",153461218,2014-09-04 23:09:44
4460401,83686,17131632,13,"Wow `.map` is part of Javascript?? That's pretty cool. Looks like it's part of the ECMAScript 5 spec, which not everyone has yet. Still, very nice.",153461218,2014-09-04 23:12:17
4460401,1368548,17156676,23,"Yea, that's really important. It's fixed now. :)",153461218,2014-09-05 09:36:42
4460401,1368548,17156826,108,"Ooops. This was also a part of the experimentation. I'll clean this up.

I'm also leaning towards moving it to it's own file. In the long run, for every module, I think we should have 2 files: one for implementation and one for the data (if any). What d",153461218,2014-09-05 09:50:12
4460401,1368548,17215635,22,"This is actually embarrassingly silly.

This iterates through the directory looking for all the yaml files that have data for particular locales: `<locale>.yaml`. The `4` is to chop off the last 4 characters of the yaml file to get the locale name. This",153461218,2014-09-07 21:44:29
4460401,83686,17249152,22,"Ahh I get it. You can use Ruby's `chomp` method for this:

```ruby
file_without_extension = file.chomp('.yml')
```

Or, more generically:

```ruby
file_without_extension = file.chomp(File.extname(file))
```",153461218,2014-09-08 21:27:04
4460401,83686,17249174,108,"Yes, I completely agree. Data and implementation separation is a good thing.",153461218,2014-09-08 21:27:28
4460401,1368548,17251113,22,"Oh, this is way better. Thanks! I'll change it to this.",153461218,2014-09-08 22:00:34
4460401,1368548,17255811,16,"I'm on the fence with this one. Neither solution seems perfect, honestly.
This one is more concise with lesser scope for error because there are lesser constants involved. 
Using alphabet explicitly is more readable.

Your suggestion wins, I feel. 
I",153461218,2014-09-08 23:10:27
4460401,1368548,17280298,19,"`Range` of the form `(<number>, <number>)` implies a numeric range.
The only other way a range is used is `(<array>, <array>)` where array is list of code points. This is a ham to represent multichar strings. [Link to explanation](https://github.com/twit",153461218,2014-09-09 08:20:27
4460401,1368548,17280363,8,@camertron This is the explanation for the `is_numeric` method in `Range`. It's using the same logic as `twitter-cldr-rb`. Do you think there is a better way? [Link to original discussion](https://github.com/twitter/twitter-cldr-js/pull/47#discussion_r172,157135286,2014-09-09 08:23:22
4460401,1368548,17280830,26,Oops. ,153461218,2014-09-09 08:43:46
4460401,1368548,17513373,1,fixed :),153461218,2014-09-13 22:49:43
4460401,83686,17553593,8,"Ahhh yes I forgot about that. You're absolutely right, thanks for reminding me.",157135286,2014-09-15 21:50:40
4460401,19537,17578488,15,Saving the result of the expression on the right into a local variable seems redundant. Same in the `@closing_types` method below.,157135289,2014-09-16 05:58:39
4460401,19537,17578517,8,These two empty lines are not necessary.,157135289,2014-09-16 05:59:42
4460401,19537,17578537,10,No need to put an empty line before `else`.,157135289,2014-09-16 06:00:14
4460401,19537,17578545,32,Same here – the empty line is not necessary.,157135289,2014-09-16 06:00:30
4460401,19537,17578576,6,You can use `unless` in cases like this.,157135289,2014-09-16 06:01:13
4460401,19537,17578740,34,"This part looks a bit strange. Can it be `@regexp_str ||= (element.to_regexp_str() for element in @elements).join("""")` in one line?",157135289,2014-09-16 06:06:10
4460401,19537,17578804,13,Remove empty lines.,157135289,2014-09-16 06:08:01
4460401,19537,17578859,10,"If you merge the latest `master`, you can instead use [`set_template`](https://github.com/twitter/twitter-cldr-js/blob/master/lib/twitter_cldr/js/renderers/base.rb#L17) method like [this](https://github.com/twitter/twitter-cldr-js/blob/master/lib/twitter_",157135289,2014-09-16 06:10:05
4460401,19537,17578875,10,Same for all other new/changed renderers.,157135289,2014-09-16 06:10:34
4460401,83686,17701819,11,I can't find this file... where does data_bundle.coffee live?,157135289,2014-09-18 04:54:33
4460401,1368548,17708139,11,Oops. This file shouldn't be there anymore. I missed this while removing redundant files after moving the compressed data back into the bundle.,157135289,2014-09-18 08:53:17
4460401,1368548,17708256,34,It can. I had done it this way to not have a long statement. But you're right. It looks more confusing this way. I'll switch back to the one-liner and only split in cases where it is exceptionally long.,157135289,2014-09-18 09:00:53
4460401,1368548,17708286,6,oh! Didn't realise that. I'll change this and all instances of this.,157135289,2014-09-18 09:02:16
4460401,1368548,17708366,15,Oops. I missed this while refactoring. Fixed in the next commit.,157135289,2014-09-18 09:07:16
4460401,1368548,17708380,8,Oops,157135289,2014-09-18 09:07:47
4460401,1368548,17708403,10,Oops. This is one of my bad habits. I usually leave an extra empty line if I can. Fixed in the next commit.,157135289,2014-09-18 09:09:04
4460401,1368548,17708406,32,fixed,157135289,2014-09-18 09:09:19
4460401,1368548,17953865,8,No problem! :),157135286,2014-09-24 09:38:04
5750448,19537,23274145,13,"Usually it's recommended to keep your directories layout in sync with modules nesting, so if you have a directory `rbnf` (which is good), you should also have a module called `RBNF` that includes all the classes/modules defined within this directory. So, ",203392143,2015-01-21 09:18:45
5750448,19537,23274226,13,"Could you explain this line? I think treating the option as boolean rather than checking if it's present or not is more conventional. If you want an explicit boolean from `nil`, you can do `options[:minify] = !!options[:minify]`, but I don't think even th",203392143,2015-01-21 09:20:57
5750448,19537,23274800,13,"Oh, disregard my last comment. I just realized that most of this method comes from the method above. It'd be idea if we could somehow refactor `compile_each` or extract some parts from it that could be reused in `compile_test`, but if you don't see an eas",203392143,2015-01-21 09:37:53
5750448,19537,23274949,33,"If you have a multi-line if-else condition, it's usually recommended to keep if-condition, if-body, else, and else-body all on separate lines. So here should be a line break after `else`.",203392143,2015-01-21 09:42:31
5750448,19537,23275028,15,"Whenever you have to initialize an empty container like that in Ruby, something is not right :) Here you can just do

```ruby
{
  locale => ....
}.to_json
```",203392143,2015-01-21 09:45:03
5750448,19537,23275083,15,"I'd recommend using `inject` instead of each here, just like you did in `number_data_reader_renderer.rb`. Once we completely drop Ruby 1.8 support, you can even use `each_with_object` that doesn't require you to return the container on each iteration and ",203392143,2015-01-21 09:46:26
5750448,19537,23275110,24,Same here – use `inject` so that you don't need to initialize the container separately.,203392143,2015-01-21 09:47:02
5750448,19537,23275326,11,"Including my comment above about having a nesting `RBNF` module defined in `numbers/rbnf.rb`, I think you could just dump all these small one-line renderers that just set the template into the same file instead of having them all in separate files. Though",203392143,2015-01-21 09:53:22
5750448,19537,23275372,9,"Module nesting should match directory structure, so this file should either be moved under `renderers/test_helpers` or the class moved from `TestHelpers` module into `Numbers`.",203392143,2015-01-21 09:54:38
5750448,1368548,23494726,33,"oops, that's how I usually do it. Something went wrong here. Fixed in the next commit",203392143,2015-01-24 14:10:19
5750448,1368548,23494738,13,"re: explicit `return`, oops. That was the day-job python kicking in!",203392143,2015-01-24 14:11:53
5750448,1368548,23494748,13,"I'm figuring out the best way to refactor this to not use duplicate code

Next up on my to-do list after RBNF is to split the data from the implementation. So, there will need to be a proper refactor of this bit of the code base. For simplicity and clar",203392143,2015-01-24 14:13:49
5750448,1368548,23494937,15,done,203392143,2015-01-24 14:51:31
5750448,1368548,23494949,15,"oh, ok. I'll refactor this once we drop Ruby 1.8. For now I've made it use inject. It's much better than iterating over the loop as I was doing here. ",203392143,2015-01-24 14:53:08
5750448,1368548,23494960,24,Done,203392143,2015-01-24 14:55:43
5750448,83686,23507866,129,"This line of code is a bit long, would you mind breaking it up a bit?",203392143,2015-01-26 04:35:55
5750448,83686,23507903,96,Left-over code?,203392143,2015-01-26 04:39:25
5750448,83686,23507936,68,Long line alert!,203392143,2015-01-26 04:41:49
5750448,83686,23507954,57,A bit of strange indentation here.,203392143,2015-01-26 04:43:26
5750448,83686,23510449,8,Is this comment necessary anymore? The name of the method is still `switch`...,203392143,2015-01-26 09:08:20
5750448,83686,23510471,54,`@get_get`?,203392143,2015-01-26 09:09:53
5750448,83686,23510501,89,I think this should be `break if difference is 0`.,203392143,2015-01-26 09:11:08
5750448,83686,23510587,20,"Long lines, please shorten.",203392143,2015-01-26 09:16:30
5750448,83686,23510671,17,"I think the Ruby version of this code was meant to expand references in the data to other parts of the data. In other words, you might have something like `foo.bar.baz` which means ""look in this same data for a nested foo -> bar -> baz structure and copy ",203392143,2015-01-26 09:21:57
5750448,83686,23510698,13,"Right, that's how twitter-cldr-rb does it.",203392143,2015-01-26 09:23:55
5750448,1368548,23706696,54,"(╯°□°）╯︵ ┻━┻) 
Oops. Fixed.",203392143,2015-01-29 00:53:53
5750448,1368548,23706761,89,"indeed. The tests never reach here, so this was untested code :O",203392143,2015-01-29 00:54:56
5750448,1368548,23706814,8,it got leftover somehow. I'll do a passthrough removing all TODOs before the PR is merged,203392143,2015-01-29 00:55:44
5750448,1368548,23707212,57,"@camertron are you referring to the lack of space between `@inline_substitutions` and the `(`?

(I'm sorry but I don't see anything else off. )",203392143,2015-01-29 01:00:33
5750448,1368548,23707230,96,indeed. sigh! removed.,203392143,2015-01-29 01:00:55
5750448,1368548,23707636,68,"Oops. Got a bit carried away with the coffee script syntactical fanciness! Split in the next commit.
",203392143,2015-01-29 01:05:19
5750448,1368548,23708773,20,"Changed to: 

```coffeescript

@special_symbols_regex = new RegExp(""'(?:"" + (
    [(TwitterCldr.Utilities.regex_escape(k)) for k, v of @special_symbols_map]
  ).join('|') + "")'"")
@inverse_special_symbols_regex = new RegExp(
  (
    [TwitterCldr.U",203392143,2015-01-29 01:17:54
5750448,83686,23713371,57,"Oh... no, it looks fine, not sure what I saw before... carry on!",203392143,2015-01-29 02:09:24
5750448,1368548,23899420,17,"Oh alright. In the ruby version, there were three cases, for Symbols, Hashes and everything else. I was just figuring out how best to port that since Javascript doesn't have the concept to Symbols. 

Do you thing this is a good split?
- Strings that ha",203392143,2015-02-02 00:53:15
5750448,1368548,23899534,57,"oh, alright!",203392143,2015-02-02 01:01:33
5750448,19537,24189542,12,Something went wrong here :) I mean indentation.,212979516,2015-02-06 02:10:50
5750448,19537,24189749,12,"Besides, the class name doesn't match the file name. And do we need `RBNF` in the class name with it being inside of `RBNF` module?",212979516,2015-02-06 02:13:17
5750448,19537,24189800,23,Something is up with formatting here as well.,212979516,2015-02-06 02:13:47
5750448,1368548,24228026,23,tabs/spaces. Sigh. Fixing in the next commit...,212979516,2015-02-06 15:33:56
5750448,1368548,24290003,12,This class is called `RBNFRenderer` because it is the renderer for `rbnf.coffee` which is like the main class for RBNF. This file is called `rbnf.rb` because it has all the one liner renderers for other RBNF related modules. I bundled them all in here fol,212979516,2015-02-07 22:08:48
5750448,1368548,24290021,17,ping @camertron ,203392143,2015-02-07 22:12:49
5750448,83686,24309451,17,"Hmm that's a good question... I actually just had this problem a few days ago when I tried to port some of this data to json (which also doesn't support symbols). I ended up adding a colon to the beginning of each symbol value, eg. `:foo.bar.baz`, then lo",203392143,2015-02-09 12:20:55
5750448,1368548,24312095,17,I don't think this is used right now btw. All tests for all locales (except the ones with allowed failures) pass right now. I'm not sure if this is required in the first place. I'll investigate this and add it in anyway.,203392143,2015-02-09 14:19:47
5750448,83686,24336664,17,"Ah ok, that could be true. Not sure if redirects are used in RBNF. Probably ok to just remove it after all.",203392143,2015-02-09 22:42:12
5750448,1368548,24346164,17,"Alright, removing it. Nothing seems to be affected. Might as well not complicate things ",203392143,2015-02-10 00:23:23
5750448,83686,25993902,110,"I think this should be a string, i.e. ""negative"".",220126856,2015-03-07 13:35:24
5750448,83686,25994006,23,"Instead of using `+` on the last few strings here, you can pass them as additional arguments to `File#join`.",220126856,2015-03-07 13:54:11
5750448,83686,25993983,15,Wow... that's a lot of characters. Can all of these be expressed as `\u` escapes?,220126856,2015-03-07 13:49:56
5750448,1368548,25995295,110,"oops (╯°□°）╯︵ ┻━┻) 
",220126856,2015-03-07 18:19:41
5750448,1368548,25995297,110,"actually, the `""positive""` should have been `positive`.",220126856,2015-03-07 18:19:47
5750448,1368548,26243973,15,"Well, they could, but that regex would be as convoluted as this. The issue here is that the characters in this are not from a contiguous range so it's not that simple to represent. I could try to refactor this to compose it from code point data, though. N",220126856,2015-03-12 00:58:25
5750448,83686,26408722,6,"Yes, this is much easier on the eyes, thanks!",229851186,2015-03-14 00:03:43
5750448,1368548,26244817,15,We have group data in CodePoint. I could write a `regex_for_group` function and then concatenate the regexes for all the required groups to get this. That should work. Let me try that and get back to you.,220126856,2015-03-12 01:07:44
5750448,1368548,26407882,6,@camertron I think this is way better than before. Thoughts?,229851186,2015-03-13 23:54:43
6915210,1368548,27634975,69,"@radzinzki this check is redundant because `compile_bundle` handles it.
",238977539,2015-04-02 11:32:56
6915210,19537,27684096,70,This `contents` variable is not needed anymore.,238978217,2015-04-02 23:31:49
6915210,19537,27684390,10,"It's up to you, but I don't think this `write_bundle` method adds much value. I'd just do inline 

```
write_file(File.join[output_dir, file_patter % locale], bundle.source)
```

here and call `write_file` instead. Same below. 

Besides, looks lik",238978217,2015-04-02 23:34:47
6915210,19537,27684406,48,"If you write everything to a file in one go, you can do `File.write(file_name, file_contents)` without opening and closing the file manually. See [IO.write docs](http://ruby-doc.org/core-2.0.0/IO.html#method-c-write).",238978217,2015-04-02 23:34:52
6915210,1368548,27685494,48,This is how the writes were being done earlier. I just assumed that was the de facto way of doing it in Ruby! My bad. I should have looked up further.,238978217,2015-04-02 23:46:09
6915210,1368548,27685538,10,"Agreed, refatoring to call `write_file` directly. No point having redundant filler methods.",238978217,2015-04-02 23:46:41
6915210,19537,27685618,48,"Oh, sorry, I completely forgot we're not in twitter-cldr-rb :D",238978217,2015-04-02 23:47:31
6915210,1368548,27685588,70,oops. missed that.,238978217,2015-04-02 23:47:10
6915210,83686,28531839,32,"These two statements can be combined on one line: `if renderer_const = bundle_hash[bundle_element]`. This works because the result of the assignment is returned by `=`, which is true for constants and false for `nil`.",239403332,2015-04-16 22:37:52
7786553,19537,31970498,24,"I doubt this will ever change, but for the sake of having defaults in one place, you can use `TwitterCldr::DEFAULT_LOCALE` here.",265553985,2015-06-09 04:27:02
7786553,19537,31970841,85,"It's not like our namespacing wasn't scary before, but now full names are noticeably longer. How about `Renderers::Implementation` and `Renderers::Data`? Also, I'm not a big fan of cryptic abbreviation, but I feel like good old `Impl` could help here as w",265553985,2015-06-09 04:32:40
7786553,19537,31977291,7,"So, when we say `@[key]` here we basically get access to one of our classes and set the value directly on that class, right? While it's kinda nice that we have data injected into every class that needs it, I feel like it makes the setup a bit more complic",265553985,2015-06-09 06:50:46
7786553,19537,31977515,6,"Since now data templates are much simpler in terms of structure, maybe we could get rid of these CoffeeScript templates and instead generate and render data for each class (either individually or all together) using a simple call to the JSON library? We c",265553985,2015-06-09 06:57:07
7786553,1368548,32883811,85,"I was torn between the word `implementation` and `logic`. Logic is a shorter option, but doesn't feel exactly accurate. 

I am also against shortened names, but I suppose `Renderers::Impl` _could_ be fine... but doesn't feel right. 

What do you think",265553985,2015-06-20 15:44:46
7786553,1368548,32883840,7,"With the way it's written now, to get things to work in the browser, you'd need to load the two files using script tags (in any order), and then doing

```javascript
TwitterCldr.setData(TwitterCldrDataBundle);
```

The data bundle gets loaded as `Tw",265553985,2015-06-20 15:55:32
7786553,19537,33120070,85,"I feel like `logic` is a bit too generic for this case, but either is fine, so I'm leaving it up to you.",265553985,2015-06-24 11:22:37
7786553,83686,39528934,31,"(Still lurking :smile:) From what I understand, the Coffeescript compiler automatically wraps all the twitter-cldr-js code in a closure. Because of this, `TwitterCldrDataBundle` and `TwitterCldr` aren't truly global variables - they're defined in the cont",314920956,2015-09-15 21:01:05
7786553,1368548,39534861,31,@camertron that's right. That's what I was fighting with. I couldn't figure out another way of doing this. This is also the reason why we can't automatically set stuff up when these are `required` in node (at least not easily).,314920956,2015-09-15 21:51:37
7786553,1368548,39535192,9,oops!,314920956,2015-09-15 21:54:19
7786553,1368548,39539657,34,"There is a certain song and dance about the `data` variable. This is because (if I understand correctly) of the funky scopes of variables here. As @camertron mentioned in the comment below, because of the enclosing closer that the code is wrapped in, the ",314920956,2015-09-15 22:31:10
7786553,1368548,39540233,28,"you're right, it would be possible to do it in node, but not in a browser. We'd have to come up with a clever solution if we want both automatic setting and dynamically changing locale.",314920956,2015-09-15 22:35:13
7786553,19537,39478429,9,"I don't think you need parentheses here. Also, the next few lines seem to have 4 spaces indentation.",314920956,2015-09-15 11:35:39
7786553,19537,39478655,22,Could you explain why we need `this` here?,314920956,2015-09-15 11:40:39
7786553,19537,39479041,34,How about instead of using try-catch we just check manually if the data is set? I feel like calling our own method just to catch an exception from it is not very efficient. Everywhere else we should still use `get_data` just so we get a nice error if it's,314920956,2015-09-15 11:48:25
7786553,19537,39479673,28,"Do you think we could avoid having this as a separate global object? If by the time we get to this line `TwitterCldr` is already initialize, we can just do `TwitterCldr.set_data(...)` and be done. If it's not loaded yet, we can set it to `{ data: ... }` a",314920956,2015-09-15 12:00:47
7786553,19537,39480567,28,"Hm, after thinking a bit more about it, with what I'm suggesting we'd either have to silently override `TwitterCldr.data` in the data bundle or it'd be impossible to reload the data bundle, because it won't override what's already loaded and we won't have",314920956,2015-09-15 12:14:48
7786553,19537,39479138,31,"This simply copies all the properties from local `TwitterCldrDataBundle` object into `root`, doesn't it? Why do we need that? Can we set `root` to `TwitterCldrDataBundle` directly?",314920956,2015-09-15 11:50:26
7786553,19537,39479183,31,"I just realized that we were doing the same thing in the other bundle file before, but I still don't understand why :|",314920956,2015-09-15 11:51:33
7786553,19537,39796365,34,"Hm, that `TwitterCldr.data` being `undefined` is super weird. I'll play with your example and dig into the problem a bit later. For now I'd suggest to add a separate method like `is_data_set` that we can use to check if the `data` field is set without rai",314920956,2015-09-18 01:43:31
11481808,83686,49265597,55,The cset library referenced here does something very similar to what [RangeSet](https://github.com/twitter/twitter-cldr-rb/blob/master/lib/twitter_cldr/utils/range_set.rb) was designed to accomplish. Stupid UTF-16!,370388931,2016-01-10 00:59:06
173139,64320,1419107,126,yes! Thank you!,6272273,2012-08-21 02:49:58
173174,64320,1419119,20,i like this,6018802,2012-08-21 02:51:34
204432,199939,1432364,105,"It should be ""./console ip port"" not ""sbt console""",6666012,2012-08-22 11:27:17
204432,199939,1432395,390,"I think that this more compact form is simpler to read/understand:
val current = reverse.getOrElse(token, Set())",6666012,2012-08-22 11:32:58
204432,199939,1432444,404,"I think it's Ok to be conservative here, this code just need to be clear, not fast.",6666012,2012-08-22 11:41:09
204432,199939,1432469,402,"I think that it is related to the new thrift (srooge) compiler, it generates an interface that expect an Future[Unit] as return type.
Future.void is used for java compatibility",6666012,2012-08-22 11:46:03
204432,199939,1432483,449,"Nil is the empty List, None is the ""empty"" Option",6666012,2012-08-22 11:49:13
204432,199939,1432499,524,"Yes, it's ok to use it like this in this example.
An advanced example could be to make concurrent requests and wait for all of them to succeed:
Future.collect(Seq(
  client.search(""types""),
  client.search(""sbt""),
  client.search(""functional"")
)).get()",6666012,2012-08-22 11:53:28
204432,441297,1437017,390,Good call! Changed.,6666012,2012-08-22 21:38:17
204432,441297,1437019,402,OK. I'll leave as Future[Unit].,6666012,2012-08-22 21:38:31
204432,441297,1437023,404,OK. Just checking that my understanding of the code was correct.,6666012,2012-08-22 21:38:44
204432,441297,1437025,105,Fixed.,6666012,2012-08-22 21:38:55
204432,441297,1437033,449,OK. Left as Nil.,6666012,2012-08-22 21:39:41
204432,441297,1437066,524,Nice! I'll add this example.,6666012,2012-08-22 21:43:10
425140,64320,1666992,31,awesome :-),12837738,2012-09-22 05:32:48
425140,64320,1667001,35,How about “encode delayed operations”,12837738,2012-09-22 05:35:11
425140,64320,1667003,35,"“A synchronous API returns a result immediately. An asynchronous API does something that might take a while” — that’s not *quite* right. It’s more that a synchronous API *waits* for a result to complete, while an asynchronous one does not.",12837738,2012-09-22 05:35:53
425140,64320,1667010,54,"using `case` here is kind of weird: it’s probably better to make to use the total function syntax:

    future onSuccess { reply =>
      println(reply)
    }",12837738,2012-09-22 05:39:28
425140,64320,1667014,104,<3 “they help you define your asynchronous API in terms of other asychronous APIs.”,12837738,2012-09-22 05:40:49
425140,64320,1667064,246,i would actually do `map (_.sum)` here,12837738,2012-09-22 05:58:32
642949,64320,2374581,12,"even stronger language would be in order. ""mandatory"" comes to mind.",22156401,2012-12-11 13:27:44
642949,64320,2374603,54,"The basic rule of thumb is: only `Future.apply` and `Future.get` ever block.  Watch out for those, and you'll be fine. (In a future API revision, I plan on making this obvious; blocking will only be available through an external object, `Awaitable`, so yo",22156401,2012-12-11 13:32:10
1258829,21084,3427583,5,Broken HTTP entity. Perhaps it'd just better remove it? (i.e. `s/&nbsp //`),36512336,2013-03-19 15:15:42
1258829,21084,3427752,22,"Incorrect translation:

* Scala school은 Twitter에서 경험이 풍부한 엔지니어가 생산적인 Scala 프로그래머가 될 준비를 마칠 수 있도록 돕는 일련의 강의에서 시작되었습니다.
* Scala는 *상대적으로* 새로운 언어지만
* 저희는 이 방법이 Scala를 처음 접하는 엔지니어가 신속히 제 속도를 낼 수 있도록 하는 효율적인 방법임을 발견했습니다.
* 이 자료는 그 강의 내용을 문서화한 것입니다.",36512336,2013-03-19 15:27:20
1258829,21084,3427766,50,모법사례 -> 모범사례,36512336,2013-03-19 15:28:34
1258829,21084,3427770,48,배울수 -> 배울 수,36512336,2013-03-19 15:28:56
1258829,21084,3427858,29,"Incorrect translation:

* 우리는 Scala를 Java의 개선판인 것처럼 가르치는 것보다 아예 새로운 언어로서 가르치는 것이 이치에 맞다고 생각합니다.
* 본 교재를 이해하기 위해 Java에 대한 경험이 필요하지는 않습니다.
* 본 교재는 저희가 Twitter에서 프로그래밍하는 스타일 뿐만 아니라 인터프리터와 객체-함수형 스타일에 주안점을 둡니다.
* 유지보수성과 표현의 명료성, 타입 시스템의 활용을 강조할 것입니다.",36512336,2013-03-19 15:37:15
1258829,21084,3427892,36,"Inconsistent tone:

* 더 나가! -> 더 나아가 보세요!

Typos:

* 따라하는것을 -> 따라하는 것을
* 장려 하지만 -> 장려하지만
* 탐구하기위한 -> 탐구하기 위한

Incorrect translation:

* 이 강의 자료를 Scala 언어를 탐구하기 위한 시작점으로 활용해 주세요.",36512336,2013-03-19 15:40:06
1258829,21084,3427912,51,"Koreans do not use the term like '자습서' anymore:

* 자습서의 링크 -> 튜토리얼

Incorrect translation:

* 가이드 -> 설명서 (or just 매뉴얼)",36512336,2013-03-19 15:41:52
3066804,401065,37943657,25,Did you mean to put a `List` description here?,89273697,2015-08-26 08:33:24
5883397,5437425,23122764,5,"What do you think about adding a parenthesis here?

""or pass in a function (the Scala compiler automatically converts our method to a function)""",205115477,2015-01-17 11:30:42
5883397,4002011,23123979,5,"That's even better, I've commited your suggestion.",205115477,2015-01-17 16:15:40
7805825,401065,36027524,26,"I don't see this in the English version; therefore, I think it's best to remove it or add it to the English version as well.",278111920,2015-08-01 05:24:10
10489399,401065,45234069,19,"Ah, sorry I should have mentioned this before: Since this is a class instance and not a enum/type/companion object/etc, can you please keep start these variables uncapitalized?",346858774,2015-11-19 00:51:48
10489399,401065,45234097,48,Same here,346858774,2015-11-19 00:52:04
10489399,401065,45257348,19,These as well,348340502,2015-11-19 03:45:46
17405385,401065,80977953,26,Can you show that the `Array` has changed?,520484929,2016-09-29 00:52:40
17405385,1717696,81069777,26,"`Array` in English version is OK.
The problem is that there's no `Array` part in the current Chinese version.

So I added it and offered my translation, as well as the original code example. ???? ",520484929,2016-09-29 13:06:22
17405385,401065,81587349,26,"Sorry, I probably didn't communicate this well. Can you add a REPL step that evaluates the modified array like

```
scala> val numbers = Array(1, 2, 3, 4, 5, 1, 2, 3, 4, 5)
numbers: Array[Int] = Array(1, 2, 3, 4, 5, 1, 2, 3, 4, 5)

scala> numbers(3)",520484929,2016-10-03 23:32:46
17405385,1717696,82494432,26,Of course. I'll do this soon. Thanks.,520484929,2016-10-08 10:26:52
37254964,7875,178641057,10,"""Finagle's"" (capital F)?",963933039,2018-04-03 03:28:11
37254964,7875,178641306,10,"""Dodo"" (capital D)? Maybe link to Github Dodo project?",963933039,2018-04-03 03:29:09
48131300,353094,227088080,3,"Can you provide some additional context as to why we are missing dependencies?

Should we officially retire/archive this repo? 
Either via https://help.github.com/articles/archiving-a-github-repository/ or by moving it to https://github.com/twitter-arc",1175328735,2018-10-23 01:37:59
48131300,81530,227135911,3,"The missing dependency is a Twitter-owned gem that was unpublished when no owners stepped up to transition from ruby 1.8.7. 

We could retire this repo if you wish. I didn't want to make that call - the current status is the content lives but the tutori",1175328735,2018-10-23 03:58:04
48131300,81530,227165681,3,"Was that ""Explain to me why dependencies are missing"" or ""amend this commit to explain to the reader why dependencies are missing""?",1175328735,2018-10-23 05:54:01
68424,132254,1355558,9,"Ah I see.

This project uses tabs rather than 4 spaces, please correct that and push to this branch. Cheers.",4522555,2012-08-11 02:11:49
68424,132254,1350226,9,This seems to change nothing except the indenting. Is that correct?,4522555,2012-08-10 14:29:07
68424,11188,1350985,9,"Nope, the commit moves the two lines after the CGContextScaleCTM call. The indentation looks good to my in Xcode. Seems to be an issue of using tabs instead of 4 spaces.",4522555,2012-08-10 17:27:54
51561,5101,1066155,24,"maybe do `props.match(/url\((['""])(.*)\1\)/)[2];`",3025954,2012-06-28 12:37:54
51561,5101,1066166,26,instead of doing the chunks - let's just do: `ext = filename.match(/[^.]*$/)[0]`,3025954,2012-06-28 12:41:47
51561,5101,1066188,28,"don't know much about windows - but should we be splitting on `seperator` here? also spelling ""separator"" ;)",3025954,2012-06-28 12:48:14
51561,5101,1066196,31,"let's pull the base64 string out into a var and simplify the replace expression a bit

```js
var imgBuffer = new Buffer(fs.readFileSync(filePath+seperator+fileName)).toString('base64')
    , urlData = 'url(data:' + mimetype + ';base64,' + imgBuffer + ')'
",3025954,2012-06-28 12:51:38
51561,5101,1066206,4,let's default to false to begin with,3025954,2012-06-28 12:53:31
51561,5101,1066211,15,"edit: oops, actually we should change it to something like this: `/^url\((?!data:)/`- more explicitly looks for something which isn't data :)",3025954,2012-06-28 12:54:12
51561,150607,1080557,24,"Needed ? <code>props.match(/url\((['""]?)(.*)\1\)/)[2];</code> to match url(sprite.png)",3025954,2012-06-30 17:31:38
51561,150607,1080559,28,good spot boss :),3025954,2012-06-30 17:32:46
51561,150607,1080568,23,"Good call, brought up a bug where it wasn't embedding if images links included paths (../sprite.png etc). Have added test for this now.

Did bring up another issue where the tests were failing because the relaxed regex test was picking up font-face src in",3025954,2012-06-30 17:51:13
51561,5101,1066131,23,maybe let's just simplify this to: `/url\(/.test(props)` or something along those lines.,3025954,2012-06-28 12:31:24
70017,5101,1384888,22,clean up whitespace of this conditional and remove semilcolons - thanks!,4553770,2012-08-15 22:51:33
70017,97937,1385857,22,"I'm afraid I don't know what you're after with the whitespace, I tried to stick to the style used, but it's a new one on me. The semicolons are gone though.",4553770,2012-08-16 00:05:10
70017,5101,1410227,25,the indenting is wrong :),4553763,2012-08-19 22:43:10
70017,5101,1410228,30,wrong here too,4553763,2012-08-19 22:43:17
980058,21425,2975925,5,"I think you can just change the href to `//twitter.com/fat`. That way, the browser will make the right call as to which protocol to use `https://`, `http://`, or `file://`.

More on this [here](http://paulirish.com/2010/the-protocol-relative-url/).

<",29093313,2013-02-12 17:25:58
980058,1206724,2976074,5,"Huh. That's pretty nifty! However, it would be kind of annoying for when you're viewing the doc locally since it would try to do file://twitter.com/fat, but then again I doubt anyone would really care that much if they're working on Recess's GH page local",29093313,2013-02-12 17:39:16
38853,96834,863595,8,I think :require => 'reputation_system' is optional and it shouldn't be in README. Can you remove this for me?,3506661,2012-05-23 01:38:57
38853,26331,865172,8,"Library name to load differs from gem name, so it needs to be specified.
This prevents from having to put a require statement in app and issues like #3",3506661,2012-05-23 06:26:54
38853,96834,865635,8,Ah I see. This was last minute name change. We should name all in the same way in the future version. Thanks NARKOZ!,3506661,2012-05-23 09:35:00
39345,96834,872011,9,Can we remove this has_scoped_evaluation? method and let has_evaluation? method handle the both scope and non-scope cases like add_evaluation method? Also I would love to see tests for this method. Thanks!,4059681,2012-05-24 04:42:30
39345,96834,876293,86,Great work with merging has_evaluation? method! I think this now should be updated :),4059690,2012-05-24 21:56:40
1329779,485754,8659451,5,"Perhaps, we don't need to create `options` hash in this case?",43111562,2014-01-06 13:07:46
1329779,485754,8659452,14,ditto.,43111562,2014-01-06 13:07:52
1329779,485754,8659456,23,ditto.,43111562,2014-01-06 13:08:00
1329779,485754,8659503,4,"out of curiosity, why do you need to do this?",43111562,2014-01-06 13:15:55
1329779,26331,8671955,4,Build was failing cause extra space. See https://github.com/rails/arel/pull/177,43111562,2014-01-07 01:08:55
1329779,26331,8672556,5,Not sure about that. ,43111562,2014-01-07 01:27:55
1329779,485754,8712353,4,Interesting. Do you mind adding a comment for it?,43111562,2014-01-08 07:28:13
1329779,26331,11095534,4,"I can't add a comment exactly for that line. It's a concatenated string.
Btw, I already referenced the issue in a commit message (985bfec)",43111562,2014-03-30 04:36:19
1329779,485754,11096542,4,Great. Thanks!,43111562,2014-03-30 08:00:00
1473128,485754,4228269,4,Let's name this `evaluation_by`.,40548925,2013-05-15 08:44:45
1473128,485754,4228275,10,This if statement can be simplified to `evaluation.try(:value)`.,40548925,2013-05-15 08:46:49
1473128,485754,4291830,6,I think it should return nil. Did you run the spec and passed all?,41733964,2013-05-20 07:00:06
1473128,485754,4291835,16,"It should return return number, not an array. Also you only need to repeat the same test. i.e. question2, question3.",41733964,2013-05-20 07:01:26
1473128,485754,4291839,37,ditto.,41733964,2013-05-20 07:02:33
1403117,775941,3991572,15,How was just initializing with CONF_DEFAULT_SELECT?,38384817,2013-04-28 20:11:40
1403117,775941,3991575,3,I just think that add new conf file for this patch like this: nutcracker.select.yml,38384817,2013-04-28 20:12:25
1403117,775941,3991579,4,"in twemproxy, it is better to change the variable name to is_select_msg",38384817,2013-04-28 20:13:15
1403117,775941,3991597,8,"and conn->sd is nonblocking socket. so write can be failed.
",38384817,2013-04-28 20:21:15
1403117,144467,3991739,15,"if cp->select  is initlized by CONF_DEFAULT_SELECT, the function conf_set_num will throw error that select is duplicate,
thus to avoid writing very similar function  and  let conf_set_num work fine, this is done, later if cp->select remains unset default",38384817,2013-04-28 21:28:43
1403117,144467,3991748,8,"i made sure that when i call this funtion, connection is connected.
even than i should  have kept it in loop to try more than once if EAGAIN error is encountered

or Ill appritiate  your comments if there is a better way to do it",38384817,2013-04-28 21:31:03
1403117,144467,3992055,8,"void  setSelectDb(struct conn *conn,struct server *server){
         ASSERT(!conn->client && conn->connected )
         int n, i;
         char selectCommand[25];
         sprintf(selectCommand,""*2\r\n$6\r\nSELECT\r\n$1\r\n%d\r\n"",server->owner->selec",38384817,2013-04-28 23:52:43
3393307,112060,14326121,4,what is this for?,130593872,2014-06-29 01:48:15
3393307,112060,14326123,4,why did we bump this up?,130593872,2014-06-29 01:48:24
3393307,112060,14326127,5,[formatting] `status: %d`,130593872,2014-06-29 01:48:42
3393307,112060,14326172,60,is get_mbuf() function required? It seems to be called only in msg_make_reply(). Prefer not having this function,130593872,2014-06-29 01:56:01
3393307,112060,14326178,115,why are these commented out? Isn't it required to trigger the out event?,130593872,2014-06-29 01:56:38
3393307,112060,14326216,127,"Should we move the lines 482 - 495 into server_pool_idx()? It seems that only place where the tag logic is not used is in server_pool_server(), which is surprising, because I think that tag logic should also apply there equally.",130593872,2014-06-29 02:00:16
3393307,112060,14326257,274,"In this piece of code, you allocate message structs for every server in the pool - ncontinuum messages, even if incoming messages are destined to < ncontinuum servers.

Only at line 818-819, do you some of these allocated message structs. Can we refacto",130593872,2014-06-29 02:09:54
3393307,112060,14326266,18,why commented out?,130593872,2014-06-29 02:12:44
3393307,112060,14326270,5,[format] delete new line,130593872,2014-06-29 02:13:09
3393307,112060,14326272,9,[format] delete new line,130593872,2014-06-29 02:13:13
3393307,112060,14326309,571,We should refactor this piece of logic. All the memcache specific logic should reside in nc_memcache.c and all the redis logic should reside in nc_redis.c. This separation of concerns is a good thing because it divorces the protocol handling from the core,130593872,2014-06-29 02:14:46
3393307,186656,14326415,4,"we may see something like this:

    [Sun Jun 29 05:39:03 2014] nc_redis.c:1527 parsed req 13 res 0 type 24 state 0 rpos 124 of 124
    00000000  2a 31 31 0d 0a 24 33 0d  0a 44 45 4c 0d 0a 24 35   |*11..$3..DEL..$5|
    ...
    00000060  6b 6b 2d 34 ",130593872,2014-06-29 02:39:56
3393307,186656,14326419,4,for dump larger msg.,130593872,2014-06-29 02:40:48
3393307,186656,14436271,60,"get_mbuf is also used in twemproxy_auth_and_select branch. I think we will merge it later. so I keep this a function. 



https://github.com/twitter/twemproxy/blob/twemproxy_auth_and_select/src/nc_request.c#L383-L400

and we got smaller ``msg_make_r",130593872,2014-07-02 05:44:37
3393307,186656,14436425,115,"this function is copy from https://github.com/twitter/twemproxy/blob/twemproxy_auth_and_select/src/nc_request.c#L403

in ``auth-select`` branch, we can reply immediately, so ``event_add_out`` is called.

in mget case, we use this function to prepare a",130593872,2014-07-02 05:50:47
3393307,186656,14436849,127,"the hash_tag logic is implement here now: 
https://github.com/twitter/twemproxy/blob/twemproxy_auth_and_select/src/nc_request.c#L589-L606

I think it's a good idea to move both ``nc_message.c#482-495``  and  ``nc_request.c#L589-L606`` into server_pool_",130593872,2014-07-02 06:08:29
3393307,186656,14436984,274,"yes!  
to many waste of ``malloc`` calls here, 

I will optimize this. this can make us faster on small mget with lots of backend !
",130593872,2014-07-02 06:14:55
3393307,186656,14437129,18,there is no 'last_fragment' now:),130593872,2014-07-02 06:22:02
3749465,186656,13062350,5,"if current msg is a sub-msg, the ``msg->frag_owner`` may be ``free`` and reset by ``_msg_get``, this is not correct, especially for ``req_error``",113507565,2014-05-27 10:11:07
3749465,1426083,13274133,5,"All fragements will be freed at the same time if some error happens (`rsp_make_error`). If there is no error, they will also be freed at the same time.
If I can't believe `frag_owner` is valid, which you think it may be a wild pointer, that will be a bug",113507565,2014-06-02 13:02:57
3772563,112060,13899536,17,"No need for a py script. You can generate the strings using macro magic called strigificaion :) This way your code never gets outdate

See this for reference -- 
- https://github.com/twitter/twemproxy/blob/master/src%2Fnc_stats.h#L23-L49
- https://git",119537659,2014-06-18 10:04:21
3772563,112060,13899553,12,s/char */uint_8 */,119537659,2014-06-18 10:05:14
3772563,112060,13899558,4,usec */,119537659,2014-06-18 10:05:34
3772563,112060,13899586,13,"space between the closing paren and curly brace. So log_loggable(LOG_NOTICE) {
Here are the coding guidelines -- https://github.com/twitter/twemproxy/blob/master/notes/c-styleguide.txt. Would really appreciate if you follow it
",119537659,2014-06-18 10:07:24
3772563,112060,13899603,33,"just call it req_log()

also format is `struct msg *req`",119537659,2014-06-18 10:08:40
3772563,112060,13899612,45,formatting -- `/* a fragment */`,119537659,2014-06-18 10:09:11
3772563,112060,13899643,4,formatting - `struct msg *req`,119537659,2014-06-18 10:12:14
3772563,112060,13899649,56,formatting - `if (rsp) {`,119537659,2014-06-18 10:12:40
3772563,112060,13899660,4,call this `int_64_t start_ts /* request start timestamp in usec */,119537659,2014-06-18 10:13:52
3772563,186656,14004378,17,"macro create beautiful code but break cscope/ctags :( 

I will have a try.",119537659,2014-06-20 06:58:50
3952358,112060,15436410,4,"Rename
total_connections to ntotal_conn
curr_connections to nconn
curr_client_connections to nclient_conn

curr_connections should be int32_t
curr_client_connections should be int32_t
",128696487,2014-07-27 04:33:40
3952358,112060,15436414,5,"how did we come up with RESERVED_FDS number as 32
rename it as NC_NUM_RESERVED_FD
",128696487,2014-07-27 04:34:26
3952358,112060,15436416,14,"I think we might still hit this scenario - One instance where I see this happening is that you close the connection() from the code (decrement the counters), but the sockets are still in TIME_WAIT state and hence are not available for accept() sys call.
",128696487,2014-07-27 04:36:19
4603440,6597328,22337768,128,"If new process inherited listen-socket from old one, why do you dup here?",156352376,2014-12-30 10:28:50
4603440,186656,22346151,128,we do dup here and in ``core_cleanup_inherited_socket`` we will close all FS in NC_ENV_FDS.,156352376,2014-12-30 19:28:47
5183241,186656,20070477,12,"you can not compare p against ""quit"" like this, it's maybe in two mbufs.
",183965548,2014-11-10 15:24:05
5183241,847939,20074044,12,"Perhaps it'd be simpler if the parser read up to the first \r\n, that way we can detect whether it's a short command or a long one?",183965548,2014-11-10 17:12:47
5526338,112060,21946628,12,can we call this init?,195468933,2014-12-17 08:16:15
5526338,112060,21946653,4,s/Only/only/,195468933,2014-12-17 08:16:38
5526338,112060,21946669,35,we only use comments of form /* */ in twemproxy,195468933,2014-12-17 08:16:59
5526338,112060,21946725,13,"since this only affects redis, can we have two init handlers for memcache (memcache_conn_init) and redis (redis_conn_init) and move the code from server_conn_init to redis_conn_init",195468933,2014-12-17 08:17:59
5526338,112060,21946883,30,can you use nc_snprintf,195468933,2014-12-17 08:21:58
5526338,112060,21946971,47,use mbuf_* methods to do the copy,195468933,2014-12-17 08:23:54
5526338,112060,21946982,52,use /* */ comment,195468933,2014-12-17 08:24:09
5526338,112060,21947064,40,should we put a cap on maximum number of redis db -- like redis_db must be less than 64,195468933,2014-12-17 08:26:22
5526338,112060,21947322,26,can we compute number of digits in nc_conf.c and store it in conf structure -- no need to recompute it on every connection request,195468933,2014-12-17 08:31:57
5526338,112060,21947599,19,use uint8_t,195468933,2014-12-17 08:38:46
5526338,3178747,21963644,40,As far as I know there is no cap on the db setting in redis,195468933,2014-12-17 17:30:00
5526338,3178747,21964214,26,"Of course we could, but as this command is not heavily frequented it should not be much of a performance issue. So I guess adding a field to the config is more wasteful than doing the calculation in place, especially as the value is not used elsewhere.
S",195468933,2014-12-17 17:40:55
6244933,112060,33058056,9,"instead of creating a the all possible combinations of connection (client | proxy | server) and protocol (redis | memcache), I think it would make sense to keep the original design of three types of connection (client | proxy | server) and a separate fiel",222770687,2015-06-23 21:00:05
6244933,108819,33113284,9,"@manjuraj Re combinations of connections. One thing is that it eases the ""CONN_KIND_AS_STRING(c)"" implementation, so it is O(1). Do you recommend a different approach?

@manjuraj re cleanups: I've added a couple of comments to your changes in the config",222770687,2015-06-24 07:38:33
6493049,246207,25754743,16,nit: don't you need three sentinels for quorum in this example?,225040577,2015-03-04 13:30:01
6493049,1455955,25775677,16,"@mishan You can configure any number of sentinels no matter how many sentinels you use. Becase twemproxy just need connect to one of the to fetch the redis address. 

Of cause, configuring all the sentinels you use is better. Because if some of the sent",225040577,2015-03-04 21:00:38
6493049,1455955,25776456,16,"To avoid being confused, I added one sentinel address to the example configuration.",225040577,2015-03-04 21:12:25
6493049,484939,26949404,16,"There is actually a good reason to connect to multiple Sentinels. If the Sentinel you are connected to is on the minority side of a network partition, and the original master is in that partition, it could report it's ""old"" master. By querying all of the ",225040577,2015-03-23 21:52:31
6493049,1455955,27093408,16,"@TheRealBill In the partition, if twemproxy can only connect a part of the sentinels, and some told you new master, some told you old master. While twemproxy don't know whick is right if the both two sides don't have instances over half of all. Another, t",225040577,2015-03-25 09:48:34
6493049,484939,27094869,16,"
> On Mar 24, 2015, at 10:48 PM, andy <notifications@github.com> wrote:
> 
> In conf/nutcracker.yml <https://github.com/twitter/twemproxy/pull/324#discussion_r27093408>:
> 
> > @@ -65,3 +65,18 @@ omega:
> >    servers:
> >     - 127.0.0.1:11214:100000
> >",225040577,2015-03-25 10:48:46
6493049,1455955,27143045,16,"@TheRealBill  Thanks for your suggestions.
For the first suggestion, twemproxy should connect to all the sentinels. I think we shouldn't make twemproxy too complicated. It's just a client which supports sentinels. The problems in network partition should",225040577,2015-03-25 23:14:00
6493049,484939,27147701,16,"
> On Mar 25, 2015, at 12:14 PM, andy <notifications@github.com> wrote:
> 
> In conf/nutcracker.yml <https://github.com/twitter/twemproxy/pull/324#discussion_r27143045>:
> 
> > @@ -65,3 +65,18 @@ omega:
> >    servers:
> >     - 127.0.0.1:11214:100000
> >",225040577,2015-03-25 23:57:49
6493049,1455955,27409140,16,"@TheRealBill I have seen the guidelines of sentinel clients. It said client just need to connect one of the sentinels just like what the patch does. Just like what the guidelines said below, It won't work well in the network partition.
>Note: it is possi",225040577,2015-03-30 22:00:09
6493049,484939,27450141,16,"
> On Mar 30, 2015, at 12:00, andy <notifications@github.com> wrote:
> 
> In conf/nutcracker.yml:
> 
> > @@ -65,3 +65,18 @@ omega:
> >    servers:
> >     - 127.0.0.1:11214:100000
> >     - 127.0.0.1:11215:1
> > +
> > +sigma:
> > +  listen: 127.0.0.1:2212",225040577,2015-03-31 08:09:05
6493049,2828514,122809210,142,"This will/does have issues if redis-sentinel adds new fields to the response, changes the order of the fields, or sends more lines than this expects. See https://github.com/twitter/twemproxy/issues/527 (wrong repo)

After upgrading from redis 2.x to 3.2",514446311,2017-06-20 03:02:32
7624673,112060,32696311,4,delete this line,260501951,2015-06-18 08:18:58
8320010,775941,36986443,13,@ton31337 twemproxy can run on mac or freebsd also. so I think you should check other os too not only linux :),279274174,2015-08-13 20:18:04
8320010,4290668,36987216,13,"@charsyam :+1: of course will fix this, but need to be sure if it's worth to spend more time. I mean if it's planned to be merged or not.",279274174,2015-08-13 20:24:20
8320010,4290668,37294849,13,@charsyam are you able to test this on FreeBSD ? :),279274174,2015-08-18 18:05:25
8320629,4290668,37003301,8,"@susman by the way, ExecStop isn't needed?",279277136,2015-08-13 22:47:48
8320629,153669,76193670,1,it should be `/etc/sysconfig/nutcracker.rc`,279277136,2016-08-25 14:34:01
8320629,2926595,76194303,8,ExecStop is optional,279277136,2016-08-25 14:39:40
8320629,2926595,76194448,1,I guess many things have changed since the PR was opened,279277136,2016-08-25 14:40:46
8320629,153669,76196925,3,"Should have 

After=network.target
",279277136,2016-08-25 15:00:17
8320629,153669,76196973,4,"good to add

AssertFileNotEmpty=/etc/nutcracker/nutcracker.yml",279277136,2016-08-25 15:00:44
8560630,112060,35277206,73,code must follow: https://github.com/twitter/twemproxy/blob/master/notes/c-styleguide.txt,283457721,2015-07-23 04:34:09
8560630,112060,35277248,94,"even though this works, stylistically returning int and comparing boolean is not good. ",283457721,2015-07-23 04:34:36
8560630,112060,35277176,71,"all functions in twemproxy must be namspaced like redis_ 

also the return value must be either rstatus_t or bool",283457721,2015-07-23 04:33:37
13226507,1455955,76415609,4,What is this line doing?,411135270,2016-08-26 20:11:34
42203,187046,919159,17,simplify to `runtime`?,3403865,2012-06-02 23:18:36
42203,187046,919161,18,does `dagLevel` encode this notion of runtime equivalency of jobs we discussed Thursday?,3403865,2012-06-02 23:19:40
42203,187046,919169,62,"Migrate to stub file `cascading-ambrose-detail-pane.js`?

I'd thought we might place all runtime specializations of base views in files whose names match `<viewName>-<runtimeName>.js`.",3403865,2012-06-02 23:27:23
42203,187046,919171,20,does the `ui` var here mask the argument? or is the argument not needed here?,3403865,2012-06-02 23:28:44
42203,187046,919178,62,Will the job and event runtimeNames ever be mismatched? Not sure what the use case for that scenario might be. Perhaps simplify this method to `supportsRuntime` -> `return data.event.runtimeName == 'pig'` ?,3403865,2012-06-02 23:43:50
42203,187046,919180,66,Initialized => Initializes,3403865,2012-06-02 23:44:45
42203,187046,919188,264,Not sure if job selection has side effects I wanted here. Feel free to remove if UI seems stable without it.,3403865,2012-06-02 23:50:49
42203,187046,919245,264,"Ah, now I remember-- so the details pane displays info for ""current"" job. Definition of ""current"" job is somewhat fuzzy. Here's a partial list of desired rules:

- On `JOB_STARTED`, select started job, unless a job has been selected explicitly by user wit",3403865,2012-06-03 00:47:42
42203,73683,920675,17,"Yeah, sounds good. I used runtimeName since I thought we later might want to add runtimeVersion and such. ",3403865,2012-06-04 10:11:43
42203,73683,920694,18,"More on the dagLevel can be found here:
http://en.wikipedia.org/wiki/Layered_graph_drawing

It's found by finding the longest path and creating levels from each node. Then every other node is assigned a level such that each branch is a short as it can be.",3403865,2012-06-04 10:17:58
42203,73683,920698,20,"The args not needed, good catch. Will remove.",3403865,2012-06-04 10:19:52
42203,73683,920728,62,"Yeah, this is clunky. I think the method name shouldn't be runtime-centric, since things other than runtime could determine whether or not this view can be rendered (i.e. job state?).

As for the event/job part sometimes the payload contains events and so",3403865,2012-06-04 10:37:11
42203,73683,920744,62,"I like what you describe, as opposed the example you show. :)

`ambrose-detail-pane-cascading.js`

Once we have a real impl for cascading we can use this pattern. The stuff in index.html I plan to remove before we merge, or make into documentation somehow",3403865,2012-06-04 10:43:24
49160,187046,1028347,5,looks like function is missing associated vars for some of those deps...,4246802,2012-06-21 23:51:36
49160,187046,1028355,5,what's the `jit` dep?,4246802,2012-06-21 23:52:21
49160,187046,1028361,5,d3 param in function spec?,4246802,2012-06-21 23:52:54
210677,187046,1174869,5,"ah, nice catch.",3403762,2012-07-17 05:28:43
451071,187046,1751174,63,"This introduces a race condition, though perhaps not a huge issue.. Is there any way to tell Jetty to use a random port?",14543386,2012-10-03 20:23:27
451071,73683,1753287,63,"This is a fairly common hack, but yes it's a hack. DIgging around I think setting port to 0 should result in a random port being used, but I haven't been able to get that to work. I think this is ok for now.",14543386,2012-10-03 23:04:28
817017,73683,2685028,58,We still need to allow users to use a non-random port via ambrose.port.,25849960,2013-01-18 01:29:37
817017,73683,2685043,59,How is default port = 8080 being handled if it's removed here? 8080 should still be the default.,25849960,2013-01-18 01:30:28
817017,73683,2688846,58,"Wow, somehow I overlooked those new fields above...",25849960,2013-01-18 05:38:22
817017,187046,2685954,59,this var has been renamed `PORT_DEFAULT`-- see line 56 above.,25849960,2013-01-18 02:17:33
817017,187046,2685973,58,This behavior hasn't changed. Users may specify `-Dambrose.port=12345` to use port `12345` or one of `-Dambrose.port=random` or `-Dambrose.port=0` to get a random port assignment.,25849960,2013-01-18 02:19:03
1195134,187046,3154557,20,Is this needed? Are you pulling in deps not available in Maven Central?,33577370,2013-02-26 22:36:10
1195134,187046,3154583,28,"If possible, I'd like to migrate these materials to a separate repo all together. We could consider hosting the repo in another project on Github itself.",33577370,2013-02-26 22:37:35
1195134,187046,3154615,41,remove. You'll likely need to add maven-assembly-plugin config to properly construct a deployable ambrose-cascading tarball.,33577370,2013-02-26 22:39:03
1195134,187046,3154624,82,"if possible, please fix formatting throughout file",33577370,2013-02-26 22:39:35
1195134,187046,3154643,34,hadoop?,33577370,2013-02-26 22:40:38
1195134,187046,3154649,36,"spelling ""Convertor"" -> ""Converter""",33577370,2013-02-26 22:40:54
1195134,187046,3154680,40,"A general note about author tags: If you'd like to use them, please use your full, capitalized name. There are already two Ahmeds who participated in this patch... somewhat confusing ;)",33577370,2013-02-26 22:42:38
1195134,187046,3154736,6,Inclusion of this file may require updates to LICENSE file and other materials which identify source provenance. @caniszczyk Please let us know how to properly include Cascading source files.,33577370,2013-02-26 22:45:22
1195134,187046,3154772,1,"Let's not include the output of the test here, especially if it'll be regenerated with each test run. Generated output which should be cleaned during `mvn clean` should be placed beneath `target/`.",33577370,2013-02-26 22:46:55
1195134,12202,3154850,6,"If we preserve copyright headers from the Cascading project, we should be fine (also since it's under ALv2 since the 2.0 release). If we modified a source file, preserve the copyright header and just add yourself as a copyright holder to the derivative wo",33577370,2013-02-26 22:50:09
1195134,73683,3155120,42,"Naming of this class should align with it's interface (i.e., AmbroseCascadingNotifier).",33577370,2013-02-26 23:04:03
1195134,73683,3155137,47,"Naming of this class should align with it's interface (i.e., EmbeddedAmbroseCascadingNotifier).",33577370,2013-02-26 23:04:51
1195134,73683,3155197,27,Please don't copy and paste javadocs. These need to be updated to document this class and the proper author.,33577370,2013-02-26 23:07:17
1195134,73683,3155243,2,Copyright hadoop does not seem correct here. @caniszczyk what should the copyright be on their new files? ,33577370,2013-02-26 23:09:16
1195134,73683,3155388,110,"Whitespace cleanup here and elsewhere. We want an empty line between method closure and the next javadoc. Also above, no empty lines between multiple closing brackets.",33577370,2013-02-26 23:16:26
1195134,73683,3155406,36,Javadocs.,33577370,2013-02-26 23:17:09
1240755,187046,3534629,5,Thanks for the friendly reminder here :) This patch looks good to go!,36251801,2013-03-26 22:40:25
1760299,187046,5150382,4,gah. thanks for catching this.,48362314,2013-07-12 00:37:45
1760299,187046,5150355,5,thanks :),48362314,2013-07-12 00:36:48
1760299,187046,5150361,13,"add Alex Levenson here, too!",48362314,2013-07-12 00:37:05
1818092,187046,5363925,31,Sleep secs between workflows might be a useful concept to share with the pig module when we get around to dealing with multiple workflows in a single script caused by pig's `exec` operator.,51405741,2013-07-24 10:09:43
1818092,187046,5363818,33,"can you get away with relying on jars from user's installation of hive, or do you need to include them within the ambrose-hive app bundle?",51405741,2013-07-24 09:51:52
1818092,1783671,5368841,26,"Thank you for the tip, I'll fix that.",51405741,2013-07-24 16:11:19
1818092,1783671,5368833,53,"I've just checked the master branch and see 8080 as default for the Pig runtime ```(AMBROSE_PORT=""${AMBROSE_PORT:-8080}"")```",51405741,2013-07-24 16:11:01
1818092,1783671,5368827,37,"This is a copy-paste issue, taken from main README file which contains the same old link.",51405741,2013-07-24 16:10:52
1818092,1783671,5368835,33,"Those are not needed, I'll get rid of them.",51405741,2013-07-24 16:11:08
1818092,1783671,5368837,35,"That's a good idea. I already thought of that, but on the first try my intention was to modify (break) the least code on the core components. Probably the job metrics names in PigJob/HiveJob could also be put into a common place..",51405741,2013-07-24 16:11:13
1818092,187046,5363872,37,replace with ref to some common arg string definition to avoid multiple copies of this const within different classes.,51405741,2013-07-24 09:59:33
1818092,187046,5363863,26,"prefer linking to value of constant to keep things in sync, e.g. `{@value Arguments#POST_SCRIPT_SLEEP_SECS_PARAM}`",51405741,2013-07-24 09:58:13
1818092,187046,5363801,53,I believe the default port is now random if env variable `AMBROSE_PORT` is not defined.,51405741,2013-07-24 09:50:05
1818092,1783671,5368846,37,For this purpose we would need a common constant class shared between ambrose-pig and ambrose-hive projects. ,51405741,2013-07-24 16:11:49
1818092,187046,5363786,37,Note that in latest master I've updated the Jetty config so resources within `web/` are bound directly to root url. This url has consequently been shorted to `http://localhost:8080/workflow.html`.,51405741,2013-07-24 09:48:39
1818092,1783671,5368849,150,"Thank you for pointing this out. Yes, but this is not needed in this case, so I fix the condition.",51405741,2013-07-24 16:11:56
1818092,187046,5363840,35,perhaps we can migrate these shared strings within the common module somewhere to encourage consistency across runtimes and better organize documentation?,51405741,2013-07-24 09:55:35
1818092,187046,5363913,150,I'm not familiar with `org.apache.commons.lang.StringUtils`. What does `StringUtils.isEmpty(line)` buy you over just `line.isEmpty()`? Null safety?,51405741,2013-07-24 10:06:27
1818092,1783671,5525449,1,"Chris, thank you for your remark, I added the Apache license headers.",53022051,2013-08-01 14:23:46
1818092,12202,5512383,1,"don't forget proper copyright headers on all *.java files, we want you to get credit :)",53022051,2013-08-01 00:01:26
1818092,73683,5468926,23,"mvn package failed during the hive part with this:

```
[ERROR] Failed to execute goal on project ambrose-hive: Could not resolve dependencies for project com.twitter.ambrose:ambrose-hive:jar:0.2.5-SNAPSHOT: Could not find artifact javax.jdo:jdo2-api:j",51677864,2013-07-30 10:40:35
1818092,73683,5468902,6,The script is actually in hive/src/main/scripts/hive-ambrose.,51677864,2013-07-30 10:37:07
1818092,73683,5469010,61,Can you follow a simialr pattern here as with {{EmbeddedAmbrosePigProgressNotificationListener}} where this class becomes abstract with a single EmbeddedAmbroseHiveProgressReporter subclass that initializes a InMemoryStatsService() and handles the ScriptS,51677864,2013-07-30 10:50:04
1818092,73683,5469040,34,"I hate to nit, but the standard indent for the project is 2 spaces.",51677864,2013-07-30 10:53:33
1818092,73683,5469084,13,"This seems useful for other MR frameworks. If so, it seems like we could put this under ```com.twitter.ambrose.model.hadoop``` in common.",51677864,2013-07-30 11:00:10
1900923,187046,5636085,49,guava,53165125,2013-08-07 21:31:25
1900923,1783671,5636684,49,I just remarked that you use now guava for collection instantiating. I'll then revisit my code and will do so.,53165125,2013-08-07 21:54:35
1900923,187046,5636056,4,"avoid hyphens, abbreviations in javadoc if possible.",53165125,2013-08-07 21:29:38
1900923,187046,5636079,32,"Do we already have a dep on guava? If so, replace this with Maps.newTreeMap()

http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Maps.html#newTreeMap()",53165125,2013-08-07 21:31:07
2182792,187046,6706083,5,could you comment on why core is better than mapred here?,58664787,2013-10-02 08:51:13
2182792,187046,6706121,33,"wouldn't {{0L}} be okay for initial / default value of map/reduceTaskStartTime here? If {{reduceTaskReport}} is empty then {{reduceTaskStartTime}} will be {{Long.MAX_VALUE}}, which seems an odd default.",58664787,2013-10-02 08:56:09
2182792,187046,6706163,46,"We should likely track counts for each TIPStatus enum value (pending, running, complete, killed, failed)",58664787,2013-10-02 09:02:07
2182792,187046,6706194,16,"Please change RuntimeException to IOException at most. Also consider improving exception message:

```
throw new IOException(String.format(""Failed to parse json '%s'"", json), e);
```",58664787,2013-10-02 09:05:46
2182792,187046,6706252,28,no need for else block given `return` in if block.,58664787,2013-10-02 09:11:46
2182792,187046,6706272,42,"prefer simple if blocks which fail fast and return to longer if-else blocks. for example:

```
if (status == null || mapperStartTime == null) return '---';
// now we're free to continue with rest of method given good status and mapperStartTime values",58664787,2013-10-02 09:14:37
2182792,187046,6706285,60,looks like the value and unit don't have any separating ws here (e.g. `5days` instead of `5 days`). consider prepending space to units.,58664787,2013-10-02 09:16:43
2182792,187046,6706330,74,"Given that we're gaining a few different date formatting routines around the codebase, we may want to consider adopting an existing library to simplify this, e.g. http://momentjs.com/",58664787,2013-10-02 09:22:02
2182792,187046,6706343,112,looks like you've added an extra space here. remove.,58664787,2013-10-02 09:23:05
2182792,187046,6706352,48,ws,58664787,2013-10-02 09:24:05
2182792,187046,6706358,38,`LOG.debug`?,58664787,2013-10-02 09:24:26
2182792,187046,6706361,67,ws,58664787,2013-10-02 09:24:41
2182792,187046,6706363,76,trailing ws,58664787,2013-10-02 09:24:50
2182792,187046,6706370,88,ws-- use two spaces for indentation here and elsewhere to match existing style.,58664787,2013-10-02 09:25:23
2182792,187046,6706400,39,"thanks for renaming these vars to reflect *output* stats :)

looks like you missed one var here-- `inputStats` should be `outputStats`.",58664787,2013-10-02 09:27:54
2182792,187046,6706408,5,are we ready for this change? pretty substantial.,58664787,2013-10-02 09:28:28
2182792,187046,6706428,14,"I think I see now why mapred is replaced with core ;)

If we're really ready to move to hadoop 1x, we should just remove this commented out dependency.",58664787,2013-10-02 09:29:49
2182792,73683,6707446,4,Logging uses org.apache.commons.logging.Log,58664787,2013-10-02 11:28:29
2182792,73683,6707473,50,Standard indents here and elsewhere are 2 chars.,58664787,2013-10-02 11:30:40
2182792,73683,6707511,69,"Here and below we're getting counts of finished mappers and reducers, not the mappers and reducers themselves. Hence let's name 
like get|setFinishedMappersCount.",58664787,2013-10-02 11:34:13
2182792,73683,6707529,85,"These should be getMapStartTime if we're talking about when the mapper phase started. Using ""task"" implied we're talking about actual tasks. Same for below with reduce.",58664787,2013-10-02 11:35:30
2182792,73683,6707546,94,Will this code below work if the job isn't a MR job and we don't have mapReduceJobState? We should write it so that it would.,58664787,2013-10-02 11:38:00
2182792,73683,6707572,4,Does this package not need mapred?,58664787,2013-10-02 11:40:52
2182792,73683,6707576,12,logging using apache commons logging,58664787,2013-10-02 11:41:17
2182792,73683,6707611,28,Don't add a second logger. Use log 2 lines below.,58664787,2013-10-02 11:43:51
2182792,73683,6707625,38,"log debug, not info using 'log' not 'LOG'.",58664787,2013-10-02 11:45:24
2182792,2606290,6733058,5,"Was fixing the dependency issue. Hadoop is 0.20.2 on the annest machine. hadoop-mapred is for 0.22, so we used a different jar, hadoop-core. By doing this, I don't have to find out NoSuchMethod Error at runtime.",58664787,2013-10-03 06:20:33
2182792,2606290,6733087,39,No problem. Fixed that as well =),58664787,2013-10-03 06:23:20
2182792,2606290,6733130,46,Will add that to the list.,58664787,2013-10-03 06:28:08
2182792,2606290,6733364,94,The UI would show '---' if the start/end time is not given.,58664787,2013-10-03 06:52:10
2182792,187046,6733383,5,"Grace, I think we need to stick with hadoop 0.22x for now. This may require backing out your other changes to hadoop-mapred vs hadoop-core.",58664787,2013-10-03 06:54:40
2182792,187046,6814973,15,"JsonParseException is itself an IOException. Are you adding the try-catch just to add the json to exception message in the stack? If so, consider quoting the json in the exception message for clarity:

```
throw new IOException(String.format(""Failed to",59228593,2013-10-08 05:55:02
2182792,187046,6814988,17,consider grouping `map*` and `reduce*` variables together for readability.,59228593,2013-10-08 05:55:47
2182792,187046,6815010,39,is `report.getStartTime()` ever less than zero?,59228593,2013-10-08 05:57:19
2182792,187046,6815553,69,"for consistency, please rename internal variables to match the names of getter and setter methods. This is the convention for ""java bean properties"":

http://docs.oracle.com/javase/tutorial/javabeans/writing/properties.html
http://www.oracle.com/techne",59228593,2013-10-08 06:45:15
2182792,2606290,6835749,39,"I don't think so. It should return: 0 if start time was not set, else start time.",59228593,2013-10-08 23:55:25
2182792,187046,6842066,33,feel free to drop the explicit ` = 0` initializers from all members here; Java will by default assign zero to these fields.,59228596,2013-10-09 03:13:03
2182792,187046,6842133,43,"Wouldn't the following logic be enough?:

```
if (mapEndTime < report.getFinishTime()) {
  mapEndTime = report.getFinishTime();
}
if (mapStartTime < report.getStartTime()) {
  mapStartTime = report.getStartTime();
}
```",59228596,2013-10-09 03:15:17
2182792,187046,6842409,39,"Could you try splitting out start/stop/duration as separate columns, or perhaps including only duration within the column, with all three in a mouse over popup? The current design adds too much vertical bloat to each table line.",59228596,2013-10-09 03:25:36
2182792,2606290,6845619,43,"I think mapStartTime < report.getStartTime() will return the start time of the last map task, not the first map task's start time. Maybe the last map task waited for a long time before it started. ",59228596,2013-10-09 06:24:23
2182792,2606290,6845635,39,Should this be a separate pull request? I created a popover.js class for Node Detail.,59228596,2013-10-09 06:26:01
2182792,187046,6845852,39,"I'd rather not merge to master a design we haven't reached consensus on. Feature branches are an ideal place to play with UI design.

More specifically, I'd like to see a single value in the ""Time"" column, perhaps duration by default, and when you mouse",59228596,2013-10-09 06:46:57
2241268,187046,6918092,4,"Good call. I hadn't thought to associate final parent node data with pseudo node from child to parent, but this make sense.",59455488,2013-10-11 20:26:44
2241268,187046,6918178,87,"These defaults should likely be relocated to ctor here:

https://github.com/twitter/ambrose/blob/master/common/src/main/resources/web/js/modules/ambrose/view/graph.js#L82

Or, perhaps the max width should be derived from default node radius, defined h",59455488,2013-10-11 20:29:06
2241268,187046,6918241,61,"Definition of stroke color should be moved to the ""theme"" and pulled from there:

https://github.com/twitter/ambrose/blob/master/common/src/main/resources/web/js/modules/ambrose/view/core.js#L32",59455488,2013-10-11 20:31:29
2241268,187046,6918299,4,"it might be clearer what these vars are used for if you rename them to something like `arcValueMax`, `arcValueMin`.",59455488,2013-10-11 20:33:38
2241268,187046,6918469,25,"clarify this comment: You're not adding *all* pseudo nodes in the graph to the list of updated nodes-- Just those pseudo nodes which are ancestors of the updated nodes (up to the next non-pseudo node).
",59455488,2013-10-11 20:39:10
2241268,187046,6918837,26,"Simplify this logic and avoid creation of lots of temp arrays like this:

```
// recursive function which adds direct ancestor pseudo nodes to nodes array
var addPseudoNodes = function(node) {
  if (node == null || !node.pseudo) return;
  nodes.push",59455488,2013-10-11 20:53:11
2241268,187046,6918942,72,How might we parameterize this so we could more easily swap the metric used to weight the arcs?,59455488,2013-10-11 20:56:30
2241268,187046,6919059,92,Nice. so `g.each()` iterates over the records (nodes) associated with the selection `g` and `d3.select(this)` uses the record to select the associated svg `group`?,59455488,2013-10-11 21:00:41
2241268,187046,6919069,96,"no need for `else` here, given the `return` in the initial `if` block.",59455488,2013-10-11 21:01:02
2241268,187046,6919088,105,"again, try to migrate theme-able properties like colors to the view/core.js file.",59455488,2013-10-11 21:01:53
2241268,187046,6919142,8,"Given the spaces, we should likely add some CSS which prevents line wrapping of these values.

Also, the column header ""Elapsed Time"" seems to wrap.. Consider simplifying to ""Duration"", or again updating CSS to prevent wrapping.",59455488,2013-10-11 21:03:36
2241268,2606290,6926609,72,Maybe we should create and update a global variable to control which metrics data we will use inside these functinon? ,59455488,2013-10-12 01:57:27
2241268,2606290,6926824,96,"First if statement is for the special case where max == min, otherwise it will return 1px due to error in the calculation. Second if (the else if) is for the normal calculation if the metrics data is available.
return 1px is for default edges width, repr",59455488,2013-10-12 02:05:58
2241268,2606290,6926872,92,Yes.,59455488,2013-10-12 02:08:39
2241268,187046,7016454,15,"let's make this 2x radius, so the max arc width would match the diameter of a node.",63646454,2013-10-17 02:21:44
2241268,187046,7016507,52,this may get expensive for lots of updates / large dags. we may want to revisit this once we have more experience on production jobs.,63646454,2013-10-17 02:22:54
2241268,187046,7016640,119,"let's pull out the computation of the arc width from assignment of the resulting value to the attr. This way we might swap it out to vary the behavior, e.g. log versus linear interpolation of arc values.",63646454,2013-10-17 02:26:23
2305195,73683,7142152,13,These interfaces are Hadoop agnostic and this change makes them hadoop-centric. Is there an alternate way to implement multi-threading without changing this interface?  ,66215186,2013-10-23 02:59:59
2305195,73683,7170402,4,Is this needed?,66591801,2013-10-24 01:28:01
2305195,73683,7170482,90,Let's add a private getter for this method and the setJobGraph method that lazy-initializes the value if not set. All access above would then change to use the getters.,66591801,2013-10-24 01:30:32
2305195,73683,7170564,36,"Better to remove the if/then and the null check and always call  addMapReduceJobState(node.getJob(), jobClient); here and below. The method then first checks for null and delegates to  addMapReduceJobState(node.getJob()); as necessary.",66591801,2013-10-24 01:33:20
2305195,73683,7170600,72,Why do we need two implementations of this method?,66591801,2013-10-24 01:34:50
2305195,2606290,7172456,4,Guess not. Also removed other unused things.,66591801,2013-10-24 02:29:28
2305195,2606290,7172694,72,Revert it back to the previous implementation.,66591801,2013-10-24 02:37:04
2311470,187046,7164881,70,Consider performing the hive version check once and keeping reference to a Function instance which does this work for you. The Function impl is chosen based on result of version check.,66252498,2013-10-23 22:44:59
2311470,187046,7195341,52,move this operation to separate try-catch block,66738116,2013-10-24 22:41:50
2311470,187046,7195356,55,use `mapWorkClass` here instead of `MapredWork.class`,66738116,2013-10-24 22:42:16
2311470,187046,7195421,77,Notate nullable args with `@Nullable` (`javax.annotation.Nullable`).,66738116,2013-10-24 22:44:26
2311470,187046,7318775,4,strange.. I thought 0.2.7-SNAPSHOT was already in master?,67817763,2013-10-30 23:24:20
2311470,1783671,7319707,4,I think my branch is left behind of the current master. Now I see that you've already merged this patch. Thanks.,67817763,2013-10-30 23:48:32
2343332,73683,7266798,24,Can you abstract the body and title generation into a method that encapsulates this the content logic? That would allow it to be overridden potentially. ,67569058,2013-10-29 05:11:23
2343332,187046,7268601,6,"I'm not sure this will ever be null if you've successfully called the member function on the reference, no?

Given that `.join(', ')` is just about the same complexity as `.commaDelimit()` I'm tempted to suggest you just drop this method.",67587005,2013-10-29 06:45:40
2343332,187046,7268624,18,fix indentation here through the rest of the block.,67587005,2013-10-29 06:46:37
2343332,187046,7268634,17,is this necessary?,67587005,2013-10-29 06:47:03
2343332,187046,7268705,32,"why are you adding this method to class Number if it isn't referencing `this`, then value of the current Number? Seems like this should be a utility function accessible via `Ambrose.calculateElapsedTime`.",67587005,2013-10-29 06:51:15
2343332,187046,7268720,16,indentation,67587005,2013-10-29 06:51:47
2343332,187046,7268730,17,"why not just `$("".popover"")`?",67587005,2013-10-29 06:52:26
2343332,187046,7268742,28,how about simplifying to `Job id undefined`?,67587005,2013-10-29 06:53:21
2343332,187046,7268748,33,prefer you drop the `'ID: ' +`,67587005,2013-10-29 06:53:39
2343332,187046,7268761,30,"I thought this could be accessed via `node.data.mapReduceJobState`, no?",67587005,2013-10-29 06:54:42
2343332,187046,7268794,43,"if you're not using a `<table>` here for the key-value pairs, let's use more semantic markup here, rather than just a sequence of `<p>` elements; Use a `<ul>` with `<li>` elements for each key-value pair. Also, prefer wrapping keys in `<span>` elements wi",67587005,2013-10-29 06:57:18
2343332,187046,7268812,71,simplify this logic; Move the test for `node.__data__.data` to top of function and return this default content if undefined.,67587005,2013-10-29 06:58:39
2343332,187046,7268826,85,"I think there's a popover placement option which will do this for you, no? Or is that option only available in Bootstrap 3.x?",67587005,2013-10-29 06:59:30
2343332,2606290,7269023,6,This method was taken from table.js. I will drop it and put it back.,67587005,2013-10-29 07:15:07
2343332,2606290,7269431,30,I don't think that works.,67587005,2013-10-29 07:44:07
2343332,2606290,7269499,85,"The popover adjusts the width of itself by default, but it would display a very narrow popover instead of switch placement, thus I used this method.",67587005,2013-10-29 07:48:09
2384709,187046,7598456,50,"interesting.. the title element is now dynamic, and can't be prefetched as before?",68885439,2013-11-13 00:03:42
2384709,187046,7598481,51,prefer `function() { ... }` style of whitespace for anonymous functions,68885439,2013-11-13 00:04:16
2384709,187046,7598501,61,"fix grammar here; ""Reset the <what?> to update..."", or ""Reset to update..."".",68885439,2013-11-13 00:05:09
2384709,187046,7598559,72,"hadn't we previously parameterized the function which extracts value for each edge? Consider writing a placeholder function which pulls this value, and apply here, instead of referencing the target metric directly.",68885439,2013-11-13 00:07:06
2384709,187046,7598581,80,parameterize with function which extracts value of target metric,68885439,2013-11-13 00:07:37
2384709,187046,7598641,90,does `concat` duplicate the target Array instance? please make sure you're not mutating `graph.nodes` here.,68885439,2013-11-13 00:08:47
2384709,187046,7598684,91,curious; why do we need to sort these nodes?,68885439,2013-11-13 00:09:45
2384709,187046,7598758,114,1 second seems slow.. What are other durations used for other animations? Consider parameterizing this within the global style.,68885439,2013-11-13 00:11:38
2384709,187046,7598832,5,"ah, this is the meat of the bugfix, no? All the other material seems more related to fixes to scaling of graph view edges.",68885439,2013-11-13 00:13:29
2384709,2606290,7601585,50,"The popover for the node gets data from the node, which changes all the time. So, prefetch won't work here.",68885439,2013-11-13 01:36:14
2384709,2606290,7602747,5,"This part is targeting to fix the backward-animation bug. 
Reseting the view every time to rescale the edges was causing the graph to flash when updating. the other parts were fixing that.",68885439,2013-11-13 02:08:31
2384709,2606290,7604595,114,Changed it to 750 to match the duration of node animation.,68885439,2013-11-13 02:55:00
2384709,2606290,7604625,90,"graph is a copy of this.workflow.graph, I checked and graph.nodes was not mutated.",68885439,2013-11-13 02:55:39
2438319,187046,7614199,26,"We can't add a custom repository here for resolution of arbitrary dependencies. Upstream dependencies must be present in Maven Central before we can continue.

Can you please comment in detail on what you need to pull in from this repository?

",70545592,2013-11-13 08:14:56
2438319,115552,8117244,5,that doesn't seem right? we shouldn't have a stable version until we actually make a release,72403954,2013-12-05 07:52:28
2438319,115552,8117275,52,"should the scope be ""provided"" here?",72403954,2013-12-05 07:53:25
2438319,1643331,8151590,5,"I have returned the version back to 0.2.9-SNAPSHOT and also added bin.xml for the maven build
But the main issue is that when building, It tries to download ""ambrose-common"" from https://oss.sonatype.org/content/repositories/snapshots/com/twitter/ambrose",72403954,2013-12-06 08:39:11
2498865,73683,7848543,35,"I'm far from a css/js expert, but can we do this without embedding css formating in the code and instead reference a css style from the css file?",72475761,2013-11-22 12:16:25
2498865,73683,7848559,16,"Does core.js already have the concept of Map/Combine/Reduce? This logic is specific to  MR job, which not all jobs will be. Can this concept be contained in the code that renders the pig script?",72475761,2013-11-22 12:18:24
2498865,73683,7848580,33,This block is specific to a Pig MR script. Can this be abstracted out of what should be a generic graph.js file?,72475761,2013-11-22 12:20:16
2498865,73683,7848592,12,"Again, lots of logic in here specific to pig. Can this be abstracted out?",72475761,2013-11-22 12:21:10
2498865,73683,7848600,54,Why is this commented out? Should it be removed?,72475761,2013-11-22 12:21:50
2498865,73683,7848616,77,This error could cause much concern or red herrings to a pig script author. Can you add more context to the error message. We don't want people seeing this error and thinking it's the reason their job died for example.,72475761,2013-11-22 12:23:36
2498865,73683,7848632,112,The listener shouldn't be generating html. That should be done by the Ambrose UI.,72475761,2013-11-22 12:25:11
2498865,73683,7848638,127,"You almost never will want to use e.printStackTrace(). log.error (with a descriptive message, see above comment) is much better. ",72475761,2013-11-22 12:26:10
2498865,2606290,7909395,16,"This change is used to refactor all the color hex to a single file. In this case, I put all the color hex in core.js (used as a utility class)",72475761,2013-11-26 06:12:41
2498865,187046,8112436,23,rename this id to reflect semantics of this menu item,74178477,2013-12-05 05:09:43
2498865,187046,8112471,18,"try to avoid this type of whitespace only change. Also, files should have trailing line endings.
",74178477,2013-12-05 05:10:31
2498865,187046,8112527,33,"is mapred.job.name a pig-only convention? Should we allow other runtimes to do this? e.g. Hive runtime likely has job names too, and we may want to make use of this in other views.",74178477,2013-12-05 05:12:03
2498865,187046,8112613,33,"from conversation, it sounds like hive doesn't set this parameter, so it'd be null...

It'd be nice in the future to have some way of consistently retrieving workflow name and assigning to the workflow controller, so views could make use of it (e.g. add",74178477,2013-12-05 05:14:16
2498865,187046,8112644,16,rename `jobName` to `workflowName`.,74178477,2013-12-05 05:14:59
2498865,187046,8112841,22,this should be part of view theme-- where the rest of colors are defined.,74178477,2013-12-05 05:19:13
2498865,187046,8219370,29,let's move this over to script view,74178479,2013-12-10 08:16:38
2498865,187046,8219393,4,let's please leave the generic graph datastructure alone here-- it doesn't need to know about ambrose even....,74178479,2013-12-10 08:17:24
2498865,187046,8219472,6,strongly prefer class selectors to id selectors in cases where dom elements are tied to specific javascript (view) objects.,74178479,2013-12-10 08:21:08
2498865,187046,8219478,19,ws before colons; match style of prior lines.,74178479,2013-12-10 08:21:56
2498865,187046,8219513,9,does the graph view use jquery ui? or is it just the new scriptview? consider migrating this dep over to the new script view.,74178479,2013-12-10 08:23:27
2498865,187046,8219562,1,"Let's rename this file to just `script`, as all other ""view"" classes don't include that suffix, and the view may be useful for other runtimes... eventually.",74178479,2013-12-10 08:25:35
2498865,187046,8219566,21,add jquery ui dep here if needed.,74178479,2013-12-10 08:25:48
2498865,187046,8219578,28,s/ProgressBar/Script/,74178479,2013-12-10 08:26:19
2498865,187046,8219590,34,remove this line if this param isn't needed.,74178479,2013-12-10 08:26:51
2498865,187046,8219633,37,"try removing the trailing `, null` arg here?

http://api.jquery.com/jQuery.extend/",74178479,2013-12-10 08:28:28
2498865,187046,8219668,43,`jobPolled` to match naming style of other existing events,74178479,2013-12-10 08:29:49
2498865,187046,8219695,51,rename `highlineScript` to `highlightScript`,74178479,2013-12-10 08:31:03
2498865,187046,8219873,171,let's try and rework to use css classes instead of element ids to identify dom elements which correspond to particular script lines in the script view. using element ids will prevent multiple instances of the view from being active at the same time.,74178479,2013-12-10 08:40:11
2498865,187046,8219900,173,it'd be great to migrate these colors to css selectors so we just have to update css classes assigned to the dom elements and cascading rules would do the rest.,74178479,2013-12-10 08:41:26
2498865,187046,8219961,156,job mouseover and selected state is actually carried within the job object itself; you shouldn't need the extra `mouseAction` param here-- Just look at the job's selected and mouseover flags.,74178479,2013-12-10 08:44:46
2498865,187046,8220094,171,"Here's an example using css to select appropriate script line element:

```
<div class=""jubjub-view-script"">
<table>
<thead>
<tr class=""""></tr>
</thead>
<tbody>
<tr class=""jubjub-view-script-line""></tr>
<tr class=""jubjub-view-script-line""></tr>",74178479,2013-12-10 08:52:39
2498865,187046,8220112,204,replace `mouseAction` with `job`,74178479,2013-12-10 08:53:49
2498865,187046,8220125,216,so this would change so you're just removing css classes from the matched elements.,74178479,2013-12-10 08:54:23
2498865,187046,8220143,218,this is dangerous; the selection should be narrowed to include only those elements which are descendants of the container dom element.,74178479,2013-12-10 08:55:29
2498865,187046,8220151,218,`this.container.find('.aliasM').html('&nbsp;');`,74178479,2013-12-10 08:56:04
2498865,187046,8220188,4,"Note that initially we'd thought the workflow itself might contain jobs with different runtimes, so associating a single runtime with the workflow kinda breaks that, but seems okay for now, given we certainly don't have any examples of workflows with jobs",74178479,2013-12-10 08:58:13
2498865,187046,8220191,18,remove,74178479,2013-12-10 08:58:21
2498865,187046,8220193,27,jobPolled,74178479,2013-12-10 08:58:30
2498865,187046,8220235,11,"all this should be migrated to the script view class as it should only be added to page when the script view is active.

try and work it into the script view init method, but make sure that only one is inserted (in case multiple script view objects are ",74178479,2013-12-10 09:01:29
2498865,187046,8220243,23,remove; this should be injected by script view.,74178479,2013-12-10 09:01:55
2498865,187046,8220248,31,here too; remove; this should be injected by script view. don't include an id.,74178479,2013-12-10 09:02:19
2498865,187046,8284086,8,"consider renaming `scriptDiv` to something more descriptive, similar to what other view impls are doing, e.g. `jubjub-view-script`",74178480,2013-12-12 05:18:10
2498865,187046,8284142,25,"localize this rule to script view, e.g.:

```
.ambrose-view-script .lineNumber { ... }
```",74178480,2013-12-12 05:19:36
2498865,187046,8284483,21,"you'll need to update RequireJS config within this file:

https://github.com/twitter/ambrose/blob/master/common/src/main/resources/web/js/require-config.js

to add an entry for jQueryUI, so RequireJS knows where to find it.

Something like this:

",74178480,2013-12-12 05:28:41
2498865,187046,8284666,57,"`hoveredJob` here should always refer to the same job as that referred to by `job`. use the `workflow` to grab currently selected job like this:

```
var selectedJob = workflow.current.selected;
```
",74178480,2013-12-12 05:33:04
2498865,187046,8284698,18,"no need for this; both current mouse-over and selected jobs are accessible via the `workflow`:

```
workflow.current.selected;
workflow.current.mouseover;
```

https://github.com/twitter/ambrose/blob/master/common/src/main/resources/web/js/modules/",74178480,2013-12-12 05:33:55
2498865,187046,8284850,94,"prefer css class names with style `ambrose-view-$viewname-$somethingelse`, e.g. `ambrose-view-script-title`.",74178480,2013-12-12 05:37:19
2498865,187046,8284931,40,"looks like this dom element is created directly within `workflow.html`. let's move its creation to the `createScriptDiv` method, so if it doesn't exist, it gets injected in the right place in the toolbar. I'll add another note below.",74178480,2013-12-12 05:39:35
2498865,187046,8284999,80,"After this line, add some code which attempts to retrieve the toolbar ""show script"" button, and if it doesn't exist, create it:

```
var $showScriptButton = $('#ambrose-view-script-show');
if ($showScriptButton.size() < 1) {
  // create and inject sc",74178480,2013-12-12 05:41:42
2498865,187046,8285091,67,"consider renaming that method to improve clarity / readability. e.g. ""unhighlightScript"".. or something.",74178480,2013-12-12 05:45:01
2498865,187046,8285174,127,"consider storing a reference to `$scriptNameEl` within `self` when you first create it, so you don't need to re-`find` that element to update its contents. Same goes for other dom elements you'll be updating on event handling.",74178480,2013-12-12 05:47:34
2498865,187046,8285615,102,"let's not do this. Instead leave data alone (base64 encoded utf-8 string), and decode on the client via:

https://developer.mozilla.org/en-US/docs/Web/API/window.btoa

```
function b64_to_utf8( str ) {
    return decodeURIComponent(escape(window.ato",74178480,2013-12-12 06:01:42
2498865,187046,8285626,149,"whoa.. hahahah. so the backend replaces all new lines with this string? this seems brittle.. I realize you must have played around a lot with new line encoding within the param string, but I wonder if there's a more stable way..

Indeed!! See comment be",74178480,2013-12-12 06:02:18
2498865,187046,8285692,175,initialize with `Number.MAX_VALUE`.,74178480,2013-12-12 06:05:24
2498865,187046,8285724,5,same deal as above.,74178480,2013-12-12 06:06:45
2498865,187046,8285731,17,revert...,74178480,2013-12-12 06:07:03
2498865,187046,8285733,27,revert.,74178480,2013-12-12 06:07:15
2498865,187046,8377931,4,"sounds like the `-1` values here were replaced with random values, not generated by valid execution of demo script. please revert these changes so we can test whether or not the updated code works with neg one values.",74373053,2013-12-17 02:19:17
2498865,187046,8377956,4,revert this.,74373053,2013-12-17 02:20:00
2498865,187046,8378000,24,pls add comment regarding why this added block is needed.. sounds like it fixes some strange blinking on window resize?,74373053,2013-12-17 02:21:37
2498865,187046,8378211,23,"revert and (1) add `id=""ambrose-navbar""` to top-level `div` above; (2) update selector for this `ul.nav` to something like `#ambrose-navbar ul.nav:eq(0)`.",74373053,2013-12-17 02:28:04
2498865,187046,8378237,16,"let's add an `id` property here, e.g. `id=""ambrose-navbar""` to simplify selection of this element. there should only ever be one of these on the page.",74373053,2013-12-17 02:28:52
2498865,187046,8378326,77,update selector here from `.nav.leftList` to `#ambrose-navbar ul.nav:eq(0)`,74373053,2013-12-17 02:30:52
2498865,187046,8378372,76,"first attempt to retrieve this element from the page, e.g.:

```
self.showScriptAction = $('#ambrose-navbar li.ambrose-view-script-show a');
```",74373053,2013-12-17 02:32:21
2498865,187046,8378468,142,i love this.,74373053,2013-12-17 02:34:20
2498865,187046,8378516,140,rename `script` to `scriptEncoded` to better document fact that input script is expected to be base64 encoded utf-8 bytes.,74373053,2013-12-17 02:35:21
2498865,187046,8378591,235,chain this with previous line to avoid re-finding the scriptLine elements.,74373053,2013-12-17 02:37:28
2560327,187046,8220323,25,"`container.find('.edgeScaleOpt')...`

oh, no, my bad, this is fetching dom element which contains the settings menu (should only be one of these on the whole workflow page).

We should circle back after this branch ships and reorganize the view settin",74081219,2013-12-10 09:07:17
2560327,187046,8220464,11,let's migrate initialization of the list elements from here into the graph-edge-popover class.,74081219,2013-12-10 09:14:37
2560327,187046,8220503,60,`self.container.find('path.pseudoEdge')` to ensure you're only selecting edges from the current graph view.,74081219,2013-12-10 09:16:36
2560327,187046,8220578,2,"general note; there seems to be an z-index bug with the edges versus the magnitude node circles-- The circles are above the edges, preventing the edges from receiving mouseover events.

Try to reorder creation of ""transparent"" edges which capture mouse ",74081219,2013-12-10 09:20:44
2560327,187046,8220703,130,delete this line; already done above.,74081219,2013-12-10 09:28:20
2560327,187046,8220707,122,var $this = $(this); and reuse,74081219,2013-12-10 09:28:40
2560327,187046,8220719,148,popover should already be jquery object; remove $(...),74081219,2013-12-10 09:30:02
2560327,187046,8220775,155,this is tricky... please add some comments here about why this is necessary.,74081219,2013-12-10 09:34:31
2560327,187046,8220847,210,"let's create an object which contains keys based on the valid values of `rescaleOption`, and whose values are ""getter"" functions, which extract a value from input data, or null if data doesn't contain valid value.
",74081219,2013-12-10 09:38:58
2560327,187046,8220894,302,let's rename this function to be something slightly more meaningful :) how about `calcEdgeControlPoints`?,74081219,2013-12-10 09:41:29
2560327,2606290,8311295,2,It seems that z-index for svg is different; disabled pointer-events for magnitude-circle instead.,74081219,2013-12-13 02:30:33
2560327,187046,8379238,52,"looks like this code may create multiple navbar entries if multiple instances of this class are created. Fix to first attempt to find the navbar element, and create if not found.",76886188,2013-12-17 02:53:30
2560327,187046,8379386,139,"simplify things like this to `$('<div class=""popoverBody"">')`",76886188,2013-12-17 02:57:32
2560327,187046,8379436,145,"not sure I like the `(<-)` and `(->)` added to these headers... perhaps remove for now, but in a future pull req we could play with different highlighting of source and target nodes on edge mouseover.",76886188,2013-12-17 02:58:31
2560327,187046,8379448,162,-1 to `(->)`,76886188,2013-12-17 02:58:47
2668746,187046,8480820,5,"consider renaming ""counter"" to ""edge"" for clarity",78022225,2013-12-20 02:31:44
2779694,187046,8794137,79,is it a problem that ${scalding.version} is 2.9.2 and not 2.9.3 here? should 2.9.3 be replaced with the variable?,80855978,2014-01-10 23:55:10
2779694,187046,8794196,19,"is this repo commonly used by scala projects? which deps do we pull from this one? if possible, let's try and stick with maven central only.",80855978,2014-01-10 23:56:21
2779694,187046,8794233,30,for the other modules we've added entries to the parent pom.xml dependencyManagement section so we don't have to respecify the version here. consider removing this line.,80855978,2014-01-10 23:57:30
2779694,187046,8794398,58,consider adding default plugin config to parent pom in case we have other modules which make use of this plugin,80855978,2014-01-11 00:02:03
2779694,187046,8794437,97,is the added config for the compiler plugin necessary here? can we update defaults in parent?,80855978,2014-01-11 00:02:43
2779694,7111,8794523,31,"I think you want abstract override def to get the stackable trait pattern:

http://stackoverflow.com/questions/2038370/traits-and-abstract-methods-override-in-scala

Super Sweet!",80855978,2014-01-11 00:05:34
2779694,3171564,8794838,79,"Well, it's not a version, but a part of artifact *name* actually. 
I am not really sure why it is this way, but that's how birdcage (and, I think, science) are configured too - scala 2.9.2, but scalding_2.9.3
",80855978,2014-01-11 00:15:28
2779694,3171564,8794965,19,"No, it is not for scala. 
This repo is specified in cascading/pom.xml. 
When I built locally, it worked find without this, but CI build on github failed, complaining about being unable to resolve dependencies like cascading-core-2.5.0-wip-77 for some re",80855978,2014-01-11 00:19:38
2779694,3171564,8795049,30,"Ah, will do. I did not realize one could do that for modules of the same project too. ",80855978,2014-01-11 00:21:48
2779694,3171564,8795086,58,"I thought about it, but it kinda seems logical, that scalding is going to remain the only module that needs scala, at least for a while, no?",80855978,2014-01-11 00:23:15
2779694,3171564,8795195,31,"Hm, but the overriden method (in Job) isn't abstract, can I still do it here? ",80855978,2014-01-11 00:26:58
2779694,187046,8795227,58,"Yup, find to leave as is for now.",80855978,2014-01-11 00:27:57
2779694,187046,8795496,19,"Ah, i think i see.. Looks as though conjars.org is where Chris Wensel publishes cascading ""wip"" releases:

http://conjars.org/cascading/cascading-core/versions/2.5.0-wip-77

I'm guessing we should consider this a quasi snapshot dependency, at least un",80855978,2014-01-11 00:37:53
2779694,3171564,8795701,31,"The way I am reading the explanation in the page you linked to, it seems to me that ""abstract override"" doesn't actually change the behavior, but is only needed to override an abstract method. Otherwise, the traits are still stackable. 
I tried this:

",80855978,2014-01-11 00:44:35
3471748,73683,11511416,28,"if we get an exception we'll warn that the we couldn't find the job, which implies it doesn't exist. Should we instead warn that we couldn't get the job from JT?",102757185,2014-04-11 04:19:39
3471748,73683,11511898,45,"IIRC, this hideous catch NPE was her not for the runningJob, but for something buried in the impl of getID(). ",102763741,2014-04-11 04:37:56
3472155,73683,11517989,21,Patch looks good. 2 space indents.,102770227,2014-04-11 09:48:00
3472155,73683,11517992,23,rogue empty line,102770227,2014-04-11 09:48:21
3472155,73683,11760550,21,Looks like you're still mixing 2 and 4 space indents in this class.,102770227,2014-04-18 05:32:54
3472155,187046,11762934,11,"if this is util class, consider public final, and add private default ctor",102818741,2014-04-18 08:25:38
3472155,187046,12251238,35,"missing an extra space after colon `"" Message: "" +`

consider removing the trailing `"". Ignoring...""`

i'm trying to think of some other way to indicate the error shouldn't be considered a big deal though...",105186216,2014-05-03 03:35:58
3472155,187046,12251245,36,so this log line will pick up full stack trace?,105186216,2014-05-03 03:36:24
3472155,393209,12251306,36,Yes.,105186216,2014-05-03 03:38:58
3534201,187046,11837777,27,add a sensible placeholder javadoc here please,103876283,2014-04-22 09:21:58
3534201,187046,11837802,44,"checkNotNull for args, or add @ Nullable annotations to params?",103876283,2014-04-22 09:23:16
3534201,187046,11837851,20,jdoc,103876283,2014-04-22 09:26:30
3534201,187046,11837860,41,fix indent,103876283,2014-04-22 09:27:04
3563248,73683,11984530,15,"In the web UI we have the concept of runtime IIRC. Could we keep the runtime field with the @class field? This would allow class to be used for serde, but runtime would remain a UI concept regardless of class used for a given runtime. We could also bind c",104133895,2014-04-25 11:36:49
3563248,187046,12004801,5,does this static instance now get reassigned? consider leaving final here.,104133895,2014-04-25 21:47:36
3563248,187046,12004834,18,"aniket, ws at eof is likely something you can configure in your editor. could you enable it? thanks!",104133895,2014-04-25 21:48:35
3563248,187046,12004868,25,glad it was as simple as this!,104133895,2014-04-25 21:49:48
3563248,393209,12015168,18,"Thanks @sagemintblue, I will look into this.",104133895,2014-04-26 01:41:45
3563248,393209,12080842,5,"unwanted changes got merged here, fixing it.",104133895,2014-04-29 11:18:34
3572650,187046,12018412,47,"how about creating the mapper on first request? perhaps we can assume all sub classes have been statically initialized by then, so the subtype list should be complete?",104270363,2014-04-26 03:18:38
3572650,393209,12019199,47,"static blocks are inside the sub classes themselves, with that, we cannot assume that static initializations are done by the time you first access it. Java will load the classes only when they are needed (unfortunately). Actually, good point, this means t",104270363,2014-04-26 03:40:40
3572650,393209,12019289,47,"and I checked, it does not work :( ... Tried PigJobTest.testFromJson without any other tests and any other initializations - failed.",104270363,2014-04-26 03:44:23
3572650,187046,12250959,48,move this to javadoc on the method itself,106562447,2014-05-03 03:26:48
3572650,187046,12251070,59,use logger,106562447,2014-05-03 03:30:01
3572650,187046,12251295,62,"heh, now this seems so small a method might as well push it into `newMapper()`",106562448,2014-05-03 03:38:29
3572650,187046,12251391,63,"So with this, any third party `Job` subclass wouldn't get picked up. This okay? For now, seems fine to me.",106562448,2014-05-03 03:42:44
3572650,393209,12251512,63,"Not ideal.

Tested with Dashboard-
[1788226358@qtp-1105890676-4] INFO org.reflections.Reflections - Reflections took 96 ms to scan 4 urls, producing 28 keys and 56 values 
[class com.twitter.ambrose.model.hadoop.MapReduceJob, class com.twitter.ambrose",106562448,2014-05-03 03:46:41
3602469,187046,12118349,21,will all clients need hraven-core in their classpath if we add the hRaven service impl to ambrose common module?,106412100,2014-04-30 02:38:24
3602469,393209,12118562,21,Only if they choose to use hravenstats-read/write-services.,106412100,2014-04-30 02:43:07
3602469,187046,12119276,64,i think we're using guava in ambrose. consider replacing here and elsewhere with `Sets.newHashSet()`,106412103,2014-04-30 02:59:47
3602469,187046,12120394,70,consider creating a constant to define pool size.,106412103,2014-04-30 03:25:22
3602469,12202,12120417,1,don't forget license headers,106273734,2014-04-30 03:25:59
3602469,187046,12120542,111,consider promoting this documentation to class-level javadoc,106412103,2014-04-30 03:28:53
3602469,187046,12120638,155,"looks like this field and the next can also be marked `final`, no?",106412103,2014-04-30 03:31:02
3602469,187046,12120704,196,should the ctors of this class just prevent this scenario?,106412103,2014-04-30 03:32:43
3602469,187046,12120750,200,does the flowQueueService implement its own retry logic?,106412103,2014-04-30 03:33:49
3602469,187046,12120939,313,so this impl assumes we're always dealing with the same workflow (`workflowId` argument is ignored). may want to add a note about this to class-level javadoc.,106412103,2014-04-30 03:39:29
3602469,187046,12120949,315,checkNotNull?,106412103,2014-04-30 03:39:38
3602469,393209,12160952,1,thanks @caniszczyk. I have added missing license headers.,106273734,2014-05-01 00:22:13
3602469,393209,12161369,200,"No, it does not. But, we can implement a Command pattern retry logic here if we see too many IOExceptions here.",106412103,2014-05-01 00:31:33
3602469,393209,12161819,313,Done.,106412103,2014-05-01 00:42:49
3602469,393209,12161915,313,"Ideally, AmbrosePPNL should have another interface in middle to compute workflowId based on jobConf instead of straight down passing scriptId as workflowId. This way we can keep the stats service stateless. Opened: https://github.com/twitter/ambrose/issue",106412103,2014-05-01 00:44:51
3602469,187046,12162051,47,any way to scope this suppression more precisely?,106412105,2014-05-01 00:48:01
3602469,187046,12162078,51,"consider making these final, given they're initialized within ctor below",106412105,2014-05-01 00:48:37
3602469,187046,12162174,103,move `Integer.MAX_VALUE` into a static const field at class level and document it.,106412105,2014-05-01 00:50:38
3602469,187046,12162206,110,any other preconditions on other args?,106412105,2014-05-01 00:51:23
3602469,187046,12162224,112,what happens on parsing failure?,106412105,2014-05-01 00:51:41
3602469,187046,12162296,120,why not test `workflowEvents.size()`?,106412105,2014-05-01 00:53:23
3602469,187046,12162320,118,prefer `newArrayListWithCapacity` here if possible,106412105,2014-05-01 00:53:52
3602469,187046,12162410,144,can this be migrated to `src/test/java`?,106412105,2014-05-01 00:55:42
3605677,187046,12168180,33,consider migrating the workflow id parsing logic to some shared util module,106292916,2014-05-01 02:55:44
3605677,187046,12173399,4,"i think we'll need to verify the assumption here regarding structure and content of workflow id for all of our runtimes... for instance, does this work when running pig with the embedded ambrose PPNL?",106292915,2014-05-01 05:30:18
3605677,230143,12203232,4,"You are right, I guess this is hraven-specific. What do you think about just putting the entire workflowId there?",106292915,2014-05-02 00:38:35
3605677,187046,12203672,4,"I think this may be a good opportunity for us to think more about how to instrument runtime-specific views... If the current workflow is supported, this view should be active, otherwise we don't see it.",106292915,2014-05-02 00:45:50
3605677,393209,12212447,4,cleanup?,106292915,2014-05-02 04:01:03
3605677,187046,12212649,34,"perhaps we should just test whether or not the workflow id is something we can parse info out of, in which case we render the view. otherwise, we remove container from the DOM so nothing is visible.",106346692,2014-05-02 04:08:23
3605677,230143,12213927,34,"I can test to see if if we have a 5-part hraven key, and parse the appropriate info out if necessary.  It will return an object with workflow name, user, cluster as keys if parsing was successful, empty object if parsing was not. Would that be preferred?",106346692,2014-05-02 04:52:10
3605677,187046,12214073,34,"would be helpful to see a few screenshots with mock workflow ids, both with expected hraven format, and a few from other runtimes without expected format.

Given that this is a completely new addition to ui, it'd be safe to enable it only when the workf",106346692,2014-05-02 04:57:10
3734158,393209,12980984,5,fix the import,113157562,2014-05-23 04:56:43
3734486,187046,13111981,15,not sure why we had needed this in the first place. I assume nothing breaks without it.,113162107,2014-05-28 06:07:29
3893869,187046,13729943,5,"is this related, or just bumping version here in addition to above fix?",125894636,2014-06-13 03:18:56
3893869,393209,13730316,5,"Not really, should I make another request for this?",125894636,2014-06-13 03:25:37
5756120,187046,22563967,71,"I've opted to reuse the hadoop metric enum names here, instead of create yet another set of strings to identify these values.

I'll be updating client js code to retrieve these metrics using the canonical enum names.",203125757,2015-01-07 07:40:25
51473,196885,1064941,24,we generally have a convention of having imports in alphabetical order,1784481,2012-06-28 05:27:43
51473,196885,1064960,55,/Users/jcheng?,1784481,2012-06-28 05:30:49
51473,196885,1064961,57,ditto,1784481,2012-06-28 05:30:59
51473,27684,1069668,60,"This is just a demo - however, always prefer System.nanoTime() for interval measurement.",1784472,2012-06-28 22:05:33
51473,27684,1069682,74,"consider topNeighbors.subList(0, 10) - you can ditch the counter and the hard to follow break",1784472,2012-06-28 22:08:00
51473,27684,1069722,24,"Its good to point out the java interfaces are being worked on, but more verbose is a given if someone chooses to use java. I'd replace 'the Java examples are considerably more verbose.' with 'the Java API is less polished.'",1784472,2012-06-28 22:13:58
56224,12202,1136763,1,please add copyright headers to all new source files,4372408,2012-07-11 04:30:00
56224,12202,1136764,1,please add copyright headers to all new source files,4372408,2012-07-11 04:30:06
56224,12202,1136765,1,please add copyright headers to all new source files,4372408,2012-07-11 04:30:16
56224,12202,1136766,1,please add copyright headers to all new source files,4372408,2012-07-11 04:30:21
56224,360007,1172457,18,Please add a doc for this and the functions within.,4372273,2012-07-17 00:28:54
56224,360007,1174334,28,Might be a good idea to create a case class for cache stats.,4372273,2012-07-17 04:13:04
56224,360007,1174338,40,Please update the doc to be javadoc style.,4372273,2012-07-17 04:13:23
56224,360007,1174349,100,This seems like a debug log. Please add a doc-level comment.,4372273,2012-07-17 04:15:12
56224,360007,1174365,40,Unsure why we can't use a LinkedHashMap for this: http://www.scala-lang.org/api/current/scala/collection/mutable/LinkedHashMap.html,4372273,2012-07-17 04:17:44
56224,360007,1174375,182,"Again, a doc would be good.",4372273,2012-07-17 04:18:19
56224,360007,1174381,22,"from the implementations, this seems like a getAndUpdate method, right?",4372273,2012-07-17 04:19:27
56224,360007,1174382,22,Please add a doc,4372273,2012-07-17 04:20:05
92072,209868,651807,121,"could you explain, why changing to this non-functional style?",1784651,2012-04-05 23:24:39
92072,342684,654016,121,Mainly for performance. The scala foldLeft is substantially slower and less efficient object creation wise than a plain old while loop.,1784651,2012-04-06 11:14:23
92072,209868,663174,16,"API changes are not backward compatible, please increase the version to 2.0.0",1784651,2012-04-10 04:47:23
92072,342684,671732,16,"Added, thanks!",1784651,2012-04-11 22:14:44
92072,209868,677215,5,"change this to
2.0.1-SNAPSHOT

change
project/release.properties
2.0.0",1784646,2012-04-12 21:44:46
92072,342684,685359,5,"Cool, updated",1784646,2012-04-15 00:33:04
190901,360007,1427639,16,format according to convention,6499507,2012-08-21 23:25:04
190901,360007,1427676,51,s/parts/numParts,6499507,2012-08-21 23:28:04
190901,360007,1427717,52,"better to check if the directory exists (and that you have write access), and create it otherwise",6499507,2012-08-21 23:31:09
190901,360007,1427744,65,optional: can do this in parallel.,6499507,2012-08-21 23:33:15
190901,360007,1427747,69,no need to specify type here and elsewhere,6499507,2012-08-21 23:33:47
190901,360007,1427825,23,"this is a ""safe"" random walk i think. please do note in the doc that this will be considerably slower than the regular random walk.",6499507,2012-08-21 23:39:34
190901,360007,1427844,40,"add ""safe_"" to stats here and elsewhere to single these out...",6499507,2012-08-21 23:40:24
190901,360007,1427956,5,"i'm ok with this as a general idea, but we need to make sure that none of the implementations assume that this is immutable without a concrete backing implementation. i'd suggesting highlighting this in the trait doc, and adding an example mutable impleme",6499507,2012-08-21 23:50:11
190901,360007,1427992,6,pre-initialize to numNodes,6499507,2012-08-21 23:53:01
190901,360007,1427996,5,what kind of a random graph is this?,6499507,2012-08-21 23:53:31
190901,360007,1428044,24,looks more general than an edge shard reader? should the package change?,6499507,2012-08-21 23:57:21
190901,360007,1428062,25,?,6499507,2012-08-21 23:58:17
190901,360007,1428070,29,better doc please,6499507,2012-08-21 23:59:39
190901,360007,1428081,35,s/numEdges/numIntsToRead/ or something like that...,6499507,2012-08-22 00:00:24
190901,360007,1428120,53,"this is a binary, not text right?",6499507,2012-08-22 00:04:47
190901,360007,1428123,72,don't need the trailing :Unit,6499507,2012-08-22 00:05:11
190901,360007,1428133,20,same top level comments as for above class,6499507,2012-08-22 00:06:01
190901,360007,1428136,29,dead code?,6499507,2012-08-22 00:06:22
190901,360007,1428173,47,please double-check this logic. better docs will help,6499507,2012-08-22 00:09:32
190901,360007,1428179,83,kill commented code,6499507,2012-08-22 00:10:23
190901,360007,1428212,154,might be worth refactoring this into an abstract IntShardWriter and IntShardReader that has two underlying implementations...,6499507,2012-08-22 00:13:03
190901,360007,1428220,65,writeDoubleArrayToFile,6499507,2012-08-22 00:13:48
190901,360007,1428245,33,why not private?,6499507,2012-08-22 00:16:03
190901,360007,1467995,34,don't need that source != i i think,8122403,2012-08-28 01:07:45
190901,360007,1468033,23,Great! Thanks for adding this!,8122403,2012-08-28 01:11:22
190901,360007,1468065,21,written consecutively to a file.,8122403,2012-08-28 01:13:36
190901,360007,1468098,22,{@code IntShardsWriter},8122403,2012-08-28 01:16:50
190901,360007,1468111,86,edit distance of 1 from IntShardWriter :) Consider renaming this to IntMultipleShardWriter,8124523,2012-08-28 01:18:59
190901,360007,1468274,30,maximum size,8124523,2012-08-28 01:37:02
190901,360007,1468307,52,don't need return type.,8124523,2012-08-28 01:39:27
190901,360007,1468345,45,s/freePoint/firstFreeSlot,8124523,2012-08-28 01:42:00
190901,360007,1468467,83,remove commented code.,8124523,2012-08-28 01:51:56
190901,360007,1468499,137,"umm, maybe resolve this todo?",8124523,2012-08-28 01:54:29
190901,360007,1468587,156,please remove return types unless they are needed by the compiler.,8124523,2012-08-28 02:00:40
190901,360007,1468595,197,toString,8124523,2012-08-28 02:01:04
190901,360007,1468628,22,needs to be a volatile i think to test what you want to test...,8124523,2012-08-28 02:03:31
190901,360007,1468642,15,"instead of this, you could use http://docs.oracle.com/javase/1.4.2/docs/api/java/io/File.html#createTempFile%28java.lang.String,%20java.lang.String%29 also look at deleteOnExit.",8124523,2012-08-28 02:04:57
190901,255623,1469128,34,Did something slightly different because this generates a random directed graph.,8122403,2012-08-28 02:38:56
190901,255623,1469439,22,Ok,8124523,2012-08-28 03:06:05
190901,255623,1469440,197,Done,8124523,2012-08-28 03:06:10
190901,255623,1469443,156,Sure,8124523,2012-08-28 03:06:19
190901,255623,1469446,83,Ok,8124523,2012-08-28 03:06:38
190901,255623,1469445,137,Renamed and added a safe addToHead function,8124523,2012-08-28 03:06:33
190901,255623,1469447,45,Ok,8124523,2012-08-28 03:06:45
190901,255623,1469452,30,Renamed.,8124523,2012-08-28 03:06:54
190901,255623,1469451,52,Ok,8124523,2012-08-28 03:06:49
190901,255623,1469793,15,Added convenience functions to FileUtils for that.,8124523,2012-08-28 03:42:33
195580,196885,1430828,14,"don't particularly like the name ""readwrite"", perhaps ""io"" ?",6554242,2012-08-22 04:41:14
195580,196885,1430836,38,s/partFilesStartWith/prefixFileNames/,6554242,2012-08-22 04:42:35
195580,196885,1430864,17,alphabetize import statements,6554242,2012-08-22 04:45:33
195580,196885,1430882,24,This is not very clear - can you explain that iteratorSeq is a method and also explain what a NodeIdEdgesMaxId is?,6554242,2012-08-22 04:47:34
195580,196885,1430893,27,I would just take this out completely,6554242,2012-08-22 04:48:53
195580,196885,1430900,59,"any rationale for choosing 128 as the default? If not, just add that ""128 is an arbitrary default""",6554242,2012-08-22 04:50:05
195580,196885,1430912,46,"consider changing the name to ""OneShardReader"" for clarity and not causing confusion with the ""ShardsReader"" class you have below",6554242,2012-08-22 04:52:07
195580,196885,1430918,48,"this regex is more powerful than what you have in the test/resources. Consider making this more restricted, for speed.",6554242,2012-08-22 04:52:58
195580,196885,1430930,49,private?,6554242,2012-08-22 04:55:29
195580,196885,1430939,63,any reason to have both 'i' and 'currIndex' ?,6554242,2012-08-22 04:56:33
195580,196885,1430981,88,mapping to null and then filtering nulls out is one way. A better way might be to use flatMap { fileName => if (...) Some(fileName) else None },6554242,2012-08-22 05:04:28
195580,196885,1431006,65,"would be great to modify README as well to point out that this exists, and provide an end to end example of something running on a small graph read via this reader",6554242,2012-08-22 05:07:45
254051,196885,1450385,16,alpha order,6778061,2012-08-24 05:09:38
254051,196885,1450398,42,spaces after the ':' here and everywhere,6778061,2012-08-24 05:11:47
254051,196885,1450410,56,why do you need to specify ': Array[Double]'',6778061,2012-08-24 05:13:07
254051,196885,1450418,105,s/info/calculating? and perhaps a more useful message?,6778061,2012-08-24 05:13:50
254051,196885,1450425,113,"kind of ugly, perhaps accept an Option[Int] param that prints progress after count reaches that value",6778061,2012-08-24 05:15:42
254051,196885,1450434,126,ditto,6778061,2012-08-24 05:16:25
254051,196885,1450440,20,"perhaps specify here that this is unoptimized, and runs in a single thread for now.",6778061,2012-08-24 05:17:09
308029,360007,1488424,23,s/g/graph for readability,8586840,2012-08-29 23:04:10
308029,360007,1488570,24,statsDumpInterval,8586840,2012-08-29 23:17:01
308029,360007,1488573,25,statsOutputDirectory,8586840,2012-08-29 23:17:15
308029,360007,1488601,43,"don't need this, right?",8586840,2012-08-29 23:18:52
308029,360007,1488734,33,cacheMechanism should be SimulatedCache,8586840,2012-08-29 23:27:20
308029,360007,1488745,57,i feel like statsInterval belongs in the cache,8586840,2012-08-29 23:28:19
308029,360007,1488762,24,"as we discussed, this could be more expansive...",8586840,2012-08-29 23:29:13
308029,360007,1488782,45,i'm not sure what this is?,8586840,2012-08-29 23:31:06
308029,360007,1488810,54,"so this is number of accesses before first miss? if so, can you rename accordingly?",8586840,2012-08-29 23:32:10
308029,360007,1488883,114,"no printlns. maybe log, but be careful not to log too much.",8586840,2012-08-29 23:37:04
308029,360007,1488918,172,a fuller explanation here might be helpful.,8586840,2012-08-29 23:39:22
308029,255623,1500557,114,ok,8586840,2012-08-31 00:16:48
308029,255623,1500577,43,gone.,8586840,2012-08-31 00:17:30
308029,255623,1500573,33,modified.,8586840,2012-08-31 00:17:25
308029,255623,1500567,45,renamed.,8586840,2012-08-31 00:17:09
308029,255623,1500579,24,renamed.,8586840,2012-08-31 00:17:38
308029,255623,1500578,25,renamed.,8586840,2012-08-31 00:17:35
308029,255623,1500570,57,now it is.,8586840,2012-08-31 00:17:17
308029,255623,1500566,24,expanded.,8586840,2012-08-31 00:17:08
308029,255623,1500563,54,renamed.,8586840,2012-08-31 00:16:59
308029,255623,1500559,172,ok,8586840,2012-08-31 00:16:51
308029,255623,1500582,23,renamed.,8586840,2012-08-31 00:17:43
308029,360007,1509030,22,Please make a note that this is single threaded for now.,9117541,2012-08-31 23:16:06
308029,360007,1509037,64,can kill this comment.,9117541,2012-08-31 23:16:40
308029,360007,1509077,30,all internal vars should be marked as private. here and elsewhere.,9117541,2012-08-31 23:20:52
308029,255623,1509511,30,Done.,9117541,2012-09-01 00:03:53
308029,255623,1509514,22,It has come to pass.,9117541,2012-09-01 00:04:09
308029,196885,1557954,18,alpha order of imports,9160920,2012-09-08 00:25:42
308029,196885,1558023,53,newline after and before each def would be great,9160920,2012-09-08 00:30:53
308029,255623,1558861,18,Changed.,9160920,2012-09-08 02:09:28
308029,255623,1558863,53,Added \n s,9160920,2012-09-08 02:09:41
403025,196885,1175807,3,we try to keep imports in alphabetical order. com.google.* before com.twitter.* before java.* etc.,12116044,2012-07-17 10:29:59
403025,196885,1175814,19,"using a Map has a side-effect that this will occupy much more memory. Making this note in the comments would be great.

Also, using http://fastutil.dsi.unimi.it/docs/it/unimi/dsi/fastutil/ints/Int2ObjectMap.html is much better than using scala HashMaps. W",12116044,2012-07-17 10:32:06
403025,196885,1175849,184,adding some comments on the params of the class would be great. (just like the comments before ArrayDirectedGraph),12116044,2012-07-17 10:39:44
403025,196885,1175862,192,simply nodes.get(id) will work,12116044,2012-07-17 10:43:23
403025,196885,1175864,194,might as well add a newline to eof,12116044,2012-07-17 10:43:47
403025,196885,1175882,185,"do you need these ""override"" keywords?",12116044,2012-07-17 10:47:42
403025,78851,1175898,185,"Most likely not, `ArrayBasedDirectedGraph` seems to work fine without them, I do it just to be explicit - can be removed if you'd like.",12116044,2012-07-17 10:52:24
403025,196885,1175958,48,"if you don't need the maxnodeid, why have this in this tuple?",12116029,2012-07-17 11:09:35
403025,196885,1175960,61,"see fastutils, as noted above.",12116029,2012-07-17 11:10:02
403025,196885,1175966,61,do you really need both a HashSet and a HashMap ? ,12116029,2012-07-17 11:12:49
403025,196885,1175988,70,"are you sure the HashSet and HashMap operations are concurrency-safe? Ine the case of Array, the assignment is safe when done by multiple threads. Don't think it is advisable to change mutable hashmap concurrently.",12116029,2012-07-17 11:15:28
403025,196885,1175992,178,just move this to the test then?,12116029,2012-07-17 11:17:07
403025,196885,1175994,14,"might want to add a test with multiple threads, given some concurrent operations being done above.",12116029,2012-07-17 11:17:28
403025,78851,1176070,48,"I'm not quite sure which tuple you are referring to, could you be more specific?",12116029,2012-07-17 11:44:33
403025,78851,1199098,61,"After a bit of testing it seems I do, the `HashSet` is storing some information that the `HashMap` should not have until some more processing has been done (e.g. line 106 and 109), though perhaps I am overlooking something I can do to circumvent that...",12116029,2012-07-19 22:33:49
403025,78851,1199113,70,"Fair point, though it does seem to pass the tests, but I can see race conditions happening later on. ",12116029,2012-07-19 22:35:07
409698,12202,1645969,1,Please add copyright header information.,12511766,2012-09-20 03:52:20
409698,12202,1645976,1,"Please add copyright/license header information, see other files as an example.",12511766,2012-09-20 03:52:52
409698,12202,1645973,1,"Please add copyright/license header information, see other files as an example.",12511766,2012-09-20 03:52:46
409698,12202,1645979,1,"Please add copyright/license header information, see other files as an example.",12511766,2012-09-20 03:53:07
409698,12202,1645978,0,"Please add copyright/license header information, see other files as an example.",12511766,2012-09-20 03:53:00
409698,739292,1646073,1,"Hi, sorry about that. I have now added the license informations. I am not sure if they are included in this Pull request, but I cannot make a new Pull request....? (First time making a pull request!)",12511766,2012-09-20 04:06:31
409698,12202,1646092,1,"Thanks, looks like figured out how to update the PR :)",12511766,2012-09-20 04:10:58
409698,196885,1689567,6,we don't really want to move to scala 2.9 just yet.,12513820,2012-09-26 01:55:29
409698,196885,1689593,4,"Is this equivalent to -Xmx4096m ? If so, kind of big to have.",12513820,2012-09-26 01:58:24
409698,196885,1690128,4,sure you want to do this? no project.iml in my cassovary/ dir,12513820,2012-09-26 02:44:49
409698,196885,1690145,24,"we generally have not listed author names in the past in the source code. So, pls leave it out.",12513820,2012-09-26 02:46:16
409698,196885,1690153,11,s/iterations/iteration,12513820,2012-09-26 02:48:04
409698,12202,1690156,24,"Agreed, please ensure that you use your twitter email as the author too (e.g., git commit --amend --author=""abc <abc@twitter.com>""",12513820,2012-09-26 02:48:15
409698,196885,1690169,38,"s/may (will)/likely to, as explained in the paper./",12513820,2012-09-26 02:49:34
409698,196885,1690172,49,make this long?,12513820,2012-09-26 02:49:57
409698,196885,1690180,52,"pls write a couple of lines about why these probabilities are chosen (in addition to, if still needed, link to this reference)",12513820,2012-09-26 02:50:52
409698,196885,1690182,65,extra newline,12513820,2012-09-26 02:51:03
409698,196885,1690186,67,"inconsistent spacing (e.g., need extra space after the final ',')",12513820,2012-09-26 02:51:33
409698,196885,1690213,35,prefer to specify this as a cmdline option rather than use JVM option,12513820,2012-09-26 02:54:18
409698,196885,1690247,116,>= ?,12513820,2012-09-26 02:57:12
409698,196885,1690266,136,kill extra space,12513820,2012-09-26 02:59:23
409698,196885,1690279,130,consider calculating (col_en - col_st)/2 and (row_en-row_st)/2 outside the if statement for better readability.,12513820,2012-09-26 03:00:53
409698,196885,1690290,20,"pls add comments on what this interface is, as well as some doc for each method.",12513820,2012-09-26 03:02:30
409698,196885,1690308,68,"prefer ""-part-"" (k.e., extra '-' after ""part"")",12513820,2012-09-26 03:04:23
409698,196885,1690313,41,'n' is not really needed,12513820,2012-09-26 03:05:40
409698,196885,1690316,42,"any particular rationale to ""reverseBytes"" ?",12513820,2012-09-26 03:06:18
409698,196885,1690318,23,"pls write a couple of lines about this ""edge list format""",12513820,2012-09-26 03:06:48
409698,196885,1690341,51,"seems like the binary format here would be different than the one above (in EdgeListOutput). Is that correct? If so, it would be nice to have the same binary format. If it would be the same, then it would be nice to use the same code to do the actual writ",12513820,2012-09-26 03:10:23
409698,196885,1690363,27,can you pls add a note on how to use this in <toplevel>/examples/ExamplesREADME.md? It would be be even nicer to give an example of doing parallel pagerank on a huge graph generated using this (but that can wait when you have the parallel pagerank),12513820,2012-09-26 03:14:01
409698,739292,1691111,51,"On Tue, Sep 25, 2012 at 3:10 PM, Pankaj Gupta <notifications@github.com>wrote:

> In src/main/java/com/twitter/pers/graph_generator/HDFSEdgeListOutput.java:
>
> > +        System.out.println(""Using HDFS output: "" + fileNamePrefix);
> > +    }
> > +",12513820,2012-09-26 05:18:08
2197818,196885,6734995,14,perhaps do a find (as in the next line) to be consistent?,58905203,2013-10-03 10:11:17
2197818,196885,6735010,5,how about changing this to $root/sbt instead to be a bit more readable?,58905203,2013-10-03 10:14:48
2197818,196885,6735012,8,ditto,58905203,2013-10-03 10:14:59
2197818,710025,6749690,14,No clean way; find can't sort by time. Often there are multiple scala-* directories and heuristic here is to select the newest file.,58905203,2013-10-03 23:22:30
2197818,196885,6753393,14,"ok, did you want to add a '-l' option because 'ls -t' will show multiple files in a line. e.g., see below:

tw-mbp13-pgupta:~$ ls -t *.pdf
b.pdf     p575.pdf
",58905203,2013-10-04 01:36:19
2197818,710025,6753644,14,"Not a problem here because 'ls' will put a newline rather than spaces when writing to a pipe. E.g.:
$ touch b.pdf p575.pdf && ls -t *.pdf | head -2
b.pdf
p575.pdf

and

$ ls -t *.pdf > abc && cat abc
b.pdf
p575.pdf",58905203,2013-10-04 01:44:46
2197818,710025,6753988,14,"I found 'ls' has a '-1' parameter which lists one file per line, without the baggage of '-l'. While not strictly necessary here, I added '-1' for clarity. Tested on OSX and RHEL6.",58905203,2013-10-04 01:58:08
2375072,289817,7741354,9,"Have you considered having

val label: Option[Int] = None ?

then isLabeled is simply label.isDefined, and you have one less field.",68539729,2013-11-19 05:14:54
2375072,289817,7741467,20,Could you add some docs for the classes in this file?,68539729,2013-11-19 05:17:50
2375072,289817,7741483,41,Some examples in the docs would be a great help.,68539729,2013-11-19 05:18:08
2375072,289817,7741517,23,These function names are confusing to me. I may be missing context here. What are you trying to achieve?,68539729,2013-11-19 05:19:18
2375072,196885,7845186,16,not used,68539729,2013-11-22 07:58:30
2375072,196885,7845203,22,why is this needed?,68539729,2013-11-22 07:59:15
2375072,196885,7845970,19,a more verbose comment would be great,68539729,2013-11-22 08:38:37
2375072,196885,7845984,35,no need for multiline {...} in such single line methods,68539729,2013-11-22 08:39:37
2375072,196885,7845999,53,don't need type specification,68539729,2013-11-22 08:40:56
2375072,196885,7846021,33,it's generally a good idea to not put multiple classes / traits in the same file,68539729,2013-11-22 08:42:04
2375072,196885,7846034,13,"not elegant to use the text ""Trait"" in the type",68539729,2013-11-22 08:42:52
2375072,196885,7846048,2,please change copyright to 2013 on files you are modifying (or creating afresh) anyway,68539729,2013-11-22 08:43:50
2375072,710025,7865234,19,Added more verbose comments in latest (renumbering-only) pull request.,68539729,2013-11-23 01:59:12
2375072,710025,7865247,23,"Added context, usage example in latest (renumbering-only) pull request.",68539729,2013-11-23 01:59:30
2503143,196885,7870083,14,consider putting all the renumbering files inside either Node or util,72608670,2013-11-23 04:50:29
2503143,196885,7870121,26,"the names ""nodeId"" and ""nodeIdx"" are confusing. Perhaps external vs internal nodeId? or sparse vs dense ?",72608670,2013-11-23 04:51:52
2503143,196885,7870165,24,"this should be type parametrized so that non-int (e.g., long) or string node id values can be passed in.",72608670,2013-11-23 04:53:27
2503143,196885,7870203,25,"don't need the type specification "": Array[Int]"" as the compiler can infer it from the assignment",72608670,2013-11-23 04:54:42
2503143,196885,7870523,24,using java.util.concurrent.ConcurrentHashMap with scala converters is more efficient.,72608670,2013-11-23 05:08:52
2503143,196885,7870622,15,what do you think about adding nodeRenumberer to GraphReader itself?,72608670,2013-11-23 05:13:31
2503143,196885,7870645,58,"would be great if you could add an example to examples/ in the top level as well, and perhaps demonstrate the value on a biggish graph?",72608670,2013-11-23 05:14:34
2503143,710025,7871790,14,Moved renumbering files to util/.,72608670,2013-11-23 06:04:20
2503143,710025,7871796,26,"changed to ""externalNodeId"" and ""internalNodeId"", respectively.",72608670,2013-11-23 06:04:42
2503143,710025,7871798,25,Fixed.,72608670,2013-11-23 06:04:54
2503143,710025,7871806,58,Suggest synthetic or real biggish graph?,72608670,2013-11-23 06:05:18
2503143,710025,7872237,24,"A complexity: External node id type inherently coupled with regexp for reading vertex line, and ""lines.next.trim.toInt"" call for reading edge lines, in AdjacencyListGraphReader. E.g. current code would fail to parse a graph with any non-digit string node ",72608670,2013-11-23 06:26:29
2503143,710025,7872428,15,"If I'm not mistaken, nodeRenumberer couldn't act as a trailing optional parameter then, unless we also push ""directory"" and ""prefixFileNames"" parameters into GraphReader. But a future GraphReader might read from a non-file source. My thinking had been to ",72608670,2013-11-23 06:36:20
2503143,710025,7872724,24,"Just tried ConcurrentHashMap and unit tests found a race condition between reading map size (used for sequentially increasing counter) and putIfAbsent call. Possibly existed in old implementation too, but wasn't tickled.
Opted for a standard (non thread-",72608670,2013-11-23 06:54:41
2503143,196885,7932427,32,"take a look at com.twitter.cassovary.graph.Testgraph -- there is an implementation for generating a random graph. Would this be identical? regardless, please move graph generation to that class.

If you end up also including this implementation, please ",73216010,2013-11-27 00:42:15
2503143,196885,7932442,41,did you mean rng.nextInt ?,73216010,2013-11-27 00:42:39
2503143,196885,7932547,43,"do you need this additional intermediate data structure ""edges"" ? Seems to me that if you initialized 'g' right upfront, you could do addition of newly generated edges to g on the fly as edges are being randomly created. ",73216010,2013-11-27 00:45:36
2503143,196885,7932780,64,"can you refactor this into a separate file in io/ ? seems useful to have this writer just like there is a reader. If you generate the ER graph above as a DirectedGraph, would be great to have this writer.",73216010,2013-11-27 00:53:08
2503143,196885,7932912,89,"this is brittle. Because what if someone runs this on a huge memory machine? Also, since a random graph is built, this might actually be fine in a run.

Since you are simply demoing the renumbering in this file, I will suggest choosing the max node id t",73216010,2013-11-27 00:56:22
2503143,196885,7933105,5,"since the size will depend on the implementation (while DirectedGraph is just a trait), this is perhaps better named as approxStorageComplexity().",73216010,2013-11-27 01:00:57
2503143,196885,7933143,8,"correct me if I am wrong, but isn't this (2*numEdges + 8*numNodes)?",73216010,2013-11-27 01:02:12
2503143,196885,7933590,24,use java.util.concurrent.ConcurrentHashMap,73216010,2013-11-27 01:15:38
2503143,196885,7933688,33,"so, here's the problem with the robustness of this. The array is only built once if it is empty or not. So, what happens if there are a bunch of external ids added, then an internal id looked up (which instantiates the array), and then again an external i",73216010,2013-11-27 01:18:21
2503143,196885,7933714,15,"ok, let's go with this for now.",72608670,2013-11-27 01:18:56
2503143,196885,7934707,19,"you can fold this into the file NodeRenumberer.scala by doing

object NodeRenumberer {
final class Identity extends NodeRenumberer {
def ...
}
}

(e.g., see https://github.com/scala/scala/blob/master/src/library/scala/util/hashing/Hashing.scala fo",73216010,2013-11-27 01:45:06
2503143,710025,7942378,32,"In TestGraphs I knew about generateCompleteGraph but not generateRandomGraph; thanks, now using it.",73216010,2013-11-27 05:32:06
2503143,710025,7942391,41,"Yes, code now removed after refactoring.",73216010,2013-11-27 05:32:42
2503143,710025,7942450,43,"Agreed overall better, a little more logic would be needed for dup detection. Moot as code now removed after refactoring.",73216010,2013-11-27 05:34:31
2503143,710025,7942535,64,"Did so but became dead code because graph file writing is specialized here, in that dense node ids from generated random graph need to be mapped to sparse random ids.",73216010,2013-11-27 05:37:09
2503143,710025,7943142,89,"Even on a huge memory machine, examples/scala/build_run_example.sh invokes java with -Xmx1g so should be bounded by 1G.
Even so, agreed purposely generating & catching OOM is unsettling, so I reworked to compare representation costs as per your suggestio",73216010,2013-11-27 05:58:15
2503143,710025,7943147,5,Fixed.,73216010,2013-11-27 05:58:22
2503143,710025,7943383,8,"Fixed in latest revision to be 4 + 12*numNodes + 4*numEdges. Rationale is 4 bytes to represent num nodes, each vertex is 4 bytes for its id, 4 bytes for length of inbound list, 4 bytes for length of outbound list, and 4 bytes for id of each inbound and ou",73216010,2013-11-27 06:07:25
2503143,710025,7943747,24,"A red herring. Reason: body of externalToInternal method would still need to be wrapped in this.synchronized { ... }, because ConcurrentHashMap can't prevent two threads T1 and T2 from both calling externalToInternalMap.size, then both proceeding to inser",73216010,2013-11-27 06:21:30
2503143,710025,7943997,33,"I had thought about this, doesn't happen in current code flow because externalToInternal accessed only when reading file, and internalToExternal accessed only after finished reading file. Agreed maybe worthwhile to consider robustness w.r.t. alternate fut",73216010,2013-11-27 06:33:24
2503143,196885,7970088,36,remove,73449101,2013-11-28 04:22:49
2503143,196885,7970104,17,"update comment, now it is till 2<<20 right?",73449101,2013-11-28 04:23:29
2503143,196885,7970363,25,still need this? please update the imports post-refactor,73449101,2013-11-28 04:32:52
2503143,196885,7970440,9,should this be not just f(edgeCount) instead of having to iterate over the nodes,73449101,2013-11-28 04:35:29
2503143,196885,7970506,36,remove,73449101,2013-11-28 04:37:47
2503143,196885,7970575,28,adding a comment about this would be great,73449101,2013-11-28 04:39:51
2503143,196885,7970623,33,comment out all the asserts,73449101,2013-11-28 04:41:32
2503143,196885,7970853,5,alpha order,73449101,2013-11-28 04:50:31
2503143,710025,7973128,25,Fixed.,73449101,2013-11-28 06:26:26
2503143,710025,7973139,5,Fixed.,73449101,2013-11-28 06:27:00
2503143,710025,7973143,33,Done.,73449101,2013-11-28 06:27:08
2503143,710025,7973150,28,Done.,73449101,2013-11-28 06:27:23
2503143,710025,7973152,36,Done.,73449101,2013-11-28 06:27:30
2503143,710025,7973155,9,Fixed.,73449101,2013-11-28 06:27:39
2503143,710025,7973163,17,"Right, fixed.",73449101,2013-11-28 06:27:56
2503143,710025,7973167,36,Done.,73449101,2013-11-28 06:28:03
2503143,196885,8035243,22,please reorder imports in all files to be in alpha order.,73667700,2013-12-03 01:47:42
2503143,710025,8037457,22,Reordered all imports to be in alphabetical order.,73667700,2013-12-03 02:44:09
2621694,196885,9929916,78,the logic for figuring out whether it is scala 2.10 or not is repeated many times over. Can that be factored out once and reused ?,73315406,2014-02-21 06:18:50
2621694,202609,10217952,78,Refactored. Can be updated easily for future versions as well,73315406,2014-03-03 23:56:03
2621694,196885,10322316,4,Came across http://www.scala-sbt.org/0.13.1/docs/Detailed-Topics/Cross-Build.html for the right way to do cross-compilation across scala versions in sbt. Please use the patterns described here.,93534247,2014-03-06 05:28:01
2621694,196885,10322404,16,"given that scala actors have been changed, I would change this to not use actors at all. This is a simple example where an ExecutorService with a fixed thread pool will suffice for the purposes of the test.",93534247,2014-03-06 05:30:05
2621694,196885,10322497,4,"Also, please note that the master has moved on to use a scala build definition (project/Build.scala instead of build.sbt). I will suggest working off on the latest master.",93534247,2014-03-06 05:32:22
2621694,196885,10328013,16,or using Futures,93534247,2014-03-06 08:19:09
2621694,1495602,10349868,16,"Ok..We will make the necessary changes.


On Thu, Mar 6, 2014 at 6:49 AM, Pankaj Gupta <notifications@github.com>wrote:

> In
> src/test/scala/com/twitter/cassovary/graph/SynchronizedDynamicGraphSpec.scala:
>
> > @@ -77,22 +77,31 @@ class SynchronizedDyna",93534247,2014-03-07 00:00:22
2621694,196885,10362285,16,"I ended up doing this myself with Futures (check latest master). All is needed now I think is to change the Build.scala to cross compile. If you do not get to it in the next couple of days, I can do it.",93534247,2014-03-07 04:40:42
2621694,1495602,10374381,16,"I updated Build.scala after creating a new branch called codereview from
the upstream/master. The link to the commit is
here<https://github.com/shrikrishnaholla/cassovary/commit/f3c4366b43b34749c642e89d2ac9baaef977d7c3>
.
Should I create a new pull reques",93534247,2014-03-07 13:18:34
2621694,196885,10374469,16,"yes, a new pull request sounds good.",93534247,2014-03-07 13:25:11
2621694,1495602,10374922,16,"I have created a new pull request<https://github.com/twitter/cassovary/pull/50>
.


On Fri, Mar 7, 2014 at 11:55 AM, Pankaj Gupta <notifications@github.com>wrote:

> In
> src/test/scala/com/twitter/cassovary/graph/SynchronizedDynamicGraphSpec.scala:
>
> >",93534247,2014-03-07 14:04:33
2790305,196885,8848345,4,"Just curious if/why you encountered this exception. Also, would an assert be better than require here?",82433732,2014-01-14 08:41:31
2790305,469621,8848507,4,"My input (sharded adjacency lists) for AdjacencyListGraphReader were broken---edges for a single node were split among multiple shards.  Some of the worker threads choked, but the exceptions were silently dropped so I was (unknowingly) working with graphs",82433732,2014-01-14 08:51:49
2790305,196885,8851675,4,"Cool.

I would still replace that by assert(). require() seems more suited for checking the method arguments, and anyway at this time everything is being checked at runtime.",82433732,2014-01-14 13:35:59
2790305,469621,8852103,4,Ok. Changed to assert().,82433732,2014-01-14 14:20:56
3193476,196885,10394001,5,do we need to specify both scalaVersion and crossScalaVersions ?,94291753,2014-03-08 01:40:57
3193476,196885,10394147,20,not required as we are not cross-compiling for 2.9.1,94291753,2014-03-08 01:44:26
3193476,196885,10394194,22,"change to:
case x if x startsWith ""2.10"" => ""2.10""
case x => x",94291753,2014-03-08 01:45:05
3193476,196885,10394305,24,any reason to go back to 6.6.0 ? latest seems to be 6.12.1 (and above we used 6.8.1),94291753,2014-03-08 01:47:22
3193476,196885,10394333,25,ditto on the logic above of choosing cross version of dependency,94291753,2014-03-08 01:47:55
3193476,196885,10394342,30,same as above,94291753,2014-03-08 01:48:11
3193476,196885,10394450,36,hope you have tried actually building the package and it does work okay for both scala versions ?,94291753,2014-03-08 01:50:02
3193476,1495602,10394752,36,"We can remove 2.9.1.
I will make the ""case x"" change.
I tested it with both  2.9.3 and 2.10.3, and the compilation worked. Will
we use 2.9.2 version as well or is it for 2.9.3 only?


On Sat, Mar 8, 2014 at 12:20 AM, Pankaj Gupta <notifications@github.com",94291753,2014-03-08 01:56:28
3193476,1495602,10395312,36,"Ok..We need not have crossScalaVersions and util-logging's version is
changed to 6.12.1


On Sat, Mar 8, 2014 at 12:26 AM, Vinod Kumar <vinodkumarlogan@gmail.com>wrote:

> We can remove 2.9.1.
> I will make the ""case x"" change.
> I tested it with both  2.",94291753,2014-03-08 02:08:41
3193476,1495602,10395455,36,"I have made the required changes. Shall I push the commit?


On Sat, Mar 8, 2014 at 12:38 AM, Vinod Kumar <vinodkumarlogan@gmail.com>wrote:

> Ok..We need not have crossScalaVersions and util-logging's version is
> changed to 6.12.1
>
>
> On Sat, Mar 8, 2",94291753,2014-03-08 02:11:39
3193476,196885,10396055,36,"We will need ""crossScalaVersions"" otherwise how will sbt know how to build it for both scala versions?

We will not build it for scala 2.9.2 anymore, only for 2.9.3 and 2.10.3

Please update the pull request with your changes. I will merge it if all i",94291753,2014-03-08 02:26:03
3193476,1495602,10396236,36,"Yes, I will update the same.


On Sat, Mar 8, 2014 at 12:56 AM, Pankaj Gupta <notifications@github.com>wrote:

> In project/Build.scala:
>
> > -      ""org.scala-tools.testing"" % ""specs_2.9.1"" % ""1.6.9"" % ""test""
> > +      ""com.twitter"" %% ""ostrich"" % ""9.1",94291753,2014-03-08 02:31:12
3221149,196885,11075511,12,shouldn't need any of these cassovary-benchmarks/ subdirs,99658259,2014-03-28 23:12:19
3221149,196885,11075562,3,please arrange imports alphabetically,99658259,2014-03-28 23:13:38
3221149,196885,11075739,12,I see now that you need to still have cassovary-benchmarks/cache,99658259,2014-03-28 23:17:16
3221149,196885,11076973,33,"this is cool, but I think this would be great to restructure. Some thoughts:
1. Allow running only one benchmark rather than all of them. Think of this as being used again and again (for example if someone is optimizing code) rather than only once.
2. L",99658259,2014-03-28 23:44:22
3221149,196885,11077026,51,reporting on the time to load the graph would be great too,99658259,2014-03-28 23:45:24
3221149,196885,11077754,62,"to highlight again the need for separate benchmarks: the benchmark for global pagerank would probably be run multiple times and an average taken. On the other hand, the benchmark for personalized pagerank would probably run the random walk starting from m",99658259,2014-03-29 00:00:27
3221149,196885,11077759,21,"I recommend keeping only two examples in src/main/resources (say one directed graph: ""wiki-vote"" and one undirected graph say ""ego-facebook"") and in comments at top of this file provide clearly the URL where this graph has been downloaded from.",99658259,2014-03-29 00:00:30
3221149,196885,11399163,15,don't think you need any of these new dirs. Consider putting only those you really need,100283466,2014-04-08 21:48:43
3221149,196885,11399221,26,"perhaps explicitly specify the return type of operation to be ""Unit"" ?",100283466,2014-04-08 21:49:53
3221149,2326839,11399623,26,Done.,100283466,2014-04-08 21:57:22
3221149,196885,11399826,28,"consider giving a default implementation of this:
val name = this.getClass.getName",100283466,2014-04-08 22:01:05
3221149,2326839,11399953,28,Done.,100283466,2014-04-08 22:03:39
3221149,2326839,11400047,28,Maybe getSimpleName is enough?,100283466,2014-04-08 22:05:45
3221149,196885,11402003,19,need this?,100283466,2014-04-08 22:44:37
3221149,196885,11402296,28,"yes, that would have been better, but seems like there are a few bugs related to getSimpleName. e.g., see https://issues.scala-lang.org/browse/SI-8110",100283466,2014-04-08 22:50:18
3221149,196885,11402330,40,please break these separate classes into separate files,100283466,2014-04-08 22:50:58
3221149,196885,11402433,44,"keyword ""override"" not needed for implementation of an abstract method",100283466,2014-04-08 22:52:48
3221149,196885,11402473,40,"remove extraneous type annotation "": PageRankParams""",100283466,2014-04-08 22:53:22
3221149,196885,11402489,50,ditto on extraneous type annotation that clutters the line,100283466,2014-04-08 22:53:43
3221149,196885,11402668,59,I am  not sure of the reason for this. Perhaps just take the entire range 1..maxNodeId and pick random node ids from this range?,100283466,2014-04-08 22:56:35
3221149,196885,11402679,23,s/upacks/unpacks,100283466,2014-04-08 22:56:57
3221149,2326839,11403102,15,"so cassovary-benchmarks/cache is the only one I think, isn't it?",100283466,2014-04-08 23:04:59
3221149,2326839,11403184,59,"Is it ok, if I read graph (1---> 1000) from file and use default nodeRenumberer?",100283466,2014-04-08 23:06:24
3221149,2326839,11403564,40,I'm afraid its needed here. Are you sure it can be somehow omitted?,100283466,2014-04-08 23:14:01
3221149,2326839,11403709,19,"Yes, I'm using Stopwatch in run method.",100283466,2014-04-08 23:17:03
3221149,196885,11404505,15,"looks like it, yes",100283466,2014-04-08 23:32:18
3221149,196885,11404529,40,"aha, I see. ok",100283466,2014-04-08 23:32:36
3221149,196885,11405100,59,"Not sure if reading from a file makes sense. Actually DirectedGraph provides an iterator on Nodes. So, perhaps just taking the next node provided by this iterator will be fine (be careful to check hasNext) for this example instead of a random choice.",100283466,2014-04-08 23:44:14
3221149,2326839,11405185,59,"Yes. What I meant is do we have a guarantee that all ids from 1 to
MaxNodeId are used?


On 8 April 2014 20:44, Pankaj Gupta <notifications@github.com> wrote:

> In
> cassovary-benchmarks/src/main/scala/com/twitter/cassovary/GraphOperationBenchmark.scala:",100283466,2014-04-08 23:45:55
3233018,196885,10527631,31,perhaps this should be provided as well?,95630977,2014-03-12 22:55:20
3233018,196885,10527688,6,should be `./sbt`,95630977,2014-03-12 22:56:19
3233018,2326839,10527805,31,"Tried this, but I get java.lang.NoClassDefFoundError: it/unimi/dsi/fastutil/ints/Int2IntMap. Any ideas?",95630977,2014-03-12 22:58:20
3233018,2326839,10527951,6,Done.,95630977,2014-03-12 23:00:55
3242747,196885,10593206,5,please organize imports in alphabetical order,95914248,2014-03-14 06:45:06
3242747,196885,10593628,19,"instead of these two traits and a val shardReaderCompanion, why not use a 'def oneShardReader(....) : Iterator[NodeIdEdgesMaxId]""  that is then implemented in the implementing classes?",95914248,2014-03-14 07:03:27
3242747,196885,10593710,19,"also, since you have a ""class ShardsReader"" defined here, can't 'def iteratorSeq' be implemented in the trait GraphReader itself?

i.e., overall seems like only OneShardReader implementation needs to be provided by the implementors of the those classes ",95914248,2014-03-14 07:07:15
3242747,196885,10912510,44,I think no 'override' is needed,96511946,2014-03-25 05:59:17
3242747,2326839,10924005,15,I need to add this to override abstract methods from GraphReaderFromDirectory trait.,98838554,2014-03-25 16:29:55
3242747,196885,11003327,13,"please change the comment ""only required to"" with the addition of nodeRenumberer as an abstract member",98838554,2014-03-27 04:44:09
3242747,196885,11003371,25,"s/Override to define node renumberer/Define node renumberer (i.e., no need to 'override' since no default value is specified)",98838554,2014-03-27 04:45:00
3242747,196885,11003427,69,Is the keyword 'override' needed?,98838554,2014-03-27 04:46:53
3242747,196885,11003484,70,"so I think there is no need to define the class ShardsReader above and then instantiating it here. Instead, consider just implementing the readers function right here.

i.e., 
def iteratorSeq: Seq[() => Iterator[NodeIdEdgesMaxId]] = {
val validFiles =",98838554,2014-03-27 04:48:28
3242747,196885,11003631,53,Don't need the keyword 'override',98838554,2014-03-27 04:52:56
3242747,196885,11003712,96,"this method is not needed, please remove",98838554,2014-03-27 04:55:17
3242747,196885,11003721,89,keyword 'override' not needed.,98838554,2014-03-27 04:55:32
3242747,196885,11003784,48,consider making this a private class (also above in AdjacencyListGraphReader),98838554,2014-03-27 04:56:54
3242747,196885,11004202,39,of course another option is to first do a one-time conversion from the list of edges to AdjacencyList format. I will add this as an issue under enhancement.,98838554,2014-03-27 05:08:10
3242747,196885,11004338,39,Infact I forgot that a writer already exists com.twitter.cassovary.util.io.GraphWriter so a converter is simply this reader + GraphWriter.,98838554,2014-03-27 05:11:46
3242747,196885,11004485,58,why not use an ArrayBuffer since the listbuffer is converted to an array later anyway?,98838554,2014-03-27 05:16:31
3242747,196885,11004655,84,"Likely it won't make a difference in speed at all, but technically you can keep the max around when reading the edges rather than calling max again.",98838554,2014-03-27 05:20:42
3242747,196885,11004807,36,the contains() is going to be expensive on a List. Consider sorting neighbors as well as nodesInMap and then checking for equality of the two sorted lists.,98838554,2014-03-27 05:24:13
3242747,196885,11004892,43,just checking for equality of the size of nodeMap.keys with g.nodeCount will suffice given you have already checked that every node in g belongs to nodeMap.,98838554,2014-03-27 05:26:35
3242747,196885,11004957,20,"any reason to make this a 'package object' containing the trait GraphMapEquality, vs only defining the trait GraphMapEquality in GraphMapEquality.scala and using the trait when needed?",98838554,2014-03-27 05:28:46
3242747,2326839,11035717,53,Done,98838554,2014-03-27 23:58:53
3242747,2326839,11035797,13,Done.,98838554,2014-03-28 00:00:41
3242747,2326839,11035825,25,Done,98838554,2014-03-28 00:01:17
3242747,2326839,11035858,69,Done.,98838554,2014-03-28 00:01:56
3242747,2326839,11036569,70,Done.,98838554,2014-03-28 00:16:00
3242747,2326839,11036674,39,"Yes, but if we want just to convert graphs, it may not be the most memory efficient option (as we read all the edges to a map).",98838554,2014-03-28 00:17:58
3242747,2326839,11036737,96,Done.,98838554,2014-03-28 00:19:13
3242747,2326839,11036786,48,Done.,98838554,2014-03-28 00:19:50
3242747,2326839,11036861,58,Done.,98838554,2014-03-28 00:21:14
3242747,2326839,11037526,84,Done.,98838554,2014-03-28 00:33:47
3242747,2326839,11037532,89,Done.,98838554,2014-03-28 00:33:52
3242747,2326839,11037891,20,"Before it was in AdjacencyListGraphReadertTest, now it is shared only by the 2 readers tests in that package. I find it rather local and didn't want a special file for this. And, by the way, I couldn't find a fitting place for this.

If you like, I can ",98838554,2014-03-28 00:39:50
3242747,2326839,11038418,36,Done.,98838554,2014-03-28 00:47:50
3242747,2326839,11038425,43,Done.,98838554,2014-03-28 00:47:55
3242747,196885,11049649,20,test/.../util/io/GraphMapEquality.scala seems like the best place to me.,98838554,2014-03-28 05:17:14
3411864,196885,11882674,7,"this is quite memory inefficient, having to store O(N^2) size array. I just checked in a method to generate undirected graph to master. please check it out.",100078546,2014-04-23 05:27:14
3411864,196885,12172569,34,let's follow the convention of putting a space before {,104450384,2014-05-01 04:58:54
3411864,196885,12172934,38,perhaps add a comment that we are doing this to save on memory usage as that is the whole point of the randomized algorithm.,104450384,2014-05-01 05:12:13
3411864,196885,12173240,46,use table.slice?,104450384,2014-05-01 05:23:57
3411864,196885,12173412,65,"since you are doing .toSet, any benefit in doing filter first?",104450384,2014-05-01 05:30:54
3411864,196885,12173459,73,why a var and not val ?,104450384,2014-05-01 05:33:05
3411864,196885,12173460,79,why 'var' ?,104450384,2014-05-01 05:33:14
3411864,196885,12173482,85,use BitSet,104450384,2014-05-01 05:34:18
3411864,196885,12173519,90,probably good to unit test this as well,104450384,2014-05-01 05:36:08
3411864,196885,13557142,66,"This is a lot of triangles. I am not sure how long this test is taking to run, but have you tried taking a smaller graph?",119527995,2014-06-09 23:42:09
3411864,196885,13557356,82,"In order to determine a safe tolerance multiplier here, can you list results of say 100 runs on a complete and a random graph with these parameters? I just want us to have a very high degree of confidence that we are not creating unpredictable tests.",119527995,2014-06-09 23:45:19
3671834,196885,12649997,27,"I recommend using com.twitter.app.Flags (see PerformanceBenchmark.scala for example) to manage cmd line args
",110689423,2014-05-14 22:46:49
3671834,196885,12650434,40,"this is pretty small class. consider just having an unnamed instantiation directly like:
new OperationBenchmark { def operation(): Unit = …. }
and deleting the extra GraphGenerationBenchmark trait and the two separate scala files that declare case class",110689423,2014-05-14 22:53:41
3671834,196885,12650497,13,pls update comment,110689423,2014-05-14 22:54:44
3671834,196885,12651112,42,no need to check -- just directly add is okay,110689423,2014-05-14 23:04:02
3671834,196885,12651452,38,this is getting complex (as we are discussing). Should do this only if the benchmarks indicate it is worth it.,110689423,2014-05-14 23:09:40
3671834,196885,12651664,31,"sorry for me not noticing before. But this is a bit odd to return an Array[] in functions called ""…Subset"". I think we should return Set[] for all the random subset functions",110689423,2014-05-14 23:13:39
3671834,2326839,12705182,31,"Cassovary uses Arrays instead of Set in many places and Array seems to be much appropriate for Fischer-Yates shuffling. I can change it, if you still want to.",110689423,2014-05-15 23:30:13
3671834,2326839,12705243,38,It's not so complicated I think. We just chagne IntArrayList to same synchronized collection and have to use ArrayBuffer with Synchronization.,110689423,2014-05-15 23:31:23
3671834,196885,12708513,38,ok,110689423,2014-05-16 00:31:47
3671834,196885,12708628,31,"yes, arrays are used all over the place and that's not such a good thing. Ideally, we should have been more careful with our interfaces (using Vector / Set /Seq etc. as appropriate). Want to be more careful going forward.",110689423,2014-05-16 00:34:06
3671834,2326839,12733201,40,I need to have extra GraphGenerationBenchmark trait for the numNodes and probEdge variables. I will try to improve this solution other way.,110689423,2014-05-16 15:54:58
3671834,2326839,12733542,31,"Here we would have to go back from set using toArray, so I'm leaving this as is.",110689423,2014-05-16 16:12:14
3671834,2326839,12733615,40,"I did, what you suggested. However in SubsetSamplingBenchmark (just added), I override name from OperationBenchmark and thus annonymous classes get larger, so I'll have them directly defined, but in the same file.
",110689423,2014-05-16 16:15:16
3671834,2326839,12734055,40,"Or, changed my mind, but I'm not convinced about that. Have a look.",110689423,2014-05-16 16:25:56
3671834,196885,12852212,25,pls update comment,112449700,2014-05-20 21:06:48
3671834,196885,12852267,45,minor style thing: one space before '{',112449700,2014-05-20 21:07:44
3671834,196885,12852306,17,imports in alphabetical order,112449700,2014-05-20 21:08:50
3671834,196885,12852785,50,I still think a comment here explaining the logic will help in readability.,112449700,2014-05-20 21:16:59
3703165,196885,12855288,31,"should probably add tests for mapping Long, and also mapping a non-primitive type.",112209746,2014-05-20 22:02:45
3703165,196885,12855457,24,"I see a bug here as the nodeIds can be duplicates. Not your doing, but that should be fixed and then also extended with Long and (say String or some other type) node ids. That will make a better benchmark of the node renumbering logic.",112209746,2014-05-20 22:06:15
3727706,289817,12961245,4,sort imports,113076264,2014-05-22 22:04:33
3727706,289817,12961371,40,"Can you change it so that each variable is on a new line? This makes it easier to read, and diffs work better.

eg: class Foo(
  val first: String,
  val second: ..
..
) {
}",113076264,2014-05-22 22:07:12
3727706,289817,12962879,22,Is quotationMark required for string Ids? What is the need for quotation marks?,113076264,2014-05-22 22:37:26
3727706,2326839,12963167,4,Pankaj suggested alphabetic imports order.,113076264,2014-05-22 22:42:35
3727706,2326839,12963341,22,That is needed if we want node ids to have space or other special char.,113076264,2014-05-22 22:45:43
3727706,196885,12965918,22,"On Thursday, May 22, 2014, Szymon <notifications@github.com> wrote:

> In
> cassovary-core/src/main/scala/com/twitter/cassovary/util/io/ListOfEdgesGraphReader.scala:
>
> >   * Does not check for duplicate edges or nodes.
> >   *
> >   * You can opt",113076264,2014-05-22 23:27:01
3727706,289817,13094566,23,snakeCase instead of ALLCAPS,114586514,2014-05-27 23:45:04
3727706,289817,13094863,76,Check lines.hasNext() before this and throw a meaningful exception if it does not.,114586514,2014-05-27 23:50:07
3727706,196885,13506329,4,I guess that is what @agrewal also means. Next few lines are not sorted.,113076264,2014-06-07 00:27:21
3727706,196885,13506417,11,s/which/where,115986843,2014-06-07 00:29:18
3727706,196885,13506982,108,s/if/in,115986843,2014-06-07 00:42:18
3727706,196885,13507134,23,may be add an example with string ids as well?,115986843,2014-06-07 00:46:10
3727706,196885,13507179,4,sort order,115986843,2014-06-07 00:47:13
3727706,196885,13507318,133,please add a toy test with long node ids as well,115986843,2014-06-07 00:50:57
3745607,289817,13091522,71,".get is a blocking operation. From http://twitter.github.io/scala_school/finagle.html

When you use Futures in real code, you normally don’t call get; you use callback functions instead. get is just handy for REPL tinkering.

In this case, there is no",114580562,2014-05-27 22:53:26
3745607,289817,13091547,55,Explicitly add return type here. ,114580562,2014-05-27 22:53:53
3745607,289817,13091558,66,Future.Done,114580562,2014-05-27 22:54:01
3745607,289817,13091630,83,Add explicit return type,114580562,2014-05-27 22:55:09
3745607,2326839,13197560,71,"I cannot find Await.ready in the version of Twitter Util that is used by Cassovary, or it is somewhere?",114580562,2014-05-29 23:48:30
3745607,196885,13558822,46,missing a step 2 in the numbered list now,116388959,2014-06-10 00:12:09
3745607,196885,13560193,131,is the indentation correct on this line?,116388959,2014-06-10 00:37:39
3745607,196885,13560574,59,"just confirming. Perhaps @agrewal -- can you also confirm re the syntax of twitter futures?
1. As it stands, is the new code using multiple threads at all? 
2. Is it using the threads of executorService passed in to apply?
3. Are the multiple threads b",116388959,2014-06-10 00:45:05
3745607,289817,13758951,68,Is the implicit here needed?,124757480,2014-06-13 21:26:00
3745607,289817,13759251,65,"Instead of taking an executorService, consider just using FuturePool.unboundedPool. You can take as input just concurrency: Int. This can be used as the input to an AsyncSemaphore which will control parallelism.

The advantage here is that instead of pa",124757480,2014-06-13 21:32:04
3745607,289817,13759685,224,"IIUC, this function only puts one task in the FuturePool? multiple invocations of this function are required for concurrency. Here is a clearer approach.

1. Remove the futurePool here.
2. On line 159:
Future.join(
       nodesOutEdges.map { n =>
  ",124757480,2014-06-13 21:41:39
3745607,289817,13759717,223,explicitly mention return type,124757480,2014-06-13 21:42:28
3745607,289817,13759931,288,"implicits are a little hard to follow around in code, and can sometimes lead to bugs. In this case, you are not taking a lot of advantage of implicits, might be better to make these explicit. 

Also, as I have mentioned elsewhere, in general it is bette",124757480,2014-06-13 21:46:45
3745607,196885,13772905,65,I see. And I am guessing pass the semaphore around instead?,124757480,2014-06-14 02:40:44
3745607,2326839,14178722,65,@agrewal I'm not sure if I understood correctly what you mean. Do you know of any OS code that uses this method?,124757480,2014-06-25 15:42:33
3745607,2326839,14180661,65,"Do you mean pass to `apply` of `ArrayBasedDirectedGraph` only `parallelism: Int`, have private FuturePool  - unbounded pool and AsynchSemaphore inside `apply` that will not allow to have more than `parallelism` threads and pass the futurePool with semapho",124757480,2014-06-25 16:38:26
3745607,289817,14257384,65,"@szymonm No need to pass future pool around. FuturePool.unboundedPool is a lazy val on an object. i.e. it is constructed lazily, and there is only one instance. So you can unambiguously refer to it.

This is only a suggestion, but it is easier to reason",124757480,2014-06-26 23:30:45
3745607,196885,14262575,65,"Ajeet,

1. This seems suitable for IO tasks. And it is as such written in the comments in 
https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/util/FuturePool.scala#L58

We are doing mainly IO here, so it seems fine.

2",124757480,2014-06-27 00:52:59
3745607,289817,14266148,65,"For 2, even if you know the number of cores, there is no globally optimum number for concurrency. This needs to be profiled and then tuned. The optimum parallelism can depend on the disk type, the number of files, file size, etc.

In short, benchmarking",124757480,2014-06-27 01:54:54
3745607,2326839,14284790,65,"OK @agrewal IIUC, you suggest to
1. create ArrayBasedDirectedGraph class to handle everything in a class instead of object
2. We use companion object apply method to read array based directed graph. It takes only parallelisationLimit: Int (no: ExecutorS",124757480,2014-06-27 14:08:51
3745607,289817,14310379,65,"Yes, that is correct except you don't need 3. to be lazy.
FuturePool.unboundedPool is already a lazy val. In your code, you will
always use it, so making it lazy does not buy you anything.


On Fri, Jun 27, 2014 at 2:08 AM, Szymon <notifications@gith",124757480,2014-06-28 00:20:19
3745607,196885,14311198,65,"Makes sense. Thanks.

On Jun 26, 2014, at 1:54 PM, agrewal <notifications@github.com> wrote:

> In cassovary-core/src/main/scala/com/twitter/cassovary/graph/ArrayBasedDirectedGraph.scala:
> 
> >     */
> > -  def apply(iteratorSeq: Seq[ () => Itera",124757480,2014-06-28 00:37:16
3745607,196885,14473633,10,move this up to ensure alphabetical ordering,132104703,2014-07-02 23:11:35
3745607,196885,14473778,29,"since concurrency is different from parallelism, i suggest using either one of the words ""concurrency"" or ""parallelism"" -- i think  concurrencyLevel is slightly better here but parallelismLevel is also fine, just that it will be good to not use both words",132104703,2014-07-02 23:13:43
3745607,196885,14475182,4,let's use Runtime.getRuntime.availableProcessors for default value of parallelism,132104703,2014-07-02 23:35:06
3745607,196885,14477977,33,"I think 'nodesInOnePart' will be a better name now than nodesInOneThread.

Alternatively could just rename case class to NodesMaxIdsIdsInOneTask(nodes: Seq[Node], maxId: Int, nodeWithOutEdgesMaxId: Int)",132104703,2014-07-03 00:24:11
3745607,196885,14479442,343,allNodes is only being used here. consider not making a separate allNodes buffer at all and just passing nodesOutEdges and nodesWithNoOutEdges separately to this block,132104703,2014-07-03 00:51:07
3745607,196885,14480130,137,"I wonder if there is any benefit to calculating maxNodeId using an AtomicInteger rather than the current code structure (of each part calculating its own max id and then once that is done, the max ids being brought together into global max by one thread)",132104703,2014-07-03 01:04:01
3745607,2326839,17210570,137,Current one is more functional I think. Let me check it.,132104703,2014-09-06 23:37:22
3745607,2326839,17210633,137,"I would have to implement max for AtomicInteger. Do you know any idiomatic code for this, @pankajgupta? Found something like this: http://java.dzone.com/articles/even-better-atomiclong-and What do you think?",132104703,2014-09-06 23:52:35
3745607,196885,17212743,137,that link doesn't inspire confidence. let's keep it this way then,132104703,2014-09-07 08:45:26
3745607,196885,17212755,343,i think this is the only outstanding comment here,132104703,2014-09-07 08:48:42
3745607,196885,17313551,361,prefer toSeq to toList,157170599,2014-09-09 21:56:27
3745607,196885,17314023,348,I'd just inline line#250,157170599,2014-09-09 22:04:32
3855060,196885,14145663,5,"aha, bad bug.

actually I wonder if ""I"" is useless in our setting and can easily be replaced by Int -- at least none of the current code seems to be using it.",124223831,2014-06-24 23:18:46
3855060,196885,14146870,53,"this file looks identical to IntInfoKeeper. Consider changing InfoKeeper to be parameterized only by `O'. `I' does not seem needed (is always Int in our setting), and M could be replaced by java.util.Map[Int, O] The code can be reused across IntInfoKeeper",124223831,2014-06-24 23:39:44
3855060,196885,14146990,4,delete,124223831,2014-06-24 23:41:26
3855060,196885,14147015,13,use UnsupportedOperationException here (as well as in PathsCounter),124223831,2014-06-24 23:41:58
3855060,196885,14149772,41,delete extra empty line,124223831,2014-06-25 00:28:44
3855060,196885,14149778,44,s/travers/traversal/,124223831,2014-06-25 00:28:53
3855060,196885,14150207,55,I would rename BFS to FIFO and DFS to LIFO as the queue based traverser does not have knowledge of the use cases...,124223831,2014-06-25 00:37:45
3855060,196885,14150344,107,nodes is not being used?,124223831,2014-06-25 00:40:54
3855060,196885,14150398,95,pull up 3 lines to one line,124223831,2014-06-25 00:42:10
3855060,196885,14150636,144,I suggest leaving RandomTraverser alone and not forcing into QueueBasedTraverser as it does not seem natural to me.,124223831,2014-06-25 00:46:37
3855060,196885,14151653,314,"this seems a bit too many traits to me. Can we: 
1. Define only those traits needed right now?
2. Keep BFS and DFS traversers almost exactly identical (with the exception of course of queueing priority)",124223831,2014-06-25 01:06:09
3855060,2326839,14151727,314,"Yes, this should be possible after making distance/depth definitions clear.",124223831,2014-06-25 01:07:39
3855060,2326839,14480132,53,"There is some problem with Java/Scala interoperability here. It seems that Int2IntOpenHashMap from fastutils is a java.util.Map[Integer, Integer] but not a java.util.Map[Int, Int]. Is this possible or I'm missing something?",124223831,2014-07-03 01:04:02
3855060,2326839,14482136,53,"The problem is similiar to one explained here:
http://stackoverflow.com/questions/6991340/scala-convert-listint-to-a-java-util-listjava-lang-integer

So should I use typecasting (second response)?",124223831,2014-07-03 01:40:10
3855060,196885,14482780,53,"It's possible -- java.lang.Integer wraps primitive java int

typecasting is fine

On Jul 2, 2014, at 1:40 PM, Szymon <notifications@github.com> wrote:

> In cassovary-core/src/main/scala/com/twitter/cassovary/graph/tourist/BoolInfoKeeper.scala:
> ",124223831,2014-07-03 01:50:57
3855060,2326839,14483189,53,So we should generally avoid specifing fastutils types. Instead we should use Scalas mutable.Map type and wrap fastutils maps on construction.,124223831,2014-07-03 01:56:56
3855060,2326839,14483576,53,"I mean, in every place we currently use:

    val someMap: fastutils.Int2IntMap = new OpenHashInt2IntMap()

we can use

    import scala.collection.JavaConversions._  //for util.Map -> mutable.Map
    val someMap: Map[Int, Int] = (new OpenHashInt2I",124223831,2014-07-03 02:03:55
3855060,196885,14532514,53,"to clarify, i think you mean:
val someMap: mutable.Map[Int, Int]  = (new Int2IntOpenHashMap).asInstanceOf[java.util.Map[Int, Int]]

yep, that is nice",124223831,2014-07-04 00:10:36
3855060,2326839,15277600,5,ok,124223831,2014-07-23 14:01:20
3855060,2326839,15277654,53,"Yes, we need to import JavaConversions._ for the conversion frop util.Map to scala.collection.mutable.Map.",124223831,2014-07-23 14:02:43
3855060,2326839,15277904,107,my bug,124223831,2014-07-23 14:09:42
3855060,2326839,15278397,144,your choice,124223831,2014-07-23 14:22:26
3855060,2326839,15283583,314,Do you mean identical interfaces of both traversals also? Now they are completely different.,124223831,2014-07-23 16:59:14
3855060,196885,15385529,25,"might as well make return type Map\[Int, Int\]  (i.e., scala.collection.Map) -- does not seem to me that returning a ""mutable"" Map is any useful?",141494265,2014-07-25 08:59:04
3855060,196885,15767901,5,I think don't need to import scala.collection explicitly,143903062,2014-08-04 22:25:49
3855060,196885,15768204,10,this is a bit confusing naming because it conflicts with cassovary.util -- either name it as jutil or just use java.util.... where you need it,143903062,2014-08-04 22:30:40
3855060,196885,15768336,29,"for consistency, can this code be same virtually identical to BoolInfoKeeper? (i.e., do not have a separate underlyingMap etc.), hide this type casting in FastUtilUtils (or don't hide it there as well) etc.",143903062,2014-08-04 22:33:20
3855060,2326839,15769065,29,"Could be, but this would make BoolInfoKeeper more complicated when it is not needed. I need to store underlying map from fastutils to have access to add method (that increases value given by a key) that is not available when I cast to java.util.Map.",143903062,2014-08-04 22:44:48
3855060,2326839,15769078,5,sure.,143903062,2014-08-04 22:44:59
3855060,2326839,15769124,10,ok,143903062,2014-08-04 22:45:47
3855060,196885,15771390,29,"I see. of course, can also use put and get to do the same thing. btw, add seems deprecated -- use addTo() instead",143903062,2014-08-04 23:20:24
3855060,2326839,15771532,29,"Yes, but I expect add to be two times faster than get/put combination, right?

Will change to addTo.",143903062,2014-08-04 23:22:16
3855060,196885,15771952,29,"I am not sure -- couldn't find the source code online... It is okay to leave it as it is.

On Aug 4, 2014, at 11:22 AM, Szymon <notifications@github.com> wrote:

> In cassovary-core/src/main/scala/com/twitter/cassovary/graph/tourist/IntInfoKeeper.scal",143903062,2014-08-04 23:28:46
3855060,2326839,15772425,29,http://grepcode.com/file/repo1.maven.org/maven2/it.unimi.dsi/fastutil/6.4.4/it/unimi/dsi/fastutil/ints/Int2IntOpenHashMap.java?av=f,143903062,2014-08-04 23:36:10
3855060,196885,15772776,7,alphabetical order,143903062,2014-08-04 23:41:21
3855060,196885,15773562,15,"perhaps make this collection.Map[Int, Int] ? so that it is of immutable type when returned for a given node? (we have access to underlying as a mutable map anyway)",143903062,2014-08-04 23:53:41
3855060,196885,15774022,21,"not a big deal, but would be nice to make it immutable -- i.e., InfoKeeper[collection.Map[DirectedPath, Int]]",143903062,2014-08-05 00:01:31
3855060,196885,15774132,9,alphabetical order,143903062,2014-08-05 00:03:05
3855060,196885,15774266,48,"any reason why also returning the Seq[Int, Int] might be useful?",143903062,2014-08-05 00:05:23
3855060,196885,15774800,35,"this seems inelegant, why not just change BoundedIterator to have maxSteps be Option[Long] and hasNext to use when guarded by maxSteps.isDefined",143903062,2014-08-05 00:15:09
3855060,196885,15775906,217,"this is identical trait to MaxDepthLimit (just the names if variables are changed). You probably just want a single stateless trait with a single method def isLimitReached(value: Int, limit: Option[Int])",143903062,2014-08-05 00:36:29
3855060,196885,15775950,234,"this is not clear to me. why two such trackers? also, please add some comments",143903062,2014-08-05 00:37:19
3855060,2326839,15776005,217,"That's true. But in this case I cannot mixin both of them at the same time, don't I?",143903062,2014-08-05 00:38:15
3855060,196885,15776234,217,"If it is stateless, you only need to mixin once and use the method I suggested for both types of limits 
On Aug 4, 2014, at 12:38 PM, Szymon <notifications@github.com> wrote:

> In cassovary-core/src/main/scala/com/twitter/cassovary/graph/Traverser.sca",143903062,2014-08-05 00:43:02
3855060,2326839,15776249,234,"1. I don't want to hold on the waiting nodes queue also the previous node on the path, because we don't need in most cases. Thus, I only know the parent node when adding a node to the queue (not when visiting the node).

Now think of DFS.  When I add a ",143903062,2014-08-05 00:43:23
3855060,196885,15776261,304,is it still needed to extend NodesSeenBefore? (we are extending DepthTracker which also extends NodesSeenBefore),143903062,2014-08-05 00:43:35
3855060,2326839,15776401,217,"Then I have this method implemented in both BFS and DFS, but will do this, if you thinks its more elegant.",143903062,2014-08-05 00:46:02
3855060,196885,15776590,234,"sorry, still don't understand. so it is to keep track of last parent node that adds the node to the queue? how can multiple parent nodes add the same node to the queue in our onlyOnce scenario ?",143903062,2014-08-05 00:49:41
3855060,2326839,15776747,234,"For graph:
1 -> 2, 3
2 -> 3

DFS is: 1 2 3
Node's 3 parent is 2, but 1 adds it to the queue first. ",143903062,2014-08-05 00:52:20
3855060,2326839,15776787,234,onlyOnce has to be checked on visiting not adding. ,143903062,2014-08-05 00:53:04
3855060,196885,15777466,217,not if you hide the method in the trait and extend it,143903062,2014-08-05 01:05:45
3855060,196885,15793696,35,why is this an exception? the idea of recordInfo(id) is to record some info for a given node id. Here we are recording the neighbor info of id. i think this should call recordPreviousNeighbor(),143903062,2014-08-05 08:22:24
3855060,196885,15793783,85,should be able to use infoPerNode,143903062,2014-08-05 08:28:11
3855060,196885,15793789,97,is this change needed?,143903062,2014-08-05 08:28:42
3855060,196885,15793829,5,alpha order,143903062,2014-08-05 08:31:41
3855060,196885,15794394,14,same as other file. do you really need to replace infoPerNode with underlyingMap everywhere in this file?,143903062,2014-08-05 09:06:54
3855060,196885,15794403,14,"oh sorry, you need .add here I guess....",143903062,2014-08-05 09:07:21
3855060,196885,15794466,58,delete comment -- old,143903062,2014-08-05 09:12:17
3855060,196885,15794481,76,"what do you mean by ""before `next`...""",143903062,2014-08-05 09:13:18
3855060,196885,15794494,91,s/equeuing/enqueueing,143903062,2014-08-05 09:14:31
3855060,196885,15794496,94,necessary,143903062,2014-08-05 09:14:43
3855060,196885,15794757,112,"nobody else uses it afaict. just kill it and directly use enqueue(nodes, None) ?",143903062,2014-08-05 09:28:45
3855060,196885,15794997,354,neighborIds() returns Seq[] -- so no need to take iterator and then convert to Seq again,143903062,2014-08-05 09:45:46
3855060,196885,15795029,427,this is absent in BFS btw,143903062,2014-08-05 09:47:56
3855060,196885,15795422,469,i don't think this is needed. simply dequeue from queue,143903062,2014-08-05 10:14:41
3855060,196885,15795450,455,don't enqueue a node for which visitedTracker.infoOfNode is not empty -- it means it has been processed already,143903062,2014-08-05 10:15:20
3855060,196885,15795646,420,"traditionally DFS calls this ""color"" of a node, might as well name that",143903062,2014-08-05 10:31:42
3855060,196885,15795702,423,"add a comment here explaining the states of the nodes in the queue. i.e., when they have not been touched color does not exist for the node and, when they are first enqueued, it should be ENQUEUED and when they have been visited, VISITED",143903062,2014-08-05 10:34:07
3855060,196885,15795711,478,only ENQUEUED nodes must be on the queue,143903062,2014-08-05 10:34:49
3855060,196885,15795923,423,"also add a comment that we are using a BoolInfoKeeper to be efficient, otherwise there are 3 colors to track (nothing, enqueued, visited)",143903062,2014-08-05 10:49:08
3855060,196885,15796024,326,this seems like a useful stat to keep in QueueBasedTraverser itself,143903062,2014-08-05 10:54:02
3855060,196885,15796083,314,this seems to be used only in DFS. I suggest killing this trait and incorporating logic inside DFS,124223831,2014-08-05 10:58:37
3855060,2326839,15796096,354,"Using iterator here will prevent from checking filter condition for nodes than will never be taken by the take condition, I think.

See:
Seq(1, 2, 3, 4).filter(x => {println(x); % 2 == 0}).take(1)
Seq(1,2,3,4).iterator.filter(x => {println(x);  x % 2 ",143903062,2014-08-05 10:59:12
3855060,196885,15796103,234,this seems to be used only in DFS. I suggest killing this trait and incorporating logic inside DFS. I am finding it really confusing...,143903062,2014-08-05 10:59:33
3855060,196885,15796131,267,what do you think of calling depth as enqueueTime to make it clearer and keep track of this in QueueBasedTraverser itself ?,143903062,2014-08-05 11:01:36
3855060,196885,15796654,354,"Good thinking. .view and .force exist for this reason btw and will be more readable...
so in terms of your example:
> Seq(1,2,3,4).view.filter(x => {println(x); x % 2 == 0}).take(1)).force
> 

On Aug 4, 2014, at 10:59 PM, Szymon <notifications@github",143903062,2014-08-05 11:25:52
3855060,2326839,16132745,21,"Java example: RandomWalkJava gets ugly. Actually, using scala collections from Java isn't that easy. See RandomWalkJava.",143903062,2014-08-12 23:33:54
3855060,2326839,16132883,35,"then BoundedIterator with None is actually NotBoundedIterator, but I can't find any better solution.",143903062,2014-08-12 23:36:01
3855060,2326839,16137566,21,"This will not work.
The problem is there are no JavaConversions from jutil.Map[Int, jutil.Map[*, *]] to scala.Map[Int, scala.Map[*, *]]. They just don't work recursively. To do it, we would have to write a new scala.collection.JMapWrapperLike that would ",143903062,2014-08-13 00:46:04
3855060,2326839,16207576,267,equeueTime is not very good for DFS. Maybe enqueueDepth?,143903062,2014-08-14 02:29:45
3855060,2326839,16207769,326,ok,143903062,2014-08-14 02:32:53
3855060,196885,16261534,267,"The use of ""time"" notation seems to be common when talking about DFS/BFS...",143903062,2014-08-15 00:45:28
3855060,196885,17030565,43,sp. of paths,151489861,2014-09-03 08:54:36
3855060,196885,17030664,95,update documentation,151489861,2014-09-03 08:58:59
3855060,196885,17031003,99,"not sure how this is useful to pass in here -- since the seq of nodes visited is being returned, the caller can do this function outside",151489861,2014-09-03 09:17:01
3855060,196885,17031157,102,avoid creating this mutable ArrayBuffer by using map instead of foreach,151489861,2014-09-03 09:25:14
3855060,196885,17031218,59,this naming could be a bit confusing to the reader. Some documentation will be great on what allPathsWalk is and how it differs from bfs below,151489861,2014-09-03 09:29:29
3855060,196885,17031308,7,alpha order,151489861,2014-09-03 09:35:29
3855060,196885,17031385,34,why not s/Iterator.empty.hasNext/false ?,151489861,2014-09-03 09:39:54
3855060,196885,17072012,77,"perhaps remove "": Unit = "" everywhere ?",151489861,2014-09-03 23:58:27
3855060,196885,17072859,234,"as before, please add some comments explaining the use of two trackers",143903062,2014-09-04 00:12:27
3855060,196885,17073476,261,DepthTracker trait functionality seems to me to be a subset of PathLengthTracker where depthTracker equals nextvisitDistanceTracker ?. Can we just delete it and use PathLengthTracker instead? ,151489861,2014-09-04 00:23:36
3855060,196885,17073533,294,"pls complete the comment after ""walk ...""",151489861,2014-09-04 00:24:40
3855060,196885,17073743,298,why are some 'val' while others are not?,151489861,2014-09-04 00:28:31
3855060,196885,17074355,428,explain difference from BFS,151489861,2014-09-04 00:39:06
3855060,196885,17074598,440,how about the following renames: merge FIFOWalk with BreadthFirstTraverser and AllPathsWalk extends BreadthFirstTraverser and just overrides onlyOnce?,151489861,2014-09-04 00:43:00
3855060,196885,17074685,482,s/is marked/is implicitly marked/,151489861,2014-09-04 00:44:32
3855060,196885,17075153,544,"this is nice and clean now, good!",151489861,2014-09-04 00:52:07
3855060,196885,17075488,571,needed to override it this way? queue.isEmpty captures it?,151489861,2014-09-04 00:57:18
3855060,196885,17075581,507,"shouldn't we also not enqueue all the neighbors if the sum total of neighbors will exceed maxSteps ? (i.e., just like we have this code in BFS)",151489861,2014-09-04 00:58:49
3855060,196885,17075669,558,there is duplication of code with QueueBasedTraverser.next() -- only findNextToVisit() is new here. Perhaps make 'protected def findNextToVisit() = { getExisting.... }' in QueueBasedTraverser and override it here?,151489861,2014-09-04 01:00:29
3855060,196885,17075809,574,extra newline,151489861,2014-09-04 01:02:50
3855060,196885,17076797,572,"ok, with your refactoring some things are getting clearer!
IIUC the ONLY differences between BFS, AllPaths and DFS besides queue priority is 
(1) Choosing whether to enq a neighbor: BFS: don't if it has ever been ENQD or VISITED, AllPaths: always enq, D",151489861,2014-09-04 01:18:57
3855060,2326839,17209952,99,Right.,151489861,2014-09-06 21:54:06
3855060,2326839,17210120,298,Need vals when I override abstract superclass methods.,151489861,2014-09-06 22:28:47
3855060,2326839,17210141,571,"When all nodes in the queue have already been visited, we return false even if the queue is not empty.",151489861,2014-09-06 22:31:00
3855060,2326839,17210149,507,"that is not so simple. Think of a situation as above. I was thinking of some ways to limit the queue size, but haven't found any clear and computationally cheap solution.",151489861,2014-09-06 22:32:27
3855060,2326839,17210277,558,"It's a bit different. Here it works in two steps. First: findNextToVisit dequeues nodes that have been visited already and returns id of the first unvisited. Second: we dequeue the node and visit it.

I used processNode method to avoid code duplication ",151489861,2014-09-06 22:51:15
3855060,2326839,17210442,572,"You're right. 
In DFS we cannot cut the queue when maxSteps is set (because some can be skipped).

I'm also afraid if this is not going to make BFS harder to read.

Maybe call it ColoringBasedQueueTraverser or EnrichedQueueTraverser? To enable subcla",151489861,2014-09-06 23:15:29
3855060,2326839,17210639,572,What about all this stats logging? Do we really need them? Where should I use it?,151489861,2014-09-06 23:53:52
3855060,196885,17212792,572,"Since AllPaths is the only one that does not use coloring, and we don't yet know whether it is useful or not, I would just simplify and have only one class QueueTraverser that has coloring. AllPaths can ignore it.

Stats logging -- feel free to ignore i",151489861,2014-09-07 08:56:37
3855060,196885,22026475,29,"Doesn't look like incrementInfo is being used anywhere now, so we can go back to not needing underlyingMap and making IntInfoKeeper very similar to BooleanInfoKeeper, yes?",143903062,2014-12-18 14:16:13
3855060,196885,22026540,1,Not your change but please delete the un-needed imports,157170334,2014-12-18 14:19:06
3855060,196885,22098253,12,s/at/at most/,157170334,2014-12-19 17:28:56
3855060,196885,22098285,21,ok,143903062,2014-12-19 17:29:58
3855060,196885,22099380,44,lets use addTo -- seems like add is deprecated now in Int2IntOpenHashMap,157170334,2014-12-19 18:00:03
3855060,196885,22099582,19,s/add/addTo,157170334,2014-12-19 18:06:24
3855060,196885,22099669,36,please add a test for PrevNbrCounter as well in this file,157170334,2014-12-19 18:09:12
3855060,196885,22100300,66,"now that we have a BoolInfoKeeper, lets use that here instead",157170334,2014-12-19 18:30:15
3855060,196885,22100409,108,I would do s/override def/val/,157170334,2014-12-19 18:33:35
3855060,196885,22100599,119,consider making this a private class?,157170334,2014-12-19 18:40:18
3855060,196885,22100681,128,I would s/graph coloring/node colors/ because 'graph coloring' means something specific in graph theory,157170334,2014-12-19 18:41:59
3855060,196885,22100750,144,did you mean unenqueued ? unseen might be a better name for it btw...,157170334,2014-12-19 18:44:34
3855060,196885,22101287,158,"a small comment will be useful here. AFAIK, a node has potential 3 colors:U/E/V standing for Unenqueued/Enqueued/Visited. Only state transitions allowed are U->E, U->V, E->V. yes?

Is U->V allowed btw?
",157170334,2014-12-19 19:01:43
3855060,196885,22101362,208,"s/top/front
",157170334,2014-12-19 19:04:09
3855060,196885,22101413,208,s/adds new nodes to the queue/adds new nodes to the queue in order based on the type of traversal/,157170334,2014-12-19 19:05:44
3855060,196885,22101466,77,"remove "": Unit""",151489861,2014-12-19 19:07:20
3855060,196885,22101615,148,should probably be a class not a trait ?,157170334,2014-12-19 19:12:02
3855060,196885,22101654,307,why the '+ 1' in degree only?,157170334,2014-12-19 19:13:19
3855060,196885,22101666,311,s/homeNodesIds/homeNodeIds/,157170334,2014-12-19 19:13:38
3855060,196885,22101700,316,the first 'that' should be 'than',157170334,2014-12-19 19:14:40
3855060,196885,22103527,323,please inline this function -- unnecessary abstraction,157170334,2014-12-19 20:09:23
3855060,196885,22103743,328,this might run into problems in corner cases. I understand that 'take' takes an Int. I would suggest that if (max - numEnqueuedEver) is > Int.MaxValue then not to use take at all and just return the original nodes. ,157170334,2014-12-19 20:15:33
3855060,196885,22103845,376,delete ': Unit',157170334,2014-12-19 20:18:28
3855060,196885,22104128,379,s/n/node/ for consistency in naming as in lines below this one,157170334,2014-12-19 20:25:25
3855060,196885,22104150,382,don't use _ here but 'node' again for consistency in naming,157170334,2014-12-19 20:25:41
3855060,196885,22104426,267,what do you think about this?,143903062,2014-12-19 20:33:37
3855060,196885,22104678,468,do we need to extend QueueBasedTraverser again since DepthTracker extends it anyway?,157170334,2014-12-19 20:40:34
3855060,196885,22104754,496,remove 'override',157170334,2014-12-19 20:42:23
3855060,196885,22104813,537,any reason why this one is 'final' while the above bfs ones are not?,157170334,2014-12-19 20:43:54
3855060,196885,22105628,267,"in particular this seems to be called the 'discovery time' of nodes in BFS/DFS, e.g., see
http://homepages.ius.edu/rwisman/C455/html/notes/Chapter22/DFS.htm
http://courses.csail.mit.edu/6.006/fall10/handouts/quiz2review.pdf",143903062,2014-12-19 21:04:11
3855060,196885,22106242,606,Not sure if PathLengthTracker is interesting. What is definitely interesting for DFS is 'finish time' (see above two references) which seems to me to be a bit hard to record in this logic because currently 'v' is dequeued as soon as it is visited (see the,157170334,2014-12-19 21:19:28
3855060,2326839,22431227,29,We still use underlyingMap in the VisitsCounter. I will leave it for now.,143903062,2015-01-03 18:58:52
3855060,2326839,22431245,77,"The short notation will be deprecated in near future:
https://issues.scala-lang.org/browse/SI-7605
I suggest leaving it everywhere.",151489861,2015-01-03 19:05:41
3855060,2326839,22431261,44,"In current fastutil (6.4.4) in Build.scala there is no addTo. Let's make it in a separate PR, ok? [93]",157170334,2015-01-03 19:11:45
3855060,2326839,22431273,158,"Right, good point.",157170334,2015-01-03 19:17:02
3855060,2326839,22431286,144,"I would stay with Unenqueued. If we have Unseen, Enqueued it can confusing whether a node can be Seen and still not enqueued. In all our version we enqueue a node when we see it for the first time. Is this ok?",157170334,2015-01-03 19:21:00
3855060,2326839,22431306,148,"I'm not sure but I think trait is more general as we can mix it to other class.

The cost is small - just {} when constructing. What do you think?",157170334,2015-01-03 19:27:57
3855060,2326839,22431343,537,We need final only for @tailrec method findNextToVisit. Changed it.,157170334,2015-01-03 19:41:52
3855060,2326839,22432129,606,So let's leave PathLengthTracker and FinishingTimeTracker as optional when mixed in. Details coming soon.,157170334,2015-01-03 22:25:16
3855060,2326839,22432639,267,"IIUC, depth and enqueue time are not the same.
For tree like:
  1
 /  \
2   3
    / 
   4
depth(4) = 2
enqueueTime(3) // so many nodes enqueued before ",143903062,2015-01-04 00:05:02
3855060,2326839,22434853,119,"For some reason this is not possible.
What about:
```
object Walk {
  trait Limit {...}
  object NodeColor {...}
  trait NodeColoring {...}
  case class Limits {...}
}
```
?",157170334,2015-01-04 04:25:23
3855060,2326839,22434959,307,The API before was so that degreeLimit was exclusive and depth inclusive. Changed the API. Now both are inclusive as limit word suggests (as for me at least),157170334,2015-01-04 04:43:16
3855060,196885,22437142,77,"got it, np.",151489861,2015-01-04 13:46:00
3855060,196885,22437146,44,"ok, makes sense.",157170334,2015-01-04 13:46:23
3855060,196885,22437150,267,"so, lets call it discoveryTime then as per the references?",143903062,2015-01-04 13:48:53
3855060,196885,22437281,667,"this doesn't work I think. e.g., in the simple graph 1->2, handleVisitedInQueue is never called (nodes 1 and 2 are not visited again) so no finish times are ever recorded. 

Note that '1' is finished after '2' has been visited. Hence my previous comment",202128919,2015-01-04 14:19:29
3855060,196885,22437310,675,"oh I missed that you are enqueuing again. ok but please still make calculation of finishingtime a part of the main DFS class instead of a separate trait. 

rather than wastefully deq+enq, can we just not do any operation at all for DFS while still deqin",202128919,2015-01-04 14:30:10
3855060,2326839,22437932,667,"I like the solution with separate trait very much. The caller code looks clear:
```
val trav = new DepthFirstTraverser(TestGraphs.g5, GraphDir.OutDir, Seq(10)) with FinishingTimeTracker
```
You don't need to keep the map with finishing time if you don",202128919,2015-01-04 16:43:44
3855060,2326839,22437979,675,"That may be a little wastefull, but:
1) We cannot deque in the findNextToDeque, because we need to have hasNext that does not dequeu. So we deque in the QueueBasedTraverser:next.
2) We can override QueueBasedTraverser:next in DepthFirstSearch or Finishi",202128919,2015-01-04 16:50:27
3855060,2326839,22438001,267,"But that is still not time, but depth, maybe discoveryDepth?",143903062,2015-01-04 16:54:36
3855060,196885,22450665,267,'time' is fine. using conventional notation makes it clearer to a reader.,143903062,2015-01-05 15:31:34
3855060,196885,22450722,634,shouldn't this (as well as FinishingTimeTracker) extend QueueBasedTraverser so that it can be used in BFS as well?,202380770,2015-01-05 15:34:06
3855060,196885,22450741,160,looks good. please also add test with these traits in BFS.,202380770,2015-01-05 15:34:55
3855060,196885,22952058,403,"May be a small point but should all trackers be of type mixin traits? i.e., trait DepthTracker { this: QueueBasedTraverser => ... } rather than extending QueueBasedTraverser.
http://baddotrobot.com/blog/2014/09/22/scala-mixins/",204768862,2015-01-15 00:13:41
3855060,196885,22952250,670,in all trackers we seem to be doing something before enqueue(). Consider having an abstract preEnqueueHook() in QueueBasedTraverser which is implemented by the tracker traits.,204768862,2015-01-15 00:16:34
3855060,196885,22952163,642,"s/DiscoveryAndDepthTime/DiscoveryAndFinishTime/

again a self type trait might be better",204768862,2015-01-15 00:15:18
3855060,2326839,22956688,403,"I'm not quite sure. I'm using here stackable trait pattern (http://www.artima.com/scalazine/articles/stackable_trait_pattern.html, http://blog.ryannedolan.info/2014/03/scala-pattern-stackable-traits.html). On both this sites people use extending. Type con",204768862,2015-01-15 01:15:48
3855060,2326839,22956810,642,the same as before I think,204768862,2015-01-15 01:17:23
3855060,2326839,22959759,670,"The preEnqueueHook should then be able to change the nodes to enqueue, it should have the from node information (for depth for example). We obtain:
```
preEnqueueHook(nodes: Seq[Int], from: Option[Int]): (Seq[Int], Option[Int]) = {...}
```
Enqueu is c",204768862,2015-01-15 01:53:57
3855060,196885,22966149,403,"ok, this is fine. ",204768862,2015-01-15 03:12:02
3855060,196885,22966400,670,I think the current thing is okay.,204768862,2015-01-15 03:15:14
3855060,196885,22641707,663,no need to check because discoveryTime has onlyOnce set to true,203387366,2015-01-08 16:21:36
3855060,196885,22641778,693,no need to check,203387366,2015-01-08 16:23:06
3855060,2326839,22642247,663,do need to check whether to increase time. I thought it's more clear to check it before recording.,203387366,2015-01-08 16:31:13
3855060,2326839,22642254,693,"as before.

We can also set onlyOnce to false.",203387366,2015-01-08 16:31:29
3878388,196885,13738403,1,"lets not add this to cassovary-core, but to cassovary-examples",125249500,2014-06-13 09:51:35
3878388,196885,13738407,49,s/divisable/divisible/g,125249500,2014-06-13 09:52:27
3974799,196885,14263752,7,these changes are part of #76 -- perhaps we can close and merge that first,129838301,2014-06-27 01:16:05
3974799,196885,15824176,24,any reason to take out .trim ?,145287625,2014-08-05 21:34:12
3974799,196885,15824249,6,"A little bit more description would be nice. e.g., what tools are there and how to get started with them",145287625,2014-08-05 21:35:27
3974799,196885,15824364,24,correct sp. is disambiguation,145287625,2014-08-05 21:36:55
3974799,196885,15824575,27,add carriage return at eof,145287625,2014-08-05 21:39:28
3974799,196885,15824624,24,don't need override to define abstract methods in trait,145287625,2014-08-05 21:40:24
3974799,196885,15827122,29,"don't know how big the strings are, but can think of putting these not in an memory map but in an embedded DB like Mapdb or in an sstable",145287625,2014-08-05 22:20:12
3974799,196885,15827914,46,"try being more functional style.
so 
val otherNames: Map[String, String] = Source....map { line => main -> other } . toMap
val mainName = otherNames flatMap { case (main, other) => other map { (_, main) } }",145287625,2014-08-05 22:32:09
3974799,2326839,15831607,24,Just omitted this.,145287625,2014-08-05 23:25:55
3974799,2326839,15837211,29,Actually I was thinking of a trie to store name -> mainNameId that should be enough for now.,145287625,2014-08-06 00:54:28
3974799,196885,15887398,10,s/tree/three/,145745454,2014-08-06 22:02:13
3974799,196885,15888061,27,"use map to make this method more functional
e.g.
val out = outputFilename map { new FileOutputStream(_) }",145745454,2014-08-06 22:12:50
3974799,196885,15888727,108,needed?,145745454,2014-08-06 22:22:29
3974799,196885,15888924,20,"is the inconsistency between the two variables deliberate? 
inputFileName -- does not have a ""val"" prefix and capitalizes Name
",145745454,2014-08-06 22:25:30
3974799,196885,15888968,24,remove keyword override wherever not needed to be specified,145745454,2014-08-06 22:26:03
3974799,196885,15888997,24,avoid explicitly specifying return type when it is obvious,145745454,2014-08-06 22:26:34
3974799,196885,15889100,25,"can remove "": Unit"" ",145745454,2014-08-06 22:27:56
3974799,196885,15889257,23,alpha order,145745454,2014-08-06 22:30:27
3974799,196885,15889704,80,shouldn't need .toSeq,145745454,2014-08-06 22:37:50
3974799,196885,15889765,97,spelling of Results,145745454,2014-08-06 22:38:46
3974799,196885,15891969,99,what does the map (x => ()) do? is it needed?,145745454,2014-08-06 23:11:43
3974799,196885,15961326,51,add newline,145745454,2014-08-08 01:22:42
3974799,196885,15962317,20,what is this regex \\p{Z} -- I can't find it on the net,145745454,2014-08-08 01:37:52
3974799,196885,15962418,23,so no normalization needed?,145745454,2014-08-08 01:39:18
3974799,196885,15963527,32,"do you want to expose the mutable Map, or just the collection.Map ?",145745454,2014-08-08 01:56:27
3974799,196885,15963599,37,what if there are many alternatives for the same name? here the last one will overwrite the previous ones,145745454,2014-08-08 01:57:45
3974799,196885,15963737,82,"mutable maps are not threadsafe. IIUC, this is dangerous",145745454,2014-08-08 02:00:13
3974799,2326839,16011095,20,"val is needed to override method in the Output trait.
Corrected name inconsistency.",145745454,2014-08-09 00:15:03
3974799,2326839,16012750,99,"Changes Future[R] into Future[Unit], so I can recover it with ().
Any better way to log error and ignore failed futures?",145745454,2014-08-09 00:49:18
3974799,2326839,16013089,20,"That's a bit weird. It is here: http://www.regular-expressions.info/unicode.html and works in java.
Should be a separator/line terminator. Any clues how to do this better?",145745454,2014-08-09 00:56:58
3974799,2326839,16013122,23,Works as is. Normalization merges some pages... thus making some problems.,145745454,2014-08-09 00:57:55
3974799,2326839,16013157,32,"Right, collection.Map is much better.",145745454,2014-08-09 00:58:40
3974799,2326839,16013183,37,"Should be
```
   mainName += ((alternative, main))
```",145745454,2014-08-09 00:59:13
3974799,2326839,16016506,82,"Don't know what I was thinking of while writing this.

Changed it to use only immutable.Map - will commit with some tests.",145745454,2014-08-09 02:06:20
3974799,196885,16021144,82,np,145745454,2014-08-09 04:05:01
3974799,196885,16021209,20,"no, this makes sense.",145745454,2014-08-09 04:07:27
3974799,196885,16022490,99,"partialResults map { _ onComplete { case Success(a) => a; case Failure(t) => log.warning(t.getMessage) } }
or
partialResults map { _ recover { case t => log.warning(t.getMessage) } }",145745454,2014-08-09 05:03:16
3974799,2326839,16025861,99,"I'm not sure how does the first solution work when I'm using Await.ready after. Is gonna wait for the future + printing the log?

IIUC, in the second solution recover should return R - log.warning return Unit?

I used onFailure in the spirit of first ",145745454,2014-08-09 18:09:05
3974799,289817,16266519,16,"I really like the overall approach. nice job!

Can you elaborate on how you determine the ""main"" one? Eg: do you do a substring match between the redirection and the wiki title?",148465668,2014-08-15 04:06:43
3974799,289817,16266534,27,Can you put in documentation on the format of the input and output file?,148465668,2014-08-15 04:07:04
3974799,289817,16266643,42,"Can you have more desriptive argument names? eg: ""file"" instead of ""f""",148465668,2014-08-15 04:08:45
3974799,289817,16266727,70,Can you explain what this does? Is this a separate future pool?,148465668,2014-08-15 04:10:10
3974799,289817,16266744,100,remove dead code,148465668,2014-08-15 04:10:25
3974799,289817,16266815,18,"Can you clarify what you mean by ""obfuscated"" page titles?",148465668,2014-08-15 04:11:41
3974799,289817,16266843,33,Can you put in a pointer to the web documentation for these prefixes?,148465668,2014-08-15 04:12:11
3974799,289817,16266939,60,"Can you add documentation on which of a, b and c are the ""title"" and which are ""redirects"".",148465668,2014-08-15 04:14:01
3974799,2326839,16328912,16,"All redirects pages point to the same main one. This is done in the first line of the pages text and looks like:
```
<page>
    <title>AsWeMayThink</title>
    <id>30</id>
    (...)
    <text xml:space=""preserve"">#REDIRECT [[As_We_May_Think]] {{R fr",148465668,2014-08-17 16:34:52
3974799,2326839,16328933,70,"Future[T] is a type which denotes future objects, whereas future is a method which creates and schedules an asynchronous computation, and then returns a future object which will be completed with the result of that computation.

Uses standard executor f",148465668,2014-08-17 16:39:16
3974799,2326839,16328952,33,"The only information I found about that is: http://meta.wikimedia.org/wiki/Data_dumps
It lacks any information about the dump format. I did it experimentally using also: http://en.wikipedia.org/wiki/Wikipedia:Starting_an_article",148465668,2014-08-17 16:43:44
3974799,289817,16673765,33,"That makes sense. Adding these links to the documentation is good enough.
",148465668,2014-08-26 02:05:05
3974799,289817,16673993,70,"why not stick to unboundedPool in com.twitter.util? I thought we used this elsewhere as well.
",148465668,2014-08-26 02:08:32
3974799,2326839,16675269,70,"They are almost same as those from utils (in our context at least) and you don't need to specify ExecutionContext explicitly, so I don't think we really need to use `external` library for this.
",148465668,2014-08-26 02:31:03
4223016,196885,15305379,45,note that this won't be thread safe,140603390,2014-07-23 23:22:02
4223016,2326839,15305534,45,"For now it is for reading from only one file.


On 23 July 2014 20:22, Pankaj Gupta <notifications@github.com> wrote:

> In
> cassovary-core/src/main/scala/com/twitter/cassovary/util/MapNodeNumberer.scala:
>
> > +  /**
> > +   * Reads map numbere",140603390,2014-07-23 23:24:43
5688017,2326839,22363116,101,this blank line is unnecessary,201078311,2014-12-31 03:22:49
5726611,196885,22450482,21,"the problem with doing this is that these tests can not be done in parallel because of shared mutable state held by the instance val. see http://doc.scalatest.org/2.2.1/#org.scalatest.WordSpec and search for ""Note that the only way before and after code c",202280471,2015-01-05 15:22:09
5726611,196885,22450487,68,same as above,202280471,2015-01-05 15:22:33
5726611,196885,22512585,67,"did you mean to test something else? because the test description says it is testing ""number of elements""",202724982,2015-01-06 15:17:04
5726611,196885,22512792,37,"I know the original test converted everything to List() and then checked matching. But can you please check whether that can be avoided here? i.e., whether 
q.top(0) shouldEqual Seq() will work
etc. throughout this test.",202724982,2015-01-06 15:25:37
5728919,2326839,22442577,43,"What's the point in sortBy(+_). Isn't sorted better? Or, even better, toSet shouldEqual Set(1,2)",202322690,2015-01-05 03:50:24
5728919,2326839,22442588,42,I don't like new lines here. I would write it in one line as there is no serious logic in the _.id. And probably only in ( ).,202322690,2015-01-05 03:51:26
5728919,2326839,22442603,73,as before,202322690,2015-01-05 03:53:04
5739315,2326839,22484128,13,"```
""Two SynchronizedDynamicNodes"" should {
    ""equal iff their nodeIds are equal"" in {
   ...
   }
   ""add/delete functions perform correctly"" in {
   }
```
would be better I think",202659081,2015-01-06 02:44:01
5739315,2326839,22484266,58,"I would write ""At 2 iterations still sum to 1"" (second part of PageRank should...)",202659081,2015-01-06 02:45:53
5739315,196885,22537980,13,"yes, changed.",202659081,2015-01-07 00:50:51
5739315,196885,22537991,58,"yes, good point. changed.",202659081,2015-01-07 00:51:02
5797036,2326839,22757795,31,this line can be in the next scope,204276390,2015-01-10 16:32:15
5800316,196885,22776101,39,"you can use:
val graph = bipartiteExampleSingleSide() before the 'in' statements and not have to change any of the 'in' tests",204380645,2015-01-12 13:06:00
5800316,196885,22776105,17,pls delete all vars,204380645,2015-01-12 13:06:14
5800316,196885,22776114,25,"no need to set a graph variable. just have the last line be 
new BipartiteGraph(...",204380645,2015-01-12 13:06:52
5800316,196885,22776128,101,"same as above, just have 
val graph = bipartiteExampleDoubleSide() here",204380645,2015-01-12 13:08:11
5800316,196885,22776068,15,"this is not your problem, but this test has been written previously pretty horribly (use of vars, side-effects, etc.) This is a good opportunity to fix it.

Please remove all vars and side-effects.",204380645,2015-01-12 13:03:47
5800316,2067916,22785301,17,"Should I remove all the vars? Even for inBounds, outBounds?",204380645,2015-01-12 18:39:44
5878223,196885,23026325,55,"might be counter-intuitive, but shorter paths are generally better, so I would reverse this -- i.e., put dp1.length - dp2.length here and put a brief comment here as well",205210060,2015-01-16 00:22:29
5878223,196885,23026587,14,"comment is still not clear. How about
@return a map of {path -> count} for paths ending at node, sorted in decreasing order of count. Paths with the same count are sorted shortest path first.",205210060,2015-01-16 00:26:02
5878223,196885,23026620,14,I would remove explicit type annotation here since it is so clear from the body,205210060,2015-01-16 00:26:23
5878223,196885,23026928,4,"how about refactor the whole dependency Seq(""it.unimi.dsi"" % ""fastutil"" % ""6.6.0"") ? And while at it, refactor the other common parts (settings, name, etc.) as well of all the non cassovary-core projects in this file? ok with me if you want to do that as ",205210060,2015-01-16 00:30:42
5879220,196885,23029928,24,no need for this extra statement. just the shouldEqual statement is enough.,205226605,2015-01-16 01:15:27
5879220,2067916,23030167,24,Should I remove it everywhere ?,205226605,2015-01-16 01:18:57
5879220,196885,23030157,47,withClue is okay in this block because there are several conditions tested.,205226605,2015-01-16 01:18:50
5890464,196885,23056598,6,reference the object here not fixture(1),205367820,2015-01-16 07:49:20
5890464,196885,23056702,6,use require() instead,205367820,2015-01-16 07:52:40
5890464,3780794,23057731,6,"Nice, I didn't know about require.",205367820,2015-01-16 08:16:55
5890464,3780794,23057735,6,"Right, moving DELETED_MARKER to companion object makes this cleaner.",205367820,2015-01-16 08:16:59
5890464,3780794,23057730,5,"Good, I was wondering why it was in the class and not in the object.",205367820,2015-01-16 08:16:53
5890464,196885,23056599,5,"I know this was already there, but it will be better to put this in a companion object to save space.

i.e., object SynchronizedDynamicNode {
val DELETED_MARKER = ...
}
",205367820,2015-01-16 07:49:23
5920877,2326839,23164105,77,"you should be able to delete it, don't you?",208093014,2015-01-19 21:59:43
5961025,196885,23392579,15,thanks for fixing these names as well,208963930,2015-01-23 00:29:57
5961025,196885,23392634,5,"here and everywhere else, please maintain alpha ordering of the imports",208963930,2015-01-23 00:30:45
5961025,196885,23392869,24,'statsReceier' is missing a 'v' in its spelling.,208963930,2015-01-23 00:34:13
5961025,196885,23392929,59,space before {,208963930,2015-01-23 00:35:13
5961025,196885,23393004,10,is twitter-server a shared setting or only for cassovary-server?,208963930,2015-01-23 00:36:16
5961025,196885,23393267,9,looks like you can move to 6.24.0,208963930,2015-01-23 00:39:35
5989036,12202,23457560,11,"I'd drop oraclejdk7, we should only need one v7 JDK IMHO, otherwise just a waste of build resources in the majority of cases",209707400,2015-01-23 22:47:41
5989036,146404,23458139,11,"I'm fine with this, but I'm pretty sure I've seen issues come up only with that JDK on other projects, and since it's currently probably the most widely used of the three, I thought it would be worth testing.

As a side note, I'd like to standardize the",209707400,2015-01-23 22:55:31
5989036,196885,23468474,11,"If oraclejdk7 is the most widely used right now, we should probably keep it....",209707400,2015-01-24 01:20:50
5998501,196885,23499853,16,"it is considered best practice to explicitly specify mutable.HashMap and import only scala.collection.mutable (see http://docs.scala-lang.org/overviews/collections/overview.html starting from ""A useful convention is..."")",210098800,2015-01-25 05:15:38
5998501,196885,23499855,6,delete (see next comment),210098800,2015-01-25 05:15:54
6001846,196885,23499789,5,why not 6.23.0? project/Build.scala uses it.,210120717,2015-01-25 05:07:39
6006960,196885,23557928,13,This trait sounds like SortedSet. Use that instead adding the 'intersect' method?,210333842,2015-01-27 02:39:37
6006960,2326839,23558147,13,"SortedSet uses Ordering/Ordered, so I was afraid of boxing/unboxing, but didn't check it.",210333842,2015-01-27 02:42:40
6006960,2326839,23560847,13,"I see what you mean. Will change it.

Btw, checked speed:
```
import com.twitter.cassovary.util.SortedArrayWrapper

import scala.collection.immutable.SortedSet

def time(a: => Unit): Unit = {
  val t1 = System.currentTimeMillis()
  a
  val t2 =",210333842,2015-01-27 03:18:49
6006960,2326839,23562388,13,"If I wanted SortedArrayWrapper extends Seq with SortedSetLike, I need it to implement: contains, + (adding element) and -. Then I can override intersect, but:
```
def intersect(that: GenSet[A]): This
```
thus, if I override it, this method will be cal",210333842,2015-01-27 03:42:03
6006960,196885,23563333,13,"yeah, that's a lot of methods to override that are unnecessary for our purpose.

btw, do you still need this wrapper when moving to a graph-based design rather than a node-based design?",210333842,2015-01-27 03:55:09
6006960,2326839,23567316,13,I need some of the methods here. Probably not the wrapper itself.,210333842,2015-01-27 04:49:03
6006960,196885,23647067,17,do you remember why we have this extra private class whose apply() is called to produce ArrayBasedDirectedGraph (as opposed to just having the code in the constructor inline here),211199317,2015-01-28 05:01:08
6006960,196885,23647130,5,delete extra line,211199317,2015-01-28 05:02:04
6006960,196885,23647275,16,use existing method neighborIds(),211199317,2015-01-28 05:03:59
6006960,196885,23647427,43,the order of 'in' and 'out' in parameter list is different here which could be a potential source of confusion/bugs,211199317,2015-01-28 05:06:05
6006960,196885,23650060,48,"not sure I like this. SeqBasedNode is really just the same as Node (with no added or reduced functionality), so may be we should just make the trait Node to be an abstract class?
",211199317,2015-01-28 05:40:37
6006960,196885,23650097,2,please use 2015 for all new files,211199317,2015-01-28 05:41:08
6006960,196885,23650175,4,delete new line and also do import java.{util => jutil} to be a bit clearer.,211199317,2015-01-28 05:42:13
6006960,196885,23650285,10,update comment. Not clear what 'ordering' is.,211199317,2015-01-28 05:43:52
6006960,196885,23650312,14,rename to 'exists' ?,211199317,2015-01-28 05:44:17
6006960,196885,23650657,25,should be min not +,211199317,2015-01-28 05:48:47
6006960,196885,23650873,47,How is this method different? Is this a merge?,211199317,2015-01-28 05:51:54
6006960,196885,23650924,64,"did you mean that.length here instead of array.length?

Also, please check that tests cover the conditions.",211199317,2015-01-28 05:52:36
6006960,196885,23651059,82,seems like scala/collection/mutable/ArrayOps.scala uses Array.copy which is a system call to System.arraycopy . Might want to use that?,211199317,2015-01-28 05:54:43
6006960,196885,23651086,18,s/Test/Spec,211199317,2015-01-28 05:55:01
6006960,196885,23652198,6,is this required?,211199317,2015-01-28 06:11:06
6006960,196885,23652516,15,Check scala.collection.Searching -- wondering if we should use IndexedSeq[Int] instead of Array[Int] here.,211199317,2015-01-28 06:16:01
6006960,196885,23652615,18,this is nice. Some comments here would be useful to the reader.,211199317,2015-01-28 06:17:30
6006960,196885,23652642,21,we probably want nodeIds to be of type IndexedSeq or Array (instead of converting nodeIds to an array).,211199317,2015-01-28 06:17:58
6006960,196885,23652831,51,I think Array[Int]() creates a new empty object everytime. That was the idea to have noNodes.,211199317,2015-01-28 06:20:30
6006960,196885,23653146,41,"we want to sort the edges if we are asked to (this was the original motivation). i.e., neighborsSorted is actually sortNeighbors. If neighbors is already sorted, well it is okay to sort it again if we are asked to. (If neighbors is already sorted and we d",211199317,2015-01-28 06:25:25
6006960,196885,23653163,90,again sort the edges if sortNeighbors is true.,211199317,2015-01-28 06:25:48
6006960,2326839,23675568,17,Having the code in constructor makes it hard to override.,211199317,2015-01-28 16:49:37
6006960,2326839,23679284,48,"No, because of other methods. It is a bit more general. Consider:
```
class SetBasedNode(val id, val in: Set[Int], val out: Set[Int]) extends Node {
  def inboundNodes() = in.toSeq // slower
  def isInboundNode(node: Int) = ... // faster
  ...
}
``",211199317,2015-01-28 17:58:15
6006960,2326839,23679911,15,"The methods there use Ordering, so I'm afraid they use boxing as well.",211199317,2015-01-28 18:11:21
6006960,2326839,23689022,21,"nodeIds are by default still a Seq. And IndexedSeq still needs toArray `conversion`.

containsNodes works also when neighbors are not sorted. so Seq is used.

If a Seq is an array than toArray does nothing.",211199317,2015-01-28 21:18:38
6006960,2326839,23689310,41,"neighborsSorted means that neighbors are already sorted in the input. Is this ok?

We have to sort inNodes at the end.",211199317,2015-01-28 21:22:30
6006960,196885,23705363,48,"My question was different -- as currently defined, the purpose of SeqBasedNode is not clear at all (to me). Seems like it doesn't provide anything new or different than Node itself. i.e., whatever you do with SeqBasedNode you can directly do based on Node",211199317,2015-01-29 00:38:01
6006960,196885,23707104,15,that's right. Please add a comment then that we are writing our own to not have boxing/unboxing overhead of scala.collection.Searching,211199317,2015-01-29 00:59:01
6006960,2326839,23707813,48,"It's only a constructor, not any logic at all.

I have it only in order not to write:
```
new Node {
  val id = nodeId
  override def inboundNodes() = in
  overrided def outboundNodes() = out
}
```",211199317,2015-01-29 01:07:17
6006960,2326839,23708329,41,Shall we allow also to read graph that is not sorted and sort it while reading?,211199317,2015-01-29 01:13:02
6006960,196885,23710232,21,"If you don't do an 'override', then the compiler will choose this implementation based on the method signature which could be an array here. i.e.,
protected def containsNode(nodeIds: Array[Int], queryNodeId: Int): Boolean = ....

then the compiler will",211199317,2015-01-29 01:35:11
6006960,196885,23710348,41,"No, my original intention was for the code to sort it if it is given in unsorted order so we want a different variable 'sortNeighbors' which the code checks and when true sorts every adjacency list.",211199317,2015-01-29 01:36:29
6006960,196885,23713875,48,perhaps add a single line comment to make it clear,211199317,2015-01-29 02:14:07
6006960,196885,23713913,41,"ah, the answer is yes to your question.",211199317,2015-01-29 02:14:31
6006960,2326839,23898776,21,"Checked this and it does not work as you said. If I use
```
protected def containsNode(nodeIds: Array[Int], queryNodeId: Int): Boolean
```
the method is not called when I call constainsNode on inboundNodes() that are an array.

Also if I omit overri",211199317,2015-02-01 23:30:21
6006960,196885,23900296,21,"Interesting. it works in my repl:

scala> trait A { protected def f(s: Seq[Int]): Boolean = true }
defined trait A

scala> class A2 extends A { protected def f(a: Array[Int]) = false 
     | println(f(Array(1)))
     | }
defined class A2

scala>",211199317,2015-02-02 02:28:24
6006960,2326839,23900672,21,"I didn't know about that.

But we still have a problem here. I used as before but:
```
object A3 extends A2 {
  val arr: Seq[Int] = Array(0)
  println(""In Seq:"" + f(Seq(1,2))); println(""In Array:"" + f(arr))
}
```
and obtained:
```
// Exiting pa",211199317,2015-02-02 03:08:32
6006960,2326839,23900690,21,Do you think we can fix it?,211199317,2015-02-02 03:10:55
6006960,2326839,23901591,21,I fixed all but this in the last commit.,211199317,2015-02-02 04:46:45
6006960,196885,23906517,21,"It is clear from these examples that the choice of method is based on
compile-time type... No good for us.

On Sun, Feb 1, 2015 at 12:08 PM, Szymon <notifications@github.com> wrote:

> In
> cassovary-core/src/main/scala/com/twitter/cassovary/graph/S",211199317,2015-02-02 11:29:34
6006960,196885,24062118,16,"I was suggesting changing this to creating a FillingInEdgesBiDirectionalNode and not a BiDirectionalNode. This removes one unnecessary class instance creation ""table(node.id) = fillingEdgesNode"" in ArrayBasedDirectedGraph above. This also will require mod",213827451,2015-02-04 11:24:07
6006960,196885,24062171,168,"one effect of this condition is of course that under this sorting strategy, nodes are of type FillingInEdgesBiDirectionalNode are left as it is (which is okay with me as table[] is of type Array[Node] but you had pointed out earlier that this was not idea",213827451,2015-02-04 11:25:55
6006960,2326839,24073279,16,"But then we need casting to FillingInEdges... (from Node) when initializing array, filing edges and another casting when finishing filling. I thought we wanted to avoid this.",213827451,2015-02-04 17:09:25
6006960,196885,24090260,16,"Casting is fine. We have casting even now while filling edges. 
I guess if we really wanted to avoid casting, we should create a separate tempTable: Array[FillingInEdgesBiDirectionalNode] and assign to table once edges have been filled.
",213827451,2015-02-04 22:23:19
6006960,2326839,24091099,16,"We would still need casting because cannot do:
```
val a: Array[BiDirectionalNode] = new Array[FillingInEdgesBiDirectionalNode]
```
Ok, will change it.",213827451,2015-02-04 22:33:36
6006960,196885,24091742,16,"may be just let a be of type FillingInEdgesBiDirectionalNode ?


On Wed, Feb 4, 2015 at 7:33 AM, Szymon <notifications@github.com> wrote:

> In
> cassovary-core/src/main/scala/com/twitter/cassovary/graph/node/ArrayBasedDirectedNode.scala
> <https://github",213827451,2015-02-04 22:41:26
6025824,196885,23587506,14,"list.toIntArray() will also work, but this is fine too.",210909436,2015-01-27 12:07:56
6025824,196885,23587515,3,please arrange imports in alphabetical order,210909436,2015-01-27 12:08:28
6025824,196885,23587574,20,don't need 'override' specifier.,210909436,2015-01-27 12:11:09
6025824,196885,23587719,29,scala doesn't use the _ convention too much.,210909436,2015-01-27 12:16:51
6025824,196885,23587876,48,"can use flatMap: 
iteratorSeq flatMap { _() }",210909436,2015-01-27 12:22:02
6025824,196885,23587891,17,Perhaps also add for clarity that all operations are done in a single thread.,210909436,2015-01-27 12:22:48
6025824,196885,23588711,70,"the recommended way to do what you are doing IIUC (to expose only a DynamicNode type to the outside world) is to declare a private object like this:

private object IntListNode {

def apply(id: Int, outboundList: ..., inboundList: ...) = new DynamicNo",210909436,2015-01-27 12:53:01
6025824,196885,23589784,75,"Bear in mind that random access (e.g., for a random walk) would first require traversal of the whole intArrayList to convert the list to a Seq rather than an O(1) direct access. What you want to do I think is to define a new wrapper class like this:
clas",210909436,2015-01-27 13:39:32
6025824,196885,23589836,14,this will be O(n) btw,210909436,2015-01-27 13:42:05
6025824,2326839,23591129,25,You can also consider using http://fastutil.di.unimi.it/docs/it/unimi/dsi/fastutil/objects/ObjectArrayList.html instead ArrayBuffer,210909436,2015-01-27 14:31:31
6025824,2326839,23592756,103,Throws NPE when id > outboundLists.length,210909436,2015-01-27 15:25:12
6025824,2326839,23597430,11,"Have a look here. I'm creating fastutils collection that is only an implementation of scala's built-in collection (mutable.Map). If you use something like this, you can have 
```
private val outboundLists: mutable.IndexedSeq[mutable.IndexedSeq[Int]] = n",210909436,2015-01-27 17:00:24
6025824,2326839,23597843,14,You don't need to use this at all (see my previous comment),210909436,2015-01-27 17:09:31
6025824,2326839,23597951,7,"See here for the structure of a test:
http://doc.scalatest.org/2.2.1/#org.scalatest.WordSpec

To obtain nice class spec when running test, it should be sth like 
```
""An ArrayBasedDynamicDirectedGraph"" should {
   ""add new nodes"" in {
   }
  ""dele",210909436,2015-01-27 17:12:14
6025824,3780794,23644839,14,"Good point about O(n)!  I've now changed it to
def intArrayListToSeq(list: IntArrayList): Seq[Int] = list.elements()
which should be O(1).  I couldn't find an immutable.Seq wrapper in the standard library.  This has the downside that technically a clien",210909436,2015-01-28 04:32:50
6025824,3780794,23645047,3,Done,210909436,2015-01-28 04:35:19
6025824,3780794,23645254,20,"I agree it isn't needed, but I thought it was good style. I'll remove it.",210909436,2015-01-28 04:38:39
6025824,3780794,23645698,29,Is there a better name for _nodeCount? (I just realized that http://docs.scala-lang.org/style/naming-conventions.html#accessorsmutators puts the underscore before the name).,210909436,2015-01-28 04:44:56
6025824,3780794,23646066,48,"I considered that, but I think it would convert the iterators into a single Seq (reading all the data from all the iterators into memory), and I thought that might give worse performance than constructing the graph as we iterate over the input.",210909436,2015-01-28 04:48:51
6025824,3780794,23646585,17,Sounds good.  I may add threads in the future if the performance seems important in practice.,210909436,2015-01-28 04:55:31
6025824,3780794,23646993,70,"This wasn't that clear, but I meant to say that it is an inner class because it needs a reference to this (the graph) in the mutator methods (they call addEdge on the enclosing graph).  If I change it to a static class as you're suggesting, I would need t",210909436,2015-01-28 05:00:16
6025824,3780794,23647162,75,"Nice, this is the read-only wrapper I can use.",210909436,2015-01-28 05:02:30
6025824,3780794,23647193,25,Do you think it is more efficient than ArrayBuffer? ,210909436,2015-01-28 05:02:55
6025824,3780794,23659443,103,"I think outboundListOption already handles the case when id > outboundLists.length.  I just added
    graph.nodeExists(1000000) shouldEqual false
to one of the tests (where graph is a small graph), and it passed.",210909436,2015-01-28 08:27:36
6025824,3780794,23659518,11,"I agree that's easier to use IndexedSeq, but I'm slightly afraid that if I used map, etc. on IndexedSeq I'll accidentally do an O(n) copy when I'm not expecting it.",210909436,2015-01-28 08:29:26
6025824,2326839,23669708,25,No idea.,210909436,2015-01-28 14:27:09
6025824,2326839,23706767,103,You're right.,210909436,2015-01-29 00:55:10
6025824,2326839,23707125,11,"1) That's Scala's charm.
2) Should be fine as long as you use val.",210909436,2015-01-29 00:59:24
6025824,196885,23712526,48,I think none of the iterators should be called -- easy to test in repl.,210909436,2015-01-29 02:00:29
6025824,196885,23712640,17,"at least in ArrayBasedDirectedGraph, single thread performance was abysmal. From our past experience, reading graph is a time consuming operation and so it might pay to do it in multiple threads",210909436,2015-01-29 02:01:50
6025824,196885,23712879,70,here you always pay for the storage of the two option classes which won't be the case otherwise.,210909436,2015-01-29 02:04:22
6025824,196885,23713645,11,"@szymonm in your suggestion the inner mutable.IndexedSeq will have unboxing/boxing, yes?",210909436,2015-01-29 02:11:54
6025824,3780794,23717694,48,"Good idea to just test it.  If I execute the following script:
```scala
def makeIterator(name: String): Iterator[Int] = new Iterator[Int] {
  var current = 0
  def next(): Int =  {
    println(""iterator "" + name + "" returning "" + current)
    curren",210909436,2015-01-29 02:58:33
6025824,3780794,23725400,48,"Perhaps a clearer alternative to what I have is 
`iteratorSeq.view flatMap { _()}`",210909436,2015-01-29 04:29:10
6025824,3780794,23725849,70,"If we want to avoid the storage of one of the two option classes, I think we would need to not access it inside the relevant closure, which would make the code awkward (I'm not sure how to do that without essentially writing two different Node classes). M",210909436,2015-01-29 04:35:19
6025824,196885,23737599,70,"You are right. We will need to avoid the references inside the {...}. At the minimum, you can do upfront the logic of converting to Seq like:
val o: Seq[Int] = outboundList.map{fastUtilUtils.intArrayListToSeq()) getOrElse(Seq.empty[Int])

and then use ",210909436,2015-01-29 07:27:21
6025824,3780794,23802351,70,"Doing the conversion to Seq outside IntListNode is actually a bit cleaner, so I did that.",210909436,2015-01-30 04:04:40
6025824,2326839,23830961,11,"I cannot answer, but you are right that wrapping the fastutils collection is expensive. See #142 ",210909436,2015-01-30 16:14:14
6049071,196885,23710610,2,Pls use 2015 on all new files,211532297,2015-01-29 01:39:32
6049071,196885,23710788,19,"why not a trait?

trait NodeStream extends Iterable[NodeIdEdgesMaxId] with Closeable",211532297,2015-01-29 01:41:40
6049071,196885,23710891,14,no need to specify type of iterator here as it is so clear.,211532297,2015-01-29 01:42:53
6049071,196885,23711803,50,"correct me @szymonm if I am wrong, but we want to change the return value here to NodeStream. Then call NodeStream.close() after all the lines have been read during the array construction. 

And yes @AnishShah pls remove the () => everywhere after this ",211532297,2015-01-29 01:53:34
6049071,2067916,23714768,14,"Here, `iter.iterator` is returning `empty`. I don't know why it is returning empty. It should return `Iterator[NodeIdEdgesMaxIs]`",211633408,2015-01-29 02:24:24
6049071,196885,23752060,5,should be Seq[NodeStream],211633408,2015-01-29 15:13:57
6049071,196885,23752160,19,Seq[NodeStream] is fine,211633408,2015-01-29 15:16:34
6049071,196885,23753601,14,what do you mean 'empty'? in which test does it return empty?,211633408,2015-01-29 15:54:45
6049071,196885,23856886,8,"move lastLineParsed, lines, holder to inside the new Iterator block. That's why you are seeing empty iterator exception.",212393864,2015-01-31 00:24:10
6049071,196885,23857073,14,change iteratorFunc to some other name: edgesIterable or something else you like,212393864,2015-01-31 00:26:46
6049071,196885,23857246,10,close the file at the end too,212393864,2015-01-31 00:29:11
6049071,196885,23857000,58,just change iteratorFunc variable to iterator in the method parameters,212393864,2015-01-31 00:25:47
6049071,196885,23887589,5,change variable name to iterableSeq,212437186,2015-01-31 15:10:05
6049071,196885,23887590,14,change variable name to iterable,212437186,2015-01-31 15:10:20
6049071,196885,23887592,31,change variable name to iterableSeq,212437186,2015-01-31 15:10:35
6049071,196885,23887591,22,change variable name to iterableSeq,212437186,2015-01-31 15:10:26
6049071,196885,23887596,5,change variable name to dataIterable,212437186,2015-01-31 15:11:01
6049071,196885,23887597,14,change variable name to iterableSeq,212437186,2015-01-31 15:11:11
6049071,196885,23887600,17,iterableSeq.flatten should work,212437186,2015-01-31 15:11:23
6049071,196885,23887601,5,change variable name to iterableSeq,212437186,2015-01-31 15:11:31
6049071,196885,23887608,15,you can keep immutables (such as definition of patterns) outside the iterator if you want,212437186,2015-01-31 15:12:55
6049071,196885,23887662,19,"this is dangerous to do here as lines is an iterator (that has not been traversed yet). close the file in hasNext
private val src = Source.fromFile(filename)
private val lines = src.getLines().map ....
def hasNext = {
val h = lines.hasNext
if (!h) sr",212437186,2015-01-31 15:37:21
6049071,196885,23887665,5,change var name to iterableSeq,212437186,2015-01-31 15:37:45
6049071,196885,23887666,6,maintain alpha imports,212437186,2015-01-31 15:37:57
6049071,196885,23887667,21,change var name to iterableSeq,212437186,2015-01-31 15:38:05
6049071,196885,23887668,32,prefer () to {} in multi-line block,212437186,2015-01-31 15:38:31
6049071,196885,23887672,5,change var name to iterableSeq,212437186,2015-01-31 15:40:02
6052245,2326839,23753879,18,"Maybe a bit more general:
```
def run: Function1[Int, Double]
```
This allows using Array, Map, lazy evaluation, ...",211608979,2015-01-29 16:00:57
6052245,2326839,23753986,18,And maybe apply as the method name? That would be consistent with other algorithms we have (ex. PageRank),211608979,2015-01-29 16:03:03
6052245,2326839,23754033,51,This method is almost same as InDegreeCentrality:apply,211608979,2015-01-29 16:04:09
6052245,2326839,23754065,88,pls insert newline at the end of each file.,211608979,2015-01-29 16:04:41
6052245,2326839,23754105,2,pls use 2015 in the header,211608979,2015-01-29 16:05:34
6052245,2326839,23764093,18,"we can allow also computing centrality for some of nodes by using:
```
def run: PartialFunction[Int, Double]
```",211608979,2015-01-29 19:27:34
6052245,196885,23784439,18,"I like Function1, but let's use PartialFunction1 when we have a case for it.",211608979,2015-01-30 00:18:13
6052245,196885,23786519,25,divide by nodeCount instead?,211608979,2015-01-30 00:43:47
6052245,196885,23786604,18,"most concise is 
trait Centrality extends (Node => Double)
",211608979,2015-01-30 00:44:51
6052245,196885,23786620,17,delete extra line,211608979,2015-01-30 00:45:05
6052245,196885,23786625,20,delete extra line,211608979,2015-01-30 00:45:13
6052245,196885,23786681,51,"yes, @bmckown please merge the two and reduce code redundancy",211608979,2015-01-30 00:45:55
6052245,196885,23786870,19,"I'd change this to a 
def centrality: Array[Double]
and let the implementor implement (also see below)",211608979,2015-01-30 00:48:19
6052245,196885,23788206,19,"this will also need (if you do a trait below that extends Node=>Double)
def apply(n: Node) = centrality(n.id)",211608979,2015-01-30 01:05:57
6052245,196885,23788232,69,"prefer the simpler
val centrality = graph map { node => node.inboundCount }",211608979,2015-01-30 01:06:23
6052245,196885,23788306,51,"e.g., may be use node.neighborCount(..)",211608979,2015-01-30 01:07:23
6052245,2913263,23822245,25,"From my experience it is not common to divide by node count.  Most often, you will see normalization done by dividing each node's centrality by the maximum number of possible edges (maxNodeId - 1) to other nodes.  

As a reference, here is the documenta",211608979,2015-01-30 10:26:20
6052245,196885,23823740,25,"thanks for the link. Seems like it is dividing by nodeCount-1, not maxNodeId-1",211608979,2015-01-30 11:34:18
6052245,2913263,23839524,25,"Ahh I think I figured the two were one in the same.  Just for my clarity, does nodeCount include nodes in the graph that do not have edges connecting them to other nodes, or does it just include ""active"" nodes?  ",211608979,2015-01-30 19:36:01
6052245,2913263,23848058,25,"It seems that nodeCount returns the number of ""active"" nodes in the graph (i.e. nodes that are connected to other nodes).  However, I would argue that dividing by (maxNodeId - 1) is the right call here.

Lets consider a graph of 15 nodes with a fully co",211608979,2015-01-30 22:16:23
6052245,196885,23887375,25,complete the comment,212435021,2015-01-31 14:23:25
6052245,196885,23887383,29,"come to think of it, your intent is to return an immutable collection here.
so this should be 
def centrality: collection.IndexedSeq[Double]
",212435021,2015-01-31 14:24:55
6052245,196885,23887384,20,make this protected?,212435021,2015-01-31 14:25:05
6052245,196885,23887386,27,probably accessing centralityValues is better?,212435021,2015-01-31 14:25:31
6052245,196885,23887393,24,not recommended to use the same name for method and param,212435021,2015-01-31 14:26:48
6052245,196885,23887395,22,"comment what the return values are, or delete the @return line",212435021,2015-01-31 14:27:11
6052245,196885,23887399,25,"this is a bit odd. If normalize param is false, why even call this method?",212435021,2015-01-31 14:28:12
6052245,196885,23887492,27,"in fact if you don't use centralityValues, you will be calling the expensive calculation of centrality everytime you use apply()",212435021,2015-01-31 14:52:16
6052245,196885,23887541,29,"also I think it is better to rename this to centralityAllNodes and to have an explicit build()
i.e.,
...
def centralityAllNodes: collection.IndexedSeq[Double] = centralityAllValues
def recalculate() : collection.IndexedSeq[Double]
",212435021,2015-01-31 14:58:57
6052245,196885,23887554,84,"This is a lot of code duplication with only the 'dir' being different.
Consider just having one class:

class DegreeCentrality(graph: DirectedGraph, dir: GraphDir, normalize: Boolean = true) extends AbstractDegreeCentrality(graph) {
recalculate()
def",212435021,2015-01-31 15:00:34
6052245,2326839,23888014,29,"If you want an immutable collection you should use:
collection.immutable.IndexedSeq instead collection.IndexedSeq",212435021,2015-01-31 17:07:46
6052245,2326839,23888054,16,"would be clearer if we have only proper values in the arrays (from index 11) and check only them.

Leading zeros may be a bit strange.",212435021,2015-01-31 17:15:30
6052245,196885,23892284,21,"Please add this to the comment:

@note The centrality values are stored in an internal array indexed by node's id. Hence, do not use for graphs with very large ids.
",212707076,2015-02-01 04:39:34
6052245,196885,23892288,22,"not very useful, delete ",212707076,2015-02-01 04:39:48
6052245,196885,23892289,26,private,212707076,2015-02-01 04:40:00
6052245,196885,23892293,39,should be () as per convention as the method changes internal state,212707076,2015-02-01 04:40:26
6052245,196885,23892299,17,"1. imports need to be in alphabetical order.
2. convention is to just import collection.immutable",212707076,2015-02-01 04:40:59
6052245,196885,23892302,39,immutable.indexedSeq,212707076,2015-02-01 04:41:27
6052245,196885,23892309,18,alpha order,212707076,2015-02-01 04:42:03
6052245,196885,23892317,30,?,212707076,2015-02-01 04:42:40
6052245,196885,23892320,32,remove 'override',212707076,2015-02-01 04:42:59
6052245,196885,23892366,26,bear in mind that this will slightly be changed once https://github.com/twitter/cassovary/pull/137 is merged. pls merge master in before your next PR.,212707076,2015-02-01 04:45:31
6052245,196885,23892372,19,The convention is to not do 'created by' comments.,212707076,2015-02-01 04:46:21
6052245,196885,23892379,26,can be outside the should block and a member of the class,212707076,2015-02-01 04:46:55
6052245,196885,23892399,33,"checking for equality of double values is dangerous because of floating point precision. Prefer saying 
should be (0.285 +- 0.001)",212707076,2015-02-01 04:49:02
6074029,196885,23823810,1,pls add the standard copyright header you can get from other files (except change 2014 to 2015),212159580,2015-01-30 11:37:16
6074029,196885,23823845,10,delete extra newline,212159580,2015-01-30 11:39:20
6074029,196885,23825321,11,"I'd make it a trait and not override methods that do not do anything.

trait UndirectedGraph extends DirectedGraph {
def storedGraphDir = Mutual
def getNodeById(id: Int): Option[UndirectedNode]
def iterator: Iterator[UndirectedNode]
}
",212159580,2015-01-30 12:53:32
6074029,196885,23825435,23,"look at existing UnidirectionalNode.scala

UndirectedNode is a UnidirectionalNode with in and out bonded

so I'd put this inside UnidirectionalNode.scala

trait UndirectedNode extends UnidirectionalNode {
def inboundNodes() = outboundNodes()
}

",212159580,2015-01-30 12:58:30
6074029,2326839,23829209,12,"That's not about this PR, but some thoughts related.

Is there any gain from this wrapper (UndirectedGraph) if getNodeById (and other methods) returns Node (normal, not an uniderected one). We cannot use UndirectedNode properties (unless casting).

Al",212159580,2015-01-30 15:27:55
6074029,3780794,23860777,10,Done,212159580,2015-01-31 01:24:33
6074029,3780794,23860772,1,Done,212159580,2015-01-31 01:24:29
6074029,3780794,23860942,11,"Why does it matter that we return an UndirectedNode, as opposed to a Node which happens to have the same outbound and inbound neighbors?  Relating to Szymon's comment, what properties do undirected nodes have that Nodes don't have?",212159580,2015-01-31 01:26:58
6074029,196885,23887347,11,"An UndirectedGraph is a collection of UndirectedNodes so an access operation on it should return UndirectedNode. e.g., accessing an element of List[Dog] should return an element of type Dog, not an Animal. This is independent of what Dog might have that a",212159580,2015-01-31 14:11:45
6140301,2326839,24089363,5,why not Iterator[NodeType]?,214084355,2015-02-04 22:13:06
6140301,2326839,24089876,5,"probably
```
trait Graph[+NodeType <: Node]
```
is what we want",214084355,2015-02-04 22:18:58
6140301,2326839,24090024,5,"also
```
trait Traverser[+NodeType <: Node]
```",214084355,2015-02-04 22:20:35
6140301,2326839,24090219,63,"I wondering if we cannot use just
```
trait DepthTracker extends QueueBasedTraverser[Node]
```
as DepthTracker itself does not use information about particular Node type.",214084355,2015-02-04 22:22:49
6140301,196885,24090705,5,DirectedGraph should also be of type [+NodeType <: Node],214084355,2015-02-04 22:28:49
6140301,196885,24092244,5,"prefer a shorter V instead of 'NodeType', so
trait Graph[+V <: Node]
",214084355,2015-02-04 22:47:08
6140301,196885,24092484,20,use +NodeType instead of NodeType everywhere.,214084355,2015-02-04 22:50:26
6140301,196885,24094261,63,"@szymonm while it technically does not have to be as you point out, there is a case for making it because the trait DepthTracker ""is a"" QueueBasedTraverser (because of 'extends' keyword) and it is a bit odd to not type parametrize it. e.g., here do we jus",214084355,2015-02-04 23:09:49
6140301,2326839,24097040,63,QueueBasedTraverser should definitely be of NodeType.,214084355,2015-02-04 23:39:27
6140301,196885,24098298,63,"but DepthTracker only needs QueueBasedTraverser[Node] ? If so, okay to not
have type parametrization in DepthTracker.

On Wed, Feb 4, 2015 at 8:39 AM, Szymon <notifications@github.com> wrote:

> In
> cassovary-core/src/main/scala/com/twitter/cassovary/gra",214084355,2015-02-04 23:54:14
6140301,2067916,24103792,63,"so, just `QueueBasedTraverser[Node]` ? @szymonm ?",214084355,2015-02-05 00:59:38
6140301,196885,24137010,63,Let's go with that for now. ,214084355,2015-02-05 08:29:15
6140301,2326839,24157714,63,"Thought about this. I think 
```
trait DepthTracker  extends QueueBasedTraverser[Node]
```
is ok. Thanks to covariance QueueBasedTraverser[NodeType] <: QueueBasedTraverser[Node] so we can extend it with DepthTracker.",214084355,2015-02-05 18:34:42
6140301,196885,24188895,14,No need to parametrize in this file. It uses only node.id that you can get by just Directedgraph[Node],214571336,2015-02-06 02:03:30
6140301,196885,24188947,16,"Ditto, no need to parametrize.",214571336,2015-02-06 02:04:03
6140301,196885,24188984,5,"Ditto, no need to parametrize.",214571336,2015-02-06 02:04:30
6140301,196885,24189583,5,"for now, this is okay, but we will change it in a separate PR/issue.",214571336,2015-02-06 02:11:16
6140301,196885,24190969,11,"By defining a new [V <: Node] here you have shadowed the V in Traverser[V]

what you actually want here is:
getExistingNodeById[W >: V](graph: Graph[W]...)


see http://docs.scala-lang.org/tutorials/tour/variances.html",214571336,2015-02-06 02:26:21
6140301,196885,24192164,77,"Same problem as above U/W discussion. See if you can simply have processNode(Node) here. Also, seems like the return value is not being used so far, so return Unit.",214571336,2015-02-06 02:38:44
6140301,196885,24192315,5,leave as GraphUtils[Node],214571336,2015-02-06 02:40:52
6140301,196885,24192542,1,just make this trait of type [V <: Node] and simply use DirectedGraph[V] in all methods below without specifying [V<; Node] in every method,214571336,2015-02-06 02:43:49
6140301,196885,24192648,23,will be nice to add a test on any traverser on any subtype of Node to test the new parametrization.,214571336,2015-02-06 02:45:00
6140301,2067916,24224701,23,OK. Will do it.,214571336,2015-02-06 13:27:21
6140301,2067916,24253615,77,return value is used in `next()` ,214571336,2015-02-06 23:50:27
6140301,2067916,24253920,77,"Also, can't keep `processNode(Node)` since return type of `next()` should be the subtype of `Node` .

Should I also parameterize `visitNode()` ? ",214571336,2015-02-06 23:53:57
6140301,2067916,24255110,23,I need help with writing tests. Should I create `TestBipartiteGraph.scala` for `Bipartite Node` and `TestDynamicGraph.scala`  for `Dynamic Node` and then use it in `TraverserSpec.scala` ?,214571336,2015-02-07 00:09:17
6140301,196885,24277407,77,"In next(), instead of 
```processNode(getExistingNodeById(graph, nextId))```
perhaps do this:
```
...
val node = getExistingNodeById(graph, nextId)
processNode(node)
node
```",214571336,2015-02-07 05:29:48
6140301,196885,24277673,23,"Just add a new bipartite graph to TestGraph.scala and use it in TraverserSpec. We are looking for one simple test to test the new functionality, and do not need all the methods / classes of Traverser tested again",214571336,2015-02-07 05:33:45
6140301,2067916,24290366,11,"Not sure if it should be `W >: V` . It means, W should be either `V` or its super type. But, here V is only the sub types of Node, which breaks the type bound, I guess. ",214571336,2015-02-07 23:14:45
6140301,2067916,24290377,11,"It should be `W <: Node`, I guess.",214571336,2015-02-07 23:16:29
6140301,196885,24291314,11,"No I think W >: V is right. A traverser of type V can do something with
graph of type V or supertype but can not of subtypes.

On Saturday, February 7, 2015, Anish Shah <notifications@github.com> wrote:

> In
> cassovary-core/src/main/scala/com/twitter/ca",214571336,2015-02-08 01:08:25
6140301,2067916,24681193,11,"I think, it is breaking the type bound.
I'm getting this error `type arguments [W] do not conform to trait Graph's type parameter bounds [+V <: com.twitter.cassovary.graph.Node]`

Here is some rough code
```
scala> trait Node
defined trait Node

s",214571336,2015-02-14 00:38:03
6140301,196885,24720640,11,try [W >: V <: Node],214571336,2015-02-15 15:14:08
6140301,2067916,24720670,11,"Yeah! That was working. Cool :)
On 15 Feb 2015 13:44, ""Pankaj Gupta"" <notifications@github.com> wrote:

> In
> cassovary-core/src/main/scala/com/twitter/cassovary/graph/Traverser.scala
> <https://github.com/twitter/cassovary/pull/148#discussion_r24720640>",214571336,2015-02-15 15:22:21
6143507,196885,24137265,20,Even though the current code is littered with {@code ...} we don't use it anymore. Prefer `graph`,214166725,2015-02-05 08:33:20
6143507,196885,24137294,25,Not a real useful comment over and beyond one in abstract class. I'd delete it.,214166725,2015-02-05 08:34:20
6143507,196885,24142622,5,i meant to say backticks graph backticks (markdown may have caused it to appear as something else).,214329839,2015-02-05 11:26:28
6143507,196885,24142678,32,"make this functional style.
val (sum, neighborCount) = bfs.foldLeft((0,0)) { case ((partialSum, partialCount),a) => (partialSum+a, partialSum+1) } }",214329839,2015-02-05 11:29:11
6143507,196885,24142719,32,"substitute 'a' above with bfs.depth(n.id).get
",214329839,2015-02-05 11:30:47
6143507,196885,24142729,44,put 0.0 in the same line as else,214329839,2015-02-05 11:31:07
6143507,196885,24142738,37,don't need the extra '{' and pull up next line (if....) to this line,214329839,2015-02-05 11:31:41
6143507,196885,24142875,41,"just confirming that it is either (neighborCount - 1) / sum or (neighborCount-1)^2 / ((nodeCount - 1) * sum) ?

(also if you use the above foldLeft, will need to use sum.toDouble and neighborCount.toDouble to calculate denom)

btw, looks like in neigh",214329839,2015-02-05 11:38:03
6143507,196885,24143044,47,"looks like this is common pattern. You might want to refactor AbstractCentrality as:

private val centralityValues = new Array....

protected def _recalc(centr: Array[Int]): Unit

def recalculate(): immutable.indexedSeq = {
_recalc(centralityValues",214329839,2015-02-05 11:47:35
6143507,2913263,24160722,5,Ha.  Yep.  Markdown definitely made it look exactly like < code > graph < /code >,214329839,2015-02-05 19:45:23
6143507,2913263,24160740,41,"just confirming that it is either (neighborCount - 1) / sum or (neighborCount-1)^2 / ((nodeCount - 1) * sum) ?

You are correct.",214329839,2015-02-05 19:45:47
6143507,196885,24188073,13,you can just call _recalc() here as you don't care about the return value,214478710,2015-02-06 01:54:57
6143507,196885,24188102,25,don't need 'override' keyword,214478710,2015-02-06 01:55:19
6143507,196885,24188186,28,delete empty line,214478710,2015-02-06 01:56:06
6143507,196885,24188219,32,delete empty line,214478710,2015-02-06 01:56:25
6236475,2326839,24570907,6,do you need toIterable at the end then?,216807729,2015-02-12 17:18:04
6236475,2326839,24570999,16,"For the case of immutable graph we would prefer to avoid creating the object here, don't we @pankajgupta ?",216807729,2015-02-12 17:19:31
6236475,3780794,24598080,6,"Yes, I don't know why, but otherwise it doesn't compile.  The type without the toIterable seems to be
`scala.collection.SeqView[Iterable[com.twitter.cassovary.graph.NodeIdEdgesMaxId],Seq[Iterable[com.twitter.cassovary.graph.NodeIdEdgesMaxId]]]#Transforme",216807729,2015-02-13 00:10:44
6236475,3780794,24598219,16,We might prefer not creating the object (I'll let Pankaj answer that) but I don't think it should matter whether the graph is immutable or not. The question is whether the NodeIdEdgesMaxId returned by each iteration should be immutable or not.,216807729,2015-02-13 00:12:29
6236475,2913263,28374206,5,I believe the val modifier is redundant here since you have a case class,243690953,2015-04-15 02:47:17
6236475,196885,28650635,6,"not sure how this compiles as the third argument ""Executors..."" was deprecated in master. Please try running test on your latest commit.",243690953,2015-04-19 12:46:12
6236475,3780794,28656836,5,I agree it's redundant.  Do you think it's better style to omit val?,243690953,2015-04-20 02:03:41
6236475,196885,28664297,5,"yes, please omit val.",243690953,2015-04-20 10:05:59
6254638,196885,24719650,18,some comments would be good. perhaps a link to the wikipedia article will suffice.,217278990,2015-02-15 11:43:45
6254638,196885,24719752,30,"Not sure this bfs.foldLeft statement is needed as nodes is just bfs.toList

And seems like you need access to all the depths. This is actually present in bfs.depthTracker.infoAllNodes but currently depthTracker is private. I'd suggest adding a 
def all",217278990,2015-02-15 12:11:48
6254638,196885,24719787,29,"code is not using PrevNbrCounter here, so just leave it out",217278990,2015-02-15 12:17:50
6254638,196885,24720209,22,"Is this basically summing the two values for the same key? It is pretty hard to read.

(a.keys ++ b.keys).map { i => a.getOrElse(0.0) + b.getorElse(0.0) }


",217278990,2015-02-15 13:53:11
6254638,196885,24720216,20,"what is the need to specialize for all these types? Just do what you need below. Also, do you need to parametrize on both A and B (i.e., are you using many key types and many value types)?",217278990,2015-02-15 13:54:19
6254638,196885,24720244,30,why make a Map of Nodes and not their ids ?,217278990,2015-02-15 13:58:41
6254638,196885,24720550,34,"The calculations are a bit hard to read/understand. Can you try to explain in semi-english/pseudocode what's going on? What's the role of inboundnodes (""previous) and outboundnodes (""nearestOut"") ?
",217278990,2015-02-15 14:56:09
6256278,2326839,24622326,20,Maybe readFileNames?,217322201,2015-02-13 04:31:36
6256278,2326839,24622601,19,could ID be specialized for Int?,217322201,2015-02-13 04:35:16
6256278,2326839,24622742,24,Should't we return None when v.asInstanceOf fails? Would be good to specify this in the scaladoc.,217322201,2015-02-13 04:37:00
6256278,196885,24637208,20,sure,217322201,2015-02-13 08:11:58
6256278,196885,24637234,19,will do,217322201,2015-02-13 08:12:30
6256278,196885,24637292,24,actually it will never fail because it is type safe. That's the reason for the typeTag check. ,217322201,2015-02-13 08:13:27
6256278,2326839,24648682,24,"right, sorry, it was a bit late.",217322201,2015-02-13 14:46:14
6256278,2326839,24651330,39,PartialLabel sounds similar to PartialFunction maybe isThere should be isDefinedAt then?,217322201,2015-02-13 15:59:24
6256278,2326839,24651474,17,I'm wondering if it wouldn't be better to add labels as a trait and keep the possibility to have a graph with no labels.,217322201,2015-02-13 16:02:43
6256278,2326839,24654183,33,here Int-specialization also can make a difference,217322201,2015-02-13 17:04:58
6256278,2326839,24654289,37,however using option here will cause boxing as Option is not specialized,217322201,2015-02-13 17:06:45
6256278,2326839,24654441,6,"This method is never used so far, isn't it?",217322201,2015-02-13 17:10:11
6256278,2326839,24655091,37,It a label is a map than I understand that it is defined only for some ids. Why to have PartialLabel then?,217322201,2015-02-13 17:22:15
6256278,2326839,24655844,37,Note that mutable.Map is a PartialFunction,217322201,2015-02-13 17:35:36
6256278,196885,24718448,17,Moving it to DirectedGraph. This allows Graph to be purer without any vals. Not much overhead to have an empty class included all the time for a collection like graph.,217322201,2015-02-15 07:15:11
6256278,196885,24718580,37,"Correct that label is defined as partial in the first place. PartialLabel is only a sample implementation of label, useful for creating a Flaglabel for instance.",217322201,2015-02-15 07:37:31
6256278,196885,24718594,37,"Actually, choosing not to specialize at all rightaway. At least in terms of storage, native arrays will be used. Will need to do performance testing before doing specialization.",217322201,2015-02-15 07:38:52
6256278,196885,24718626,6,"Correct, deleting it.",217322201,2015-02-15 07:43:55
6300446,196885,25274315,32,should be offset + idx,218608357,2015-02-25 00:53:10
6300446,196885,25274358,33,use IndexOutOfBoundsException((offset+idx).toString),218608357,2015-02-25 00:53:40
6300446,196885,25274450,2,2015,218608357,2015-02-25 00:54:38
6300446,196885,25274469,1,include copyright message,218608357,2015-02-25 00:54:51
6300446,196885,25274571,24,"""second dimension"" is not clear",218608357,2015-02-25 00:55:58
6300446,196885,25274816,11,s/arrays/array,218608357,2015-02-25 00:58:00
6300446,196885,25275215,31,can just pass offsets and lengths,218608357,2015-02-25 01:02:17
6300446,196885,25276370,21,this can be be null. Use Nil or empty seq instead,218608357,2015-02-25 01:15:08
6300446,196885,25276461,5,change the name of this file to ArraySliceSpec.scala,218608357,2015-02-25 01:15:56
6300446,196885,25276982,247,delete extra empty line,218608357,2015-02-25 01:21:55
6300446,196885,25279389,466,shorten name to SharedGraphMetaInfo,218608357,2015-02-25 01:46:28
6300446,196885,25283157,86,rename to readMetaInfoPerShard,218608357,2015-02-25 02:23:56
6300446,196885,25283202,131,use reduce to get rid of vars,218608357,2015-02-25 02:24:22
6300446,196885,25283176,124,suggest s/combine/aggregate,218608357,2015-02-25 02:24:10
6300446,196885,25283227,151,maxNodeId is unused,218608357,2015-02-25 02:24:36
6300446,196885,25283259,208,change to numOfShards,218608357,2015-02-25 02:24:58
6300446,196885,25283280,229,i think this is premature optimization. I'd just use reduce,218608357,2015-02-25 02:25:14
6300446,196885,25283239,191,make all defs private,218608357,2015-02-25 02:24:48
6300446,196885,25283304,261,indent properly,218608357,2015-02-25 02:25:28
6300446,196885,25283432,424,"note that maxNodeId should change now as well as it should include nodes that only have in edges, so we need to calculate this by looking at each edge (and not just each node).",218608357,2015-02-25 02:26:50
6300446,2326839,25505825,32,"Length is the length of this slice.
This is the case when user wants to access the shared array outside this slice. So idx >= lenght is fine, I think.
if (offset + idx >= shared array length) then IOOBE will be thrown by the array. Right?",218608357,2015-02-27 20:30:59
6300446,2326839,25505887,23,"I wanted SharedArray to be very low level, so null is fine here I think.",218608357,2015-02-27 20:32:19
6300446,2326839,25510444,424,I don't think so. Observe that I use NodeIdEdgesMaxId.maxId in line 84 that is maximal id of node and it's out neighbors for every part. Right?,218608357,2015-02-27 21:46:14
6300446,196885,25274547,23,s/the array/the shared array/,218608357,2015-02-25 00:55:41
6300446,196885,25276251,23,consider using Nil here,218608357,2015-02-25 01:13:56
6300446,196885,25283137,4,alpha order,218608357,2015-02-25 02:23:35
6300446,196885,25819597,32,"got it, yes.",218608357,2015-03-05 05:10:45
6303995,196885,24782610,15,prefer not reusing 'val random' across tests. so create new object everytime in rng(),218653761,2015-02-17 06:26:45
6303995,196885,24782630,7,alpha order,218653761,2015-02-17 06:27:26
6312893,2913263,24824642,5,"Which version of java are you using?  To my knowledge that should compile for java 7 and up.  

http://docs.oracle.com/javase/7/docs/technotes/guides/language/type-inference-generic-instance-creation.html

cc @pankajgupta, @szymonm  ",218950985,2015-02-17 22:46:54
6312893,2067916,24825495,5,"Yep. HashMap<>() compiles for Java 7 and up.
And after pull #124 , cassovary works for Java 7 and up.

cc @pankajgupta ",218950985,2015-02-17 22:56:10
6312893,2326839,24825937,5,"yes, diamond notation was introduced in 7",218950985,2015-02-17 23:00:29
6312893,5099978,24853591,5,"Yes, my bad, I was using JAVA 6, updated to 8. Works well now. ",218950985,2015-02-18 04:03:09
6323245,2913263,24898624,28,"We could make this a val by using foldLeft here.  Maybe something like:

```scala
val similarNodes = graph.foldLeft(Seq.empty[SimilarNode]) { (partialSeq, n) =>
  partialSeq ++ (if (n.id != u) 
    Seq(new SimilarNode(n.id, calculateSimilarity(dir, u",219320685,2015-02-18 19:54:38
6323245,2913263,24898785,30,New line at end of file,219320685,2015-02-18 19:58:09
6323245,2913263,24898792,31,New line at end of file,219320685,2015-02-18 19:58:19
6323245,2913263,24899000,38,We could also use foldLeft here?,219320685,2015-02-18 20:02:32
6323245,2913263,24899048,21,Don't think you need override here,219320685,2015-02-18 20:03:44
6323245,2913263,24899384,27,"Could we change to something like this to make it look more like traditional cosine similarity calculations?
```scala
commonNeighbors.size / ( math.sqrt(neighborsOfU.size) * math.sqrt(neighborsOfV.size) )
```",219320685,2015-02-18 20:11:24
6323245,2913263,24899498,31,"How about
```scala
similarityScore should be (.4082482 +- EPSILON)
```
which follows the pattern of other tests in the algorithms package",219320685,2015-02-18 20:14:26
6323245,2913263,24899559,25,"It seems like you need a bunch of the same metrics for these similarity calculations, maybe you could move the duplication to a protected method in the Similarity trait?",219320685,2015-02-18 20:15:52
6323245,2067916,24900128,25,@bmckown Should I make a method that returns pair of neighbours of two nodes or just one node ?,219320685,2015-02-18 20:26:35
6323245,196885,25452898,29,"If both directions are stored in the graph, you actually don't need to iterate over all the nodes of the graph, but just those which have a non-zero intersection of neighbors with u. Let's say we want to get similarity for dir=OutDir. Then you need to che",220472944,2015-02-27 01:50:53
6323245,196885,25453010,30,don't need to store all sims and then sort and take top k. Just track top k at all times using a sorted set.,220472944,2015-02-27 01:52:24
6323245,196885,25453287,29,"return Seq[(Int, Double)] to also return the scores",220472944,2015-02-27 01:55:42
6323245,196885,25453730,19,We've been using Spec instead of Test in class and file names.,220472944,2015-02-27 02:00:08
6323245,2067916,25561130,29,@pankajgupta I didn't understand why only iterate over `u.neighborIds(OutDir).toSet.flatMap(_.neighborIds(InDir))` . Sorry.,220472944,2015-03-01 04:00:06
6323245,2067916,25561254,37,"But, we have to find the neighbors of `U` to find common neighbors. 
After that, It takes constant time to get the size of neighbors of `U`",220472944,2015-03-01 04:14:02
6323245,196885,25453704,37,"note that u remains fixed here, so e.g., in cosine one doesn't need to get the neighbors of u every time or divide by the size of neighbors of u everytime. restructure the code to allow this efficiency in trait implementations.",220472944,2015-02-27 01:59:52
6323245,2913263,25643765,28,"May be useful if k was an `Option[Int]` with default value `None`. And then you could define an overloaded method where k is an `Int` that just calls the previous method but wraps k in `Some`

I hope that makes sense",224362232,2015-03-03 05:10:19
6323245,2913263,25644045,31,"Unless there is a reason I am unaware of to user `graph.iterator` here, you can replace this with just `graph`",224362232,2015-03-03 05:13:41
6323245,2913263,25644213,37,Same here.  May be useful to make k an `Option[Int]`.  That way you could calculate all similarities without having to specify the number.,224362232,2015-03-03 05:15:19
6323245,2913263,25644905,22,"It seems like both of these similarity algorithms require a lot of the same information which is leading to quite a bit of duplication (especially if we start adding more of these).  Maybe, and I'm not sure this is the best option, you could do something ",224362232,2015-03-03 05:24:16
6323245,196885,25799579,24,make sure this returns empty set when nodeId doesn't exist in the graph,224362232,2015-03-05 01:32:14
6323245,196885,25800174,34,"What did you think about my two comments above regarding (1) for a graph keeping both directions, follow out and then in edges to find the candidate similar set of nodes, (2) keeping only top k in the sorted set. (1) might be easier to understand by takin",224362232,2015-03-05 01:38:44
6323245,2067916,25995592,24,what should the similarity score between nodeIds that exists and doesn't exist be? zero? negative number? ,224362232,2015-03-07 19:21:37
6323245,2067916,25995630,24,"I mean, when denominator is zero.",224362232,2015-03-07 19:24:54
6323245,2067916,25996249,34,"1. I got that there's no need to iterate over node that have an empty intersection with neighbors of u, but  `u.neighborIds(OutDir).toSet.flatMap(_.neighborIds(InDir))` will work only for graphs keeping both directions only.
2. Current implementation is ",224362232,2015-03-07 21:18:03
6323245,2067916,25996373,28,"@bmckown I understood, but why do we need this? ",224362232,2015-03-07 21:36:22
6323245,2913263,25996537,28,"Ahh.  I see that I left that part out.  Whoops.  If you had `k: Option[Int] = None`, and the user left `k` as being `None`, then you would return the similarity values for all possible nodes, not just the top `k`.  That way, if the user wanted the similar",224362232,2015-03-07 21:58:40
6323245,196885,26236661,24,zero,224362232,2015-03-11 23:47:38
6323245,196885,26236607,34,"1. That's right -- it is an important special case
2. Look at SmallBoundedPriorityQueue.scala",224362232,2015-03-11 23:47:08
6323245,196885,30279442,20,technically don't need val specifiers in case classes.,255104234,2015-05-14 02:41:45
6323245,196885,30279427,16,alpha order,255104234,2015-05-14 02:41:30
6323245,196885,30280190,40,please put dir as last parameter in all functions and make it default to outdir,255104234,2015-05-14 02:52:20
6323245,196885,30280325,42,"add documentation, esp. of return value",255104234,2015-05-14 02:53:53
6323245,196885,30280694,50,filter with node != u here,255104234,2015-05-14 02:59:14
6323245,196885,30280972,36,"use 'map' i.e.,
graph.getNodeById(nodeId).map { _.neighborIds(dir).toSet }",255104234,2015-05-14 03:03:33
6323245,2067916,30436707,21,"it imports Ordering for Tuple. 

Check out this SO Question: http://stackoverflow.com/questions/19345030/easy-idiomatic-way-to-define-ordering-for-a-simple-case-class

Is this OK? or it is inefficient?
",255104234,2015-05-16 00:07:32
6323245,196885,30280108,21,why is this import needed?,255104234,2015-05-14 02:51:12
6323245,196885,30280627,50,may be toSet instead of toSeq ?,255104234,2015-05-14 02:58:22
6323245,196885,30281082,46,"probably use getNeighbors() above?
Also handle the error case when graph.getNodeById(u) is None (return Seq.empty in that case)",255104234,2015-05-14 03:05:18
6323245,2067916,30437586,50,"We need to filter with `node != u` in  the first condition too. i.e `BothInOut`, while getting neighbors in the reverse direction.
So, I refactored and wrote that condition below. ",255104234,2015-05-16 00:17:49
6355388,196885,25144778,23,"this is a bit confusing, but ""original"" refers to positive ids only. Negative ids are meant to be purely an internal construct.",220180385,2015-02-23 12:45:05
6355388,196885,25145927,23,"oh, I take it back. The negative ids are leaked outside as your tests show. I think it would be best to do away completely with this negative/positive translation inside the nodes, but that again is a separate PR...",220180385,2015-02-23 13:34:20
6391501,196885,25663572,12,pls add comments. Is 'n' source or target?,221913059,2015-03-03 12:04:15
6391501,196885,25663618,7,"should be able to reuse Path here. i.e.,
type Paths = Seq[Path]
",221913059,2015-03-03 12:06:07
6391501,196885,25663711,14,toList is not required,221913059,2015-03-03 12:10:17
6391501,196885,25663716,5,why case class?,221913059,2015-03-03 12:10:31
6391501,196885,25664001,9,"What is the intent of this map?
Can bfsPrevNbrCounter in BFS help?",221913059,2015-03-03 12:21:34
6391501,196885,25664081,38,any advantage of stream over doing a 'while' loop or a 'for' comprehension ?,221913059,2015-03-03 12:24:37
6391501,196885,25664098,42,can you explain what walkOnGraph() is trying to do?,221913059,2015-03-03 12:24:58
6391501,196885,25664103,46,need a test for shortest path as well,221913059,2015-03-03 12:25:10
6391501,2913263,25691064,9,"The intent of this map is to keep track of immediate previous neighbors.  I think I had originally tried to use `bfs.prevNbrCounter`but, in all honesty, I found it a little difficult to get the information out of in a way that made sense.  Maybe you could",221913059,2015-03-03 21:34:27
6391501,2913263,25691615,38,"I used a stream in an attempt to keep everything functional.  Personally, I like to avoid `var`s whenever possible so, in this case, I used a `stream` to avoid mutating the state of a given variable.  I probably could have also used a `for` comprehension.",221913059,2015-03-03 21:41:57
6391501,2913263,25691948,5,"No ""good"" reason.   I tend to get a little case class happy--I like having the option of using the object constructor and having access to all constructor arguments by default.  However, like I said, there is no ""good"" reason.",221913059,2015-03-03 21:45:55
6391501,2913263,25698526,42,"`walkonGraph()` is probably the most opaque piece of code here.  Essentially, I am trying to efficiently determine _all_ shortest paths from node i to node j--not just _a_ shortest path from node i to node j.  

Here is the output from the stack manipul",221913059,2015-03-03 22:57:27
6391501,196885,25705931,29,From which node? All nodes? Might want to clarify,225417275,2015-03-04 00:15:19
6391501,196885,25706128,33,Minor: I will suggest not aliasing Paths at all and leaving it as Seq[Path]. This makes it more readable.,225417275,2015-03-04 00:17:51
6391501,196885,25706237,33,"Also, suggest renaming this to 'shortestPathsTo' to make it a bit clearer that we are supplying a target (and not a source).",225417275,2015-03-04 00:19:04
6391501,196885,25713702,42,"Talking just about walkOnGraph(), I don’t understand it fully but I think what you are doing is retracing back from target node and keeping track of ancestor in ‘index’. My first question is why you are tracing backwards (which relies on ‘previous’) and n",221913059,2015-03-04 01:42:50
6391501,196885,25713863,38,"Stream is useful if you want lazy evaluation of the tail, which you are not doing here because you are evaluating takeWhile immediately. I think you will be better off with a while or a for loop here. vars are good to avoid, but making code much harder to",221913059,2015-03-04 01:44:44
6391501,196885,25713959,22,should probably test on a couple more simple graphs and few more source nodes,225417275,2015-03-04 01:45:44
6391501,196885,25714237,22,s/.keys/.keySet to be explicit,225417275,2015-03-04 01:49:05
6391501,196885,25706343,29,Also s/path/paths because there might be multiple shortest paths,225417275,2015-03-04 00:20:25
6391501,196885,26174397,24,I'd merge this into the trait ShortestPath and just have this class SingleSourceShortestPath rather than have an unnecessary trait lying around. ,226764982,2015-03-11 04:45:38
6391501,196885,26174420,21,"it really is now single source shortest path, so I'd merge this into the class (also see below).",226764982,2015-03-11 04:46:02
6391501,196885,26174470,35,"Are these paths ordered by some thing? If not, may be return a Set? If yes, specify in the comment how they are ordered.",226764982,2015-03-11 04:46:41
6391501,196885,26174630,22,thanks for fixing the spelling!,226764982,2015-03-11 04:49:13
6391501,196885,26174981,79,I'd keep the {} here.,226764982,2015-03-11 04:54:59
6391501,196885,26175093,88,s/find all shortest paths/find all shortest paths from/,226764982,2015-03-11 04:57:03
6391501,196885,26175690,104,use IntInfoKeeper instead? It is meant to be more efficient as it uses fastutils.,226764982,2015-03-11 05:06:42
6391501,196885,26176326,39,perhaps have a more descriptive name? may be chooseNeighborsAfterVisit() or something similar...,226764982,2015-03-11 05:18:26
6391501,196885,26176784,123,why mutable?,226764982,2015-03-11 05:26:21
6391501,196885,26176792,132,why mutable?,226764982,2015-03-11 05:26:29
6391501,196885,26178186,119,"looks like you are only accessing the tail of paths(node.id) using 'index', and if so no need to keep numPaths(node.id) at all, yes?",226764982,2015-03-11 05:49:22
6391501,196885,26178216,126,"don't think it can ever be '<'. Equal to is possible but not less than, yes? If so, might want to assert on it.",226764982,2015-03-11 05:49:55
6391501,196885,26178956,140,"what you have works, but is exponential in both time and space. What do you think about just keeping the information of 'seq of ancestors of a node'. So, in TestGraph.g6 if source node is 10. ancestors(10) = Nil, ancestors(11) = Seq(10), ancestors(12) = S",226764982,2015-03-11 06:03:28
6391501,196885,26179151,28,perhaps put in a lazy val to not have to run unless needed?,226764982,2015-03-11 06:06:54
6425203,196885,25883385,103,"Because of memoization, this will cause stream to hold on to all values in the stream. Not sure if you want to, or discard earlier values. Streams are generally tricky: see http://blog.dmitryleskov.com/programming/scala/stream-hygiene-i-avoiding-memory-le",222959509,2015-03-06 00:35:06
6425203,196885,25884559,119,"streams are overkill for this. A simple recursive method will do here. i think what you are trying to do is:

def loop(curr: T, i: Int): T = { 
val next = iterate(curr)
if (i < maxIterations && next.error > tolerance) loop(next, i+1) else next
}",222959509,2015-03-06 00:48:56
6425203,196885,25884800,13,The 'extends (Option[T] => T)' looks artificial. I'd remove it and let the user use run(). Also I'd merge the trait LinkAnalysis and abstract class AbstractLinkAnalaysis to one abstract class.,222959509,2015-03-06 00:51:31
6425203,196885,25884927,62,"consider calling ""iteration"" ""number"" or ""iterationNumber"" else the element 'iteration' can be confused with the class",222959509,2015-03-06 00:52:36
6425203,196885,25885242,55,change these vals to defs to not have subclasses to 'override' them all the time,222959509,2015-03-06 00:56:11
6425203,196885,25885441,33,"case classes are great for small classes such as Iteration or Params, but I don't generally use case classes unless there is a clear reason to for classes with more code / elements.",222959509,2015-03-06 00:58:06
6425203,196885,25885598,55,Or remove the 'val' annotation,222959509,2015-03-06 00:59:44
6425203,196885,25885944,19,remove. Adds to the confusion between initial/start/init.,222959509,2015-03-06 01:03:52
6425203,196885,25885999,62,Or s/Iteration/IterationState,222959509,2015-03-06 01:04:35
6425203,196885,25886165,62,"Does this need to be exposed outside AbstractLinkAnalysis, or can it be completely internal?",222959509,2015-03-06 01:06:47
6425203,196885,25886253,51,don't need the '.' after graph,222959509,2015-03-06 01:07:38
6425203,196885,25886541,89,"not sure what the benefit of evaluating result, error, iteration is. let the user call run() and get the final error and iterations used?",222959509,2015-03-06 01:10:38
6425203,196885,25886916,44,"probably call this delta than error? Also, a bit weird to have T everywhere but make an Array[] specific method here. Guess it is a convenience method in which case add so to the comment and perhaps call it 'deltaOfArrays' and not a generic 'error'",222959509,2015-03-06 01:14:53
6425203,196885,25887039,28,why 0?,222959509,2015-03-06 01:16:20
6425203,196885,25887179,15,can you report on the pagerank benchmark results before and after your change on a couple of graphs?,222959509,2015-03-06 01:18:08
6425203,196885,25889100,57,"perhaps filter out all nodes that exist outside the iterate loop?
val idsInGraph = graph filter existsNodeId",222959509,2015-03-06 01:41:21
6425203,196885,25889396,61,"the zipWithIndex and foldLeft is unnecessary as you are just iterating over all node ids.
val partialAuth = new Array[Double](maxNodeId+1)
for (id <- graph) { graph.getNodeById(id).get.outboundNodes() foreach {...} }
",222959509,2015-03-06 01:44:38
6425203,196885,25889610,66,"need to be a bit careful with the direction stored in the graph. outboundNodes() is cheap if graph.IsDirStored(OutDir) is true, else we need to use inboundNodes(). Furthur, we can use inboundNodes() when isDirStored(InDir) is true. This is also true for t",222959509,2015-03-06 01:47:08
6425203,196885,25889761,38,want to make this public?,222959509,2015-03-06 01:48:42
6425203,2913263,25910667,15,"After trying to figure out how to run benchmarks for a while, I decided to just ask.  How do I run the benchmarks?  Thanks!

I will probably update the README with instructions on how to run them, unless of course I'm just being an idiot.",222959509,2015-03-06 05:58:28
6425203,196885,25929544,15,"Just added cassovary-benchmarks/BenchmarksREADME.md -- please feel free to
modify and look at the individual sources of benchmarks as well.

On Thu, Mar 5, 2015 at 2:58 PM, Ben McKown <notifications@github.com> wrote:

> In
> cassovary-benchmarks/src/main",222959509,2015-03-06 14:37:48
6425203,2913263,26062962,119,You're correct.  Using a `stream` caused a large decrease in performance (page rank was taking 3x longer to converge).,222959509,2015-03-10 00:43:59
6425203,2913263,26073752,15,"Here are some benchmarks.  I ran each 1000 times.  Here are the benchmarks for the code that is currently in master:

<table>
  <tr>
    <td></tb><td><b>Personalized PR</b></td><td><b>Global PR</b></td>
  <tr>
    <td><b>Facebook Graph</b></tb><td>",222959509,2015-03-10 02:43:42
6425203,196885,26232903,21,Update comment,228265432,2015-03-11 23:12:56
6425203,196885,26233016,41,s/iteration/currState,228265432,2015-03-11 23:14:02
6425203,196885,26233046,50,s/defaultInitialIteration/defaultInitialState/,228265432,2015-03-11 23:14:25
6425203,196885,26234756,85,"minor code change to minimize the number of vars would be to 
1. remove the vars 'iters' and 'error'.
2. s/def terminationCondition/def terminate(currState)/
3. s/while (terminationCondition)/while (!terminate(currentIteration)/",228265432,2015-03-11 23:31:00
6425203,196885,26235393,3,alphabetical order,228265432,2015-03-11 23:36:47
6425203,196885,26235542,31,consider s/AbstractLinkAnalysis/LinkAnalysis/,228265432,2015-03-11 23:38:02
6425203,196885,26235683,49,look at Array.fill,228265432,2015-03-11 23:39:06
6425203,196885,26235959,57,"I know it hasn't been done for old code but since this is new code, we should consider the various directions the graph might be stored in: Out only / In only / Both, and (1) use it to our advantage if we can, and (2) Make sure code works efficiently in t",228265432,2015-03-11 23:41:36
6425203,196885,26236213,68,have a def postRun(T): T = {} method instead in LinkAnalysis that is called at the end of run(),228265432,2015-03-11 23:43:38
6425203,196885,26236279,7,Test with a graph kept only in inbound direction as well,228265432,2015-03-11 23:44:18
6425203,196885,26232811,12,More natural to have a non-trivial class split into multiple lines,228265432,2015-03-11 23:11:59
6425203,196885,26232830,18,Ditto about multiple lines,228265432,2015-03-11 23:12:12
6425203,2913263,27038187,57,"@pankajgupta In working on this, I noticed something that didn't quite make sense to me--before submitting an issue, I wanted to make sure this was an actual bug.  

In TestGraphs, `g6` is created using 
```scala  
val nodeSeqIterator = Seq(
      No",228265432,2015-03-24 21:24:12
6425203,196885,27098764,57,"That’s right — the iterator is seen as a sequence of inedges. It’s not a bug, perhaps the name of the variable g6_onlyin is confusing.


> On Mar 24, 2015, at 8:24 AM, Ben McKown <notifications@github.com> wrote:
> 
> In cassovary-core/src/main/scala/com/",228265432,2015-03-25 13:10:32
6606994,196885,26190552,4,"In the interest of not bloating the command args, I'll suggest doing this hierarchically, i.e., ""-c"" could denote that we should run a centrality benchmark and the followon value could be one of ""indegree"" or ""outdegree"" or ""closeness"" or ""all"".",228530302,2015-03-11 11:59:45
6606994,196885,26232478,13,add all,228878884,2015-03-11 23:08:34
6643623,2326839,26836210,26,would be nice to know what T is,232891212,2015-03-20 18:43:18
6643623,2326839,26836362,50,exists may return true if the file exists but is not a directory,232891212,2015-03-20 18:46:05
6643623,2326839,26836638,71,this comment is not clear to me,232891212,2015-03-20 18:51:49
6643623,2326839,26838131,45,if we are going to use more asynchronous calls maybe this method should return Future[Unit]?,232891212,2015-03-20 19:18:07
6643623,2326839,26838564,5,for me reverseParse is odd. Maybe sth like toString of mkString?,232891212,2015-03-20 19:25:44
6643623,2326839,26839090,19,Comment on what is this for missing,232891212,2015-03-20 19:33:56
6824495,196885,27158678,39,update comment,236246008,2015-03-26 01:51:06
6824495,196885,27159409,42,s/Case //,236246008,2015-03-26 01:58:57
6824495,196885,27159433,42,s/algoritm/algorithm/,236246008,2015-03-26 01:59:13
6824495,196885,27160152,65,use reduce instead of foldLeft when doing an associative binary operator like +,236246008,2015-03-26 02:06:44
6824495,196885,27161084,70,use Array.fill,236246008,2015-03-26 02:15:40
6824495,196885,27162362,78,separate into two separate lines for clarity,236246008,2015-03-26 02:28:22
6824495,196885,27162490,91,this refactoring is nice!,236246008,2015-03-26 02:29:48
6824495,196885,27160023,62,"Consider renaming ""partialCalculation"" to ""scatter"" -- might make it bit more readable, as IIUC in one case, the same value 'valueCollection(node.id)' is being added to each of neighbor's target, and in the other case the valuecollection of neighbors is b",236246008,2015-03-26 02:05:24
6824495,196885,27162601,56,Use Array.fill,236246008,2015-03-26 02:30:50
6824495,2913263,27176316,65,"I seem to be having some trouble getting reduce to work here due to the type bounds.  The only thing I could get to work was 
```scala
if (neighbors.size > 0) neighbors map { n =>  valueCollection(n) } reduce { _ + _ } else 0
```
which slowed down the",236246008,2015-03-26 05:21:35
6824495,196885,27240331,65,"Ah -- revert to foldLeft then

On Wed, Mar 25, 2015 at 4:21 PM, Ben McKown <notifications@github.com>
wrote:

> In
> cassovary-core/src/main/scala/com/twitter/cassovary/algorithms/linkanalysis/Hits.scala
> <https://github.com/twitter/cassovary/pull/178#di",236246008,2015-03-27 00:14:01
7014999,196885,29003014,110,"Do you want a Seq[Int] or a Set[Int] here?

Have you looked at com.twitter.cassovary.graph.tourist.InfoKeeper which is intended to keep information per node?
e.g., you can reuse com.twitter.cassovary.graph.tourist.PrevNbrCounter which keeps an Int2IntM",242255267,2015-04-24 02:01:12
7014999,196885,29003301,112,use NodeColor instead,242255267,2015-04-24 02:03:57
7014999,196885,29003368,128,Can't use par unless you use concurrent data structures,242255267,2015-04-24 02:04:38
7014999,196885,29003594,32,"spelling in ""beweenness""",242255267,2015-04-24 02:06:58
7014999,196885,29004014,101,rename to AllShortestPathsTraverser to clarify that all shortest paths are being tracked,242255267,2015-04-24 02:11:36
7014999,196885,29004201,23,I wouldn't do graph.par here since it lends non-determinism to how many parallel cores are used by the use of .par,242255267,2015-04-24 02:13:55
7014999,196885,29004656,11,"This materializes the graph node list which could be expensive. Consider just keeping val nodes = graph.iterator

and inside def operation() {...
val node = graph.next()
...
}",242255267,2015-04-24 02:19:46
7014999,196885,29004718,24,consider renaming to SingleSourceAllShortestPaths,242255267,2015-04-24 02:20:32
7014999,196885,29004965,33,"Since you are using par, need to be sure that this is concurrency safe?",242255267,2015-04-24 02:23:07
7014999,196885,29005004,5,see above comment regarding use of par,242255267,2015-04-24 02:23:30
7014999,196885,29005101,5,this should be okay with .par,242255267,2015-04-24 02:24:37
7014999,196885,29005261,47,same comments here regarding use of .par --> every use should be carefully done,242255267,2015-04-24 02:26:25
7014999,196885,29005420,59,can you turn into a tail recursive function?,242255267,2015-04-24 02:28:13
8040803,196885,32681794,9,suggest changing 'dangling' to 'zeroOutgoing' to be clearer.,271990099,2015-06-18 03:23:38
8040803,196885,32682024,21,"don't think you need to invoke if (isInStored) here. This is just:
graph.toSet.filter(outBoundCount(_) == 0)",271990099,2015-06-18 03:26:36
8040803,196885,32682223,16,"can you have a very small say 3-node graph A->C, B->C (i.e., node B is zeroOutgoing) to verify the exact pagerank values in the test?",271990099,2015-06-18 03:29:07
8040803,2913263,32727955,21,I have a question--this could be a design choice or a bug and want to know which one it is.  Lets take `TestGraphs.dangling_g7_in` as an example which is a graph with many zeroOutgoing nodes and only stores the in bound direction.  NodeId 2 has two inboun,271990099,2015-06-18 18:18:04
8040803,196885,32789822,21,"This is correct. outboundCount is 0 because there are no outboundnodes in the graph that only stores the in direction. For a graph which _only_ stores the 'in' direction (i.e., not the out direction as well), we would need to calculate explicitly outbound",271990099,2015-06-19 04:31:57
8040803,2913263,32948046,21,"So that is why I check isInStored here.  Basically, I don't need to build the outboundCount array if the graph is out stored or both stored since that attribute is stored at the node level.  I only need to build that array if it is in stored (which is an ",271990099,2015-06-22 20:38:23
8162838,196885,33330795,20,"instead of adding this file as well as a new graph, can we add a test?",274488015,2015-06-26 11:11:30
8162838,196885,33330807,9,ooh -- the bug was wrong loop variables... nice catch.,274488015,2015-06-26 11:11:52
8162838,2326839,33428920,20,"Added test, maybe we can leave this file as an example if we already have it?",274488015,2015-06-29 05:22:27
8396863,196885,34820645,1,ditto,279848236,2015-07-16 23:25:28
8396863,196885,34821063,5,please update comments as well,279848236,2015-07-16 23:29:01
8396863,196885,34821906,23,remove the TODO -- either leave it like this or change it,279848236,2015-07-16 23:35:28
8396863,196885,34821932,31,delete extra line,279848236,2015-07-16 23:35:37
8396863,196885,34822764,82,add extra line,279848236,2015-07-16 23:42:09
8396863,196885,34821106,15,delete extra line,279848236,2015-07-16 23:29:28
8396863,196885,34823990,23,"there is a lot of duplication of code here because of the various cases to cover. Would be better to not instantiate named traits but classes with different variables e.g., class Graph(fileName: String, sortNeighbors, removeDuplicates) and then do the sam",279848236,2015-07-16 23:52:44
8396863,1369013,34890260,23,That's right. I am aware of it it but wanted to make sure the approach is correct. I will keep separate tests but reduce traits. ,279848236,2015-07-17 18:48:57
8396863,196885,34820636,1,"is ""a-{c..."" this a minor typo and you intended ""a->{c...""",279848236,2015-07-16 23:25:21
8396863,196885,34820810,7,prefer the spelling sortNeighbors to be consistent with the rest of the code,279848236,2015-07-16 23:26:45
8396863,196885,35131324,118,minor: please be consistent regarding empty lines,280411100,2015-07-21 22:44:17
8396863,1369013,35177373,118,Frankly speaking I tried :-) I kept one empty line when the graph/reader changes and no empty lines for different tests of the same graph. ,280411100,2015-07-22 07:54:44
8517812,196885,35134555,8,"unique should be a property of the graph, not each node",280627208,2015-07-21 23:10:46
8517812,196885,35136143,49,"if leftNode and rightNodes are explicitly specified, the function isLeftNode is not useful to also specify. So I would not have this extra isLeftNode parameter.

Adding 'unique' here in the constructor of the graph makes sense -- let's call it nodeIdsUn",280627208,2015-07-21 23:24:16
8517812,196885,35137379,49,"This also means that is unique is false, new leftNodes and rightNodes will need to be constructed with the correct ids. I don't see a way around that.",280627208,2015-07-21 23:34:10
8517812,196885,39926903,59,"try to be consistent -- sometimes it is ""IDS"", ""Ids"", ""ids"" etc.",315222743,2015-09-20 10:44:34
8517812,196885,39926921,71,delete this convenience constructor once you have added the next constructor,315222743,2015-09-20 10:48:41
8517812,196885,39926953,125,"refactor this code segment into a convenience method, as the same code is used 4 times below.

if (id < arr.length && arr(id) != null) Some(arr(id)) else None",315222743,2015-09-20 10:56:41
8517812,196885,39926938,121,"this should be before any other code here, as id==0 is also possible in the other case",315222743,2015-09-20 10:53:28
8517812,196885,39926898,27,s/IDS/ids,315222743,2015-09-20 10:43:27
8517812,196885,39926871,8,"consider not using vars. In fact no point using intermediate variables inBounds and outBounds. Just directly use as in new LeftNode(2, Array(...), Array(...))",315222743,2015-09-20 10:40:56
8517812,196885,39927058,88,"creation of new left and right nodes is actually pretty expensive in both space and time. Space is doubled as two new arrays have been created, also each edge is being touched to negate the inbound and outbound nodes... So, I'd suggest adding a comment th",315222743,2015-09-20 11:12:37
8517812,2067916,39927931,121,Do you mean id can be 0 when nodes are unique in the whole graph?,315222743,2015-09-20 13:43:30
8517812,2067916,39928021,88,"I agree that nodeIdsUnique should be true & it should be the default value.

But, my intention of keeping default value to false was that it doesn't break the existing code even after upgrading to this new version of cassovary. Should we remove the defa",315222743,2015-09-20 13:57:10
8517812,2067916,39927934,8,Will do this for previous test graph too.,315222743,2015-09-20 13:43:54
8517812,2067916,39928220,71,"Scala allows only one constructor to have default values. So, we need both these constructors so that it doesn't break existing tests. Again, should we remove the default value completely as I said below and change tests?",315222743,2015-09-20 14:27:59
8517812,196885,39941046,88,"Let's keep the default, but change it to true. We will upgrade the library version appropriately on next publish.",315222743,2015-09-21 09:19:55
8931821,3780794,37708592,29,Todo in next commit: `map` here should be `foreach`,299513086,2015-08-23 22:32:27
9162771,3780794,39331759,12,"I should probably rename this, but I'm not sure to what.",299325440,2015-09-12 06:14:11
9162771,3780794,39331752,1,I should add a copyright statement.,299325440,2015-09-12 06:13:47
9162771,196885,39565626,3,style comment: 4 or more imports -- just use java.io._,299325440,2015-09-16 02:09:50
9162771,196885,39565721,3,also imports in alphabetical order,299325440,2015-09-16 02:10:08
9162771,196885,39565868,12,"some lines are too long, like this one. Might be good to limit the line size to 100",299325440,2015-09-16 02:11:16
9162771,196885,39565897,10,may be also say that nodes are constructed on demand,299325440,2015-09-16 02:11:30
9162771,196885,39566410,18,"Seems trivial to extend it to other cases (not suggesting you do it in this PR itself), or do you see any issue?",299325440,2015-09-16 02:15:48
9162771,196885,39566750,24,Suggest making both these fields as 8B long -- then your format is completely future proof.,299325440,2015-09-16 02:18:29
9162771,196885,39567000,29,"Because of the Long offsets, the out-neighbor data and in-neighbor data can be arbitrarily mixed as long as all neighbors of one direction are together for one node. You might want to point that out.
",299325440,2015-09-16 02:20:35
9162771,196885,39568458,12,"s/array/sequence

name is fine",299325440,2015-09-16 02:33:05
9162771,196885,39570405,29,"Ahh, you need them together for quick degree calculation...",299325440,2015-09-16 02:51:10
9162771,196885,39570755,31,why not 2^31 ?,299325440,2015-09-16 02:54:41
9162771,196885,39570799,45,no need for 'override' keywords,299325440,2015-09-16 02:55:09
9162771,196885,39570886,35,don't need keyword 'override' here and below,299325440,2015-09-16 02:55:54
9162771,196885,39572056,68,s/def/lazy val/ -- then it will be computed once and reused,299325440,2015-09-16 03:07:43
9162771,196885,39572483,70,consider just deleting this method for now,299325440,2015-09-16 03:12:19
9162771,196885,39575913,114,this and the main() can not be in cassovary-core as it is a library. Ideally should be in cassovary-benchmarks. I suggest you move to cassovary-examples for now and I can refactor it later.,299325440,2015-09-16 03:49:57
9162771,2326839,39782037,27,would be nice to specify explicitly that out-neighbor data is sorted by node id and A[i + 1] - A[i] is the outdegree.,299325440,2015-09-17 23:33:36
9162771,2326839,39782590,19,space before correctly,299325440,2015-09-17 23:38:06
9162771,2326839,39782621,33,I believe you don't need the spaces here.,299325440,2015-09-17 23:38:27
9162771,2326839,39782879,153,no newline,299325440,2015-09-17 23:41:10
9162771,3780794,39903579,12,Sounds good.,299325440,2015-09-19 02:34:37
9162771,3780794,39903836,3,"OK, done.",299325440,2015-09-19 02:38:10
9162771,3780794,39910841,12,Sounds good.,299325440,2015-09-19 04:30:04
9162771,3780794,39910956,10,Sounds good.,299325440,2015-09-19 04:32:27
9162771,3780794,39911049,18,"It should be trivial.  That's one use case I'm planning for the first 4 bytes (to indicate  if in-neighbors are stored or not).  To limit scope of this PR, I just chose both in and out neighbors, and a future PR (by me or someone else) can easily add othe",299325440,2015-09-19 04:34:29
9162771,3780794,39911218,24,"You mean have both 8 bytes reserved and 8 bytes for nodeCount?  That sounds fine, but I'm curious what the motivation is.  Are you considering switching to 64 bit node ids in the future?

I'm thinking of the first 4 bytes as a format version number, so ",299325440,2015-09-19 04:38:42
9162771,3780794,39911248,29,Right.  I expanded the documentation here to state that degrees are computed based on offset i+1 minus offset i.,299325440,2015-09-19 04:39:31
9162771,3780794,39911361,31,"2^30 felt like a nicer round number :)
I was also slightly concerned about the fact that 2^31 isn't an int.
Thinking about it now, I think 2^31 would work fine, and it's slightly more efficient (half as many buffer objects), so 2^31 sounds good.",299325440,2015-09-19 04:42:03
9162771,3780794,39911811,31,"Actually, I just tried 2^31, and FileChannel requires size at most Integer.MAX_VALUE and throws an exception given size 2^31, so we can't actually have a buffer of size 2^31.  This is a strange API decision in Java.  I'll stick with 2^30.",299325440,2015-09-19 04:53:52
9162771,3780794,39912169,45,"I agree it isn't needed.  This comes up in other places, so I need to learn: what is the style guideline for override?  Should we only use it when overriding an implementation of a method? Is there a reason to not use it whenever overriding? 

This Stac",299325440,2015-09-19 05:01:54
9162771,3780794,39912316,68,Sounds good.,299325440,2015-09-19 05:06:06
9162771,3780794,39912588,70,"I don't want to forget about this, though, because right now I think calling maxNodeId will silently create millions of Node objects.  Is it OK if I leave this, and make a PR to make maxNodeId a method soon? I also need maxNodeId to be a method for the dy",299325440,2015-09-19 05:12:53
9162771,3780794,39912756,114,Sounds good,299325440,2015-09-19 05:18:22
9162771,3780794,39912767,27,Sounds good.,299325440,2015-09-19 05:18:36
9162771,3780794,39912849,33,Sounds good.,299325440,2015-09-19 05:20:50
9162771,3780794,39912852,19,Sounds good.,299325440,2015-09-19 05:20:57
9162771,3780794,39912926,153,Sounds good.,299325440,2015-09-19 05:23:40
9162771,196885,39916503,1,I'd suggest removing the copyright statement altogether -- that's what I am doing for any files that are new altogether.,299325440,2015-09-19 10:20:50
9162771,196885,39916469,24,"Correct. 8B for nodeCount allows >2B nodes / Long node ids, something which is being worked on by @szymonm ",299325440,2015-09-19 10:15:09
9162771,196885,39916480,31,Interesting -- please add this finding to your comments there,299325440,2015-09-19 10:16:31
9162771,196885,39916507,24,"Also, having things multiple of 8 is generally nice which it is in your format until the start if the out-neighbor data..",299325440,2015-09-19 10:21:48
9162771,3780794,40123149,31,Sounds good.,299325440,2015-09-22 23:19:33
9162771,3780794,40123115,24,"OK, it's fine to use 8 bytes.  To fully support 8 byte nodeIds we would need to change the size of the neighbor arrays to 8 bytes per node, and probably add some compression since most of the high order bits will be 0.",299325440,2015-09-22 23:19:16
9313548,196885,39577810,27,shouldn't need 'override' keyword here.,306593782,2015-09-16 04:15:49
9313548,196885,39580461,35,"Just to keep in mind that every access of a neighbor (e.g., every random access) will create a new class as well. If we change this to a lazy val, new updates will never be reflected -- so not sure how to solve this or if it matters?",306593782,2015-09-16 04:52:19
9313548,196885,39580935,58,"how about that this just extends IndexedSeq, and have apply(idx) uses intArray(idx).

btw, also see java.util.concurrent.atomic.AtomicReference ",306593782,2015-09-16 04:59:57
9313548,196885,39581136,47,"ref: might want to use Futures as in SynchronizedDynamicGraphSpec, it might be easier",306593782,2015-09-16 05:02:47
9313548,3780794,40140744,47,"I remember starting to use futures for this based on SynchronizedDynamicGraphSpec, but there was some reason they were either more awkward than threads, or I felt it was harder to actually get concurrent execution.  I think the threaded code is fairly cle",306593782,2015-09-23 01:38:23
9313548,3780794,40140761,1,Done,306593782,2015-09-23 01:38:29
9313548,3780794,40123513,27,"Right, now I know the style Cassovary is using for override.",306593782,2015-09-22 23:21:45
9313548,3780794,40124149,35,"Your suggestion below actually allows us to avoid object creation within `outboundNodes`, so this isn't an issue anymore.",306593782,2015-09-22 23:25:55
9313548,3780794,40126276,58,"Nice! I think that just works, and simplifies the design.  This also avoids the object creation cost you mention above.",306593782,2015-09-22 23:40:38
9313548,3780794,40126934,58,"Regarding AtomicReference, I considered it, but I don't think we need it here, because the assignments only happen inside a synchronized block.",306593782,2015-09-22 23:44:56
9313548,196885,40127074,1,please remove the copyright text altogether,306593782,2015-09-22 23:45:56
9444323,2326839,40528575,85,"the name is confusing, but I didn't come for a better one till now.",315913987,2015-09-28 13:37:07
9444323,196885,40810656,20,why AnyRef?,315913975,2015-09-30 20:42:46
9444323,196885,40811227,20,may be s/B/+B/ ?,315913975,2015-09-30 20:46:38
9444323,196885,40812693,186,do you need to specify the return type?,315913975,2015-09-30 20:57:30
9444323,196885,40810303,37,"like Map, perhaps change this to apply(), and leave get() as returning an Option[B] ?",315913975,2015-09-30 20:40:27
9444323,2326839,40823674,37,"If we wanted to return Option, we need to create our own specialized... This is possible, but I prefered to have implementation as fast as possible... 
There is also a problem with fastutil specialized maps and Option: they return predefined value (defau",315913975,2015-09-30 22:26:49
9444323,196885,40824889,37,We do not have to create specialized for Option. We can provide both apply() and get() and add the comment about boxing in Option() and let the user of Fastmap use whichever they want.,315913975,2015-09-30 22:36:16
9444323,196885,40827111,13,A couple more lines on the motivation for creating this will be helpful to the reader in the long term I think.,315913975,2015-09-30 22:53:38
9444323,196885,40829730,73,"make this extend FastMapFactory[FastMap] as this object really is a factory
where 
trait FastMapFactory[MapType[A,B] <: FastMap[A,B]] { def apply[@sp(...) A,@sp(...) B](): MapType }

Kind of like scala/collection/Map.scala and scala/collection/generic",315913975,2015-09-30 23:14:09
9444323,196885,40829755,85,why do you need both apply and applyFor ?,315913987,2015-09-30 23:14:23
9444323,196885,40830216,354,"To minimize duplication of code, can some of these implementations be done in trait FastMap given underlying ?",315913975,2015-09-30 23:17:34
9444323,196885,40830346,95,should these be objects instead of classes?,315913975,2015-09-30 23:18:25
9444323,196885,40830606,7,"Do you think we can just do FastMap as first step, then move to FastQueue in another PR. This PR is going to be big anyway.",315913975,2015-09-30 23:20:32
9444323,2326839,40842887,20,"should be B, not +B. Map[Int, String] is not a subtype of Map[Int, Any], because put(1, new Object()) is not valid for Map[Int, String].",315913975,2015-10-01 00:55:41
9444323,2326839,40843296,37,"My intention was to keep API minimal and give a user guarantee that all the methods are not boxed. If a user wants get with Option, he should use asScala and then he has all the scala's map methods. This separation seems clear to me and combining boxed an",315913975,2015-10-01 00:58:35
9444323,2326839,40843607,85,"In a simple case I create map using just: `FastMap[Int, Int]()`
But then we have a problem, when we need addTo or preserved insertion order... Then we need to specify also the returned map type and we have `FastMap.applyFor[Int, Int, Map[Int, Int] with A",315913987,2015-10-01 01:01:17
9444323,2326839,40844026,354,"It's not possible, because there is no common non-boxed superclass of Int2IntMap and Long2LongMap in fastutils. Thus, we cannot specify the type of underlying. Maybe we could do this with some weird casting, but I would rather avoid that --- I'm afraid th",315913975,2015-10-01 01:04:41
9444323,2326839,40844234,7,I wanted to avoid fastutils in all traversers code. For this we needed Queue too. Maybe we can leave Queue here and put rest in separate commits?,315913975,2015-10-01 01:06:37
9444323,2326839,40845901,354,"We can avoid duplication of size() and clear(), because they don't use generics (see use of JavaUtilMapWrapper) - I will fix that.",315913975,2015-10-01 01:21:18
9444323,196885,40854692,20,"Hmmm, scala.collection.Map defines [A,+B] ...
regardless, let's leave it as B for now to reduce our worries",315913975,2015-10-01 02:29:59
9444323,196885,40854716,37,Got it. ok,315913975,2015-10-01 02:30:12
9444323,196885,40854835,85,may be only applyFor then?,315913987,2015-10-01 02:31:02
9444323,196885,40855188,7,"yeah, whatever you can do to break it into steps will be great. We don't have to change it all in one go",315913975,2015-10-01 02:33:52
9444323,196885,40854891,354,cool.,315913975,2015-10-01 02:31:32
9444323,2326839,40880622,85,"If you don't think it's too complicated I'll go for: applyFor renamed to apply and apply to defautl.

The usage will be:
`FastMap.default[Int, Int]()`
and
`FastMap[Int, Int, FastMap[Int, Int]]()`",315913987,2015-10-01 10:39:53
9444323,2326839,40880831,20,"mutable.Map is [A, B].

If you do put(1, new Object()) on immutable.Map[Int, String] you get immutable.Map[Int, Object]",315913975,2015-10-01 10:44:40
9444323,2326839,40885208,73,"FastMapFactory that we have needs to be parametrized with types A and B for implicits. 

object FastMapFactory is not bound to this types. We could have sth like:
```
trait FastMapFactory[MapType[A, B] <: FastMap[A, B] forSome {type A} forSome {type B",315913975,2015-10-01 12:23:34
9444323,2326839,40890166,7,started #207 ,315913975,2015-10-01 13:36:33
9444323,2326839,43581577,95,objects can't be parametrized,315913975,2015-11-01 18:37:02
9455140,2326839,40501945,30,Did you checked what we gain by using fastIterator?,315913952,2015-09-27 11:10:55
9455140,2326839,40501953,5,We should have here outEdges: Array[Int] as well. But this id something for next commits. And let's wait for it until I finish my collections refactoring.,315913952,2015-09-27 11:12:24
9455140,196885,40522137,5,"ok, doing nothing now then.",315913952,2015-09-28 11:58:04
9455140,196885,40522130,30,"No, I didn't do any benchmarks but is recommended by documentation on fastutils.",315913952,2015-09-28 11:57:44
9630935,196885,40944922,5,"please remove this comment, we have generally not had authors in files",318617646,2015-10-01 22:57:41
9630935,196885,40948954,31,"let's continue to specialize only on Int and Long for now, rather than all primitives",318617646,2015-10-01 23:30:07
9630935,196885,40949273,11,with some primitive types,318617646,2015-10-01 23:32:38
9630935,196885,40950279,100,"trait FIFO extends CQueue, so just FIFO is sufficient here?",318617646,2015-10-01 23:40:51
9630935,196885,40950360,15,"oh, it depends on queue implementation I guess. Sorry. Might be worth adding a comment.",318617646,2015-10-01 23:41:35
9630935,196885,40950628,119,don't use the keyword 'override' where you don't need to,318617646,2015-10-01 23:43:44
9630935,196885,40950768,86,Minor style comment: feel free to remove empty lines for brevity.,318617646,2015-10-01 23:45:05
9630935,196885,40951562,26,may be change this to an abstract class so that you can directly instantiate it ? Or don't extend from CQueue,318617646,2015-10-01 23:51:47
9630935,196885,40949304,15,pls add comment on += being append,318617646,2015-10-01 23:32:54
9630935,196885,40949357,26,"this is prepend, right? may be add a comment?",318617646,2015-10-01 23:33:14
9630935,196885,40979657,40,will the compiler allow overloaded apply() to both naturalPriority() and priority() ?,318617646,2015-10-02 04:36:41
9630935,196885,40979760,69,s/CQueueAny/CQueueObj ?,318617646,2015-10-02 04:38:42
9630935,196885,40980180,101,"how about not having Option, but having two overloaded methods:
1. def priority()
2. def priority(order: Order[T])
Just makes it clearer and there is no duplication of code because you have the two cases of Some() and None coded anyway",318617646,2015-10-02 04:46:21
9630935,196885,40981222,29,"I think if this extends CQueueFactory, you can just delegate to it rather than using impls. Like how object Map extends MapFactory (in scala.collection.Map)",318617646,2015-10-02 05:04:01
9630935,196885,40981338,10,it's not that great to have to import Implicits._ everytime we have to use CQueue.... Any solution?,318617646,2015-10-02 05:05:52
9630935,196885,40981397,11,s/Fast/C everywhere,318617646,2015-10-02 05:06:51
9630935,196885,40981415,16,refactor common code in these test examples,318617646,2015-10-02 05:07:05
9630935,196885,40979574,13,+T ?,318617646,2015-10-02 04:35:10
9630935,2326839,40998649,26,"I don't really get what you mean. My thoughts are:
* We instantiate only in the companion object to get implicits working. 
* The only difference I know of between ABC and trait is that trait has no fields, so can be mixed in. Here, trait is ok since FI",318617646,2015-10-02 12:58:05
9630935,2326839,40998871,13,That would mean that Queue[Int] is a Queue[Any] - not true. Same here: http://www.scala-lang.org/api/current/index.html#scala.collection.mutable.Queue,318617646,2015-10-02 13:01:47
9630935,2326839,40998922,40,"No, tried this. It comlains that after type erasure methods are the same... The method names must be different. Maybe you have better ideas?",318617646,2015-10-02 13:02:44
9630935,2326839,40998968,69,"Any is a scala name for Object, but if you like Obj - can change it.",318617646,2015-10-02 13:03:27
9630935,2326839,40999082,101,The problem is we have to pass Order implicitly for 1. and then compiler complains about same method types after erasure.,318617646,2015-10-02 13:05:23
9630935,2326839,40999418,29,"Factories are bind to specific type. We need this type for implicits resolution --- to inject code depeneding on a generic type.

object CQueue is not bind to a specific type - just methods are parametrized.

Does this make sense?",318617646,2015-10-02 13:10:45
9630935,2326839,41005392,10,Done this.,318617646,2015-10-02 14:37:13
9630935,196885,41040984,69,no Any is fine too,318617646,2015-10-02 21:38:47
9630935,196885,41042093,48,"may be just define all those factory implicits here here so that there is no need for traits and object Implicits?
",319681930,2015-10-02 21:50:34
9630935,196885,41042173,26,"bad langauge on my part -- by ""directly instantiate"" I actually meant not having to use the more verbose ""CQueue with FIFO"" everywhere. ",318617646,2015-10-02 21:51:37
9630935,196885,41043642,40,"actually, priority() should not be there at all. Usually if there is a method with an implicit param, a caller can always specify an explicit param",318617646,2015-10-02 22:08:17
9630935,196885,41043687,29,ok,318617646,2015-10-02 22:08:42
9630935,2326839,41046716,48,"We need the traits for implicits precedense. Basically: if you can CQueue[Int]() you are matching both factories: CQueueFactory[T] called factoryAny from LowerPriorityImplicit and CQueueFactory[Int] called factoryInt from LowPriorityImplicit. 
Scala will",319681930,2015-10-02 22:37:40
9630935,196885,41048788,4,needed any more?,319681930,2015-10-02 22:57:33
9630935,196885,41051526,48,"btw, another alternative to implicits is using typeTags. not saying it is better, but something to consider:
A toy example to do something specific for Int:

import scala.reflect.runtime.universe._
class Q[T] { }
abstract class QFac[T] {def fifo(): Q",319681930,2015-10-02 23:22:36
9630935,2326839,41233199,48,"yes, this seems possible too, but TypeTag uses reflection that can be slower (if we ever care about creation time...)",319681930,2015-10-06 12:39:42
11860673,196885,52563833,5,pls add some comments for the reason of existence (brief summary of what we discussed I guess),379434242,2016-02-11 12:36:44
11860673,196885,52565189,82,separate into a different file,379434242,2016-02-11 13:18:42
11860673,196885,52672062,93,pls see http://docs.scala-lang.org/overviews/macros/implicits for perhaps using implicit macros to avoid this boilerplate between Int and Long ?,379434242,2016-02-12 05:44:15
11860673,2326839,59967006,82,"When using Macros this wasn't that easy. I needed CSeq, CSeqFactory and CSeqWrapper in the same file to be visible by the macro.",379434242,2016-04-16 19:36:13
11860673,196885,61178043,7,remove semicolons,428866182,2016-04-27 05:49:05
11860673,196885,61178641,8,may be refer to a benchmark file specifically comparing CSeq to IndexedSeq for ints / longs ?,428866182,2016-04-27 05:54:50
11860673,196885,65816447,15,good to know about JMH,435047494,2016-06-05 19:05:22
11860673,196885,65816509,70,any particular reason for this refactoring into main() ?,435047494,2016-06-05 19:10:28
11860673,196885,65816532,22,perhaps change the name to CSeqVsSeqIntBenchmark ?,435047494,2016-06-05 19:12:57
11860673,196885,65816539,10,s/convertion/conversion,435047494,2016-06-05 19:14:11
11860673,196885,65820049,106,can you please add a comment here that we are using macros to avoid boilerplate. Otherwise we need to write multiple instance definitions of CSeqFactory,435047494,2016-06-05 23:14:36
11860673,196885,65820121,111,just wondering why type names would be duplicated as className includes sym.toString ?,435047494,2016-06-05 23:18:17
11860673,196885,65820192,140,"do we need this extra class, or can we just make a function here to create a CSeq, i.e.,
def fromArray(underlying: Array[$sym]) = new CSeq[$sym] { ... }

and use fromArray below instead of $arrayWrapperName ?",435047494,2016-06-05 23:24:20
11860673,196885,65820218,140,It is okay either way btw from my side if you prefer to have a class and not directly created traits,435047494,2016-06-05 23:26:44
11860673,196885,65820259,42,s/array/cseq1 may be?,435047494,2016-06-05 23:31:04
11860673,196885,65820262,77,why a memory leak possibly?,435047494,2016-06-05 23:31:25
11860673,196885,65819664,77,"Please change comment to ""Companion object to CSeq. This object's apply methods should be used to create new `CSeq`s.""",435047494,2016-06-05 22:49:41
11860673,196885,65900227,25,"minor, but for the sake of consistency, space should not be before the colon, but after.",435047494,2016-06-06 21:32:49
11860673,196885,65900609,33,"perhaps just CSeq(arr) works?
",435047494,2016-06-06 21:34:51
11860673,196885,65904031,17,"don't need parentheses around 5, btw",435047494,2016-06-06 21:52:17
11860673,196885,65904182,50,may be test slice and foreach as well?,435047494,2016-06-06 21:52:59
11860673,196885,65904534,8,sort in alpha order,435047494,2016-06-06 21:54:57
11860673,196885,65905871,130,"do we need to check this you think, or underlying.apply() will check it anyway? (One problem with leaving it to underlying.apply() might be that the ArrayIndexOutOfBoundsException might give the wrong index...)",435047494,2016-06-06 22:00:47
11860673,196885,65907203,99,can we have a special implementation of intersect please for CSeqs? Leave this method around for when supplied nodeIds are of type Seq[Int],435047494,2016-06-06 22:06:46
11860673,196885,65907424,110,use CSeq's foreach ?,435047494,2016-06-06 22:08:00
11860673,196885,65909525,18,"for consistency, do not have CSeq[Int](outEdges) just CSeq(outEdges)",435047494,2016-06-06 22:19:12
11860673,196885,65910429,5,can we implement filter and map efficiently as well in CSeq?,435047494,2016-06-06 22:23:39
11860673,196885,65910491,9,move up to the other imports,435047494,2016-06-06 22:23:57
11860673,196885,65910624,15,CSeq[Int](inEdges) ?,435047494,2016-06-06 22:24:33
11860673,196885,65911467,11,change CassovaryLibraryVersion to 7.0.0,435047494,2016-06-06 22:28:58
11860673,2326839,67017375,70,"Sbt JMH plugin gets crazy and fails just after start when using App trait, because of using DelayedInit.",435047494,2016-06-15 00:30:29
11860673,2326839,67017504,22,done.,435047494,2016-06-15 00:31:12
11860673,2326839,67017575,10,done.,435047494,2016-06-15 00:31:36
11860673,2326839,67017764,77,done.,435047494,2016-06-15 00:32:30
11860673,2326839,67018628,111,"Don't know exactly why, but the macro code is called whenever we create CSeq[Int]. This seams to be normal in fundep materialization.",435047494,2016-06-15 00:37:04
11860673,2326839,67024892,140,"In this case we must create this class anonymously in 3 places: ofDim, empty and fromArray, which can be confusing.

Let me leave it this way.",435047494,2016-06-15 01:09:59
11860673,2326839,67025059,42,right,435047494,2016-06-15 01:10:52
11860673,2326839,67027321,77,"The CSeq we create in the next line is a slice of array defined in line 34 that has length: min(array.length, that.length). Cells from intersectionIdx to the end are wasted. 

Alternatively we can use ArrayBuffer from fastutils (that is not ready yet) o",435047494,2016-06-15 01:22:25
11860673,2326839,67027442,25,done.,435047494,2016-06-15 01:23:07
11860673,2326839,67027880,8,done.,435047494,2016-06-15 01:25:22
11860673,2326839,67027909,17,done.,435047494,2016-06-15 01:25:32
11860673,2326839,67028605,130,"Yes, and I don't want to allow a slice read/write outside it's scope.",435047494,2016-06-15 01:28:52
11860673,2326839,67028902,99,I don't think I understood. Why would we need intersect for Seq[Int] now as it's protected and we want to use CSeq inside cassovary.,435047494,2016-06-15 01:30:15
11860673,2326839,67034611,110,"sure, done.",435047494,2016-06-15 01:58:31
11860673,2326839,67035770,5,"Not really
1) filter
As we don't have ArrayBuffer, we would have to copy filtered elements at least twice.
2) map
if we wanted CSeq[Int].map[T](f: Int => T): CSeq[T]
  If we don't have CSeq[T] that is efficiently implemented we loose the efficiency.",435047494,2016-06-15 02:04:51
11860673,2326839,67035881,5,what do you think?,435047494,2016-06-15 02:05:33
11860673,2326839,67035970,9,done.,435047494,2016-06-15 02:06:05
11860673,2326839,67036235,15,Can you explain a bit more?,435047494,2016-06-15 02:07:53
11860673,2326839,67036417,18,done,435047494,2016-06-15 02:08:57
11860673,196885,67562638,111,is that only in 2.10? so we are creating a new class for every time we create CSeq?,435047494,2016-06-18 02:25:10
11860673,196885,67562662,140,sure,435047494,2016-06-18 02:25:22
11860673,196885,67562968,77,probably copy to new array (also add a comment about this tradeoff / memory leak),435047494,2016-06-18 02:27:36
11860673,196885,67563179,99,"I meant implement intersect for CSeq not using conversion to Seq, but write new code for native intersection of CSeqs.",435047494,2016-06-18 02:29:34
11860673,196885,67563718,5,"1. filter: dunno which will be more expensive: (a) converting to Seq, or (b) counting the number of filtered items and then allocating an array for it and putting the items in.
2. (A) If `CSeq[T]` is efficiently implemented (Int or Long), will it be okay",435047494,2016-06-18 02:33:50
11860673,196885,67563796,15,don't remember now. please ignore...,435047494,2016-06-18 02:34:28
11860673,2326839,73784969,106,Done.,435047494,2016-08-06 18:35:49
11860673,2326839,73785015,111,"As far as I know, but I don't understand the macros very deeply.",435047494,2016-08-06 18:40:13
11860673,2326839,73785011,111,It happens in both 2.10 and 2.11. We are create a class (in compile time) for every time CSeq is created.,435047494,2016-08-06 18:39:41
11860673,2326839,73785081,77,Done.,435047494,2016-08-06 18:47:51
11860673,2326839,73785109,33,Done.,435047494,2016-08-06 18:50:31
11860673,2326839,73785847,50,done,435047494,2016-08-06 20:08:30
11860673,2326839,73785877,99,"To do this efficiently, we need specialized Map[T, Int]. Let's leave it for now.",435047494,2016-08-06 20:11:37
11860673,2326839,73785954,5,"1. That depends on the filter function itself I think... 

Both possible, but how about leaving it for a separate issue?",435047494,2016-08-06 20:16:22
11860673,196885,74084184,111,Can you verify that this class is not being created at runtime as well every time CSeq is created.,435047494,2016-08-09 22:41:16
11860673,196885,74084340,99,ok,435047494,2016-08-09 22:42:05
11860673,196885,74084463,5,sure,435047494,2016-08-09 22:42:44
16489209,196885,76089738,6,"good catch. To make it more readable, can you change the name 'maxId' to 'edgesMaxId'",498921421,2016-08-24 23:21:02
16498161,196885,76091214,19,Rest looks good but did it not run for you with 1100MB memory?,499095330,2016-08-24 23:29:49
16498161,5854688,76107004,19,"I thought it didn't (saw memory problem). I just tried few more times with 1100M, and they were all successful. So I modified it back to 1100M. Thanks.",499095330,2016-08-25 00:58:16
18023729,196885,84093664,5,I think you want the default values to be true for both dirOutFlag and dirInFlag so that graphDir = BothInOut by default ,537427597,2016-10-19 22:12:53
18023729,196885,84094368,4,"to maintain alphabetic order of the imports, please put these new imports above scala.io.Source",537427597,2016-10-19 22:15:56
18023729,196885,84099225,32,this is replicated code from FileReader. It was already there before your changes but now this extra code is making it worse. Can we instantiate a FileReader just like we instantiate TwoTsFileReader in ListOfEdgesGraphReader?,537427597,2016-10-19 22:36:13
18023729,196885,84094542,13,delete empty line,537427597,2016-10-19 22:16:38
18023729,196885,85658639,21,"Instead of having ""Any"", you should change it (T, Option[Int]) -- where T is either the source or dest id and ""Int"" represents the count of adjacency.

Also please add a comment about this.",540572592,2016-10-30 19:12:46
611285,44018,2324938,67,"Maybe silly, but I would move the duplicate PRIMEs out to `PRIME_INT` and `PRIME_LONG` and reuse them vs copy.",21526325,2012-12-06 01:50:52
611285,7111,2337546,67,"There are lots of PRIMEs obviously. What should we name them? I don't like PRIME_INT because someone may want a different prime (for whatever reason) later, and then we are on to PRIME_INT_A, etc...

How about FNV1_PRIME_INT?",21526325,2012-12-06 23:55:55
611285,44018,2351248,67,"sorry, just meant the particular two primes that are written out twice should be bound to vals to prevent the dup. This is a ""magic string!"" comment :8ball: 

```scala
val DEFAULT_PRIME_INT: Int = 16777619
```

then inside,

```scala
val PRIME: I",21526325,2012-12-08 00:39:09
611285,64320,2374502,9,"consistent style:  (believe me, I wish there was a good automated tool for this)

```scala
trait Hashtable[-T, +R] extends (T => R) { self =>
```",21526325,2012-12-11 13:11:28
611285,64320,2374528,34,"I wonder if it'd be better/safer to xor in the two halves

```scala
(l>>32).toInt ^ l.toInt
```

masking seems a bit dangerous to me since we're throwing away information (?). eg. if for some reason the longs are purely working in the upper 32 bits,",21526325,2012-12-11 13:18:23
611285,64320,2374538,67,I'd say keep them inside the definitions. That way they're self-contained; the primes are part of the definition of the hashing algorithms. Their coincidence needn't be encoded.,21526325,2012-12-11 13:20:59
611285,64320,2374549,9,"The formatting style we keep is documented here:

  http://twitter.github.com/effectivescala/#Formatting

(should be consistent with the surrounding code)",21526325,2012-12-11 13:22:58
913674,64320,2637925,8,this import is redundant.,26780691,2013-01-15 00:50:54
913674,64320,2638177,45,looks like this remove was anyway redundant?,26780691,2013-01-15 01:04:39
913674,64320,2638938,45,it looks like this *isn't* redundant. the executor service will not actually proactively remove the runnable from its queues if .remove isn't called,26780691,2013-01-15 01:48:35
913674,64320,2639854,45,"Given that `ScheduledThreadPoolExecutor` is the only implementation in the Java standard library of this, the simplest thing would be to just use that for the dependency instead, even if that's a bit icky. Some other alternatives are:

1. Some sort of m",26780691,2013-01-15 02:46:08
913674,61584,2641726,45,"FYI, jdk7 provides a method on ScheduledThreadPoolExecutor, setRemoveOnCancelPolicy(boolean), that properly handles cancellation. ",26780691,2013-01-15 04:42:05
948366,64320,2862146,4,Why remove sealed?,26925247,2013-02-02 00:25:02
948366,64320,2863414,4,Let's add back the sealed.,26925247,2013-02-02 01:55:41
948366,201926,2862731,4,"First reason is that the original `Stream` is not sealeded.

http://www.scala-lang.org/api/current/scala/collection/immutable/Stream.html

And second reason is that I was concerned the compiler issues an exhaustive warning in the below because of lack",26925247,2013-02-02 01:14:33
1287324,64320,3795883,5,Can you add a comment here explaining why this is done? (eg. pretty much what's in your commit message).,36693185,2013-04-15 20:33:22
1316507,64320,3795675,7,This is superfluous now: just give the timeout to Await.result.,37667895,2013-04-15 20:23:16
1703916,13840,5581616,31,this can be a `val` instead of a `var`,48072580,2013-08-05 20:38:32
3244180,132262,11518771,30,"our style is to use two spaces, not four.",96288784,2014-04-11 10:28:28
3244180,132262,11518778,29,The indentation seems wrong on this line.,96288784,2014-04-11 10:29:29
3244180,132262,11518781,35,indentation,96288784,2014-04-11 10:30:03
3244180,132262,11518796,51,Could you break this into two lines?  We try to restrict our maximum line length to 100.,96288784,2014-04-11 10:31:00
3244180,132262,11518812,77,The indentation here looks wrong.,96288784,2014-04-11 10:31:44
3244180,132262,11518831,81,Why is there confusion over what to do?,96288784,2014-04-11 10:33:40
3244180,132262,11518868,46,"This test seems identical to ""not report errors on success"" what's the difference?",96288784,2014-04-11 10:36:09
3244180,132262,11518889,20,Please just make this camel case.,96288784,2014-04-11 10:37:58
3244180,132262,11595189,107,"two spaces, not four.",103206061,2014-04-14 22:04:11
3244180,132262,11595207,63,"two spaces, not four",103206061,2014-04-14 22:04:35
3244180,132262,11595212,58,"two spaces, not four",103206061,2014-04-14 22:04:41
3244180,132262,13719644,21,"for one line, non-scaladoc comments, just use //",116019824,2014-06-12 23:56:30
3244180,1045702,13723048,21,"I used `/**` because the methods are protected, and therefore wanted the documentation to show up in any scaladoc as a reference. If you don't like it, could you please just remove them in the merge to save another round trip with this?",116019824,2014-06-13 01:02:21
3244180,132262,13725643,21,I commented on this line because it's not /**.  Should it be scaladoc?,116019824,2014-06-13 01:53:36
3244180,1045702,13726877,21,"Sorry, thought you meant the ones above it. Yes, it being private, should be `//`. Are you able to change as a part of the merge?",116019824,2014-06-13 02:14:56
3244180,132262,13728160,21,"Yep, we'll do it.  Thanks for clarifying!",116019824,2014-06-13 02:41:16
3598389,132262,12101661,47,do we still need this dependency?,106273788,2014-04-29 21:12:09
3598389,132262,12101709,59,is this bug fixed in 0.13.2?,106273788,2014-04-29 21:12:51
3598389,132262,12101895,4,what was the problem with doAfter?,106273788,2014-04-29 21:15:41
3598389,132262,12102147,10,ClassTag isn't 2.9.2 compatible.  Has ClassManifest been removed?,106273788,2014-04-29 21:19:55
3598389,132262,12102198,5,is parent a reserve word now?,106273788,2014-04-29 21:20:42
3598389,132262,12102215,6,ClassTag vs. ClassManifest again,106273788,2014-04-29 21:20:58
3598389,132262,12102439,4,"don't bother changing anything in util-eval, we're not going to support it.",106273788,2014-04-29 21:24:59
3598389,132262,12102516,5,revert this,106273788,2014-04-29 21:26:36
3598389,132262,12102522,14,revert this,106273788,2014-04-29 21:26:44
3598389,132262,12102611,5,is this 2.9.2 compatible?,106273788,2014-04-29 21:28:42
3598389,132262,12102665,135,maybe this test should be ignored?,106273788,2014-04-29 21:29:43
3598389,132262,12102675,157,is this 2.9.2 compatible?,106273788,2014-04-29 21:29:55
3598389,132262,12102682,5,2.9.2 compatible?,106273788,2014-04-29 21:30:04
3598389,132262,12102723,5,revert this,106273788,2014-04-29 21:30:53
3598389,132262,12103038,6,we still need 2.9.2 here.,106273788,2014-04-29 21:37:57
3598389,301,12134825,6,"Just to make sure: is it 2.9.2, or the latest in 2.9 series?",106273788,2014-04-30 14:20:16
3598389,301,12134831,47,Looks like we don't. Will remove.,106273788,2014-04-30 14:20:21
3598389,301,12134836,59,"From the description of the bug, I've got that this is the problem with specs. Now that we're not using it, I figured this could be removed. Also, `MonitorSpec` seems to be working just fine.",106273788,2014-04-30 14:20:25
3598389,301,12134843,4,I don't really know why I did this :) Will revert.,106273788,2014-04-30 14:20:41
3598389,301,12134851,10,"I think it should be there. So, we want to keep cross-compiling to 2.9? In that case, I'll need to make some changes to enable this (currently it is only cross-compiling to 2.10 and 2.11).",106273788,2014-04-30 14:20:57
3598389,301,12134855,5,"In 2.11 there seems to be an inheritance problem with it:
```
[error] /Users/georgii/workspace/util/util-core/src/main/scala/com/twitter/util/Promise.scala:36: ambiguous reference to overloaded definition,
[error] both value parent in class DetachableP",106273788,2014-04-30 14:21:02
3598389,301,12134861,6,Right.,106273788,2014-04-30 14:21:16
3598389,301,12134864,4,Alright.,106273788,2014-04-30 14:21:20
3598389,301,12134866,5,"Woah, missed.",106273788,2014-04-30 14:21:23
3598389,301,12134869,5,Most probably not. Will add 2.9 to cross-compiling targets and see what works for all versions.,106273788,2014-04-30 14:21:33
3598389,301,12134875,135,Agree.,106273788,2014-04-30 14:21:38
3598389,301,12134880,5,"Missed, will revert.",106273788,2014-04-30 14:21:45
3598389,301,12135042,6,2.9.2 it is.,106273788,2014-04-30 14:26:33
3598389,132262,12151377,6,"Yes, it's 2.9.2 specifically.  I'd be fine with also cross-compiling to 2.9.3, that shouldn't add any overhead, but people haven't exactly been clamoring for it.",106273788,2014-04-30 21:11:43
3598389,132262,12749350,5,hurk!  looks like scalatest dropped support for 2.9.2?  good thing we're moving off soon (finally),111047775,2014-05-16 22:13:48
3598389,132262,12749437,15,"whoa, this is very cool.",111047775,2014-05-16 22:15:50
3598389,132262,12749499,31,"can we move the _ % ""test"" just into the scalatest val?  also, I think we can just put scalatest into the Seq of libraryDependencies.",111047775,2014-05-16 22:17:16
3598389,132262,12749677,33,"maybe use ~= here?  it makes it explicit to sbt that this depends upon the value of libraryDependencies.

```
libraryDependencies ~= { dependencies =>
  libraryDependencies ++ CrossVersion.partialVersion(scalaVersion.value) match {
    case ... => Se",111047775,2014-05-16 22:21:57
3598389,132262,12749687,49,this is awesome ;),111047775,2014-05-16 22:22:11
3598389,1393975,12749845,5,"Prefer an alternate variable name then like ""underlying""",106273788,2014-05-16 22:25:50
3598389,132262,12749900,4,"It looks like this gives a deprecation warning now . . . it already gave a deprecation warning though, since we deprecated it.  Maybe keep the inheritance for now, but add a // TODO: delete in major version bump?",111047775,2014-05-16 22:27:31
3598389,132262,12750064,12,"These are so simple, could we make them FunSuite instead of WordSpec?  It'll make compilation faster.",111047775,2014-05-16 22:31:49
3598389,132262,12750275,1,"@bmdhacks I think this fails on 2.11, so we have to figure out what to do about it.",111047775,2014-05-16 22:36:50
3598389,1393975,12753676,1,Lemme look into it.  If it's an easy port we might just kick that can down the road.,111047775,2014-05-16 23:44:45
3598389,301,12767545,31,"I did this because all repos' tests depend on scalatest, but for `util-logging` it is a compile-time dependency because of `TestLogging.scala`.",111047775,2014-05-17 13:51:59
3598389,301,12767546,5,Agreed.,106273788,2014-05-17 13:52:13
3598389,301,12767558,33,"How about this:
```scala
    libraryDependencies ++= {
      CrossVersion.partialVersion(scalaVersion.value) match {
        case Some((2, scalaMajor)) if scalaMajor >= 11 =>
          Seq(
            ""org.scala-lang.modules"" %% ""scala-parser-combi",111047775,2014-05-17 14:02:03
3598389,132262,12769092,31,"ah, got it.",111047775,2014-05-17 20:34:06
3598389,132262,12769100,33,looks good,111047775,2014-05-17 20:35:27
3598389,1393975,12807159,23,I'm seeing problems with this syntax on older versions of scalatest and older versions of scala.  Can you change your usages of shouldEqual to assert(foo === bar) ?,113484947,2014-05-19 22:56:56
3598389,301,12952689,23,"Sure, done in https://github.com/folone/util/commit/140a54527c4b0bebdc052a8c995824e159f20366",113484947,2014-05-22 19:32:45
3864837,61365,13661367,15,"Let's name this test ""Event.register: no races between registered witnesses"".",124958265,2014-06-11 22:17:44
4478444,132262,16542738,5,"please don't bump the version number, thanks!",152725701,2014-08-21 19:41:42
4478444,132262,16542801,40,"this is a breaking change, let's at least continue to expose a constructor where you don't pass one in.",152725701,2014-08-21 19:42:41
4478444,132262,16542971,7,Maybe DefaultClassPathFinder is a more clear name?  Also maybe it makes more sense to just make it a top level object rather than a val in the companion object?,152725701,2014-08-21 19:44:49
4478444,132262,16543012,20,"instead, this should read:  (eval: Eval)",152725701,2014-08-21 19:45:36
4478444,132262,16543020,24,instead this should read: (eval: Eval),152725701,2014-08-21 19:45:45
4478444,132262,16543075,23,"let's use util-app flags instead of raw system properties, and let's also make this a top level object instead of a val in a companion object.",152725701,2014-08-21 19:46:37
4537660,132262,17121595,6,add parens for mutating no-arg methods,155269344,2014-09-04 20:43:18
4537660,132262,17121776,17,"Although narrowing a return type is kosher for source compatibility, it is unkosher for [binary compatibility][0].  We should probably either add another endpoint, or punt on this until we decide to do a major version bump.

[0]: http://docs.oracle.com/",155269344,2014-09-04 20:46:01
4537660,132262,17121790,7,scaladoc,155269344,2014-09-04 20:46:16
4537660,132262,17121891,8,"seems like this just repeats all of the arguments to BatchExecutor, how about we make the BatchExecutor something we pass in?",155269344,2014-09-04 20:47:53
4537660,132262,17121905,21,please add an explicit return type for all public methods,155269344,2014-09-04 20:48:08
4537660,132262,17122349,22,"since this is already synchronized in the BatchExecutor, not sure you have to do this too.",155269344,2014-09-04 20:54:43
4537660,132262,17122703,22,"Whoops, misread, looks like it's not synchronized in BatchExecutor.  Also, if we have a scheduled flusher, is this going to interfere with it?  Maybe we should make sure we have execute exactly once semantics for a flush for a given batch?",155269344,2014-09-04 20:59:12
4537660,461525,24317287,17,"So how do you want to proceed here?  I don't have any insight into how often you can or want to do major releases.  I'm happy to add another endpoint if that helps this get through faster, but overall I think returning a more full-featured object is the w",155269344,2015-02-09 16:49:21
4537660,461525,24319401,6,Done,155269344,2015-02-09 17:30:56
4537660,461525,24319407,7,Added,155269344,2015-02-09 17:31:07
4537660,461525,24319418,8,Good idea.  Done.,155269344,2015-02-09 17:31:17
4537660,461525,24319427,21,Done,155269344,2015-02-09 17:31:25
4537660,461525,24319532,22,"I wrote some more tests to verify these scenarios and make sure that regular execution, manual flushes, and timed flushes don't interfere with each other.  Please let me know if you think the test coverage is sufficient.",155269344,2015-02-09 17:33:39
4537660,132262,24323549,7,"This should be formatted like so:

```scala
/**
  * Provides ....
  * ...
  */
```",215828327,2015-02-09 19:00:04
4537660,132262,24323576,9,"rm the `@constructor` line, doesn't really add anything",215828327,2015-02-09 19:00:51
4537660,132262,24323591,10,rm this one too.  it's pretty obvious.,215828327,2015-02-09 19:01:12
4537660,132262,24323663,7,"As you mentioned before, `BatchExecutor` is an internal implementation detail, so when giving folks instructions in how to use `Batcher`, we shouldn't ask them to understand `BatchExecutor`.",215828327,2015-02-09 19:03:04
4537660,132262,24323699,12,We should make the constructor private[util] since folks outside of util won't have access to a `BatchExecutor` anyway.,215828327,2015-02-09 19:03:55
4537660,132262,24324035,24,this must be synchronized on the `BatchExecutor`.,215828327,2015-02-09 19:12:23
4537660,132262,24324264,19,don't reveal implementation details,215828327,2015-02-09 19:17:26
4537660,132262,24324347,22,"Testing for concurrency is very difficult, it's easier to just reason about the java memory model.  If we start running into big problems, we can go write some multithreaded tests to try to trigger the race condition, but it's fine for now to stick with s",155269344,2015-02-09 19:19:37
4537660,132262,24324447,20,add parens,215828327,2015-02-09 19:22:09
4537660,132262,24324453,34,add parens,215828327,2015-02-09 19:22:14
4537660,461525,24324454,7,"So passing the BatchExecutor as a constructor parameter was your idea to reduce the clutter of having to pass all of the BatchExecutor's constructor params through two consecutive constructor methods.  And no one's creating Batchers directly, they're gett",215828327,2015-02-09 19:22:14
4537660,132262,24324456,48,add parens,215828327,2015-02-09 19:22:20
4537660,132262,24324464,66,add parens,215828327,2015-02-09 19:22:28
4537660,132262,24324478,17,unused,215828327,2015-02-09 19:22:54
4537660,132262,24324503,7,this doesn't really belong in scaladoc.  Could you move it out into a `// TODO` comment?,215828327,2015-02-09 19:23:43
4537660,132262,24324522,3,"unused, as far as I can tell.",215828327,2015-02-09 19:24:10
4537660,132262,24324533,5,"unused, as far as I can tell.",215828327,2015-02-09 19:24:28
4537660,132262,24324832,7,"No, I think BatchExecutor as a parameter to the Batcher constructor is still a good idea, but Future.batched should be the only way to get a Batcher.  Let's make the constructor private[util]. :ship: ",215828327,2015-02-09 19:31:57
4537660,461525,24325046,7,"Future.scala has TODO: inside of scaladoc for its methods all over the place.  Maybe we should leave this this way for consistency?  If not, where in the file would you like to see it?  And formatted like this?:

```scala
// TODO: Possible future impro",215828327,2015-02-09 19:36:28
4537660,132262,24325851,7,"The only TODOs I could find in Future.scala were about future deprecation, which is actually probably of interest to the end-user.  My general philosophy is that TODOs that are about changing semantics are for librarians, so they should be in normal comme",215828327,2015-02-09 19:55:52
4537660,132262,24383822,4,"this class can't be private if we're exposing it as a return type for Future.batched.  can you just make the constructor private instead?  That would look like:

```scala
class Batcher[In, Out] private[util](...
```",215874285,2015-02-10 08:58:40
4537660,132262,24383922,9,"feel free to ignore:
Maybe also note that if apply makes it hit the batch size, it will automatically process the batch.

s/Future/[[com.twitter.util.Future]]",215874285,2015-02-10 09:01:27
4537660,461525,24395194,4,OK thanks will do.  Scala syntax often has me confused about where the physical delineation is in the code between the class and its constructor :),215874285,2015-02-10 15:15:04
4537660,461525,24395723,9,Done - comment look good to you?,215874285,2015-02-10 15:29:39
4537660,461525,24395767,9,"Also, you are speaking to me in regex here I guess?  You want me to fully qualify all my references to com.twitter.util.Future?  Or just the one on this line?  And only in comments or in comments and code?",215874285,2015-02-10 15:30:45
4537660,132262,24411647,9,"More I'm saying that if we wrap it in double square brackets then scaladoc will render it as an internal link.  It's not a huge deal, but it can be nice.  I'm OK with merging as-is.",215874285,2015-02-10 20:33:56
4537660,72999,24433550,8,Can we extend `In => Future[Out]` instead?,216344045,2015-02-11 00:55:32
4537660,199939,24433723,17,"We will run some test internally to see if it breaks anything.
If it doesn't, I think it's fine to take the binary incompatible change, just update the CHANGES file and explain the change.
This class is not widely used enough to require to wait for a ma",155269344,2015-02-11 00:57:24
4537660,461525,24482809,8,"I don't have a strong feeling about this.  I think the reason I went with Function1 was that I was having trouble getting it to compile the other way.  I've since found that I can get it to work only with parens:

```scala
) extends (In => Future[Out])",216344045,2015-02-11 16:43:32
4537660,193897,24534492,36,can you move the first verify (ln 334) above the flushBatch call? that would make the behavior clearer because as-is it looks like neither batch is dispatched until flushing.,216344045,2015-02-12 04:21:58
4537660,461525,24595415,36,done,216344045,2015-02-12 23:41:13
4537660,64314,24847155,17,"if there are guarantees regarding ordering and such, they should be documented. its not obvious from reading the diff why you synchronize on executor here.

and if there are guarantees, what prevents others callers from using the executor incorrectly?",217218514,2015-02-18 02:47:31
4537660,64314,24847191,3,"please omit ""clean, lightweight"" — I don't think they add any extra value here.",217218514,2015-02-18 02:48:00
4537660,64314,24847243,8,i think its more idiomatic as @vkostyukov wrote it.,216344045,2015-02-18 02:48:35
4537660,461525,24894139,3,Done,217218514,2015-02-18 18:14:17
4537660,461525,24894165,8,"Ok two votes for ```In => Future[Out]```, so I changed it.",216344045,2015-02-18 18:14:47
4537660,461525,24894813,17,"* I did not implement the BatchExecutor, but I make no assumptions about order of execution of the individual requests within a batch.  Since there is a one-to-one correlation between the requests I submit and the Futures returned, I as a client can at le",217218514,2015-02-18 18:27:11
4537660,64314,24920373,17,"thanks for the explanation, i'm new to BatchExecutor — that's a funky interface.

i think a comment in your code as to why you synchronize there would be quite helpful for future maintainers.
",217218514,2015-02-19 00:24:09
4537660,461525,24981615,17,"Here's how I decided to address this:

I moved the synchronization inside a new method in the BatchExecutor called .flushNow().  So, Batcher.flushBatch() just calls BatchExecutor.flushNow()

This is good IMO because:
* A person new to the code will f",217218514,2015-02-19 18:39:27
5802473,132262,22846655,7,sort imports,204454493,2015-01-13 14:36:04
5802473,132262,22846766,56,is it OK that these are just testing compilation?  we might stop running them and just compile them at some point in time.,204454493,2015-01-13 14:40:06
5802473,406208,22848954,8,"`@FunctionalInterface` is just a marker annotation, intended to inform the reader that the intention of the interface is to act as a SAM. With the Java 8 compiler, it also does some compile-time checks to ensure you can use the interface as a SAM (it shou",204454493,2015-01-13 15:41:14
5802473,406208,22849188,7,"Ok, I fixed it!",204454493,2015-01-13 15:47:17
5802473,406208,22849044,56,"I think that's how they already work - they are compiled but not run. I commented out the Java 8 part since the code needs to be able to be compiled with JDK 7. (But if you un-outcomment it, then it should compile.) I was asking on [stackoverflow](http://",204454493,2015-01-13 15:43:51
5802473,132262,22873414,24,"oh, I missed this before, but maybe camelcase these two for consistency?",204747725,2015-01-13 23:26:19
5802473,132262,22846742,8,is this even worth it given that we can't use FunctionalInterface?  Maybe it would make sense to publish a separate util-lambda target for now?,204454493,2015-01-13 14:39:05
5802473,406208,23018568,24,"Do you mean like ""exFunc"" and ""exCons""? We could certainly do that. It conforms to the java/scala naming conventions. My only concern is that the camel casing itself might (possibly) look a (tiny) bit noisier than the plain lowercased versions:

```java",204747725,2015-01-15 22:49:30
5802473,132262,23020966,24,"how about we compromise and have two versions of the methods, one long / explicit, and one short / obscure?  that's a common pattern in scala if you want to have a symbolic DSL.  like maybe,

exceptionalFunction / xf
function / fn
exceptionalConstant ",204747725,2015-01-15 23:17:18
5802473,199939,23028697,24,"Java conventions are usually pretty verbose compared to Scala, so I would agree with Moses here.",204747725,2015-01-16 00:57:03
5802473,406208,23164194,24,"Ok, I defined these methods:
exceptionalFunction / xf
function / f
exceptionalConsumer / xc
consumer / c

So, just ""f"" and ""c"".",204747725,2015-01-19 22:01:26
5802473,5437425,24434464,24,"I'd much prefer to have just one, simple, name for these. e.g., I liked `func`. (`fun` is also good.)
",204747725,2015-02-11 01:05:31
5802473,132262,24435731,24,"My argument for the short / DSL-y version is that for java users interoperating with scala, they'll probably use these methods all the time.  DSLs work well for those kinds of users.  On the other hand, for folks who only rarely need to use this lib, it's",204747725,2015-02-11 01:20:26
5802473,5437425,24959878,24,"
> On Feb 10, 2015, at 10:20 AM, Moses Nakamura <notifications@github.com> wrote:
> 
> In util-core/src/main/scala/com/twitter/util/Function.scala <https://github.com/twitter/util/pull/122#discussion_r24435731>:
> 
> > +  def func[T, R](f: JavaFunction[T,",204747725,2015-02-19 08:37:15
5802473,132262,24964961,24,"For exactly the same reason why the dispatch library now has explicit operators as well as symbolic ones.  Obscure names are OK for folks who use a library all the time, but just make code harder to read if you only use a library every once in a while.  W",204747725,2015-02-19 11:11:55
5802473,5437425,25033921,24,"I'm not sure that we should take design hints from dispatch. I really don't think that it's a good idea to introduce aliases without really good justification. I personally liked the original ones. (`func`, `exfunc`, `cons`.)",204747725,2015-02-20 05:42:08
5802473,132262,25050522,24,"OK, let's keep the original ones.  I'll make the change on my side.",204747725,2015-02-20 12:50:25
5966254,132262,23356541,13,"this doesn't act like a field, can you add parens?",209094751,2015-01-22 12:42:45
5966254,132262,23356556,18,why are 4 and 5 special?,209094751,2015-01-22 12:43:23
5966254,132262,23356574,6,"in general, we prefer JavaConverters to JavaConversions.  If you want to avoid the extra allocation, could you invoke it explicitly?",209094751,2015-01-22 12:44:17
5966254,132262,23356616,18,"oh, I see, zipped works for 2 and 3 but not above.  what a hassle.",209094751,2015-01-22 12:46:25
5966254,48777,23356643,18,If we ever wanna extend this to 22-ary functions (for example) I'd just write a Python script which generated all of the capturing and zipping functions :-),209094751,2015-01-22 12:48:02
5966254,48777,23356646,18,Or maybe macros would work? Not sure what constraints we have on stuff like that though.,209094751,2015-01-22 12:48:16
5966254,132262,23356662,62,"could you include the script you wrote to generate these, in case we ever want to extend this or modify it ever?  ditto for capturingOne.",209094751,2015-01-22 12:49:04
5966254,48777,23356686,62,I wrote these by hand…haha,209094751,2015-01-22 12:49:51
5966254,48777,23356698,62,I could totally write a script though. Where would that live?,209094751,2015-01-22 12:50:17
5966254,132262,23356747,62,"for Future#join we did it like this: https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/util/Future.scala#L172

Although for 5 it's probably OK to omit it, not a huge deal.",209094751,2015-01-22 12:52:24
5966254,132262,23356756,18,"Yeah, I heard that pants is weird about macros?  Not sure whether that's apocryphal or not.  This is probably fine for now.",209094751,2015-01-22 12:53:08
5966254,48777,23358345,62,"I wrote a script in Python to generate up to arities of 22, and everything works, but I'm not sure if it's small enough to put in the comments. I'll give it a go.",209094751,2015-01-22 14:04:26
5966254,72999,23964696,62,Why is called `capturing` rather then `capture`? The same question is about `capturingOne`.,209094751,2015-02-03 05:22:58
5966254,48777,23965101,62,"I was going with the same vibe as Ruby's `returning`; it runs the block it's given and returns some output based on the block. In English I parse the code as 'capturing one [argument call], verify that obj.someMethod was called'",209094751,2015-02-03 05:28:17
5966254,72999,23965285,62,Thanks for the explanation! Sounds reasonable to me.,209094751,2015-02-03 05:30:26
6274283,132262,24711940,25,"prefer Future.value, which doesn't require allocating an extra closure, especially if you're already in a try/catch block.",217787536,2015-02-14 11:06:54
6274283,132262,24711941,27,ditto,217787536,2015-02-14 11:07:10
6274283,132262,24711942,29,ditto,217787536,2015-02-14 11:07:17
6274283,132262,24712015,36,"this doesn't really test what we care about, right?  which is that acquire shouldn't fail just because you have a node that doesn't exist.",217787536,2015-02-14 11:20:01
6274283,132262,24712023,4,"instead of using this, we can just widen the scope of numPermitsOf to `private[coordination]`, I think that's simpler.  Do you have a strong preference for using PrivateMethodTester?",217787536,2015-02-14 11:21:03
6274283,132262,24712030,29,could you add a comment which explains why this might happen?,217787536,2015-02-14 11:21:59
6274283,198588,25831912,23,Is data ever not ZNode.Data?,217787536,2015-03-05 08:18:10
8168871,132262,33374661,18,do you mind if we call this `ceil` for consistency with scala.util.math?,275034835,2015-06-26 22:04:38
8168871,132262,33374875,33,"while we're in here, can we rename x to something better?",275034835,2015-06-26 22:07:08
8168871,132262,33375032,4,the names of these arguments should be more descriptive,275034835,2015-06-26 22:09:15
8168871,132262,33374716,18,instead of `x` is there a more descriptive word?,275034835,2015-06-26 22:05:21
8168871,132262,33375545,40,"no need for === anymore, scalatest 2.x supplied an assert macro which unpacks failures very neatly even when we use regular old ==.",275034835,2015-06-26 22:15:27
8168871,132262,33375642,39,"feel free to ignore:
I think this is a tiny bit more readable if you use 60.seconds helpers rather than fromSeconds, but it's not a big deal (and fromSeconds will actually make it compile faster, so there's definitely an argument the other way too).",275034835,2015-06-26 22:16:49
8168871,132262,33375788,16,"feel free to ignore:
for symmetry, keep this 1.hour too?  no reason for people who are next looking at this test to wonder, ""why is one 1.hour and the other 1.second?"" when, as far as I know, there isn't a reason.",275034835,2015-06-26 22:18:12
8168871,511384,33378319,4,"Done (I copied increment, not sure it's the best, but I didn't have anything better).",275034835,2015-06-26 22:47:02
8168871,511384,33378333,18,Done.,275034835,2015-06-26 22:47:10
8168871,132262,33389248,6,can we call these increment too?,275336539,2015-06-27 00:45:32
8168871,132262,33389496,20,"sorry to be anal about this, but slow libs are often slow because of death by a thousand cuts.  `1.nanoseconds` adds an allocation, can we val this up?",275336539,2015-06-27 00:48:47
8168871,132262,33389525,41,can we make these arguments increment?,275336539,2015-06-27 00:49:09
8168871,132262,33389725,20,"feel free to ignore:
I think we can also avoid an allocation by checking if this.floor(increment) == this, and only adding increment if they're different.  If you think it decreases readability though, the allocation might be worth it.",275336539,2015-06-27 00:51:58
8168871,511384,33390538,20,"Agree about the spurious allocation. I guess taking the diff will also generate a fresh object before applying the floor (jit malarky aside). I think the if check probably ends up being more readable, because all the comment is talking about is a trick to",275336539,2015-06-27 01:02:29
8168871,72999,33394371,6,Perhaps adding the same test for `TimeCompilationTest`?,275388931,2015-06-27 01:47:28
9133448,132262,38949689,7,"ffti: the style is now to avoid infix except for symbolic operators, so this should be `first.map(_ => 2)`",307192532,2015-09-08 21:50:22
9133448,132262,38949845,8,ffti: this might be simpler to reason about if we use different vals instead of a var.,307192532,2015-09-08 21:51:34
9825260,7111,48983269,22,+1 to not using the name sequence. What about `sequentially`?,369083718,2016-01-07 01:21:41
9825260,1925,49029410,4,sequentally => sequentially,369131135,2016-01-07 08:33:00
9825260,1925,49029412,13,traverseSequentally => traverseSequentially,369131135,2016-01-07 08:33:03
9825260,193897,49159887,17,let's use `Future.value` since `Vector.empty` won't throw outside of pathological cases were our vm is already doomed.,369262225,2016-01-08 13:44:06
9825260,193897,49159995,4,backticks on `f` please,369262225,2016-01-08 13:46:16
9825260,198588,49164110,17,Future.Nil can work too and saves an allocation.,369262225,2016-01-08 15:33:47
9825260,193897,49164397,17,I think the best we can do is stash a singleton Future.value(Vector.empty) in the companion,369262225,2016-01-08 15:40:33
9825260,198588,49164487,17,:+1: works for me,369262225,2016-01-08 15:42:54
9825260,325487,49166599,17,"so like this?
 private val FutureEmptyVector: Future[Vector[Nothing]] = Future.value(Vector.empty)
 ...
 as.foldLeft(FutureEmptyVector.asInstanceOf[Future[Vector[B]]]) { (resultsFuture, nextItem) =>
",369262225,2016-01-08 16:26:38
9825260,193897,49168301,17,"I'm not convinced that the shaved allocation is worth any extra lines of code so I'm still happy with the inline Vector.empty, but your call. If you go the shaving route, we should be able to drop the cast by adding the type param to the foldleft though.",369262225,2016-01-08 16:54:08
9825260,1925,41729965,22,"I'm not a fan of calling this ```sequence``` because ```sequence``` is typically understood to transform an ```M[Future[A]]``` to a ```Future[M[A]]```. For example, see ```Future.sequence``` in the Scala standard lib. http://www.scala-lang.org/api/current",369083718,2015-10-12 14:29:59
10272075,64314,43908009,23,"mind keeping the ordering the same as the method's? in other words, just move formatter right before level.",341089848,2015-11-05 00:05:30
10368605,72999,44362300,479,"How about `Embed`? I don't have a good theory why it should be `Embed`, but it sounds kinda good here.",343633018,2015-11-10 09:04:17
10368605,198588,44366011,479,Ok I like this. M for embed.,343633018,2015-11-10 10:09:16
10368605,193897,44372325,214,ditto,343633018,2015-11-10 12:52:37
10368605,193897,44372217,103,nit: please swap the parens for curlies in map's closure M(fa.map(a => if (p(a)) this else empty)),343633018,2015-11-10 12:49:31
10368605,193897,44372240,124,same,343633018,2015-11-10 12:50:05
10368605,198588,44372746,103,"You mean like `M(fa.map { a => if (p(a)) this else empty })`? Oh I see, it could help differentiate the M parens and the map closure...",343633018,2015-11-10 13:02:58
10368605,198588,44373204,479,"So if we look at the type signature `Future[AsyncStream[A]] => AsyncStream[A]`, it's really a lift (`Future[A] => AsyncStream[A]`) and then a flatten (`AsyncStream[AsyncStream[A]] => AsyncStream[A]`).

This doesn't mean I'm suggesting we call this `flat",343633018,2015-11-10 13:14:27
10368605,193897,44375722,14,why not use #fromSeq in AsyncStream's companion object?,343633000,2015-11-10 14:11:39
10368605,198588,44376858,14,I wanted to make sure the tests covered all the constructors.,343633000,2015-11-10 14:33:35
10368605,193897,44378130,14,"makes sense, mind adding a code comment saying as much?",343633000,2015-11-10 14:56:13
10368605,64314,44447543,518,"want to add back the nicer `Cons.toString` from before?
```
override def toString = s""Cons($fa, ?)""
```",343632995,2015-11-11 01:52:40
10368605,64314,44449547,340,"feel free to ignore, but the other methods are ordered Empty, FromFuture, Cons, Embed. the different order made it a touch harder to read. no big deal obviously.",343632995,2015-11-11 02:06:59
10368605,198588,44449722,518,"I overrode it initially because the tail argument was call by name, which toString would have forced, evaluating it prematurely. Now that it's a function, toString won't force it. We could change it back to preserve the '?' but it might be confusing given",343632995,2015-11-11 02:08:25
10368605,198588,44450090,340,"Ah, I put embed first because that's the only time we don't want to prefix with z. What do you think if I added a comment about that and left it in that first position? Open to other formatting ideas too.",343632995,2015-11-11 02:11:07
10368605,64314,44450234,340,"nah, that makes sense to me. just ignore. ",343632995,2015-11-11 02:12:18
10368605,64314,44450267,518,makes sense to me.,343632995,2015-11-11 02:12:34
10368605,198588,44473137,14,"Done. Github isn't collapsing this part somehow, maybe because the diff didn't change where you marked it.",343633000,2015-11-11 05:10:37
13097768,132262,56378540,4,"for folks who are curious about why this didn't work before, scalacheck generated functions were constant.  we should be able to use scalacheck generated functions if we upgrade to 0.13.0.

https://github.com/rickynils/scalacheck/pull/171",407921275,2016-03-17 00:27:50
14415111,64314,61909989,4,am i paranoid to want this to be `${next.toString}`?,438311135,2016-05-03 23:16:48
14415111,132262,61912608,4,"yes, the s string interpolator toStrings for you",438311135,2016-05-03 23:33:54
14415111,64314,61916616,4,"ok fair enough. i realize it was doing toString, it just makes me squeamish. not gonna hold this up though.",438311135,2016-05-04 00:00:42
14415111,198588,62413305,4,"cool. also please don't hesitate to change it in internal review.

`$next` isn't so useful here -- it's always going to be `""<function0>""`. something much more useful is if we made a `Lazy[A]` type. i had a ticket for that idea, you might be able to dig",438311135,2016-05-07 14:17:49
14908011,132262,64143873,57,"instead of upgrading, can we use a different version between 2.11 and 2.12?  We have better tooling internally to make sure things don't break, but we're still on 1.12 internally.  It'll be easier to make sure things still work for 2.11 (which, frankly, w",450079310,2016-05-22 11:24:08
14908011,132262,64143874,93,ditto here.,450079310,2016-05-22 11:24:23
14908011,132262,64143879,5,"we're getting rid of this really soon in exchange for twitter bijections, so let's make sure you merge master before we merge this in.",450079310,2016-05-22 11:25:12
14908011,132262,64143882,7,"could you elaborate on what the problem is?  why can't scala do this?  is this a bug in 2.12.0-M4, or is this expected behavior?",450079310,2016-05-22 11:26:16
14908011,132262,64169652,19,How about using CrossVersion.partialVersion here?,450476162,2016-05-23 12:00:42
14908011,132262,65005697,5,"do you mind using () instead of {}?  doesn't really matter, but it's the style we normally use in util.",454424040,2016-05-29 21:18:52
14908011,80171,65006105,5,"np, done.",454424040,2016-05-29 21:43:21
15562642,83701,68138013,3,"style nit: drop the extra spaces around the imports. Alternatively, we can fully qualify these at the usage site to be explicit.",468119443,2016-06-23 04:24:41
15562642,64314,68171190,10,is this sugar necessary? i'd prefer pointing people at `Try.fromScalaTry` in the `const` scaladocs instead.,468231614,2016-06-23 10:31:58
15562642,64314,68171242,12,"can you add minimalist scaladoc? 

```
/** Converts from a `scala.util.Try` */
```",468231614,2016-06-23 10:32:47
15562642,64314,68289183,32,"(bikeshed, so feel free to drop)

what do you think of shortening this to `asScala` since this going to be something called frequently? (ditto for `fromScala`)",468608687,2016-06-24 01:28:41
17303774,132262,80272850,28,only two spaces please,518133351,2016-09-23 22:54:57
17303774,132262,80272767,18,only two spaces please,518133351,2016-09-23 22:54:31
17303774,132262,80273222,46,keep stars aligned to the left star (-1 col),518133351,2016-09-23 22:56:54
17303774,132262,80273169,8,keep stars aligned to the left star (-1 col),518133351,2016-09-23 22:56:40
17303774,1925,80354293,18,Please add return a type ```: Unit = ```.,518699448,2016-09-24 13:47:48
17303774,1925,80354297,42,Please add return a type ```: Unit = ```.,518699448,2016-09-24 13:48:04
17612905,1925,82074984,41,style: ```if (len > fileSizeInMegaBytes.megabytes) {```,525274730,2016-10-06 04:29:15
17612905,1925,82074884,39,style: ```files.foreach { f: File =>```,525274730,2016-10-06 04:28:40
17612905,1925,82079049,8,It's a bit awkward this is setting ```bytesWrittenToFile``` outside an immediate synchronized block which seems like it would be safer. It does appear it's wrapped in a synchronized block by callers though.,525274730,2016-10-06 04:51:44
17612905,1925,82074801,13,style: ```(1 to 5).foreach { testRun => ```,525274730,2016-10-06 04:28:10
17612905,1925,82074943,26,style: ```for (a <- 1 to 10000) {```,525274730,2016-10-06 04:29:02
17612905,12150058,82085461,41,Noted.,525274730,2016-10-06 05:33:08
17612905,12150058,82085392,8,"The bytesWrittenToFile is set by openStream() which is called inside a synchronized block under openLog(). That preserves it's synchronized lock.

The purpose of removing it from openLog and adding it to openStream is to make sure that as and when the l",525274730,2016-10-06 05:32:38
17612905,12150058,82085551,39,Will add white spaces as per style and push again.,525274730,2016-10-06 05:33:58
17612905,12150058,82085575,13,Noted.,525274730,2016-10-06 05:34:12
17612905,12150058,82085567,26,Noted,525274730,2016-10-06 05:34:05
17612905,1925,82096679,8,"Yep, I understand both of those points and I still think it's awkward. I'll drop this if nobody else has concerns though.",525274730,2016-10-06 07:08:05
17612905,1925,82096810,13,style: ```(1 to 5) foreach``` => ```(1 to 5).foreach```,525274728,2016-10-06 07:09:19
17612905,12150058,82198135,13,Sorry! My bad. Pushing the update.,525274728,2016-10-06 21:15:09
17612905,1925,82264199,41,"Ah, didn't realize this was comparing ```StorageUnit``` types at first glance. Thx.",525274728,2016-10-07 02:22:30
17612905,132262,82302892,8,I don't love this testing style.  how about instead having two Filehandlers in one test?,525349982,2016-10-07 05:59:12
17612905,132262,82302800,14,"should is implicit here.

s/ should succeed to rollover/rollover",525349982,2016-10-07 05:58:42
17612905,132262,82302630,19,"nit: s/`folderName+""/LogFileDir/testFileSize.log""`/`folderName + ""/LogFileDir/testFileSize.log""`",525349982,2016-10-07 05:57:15
17612905,1925,82096989,41,Is this comparing bytes to megabytes?,525274728,2016-10-06 07:11:16
17612905,12150058,82197828,41,"No it is not. It is comparing bytes (return type of Storage unit). fileSizeinMegaBytes is a Long type and to convert it into storage type, .megabytes is added. This just multiplies the constant Long and gives the storage size and type in bytes equivalent ",525274728,2016-10-06 21:13:57
17612905,12150058,82391126,8,"Well, I initially thought of executing this test individually. I think I forgot to remove the comments. 
It'll not be executed in that manner and WILL be executed every-time, just like other tests. This is definitely NOT a test that has to be executed in",525349982,2016-10-07 20:43:29
17612905,132262,82408831,8,@malikvivek that's not the part of it that bothers me–it's that we execute the test multiple times so that subsequent runs of the test will be affected by previous runs.  we should instead have all of our tests be isolated from one another.,525349982,2016-10-07 22:11:09
17612905,12150058,82451363,8,"Oh! Okay. Got you. I've made the changes and instead of  (1 to 5).foreach, using two handlers. I'll make the code more Scalastyle and push changes asap. Thanks",525349982,2016-10-08 02:05:10
18125036,1350674,85561838,9,"TBH, I'm not super familiar with using different class loaders, but it doesn't appear to me that this test will exercise the logic you've implemented.
Maybe I'm wrong, so just let me know if that's the case.",544399653,2016-10-28 23:11:25
18125036,37801,86672315,9,"Hi Bryce, `classLoader` is set to `Eval.getClass.getClassLoader` by default and here I am overriding it to be `EvalTest.getClass.getClassLoader`. I assume with pants `Eval.getClass.getClassLoader == EvalTest.getClass.getClassLoader`? So I had trouble comi",544399653,2016-11-06 03:02:58
23131686,2163571,110083470,19,"Oh, sorry... ???? 
compilation failed because of this unintended `n`.
I'll fix it ???? ",663463959,2017-04-06 12:57:17
24324106,132262,115623243,8,"nothing is multithreaded here, let's drop the volatile annotation.",689282810,2017-05-10 06:08:54
24324106,132262,115623264,24,same,689282810,2017-05-10 06:09:08
24324106,132262,115623184,6,"this may cause the closable to closed twice–this is *probably* ok but it's not part of the closable contract that it is, so let's close it exactly once if possible?  again, mutexes seem to be the right tool here.",689282810,2017-05-10 06:08:22
24324106,132262,115622432,26,"it's possible for this to create a race condition where this is closed before the ""first"" closables have started.  maybe we should fix this with mutexes?",689282810,2017-05-10 06:02:26
24324106,132262,115623089,11,"uhhhh this is getting really deep in the concurrency weeds but volatile isn't really strong enough here.  the JVM could reorder this in a dirty way:

t1:
```
if (closeDeadline != Time.top)
```

t2: 
```
closeDeadline = Time.now + 5.seconds
closa",689282810,2017-05-10 06:07:38
24324106,132262,115843638,36,should be `{ _` instead of `{_`,689994570,2017-05-11 03:26:32
24324106,193897,115849071,36,"we need to hang a timeout on `closing` to make sure `closable` always sees a close. 

`closing.by(shutdownTimer, closeDeadline).transform {  _ => closable.close(closeDeadline) }`

good test case too :)",690100084,2017-05-11 03:49:44
24324106,193897,115847035,6,please add a note that access needs to be mediated via the intrinsic lock,689994570,2017-05-11 03:41:18
24324106,193897,116071653,5,s/Note// please,690873109,2017-05-12 01:44:51
24324106,156987,116083187,5,gah my bad!,690873109,2017-05-12 02:36:30
24637204,132262,117255275,34,"this makes a lot of intermediate allocations that I think we can probably skip.  how about we use regular longs except for `BigInt(buf.get(pos    ) & 0xff) << 56` and then or them at the end?

also, why do we need to & it with the unsignedLongMaxValue?",695868954,2017-05-18 20:59:59
24637204,3359873,117258316,34,"I fixed unnecessary allocations.

> also, why do we need to & it with the unsignedLongMaxValue?

Frankly, I saw that in existing functions, for instance, _readUnsignedIntLE,_ I guess they're used just in case. Maybe to reset other bits to 0.",695868954,2017-05-18 21:11:28
24637204,132262,117264771,32,looks like the indentation got screwed up,695899599,2017-05-18 21:34:25
24637204,132262,117265024,11,I think this is still constructing many intermediate objects.  can you only OR with the bigint at the very end?,695899599,2017-05-18 21:35:16
24637204,3359873,117290949,11,"Yeah sorry, just send the new push",695899599,2017-05-18 23:12:58
24637204,1114008,117316925,34,"Close. Since java doesn't have any unsigned types, we have to use the next larger type. This facilitates that conversion: https://stackoverflow.com/questions/9578639/best-way-to-convert-a-signed-integer-to-an-unsigned-long. It is not necessary in this cas",695868954,2017-05-19 01:14:06
24637204,3359873,117323340,34,"> It is not necessary in this case.

Should remove that last & operation if it is unnecessary?

`BigInt(1,` Array(buf.get(pos), buf.get(pos+1), buf.get(pos+2)... )
I know that too but just do not want to allocate another Array.",695868954,2017-05-19 01:41:47
24637204,1114008,117325192,34,"Yeah, remove that last `&`.

SGTM w/avoiding allocations.",695868954,2017-05-19 01:49:50
24637204,132262,117368061,35,please fix the indentation.  two spaces please.,696096059,2017-05-19 05:23:42
33583259,64314,161825344,5,"i think we should handle the failed `Future` case, otherwise the `System.exit` won't get called. also, i think something like:

`Await.result(close().unit, closeDeadline - Time.now)`",889072540,2018-01-17 01:13:59
42177265,1350674,201166480,5,Any reason we shouldn't scope this down to `case NonFatal(_) | _: UnsatisfiedLinkError =>`?,1065823475,2018-07-10 05:27:47
42177265,37720213,201175230,5,That's a good point. That way we won't let we won't let any other unknown `Fatal` exception cause the return of a `NilJvm`. Thanks!,1065823475,2018-07-10 06:09:53
42177265,35556,201184595,6,nit: use `log.warning` instead of `log.log`,1065873335,2018-07-10 07:08:09
42177265,37720213,201411694,6,Thanks for the suggestion @ryanoneill!,1065873335,2018-07-10 23:34:18
43587448,447709,207838006,40,"Inlined the deprecated `SynchronizedMap`, and also brought along this ominous todo from the 2.12.x source. ",1092433017,2018-08-06 17:06:51
43587448,447709,207838519,21,"You can either have no deprecation warnings, or know you handled all cases individually at compile time, but unfortunately not both.",1092433017,2018-08-06 17:08:38
43591261,447709,207864221,40,"Deprecated trait copy-pasted in, including ominous todo.",1092517273,2018-08-06 18:52:10
43591261,132262,213842786,13,"I don't *love love* this because of the intermediate object, but we do shave the ArrayList alloc, which is pretty good.  can you add a TODO to change to `collectionAsScalaIterable` when we drop support for 2.11.x?",1092594099,2018-08-30 04:37:10
43591261,132262,213843176,31,ditto,1092594099,2018-08-30 04:38:40
43591261,132262,213842986,13,"again, TODO to make this better after we drop 2.11.x?",1092594099,2018-08-30 04:37:54
43591261,132262,213843663,6,ffti (feel free to ignore): `new CancellableSink({ count += 1 })`,1092594099,2018-08-30 04:40:34
43591261,132262,213843225,48,ditto,1092594099,2018-08-30 04:38:53
43591261,447709,213971047,13,"Initially, I mainly tried to make this work with the smallest change possible. Thinking about this more, iterating the java collection right into the spool without any converters might be a better strategy.

If I try to do that, I'm going to struggle a ",1092594099,2018-08-30 16:55:11
43591261,447709,213979168,13,"alternatively, WDYT about a `@varargs` annotation on on Closables#all? From what I understand, that would make it callable with the closables array without further ado.",1092594099,2018-08-30 17:24:36
43591261,132262,215385423,13,"yah, take a stab at it.  java is basically a subset of scala.",1092594099,2018-09-06 01:47:35
43591261,132262,215385852,13,"if it compiles, that works for me.",1092594099,2018-09-06 01:48:54
43591261,1114008,217558172,5,was it necessary to do this due to one of the deprecation warnings?,1124674277,2018-09-14 05:53:33
43591261,1114008,217565951,40,"is the TODO still relevant to us? meaning, is it something that _someone_ will do _someday_ here? Perhaps we can just remove it.",1092517273,2018-09-14 06:41:00
43591261,447709,217623617,5,"yes, exactly",1124674277,2018-09-14 14:32:45
43591261,447709,217630936,40,"The todo may still be relevant to twitter util -- it would take a bit of investigation to figure out whether that's true or not.

The (unfortunate) case is that that todo has been in the original case for pretty much ever, and the depreciation has to do",1092517273,2018-09-14 15:05:17
43591261,1114008,217833842,40,"Thanks for the background! For this PR, I don't think implementing a proper synchronized version makes sense.

I don't really have a read on whether or not the extra methods would be useful. If this is indeed a noop, we can leave it as is unless someone",1092517273,2018-09-15 03:30:00
46568127,72999,221351081,14,I'm somewhat skeptical this actually improves readability. Perhaps others might find it more readable.,1148897803,2018-09-29 01:58:22
46568127,11002776,221437883,14,"I agree that it's not drastic improvement, maybe it reads slightly better? I was also thinking of adding comments at the end of certain lines, as below: 

```
larger match {
  case l if (l == 0 || smaller == 0) => Duration.fromNanoseconds(0)          ",1148897803,2018-09-30 02:36:39
3768500,1503646,13105655,13,"I modified the README on the GitHub online editor, not sure why this line was marked as changed...",114661501,2014-05-28 03:06:17
318382,64320,1502178,22,"this one is intentional, it's supposed to be ""memoize"" :-)",8911404,2012-08-31 02:55:04
2644178,64320,9974476,5,"""They"" have an antecedent in this case -- Variance is not the same as Variance annotations.",77070263,2014-02-23 12:49:38
2644178,64320,9974485,62,"It is a  -> How about ""Options are collections .., and are embellished",77070263,2014-02-23 12:51:14
2644178,3086535,12217192,5,"The antecedent is singular, though, which makes ""they"" confusing. ""It defines how..."" would be better.",77070263,2014-05-02 07:08:24
2644178,3086535,12217252,62,"Yes, that's good.",77070263,2014-05-02 07:11:03
3476825,72999,23571170,35,"""Машинах состояний"" - конечных автоматов?",102903116,2015-01-27 05:39:27
3476825,72999,23571382,156,"""втречаются"" - встречаются",102903116,2015-01-27 05:42:26
3476825,72999,23571478,166,"""резултата"" - результата",102903116,2015-01-27 05:44:04
3476825,72999,23571571,213,"""сделаеть"" - сделать",102903116,2015-01-27 05:45:38
3476825,72999,23571797,252,"Может вместо ""спискового включения (for-comprehension)"" оставить просто ""for-comprehension"". Списковое включение очень странный переврод. Мне кажется не стоит переводить ""for-comprehension"".",102903116,2015-01-27 05:48:41
4452533,64320,16631476,4,"maybe expand a little:  "", do not throw exceptions""",151493761,2014-08-23 21:18:31
4452533,64320,16631479,4,I don't think this should be a blanket rule. I think exceptions should still be thrown to indicate internal errors (think `assert` and `require`) and JVM errors (e.g. resource exhaustion).,151493761,2014-08-23 21:19:40
4452533,132262,16634598,4,"Good point, updated.",151493761,2014-08-24 11:54:08
4452533,64320,16743756,4,"Reword: ""Do not throw exceptions in methods that return futures.""",153853182,2014-08-27 02:27:49
4452533,64320,16744456,11,"This is a super long sentence, and is difficult to parse. Also, this is about more than being confusing -- it's about being right: since the future encapsulates a computation, it should do the same for a computation failure. Suggested wording:

Futures ",153853182,2014-08-27 02:39:32
4586177,132262,17694789,5,"perhaps useful to point out that Futures represents the _result_ of successful and failed computations, and not the computation itself (ie it's not meaningful to retry a Future, but it is meaningful to retry a () => Future[_]).",156124564,2014-09-18 02:16:41
4586177,5437425,18198230,4,"s/which/that/.

Also, more direct wording, and kill the double negative (it's confusing). To simplify, I'd say:

  ""Do not throw your own exceptions in methods that return futures.""

  ""Do not throw fatal exceptions in methods that return futures.""",156124564,2014-09-30 09:06:32
4586177,5437425,18198248,5,i'm not sure this distinction is important right here; also the line is blurred somewhat by the presence of interrupts.,156124564,2014-09-30 09:07:03
7022510,132262,28082736,72,"These seem to describe when it's *possible* to make a types covariant / contravariant, but I'm not sure it provides a clear rationale for why you should do it whenever possible.",242469359,2015-04-09 22:24:19
7022510,215383,28084025,72,"That's true. Let me submit another PR and be more specific on that matter. 
",242469359,2015-04-09 22:38:32
40664328,7605529,194882599,217,什么是类型安全？,1036448546,2018-06-13 03:45:26
40664328,7605529,194853316,173,s/根本不是/没有标明是,1036448546,2018-06-13 02:00:03
40664328,7605529,194852326,162,让我们指代更明确一些：但这些返回类型提供了很好的文档,1036448546,2018-06-13 01:56:52
40664328,7605529,194842615,32,s/但避免使用晦涩难懂（尤其是类型系统）的特性/但避免使其晦涩难懂（尤其是类型系统,1036448546,2018-06-13 01:25:04
40664328,7605529,194849529,156,"我认为 production code 在这里指产品代码，
“但这些技术很少应用于产品代码“ 如何？",1036448546,2018-06-13 01:47:15
40664328,7605529,194844965,125,（space)list(space) for consistence.,1036448546,2018-06-13 01:32:26
40664328,7605529,194844295,59,较长的？,1036448546,2018-06-13 01:30:20
40664328,7605529,195610196,432,Thank you for adding this part.,1036448546,2018-06-15 07:43:52
40664328,7605529,195610567,451,s/引用到当前值/当前值的引用？,1036448546,2018-06-15 07:47:42
40664328,7605529,195609261,403,"Can you add the link here?  `[Finagle](https://github.com/twitter/finagle)`
And I think it intended to say `RPC 框架` here.
",1036448546,2018-06-15 07:35:51
863530,87195,162758,37,:(,26651303,2011-10-11 02:19:00
863530,64977,162934,37,"Why "":(""?",26651303,2011-10-11 03:38:16
863530,87195,163681,37,just a sad face at the missing eof newline,26651303,2011-10-11 13:56:46
863530,64977,163795,37,oh! I will fix.,26651303,2011-10-11 15:03:33
2525520,119946,10544575,4,"I removed this method as it cannot really be implemented in the new API without possibly breaking applications in strange ways. We could accept an `AtomicLong` here and replace it with a `LongAdder`, but we have no guarantee that the caller did not keep a",95796831,2014-03-13 04:24:48
2525520,119946,10544628,22,This is a change from the current upstream/master. ,95796831,2014-03-13 04:26:16
3239228,12202,10545647,6,1.1.0 is the latest version of com.twitter.jsr166e,95799420,2014-03-13 04:45:19
3239228,119946,10551169,6,"OK, will take care of that!",95799420,2014-03-13 08:43:43
3239228,132262,10597233,8,style nit: no space between ) and : in the type annotation.,95959379,2014-03-14 12:03:37
3239228,132262,10597248,4,this looks like a breaking API change.,95959379,2014-03-14 12:04:24
3239228,132262,10597265,7,could you also specify the ostrich version + 1 minor bump in this deprecated annotatation?,95959379,2014-03-14 12:05:42
3239228,132262,10597276,70,style nit: please annotate all public methods,95959379,2014-03-14 12:06:42
3239228,132262,10597299,55,"this should use backticks, not quotes.",95959379,2014-03-14 12:07:56
3239228,132262,10597317,10,this description should now be changed,95959379,2014-03-14 12:08:59
3239228,132262,10597355,21,We've changed the semantics of incr() by making it no longer threadsafe.  Is this necessary?,95959379,2014-03-14 12:11:04
3239228,132262,10597386,5,this import is no longer used,95959379,2014-03-14 12:14:23
3239228,119946,10606834,8,"OK, fixing that across the board. Didn't notice your style variant.",95959379,2014-03-14 19:28:16
3239228,119946,10607904,4,"Yeah I commented on this in the previous PR and I'm not sure how to handle it. The problem here is that it's impossible to guarantee not breaking old applications here as it's completely possible that an existing application makes creates an `AtomicLong`,",95959379,2014-03-14 19:59:33
3239228,119946,10608054,21,"Depends on the definition of ""thread safe"". It won't break, but it won't increment and return the value atomically. It could be made to have the same semantics as before, but that would require synchronization which could introduce a performance regressio",95959379,2014-03-14 20:02:59
3239228,132262,10612337,21,"You're right, I meant atomic.",95959379,2014-03-14 21:32:21
3239228,132262,10613338,4,"Right now they're in [finagle-core][0], although we're trying to move them into a util-stats library, it's slow going since we want to keep the c.t.f.s.Counter abstractions compiling.

Maybe the right thing to do is to just make people opt into the fast",95959379,2014-03-14 21:51:02
3239228,119946,10613885,4,"That's along the lines of what I described earlier, but it has the downside
of not being returned in the various get methods (and the internal maps) in
StatsCollection - I don't think the fast counter can be a subtype of
Counter so it will have to be deal",95959379,2014-03-14 22:01:59
3375957,132262,11356455,84,"This can have confusing behavior if you call two updates.

Thread 1:
  (current value N)
  value.update(3)
  (current value 6)

Thread 2:
  (current value N)
  value.update(3)
  (current value 6)

Could you either document this more clearly or",99975370,2014-04-07 23:00:28
3375957,132262,11356499,92,maybe call this sumThenReset?,99975370,2014-04-07 23:01:11
3375957,132262,11356770,64,"private[this] avoids a method call, I think.",99975370,2014-04-07 23:06:33
3375957,132262,11357177,57,I think it would be better not to lump fastCounters in with counters.  This is also subtly a breaking change.,99975370,2014-04-07 23:13:59
3375957,132262,11357215,4,Document more clearly that this is a different namespace than incr,99975370,2014-04-07 23:14:50
3375957,132262,11357334,23,"A.  This should be in a different namespace.
B.  Can we just back this with `FastCounter`s?",99975370,2014-04-07 23:17:01
3375957,132262,11357389,7,this should be in a different unit test.  we should also add a negative test that checks that incr() and increment() increment in different namespaces.,99975370,2014-04-07 23:18:10
3375957,132262,11357513,57,"Whoops, read the rest of the method, not a breaking change, but still confusing.  It would be useful to annotate the return type too (`mutable.HashMap[String, Long]` it looks like?)",99975370,2014-04-07 23:20:03
3375957,132262,11357581,8,"This comment is relevant to this PR, but will not be relevant after.",99975370,2014-04-07 23:21:13
3375957,132262,11357712,21,Style nit: `) : Counting` => `): Counting`,99975370,2014-04-07 23:23:43
3375957,132262,11357825,21,Why is the return type Counting and not FastCounter?,99975370,2014-04-07 23:25:46
3375957,132262,11357927,21,The contents of this method are identical to getCounter() and getMetric().  It's probably time to refactor this to just use a generic helper method.,99975370,2014-04-07 23:27:56
3375957,132262,11357973,63,Style nit: leave off the (),99975370,2014-04-07 23:28:38
3375957,119946,11358401,8,Agreed. Got a better suggestion for the name to avoid the apologetic tone?,99975370,2014-04-07 23:35:59
3375957,119946,11358427,64,"I believe private final does the same thing, but I'll check with javap.",99975370,2014-04-07 23:36:28
3375957,119946,11358584,84,"Hmm, good point. I think the only way to get around this is to make the adder instance a var, but that will incur other race conditions and require it to be volatile... How about just removing this from the contract all together?",99975370,2014-04-07 23:38:57
3375957,132262,11362947,84,"I'd be OK with that, it's not part of Counting so it should be easy.",99975370,2014-04-08 01:12:20
3375957,132262,11363026,8,How about `Incrementable`?,99975370,2014-04-08 01:13:51
3375957,119946,11369231,92,We actually need this to be part of `Incrementable` and I'm not sure `sumThenReset()` really makes sense to anything that's not striped. How about `getAndReset()`?,99975370,2014-04-08 03:37:45
3375957,132262,11369263,92,Sounds good to me.,99975370,2014-04-08 03:38:44
3375957,119946,11369273,57,"I decided not to make any changes at all to the existing methods, but I'll add explicit typing to all of the `StatsCollection` methods to make it consistent.",99975370,2014-04-08 03:39:05
3375957,119946,11369326,57,"On this, do you guys prefer having `foo(): Unit = { }` or `foo() {}`?",99975370,2014-04-08 03:40:44
3375957,119946,11369777,21,"I really wanted to not implement that method at all as I don't really see a need for the `f` function here, but decided to make it consistent. I'll refactor it to `private[this] def getCounter[T](name: String, target: ConcurrentHashMap[String, T], f: => T",99975370,2014-04-08 03:56:13
3375957,132262,11396472,44,"+1 on adding type annotations to public methods, thanks!",101913442,2014-04-08 20:54:42
3375957,132262,11396641,90,"I'm still iffy on giving both counters and fast counters in the same Map--for one thing, since they're different namespaces, if they have overlaps, the fast counters will clobber the regular counters.",101913442,2014-04-08 20:57:37
3375957,132262,11396669,38,maybe add a removeFastCounter method instead of having this cover both of them?,101913442,2014-04-08 20:58:03
3375957,132262,11396811,24,"These look good, but can you add a basic test which just checks that incr and increment are in different namespaces?",101913442,2014-04-08 21:00:20
3375957,119946,11396815,90,"The upside is that anything that fetches counter stats with this method (in our case, our Graphite reporter) will continue to work...",101913442,2014-04-08 21:00:21
3375957,132262,11396916,25,This should be in a different namespace.  Maybe just add a fast__counter prefix or similar?,101913442,2014-04-08 21:02:16
3375957,132262,11397110,90,"Ahh, I see.  How about we keep this method as is and also add getSlowCounters / getFastCounters for cleanliness?  Can we update the documentation to explain getCounters too?",101913442,2014-04-08 21:05:46
3375957,119946,11397392,25,This default implementation is added to avoid other implementations of `StatsProvider` to break. I don't think separating the two namespaces really is a big goal in itself. Adding a prefix would break the `getCounters` method... ,101913442,2014-04-08 21:11:03
3375957,132262,11398115,25,"It seems pretty confusing that if I do

```scala
stats.incr(name)
stats.increment(name)
stats.getCounters()
```
the result is implementation dependent.

You could strip the prefix later pretty easily.  Maybe just have getCounters() call into getF",101913442,2014-04-08 21:24:49
3375957,119946,11399808,25,"How about having `getCounters() ` in `StatsCollection` actually resolve namespace conflicts by accumulating collisions instead? This will make it consistent independently of the implementation. Alternatively, leave `getCounters()` alone and create a new m",101913442,2014-04-08 22:00:41
3375957,132262,11423877,25,"I like accumulating, especially if we document it clearly.",101913442,2014-04-09 11:13:03
3375957,119946,11435238,25,"OK, https://github.com/twitter/ostrich/pull/68/files#diff-7265b8bc0f62d847ec3b641566063290R182 and https://github.com/twitter/ostrich/pull/68/files#diff-907674d3a1b02ea9e35f95ff02dc4c6dR248",101913442,2014-04-09 18:35:07
3375957,132262,11518923,15,s/Creative it/Create the counter,102347835,2014-04-11 10:40:42
3375957,132262,11519103,38,What did you decide here?,101913442,2014-04-11 10:42:08
4509116,132262,16762702,46,"let's just call this one scalatest, since we don't need to disambiguate",154600177,2014-08-27 13:13:18
4509116,132262,16762766,12,"oy gevalt, I didn't realize this was part of the public api.  I think we can deal though.",154600177,2014-08-27 13:14:55
3657859,388963,12566007,7,Remove unit of measurement from value of zero.,110251263,2014-05-13 08:58:59
3657859,388963,12566018,18,Can drop left padding value since it's the same as right.,110251263,2014-05-13 08:59:36
3657859,388963,12566022,30,Remove unit of measurement from value of zero.,110251263,2014-05-13 08:59:48
3657859,388963,12566026,39,Remove unit of measurement from value of zero.,110251263,2014-05-13 09:00:03
3657859,388963,12566030,48,Remove unit of measurement from value of zero.,110251263,2014-05-13 09:00:13
203868,199939,1432284,10,"Because of some previous ABI incompatibility, the scala convention is to happend the version of scala to the name of the jar. Sbt push this concept a little bit further by adding the version of sbt.
The people that developed those plugins have stopped mai",6659964,2012-08-22 11:10:03
203868,199939,1432297,11,"Why did you add ""intransitive""?",6659964,2012-08-22 11:12:55
203868,441297,1437170,11,"Franklin Hu: ""You shouldn't have to make changes in the generated files, we just marked scrooge as intransitive() to prevent it from pulling in thrift 0.8.0."" and later ""You just have to make scrooge not pull in newer version of thrift by marking them int",6659964,2012-08-22 21:56:29
203868,441297,1437720,10,"@stevegury: OK, I'll need some elaboration on this. :) Adding my own sbt script would a) do what in particular and b) obviate the need for which plugins? Does this seem to you to be the right thing to do?

I'm trying to do a balance between ""do this right",6659964,2012-08-22 22:54:43
203868,199939,1438049,10,"Here you don't specify the sbt version the user has to use, so depending on which version of sbt do you have this code will potentially fail.
On my machine I have sbt 0.11.3-2, if I load this project, it will fail because it can't find sbt-package-dist_2.",6659964,2012-08-22 23:27:30
203868,441297,1440399,10,OK. I added this sbt script and changed the other files accordingly. Great suggestion.,6659964,2012-08-23 03:20:38
203868,224514,1447702,11,"Is it intentional to use THRIFT 0.5.0, not THRIFT 0.8.0? Scrooge 3 implements THIRFT 0.8.0, I believe. ",6659964,2012-08-23 23:24:53
203868,441297,1447773,11,"I don't know, but I'll ask Franklin to comment on this.",6659964,2012-08-23 23:35:05
203868,6539,1447935,11,"Just revisited and you may be okay without marking it intransitive.
We had to pin the dependency in Zipkin since cassie depends on finagle-thrift, which uses thrift 0.5.0. Cassie has a `FakeCassandra` that starts up a thrift `TThreadPoolServer` whose cons",6659964,2012-08-23 23:51:03
203868,441297,1447986,11,"OK, so delete the two ""intransitive()"" and everything else is the same?",6659964,2012-08-23 23:56:38
203868,6539,1448005,11,Yes,6659964,2012-08-23 23:58:29
203868,224514,1449558,14,"Scrooge 3.0.1 depends on the following versions of util and finagle
finagle-core: 5.0.0
finagle-thirft: 5.0.0
finagle-ostrich4: 5.0.0
util-core: 5.0.3
util-codec: 5.0.3

Does it work if you put newer versions here? (it might, but I just want to make sure)",7202777,2012-08-24 02:48:18
203868,441297,1449577,14,It appears to work for the purposes of initializing searchbird. I just picked the latest versions of the three finagle libraries (and did not specify the util-* libraries). But of course searchbird is only one use instance. ,7202777,2012-08-24 02:51:18
78551,87195,648361,9,we want to avoid printing this unless the file is going to be compiled.,4723645,2012-04-05 05:10:56
78551,6767,648404,9,"Yes, but you don't know the target file until there's been an initial
parse, which means errors at that stage are not preceded by the thrift
file name in question.

Since the print only happens in verbose mode, I opted for + Compiling
file name (unch",4723645,2012-04-05 05:26:30
78551,87195,652415,9,"oh, i see, because an exception could happen in the parsing even if we don't plan to rewrite the scala files.

i guess that bug's always been there. :)
",4723645,2012-04-06 01:18:04
78551,6767,652479,9,"Yes, and caught me unawares a few times already as I was trying to figure out what scrooge was looking at when it bombed out :)

Prepending the filename to exceptions also helps, particularly in non-verbose mode where it's the only output you get on an er",4723645,2012-04-06 01:27:33
78551,87195,652563,25,"why not add a parameter to the 3 exceptions, and have it add position at the time the exception is thrown?",4723645,2012-04-06 01:40:08
78551,6767,652722,25,"The exception is thrown by appy(), which only has access to the name string at that point. We could pass the node along to apply?",4723645,2012-04-06 02:06:34
78551,87195,652990,25,"yeah, i think it would be better to thread a Node through where the exceptions are thrown, so that it's obvious that every place that throws one of these exceptions will attach position info at the time. it's less clear when it's being handled only at app",4723645,2012-04-06 03:06:39
78551,6767,654338,25,"Approach is changed to a DynamicVariable, see next commits.",4723645,2012-04-06 13:59:56
78551,87195,659292,53,"do we not use the importer anymore? (i guess not, or the tests would have failed)",4723633,2012-04-09 10:12:29
78551,87195,659293,43,"does this mean the error messages will only report on lines with the beginning of a definition? makes it seem like there's no need to attach the position to any other node.
",4723633,2012-04-09 10:15:44
78551,6767,659322,53,Maybe not! I didn't look carefully to see if I could remove it.,4723633,2012-04-09 10:57:44
78551,6767,659333,43,"Good point. I went back and forth a lot attaching position() combinators and looking at where to put a withValue { } enclosure. To get pinpoint type error reporting, there would need to be more withValue { } blocks around many of the apply methods. Open t",4723633,2012-04-09 11:09:00
78551,87195,668516,43,"i'm ... really not sure. :)

it would be good to have the position information for the actual token causing problems when we throw an exception, but it doesn't seem like that's possible without threading the AST node through the TypeResolver, either expli",4723633,2012-04-11 04:31:44
78551,6767,668559,43,"http://www.scala-lang.org/api/current/scala/util/DynamicVariable.html

Think of it as a stack. Everyone with lexical scope (e.g. is in the same class) to see the variable sees just the topmost value. Calls to withValue{ } push onto the stack going into th",4723633,2012-04-11 04:46:26
78551,87195,668567,43,"well, let's try that then. :)
",4723633,2012-04-11 04:48:55
78551,6767,674781,43,"Just pushed some more withValue blocks. Error output is slightly more specific now (was previously reporting line x column 1, now reporting line x column y).",4723633,2012-04-12 09:42:40
78551,87195,777139,53,"oh, we just fixed a bug in this, so we DO use it!",4723633,2012-05-05 02:23:29
655044,64314,2389120,9,too much indentation,22290364,2012-12-12 12:30:19
655044,64314,2389138,8,too much indentation,22290364,2012-12-12 12:37:10
655044,64314,2389143,8,indentation,22290364,2012-12-12 12:38:51
761969,224514,3417454,5,"We have changed the naming of internal marshalling functions for args and result. So please use remove$args and remove$result instead of RemoveArgs and RemoveResult. 

Everything else looks good. 
",23950458,2013-03-19 00:15:01
1255274,64314,3400603,4,"nitpick: the docs indicate that value should be the class that does the generation, so I think that should be ""com.twitter.scrooge.Compiler""",36490501,2013-03-16 04:18:42
1257929,224514,3418195,31,"Add a case: 
(genHTMLReport, genHTMLReport, GenHTMLReport)",36507085,2013-03-19 00:48:40
1586772,61584,4662320,5,This should use failOrWarn,45322352,2013-06-12 22:48:19
4441441,132262,16613338,3,what happened here?  why did we need so many new imports?,151013053,2014-08-22 23:29:35
4441441,132262,16613370,4,we should sort these imports so they're easier to scan.,151013053,2014-08-22 23:30:02
4441441,132262,16613436,38,seems like this is a breaking api change?  we probably want to avoid that if possible.  do we need to do this?,151013053,2014-08-22 23:31:07
4441441,406208,16629590,3,"There was a refactoring in cad09af796 that separated (in the Scala code) the Iface+FutureIface from the FinagledClient, so the FinagledClient was generated into its own file (instead of as an inner class).
So, what used to be just a template for a part o",151013053,2014-08-23 13:40:31
4441441,406208,16629594,4,Good point! I'll look into that.,151013053,2014-08-23 13:41:06
4441441,406208,16629623,38,"Since ""The Big Split"" aka. cad09af7963, FinagledService and FinagledClient haven't been generated at all, for Java (only for Scala). So the breaking change actually happened in version 3.5.0 (though probably by accident)

It looks like a breaking change",151013053,2014-08-23 13:47:58
4441441,406208,16629639,3,"(Just to clarify; the imports come from `service.java`, because that was where FinagledClient used to live)",151013053,2014-08-23 13:50:26
4441441,406208,16629672,38,"Another important question is - why don't we move this generator back so it's once again generated in the same file as iface and FutureIface - the reason why is explained in the ""Big Split"" commit. One could say we should only do that in Scala, not in Jav",151013053,2014-08-23 13:55:34
4441441,406208,16629749,4,Should be easier to read now!,151013053,2014-08-23 14:14:52
4441441,1969,18862078,5,Should this (and `FinagledService`) be public?  Without that I can't use them instead of `{{ServiceName}}$FinagleService`.,153577740,2014-10-15 02:59:31
4441441,406208,19528914,5,You're right. They should probably all be static too. Fixed in 3a6a3b8,153577740,2014-10-29 16:21:56
4441441,3414694,19563247,6,This is not used; cleanup unused imports please.,178623560,2014-10-30 00:57:38
4441441,3414694,19563668,38,We can do this in another change (although I'm not yet convinced that we should; I need to look at the history of the split); for now lets bring java in sync with scala.,151013053,2014-10-30 01:04:10
4441441,406208,19707344,38,"Yup. That's actually what's happening here (bringing java in sync with scala, and nothing else). In Scala, Scrooge generates an object MyService { ... }, which contains an inner class MyServiceFinagleClient. A Scala object with an inner class is the same ",151013053,2014-11-02 01:51:38
4441441,406208,19707470,6,"They are all in use actually... unless I've missed something...
Service is used in finagleClient.java line 41 (using the full com.twitter... namespace though)
SourcedException used in finagleClient.java, line 89
Counter used in line 109

Service is u",178623560,2014-11-02 02:10:11
4463067,132262,16444651,5,"let's actually keep this as 1.9.1 for now.  unfortunately, because of the way our internal build works, it makes more sense to keep everything on a consistent version.  similarly, let's make the 2.x version 2.1.3.",152088906,2014-08-20 02:21:07
4520387,132262,16909894,4,s/depencies/dependencies,154954649,2014-08-29 22:25:51
4520387,132262,16909914,6,this indentation seems screwed up,154954649,2014-08-29 22:26:14
4520387,24443,16912784,4,"Whoops, sorry! (I've been sick, sigh.)",154954649,2014-08-29 23:21:10
4575631,3414694,17553638,18,Is this the same scalacOptions as in plugins.sbt? I wonder if the shared settings aren't getting copied properly.,156014237,2014-09-15 21:51:25
4700173,3414694,19556401,154,Delete please.,178560817,2014-10-29 23:36:58
4700173,3414694,19556618,31,"Can you add a line:
override def showUsageOnError = true

to keep the current behaviour of showing help if no input files are given.",178560817,2014-10-29 23:39:49
4700173,3414694,19556705,15,"Same here: need to show help if no input given, so please add:
override def showUsageOnError = true",178560817,2014-10-29 23:40:59
4700173,230304,19563981,154,Oops!,178560817,2014-10-30 01:08:41
4700173,230304,19564210,31,"Based on the two bits of code below, I think that behaviour is automatically handled if you use `help`.
https://github.com/scopt/scopt/blob/scopt3/src/main/scala/scopt/options.scala#L153
https://github.com/scopt/scopt/blob/scopt3/src/main/scala/scopt/op",178560817,2014-10-30 01:12:44
4700173,3414694,19564638,31,"You can test this with 
./sbt scrooge-generator/assembly
java -jar scrooge-generator/target/scala-2.10/scrooge-generator-assembly-3.17.0.jar 

I was looking at scopt docs at https://github.com/scopt/scopt",178560817,2014-10-30 01:19:49
4700173,230304,19565402,31,Good point. I have added them now.,178560817,2014-10-30 01:30:45
4700173,3414694,19575184,36,"Indent by 2 spaces. I've fixed this for this patch, but keep this in mind for the future.",178900791,2014-10-30 03:54:55
4737644,132262,18074003,5,"is this part of speeding up compile times?  this seems like a breaking change, it makes me a little nervous.",158164214,2014-09-26 10:12:30
4737644,132262,18074022,14,when is this not true?,158164214,2014-09-26 10:14:04
4737644,132262,18074049,4,all of these vars make me nervous now . . . when do these get changed?  should we make them volatile?,158164214,2014-09-26 10:16:34
4737644,152910,18086769,5,"+1 to moses's comment, this is breaking change that could only be accepted in a major version bump.",158164214,2014-09-26 17:47:58
4737644,152910,18086871,12,"language == ""java""
language == ""scala""",158164214,2014-09-26 17:50:31
4737644,61584,18100115,4,"They're set by whatever mechanism starts the compiler. They're basically defaults that get changed just before the compiler runs. 

This all could be re-written, but it's not really important.",158164214,2014-09-26 21:54:26
4737644,61584,18100175,14,"when the linter or experimental java generators are used (or really, any other plug in generator).",158164214,2014-09-26 21:55:22
4737644,61584,18100291,5,agreed. I think the only trouble it'll cause is if the perviously generated code exists when running the compiler again. Which means (I think) pants will need to clear the previously generated code first. It may already do so.,158164214,2014-09-26 21:57:31
4737644,3414694,18105629,5,"Right, this is changing both the filename and the class name.
Without it, the parallel generation in tests creates an invalid Constants.java file with a mix of output from two threads. 
Apache thrift 0.9.1 does this. 

The alternative is to rename tes",158164214,2014-09-26 23:31:58
4797848,64314,18127582,6,any chance of passing the cache into HandlebarLoader instead of making it a global? Global state will make us sad at some point.,159065863,2014-09-28 09:53:40
4797848,3414694,18168277,6,"What are the problems caused by this? It's static, not global. The cache works only if it survives across many invocations, so it needs to be static, even if it's passed in from some context. ",159065863,2014-09-29 22:15:36
4797848,64314,18229150,6,"well, its the standard issues that come from global state. 
http://c2.com/cgi/wiki?GlobalVariablesAreBad

in this case, i think it would be easy to just pass in the same HashMap to the HandlebarLoader class constructor. if this is difficult, i'm fine w",159065863,2014-09-30 21:32:19
4797848,3414694,18371796,6,I've removed the static caches and cleaned up the Generator code a bit. ,159065863,2014-10-03 03:21:51
4797848,132262,18380033,5,"sbt-assembly makes fatjars, so I'm a little concerned it will break something by screwing up a merge.  could you use onejar instead?",163121597,2014-10-03 08:13:20
4797848,132262,18380050,1,let's not check this in since we already have a script which can generate it.  maybe just add it to the .gitignore so it doesn't have to be redone every time?,163121597,2014-10-03 08:14:28
4797848,132262,18380097,6,I'd encourage you to sandbox this internally.  My guess is you'll have to fix some folks who use Generator.,163121597,2014-10-03 08:16:49
4797848,3414694,18408804,5,"The jar produced by onejar is reeeally slow to load, probably because resources are in a jar inside a jar. Running with one-jar takes 19 seconds vs 2 seconds for stock scrooge. I'll stick with sbt-assembly.",163121597,2014-10-03 22:48:44
4797848,3414694,18413099,6,"Sounds good, will do.",163121597,2014-10-03 23:57:25
5567025,3414694,22740596,44,Why is this needed? How did this work before?,204121339,2015-01-10 03:22:16
5567025,3414694,22740650,62,Can you explain why this is needed? ,204121339,2015-01-10 03:23:21
5567025,721855,22743151,44,"Before, a user needed to know that if they were using Scrooge through the sbt plugin that they also needed to add `scrooge-core` to their library dependencies. Now, this knowledge is not required, the plugin will add the dependency on it's own since I can",204121339,2015-01-10 04:09:50
5567025,721855,22743880,62,"This has to do with sbt scopes. I sort of forgot some of the intricacies here, but I remember that before this change it was not possible for a user to change setting keys in the build file because the setting that they changed was not in the same scope a",204121339,2015-01-10 04:21:12
5567025,3414694,22744271,44,"Makes sense, this is useful.",204121339,2015-01-10 04:27:28
5567025,3414694,22745091,62,Let's drop this (and other instances of 'in Compile') and address separately with a proper description of the problem.,204121339,2015-01-10 04:40:19
5567025,721855,22745972,62,"Sure. I will open a separate PR for this issue.

Should I do that change on master or develop?",204121339,2015-01-10 04:53:41
5567025,3414694,22747188,62,You should base the patches off of master. develop branch may have dependencies on unpublished versions of dependencies (util and finagle).,204121339,2015-01-10 05:15:09
5567025,721855,22817614,62,I have opened the following PR to address this specific issue: https://github.com/twitter/scrooge/pull/167,204121339,2015-01-13 03:06:05
6155664,3414694,24261410,56,"Scrooge is using scala 2.10 now, so feel free to use string interpolation in the future.",214504682,2015-02-07 01:43:24
6155664,3414694,24261789,149,Remove the empty string,214504682,2015-02-07 01:48:39
6155664,3414694,24262434,45,You can put the namespace into the Language object.,214504682,2015-02-07 01:57:03
6803059,132262,27054265,157,"I'm not super familiar with the sbt dag stuff, does forcing the value of scroogePublishThrift make it harder for sbt to compile the dag correctly?  Isn't there a fishbone operator that we can use for that kind of thing?",235749993,2015-03-24 23:50:08
6803059,146404,27057056,157,The `.value` macro will be expanded into something involving `<<=` (or related operators—I'm not sure about the details). In any case looking up this value in a `mapping in …` task shouldn't make anything harder for SBT. ,235749993,2015-03-25 00:15:04
6803059,132262,27064275,157,"Yeah, <<= was what I was thinking.  If value is a macro, we should be set.",235749993,2015-03-25 01:29:31
7294166,1925,35259027,4,"I'm sure there are various instances of this around, but it should move to https now.",250251593,2015-07-23 01:23:26
7419190,3414694,31186939,45,"Looks like this is initialized to the empty list so scrooge will always regenerate thrift, i.e. this patch breaks the dirty check.

The problem is that it doesn't know what the output files will be.

One workaround is to generate output in a separate ",253882394,2015-05-28 03:22:23
7419190,1123342,31196651,45,It will be updated as soon as some files have been generated by scroogeGen. Are you concerned about files being recreated across different runs of sbt?,253882394,2015-05-28 06:25:13
7419190,3414694,31294937,45,"Yes, that's what I mean. Now it will always regenerate files on the first run, which is incorrect.",253882394,2015-05-29 07:20:44
7419190,1123342,31489138,45,"How do you ensure that if you change the sbt settings it regenerates the files using the old approach?

Apart from having the behaviour it already had and writing to a different directory or writing out some state I'm not sure how we can achieve what yo",253882394,2015-06-02 07:30:26
7419190,3414694,31649113,45,"The current check is simple - check all the *.scala files in the output directory (or .java - support was added in cd5e6c0b6f3e0).

You could figure out the output files by parsing the input and figuring out what structs and services would be generated.",253882394,2015-06-03 22:43:45
8009082,132262,32522185,10,"actually, could you leave it so that it still says ""+ SNAPSHOT""?",271472404,2015-06-16 18:51:40
8009082,132262,32522201,10,*+ suffix,271472404,2015-06-16 18:51:56
8009082,489976,32522362,10,OK,271472404,2015-06-16 18:53:48
8009082,489976,32522461,10,done,271472404,2015-06-16 18:54:40
8021797,132262,32632168,7,"we can simplify this by using `git clone ""$repo"" --branch ""$branch""`",271539133,2015-06-17 19:28:58
8021797,132262,32632406,2,set -e?,271539133,2015-06-17 19:31:13
8021797,132262,32632481,39,maybe use mktemp instead?,271539133,2015-06-17 19:31:54
8021797,132262,32632622,1,"I don't love putting this in build-support/bin, we already have a bin directory, can we use that?",271539133,2015-06-17 19:33:02
8021797,132262,32632860,29,why not use ./sbt?,271539133,2015-06-17 19:34:56
8021797,132262,32633006,25,"This seems unlikely to fail, and if it does, `set -e` will help us out with it.  I don't think we need the || check.",271539133,2015-06-17 19:36:19
8021797,132262,32633280,30,"this is cool, but we could probably just publish-local everything.  do you not want to do that because it's slow?",271539133,2015-06-17 19:39:03
8021797,489976,32639076,30,"Yes, it was because it was slow, but on top of that it's because a couple of finagle projects got errors while building from develop, so I try to reduce the impact on finagle dependencies including the ones that specifically scrooge depends on. What do yo",271539133,2015-06-17 20:27:38
8021797,489976,32639152,25,"Yes, good point, will change it with set -e and -x too.",271539133,2015-06-17 20:28:16
8021797,489976,32639566,29,"using the ./sbt included with finagle and util gives errors, exactly the error is ->

bad sbt-launch.jar.  delete sbt-launch.jar and run ./sbt again.

I tried to delete de sbt-launch.jar just for curiosity but the error remains.

For a moment I thou",271539133,2015-06-17 20:31:45
8021797,489976,32639672,1,"Yes, good point. I will put it in the already existing bin directory.",271539133,2015-06-17 20:32:34
8021797,489976,32639768,39,"Duh for me !! ... you are right, that's even better (easier and cleaner). I will change it to mktemp instead.",271539133,2015-06-17 20:33:30
8021797,489976,32639785,2,On the way !!,271539133,2015-06-17 20:33:39
8021797,489976,32639862,7,That's right ... I will go for it and change it at the script.,271539133,2015-06-17 20:34:18
8021797,132262,32642057,29,"Hmm, that's very strange.  That should only happen if you're in a directory which already has an sbt-launch.jar.  Don't spend too much time on it, if you can't figure out why, just add a TODO.",271539133,2015-06-17 20:53:18
8021797,489976,32653545,29,"I've found the error -> The SBTOPTS from Travis CI are clashing with the internal ./sbt

So I just added unset SBTOPTS to the .travis.yml file and it works now and actually finagle's .travis.yml file has the save unset SBTOPTS configuration.",271539133,2015-06-17 22:42:45
8021797,489976,32664159,29,Oh oh !! ... the ./sbt of util is crashing at the JVM when using openjdk7 and scrooge sbt is working just fine. I will put a TODO by now.,271539133,2015-06-18 00:20:14
8021797,146404,32677485,5,"Can we say ""For users of the develop branch""? Seems a little clearer.",272021557,2015-06-18 02:33:17
8021797,146404,32677695,5,"Also, it might be a good idea to recommend publishing Util and Finagle locally for _anyone_ working on the develop branch—users may not have any idea whether Scrooge is using features that have been introduced since the last release, and if they guess wro",272021557,2015-06-18 02:35:10
8021797,489976,32677773,5,Of course. Here it goes !!,272021557,2015-06-18 02:36:00
8021797,489976,32678904,5,Ostrich is also a required local dependency when working on the develop branch.,272021557,2015-06-18 02:47:48
8021797,489976,32679029,5,"Anyway, I think that explanation is already included at https://github.com/twitter/scrooge/blob/master/README.md",272021557,2015-06-18 02:49:18
8409284,406208,34949113,1,This class was copied directly from Mustache.java because it wasn't released for Scala 2.11 on Java 7.,279922934,2015-07-18 21:15:41
8409284,132262,34951046,4,"please don't turn this off, it's extremely useful for making changes in libs that depend on other libs that haven't been published yet.",279925911,2015-07-19 01:04:03
8409284,132262,34951068,1,what does this do?,279925911,2015-07-19 01:05:45
8409284,132262,34951095,1,"I'm worried that this will cause big problems for folks who depend both on scala-extensions and scrooge.

Can you test that it doesn't cause problems?  Also, we shouldn't expose this publicly–although scrooge-generator isn't technically a library, I'm w",279922934,2015-07-19 01:08:05
8409284,406208,34957361,1,"Mostly it was to move the version declaration its own place since that helps a lot with regex-style code analysis (https://github.com/sbt/sbt-release), but I guess you don't use sbt-release anyways, maybe just sbt publish?
I can move it back to the Build",279925911,2015-07-19 16:17:56
8409284,406208,34957347,4,"Sorry, I'll put it back in!
Maybe there should be a ""snapshot"" mode in the build, like
`sbt snapshot compile`? Then it wouldn't be tied to the git branch name. E.g. in a setup with multiple remotes, ""eirslett-master"" is my local name for the eirslett/ma",279925911,2015-07-19 16:15:29
8409284,406208,34957325,1,"How about we shade it in? We change the package name and make it package-protected, so even if somebody uses scala-extensions, they won't collide?
`package com.twitter.scrooge.mustache.shaded.ScalaObjectHandler`",279922934,2015-07-19 16:12:04
8409284,120104,34958449,1,sorry if I'm dense.. is this class only used by scrooge generator? Not sure how a class with a different name that's used by a generator would conflict with something.,279922934,2015-07-19 19:15:01
8409284,120104,34958461,1,oh disregard.. I guess the original version shadowed a file.,279922934,2015-07-19 19:16:00
8409284,132262,34959268,1,"nah, I just didn't know what it did, I'd be happy if you stuck that into the patch–we'll have to change a small amount of tooling, but you're right that it will make our lives easier.  if you don't feel like putting it back in, not a big deal though.",279925911,2015-07-19 20:56:00
8409284,132262,34959342,14,"do we need this, or was this just a cleanliness thing?",279936815,2015-07-19 21:05:15
8409284,132262,34959331,4,"I'm not tied to a specific solution.  We can do that, but we should document it clearly and we should do it in util, finagle, ostrich, scrooge, and twitter-server at pretty much the same time so that it doesn't end up piecemeal.

Our feeling was that it",279925911,2015-07-19 21:03:40
8409284,406208,34960431,14,"Junit doesn't ship with mockito, so we don't ned to exclude it.
I bumped it to 4.12 just to stay up-to-date (version 4.10 is from 29-Sep-2011, version 4.12 is from 04-Dec-2014)
I'm not sure if this builds with 4.10 or not, I didn't really test. Do you w",279936815,2015-07-19 23:07:57
8409284,132262,34959258,17,can we still make this private-y?,279936815,2015-07-19 20:54:31
8409284,3414694,35014508,14,Typo: if a user...,280575916,2015-07-20 21:33:15
8409284,3414694,35016141,30,"So the new version works because mustache.java 0.8.17 works for scala 2.11 (except the extensions), right?

For future reference, what's not working with the old approach?",280575916,2015-07-20 21:48:36
8409284,406208,35021315,14,good catch; I fixed it.,280575916,2015-07-20 22:37:23
8409284,406208,35022202,30,"There are different versions of things at play here:

- Java 7 or 8
- Scala 2.10 or 2.11
- Mustache.java 0.8.17 or 0.9

We need to support Scala 2.11 with Java 7. Mustache.java from 0.9 onwards only supports Java 8, so we need version 0.8.17 of Must",280575916,2015-07-20 22:45:30
8409284,132262,35040008,14,"it's probably fine–we use 4.10 internally, but I don't think it'll cause any problems.  we probably can't use 4.12 features yet though.",279936815,2015-07-21 01:30:27
8409284,64314,35058770,3,"does this comment still apply? if so, can you add more color? otherwise, please rm.",279922931,2015-07-21 05:10:40
8409284,406208,35189558,3,"No, this PR fixes it. I removed the comment now.",279922931,2015-07-22 13:04:33
9693131,132262,41155567,2,could you change the copy here to reflect that there's more than one line you need to add?,321917426,2015-10-05 20:13:51
9908893,132262,42310803,5,let's mark it `private[this]`,332431493,2015-10-17 21:06:22
9913988,132262,42315365,15,"hmm, instead of using a default argument, could you overload the constructor?  I think that will ease binary compatibility.",332568714,2015-10-18 04:42:14
9913988,132262,42315379,23,is it valuable to scope these stats with a name?  it seems unlikely that a single service will expose more than one thrift server.,332568714,2015-10-18 04:43:49
9913988,132262,42315388,17,let's use the style `}.respond {` here.,332568714,2015-10-18 04:45:03
9913988,85201,42460372,17,"the generated code looks like follow:
it would be better to keep '`} respond { `, or we need to change all styles accorrdingly
```
try {
      __stats_call.RequestsCounter.incr()
      val args = Call.Args.decode(iprot)
      iprot.readMessageEnd()",332568714,2015-10-20 11:35:57
9913988,85201,42460388,23,"currently, all the server related stats are scoped with name. following are examples from my server, so I think we just follow the convention
""srv/XXServer/closechans"": 84,
""srv/XXServer/closed"": 84,
""srv/XXServer/closes"": 0,",332568714,2015-10-20 11:36:09
9913988,85201,42460418,15,done,332568714,2015-10-20 11:36:37
9913988,132262,42463329,17,"we've been switching over lazily–if you could do a bunch, it would be great, but it's ok to just switch over lazily too.",332568714,2015-10-20 12:27:51
9913988,132262,42463385,23,"ok, can you open a PR on finagle-thrift too then, so that we can thread the name through properly with the rich client interface?",332568714,2015-10-20 12:28:36
9913988,85201,42468017,17,done,332568714,2015-10-20 13:31:41
9913988,85201,42468031,23,will do,332568714,2015-10-20 13:31:53
10788166,1925,46660708,5,This fails to compile because ```containedValue``` in ```MorePerfectUnion``` is parameterless and it's return type isn't actually ```Unit``` so this shouldn't change.,352656997,2015-12-04 16:57:33
10788166,4635,46811149,5,Quite correct - have fixed now and is ready for checking as soon as the builds are done.,352656997,2015-12-07 19:31:24
10937396,132262,46989313,5,"since we're trying to avoid collisions, let's use _root_.java.lang.Override for good measure.",357130103,2015-12-09 02:03:48
10937396,2373645,46990261,5,"Sorry if I'm misunderstanding (or wrong :)), but isn't `_root_` only supported in Scala?",357130103,2015-12-09 02:11:51
10937396,132262,46997741,5,"ah, indeed!  my bad.",357130103,2015-12-09 03:05:27
13127717,64314,56721530,4,"2 small things:
# make this a `def` to keep the object size smaller
# include the return type `String` since this is public (mind doing it on `name` above while you are here?)",409407327,2016-03-19 04:00:27
13127717,64314,56721583,4,same comments as below,409407327,2016-03-19 04:00:52
13127717,64314,56721700,4,"can we scaladoc what `originalName` represents? 

i'm going to forget by the next time i look at this code.",409407327,2016-03-19 04:01:43
13127717,2519870,57220011,9,@kevinoliver Addressed your concerns. Let me know if there's anything else!,409549665,2016-03-24 02:14:10
13363783,132262,65009321,14,"these tests seem useful, why are you deleting them?",414010578,2016-05-30 01:27:17
14541594,64314,62708138,6,"yeah, i think we need it to work the same as it does in `Build.scala`.",441051555,2016-05-10 23:46:37
14541594,64314,62708183,2,"got it, thanks.",441051555,2016-05-10 23:46:55
14541594,64314,62708274,5,i see. ok lets leave them bundled.,441051555,2016-05-10 23:47:29
14541594,64314,62532353,24,can you leave comments documenting what these options mean,441051555,2016-05-09 23:51:15
14541594,64314,62532476,5,"am i correct that this is separate from the fix and enables testing of plugins? 

if so, can we split this into to two separate PRs?",441051555,2016-05-09 23:52:14
14541594,64314,62532584,2,i thought sbt plugins were 2.10 only?,441051555,2016-05-09 23:52:53
14541594,64314,62532692,6,these versions not correct when we are doing development. can we share the code thats in `Build.scala` for setting these?,441051555,2016-05-09 23:53:40
14541594,64314,62532837,3,this is pretty cool.,441051555,2016-05-09 23:54:40
14541594,573970,62535455,2,This version is the version of a test project using this plugin.,441051555,2016-05-10 00:11:19
14541594,573970,62535786,5,"Yes this enables testing of the plugin, but the test I added is for this specific fix. You want me to separate that into another pr with a project that doesn't test this issue first, just a simple test that the plugin generates a scala file?",441051555,2016-05-10 00:13:27
14541594,573970,62536119,6,"Yea I was hoping for some direction on what to do with these. I thought it might be ok if the plugin is backwards compatible, but if that is not the case, we could export some more props for these versions.",441051555,2016-05-10 00:15:42
14541594,573970,63228466,24,The documentation for scripted is here: http://www.scala-sbt.org/0.13/docs/Testing-sbt-plugins.html. Do you want me to just put that link in a comment?,441051555,2016-05-14 01:18:19
14541594,64314,63248201,24,that'd be awesome. thanks.,441051555,2016-05-14 03:42:26
14541594,7875,67076927,5,I think your diff is out of date. We've switched to use codecov.io in the latest code (instead of coveralls). You may want to re-base the branch.,464301942,2016-06-15 06:32:40
14541594,7875,82856836,5,As the comments above this section point out the configuration here should be in both Compile *and* test configuration. Hence this is a breaking change since it sets the output folder in the Compile configuration only. This probably needs to be modified t,465568591,2016-10-12 01:21:51
15106051,132262,65025997,14,not sure we should be changing this?,454753759,2016-05-30 12:56:24
15106051,132262,65026239,33,"instead of this, can we explicitly request scoverage 2.11 in the addSbtPlugin section?  Here's an example of what might be a simpler way to do this:

https://github.com/sbt/sbt/blob/83f35b18d348d36611570642833976d0f6520a60/sbt/src/sbt-test/dependency-ma",454753759,2016-05-30 13:02:02
15106051,132262,65026881,89,"we're still on 16.0.1, unfortunately",454753759,2016-05-30 13:08:26
15106051,132262,65027152,87,I'm not sure we can move off of this yet.  is there a reason we have to?,454753759,2016-05-30 13:10:25
15106051,80171,65098754,14,"not sure how you handle this internally, my thoughts were that since it depends on the 2.12 branch that has not been released it would be: increment latest release version and add suffix. if i don't increment i am essentially publishing a local snapshot v",454753759,2016-05-31 01:37:56
15106051,80171,65099061,33,nice find! going to try this out. if it works we can apply the same strategy to util and the rest that need the upgrade.,454753759,2016-05-31 01:43:45
15106051,80171,65101550,33,"Unfortunately, this didn't work. That syntax only changes the resolution path for the plugin itself. For example using the following in `plugins.sbt`:
```
addSbtPlugin(""org.scoverage"" % ""sbt-scoverage"" % ""1.3.5"", sbtVersion = ""0.13"", scalaVersion = ""2.1",454753759,2016-05-31 02:35:42
15106051,132262,65104235,14,"we change it as part of our release process, so we should be OK.",454753759,2016-05-31 03:26:53
15106051,132262,65104326,87,"ah, sorry, to be clear I meant move internally.  we need to do it ourselves because we have to maintain two build systems, the internal monorepo, and the public sbt.  sorry!",454753759,2016-05-31 03:29:07
15106051,80171,65099019,87,"nope, no direct reason, though it is possible if that's the path you want to take. i was just addressing your comment here: https://github.com/twitter/scrooge/issues/236#issuecomment-220889358",454753759,2016-05-31 01:42:32
15106051,132262,66837637,86,I'm bumping this internally too.,456013845,2016-06-14 00:57:47
15106051,132262,66837761,5,looks like we probably shouldn't bump scoverage for now.,456013845,2016-06-14 00:58:25
15106051,132262,66837861,62,I think we bumped this and scalatest so that we don't need to do this anymore.,456013845,2016-06-14 00:59:03
15106051,7875,67095835,37,"Can we keep this consistent with how we do this in other projects? I.e., how we do it in util [here](https://github.com/twitter/util/blob/develop/project/Build.scala#L30). I know it's redundant but would rather favor the consistency.",464237516,2016-06-15 10:46:20
15903088,132262,72455872,4,`private[this]` ?,483232117,2016-07-27 21:58:55
15913580,132262,72644170,19,"this is a breaking API change, can you add a note in the scrooge changelog?",483572956,2016-07-28 22:26:00
15913580,132262,72643841,5,could you add a comment as to why we need this?,483572956,2016-07-28 22:24:18
15913580,64314,84974277,36,"JMH has a very opinionated style of writing code and this goes against that.

instead, what you can do:
* lift the output streams into your `@State` class. then ""inject"" a state instance into your `Benchmarks`.  as an example, look at https://github.co",541781821,2016-10-26 01:50:33
15913580,64314,86585989,11,style nitpick: scala is moving away from procedure style methods. can you annotate the return type? `: Unit = {`,548942200,2016-11-04 23:46:20
15913580,64314,86585437,4,"please move this up to 4.x since 4.8 already shipped since you started this PR.

also, i think this is a ""New Feature"" instead of a ""Breaking API Change"", right?",548942200,2016-11-04 23:43:53
15913580,2158104,86910650,11,sure,548942200,2016-11-08 10:01:02
15913580,2158104,86501460,36,"thanks for the tips. updated
",541781821,2016-11-04 15:08:56
23181725,64314,110283612,1,lets remove this as well.,664172407,2017-04-07 05:40:07
23181725,64314,110283794,8,i don't see the generated gold files. this test should be failing without them.,664172407,2017-04-07 05:41:26
23181725,64314,110284396,295,remove,664172407,2017-04-07 05:45:28
23181725,64314,110284180,106,should this fail fast instead?,664172407,2017-04-07 05:44:19
23181725,64314,110283391,1,why is that? is it a future todo or not part of thrift for Node?,664172407,2017-04-07 05:38:26
23181725,64314,110284373,169,remove,664172407,2017-04-07 05:45:17
23181725,64314,110284002,18,-1 indent for this block i think,664172407,2017-04-07 05:42:53
23181725,64314,110283322,1,"mind omitting this file? its relevant internal to Twitter, but doesn't apply outside.",664172407,2017-04-07 05:37:53
23181725,64314,110283551,10,"please omit this, git will provide this info.",664172407,2017-04-07 05:39:42
23181725,64314,110284307,144,lua copy paste ???? ,664172407,2017-04-07 05:45:00
23181725,64314,110284645,1,omit the OWNERS file as explained above,664172407,2017-04-07 05:47:21
23181725,64314,110283949,10,"lets remove this, we have git for it.",664172407,2017-04-07 05:42:25
26900423,252777,130743008,16,let's move this down into the if(fatal warnings) block.,746566478,2017-08-02 05:14:18
26900423,252777,130742874,36,We have warnCount above; let's use that instead of subtracting here.,746566478,2017-08-02 05:13:32
26900423,252777,130743211,20,mind moving this down a line so it looks like the other case matches?,746566478,2017-08-02 05:15:24
26900423,4718322,130768335,16,fixed ???? ,746566478,2017-08-02 08:32:42
26900423,4718322,130768371,20,I think so. I moved it down.,746566478,2017-08-02 08:33:05
26900423,4718322,130768437,36,Sure. I fixed it.,746566478,2017-08-02 08:33:42
31117330,132262,152050738,5,"since we're changing this now, I don't think we ever use `settingsWithTwoTen` anymore.  can you delete that val?",841144105,2017-11-21 01:01:30
31117330,4718322,152624868,5,I removed this val in 1c690c2.,841144105,2017-11-23 01:00:28
39789813,7605529,196513671,5,"Second thought, I believe you need to also make this change to GoldService$FinagleService.scala and PlatinumService$FinagleService.scala. Can you run the test to confirm?",1026923756,2018-06-20 00:30:08
73183,87195,623450,16,"this should now be ""sbt-package-dist"" % ""1.0.0""",4616997,2012-03-30 02:43:04
40153,391246,481375,48,"Since you don't treat the different exception types specially when re-throwing, you can probably simplify this and just keep a list of thrown exceptions, then re-throw the exception at the head of the list if present.",4075382,2012-02-24 01:08:04
40153,49146,481429,48,"There is a priority, actually: ShardOfflineExeption, Throwable, ShardBlackHoleException. The execution logic in the job processor handles ShardOfflineException and ShardBlackHoleException specially.",4075382,2012-02-24 01:15:28
40153,391246,481531,48,"OK, looks good, then.",4075382,2012-02-24 01:28:41
40153,313605,481675,22,I think the scala practice is to use Option in such cases. Stu/Matt would be able to show you how.,4075382,2012-02-24 01:54:34
40153,313605,481681,48,Can you add a comment mentioning the reason for doing it this way?,4075382,2012-02-24 01:55:15
40153,449460,481912,48,Done.,4075382,2012-02-24 02:35:29
40153,449460,481913,22,Done. I used Matt's example. Thanks!,4075382,2012-02-24 02:35:58
41231,313605,481849,4,"Maybe call it job-bad-count for consistency. That way, all the job-* will be clustered together.",4094634,2012-02-24 02:21:14
49292,51152,556099,2,"I was noticing in another branch that this class is essentially unused, even in unit tests. Until we decide to remove it we should probably not implement new features like diffState for it (aka, throw 'NotImplemented').

EDIT: Well, I mean that we shoul",4248489,2012-03-14 14:10:14
49292,51152,556105,102,"Since the initial build of the forwardingTree is implemented inside the RoutingState class, this update logic should probably be in there as well for symmetry.",4248489,2012-03-14 14:15:12
49292,51152,556107,121,"Are diffs idempotent, or does this need to be done atomically with the forwardingTree puts?",4248489,2012-03-14 14:18:22
49292,51152,556114,6,"""that have been""",4248489,2012-03-14 14:21:03
49292,51152,556116,8,"""and possibly more"" deserves some more explanation.",4248489,2012-03-14 14:21:44
49292,51152,556134,78,"It seems like ordering matters here, unless I'm misunderstanding the table structure... what happens when a forwarding is updated and then later deleted, vs when it happens the other way around? Or will there be exactly one row per forwarding?",4248489,2012-03-14 14:27:15
49292,51152,556143,40,Could you add some comments here to indicate what you're doing? The mocking is pretty inscrutable.,4248489,2012-03-14 14:32:16
49292,449460,559862,2,Agreed. I made diffState() throw UnsupportedOperationException. Let me know if Scala has its own kind of such exception.,4248489,2012-03-15 02:44:56
49292,449460,559898,102,"Good point. Unfortunately, how RoutingState and reloadUpdatedForwardings work are significantly different: RoutingState builds a tree from already fetched Shard/Link/Forwardings data while reloadUpdatedForwardings access nameserver db for shard/link data ",4248489,2012-03-15 02:52:05
49292,449460,559947,121,"Diffs are not idempotent given the current implementation. If two diffs race with each other and if the one that started later (which should have newer data) finishes updating certain branches earlier, the one that started earlier (with relatively stale d",4248489,2012-03-15 03:01:25
49292,449460,559963,6,Done :),4248489,2012-03-15 03:04:38
49292,449460,560004,78,"Great point. I had to check this earlier too and forwardings table uses (table_id, base_source_id)  as its primary key so there will be at most one row per each forwarding. I'll add some comments to clarify it.",4248489,2012-03-15 03:10:35
49292,51152,560054,102,"Well, the boundary could be that you give a 'NameServerChanges' object and the current tree to a RoutingState method, and get back a new tree. Either way is fine I guess.",4248489,2012-03-15 03:20:32
49292,51152,560061,78,Excellent.,4248489,2012-03-15 03:21:34
49292,449460,560120,40,Done!,4248489,2012-03-15 03:30:19
49292,449460,560182,8,Done.,4248489,2012-03-15 03:37:27
59318,51152,587282,46,This is a good time for 'getOrElse { ...None-block... }'.,4390472,2012-03-22 01:38:00
59318,313605,587518,46,Done.,4390472,2012-03-22 02:26:46
63629,313605,593790,88,Maybe job-scheduler-uncaught-exceptions?,4431985,2012-03-23 04:16:43
63629,391246,593812,88,"Yeah, that would be more informative.",4431985,2012-03-23 04:20:59
69068,51152,606660,36,Is there something bulletproof protecting a thread in this pool from ever dieing?,4537032,2012-03-27 05:32:23
69068,51152,606689,36,"...yes, there is.",4537032,2012-03-27 05:40:04
980267,87195,3722,7,are you sure this fits in 100 chars? ;),29094855,2011-02-24 07:18:30
980267,49146,3723,7,curses! 120.,29094855,2011-02-24 07:21:39
980268,49146,3643,21,"Codec should be JsonCodec, I think",29094896,2011-02-24 02:35:13
980268,49146,3644,22,use a match here.,29094896,2011-02-24 02:36:24
980268,49146,3645,21,"On second thought, can we just rename JsonJob to Job, and JsonCodec to Codec?",29094896,2011-02-24 02:39:14
1430597,88857,4905316,17,We just bumped this to 1.1.1-SNAPSHOT - sorry about the commit race condition :(,39367015,2013-06-27 03:53:28
11234,85342,1325716,5,"Looking at http://maven.apache.org/plugins/maven-compiler-plugin/ we see:

""at present the default source setting is 1.5 and the default target setting is 1.5""

What jdk & maven versions are you building with?",2080154,2012-08-08 01:07:22
11234,26352,1325756,5,"Oracle JDK6 and Maven 2.2.1. Yup, maven is old; I forgot I had it downgraded for another project. Ignore if supporting old Maven isn't useful.",2080154,2012-08-08 01:10:10
11234,85342,1325808,5,"Aah yeah that makes sense. Can you install maven 3 somewhere, and use the newer maven version to build?

I appreciate the pull request, but would rather not support maven 3 unless it affects a lot of people.

Good catch with updating the hdfsdu.pig versio",2080154,2012-08-08 01:13:46
167535,7111,1415729,22,"are you sure this is the right order?

(f1 + f2)(x) == (f2(f1(x))?

I'm not too attached, but I'd like to hear a strong argument for one or the other.",6196503,2012-08-20 21:46:58
167535,7111,1415733,22,"you could write this as:

f1.andThen(f2)",6196503,2012-08-20 21:47:34
216127,7111,1437094,25,"Why is this needed? It's costing us to reverse twice, and I think padding at the end would be fine. Am I missing something?",6809527,2012-08-22 21:47:19
216127,7111,1437141,14,"Can you comment that you are using the implicit long to bytes conversion imported from HyperLogLog here, and that it is bypassing the hashing, which is why you can see what the resulting value is supposed to be.

(full disclosure: understanding this test ",6809527,2012-08-22 21:52:22
216127,7111,1437252,25,"Actually, the more I think about this, I'm not sure it makes any sense (even though I said it should).

Here's the issue, if the HLLInstance has a different size, then after the hash of an item, we compute j differently, i.e., we use a different number of",6809527,2012-08-22 22:10:20
216127,7111,1437321,26,"Since this operation is done a lot, I think it might be worth optimizing:

v.view.zip(other.v).map { pair => pair._1 max pair._2 }.toArray

The "".view"" says to not go ahead and make the intermediate output, but be lazy.  Nothing is actually done until the",6809527,2012-08-22 22:18:35
216127,7111,1437395,56,"why aren't we using zeroVector in the ""zero : HLLInstance""?

Shouldn't we move it just about that, and just point to the zero vector there?",6809527,2012-08-22 22:25:53
301073,568000,1479223,15,bites -> bits,8364198,2012-08-29 01:35:28
431376,7111,1698436,223,"I'd prefer to use Vector here, and then use updated to quickly (log-base 32 complexity) create a new table.

So, something like: case class CMSCountsTable(counts : Vector[Vector[Long]])

then make a new CMSCountsTable after each addition.  You could also ",13136554,2012-09-26 23:03:32
431376,7111,1698444,193,"Should this also extend Function1[Long,Int] ?",13136554,2012-09-26 23:04:11
431376,7111,1698451,150,Can this be moved into CMSCountsTable?,13136554,2012-09-26 23:04:53
431376,7111,1698449,200,Should be called apply?,13136554,2012-09-26 23:04:35
431376,7111,1698457,118,"This should be a val, right?  Isn't it always 0?",13136554,2012-09-26 23:05:30
431376,7111,1698482,91,Can this be a def instead? I don't like the var-iness.,13136554,2012-09-26 23:07:47
431376,7111,1698510,71,"Can you put the RAND just in scope inside this block:
```scala
val hashes : Seq[CMSHash] = {
  val RAND = new scala.util.Random(seed)
  (0 to (depth-1)) ...
}
```
That way, there is no member variable handing around that anyone can touch.",13136554,2012-09-26 23:10:53
431376,7111,1698689,36,This might make sense in the companion object for the Monoid itself. I guess everyone will redo this.,13136554,2012-09-26 23:21:57
431376,8579,1701929,71,Done.,13136554,2012-09-27 04:52:18
431376,8579,1701931,91,Done.,13136554,2012-09-27 04:52:26
431376,8579,1701932,118,Changed to def.,13136554,2012-09-27 04:52:43
431376,8579,1701940,150,"I don't think I can move it without changing a bunch of things, since every time I add a single element to `CMSInstance`, I call multiple update operations on `CMSCountsTable` (an update operation per row).",13136554,2012-09-27 04:54:02
431376,8579,1701943,200,Done.,13136554,2012-09-27 04:54:17
431376,8579,1701942,193,Done.,13136554,2012-09-27 04:54:14
431376,8579,1701957,223,"Aha, was wondering if that `updated` operation existed. Done.",13136554,2012-09-27 04:55:39
431376,8579,1702048,36,"Moved this into the class of the monoid, which already had a function to create a sketch out of a single item.

Should these be in the companion object instead? I put them in the class instead of the object since the monoid takes parameters, which are req",13136554,2012-09-27 05:11:06
450257,7053,2152817,31,Delete this.,14332576,2012-11-16 22:33:54
487132,7111,2208048,7,"Can we just implement the exact same hash method, that way we can be pretty sure we didn't break anything.

Also, I don't see the need for the seed, and then transforming it by going through Random. That is not adding any entropy, so I'd rather just be ",17199389,2012-11-23 02:25:57
603475,35101,2298941,47,it seems the whole point of the Max[T] class is so that you can implicitly get the MaxSemigroup. The downside is that if you want to use the MaxSemigroup you must box your type inside a Max object. Why not just let client code explicitly instantiate MaxSe,21138360,2012-12-04 04:45:14
603475,7111,2296948,47,"Can we put these in their own file, like OrderedSemigroup.scala

Also, I'd like to define something like:
```scala
//sigil class to document which monoid to use:
case class Max[T](get: T)

class MaxSemigroup[T](implicit ord: Ordering[T]) extends Se",21138360,2012-12-04 02:26:06
603475,7111,2296979,145,"This only requires T:Semigroup, I think, if we implement IndexedSeqSemigroup properly.  Please add a TODO.",21138360,2012-12-04 02:28:42
603475,7111,2296988,148,This only requires semigroup on V. Please add a TODO to add a MapSemigroup.,21138360,2012-12-04 02:29:19
603475,7111,2297002,149,"like above, add a TODO to make JMapSemigroup that only uses a V:Semigroup",21138360,2012-12-04 02:29:56
603475,7111,2297021,166,"While you're cleaning up, change this to:
```scala
implicit def mapMonoid[K,V:Monoid]: Monoid[Map[K,V]] = new MapMonoid[K,V]
```",21138360,2012-12-04 02:30:56
603475,7111,2297038,169,"```scala
implicit def eitherMonoid[L:Semigroup, R:Monoid]: Monoid[Either[L,R]] = new EitherMonoid[L, R]
```",21138360,2012-12-04 02:31:42
603475,7111,2297822,127,"Might be nice to add this function:
```scala
def from[T](associativeFn: (T,T) => T): Semigroup[T] = new Semigroup[T] { def plus(l:T, r:T) = associativeFn(l,r) }
```",21138360,2012-12-04 03:26:36
603475,7111,2297846,127,"If you like also add to Monoid:
```scala
def from[T](z:=> T)(associativeFn: (T,T) => T): Monoid[T] = new Monoid[T] { lazy val zero = z;  def plus(l:T, r:T) = associativeFn(l,r) }
```",21138360,2012-12-04 03:28:55
603475,7111,2299752,47,"The problem is the following:

What if you have a (Int, Int)

and you want the sum of the first item, and the max of the second?  Write the code for that.

My suggestion is to map the second entry onto Max(_) and then use the implicit monoid.",21138360,2012-12-04 05:46:42
603475,7111,2300456,47,"Also can you add to the ```object Max``` so we can compare Max[T] objects.

```scala
implicit def ordering[T](implicit ord: Ordering[T]): Ordering[Max[T]] = ord.on[Max[T]] { _.get }
```
similarly for Min.",21138360,2012-12-04 06:53:06
615369,7053,2341586,18,Maybe add a note that you should move the object code before this?,21742701,2012-12-07 04:29:25
615369,7053,2341639,147,Nitpicking: be consistent about space after comma.,21742701,2012-12-07 04:32:49
615369,7053,2341646,157,"Sam comma space nitpick. Not important, your choice.",21742701,2012-12-07 04:33:13
615369,7111,2341934,157,"Actually, I'm going to ignore this one. Calling, type parameters, and function definitions are three different cases as far as I'm concerned. I like the space on the function definition because there is twice the data there (name and type). In the other t",21742701,2012-12-07 04:52:16
615369,7111,2341952,18,Added the TODO below (just above the Monoid trait).,21742701,2012-12-07 04:53:38
615655,7111,2343099,4,Like this change.,21758159,2012-12-07 06:19:34
615655,7111,2343500,5,"I would recommend adding:

https://github.com/echen/algebird/blob/b50b08b1aaeeb4252794038af545e3b390eab6c2/src/main/scala/com/twitter/algebird/CountMinSketch.scala#L58

something like:
```scala
object CMS {
  def monoid(eps: Double, delta: Double, ",21758159,2012-12-07 07:16:05
615655,7111,2343871,88,"can you explain why this is correct or reference the paper/page etc... where this is shown? It looks credible, but I can't see immediately why this would be correct without rolling up my sleeves and starting to work it a proof.",21758159,2012-12-07 08:01:44
615655,7111,2344285,88,"http://www.eecs.harvard.edu/~michaelm/CS222/countmin.pdf

I see now. The paper has this and other query methods.",21758159,2012-12-07 08:51:45
618328,7111,2355179,7,"can you add another one:

(m1: Map[Int,Int]) =>
  Monoid.sum(m1.values) == Monoid.sum(removeZeroes(m1))
}",21872728,2012-12-08 06:38:45
618458,7111,2355598,63,"please add JBool and Boolean:

Metric.from[Boolean] = { (x,y) = if(x ^ y) 1.0 else 0.0 }

and similar for JBoolean.",21879339,2012-12-08 07:33:35
618458,7111,2355614,39,"should we make L2 and L1:
```scala
def L2Iterable[V] = minkowskiIterable[V](2.0)
```",21879339,2012-12-08 07:35:57
618458,7111,2355617,40,"remove Metric suffix.

This will read: Metric.minkowskiIteraableMetric, I prefer Metric to just appear once.",21879339,2012-12-08 07:36:27
618458,7111,2355623,43,I' know you love spacing: b: T,21879339,2012-12-08 07:38:00
618458,7111,2355628,75,nice contravariance!,21879339,2012-12-08 07:38:34
618458,7111,2355634,30,can you test Iterable too on an List[Int] or something?,21879339,2012-12-08 07:38:56
618458,7111,2355639,75,"I think this could extend Function2[V,V,Double], and use it some other places.",21879339,2012-12-08 07:40:19
618458,7053,2355689,30,Sure. Ill need to constrain iterables to be of the same size.,21879339,2012-12-08 07:54:25
618458,7111,2355724,30,"you can assume they are zero padded, right?",21879339,2012-12-08 08:01:01
618458,7053,2355898,30,Yeah that's a better solution.,21879339,2012-12-08 08:42:30
618458,7053,2356008,75,Makes sense to extend Function2. Where can I use that though?,21879339,2012-12-08 09:25:29
618458,8579,2356331,52,"The properties above should be checking >=, not >
So I think you want to change this to `beGreaterThanOrCloseTo` (or check `beGreaterThan || beCloseTo`, but I guess this is redundant if the > check is approximate)

Also, I'm confused by the middle cond",21879339,2012-12-08 13:13:12
618458,8579,2356333,38,"This is only checking one direction of the ""iff""
Also, maybe rename: `isZeroIffEqual`",21879339,2012-12-08 13:16:24
618458,7053,2356506,38,"Would this look right?

```scala
def isEqualIffZero[T : Metric : Arbitrary] = forAll { (a: T, b: T) =>
  beCloseTo(Metric(a, b), 0.0) || a != b
}
```",21879339,2012-12-08 16:09:58
618458,7053,2356507,52,"Yup, fixing.",21879339,2012-12-08 16:10:25
618458,7053,2356522,39,"Sure, both for Map and Iterable.",21879339,2012-12-08 16:24:16
618458,8579,2357456,58,"No need for the first `a > b`, since `eps` should be positive.

Also, should we move these methods out somewhere they can be shared? The first one is duplicated in a couple places.",21879334,2012-12-09 04:20:42
618458,8579,2357458,42,"This will be satisfied even if a != b, but d(a, b) = 0.

Maybe: if (a == b) beCloseTo else !beCloseTo?",21879334,2012-12-09 04:23:08
618458,7053,2358814,58,I'll add a TODO and an issue to do this later.,21879334,2012-12-10 02:09:23
618458,7111,2358828,42,I agree with Edwin. ,21879334,2012-12-10 02:22:07
618458,7111,2358921,50,"don't you need the epsilon here? ( beCloseTo(aVal, 0.0) )?",22006406,2012-12-10 03:17:45
618458,7111,2358924,50,I guess you don't if the test passes (but I guess you are checking the isEqualIffZero case rarely for these random tests.,22006406,2012-12-10 03:19:27
626934,7111,2358842,37,"I think we need associativity here.

scale(scale(a, x), y) == scale(a, x*y)

Otherwise our intuition will be bad.",22004497,2012-12-10 02:35:48
626934,7053,2358844,37,Agreed.,22004497,2012-12-10 02:39:10
626934,7111,2358892,24,"Can we get a test for Map[Int, Double] too?",22005606,2012-12-10 03:00:18
626934,8579,2360283,32,"Do you also want distributivity over scalar plus? (i.e., `forAll(v : T, a : Double, b : Double) => (a + b)v = av + bv`)

It's another vector space property. I guess it's unclear to me what this scaling operator is supposed to be.",22005606,2012-12-10 11:12:49
626934,7053,2360287,24,Added it. Note that I copy pasted the approximate map equality code. I added an issue that we should fix this at some point.,22005606,2012-12-10 11:13:03
626934,7053,2360300,32,"Yes you do need that. We might as well add all the properties of scalar multiplication in a vector space. Maybe it makes sense to rename this class at some point? This is starting to look more and more like a Group.

Any thoughts Oscar?",22005606,2012-12-10 11:18:53
626934,8579,2360377,32,"Where's the Algebird manifesto! If we abandon our explicit algebraic structures, we will be lost forever!",22005606,2012-12-10 11:40:06
642621,7111,2374235,26,"I don't really know what I was thinking here,  if time/halfLife > 1023, this will overflow to infinity.

I think we are going to have to use the log-space, as we do in DecayedValue.

So, I guess it is a false generalization to make F anything where we",22147992,2012-12-11 12:16:13
642621,7111,2374241,14,Why the Metrix?,22147992,2012-12-11 12:16:35
642621,7053,2374259,26,"Hey, it's alright! This will make the code look much cleaner for sure.",22147992,2012-12-11 12:19:33
642621,7053,2374363,14,The Metrix is all around us. That's why.,22147992,2012-12-11 12:36:42
652033,7053,2387079,71,"Minor: same lines as 65-66, maybe dedup.",22254778,2012-12-12 07:14:05
665432,7053,2402910,14,Lets put back these methods to allow backwards compatibility.,22406919,2012-12-13 09:05:01
665432,7053,2402913,43,Same here.,22406919,2012-12-13 09:05:11
682355,7111,2427642,5,"no need to specialize on Byte. Java keeps maps of these, so the cost to go to/from primitive is low. It's the larger space ones that are issues (Int/Long/Float/Double).

Specialization bloats the generated code, so I would remove the Byte specialization",22647879,2012-12-15 08:09:59
682355,605979,2430823,5,"Ah!  So I guess boxing of bytes is ""free"", as for booleans.  I actually didn't know this, but in retrospect it makes perfect sense.

Perhaps I should then rescind this change entirely from the pull request?  I definitely think Max and Min should be spec",22647879,2012-12-17 05:44:30
682355,7111,2431825,5,Okay. Lets just add an issue to add specialization for max/min/first/last.,22647879,2012-12-17 11:52:10
682355,7111,2431845,169,"Monoid.plus(maxRhow, oMaxRhow) would work here.

I think there is no need to capture the implicit monoid in HyperLogLog",22647879,2012-12-17 11:58:41
682355,7111,2431948,186,"I think a faster algorithm is:
```scala
maxRhow.foldLeft(ov) { (oldDense, jmax) =>
  val (j,max) = jmax
  if (oldDense(j) < max.get) oldDense.updated(j, max.get)
  else oldDense
}
```
This way, you only do as many operations as the size of the spa",22647879,2012-12-17 12:33:56
682355,7111,2431956,186,"By the way, this code handles both cases efficiently (both of your if branches)",22647879,2012-12-17 12:36:02
682355,605979,2439159,169,Good catch... the explicit monoid was a holdover from a prior iteration.. it's clearly correct to use implicits,22647879,2012-12-18 02:23:53
719501,7111,2431803,81,I think this should be a lazy val since it gets called in the contains method.,23073643,2012-12-17 11:44:40
721028,7111,2432029,237,"I think you can replace heavyhitterorder with Ordering.by { h: HeavyHitter =>   (h.count, h.item) }",23086097,2012-12-17 12:57:07
721028,7111,2492473,266,"toSet is not needed here.  SortedSet[Long] is an instance of Set[Long].  I *assume* toSet on SortedSet returns this, but I'm not sure of it.  Removing it is clearest that there is no extra copy.",23732392,2012-12-22 03:27:56
721028,7111,2492498,62,"might be helpful to note that the size of the heavyHitters set is always less than 1/heavyHittersPct.  So, 1% means at most an additional 800 bytes of data to store the heavy hitters (in most cases much much less since most distributions don't have so man",23732392,2012-12-22 03:30:52
721028,44017,2492781,62,"Note that having this upper bound also makes it reasonable to use something like SortedTakeMonoid which has a fixed size (or, a fixed-size max-heap representation).",23732392,2012-12-22 04:02:24
721028,8579,2494730,266,"Done. I was using the wrong `SortedSet` import earlier, so it actually failed without the `toSet`.",23732392,2012-12-22 15:52:54
723387,7111,2438247,9,"small note, I think this is the exact same as:

```scala
require(left.size == right.size, (""IndexedSeqSemigroup is only defined for sequences "" +
   ""of the same length, but left.size == %d and right.size == %d"").format(left.size, right.size))
```",23132017,2012-12-18 01:18:14
723387,7111,2438403,13,"One approach we could use is to take the prefix which is the size of the shorter list, and do plus on that, and then take the suffix which is the part in the longer one that has no corresponding part on the other side, and append that to the end of the re",23132017,2012-12-18 01:28:33
723387,7111,2438407,6,cool trick.,23132017,2012-12-18 01:29:03
723387,35101,2438641,9,thanks; didn't know about require,23132017,2012-12-18 01:47:51
723387,35101,2438710,13,"yes, your idea will make IndexedSeqSemigroup semantically  identical to IndexedSeqMonoid, which means we can replace IndexedSeqMonoid entirely with IndexedSeqSemigroup (since it no longer uses zero). I'll do that on the train ride home today.",23132017,2012-12-18 01:54:19
723387,7111,2439128,13,Cool!,23132017,2012-12-18 02:22:01
762572,605979,2504806,123,"... and the optimal choice of density cutoff is also sensitive to T.  I was envisioning that the user would put

```implicit val myMonoid = new SparseIndexedSeq[MyType](myLen, mySparseFactor)```

somewhere in scope before using this feature.",23967877,2012-12-27 01:56:06
762572,7111,2520388,123,Good point. A default Monoid on this doesn't make sense.,23967877,2012-12-30 02:29:42
762572,7111,2520393,40,"This is also backwards for a non-commutative monoid.

PS: Can you add a test of the monoid laws on this using the T = String?  That monoid is not commutative, and it should expose any problems we have there.",23967877,2012-12-30 02:31:46
762572,7111,2520395,123,Agree.,23967877,2012-12-30 02:32:15
762572,7111,2495138,62,"this is reversing the order of the plus, right?

So, if the + is not commutative, this will break, won't it?",23967877,2012-12-22 23:21:46
762572,7111,2495147,123,"I don't think scala will be able to find this Monoid implicitly without additional code.

Can you remind me again why you don't lift the SparseIndexedSeq trait up by itself, then have private [algebird] instances that you have here, and use the SparseIn",23967877,2012-12-22 23:27:59
762572,44017,2495199,123,"I can see getting an implicit Semigroup with that approach, but how do you define zero? You need to know the total length (and maybe the sparse threshold).

For the same reason, you don't have an implicit HyperLogLog Monoid either, do you?",23967877,2012-12-23 00:40:49
762572,44017,2495202,62,"Ah, true, I was assuming commutativity, which I shouldn't have been. That'll make the code uglier :(",23967877,2012-12-23 00:43:25
812610,7111,2208059,140,"I might put an assert(w == width, ""Mismatch on width"") or something.",23570696,2012-11-23 02:28:22
812610,7111,2208075,173,"We have a murmur128 implementation now, I would prefer that (see src/main/java/...)",23570696,2012-11-23 02:30:44
812610,7111,2208193,140,"Actually, I missed the require above, never mind.",23570696,2012-11-23 02:54:13
812610,7053,2228586,34,This line is a bit long and hard to read. Would it be possible to break it up?,23570696,2012-11-27 05:40:36
812610,7111,2229184,34,a line break after the = would probably be fine.,23570696,2012-11-27 06:38:18
812612,7111,1918649,51,Can't we use MD5 here until we find an implementation of murmur128 that doesn't pull in all of guava?,17276332,2012-10-23 22:03:45
812612,44017,1920584,51,I'd forgotten about java's MessageDigest. We could also use SHA512. It'll be a performance hit but probably not really worth worrying about. I'll make that change on the weekend.,17276332,2012-10-24 00:41:49
812612,12202,1923939,51,"We could simply use something from the ASF by copy/pasting the code, see this #8

If you go that route, leave the copyright headers intact and just update the NOTICE file for attribution purposes",17276332,2012-10-24 06:29:48
812612,44017,1924516,51,"Great suggestion Chris, thanks. I've pushed a change that brings in cassandra's version and provides a scala wrapper. It's totally untested though (beyond making sure it compiles), so I don't suggest you guys merge yet, just take a look at the code.",17276332,2012-10-24 08:38:30
812613,7111,1845342,15,"Actually, if we want to be slightly more lax here, we could do:

if (items.isEmpty) { monoid.zero }
else { items.reduce { reduce(_,_) } }

This allows us to work with non-empty lists of semi-groups (things, such as Either[L,R], that don't have valid ",17276323,2012-10-15 23:23:16
812613,44017,1845379,15,"That's what the implementation in the base Aggregator trait is for; if you have a semi-group, don't use MonoidAggregator.",17276323,2012-10-15 23:25:47
812614,7111,1824874,14,Can you change that to MomentsGroup?,17276345,2012-10-12 04:01:56
812614,7111,1824875,5,Change to Moments Group laws?,17276345,2012-10-12 04:02:12
812615,7053,1802514,19,Can you comment on the explicit different between this and ```Monoid[List[T]]```?,17276357,2012-10-10 05:28:58
812622,44018,1314786,4,Thank you ScalaCheck!,2441897,2012-08-07 00:18:42
812628,8579,2217920,44,"1. Should you pull commutativity into the pseudoring as well? That's what I'd assume, which agrees with http://en.wikipedia.org/wiki/Pseudo-ring. (And, practically, it seems like the existence of a one is the only possibly tricky thing anyways.)
2. I thi",23570752,2012-11-26 09:18:57
812628,7111,2224552,44,"I made these changes. Good catch on pseudo-ring extending an abelian group.

As for the zeroAnnihilates test, I removed it as you suggested, but keep in mind, even if it can be proved from other axioms we are testing, it is still worth testing. This is ",23570752,2012-11-27 00:10:42
812637,44017,2493465,23,"Do you actually see a use case for this in a map/reduce context? I get it in the storm/etc context, but I wonder if this should be part of summingbird's realtime support rather than algebird, because other systems (like hadoop) have other ways of ensuring",24584711,2012-12-22 05:38:11
812637,7111,2493813,23,"Fair point. You could use this or something very like it to implement AggregateBy in cascading, but that is already implemented and very unlikely to use this approach (and in any case, is more about summing a Map until the map has a certain size keys/valu",24584711,2012-12-22 06:37:55
837360,7111,2761232,60,"I don't think you need a Monoid[L], just a Semigroup[L]. You only get the zero of R.",26435499,2013-01-24 23:57:37
837360,605979,2763313,60,Good call.,26435499,2013-01-25 01:59:09
837360,12202,2745040,0,Please add copyright/license headers to source files.,26082284,2013-01-24 00:20:03
842421,7111,2761378,15,Is this one needed?,26437496,2013-01-25 00:05:27
842421,7111,2761602,18,"Can you add a comment to the effect of:
Enrichment pattern to make the C(ompressed)BitSet look more like a scala bit set?

Also, can you add a TODO to just make a wrapper of CBitSet as a scala.collection.SortedSet[Int]? With that, we wouldn't need the ",26437496,2013-01-25 00:17:57
842421,7111,2761787,67,"I think we should just return this here, right? we know 0 + this = this.",26437496,2013-01-25 00:28:54
842421,7111,2761831,69,"I think this should move to BFInstance following the rule that each class handles itself and ""lower"".  Then you call bf ++ this here (actually you can put that in the case _ => other ++ this.",26437496,2013-01-25 00:30:51
842421,1266377,2764748,18,done,26437496,2013-01-25 03:24:01
842421,1266377,2764750,57,done.,26437496,2013-01-25 03:24:06
842421,1266377,2764746,15,"no, done.",26437496,2013-01-25 03:23:50
842421,1266377,2764766,68,done.,26437496,2013-01-25 03:24:51
842421,1266377,2764759,47,done.,26437496,2013-01-25 03:24:36
842421,7111,2761629,57,"I prefer not to take the enrichment here, can we just take CBitSet?",26437496,2013-01-25 00:19:36
842421,7111,2761638,17,"Also, add a TODO: in scala 2.10 this should be a value class (extend AnyVal).",26437496,2013-01-25 00:20:21
842421,7111,2761780,47,"Please move this into BFSparse. The general rule should be (IMO) that all classes handle themselves, and lower, otherwise delegate (by reversing the order of the addition), so you can actually change this to:
case _ => other + item",26437496,2013-01-25 00:28:31
842421,7111,2761803,68,"looks like this ping-pongs back to this class to call: this + item, can we just be direct here?",26437496,2013-01-25 00:29:32
842421,1266377,2764756,17,done.,26437496,2013-01-25 03:24:30
842421,1266377,2764762,67,"done,",26437496,2013-01-25 03:24:41
842421,1266377,2764767,69,done.,26437496,2013-01-25 03:24:57
975840,13840,2918275,5,Nice!,29069773,2013-02-07 05:11:55
976860,44018,2932017,67,Do you want to take this as a constructor param and instantiate this particular cache in the companion object? This makes it easier to use this with custom caches later. You could hide it behind a cache trait as well to really stage us.,29075365,2013-02-08 02:30:02
976860,44018,2932100,30,"Add documentation about what this is doing. I can read it in the code, but something about how this condenses the number of items in the iterator by routing each item through the StatefulSummer would be good.

Man, I'm excited for value classes. I actua",29075365,2013-02-08 02:35:11
976860,44018,2932126,4,`class SummingQueue[V] private (capacity: Int)(override implicit val semigroup: Semigroup[V])`,29075365,2013-02-08 02:36:35
976860,7111,2953720,67,"Can we punt on this now? I'll add a TODO. I don't know the best cache trait right now. I made the constructor private so we can easily support something better by adding more constructors to the object.

Sound okay?",29075365,2013-02-10 01:57:52
976860,44018,2954080,67,For sure,29075365,2013-02-10 05:53:00
1152035,7053,3024300,34,Maybe add a helpful error message to this?,29641168,2013-02-15 10:18:22
1193147,44018,3142289,28,Arbitrary.arbitrary[T].map ,33270693,2013-02-26 03:43:59
1231192,7111,3302910,28,"can you move the order to be:
```scala
def foldM[M[_],T,U](acc: T, xs: GenTraversable[U])(fn: (T,U)=>M[T])(implicit monad: Monad[M])
```
So the ordering matches the way we normally write (and we can do):
```scala
foldM(0, List(1,2,3,4)) { (x,y) => i",35691968,2013-03-09 02:47:33
1243926,7111,9201421,23,"don't extend function, creates implicit conversions.",36187324,2014-01-28 02:16:31
1243926,7111,9201446,23,self has caused issues with serialization. Be explicit with val self = this where needed.,36187324,2014-01-28 02:17:01
1243926,7111,9201508,23,"I think Hashable32, Hashable64, Hashable128 might be better approaches. There is a false generality here that blurs with Function in a non useful way. This trait is indistinguishable from Function, and that's silly.",36187324,2014-01-28 02:18:12
1256108,44018,3404585,29,Should this be opposite? `List[T]` > `Nil`?,36495838,2013-03-17 08:00:33
1256108,7111,3404586,29,any non zero list is > Nil.  -1 means Nil < _,36495838,2013-03-17 08:01:52
1257785,7111,4765320,10,If you add extends Serializable here I will merge (if the tests are green).,36506210,2013-06-19 09:25:22
1257785,7111,4765329,118,`UpperBounded[H]` would be good here,36506210,2013-06-19 09:27:04
1257785,7111,4765335,83,shouldn't this take MinHashSignatures?,36506210,2013-06-19 09:28:16
1257785,7111,4765337,71,MinHashSignatures here?,36506210,2013-06-19 09:28:36
1257785,7111,4765341,95,MinHashSignature?,36506210,2013-06-19 09:28:59
1257785,504464,4772743,10,isn't a case class always Serializable? or are you referring to the object?,36506210,2013-06-19 18:56:24
1257785,7111,4781301,10,the object. I think you are right about case class.,36506210,2013-06-20 00:24:51
1257785,504464,4781872,118,can you explain? i dont follow. thx,36506210,2013-06-20 00:48:19
1257785,7111,4799202,118,I was just saying if we implemented #166 we could use that typeclass here.,36506210,2013-06-20 20:23:45
1257785,504464,4799961,118,"ah ok got it


On Thu, Jun 20, 2013 at 11:23 AM, P. Oscar Boykin
<notifications@github.com>wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/MinHasher.scala:
>
> > @@ -99,36 +125,34 @@ abstract class MinHasher[H](targetThreshold : Dou",36506210,2013-06-20 20:55:23
1260401,44018,3444676,22,"can you make these bastards variables? (""com.twitter"", etc)",36521619,2013-03-20 08:32:37
1260401,44018,3444724,42,So sexual.,36521617,2013-03-20 08:44:45
1268054,7111,3477277,32,Can we change the type here to Seq[(K) => Int] which abstracts us from the internals a bit better (should just work to change that).,36571328,2013-03-22 01:00:24
1268054,7111,3477321,205,"is V needed here?

Can we make this Seq[(K) => Int]?",36571328,2013-03-22 01:02:13
1268054,7111,3477370,28,"Can we store the equivalent intergers to eps and delta? i.e. width and depth?  Integers are easy to reason about exactness, etc...

You have the method in the companion object to create a monoid given eps/delta for that, you can just use the functions i",36571328,2013-03-22 01:04:39
1268054,7111,3477383,59,"I think we should take `kv: (K,V)` here to be consistent with create, and note that the application becomes cleaner: zero + kv.",36571328,2013-03-22 01:05:46
1268054,7111,3477402,205,let's just take width and depth here. Again it makes serialization easier. You can convert back at runtime with the SketchMap companion object.,36571328,2013-03-22 01:06:51
1268054,7111,3477433,274,Please add a comment about the jank here: scala 2.10 is more strict on recursive implicit resolution.,36571328,2013-03-22 01:08:45
1268054,7111,3477549,243,"Can you put this in a separate file and call it: AdaptiveMatrix[V] and remove the implicit monoid from the constructor?

You can add a companion object:

object AdaptiveMatrix {
  def empty[V](rows: Int, cols: Int): AdaptiveMatrix[V]
  implicit def ",36571328,2013-03-22 01:13:57
1268054,7111,3477558,261,"Make this method take an implicit Monoid[V], don't make it global.",36571328,2013-03-22 01:14:16
1268054,7111,3477654,272,Use the code in the monoid you make above rather than here (that monoid will already have the Monoid[V]).,36571328,2013-03-22 01:18:27
1268054,7111,3477765,218,"Can this be a private inner class of SketchMapMonoid?

We've found the smaller the public API surface area is, the easier it is to keep things compatible.",36571328,2013-03-22 01:23:31
1268054,72576,3477825,205,"I think the problem with storing width/depth is that the reverse conversion isn't accurate, since a width can map to many different eps values due to rounding.",36571328,2013-03-22 01:27:07
1268054,7111,3480192,45,"Can you change context to ""rowsByCols"" or something that indicates whether the rows ares on the outer vector or the columns are?",36591672,2013-03-22 03:22:47
1268054,7111,3480210,85,"V is not needed here, right?  Can't we remove the V type parameter?",36591672,2013-03-22 03:23:36
1268054,7111,3480218,90,Can we make this a def so we don't waste the memory on storing it? (same for delta).,36591672,2013-03-22 03:24:12
1295347,44018,3537837,7,It's actually weird that this doesn't happen by default. I wonder if this is hurting us elsewhere.,37518322,2013-03-27 01:09:23
1295347,7111,3541422,7,"How do you know this fixes your issue?  I'm very confused as to how this is doing anything.  You are redefining the same implicit monoid.

Can you provide a gist of a failed test without this and explain the mechanism?  This looks like we are hacking ar",37518322,2013-03-27 04:13:19
1295347,72576,3543256,7,"Looks like my failed test was due to other silly reasons, it doesn't seem to be a problem. (the test passes without that line). I'll update the diff to remove the change, since the test is still useful.",37518322,2013-03-27 06:18:29
1301877,7111,3605894,22,Shame we can't do this like: `Monoid.forProduct[Metrics]` Is there any way you can think of doing that?,37564530,2013-04-01 23:43:46
1301877,990797,3606706,22,"I'd like that as well, but I don't think it's possible without using either reflection or macros...

It *is* possible to drop a little bit of the boilerplate here if we only want to handle case classes and other `Product`s, since that gives you another ",37564530,2013-04-02 00:30:56
1304368,12202,3646882,1,copyright header,37582735,2013-04-04 03:58:24
1304368,7111,3693063,3,"Why not just use the monoid?  I'm not really sure what we gain in terms of accuracy by using the negative.

On the other hand, a lot of things are monoids that aren't groups.",37582735,2013-04-08 17:31:35
1304368,44017,3697628,3,I'll admit that this is largely cargo culting. The rationale I've seen is that it keeps the expectation of each bucket at zero. Why this is actually important/useful is not entirely clear to me but it does vaguely sound good. Maybe somebody else has a com,37582735,2013-04-08 21:26:40
1304368,7111,3700997,12,"Can you put the return type (which helps us avoid breaks in binary compatibility for public APIs).

Also, I'd rather this API:
```scala
def init[K <% Array[Byte]](kv: (K,V)): AdaptiveVector[V] =
```
Then in the scope that you need you can do: `impli",37582735,2013-04-09 00:19:12
1304368,7053,3703737,20,Nitpick: add a newline.,37582735,2013-04-09 02:43:22
1304368,7111,3718397,5,Can you remove this comment?  We use this to publish.,37582734,2013-04-09 22:40:08
1304368,44017,3704032,12,"Yeah, I don't use view bounds instinctively yet. Will update.",37582735,2013-04-09 02:59:39
1415987,7111,4027784,100,"Can you at least describe what this should return?

Also, can this be private?",38867099,2013-05-01 02:07:30
1415987,44017,4028119,100,"Sure, done.",38867099,2013-05-01 02:21:29
1415987,7111,4028669,50,why the difference in construction in Long vs the Double case?,38869258,2013-05-01 02:43:15
1415987,44017,4028791,50,"For a Long, it doesn't make sense to use negative powers of 2 in your ranges; the smallest dyadic interval you care about is (k*2^0, (k+1)*2^0). For a Double, though, all of your values might be concentrated in some small range, so you want to be able to ",38869258,2013-05-01 02:48:08
1415987,7111,4028813,138,"I think a match is better here:
```scala
(a, b) match {
  case (Some(qa), Some(qb)) => Some(mergeWithPeer(qa, qb))
  case (None, _) => b
  case (_, None) => a
}
```",38869258,2013-05-01 02:49:15
1415987,7111,4028892,66,can't this have a zero since A does?,38869258,2013-05-01 02:52:26
1415987,7111,4028978,225,"this is costly to compute, right? We might want to document as such.",38869258,2013-05-01 02:56:00
1415987,44017,4029136,66,"It could, sort of, but it wouldn't be very well defined. What's the median of an empty list? What are the upper and lower bounds? We could come up with arbitrary answers to these things, and write some special case code to deal with them, but alternativel",38869258,2013-05-01 03:01:19
1415987,44017,4029188,225,"It's also unlikely to be used outside of tests, and easy to cache or even pre-compute if it turns out to be, I just didn't want to use the memory.",38869258,2013-05-01 03:03:08
1415987,44017,4029300,138,"*shrugs* Sure, done.",38869258,2013-05-01 03:07:44
1415987,7111,4029327,66,Got it. Let's stick with this.,38869258,2013-05-01 03:09:28
1512723,7111,4765355,7,can we remove thi with BufferableImplicits which bloat the type and instead do `import BufferableImplicits._` to get them from the object?,42803629,2013-06-19 09:31:44
1512723,7111,4765367,6,this abd ByteBuffeReader probably should go in Bijection (but you can put them here first to move forward).,42803629,2013-06-19 09:33:50
1512723,13840,4375901,8,"Ooops, `implicit` appears twice in the params list?",42705675,2013-05-24 10:13:29
1610382,7111,4763765,11,Numeric isn't specialized so this will loose all benefit of having Ring specialized if we put the primitives here.,46119211,2013-06-19 05:55:06
1610382,44018,4775892,11,"Gotcha, sounds good to me. Since this compiles, I think that having the instance in implicit scope doesn't knock out the other instances. Keep the others and replace BigInt here?",46119211,2013-06-19 20:58:29
1610382,7111,4781278,11,"Yeah, keep the others, replace BigInt, and remove the specialized annotation form NumericRing.",46119211,2013-06-20 00:24:04
1611153,7111,4763739,31,"I'm nervous about binary compatibility here. Can we get a non anonymous class for the public API? Something dumb like:
```scala
trait WithProb {
  def withProbAtLeast(p: Double): Boolean
}
``` 
then return a new one of those.",46142246,2013-06-19 05:52:32
1611153,7111,4765440,35,"is this correct? If P(x) >= p, then P(not x) < (1 - p) because all we know is that P(x) + P(not x) = 1.

Seems like the bound is wrong here.  Seems like we need to return Option[Boolean] because sometimes we just don't know.

I think you need withProb",46142246,2013-06-19 09:42:42
1611153,301,4766567,35,Agree. This method actually does both: `atLeast` when `isTrue == b` and `atMost` when `isTrue != b`. Maybe choose a better name for it? How does `boundedBy` sound?,46142246,2013-06-19 12:06:40
1611153,7111,4781651,35,"I think we need to have two different method names: withProbAtLeast and withProbAtMost.

Also, maybe the name should be, mustBe rather than is.  So, (x mustBe true withProbAtLeast 0.9) because it MAY still be true, these are just bounds on probabilities",46142246,2013-06-20 00:39:14
1611153,301,4791239,35,Added another commit. Did I get it right?,46142246,2013-06-20 12:47:52
1611153,7111,4798589,8,"this is not correct. If line 69 is true and 71, then prob == a.withProb, which is not what this guarantees.

This value should either be None or false depending on how to interpret this method.

I guess it can be false, but it means something like, ""c",46489776,2013-06-20 19:58:35
1611153,7111,4798606,36,correct.,46489776,2013-06-20 19:59:05
1611153,7111,4798662,40,"this is not correct. we know Prob(serf.isTrue) >= withProb, but it may even be 1, so there is no upper bound.",46489776,2013-06-20 20:01:55
1611153,7111,4799001,41,"if P(x) >= q, then (P(not x) < (1 - q))  So, I think that this method is just:
```scala
  (self.isTrue ^ b) && (self.withProb < (1 - prob)) 
```",46489776,2013-06-20 20:16:21
1611153,7111,4799054,36,"I think the whole method is this part:
```scala
(self.isTrue == b) && (self.withProb <= prob)
```
If the above is not true, we just don't know.",46489776,2013-06-20 20:18:23
1611153,301,4800255,8,"Alright, I got it now.",46489776,2013-06-20 21:06:56
1611153,301,4814855,8,"So would something like
```scala
approxBoolean isEptirically b withProbAtLeast prob ==
    (approxBoolean mustBe b withProbAtLeast prob) ||
    (approxBoolean mustBe !b withProbAtMost (1 - prob))
```
be useful? I'm still trying to justify the usecas",46489776,2013-06-21 14:14:57
1615639,7111,4765100,17,"Let's not put this in the monad package (since it isn't one as far as I know). Just algebird, I suppose.",46254993,2013-06-19 08:53:59
1615639,7111,4765110,53,"This comment doesn't make sense outside of the summingbird context, Just delete it the second and third lines.",46254993,2013-06-19 08:55:49
1615639,7111,4765124,29,"there is no BatchID here, change to Int and instead of .next just do (x + 1)",46254993,2013-06-19 08:58:35
1615639,7111,4765126,32,same as above.,46254993,2013-06-19 08:58:46
1615639,7111,4765132,26, just copy the generator for an Interval over (from the Generators file in Summingbird).,46254993,2013-06-19 08:59:30
1615639,7111,4765135,22,don't need these imports I guess.,46254993,2013-06-19 08:59:43
1615639,7111,4765145,23,"I think there is already something called this:

https://github.com/twitter/algebird/blob/develop/algebird-test/src/main/scala/com/twitter/algebird/MonadLaws.scala

Can we change it MonadInstanceLaws (or something) to be clear we are testing a few spe",46254993,2013-06-19 09:01:43
1627554,7111,4879957,19,where is negate here? (or minus)?,46639945,2013-06-26 03:44:39
1627554,7111,4879977,30,add a TODO to make it a VectorSpace (if we can fit it into the type class),46639945,2013-06-26 03:45:51
1627554,7111,4879999,7,this is LGPL. I don't think we can use it in Apache projects.,46639945,2013-06-26 03:46:55
1627554,7111,4880010,18,can you check the tests and have it randomly verify that this is really a group?,46639945,2013-06-26 03:47:35
1627554,12202,4880080,7,"JavaEWAH is great, the other library not so much.

Looks like author of the library is on Twitter? You can reach out to him and ask him to re-license under Apache/MIT (or dual license):
https://twitter.com/NotSoOptimal",46639945,2013-06-26 03:50:21
1627554,41405,4881447,7,I'm guessing any lib will perform similarly for this use case since the xTx matrices should be pretty small. But I thought it was ok to use a more restrictive library with an apache project provided you don't release statically linked bins.,46639945,2013-06-26 05:07:31
1627554,41405,4881471,19,I'll add it. Does VectorSpace give you a default negate by scaling by -1 in F?,46639945,2013-06-26 05:09:03
1761937,1825352,5201815,2,Updated Generators.,48452483,2013-07-16 02:04:37
1761937,7111,5175351,2,"We need to add to the generators:

https://github.com/twitter/algebird/blob/e45d2021e9e1b91ad4397c27e41287309fc87d29/algebird-test/src/test/scala/com/twitter/algebird/Generators.scala#L27

We need to make a generator for each of the types of intervals",48452483,2013-07-13 02:32:07
1761937,7111,5175363,2,"without the above, we don't have tests that intersection is working.",48452483,2013-07-13 02:32:53
1785421,7111,5245109,31,and similarly below (paging Dr. Macro).,50024536,2013-07-17 20:35:16
1785421,7111,5245091,31,"can you make bij not val and instead add:
```scala
def bijection: Bijection[U, T] = bij.bijection.inverse
```
or `Bijection[T, U] = bij.bijection` if you prefer
because ImplicitBijections are kind of ugly plumbing.",50024536,2013-07-17 20:34:40
1785421,44018,5245511,31,Done.,50024536,2013-07-17 20:48:12
1785772,44018,5247503,5,"yikes, looks like we did have a bug.",50045620,2013-07-17 22:03:29
1785772,7111,5246757,5,"`sparseEquiv == true` would pass this test.

Can you also add one where it adds a non-zero key value and sees that they are different?",50045620,2013-07-17 21:34:03
1786020,7111,5248149,11,surprised this is not a compile error unless the mon is inferred as `Monoid[V]`,50067634,2013-07-17 22:27:43
1786020,44018,5248316,11,"yeah, it's inferred, and this removes the warning on type erasure.",50067634,2013-07-17 22:33:37
1786020,7111,5248788,34,can we do the same as the putter above so we don''t reflect each time?,50074003,2013-07-17 22:48:29
1786020,7111,5248816,27,"actually, why not just add an isNonZero fuction and reflect once to either make that function always return true or call through to Monoid. ",50067634,2013-07-17 22:49:47
1786020,44018,5248969,27,"sure, and I think that the reflection call internally should get compiled away.",50067634,2013-07-17 22:55:12
1786020,7111,5248733,27,"Can you move this above so we only reflect once (not in a tight loop). Something like:
```scala
val putter: Function3[JMap[K,V],K,V,Unit] = semi match {
  case case mon: Monoid[V] => { (result, smallK, newV) => 
    if(mon.isNonZero(newV)) result.put(",50067634,2013-07-17 22:46:44
1888926,44017,5983924,9,"Should this be called compose? It's not function composition... almost more of an ""in parallel"" or ""tee"".",53086062,2013-08-26 22:42:42
2028195,44017,6116909,16,"Does present want to be the HLL here, or the estimate? I can see arguments either way.",57585943,2013-09-03 08:09:06
2028195,1123342,6117204,16,I think the estimate would be the nicer output but I'm not actually using HLL so I don't know how useful others would find having the actual HLL instance.,57585943,2013-09-03 08:54:03
2028195,7111,6423358,4,"types on public methods, otherwise binary compat is very hard.",58629428,2013-09-18 06:36:55
2028195,7111,6423359,9,method type.,58629428,2013-09-18 06:37:05
2028195,7111,6423371,6,return type.,58629428,2013-09-18 06:38:09
2028195,7111,6424508,12,"We often store the HLL. Let's keep the HLL as the return type and if you want size you can use

```scala
.andThenPresent(_.estimateSize)
```
to get it.

",58629428,2013-09-18 08:31:39
2028195,7111,6424530,12,"If you also want a size estimating one, that's fine, HLLSizeAggregator or something, so you don't have to do the above andThen over and over.",58629428,2013-09-18 08:34:16
2092249,7111,6306680,22,remove from here.,57984457,2013-09-12 01:54:38
2092249,7111,6306698,5,"Rename to ""Or"" I think, or ""OrWrapper"" and import it with whatever name you want. I want the use to be clearer.",57984457,2013-09-12 01:55:11
2092249,7111,6306740,5,"add:

object OrWrapper {
  implicit def monoid: Monoid[OrWrapper] = OrWrapperMonoid
}",57984457,2013-09-12 01:56:15
2092249,7111,6307456,31,"if(l.get) r else l

right?",57972527,2013-09-12 02:21:07
2101442,7111,6336015,80,"def not val. You can override def with val, not the other way around. val in trait is dangerous due to the init order bug.",58071411,2013-09-13 02:54:34
2191753,2221968,6708599,20,"Is the orElse(sparseVal) here okay?  It seems to go against the spirit of a Semigroup not knowing of any zero value (the monoid also doesn't assume that the sparseVal is zero).

What about:

newV = buffer.get(idx).map(oldV => SemiGroup.plus(oldV, v)).",58807400,2013-10-02 13:03:22
2191753,2221968,6709065,37,Is this going to be an implicit conversion?  Is it a conversion which could be done directly from the mutable map?,58807400,2013-10-02 13:35:24
2191753,2221968,6709198,52,Maybe use ++=,58807400,2013-10-02 13:43:19
2191753,2221968,6709309,30,Should we add checking here as elsewhere to ensure the structure parameters are consistent?,58807400,2013-10-02 13:50:24
2191753,2221968,6709376,42,"I'm not sure how frequent it would be to have just a single element in the list, but maybe it's worth optimizing for?",58807400,2013-10-02 13:55:02
2191753,7111,6721354,37,it is a method on mutable map.,58807400,2013-10-02 22:09:19
2191753,7111,6721373,30,"We didn't have it before, but we could add it. Do you want it?",58807400,2013-10-02 22:09:55
2191753,2221968,6721525,37,"I figured toMap would return a ScMap, but we need a Map here?",58807400,2013-10-02 22:14:13
2191753,2221968,6721643,30,"Yeah, but let's file a separate issue?",58807400,2013-10-02 22:18:06
2191753,7111,6722472,37,you are right. But it why does it compile? That is troubling.,58807400,2013-10-02 22:44:28
2191753,13840,6726996,20,"```scala
  val oldV = buffer.getOrElse(idx, sparseVal)
```",58807400,2013-10-03 01:30:40
2191753,13840,6727092,20,"Oh I'm sorry, I just realized sparseVal is an Option. Whenever I see .get called on Option my spidey sensors go off. :-)",58807400,2013-10-03 01:33:55
2191753,13840,6727148,20,"```scala
  Semigroup.sumOption(items.collect { case Some(v) => v })
```",58807400,2013-10-03 01:35:35
2191753,7111,6728937,42,done.,58807400,2013-10-03 02:44:46
2191753,7111,6728962,20,collect is not defined on TraversableOnce (in 2.9),58807400,2013-10-03 02:45:35
2191753,7111,6728988,30,"agreed, but added the size == 1 optimization because it is easy.",58807400,2013-10-03 02:46:26
2191753,2221968,6730412,51,"We should end up with more SparseVectors if the new sparseValue is Semigroup.plus(left.sparseValue, right.sparseValue).  This could apply to the (DenseVector, DenseVector) case too.",58913494,2013-10-03 03:44:59
2191753,13840,6730941,20,bummer!,58807400,2013-10-03 04:08:31
2191753,7111,6731097,51,"It was a massive pain to get this code to pass. Actually the old code was assuming that the sparseValue was zero, we just never exercised it outside of that case.

In reality, the sparseValue will almost always be zero so I'm disinclined to optimize fur",58913494,2013-10-03 04:17:28
2191753,2221968,6731326,51,Agreed -- not a merge blocker.,58913494,2013-10-03 04:30:38
2208075,7111,6815246,36,"Want to add:
```scala
def from[V](fn: V => V): Tunnel[V] = {
  val prom = new Promise[V]
  Tunnel(prom.map(fn), prom)
}
```",59083761,2013-10-08 06:17:25
2208075,7111,6815250,51,"Comment to explain this type? Why the name, how to use it?",59083761,2013-10-08 06:17:48
2208075,7111,6815258,59,Add the warning that this can only be called once.,59083761,2013-10-08 06:18:16
2208075,7111,6815269,37,maybe use the above from method?,59083761,2013-10-08 06:19:04
2208075,7111,6815279,26,can you override `def isNonZero` to check if future neq promise?,59083761,2013-10-08 06:19:51
2208075,7111,6815309,20,mention the analogy to the `(T) => T` monoid. This is the async version of that.,59083761,2013-10-08 06:22:48
2213513,7111,6840662,29,"implement isNonZero, please. The default will fail.",59118260,2013-10-09 02:25:14
2213513,7111,6840999,45,"shouldn't this be startingV?

Why complete with value?

Why didn't the tests catch this?",59118260,2013-10-09 02:37:22
2213513,7111,6841034,27,Should be PromiseLinkMonoid or you should rename PromiseLink.,59118260,2013-10-09 02:38:28
2213513,38527,6843209,45,"My guess is that the tests didn't catch this because in the case of the tests, this method was almost but not quite completeWithFinalValue, and since there is no promise associated with startingV, that is the promise that would have been borked. Fixed.",59118260,2013-10-09 04:03:06
2213513,38527,6843289,27,I HATE NAMING THINGS. PromiseLink it is.,59118260,2013-10-09 04:06:35
2213794,7111,6841817,5,"How is this used? If it is just to test, I think we intend to Await here, whereas poll does not wait.",59120237,2013-10-09 03:04:12
2213794,38527,6842891,5,"ah, I thought isReturn was async, I misunderstood the api. That simplifies things.",59120237,2013-10-09 03:48:10
2249862,7111,6932362,10,"Can we rename halfLife to halfLifeInMillis?

Let's make timestamp be called timestampMillis and be a Long. This will reduce the chance of misusing it.

Time in decayed value is only double since we always measure it in units of half-life. Here we are ",59711125,2013-10-12 22:48:53
2249862,2665345,6936558,10,"After some thought, I'm inclined to remove valueNow completely, and leave that to the user to define. Since currently, unit of time can be arbitrary, and not necessarily need to be millis.",59711125,2013-10-14 04:55:13
2249862,7111,7018532,6,"Why not just a method on the monoid, so you don't need to allocate one if you already have it?",64789405,2013-10-17 03:32:41
2268152,13840,6984278,17,iter.toIterable.grouped(blockSize) ?,63036976,2013-10-16 01:40:35
2268152,480242,6984797,17,Oh right. I think the reason I wanted to use sliding instead was that immutable lists apparently will truncate the last element with grouped. I seem to be unable to find other cases or even reproduce that behavior at all. Will change.,63036976,2013-10-16 01:58:17
2268152,7111,6986822,14,"traversableOnce is not safe to go through twice. That's the point of the name ""Once"". You have to put it in a buffer.",63529625,2013-10-16 03:14:10
2268152,7111,6986865,14,"actually, why is this needed at all, why doesn't the below handle this?",63529625,2013-10-16 03:15:23
2268152,7111,6986946,17,"toIterable is not safe. On hadoop, we need to handle billions of items.

We need a `TraversableOnce[T] => Iterator[Iterable[T]]` that does not materialize everything into memory, just the individual buffers.",63529625,2013-10-16 03:18:13
2268152,7111,6986958,22,nice recursion.,63529625,2013-10-16 03:18:43
2268152,480242,6986980,14,"Comment 1- D' oh
Comment 2- I think you're correct about this, but there should be some sort of check for blockSize <= 1 lest there's an infinite loop although alternatively we could also throw an exception.",63529625,2013-10-16 03:19:58
2268152,7111,6987091,19,"go bigger here too (100, 1000).",63529625,2013-10-16 03:25:06
2268152,578221,7008487,25,"I think newSize should probably be an atomic int with an atomic increment. AFAICT there shouldn't be a race condition here, but it'd make this more robust in the face of future refactoring.",63529629,2013-10-16 22:11:42
2268152,7111,7018310,15,let's put this in object Semigroup? I don't want to complicate the base trait (which we are trying to share widely).  I think the Semigroup author should only care about optimizing plus and sumOption. Your code takes it from there.,63529629,2013-10-17 03:23:59
2268152,7111,7018359,21,I assume this never materializes the whole traversable in memory. Can you comment to that effect so we can have a hint of where to look if memory explodes on Hadoop?,63529629,2013-10-17 03:25:57
2268152,7111,7018500,28,"pretty sure this materializes the iterator. Can you point at docs that it does not?

I'd rather just do `sumsBuffer.grouped(blockSize).map(Future..sequence ... )` to get an Iterator[Future[T]]

Use a recursive function on that: `Iterator[Future[T]] =>",63529629,2013-10-17 03:31:14
2268152,7111,7018508,44,move all the logic here.,63529629,2013-10-17 03:31:31
2268152,480242,7018616,21,The call to toIterator itself shouldn't materialize the TraversableOnce AFAICT. The call to grouped(blockSize) should not materialize everything into memory since according to *my* reading of the scala library source code (https://github.com/scala/scala/b,63529629,2013-10-17 03:36:34
2268152,480242,7018734,28,"Doing a sumsBuffer.toTraversable is the same as doing a sumsBuffer.toStream which itself shouldn't materialize the whole iterator. Unless I'm mistaken, UnrolledBuffer inherits this definition of toTraversable: https://github.com/scala/scala/blob/v2.10.2/s",63529629,2013-10-17 03:42:04
2268152,480242,7024413,46,I should probably do something like items.map { item => Future(Some(item)) } and then pass that inter the helper,63811082,2013-10-17 11:24:44
2268152,132262,7026249,20,this check only needs to be made the first time--it should be moved out of this function.,63811082,2013-10-17 13:37:43
2268152,132262,7026331,26,"why not just make this a map?  my impression is that with scala futures, map implicitly uses the execution context in scope.",63811082,2013-10-17 13:42:07
2268152,132262,7026340,32,ditto,63811082,2013-10-17 13:42:50
2268152,132262,7026348,7,why does this use scala Futures? why not stick it in algebird-util and use twitter Futures?,63811082,2013-10-17 13:43:01
2268152,132262,7026972,19,"I think this can be made simpler by getting rid of tailrec.  It looks like this will hit a max stack of log(items.size).

```
def parSumOption[T](items: TraversableOnce[T], blockSize: Int)
  (implicit sg: Semigroup[T], pool: FuturePool): Future[Option",63811082,2013-10-17 14:09:44
2268152,480242,7035279,7,In the original issue it said to use scala Futures *SHRUG*,63811082,2013-10-17 20:10:28
2268152,480242,7036952,19,"```scala
Future.collect(grouped.map { pool(sg.sumOption(_)) }) flatMap { iter: Iterator[Option[A]] => help(iter.flatten) }
```

Would be nice, but I don't think I can just Future.collect over grouped here since grouped is an Iterator, not a Seq. (Simi",63811082,2013-10-17 20:59:31
2268152,7111,7075437,21,"can this be Iterator[Future[T]] => Future[T]

Just never call it on an empty iterator and you can remove the flatten.",65197939,2013-10-19 03:03:42
2268152,7111,7075457,17,add if(items.isEmpty) Future.value(None) here and you can assume non-empty the rest of the way.,65197939,2013-10-19 03:04:36
2268152,44018,7075481,17,"Future.None, that is.",65197939,2013-10-19 03:05:29
2268152,7111,7075486,38,"ahh, you are already checking for Empty here. Why not return Future None, below?",65197939,2013-10-19 03:05:34
2268152,7111,7075511,41,I think this is the lazy constructor that evals in a thread. You want: Future.successful(item) (let's loose the Some).,65197939,2013-10-19 03:06:56
2268152,480242,7076848,28,Basically relying on this line (the map that is) to do the concurrency. ,65794228,2013-10-19 04:25:27
2268152,7111,7085733,28,Looking really good. Only one last issue remains: line 90 and 93 are virtually identical. Can you make a def that takes a Seq[Future[T]] and returns Future[T],65794228,2013-10-21 09:52:26
2273952,7053,7021158,5,Would it make sense to make the seed a param of the MinHasher constructor?,63549694,2013-10-17 05:44:11
2282647,319889,7111901,5,white space?,64455771,2013-10-22 04:08:43
2342029,13840,7258988,14,"```scala
  opt.exists { group.isNonZero(_) }
```",67531069,2013-10-29 00:51:50
2342029,35101,7262401,14,thanks!,67531069,2013-10-29 02:37:31
2344156,44018,7287227,12,nice. I think this was a cargo cult from long ago.,67593740,2013-10-29 23:33:10
2344156,319889,7287299,12,"Yeah they dropped it, i think by default now they show less, and you have to do stuff to see more. But function was gone anyway and tests still pass :)",67593740,2013-10-29 23:35:08
2386757,7111,7534554,22,"no need to extend Monoid, I think.",69744871,2013-11-09 01:33:44
2386757,7111,7534573,23,What if something does not have a next?  Can this be Option[T]. I'm thinking of Int.MaxValue,69744871,2013-11-09 01:34:22
2386757,7111,7534604,29,nice. Note it never uses the monoid property.,69744871,2013-11-09 01:35:27
2386757,132262,7538749,23,If it's a monoid it's presumably closed under next,69744871,2013-11-09 04:06:10
2386757,7111,7634852,36,"Can you add the type-class-pattern method here:
```scala
  // enables: Successible.next(2) == Some(3)
  def next[T](t: T)(implicit succ: Successible[T]): Option[T] = succ.next(t)
```",70702333,2013-11-14 01:17:31
2386757,7111,7636892,38,"actually:

one more.... Sorry. Remove above, and add:
```scala
// get all the numerics in one blow:
implicit def numSucc[N:Numeric]: Successible[N] = new NumericSuccessible[N]
```",70711428,2013-11-14 02:15:47
2386757,38527,7637256,38,"Haha it's all right, I appreciate the help refining how I write these sorts of libraries.",70711428,2013-11-14 02:25:40
2544861,7053,8052011,11,I know that these are autogenerated but it would be good to make put this magic constant at the top.,73969530,2013-12-03 14:06:20
2559275,319889,8202863,56,Use scalacheck to generate these rather than being fixed magic values,74074684,2013-12-09 23:47:38
2559275,319889,8202877,61,Given how rare the bug was without the or in place here has it ever thrown for you?,74074684,2013-12-09 23:48:06
2559275,319889,8202928,5,"How about moving the extra abs into the splitLong function so all the abs/uglyness is together? 

Also adding a comment beside it as to why we have two math.abs might be good too?",74074684,2013-12-09 23:49:33
2559275,7111,8223971,56,"Well, ALSO have fixed magic values. These were found to have the bug, so let's keep them to prevent regression.",74074684,2013-12-10 14:17:08
2559275,319889,8250510,56,"Well for the Specification section rather than the scalacheck one we should try generate the exact problem case, not sure it would make any benefit here.",74074684,2013-12-11 05:32:16
2559275,2820001,8263882,56,"There is a test for the problem case in the Specification already.
I'll make the property generic with an arbitrary ""negative"" hash.",74074684,2013-12-11 18:56:30
2559275,2820001,8263977,61,"It's thrown exactly when (x >> 32) happens to be the Integer.MIN_VALUE, and then its absolute value is negative.  ",74074684,2013-12-11 19:01:35
2559275,2820001,8264089,5,"Moving abs into the splitLong wouldn't help because of the Integer.MIN_VALUE issue. 
I'd rather use @david206's solution.",74074684,2013-12-11 19:06:36
2649235,7111,8382743,36,"This could be faster: we currently ignore that fromMutable owns the underlying mutable structure. If we don't ignore that, we never need to copy: we could make a wrapper that delegates to the mutable Map and implements the map traits, which I think there ",77324457,2013-12-17 04:29:49
2649235,544204,8486234,36,"You mean I should change the definition of fromMutable?    

override def fromMutable(mut: MMap[K, V]) = mut.toMap
",77324457,2013-12-20 05:06:30
2649235,7111,8529817,36,"I meant something like this:
```scala
/* We assume we own this mutable map, which is to say, mut is the only reference to it */
override def  fromMutable(mut: MMap[K, V]) = new collection.immutable.Map[K, V] {
  /* only copy on write*/
  def +[V1>:V]",77324457,2013-12-23 23:45:50
2649235,7111,8533169,45,"this will be no faster than doing `items.reduceLeft(plus(_, _))` right? .add is going to do log N updates to the tree, and the point of the update was to make that cost O(1).

For these micro optimizations, we need benchmarks. Can you do a quick compari",78961183,2013-12-24 02:36:31
2655628,7111,8410491,10,"can we write: `, prep: F => T)`",77567279,2013-12-18 00:59:57
2655628,7111,8410498,18,same request as above.,77567279,2013-12-18 01:00:08
2655628,7111,8410555,28,"can we add some spaces: `l: B, r: A): B = `",77567279,2013-12-18 01:01:40
2655628,7111,8412802,29,for symmetry I think this should take a B as well.,77567279,2013-12-18 02:00:44
2655628,7111,8412813,38,"why are these called fold, but the others append? Should this not be the same and in Aggregator?",77567279,2013-12-18 02:01:05
2655628,44017,8412952,39,do we definitely want ring.zero here and not ring.one?,77567279,2013-12-18 02:04:57
2655628,2523602,8415276,29,@johnynek not sure about this one. I thought the whole point was to fold TraversableOnce[A] with Monoid[B] using prepare? am I missing something? ,77567279,2013-12-18 03:03:53
2655628,7111,8440256,39,good catch. That would have always returned zero.,77567279,2013-12-18 23:03:18
2655628,7111,8440343,28,"this should be moved to the base Aggregator trait. It is the same in both implementations and always makes sense, right?",77756732,2013-12-18 23:06:07
2655628,7111,8440535,29,"isn't `reduce(items.map(prepare(_)))` the same thing here?  Maybe something like:

```scala
def appendAll(old: B, items: TraversableOnce[A]): B =
  if (items.isEmpty) old else reduce(old, reduce(items.map(prepare(_))))
```
That could also be in the ",77756732,2013-12-18 23:11:55
2655628,2523602,8454581,29,"@johnynek so it make sense to add ``` def appendAll(old: B, items: TraversableOnce[A]): B ``` to the base trait but can we also have specialized ``` def appendAll(items: TraversableOnce[A]): B ``` in MonoidAggregator and RingAggregator? TBH in case of bot",77756732,2013-12-19 05:40:18
2732888,232473,8626302,12,"Scaladoc public classes and methods?  Especially ""j""...",80530755,2014-01-03 06:22:02
2732888,232473,8626599,16,Should be declared outside the enclosing class?,80530755,2014-01-03 06:36:30
2732888,480242,8627279,16,doh,80530755,2014-01-03 07:16:02
2732888,480242,8627297,12,"""j"" shouldn't really be public since it's pretty much internal to the workings of HyperLogLogs but sure.",80530755,2014-01-03 07:16:46
2732888,7111,8627383,16,"Why the versioning with 2? Not a fan of that. Can't we just have one implementation? If you want to copy the old jRhoW method to tests, that is fine.",80530755,2014-01-03 07:21:32
2732888,480242,8627515,16,"Right yeah- what we should be doing is having benchmarks being run against develop and against any feature branches if there's a question of performance regressions/enhancements. In any case, this has been shown so yeah there should be no need to have two",80530755,2014-01-03 07:31:21
2732888,7111,8652430,38,"add a TODO: we could read a byte at a time while bits >= 8, and that would be faster.",80530759,2014-01-05 01:05:10
2732888,7111,8652440,42,"would kind of prefer a tailrec here like:
```scala
@annotation.tailrec
def loop(pos: Int, accum: Int): Int = {
  if(pos >= bits) accum
  else if (bsw.contains(pos)) loop(pos + 1, accum + (1 << pos))
  else loop(pos + 1, accum)
}
loop(0, 0)
```
t",80530759,2014-01-05 01:08:52
2732888,7111,8652457,57,"```scala
@annotation.tailrec
def loop(pos: Int, zeros: Int): Int =
  if(bsw.contains(pos)) zeros
  else loop(pos + 1, zeros + 1)

loop(bits, 1).toByte
```",80530759,2014-01-05 01:12:32
2732888,7111,8652460,57,this one I think we should change. I don't like the hack to break the loop.,80530759,2014-01-05 01:12:50
2732888,7111,8652465,91,Can we move this to the test code and keep the class clean?,80530759,2014-01-05 01:13:58
2732888,7111,8652466,17,"moving referenceJRhoW here would be better, in my view.",80530759,2014-01-05 01:14:30
2732888,7111,8652470,34,why not start at 2? will it break for smaller values?,80530759,2014-01-05 01:15:36
2732888,480242,8671390,34,"There's an assertion ""assert(bits > 3, ""Use at least 4 bits (2^(bits) = bytes consumed)"")"" ",80530759,2014-01-07 00:49:23
2805737,7111,9051267,33,"while were at it, is there any reason to limit to Int here? We have 128 bits of hash right before. Seems strange to hash to such a space just to throw it away.",83150496,2014-01-22 02:46:36
2805737,7111,9051358,69,"while we are cleaning up here, can we make a trait for this?

```scala
trait Preparer[I, O] {
  def create(in: Seq[I]): O
}
```
It is related to the Aggregator.",83150496,2014-01-22 02:48:43
2805737,37812,9055084,33,"On Line 77 of this file we use the output (Int) of this ""function"" to index into the table. We could preserve the (Long, Long) and modulo at the usage site but I don't see much gain in that. I think it would be more reasonable to tackle this problem in Ad",83150496,2014-01-22 04:24:52
2805737,37812,9055355,69,This looks like a logically separate commit to me. I'll read through Aggregator.scala and try to understand how Preparer would interact with Aggregator and submit a separate issue (and hopefully pull request). Does that sound fair?,83150496,2014-01-22 04:31:52
2805737,37812,9062119,69,#252 ,83150496,2014-01-22 08:16:24
2805737,37812,9062187,33,"... thinking about this more and going quite off PR, even if AdaptiveVector did support fancier index-types we'd still need to leverage a fancy (Long, Long)-with-modulus type to make it a really clean interface.",83150496,2014-01-22 08:19:46
2860844,7111,9136835,8,"def semigroup: Semigroup[O]
// and add that the law here is that batchCreate(is) == semigroup.sumOption(is.map(create(_)))",84626471,2014-01-24 07:42:28
2860844,7111,9136848,9,I guess this should be `Option[O]` since we don't have NonEmptyList is scala.,84626471,2014-01-24 07:42:56
2860844,7111,10072247,7,why is this in the Aggregator.scala file? What are your thoughts on that?,84626471,2014-02-26 16:03:58
2860844,7111,10072305,8,"I would also prefer a shorter name. createCreatable does not really seem elegant. Why not .create?

Also, it seems build was used in many places in the code (PriorityQueueMonoid, for instance). It would be nice if we are doing this to fix as many as pos",84626471,2014-02-26 16:06:14
2860844,37812,10104238,7,"That's an oversight, it should probably have it's own Creatable.scala file",84626471,2014-02-27 05:57:14
2860844,37812,10104363,8,"create is fine createCreateable doesn't clash with existing code (backwards compatibility)

Regarding Semigroup -- maybe it will all work out properly, but the pattern I've seen regarding create is that the create method is in the definition of the Mono",84626471,2014-02-27 06:00:56
2860844,37812,10104515,9,"Yes, that's an oversight.

Food for thought, NonEmptyList is the free semigroup, if it's not in the standard library, it arguably belongs in algebird.",84626471,2014-02-27 06:04:46
2860844,37812,10105586,8,"If O is a Monoid, then we can always return zero. We only need Option[O] if O is only a semigroup. I'm not sure which use case should optimized.",283892175,2014-02-27 06:40:30
2860844,7111,10112656,8,"All monoids are semigroups, but not vice-versa. Some of our agregations are only semigroups (consider QTree or SpaceSaver). I think we should use Option[O] or this will only be usable by a subset.

Also, whatabout the duplicate string? createCreatable? ",283892175,2014-02-27 12:28:14
2987659,44017,9607649,175,"I'm worried that this merge operation is not associative. I'm not sure how much that will come up in practice, but as a pathological case: say you had a summary for each day, and each day's top m items were unique to it, but the (m+1)th most frequent item",88501665,2014-02-11 06:31:21
2987659,7111,9608332,4,"this should not go here. Only objects we don't control go here. Otherwise, put it in the companion object for StreamSummary.",88501665,2014-02-11 06:51:16
2987659,7111,9608361,37,"does this have to be a map (which allows key iteration)? Can this be instead a `T => (Long, Long)`",88501665,2014-02-11 06:52:29
2987659,7111,9608374,46,1.0 is a strong bound. Is that correct?,88501665,2014-02-11 06:52:52
2987659,504464,9608375,175,"agreed. let me go over the merge again and make sure its right


On Mon, Feb 10, 2014 at 6:31 PM, avibryant <notifications@github.com> wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/StreamSummary.scala:
>
> > +    val buckets1 = buckets + ",88501665,2014-02-11 06:52:56
2987659,7111,9608428,27,"don't like this name. Can we say, capacity? maxRetained?",88501665,2014-02-11 06:54:29
2987659,7111,9608453,16,why only up to 10? why magic 4?,88501665,2014-02-11 06:55:23
2987659,7111,9608530,19,"hmmm. At least we need (left consistentWith right) && (right consistentWith left).

I am a bit nervous here. I tend to think the heavy hitters in sketch map was a mistake, and we should have kept it associative. Can you expand on your thoughts there abo",88501665,2014-02-11 06:58:22
2987659,504464,9608894,4,"ok i misunderstood that one. will put it in companion.


On Mon, Feb 10, 2014 at 6:51 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/Monoid.scala:
>
> > @@ -225,4 +225,5 @@ object Monoid extend",88501665,2014-02-11 07:11:20
2987659,504464,9608967,175,"i will check, but i believe that
1) you are correct that you would never find out its the most frequent
overall
2) however the error-bars on the most frequent items that it did find would
reflect that uncertainty. basically the data structure would admit ",88501665,2014-02-11 07:14:19
2987659,44017,9609124,175,"Ah, that's interesting, and not intuitively obvious to me. Would love to see a demonstration of this.",88501665,2014-02-11 07:20:35
2987659,504464,9609626,175,"ok here is an attempt at demonstrating it:

to illustrate, say you have 2 streamsummaries (so parallelism is 2).

errors are reported as possible overcounting. so count of 30 and error of
10 means the true count was in range [20, 30]

the most frequent it",88501665,2014-02-11 07:44:45
2987659,504464,9609748,175,"note that, and this is the tricky part, the merge does not keep all items.
it truncates to keep the map size the same (otherwise a merge could result
in thing getting out of hand in terms of size). what this means -i believe-
is that after the  merge the ",88501665,2014-02-11 07:50:13
2987659,504464,9610115,46,"Yes it is a strong bound.


On Mon, Feb 10, 2014 at 6:53 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/StreamSummary.scala:
>
> > +    */
> > +  def min: Long
> > +
> > +  /**
> > +    * Map o",88501665,2014-02-11 08:03:18
2987659,504464,9610351,19," (left consistentWith right) && (right consistentWith left) works fine.

equality might also would also work if i were to implement a proper equals, which i skipped. mhhh not entirely sure here if equals would work...",88501665,2014-02-11 08:14:09
2987659,504464,9611376,19,"(left consistentWith right) && (right consistentWith left) works.

Doing the test based on equality also works, with equality based on
counters and m.
I chose not to implement equality since i thought it is not very meaningful
for a probabilistic data str",88501665,2014-02-11 09:08:04
2987659,504464,9614101,19,"sorry spoke to soon.
when you add a new element that has not been observed before and the
structure is at capacity it kicks out the element with the lowest count. so
the data structure is sensitive to insertion order and structural equality
will not work.",88501665,2014-02-11 12:35:37
2987659,504464,9625270,37,"Using map allows me to factor out methods that access by key and methods that iterate over all (key, val) tuples into the abstract base class.
",88501665,2014-02-11 21:32:14
2987659,44017,9632899,175,"Your first note made sense, and I can't find a flaw in the argument (and, cool! The addition of per-element error is a neat innovation here). I don't follow the second part yet, can you elaborate?",88501665,2014-02-12 00:18:04
2987659,504464,9634555,175,"the merge combines the 2 counters maps. but notice the result is truncated
after sorting:
.sorted(StreamSummary.ordering)
.take(capacity)

to me the hardest part was convincing myself the resulting structure after
the sort and take was correct. it is easy",88501665,2014-02-12 00:54:38
2987659,504464,9635102,175,"i should have simply said:

after merging the 2 maps but before the take operation, the new minimum
count is going to be the sum of the minimum counts on left and right, or
possibly higher (if all the items that had minimum counts on left had
higher count",88501665,2014-02-12 01:06:22
2987659,44017,9638494,175,Got it. Thanks.,88501665,2014-02-12 02:15:48
2987659,7111,10027740,28,is this not an Option[Long]?,88945636,2014-02-25 15:38:49
2987659,7111,10027748,87,would prefer None here.,88945636,2014-02-25 15:39:04
2987659,7111,10027821,85,"would prefer these classes be case classes or have hashCode, equals, toString implemented.",88945636,2014-02-25 15:41:47
2987659,7111,10027965,72,"I think this code relies on non-specified behavior: reusing an iterator. Indeed, the repl violates what you are assuming:
```scala
scala> Iterator(1, 2, 3)
res6: Iterator[Int] = non-empty iterator

scala> res6.take(1).toList
res7: List[Int] = List(1",88945636,2014-02-25 15:46:45
2987659,7111,10028057,72,"```scala
scala> Iterator(1, 2, 3).zipWithIndex.span { case (_, idx) => idx < 1 }
res10: (Iterator[(Int, Int)], Iterator[(Int, Int)]) = (non-empty iterator,unknown-if-empty iterator)

scala> res10._1.toList
res11: List[(Int, Int)] = List((1,0))

sca",88945636,2014-02-25 15:49:57
2987659,7111,10028176,119,can this be an apply method instead? Not a fan of multiple constructors.,88945636,2014-02-25 15:53:58
2987659,7111,10028187,121,apply method instead?,88945636,2014-02-25 15:54:12
2987659,7111,10028236,28,"Rather than make this an Option, why not just add it directly to SSOne and SSMany? Might be cleaner that way rather than jam it onto zero.",88945636,2014-02-25 15:55:38
2987659,7111,10028284,28,"What about making this a semigroup? Those can be made monoids by wrapping them in Option. Isn't that what is happening here (you just have a named type)?

Just a thought.",88945636,2014-02-25 15:57:03
2987659,7111,10028355,179,can we not use the priority queue or topK monoid here since those are a bit optimized and don't need to do a total sort?,88945636,2014-02-25 15:59:54
2987659,7111,10028419,21,"please beef this up a bit: all of these will be SSOne, right? It would be nice to also produce some SSMany by taking some number of samples from Arbitrary[SSOne[Int]] and adding them up. The Arbitrary[SpaceSaver[Int]] = oneOf(SSOne[Int], SSMany[Int])",88945636,2014-02-25 16:02:50
2987659,504464,10054319,28,ok will make it semigroup and remove SSZero,88945636,2014-02-26 03:32:00
2987659,504464,10054952,72,"yikes, that looks like a bug to me. something to do with arrays?
```scala
scala> val x = Seq(1,2,3).iterator
x: Iterator[Int] = non-empty iterator

scala> (x.take(1).toList, x.toList)
res15: (List[Int], List[Int]) = (List(1),List(2, 3))

scala> va",88945636,2014-02-26 03:46:59
2987659,504464,10055351,72,thats a shame i liked the state-fullness of the iterator here to get the first k items and then the next one if available ,88945636,2014-02-26 03:57:03
2987659,2221968,10055378,72,"It's not a bug, it's undefined.  See http://www.scala-lang.org/api/2.10.3/index.html#scala.collection.Iterator --

> Reuse: After calling [take], one should discard the iterator it was called on, and use only the iterator that was returned. Using the ol",88945636,2014-02-26 03:57:45
2987659,504464,10055458,179,"the merge sorts at most 2 * k items and then takes the top k. so the sort is only ""wasteful"" by a factor 2 at most. 
is it worth it to pull out a queue structure for that?
",88945636,2014-02-26 03:59:52
2987659,504464,10055523,21,"Correct all are SSOne. SSMany can only be created by combining SSOnes.

OK i will see what i can do",88945636,2014-02-26 04:01:14
2987659,504464,10056081,72,"interesting. thanks for that. i had no idea


On Tue, Feb 25, 2014 at 3:57 PM, Joe Nievelt <notifications@github.com>wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/SpaceSaver.scala:
>
> > +      .filter { case (item, (count, err)) => count",88945636,2014-02-26 04:13:38
2987659,7111,10071649,10,"any reason we should not add:

```scala
implicit def semigroup[T]: Semigroup[SpaceSaver[T]] = new SpaceSaverSemigroup[T]
```
and remove the explicit setup in the test?",92175524,2014-02-26 15:40:05
2987659,7111,10071657,15,this can be removed with the implicit in the object.,92175524,2014-02-26 15:40:25
3028770,7111,9806020,52,"remove the specialized. Option isn't, so what's the point?",88943652,2014-02-18 05:09:38
3028770,7111,9812614,49,typo: intergal. We need spell checkers that understand camelCase and under_scores.,88966347,2014-02-18 11:58:12
3028770,319889,9813316,4,Do we have an issue number we should be referencing here?,88966347,2014-02-18 12:56:50
3028770,319889,9813350,26,Any particular reason for the space style over your more common x.y(x) style?,88966347,2014-02-18 12:59:41
3028770,319889,9813360,6,"Similar to earlier stuff, should we have an issue or some identifier so these can be grepped for later?",88966347,2014-02-18 13:00:38
3028770,7111,9839944,4,added those for #263 ,88966347,2014-02-19 03:21:13
3028770,38527,9840952,132,How to you imagine this being used? This seems like a terribly specific method.,89173899,2014-02-19 03:48:50
3028770,7111,9845506,132,"Well, we actually have a lot of interval parsing code in summingbird that is a pain given how general Intervals can be. This was for the common cases of finite interval that can be expressed as >= low, < high, which has the benefit of being easy to split:",89173899,2014-02-19 05:35:41
3028770,2221968,9846118,132,"The issues I've seen are around super-intervals (if that's the right word), e.g., batches being a superset of timestamps.  Would it make sense to optimize around this?

For example, something like:

def toIntervalOf[U](implicit mapping: Injection[T, I",89173899,2014-02-19 05:51:04
3028770,7111,9979367,132,"This is an interesting case. So far, we have this mapNonDecreasing on intervals, but your point is nice: often a value in one case is a interval in the other. Such as: `Injection[BatchID, Interval[Timestamp]]`.

If [B1, B2), that means that you have `[l",89173899,2014-02-24 08:28:00
3028770,2221968,10002939,132,"Perhaps the proper abstraction is to have a ""smallest containing interval"" and ""largest contained interval"", if we want to also cleanly handle cases where interval edges don't necessarily line up, such as when going from Timestamp to BatchID.

Anyway, s",89173899,2014-02-25 01:33:29
3077139,319889,9923538,19,If algebird-bijection uses bijection we should be explicit on the dependency here rather than getting it transitively,90174092,2014-02-21 03:44:23
3077139,319889,9923580,7,@johnynek Any thoughts on the additional dep here? Do we possibly want to move some of these out of algebird-core if they will have more dependencies beyond scala/java?,90174092,2014-02-21 03:45:24
3077139,38527,9924219,7,We could move SketchMap into a algebird-approx? I feel like we should use Bijections where Bijections can apply but understand the desire to keep things as pure as possible in core,90174092,2014-02-21 04:02:25
3077139,7111,9925712,19,I wonder if we keep algebird-bijection at all if we do this.,90174092,2014-02-21 04:37:56
3091021,7111,9966022,14,why is this an Injection? How do you invert a hash?,90666980,2014-02-22 06:04:37
3091021,7111,9966061,11,WAT? This is a Function. Why is it an injection?,90666980,2014-02-22 06:05:55
3091021,38527,9966080,14,"Well, this came after some debate with @ianoc . I originally defined a new type Hashable which served as a one way injection (we could still do this -- I think it should be in bijection if we do). Either way, his argument was that in order to more heavily",90666980,2014-02-22 06:06:20
3091021,7111,9966100,11,"why not just remove invert, not override Injection, and implement andThen and compose on this type?",90666980,2014-02-22 06:06:59
3091021,38527,9966112,11,"See above. And the only reason I really define this as such is to constrain it in Hash's apply, so that when you do Hash {thing=>thing2} you have to return a hash. The goal is to embed the types in the existing bijection framework. I'm ok with pushing it ",90666980,2014-02-22 06:07:22
3091021,7111,9966130,17,I think a larger prime would be good. What is the largest positive prime we can fit in 63 bits?,90666980,2014-02-22 06:08:02
3091021,7111,9966188,80,"why do we need this type? If we need it, why not:
```scala
sealed trait Hash[@specialized(Int, Long), T] {
  def get: T
}
```
to at least put some kind of structure on Hash.",90666980,2014-02-22 06:10:21
3091021,7111,9966224,19,"why do we have `inj` and not `implicit hash: OneWayFunction[K, Hash128]`",90666980,2014-02-22 06:11:39
3091021,7111,9966247,81,not an injection.,90666980,2014-02-22 06:12:27
3091021,7111,9966291,24,"Why not `OneWayFunction[K, Hash128]` here?",90666980,2014-02-22 06:13:37
3091021,2221968,9966458,17,"http://www.wolframalpha.com/input/?i=largest+prime+less+than+2%5E64

http://www.wolframalpha.com/input/?i=18446744073709551557",90666980,2014-02-22 06:19:48
3119391,7111,10062893,21,why iterator?,92184568,2014-02-26 07:02:55
3119391,38527,10062956,21,"I guess I should have commented this line as well (I have comments elsewhere).

If you look at how the ordering for the SortedSet is made, it only works for keys currently in the mapping that we create when the SortedSet is created (check the updatedHea",92184568,2014-02-26 07:05:42
3119391,7111,10062970,15,"this cannot be the right ordering, right? You need the ordering on V otherwise if someone adds to the SortedSet it will be broken (claiming to be a sorted set, but really with a false ordering).",92184568,2014-02-26 07:06:16
3119391,38527,10063043,15,"I think the other PR clarifies this a bit. Basically, the way this works is that when a SketchMap is constructed, that SortedSet is immutable not just in the sense that it is, well, immutable, but that adding elements to it without following the algorithm",92184568,2014-02-26 07:09:12
3119391,7111,10063066,38,"this is weird. In one, the keys are ordered by how heavy they are. here we have lost that.

If you are going to do this, bite the bullet and make it `SortedSet[(V, K)]` where V is the frequency (and reverse sorted).

This also makes it clear that you ",92184568,2014-02-26 07:10:04
3119391,38527,10063111,38,"I'm more than happy to do SortedSet[(V,K)], but that's going to make the memory required for a SketchMap go up potentially significantly (depending on the number of heavy hitters, of course). The goal of this was to avoid that but still ensure a sorted ou",92184568,2014-02-26 07:12:08
3122050,38527,10093137,11,"is this not just a synonym for:
this match {
  case Empty[_]() => true
  case _ => false
}
?
I guess the question is whether we force people to convert to an empty interval if they create an interval that has nothing in it (ie a lower bound above th",92270539,2014-02-27 01:55:46
3122050,38527,10093261,34,Shoudn't InclusiveLower and ExclusiveUpper also be parameterized on T (like you did in the scalding code)?,92270539,2014-02-27 01:58:26
3122050,319889,10093378,11,"When someone creates an interval  whose intersection is empty, i'm not sure we can change its type easily? Kind of like the pattern of the classes defining what it means locally",92270539,2014-02-27 02:00:34
3122050,319889,10093459,34,"They don't need it here, since the construction of an Intersection enforces this without needing to specify the type multiple times",92270539,2014-02-27 02:01:47
3122050,38527,10094352,34,"Ah, delightful.",92270539,2014-02-27 02:18:54
3122050,38527,10094374,11,Shouldn't an empty interval be a runtime error?,92270539,2014-02-27 02:19:26
3122050,2221968,10099260,11,"Option#isDefined works this way I believe, so there's a common precedent to this redundancy regardless of how we do this.

Regarding intersections, part of me thinks it'd be better to prevent folks from instantiating Intersection directly all together. ",92270539,2014-02-27 04:06:07
3122050,38527,10099351,11,"This is more or less what I had in mind, yes. I feel like anything dealing with intervals should go through code we control and construct intervals accordingly. I think that's what I care about more than a default isEmpty or whatever.",92270539,2014-02-27 04:07:51
3122050,7111,10099934,11,"I was on the fence too.

We could remove isEmpty, and put
```scala
require(lower.intersects(upper), ""Intersections must be non-empty"")
```
in the constructor for Intersection. I think this is legitimate. If you are not sure, you can use .leftOpenRig",92270539,2014-02-27 04:21:24
3122050,319889,10100559,11,Both approaches seem good to me. I'd leave it to anyone who has a stronger opinion/original author,92270539,2014-02-27 04:34:33
3122050,38527,10101002,11,"I like that idea, Oscar. With interval stuff I feel like we should constrain the entry and exit points or else it's going to get really nasty to deal with.",92270539,2014-02-27 04:43:59
3208038,319889,10437784,14,"you made public the constructor for the SSOne, but an apply method for SSMany. Why?",94377962,2014-03-10 22:48:30
3208038,504464,10438224,14,"the SSMany constructor has a third argument bucketsOption that i would prefer not to be visible to the world.

it is possible to build a SSMany with invalid internal state by passing in bucketsOption that is inconsistent with counters",94377962,2014-03-10 22:57:27
3208038,319889,10438445,14,But if this is for the purpose of serialization are we not potentially incurring a re-calculation overhead upon every ser/deser? Things won't necessarily RT through ser now? the field is a public parameter of the class?,94377962,2014-03-10 23:02:32
3208038,504464,10439326,14,"yes bucketsOption is public and immutable. and yes we are incurring
re-calculation. however this is reduce-side and i have found it to be
immaterial for performance, so i didnt bother serializing bucketsOption. at
the time i wrote that there was also some",94377962,2014-03-10 23:20:39
3208038,319889,10440404,14,"So i think being able to safely/sanely RT any structure is critical to ensuring our serialization paths are robust.

How you mean though that it only comes up during reduce? If we pre-aggregate then we will have data in these fields we will need to re-c",94377962,2014-03-10 23:41:03
3208038,504464,10440909,14,"map-side lots of SSOnes are added to SSMany

reduce side its simply a matter of merging the SSManys, which depending on
your cluster side isnt that many. this is where the wasteful re-calculation
of bucketsOption is done. my experience is that this reduce",94377962,2014-03-10 23:50:43
3208038,319889,10441611,14,"Thanks for the explanation, very useful. In a streaming compute context there can be many merges occurring reduce side. Different cache settings, would be coming into play often. Serialization to a store would be interesting here, given you would have a l",94377962,2014-03-11 00:03:08
3208038,504464,10442068,14,"OK i will change the algebird pullreq to open up the constructor again then
too


On Mon, Mar 10, 2014 at 2:03 PM, ianoc <notifications@github.com> wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/SpaceSaver.scala:
>
> > @@ -101,7 +101,7 @@ ",94377962,2014-03-11 00:12:32
3424577,7111,11696913,15,protected?,100729843,2014-04-16 22:46:17
3424577,7111,11696947,11,can these three be protected?,100729843,2014-04-16 22:46:34
3424577,7111,11696984,5,I would prefer we minimize the surface area. Can we remove this?,100729843,2014-04-16 22:47:11
3424577,7111,11697068,8,"style: avoid () on def where possible: `def statefulSummer: StatefulSummer[T]` also, please comment that this should return a new appropriate StatefulSummer.",100729843,2014-04-16 22:48:59
3424577,7111,11697178,16,seems like this logic should live in StatefulSummer. Something like `sumAll(iter: TraversableOnce[T]): Option[T]`,100729843,2014-04-16 22:50:31
3424577,7111,11697275,11,so this was one thing that Ian noticed: always assuming that making dense is a bad idea. We really want to keep sparse for a bit.,100729843,2014-04-16 22:52:20
3424577,2221968,11697775,11,"Sure, I'll protect them -- probably the var should be private too",100729843,2014-04-16 23:01:39
3424577,2221968,11698052,5,"See the discussion w/Avi above -- we would have to 'prevent' folks from using BufferedSumAll, or require an override there.  If consensus prefers this way, I can do that.",100729843,2014-04-16 23:06:46
3424577,2221968,11698089,11,"Ah yes, I noticed Ian moving some of this around.  I will definitely sync up so we don't miss merges like this.",100729843,2014-04-16 23:07:33
3424577,164018,11761573,16,"This would also provide a more explicit convergence criteria to this.
We could just call sumOption on the semigroup at this point.
",100729843,2014-04-18 06:34:34
3424577,164018,11761650,22,"something like ```Monoid.plus[OptionMonoid[T]](partial, flushed)``` ?",100729843,2014-04-18 06:41:13
3429412,7111,19450898,19,"can we ditch the bits here and take it as a parameter in toHLL? If we do this, we can make this class extend AnyVal, which makes it allocate less. It does not seem that the bits parameter is ever used except to go to an HLL.",101430232,2014-10-28 08:42:30
3429412,2221968,19451550,48,Spacing is a bit off here,101430232,2014-10-28 09:14:58
3429412,2221968,19451743,65,Isn't 'min' the correct reduction here (earliest timestamp)?,101430232,2014-10-28 09:24:47
3429412,7111,19507451,19,"Actually... thinking about this more, it seems like a minor issue. Storing the extra bit could be used to do a runtime check if we try to combine two that are not from the same sized monoid. That said. Perhaps we should assert they are equal in the plus b",101430232,2014-10-29 04:02:42
3429412,7111,28909372,19,"We need more docs here. I have to read carefully to remind myself of the intent and use of this code. Can you give some comments that will show up in the scaladoc?

",247257104,2015-04-23 01:04:50
3442751,38527,11664240,32,"not a huge sticking point, but imho this is a misleading name as these queues will be flushed many times. hasCachedElements seems more to point but I don't want to spur a bunch of dumb refactoring",101937006,2014-04-16 04:58:51
3442751,38527,11664300,39,should the cleanup the user supplied happen even if oldSelf's cleanup fails?,101937006,2014-04-16 05:01:30
3442751,319889,11664336,32,"Cache is a bad name here, flush applies to a buffer so kind of covers what this should be closer than that.",101937006,2014-04-16 05:02:51
3442751,319889,11664360,39,"Not entirely clear it should or shouldn't, following the super.cleanup , myNewCleanup model i think is probably best since it resembles closest the non-async pattern",101937006,2014-04-16 05:03:45
3505523,38527,11655947,52,"is there a reason you generally prefer the implicitly[Monoid... approach vs. Monoid.zero[V], and so on?",103699757,2014-04-16 01:30:25
3505523,319889,11656030,52,"Mostly not really, this ensures its just a field access for the zero constant in here if we hit it often rather than potentially being a def/virtual call",103699757,2014-04-16 01:31:50
3505523,38527,11656185,52,"How smart is implicitly? I always thought it was just something like

    def implicitly[T](implicit t: T) = t

Which would mean that there is still a virtual call. Is the scala compiler actually doing something smarter here, like making a direct refe",103699757,2014-04-16 01:34:40
3505523,319889,11656348,52,"Right, but i assign it to a final val, that is then used in any loops/accesses within the monoid. So for those it should be a constant. I could have used Monoid.zero[T] in the constant here too. Sorry I think I might have answered a different question tha",103699757,2014-04-16 01:37:32
3505523,38527,11656436,52,"Ok, yeah, I think we diverged, but I am with you.",103699757,2014-04-16 01:39:22
3505523,38527,11656693,47,"Where is this used? You redeclare val indx lower, so this doesn't seem used?",103699757,2014-04-16 01:44:02
3505523,38527,11656744,52,is there a reason to prefer a while to a foreach here?,103699757,2014-04-16 01:45:04
3505523,38527,11656766,50,is there a reason to prefer a while to a 0.upto(rows).foreach type thing? Is there a performance difference? Do you find this while more readable?,103699757,2014-04-16 01:45:35
3505523,319889,11656884,50,"Its faster, no closures/allocations",103699757,2014-04-16 01:47:48
3505523,319889,11656888,52,"While is faster, no closures",103699757,2014-04-16 01:47:50
3505523,38527,11656943,22,Is there a reason you prefer an IndexedSeq here to an Array[V]? Is it jsut the translation cost into and out of DenseMatrix? It seems like the Array[V] is potentially cheaper (if we specialize)?,103699757,2014-04-16 01:49:04
3505523,38527,11656973,52,If this was haskell we wouldn't even be worrying about that ;) gotcha.,103699757,2014-04-16 01:49:45
3505523,319889,11657022,47,"Isn't used, removed",103699757,2014-04-16 01:50:34
3505523,319889,11657062,52,"Alas yeah, it can actually be a big thing for tight loops in scala -- really the compiler should just optimize it. There was a project for an optimizing complier plugin to do it but it appeared dead last I saw",103699757,2014-04-16 01:51:11
3505523,319889,11657097,22,"An array is mutable, closest immutable is the IndexedSeq I believe -- it can be backed by an array however",103699757,2014-04-16 01:51:59
3505523,38527,11657258,22,"Ah, yes I suppose we are hiding all of the mutable stuff from the user. We can probably get rid of more indirection in the future by exposing that, if it's a win.",103699757,2014-04-16 01:54:35
3505523,319889,11657360,22,"Aye, though without rust style ownership it's hard to leaverage most of the gains",103699757,2014-04-16 01:56:15
3505523,38527,11657441,22,"If you say @johnynek's name 3 times fast, he pops out and starts talking about rust or haskell",103699757,2014-04-16 01:57:12
3505523,38527,11658729,109,perhaps this logic should be in a method/constant whatever?,103699755,2014-04-16 02:23:08
3505523,319889,11661657,109,"Well this is the only place it exists in the code I modified, now if we should have some notion for all our sparse/adaptive systems for when to go dense, maybe. Also maybe should be a parameter. Not sure really.",103699755,2014-04-16 03:34:11
3509351,109310,11711321,124,Will `val` be better in this case?,103787894,2014-04-17 03:40:47
3509351,319889,11711343,124,"No, since if its not needed we would want to skip calculating it, i.e. in your code that makes these sketchmap you never need to generate this. ",103787894,2014-04-17 03:41:32
3509351,7111,11760808,48,"if we don't delete this, we are still binary compatible, right?",103722055,2014-04-18 05:45:02
3509351,319889,11760888,48,"The other previous changes to sketch map make this change already backwards
incompatible

On Thursday, April 17, 2014, P. Oscar Boykin <notifications@github.com>
wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/SketchMap.scala:
>
> > @@ -149",103722055,2014-04-18 05:49:27
3510710,164018,11754468,28,could you add a short description here?,103729735,2014-04-18 02:15:25
3510710,164018,11754852,76,is this why presentTuples is volatile? Why don't we put this into the previous synchronized block as flush is asynchronous anyway and won't be blocking.,103729735,2014-04-18 02:24:23
3510710,319889,11755793,76,Keeping nested usages of locks to a minimum reduces the risk of deadlock. Indeed an immediate pool would acquire the lock then twice since the asynchronous flush isn't really asynchronous then. ,103729735,2014-04-18 02:46:05
3510710,7111,11761206,24,Let's add a TODO: I think this algorithm is not using mutability. It could work almost exactly the same with List[Value] and vals everywhere.,103729734,2014-04-18 06:09:51
3511511,319889,11741840,4,"Good to rename these from L,R to improve the readability",103838014,2014-04-17 21:52:28
3511511,319889,11742031,6,"We need to batch this up since we can't materialize this all in memory, reducer side we stream data into this from on disk",103838014,2014-04-17 21:56:32
3511511,319889,11752330,98,if here shouldn't be necessary since sumOption covers the 0 case efficiently?,103838018,2014-04-18 01:28:25
3511511,319889,11752338,73,private[this] final is probably what you want to prefer here as a default,103838018,2014-04-18 01:28:31
3511511,319889,11752351,99,should use foreach rather than map to indicate you don't care about the return value,103838018,2014-04-18 01:28:50
3511511,7111,11753647,77,this should be .foreach. You are doing a side effect. .map may be lazy.,103838019,2014-04-18 01:57:06
3511511,7111,11753703,115,"can we have a return type on all public methods? (`Either[E, O]`)",103838019,2014-04-18 01:58:38
3511511,7111,11753776,73,"`checkSize[T:Semigroup](buffer...` means the same thing, is shorter and I usually prefer it if I am not going to explicitly use the variable (sg).",103838019,2014-04-18 02:00:07
3511511,7111,11753848,86,can we make these two branches private methods (Left/Right)?,103838019,2014-04-18 02:01:21
3511511,164018,11756238,115,really this method should be private to the file. Should I change that?,103838019,2014-04-18 02:56:43
3511511,319889,11756310,115,"Looks like it should be private to the class instance? That will make it binary incompatible, but next rls will be anyway",103838019,2014-04-18 02:58:21
3517652,7111,11779649,46,lazy val and privBuf.reverse,103768222,2014-04-18 22:32:19
3533454,7111,12151686,48,can we remove these?,103871237,2014-04-30 21:18:14
3555885,319889,11881570,139,atomic longs would be better?,104064558,2014-04-23 04:41:35
3555885,319889,11881632,17,Should we stick this in a statistics package to stop the huge number of classes going into the core algebird one? @johnynek thoughts? should we be trying to make a deeper tree here or do you rather the flat nature?,104064558,2014-04-23 04:43:24
3555885,164018,11881800,139,"hmmm, this code is not thread safe. I'm assuming single threading on this as this is to wrap monoids in the context they are used. They can be wrapped once per thread for example.
atomic longs would add significant overhead, right?

",104064558,2014-04-23 04:50:09
3555885,164018,11881809,17,"sounds good to me.
I can move this.",104064558,2014-04-23 04:50:46
3555885,319889,11881850,139,"Atomic longs would add an overhead, most(all?) of our monoids are all threadsafe themselves though. If the overhead is very large maybe we don't make these thread safe but i'm slow to do that. And we should ensure we call it out in big writing up the top ",104064558,2014-04-23 04:52:39
3555885,164018,11882153,139,"I'll move this to its own package with a warning at the top that they are not thread safe.
I think it makes sense for monoids in general to be thread safe and to achieve that by being stateless.
For statistics however it is better to have one instance p",104064558,2014-04-23 05:03:41
3555885,13840,11882414,33,Do we need to worry about overflow here? Or do we expect these numbers to be fairly small?,104064558,2014-04-23 05:14:24
3555885,13840,11882551,34,Should this be `31 - Integer.numberOfLeadingZeros(v)` if you want `floor(log2(x))` ? If you want `ceil(log2(x))` then I think you want `32 - Integer.numberOfLeadingZeros(v - 1)`,104064558,2014-04-23 05:21:25
3555885,164018,11882588,33,"This should add up to the total number of values summed in a given context.
In a hadoop job for example this should not be an issue.
Possibly in the context of a forever running storm job there should be a way to reset the stats every fixed period of ti",104064558,2014-04-23 05:23:35
3555885,13840,11882621,33,"Yeah, I'm not overly concerned about the overflow, especially if you make v
a Long and total a double.


On Tue, Apr 22, 2014 at 5:23 PM, Julien Le Dem <notifications@github.com>wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/Statisti",104064558,2014-04-23 05:24:41
3555885,319889,11882628,33,"FYI for storm this would need to be thread safe, so maybe if we aren't bothering for thread safety not worth considering too much.",104064558,2014-04-23 05:24:59
3555885,164018,11882686,34,"That is correct, however in this case it is possible for v to be 0.
""log2"" as the name of the variable is inexact but the value is actually what I want to store it in the array.
It is more ""log2_of_v_plus_1"" but I could also call it ""bucket""",104064558,2014-04-23 05:27:38
3555885,13840,11882706,34,"Ah right, that's correct. LGTM!


On Tue, Apr 22, 2014 at 5:27 PM, Julien Le Dem <notifications@github.com>wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/Statistics.scala:
>
> > +/**
> > + * @author Julien Le Dem
> > + */
> > +
",104064558,2014-04-23 05:28:40
3555885,38527,11963236,48,"2 << (i - 1) instead of pow(2, i).toInt?",104029972,2014-04-24 23:21:12
3555885,164018,11963967,48,This is not in the hot path but I can do this anyway.,104029972,2014-04-24 23:32:34
3555885,319889,11965466,24,(Very minor nit-pick): Maybe we should have threadSafe: Boolean = true to align with this statement as the default behavior? ,104064563,2014-04-24 23:53:26
3555885,38527,11965490,118,remove return,104064563,2014-04-24 23:53:47
3555885,38527,11965573,42,"if you make AtomicCounter and PlainCounter case classes you get this for free, with case matching and whatnot to boot.",104064563,2014-04-24 23:55:05
3555885,319889,11965587,89,new line + tab indent after the => ,104064563,2014-04-24 23:55:18
3555885,38527,11965620,48,"the internal counter should probably be private, no?",104064563,2014-04-24 23:55:47
3555885,319889,11965695,131,private[this] final  here?,104064563,2014-04-24 23:57:03
3555885,319889,11965742,158,as above,104064563,2014-04-24 23:57:45
3555885,38527,11965910,73,new Array(maxBucket + 1).map { _=> Counter(threadSafe) } ?,104064563,2014-04-25 00:00:24
3555885,164018,11966115,24,"is it not already the case? 
see ```StatisticsSemigroup[T](threadSafe: Boolean = true)``` etc",104064563,2014-04-25 00:03:47
3555885,319889,11966147,73,"This should probably be (0 until maxBucket + 1).map(_ => Counter(threadSafe)).toIndexedSeq or .toArray I think

new Array(int) is just a hint for the initial underlying size, I don't think it can work with a map. ",104064563,2014-04-25 00:04:18
3555885,319889,11966257,24,"Sorry my bad reading, had just read down far enough to see the counter one. Not reading well enough. 

since you have it in its own package/subtree, we could split the Counter, and Statistic classes out into their own files? Not required etc... but migh",104064563,2014-04-25 00:05:56
3555885,164018,11966269,42,will do. What do we get for free besides matching?,104064563,2014-04-25 00:06:09
3555885,319889,11966320,42,Your also exact apply method here would be generated too. Equality is different and a better toString by default. ,104064563,2014-04-25 00:07:17
3555885,164018,11966381,42,"right, the object and apply method ",104064563,2014-04-25 00:08:24
3555885,319889,11966543,42,"Yeah, here it really i guess will just drop 8 lines off your source code. Doubt the matching or other features will come into play. -- it also makes them serializable but here thats also not going to matter..",104064563,2014-04-25 00:11:12
3555885,164018,11967141,73,"Guys:
```
Array.fill(maxBucket + 1) {
    Counter(threadSafe)
  }
```",104064563,2014-04-25 00:22:51
3555885,164018,11967340,24,Sounds good to me,104064563,2014-04-25 00:26:59
3555885,319889,11969697,73,"Array is mutable, strong reason to use it over an indexed seq? ",104064563,2014-04-25 01:15:17
3555885,164018,11971568,73,good point. This dates from when it was and Array[Long]. It could be changed to an immutable now.,104064563,2014-04-25 01:49:18
3555885,319889,11971921,73,"Cool, I'll just make a small PR. Wanted to get yours in",104064563,2014-04-25 01:54:59
3558339,38527,11979219,14,this is equivalent to .reduce(_ && _),104427536,2014-04-25 05:30:27
3559463,319889,11970643,94,"I like this, looks much cleaner, but...  If i'm in a reducer and I call sumOption on the input stream, which is huge, i'll never convert to the space efficient type here I believe until I exhaust the input base type? -- could OOM in the case of Set => HLL",104064752,2014-04-25 01:33:18
3559463,164018,11971412,94,"This means that the contract of EventuallySemigroup forbids using sumOption on Right. Hopefully this also means the plus operation on the right semigroup is already optimal (like adding to a set).

If we want to respect the fact that after every plus ca",104064752,2014-04-25 01:46:43
3559463,319889,11971694,94,"not to be used exactly since its performance is pretty bad
val rI = new RightIterator(i)
val loopA = rl.grouped(MagicNumberHere).map(originalSemigroup.sumOption(_)).map(conditionallyConvert(_))
call a recursive function on loopA to do your logic on it ",104064752,2014-04-25 01:51:01
3559463,164018,11972398,94,"Why is the plus from Right bad here? If this is some kind of buffering and the Right type is Set then plus is actually faster because we don't need to materialize lists of elements to pass to sumOption. They just get added to the Set by plus. Then 
Also ",104064752,2014-04-25 02:04:43
3559463,319889,11972514,94,"Ok cool, yeah i think mine suffers some bad issues too your right. once the combination of the right's forms a must convert we need to stop doing right and convert. ",104064752,2014-04-25 02:07:01
3559463,38527,11978766,26,I think we should give these more instructive names then LeftIterator and RightIterator since the semantics are a bit different for each. The names should get at what purpose they serve.,106047098,2014-04-25 05:08:33
3559463,7111,12152261,95,"another approach here would be something like:

```scala
val partialSum: Iterator[Either[E, O]] = oi.grouped(100).flatMap { s =>
  Semigroup.sumOption(s)
}
.map { right =>
  if(mustConvert(right)) Left(convert(right)) else Right(right)
}
```
now",106064483,2014-04-30 21:31:56
3572768,38527,12108357,65,"Sometimes you reference T, sometimes (Key, Value). Is there a reason for that? flush is an example.",104274131,2014-04-29 23:15:16
3572768,38527,12109101,98,"Since this is public, does this apply? http://stackoverflow.com/questions/4593710/when-should-i-and-should-i-not-use-scalas-inline-annotation
I suppose it doesn't return anything, but still, since a lot of things depend on algebird, don't want to get in ",104274131,2014-04-29 23:28:20
3572768,319889,12109391,98,"This just shouldn't be public, but i'd tend to agree that inline in our public api's is maybe too error prone for us to want",104274131,2014-04-29 23:33:31
3572768,319889,12109412,65,"Lazyness since I often deal with it as a tuple rather than the Key, Value indvidually. I'll collapse it to one or the other this is messy",104274131,2014-04-29 23:33:58
3572768,38527,12109600,155,"I'm a little confused by the interplay between methods and which ones need to be thread safe, and which ones do not. Perhaps add some comments as to how the flow works? In the meantime I will just read more closely...",104274131,2014-04-29 23:37:24
3572768,38527,12109888,159,why 1 instead of 0 if you reset here?,104274131,2014-04-29 23:41:24
3572768,319889,12109949,159,"We immediately do the step after it, so if we set to 0 the counter + state of the CMS after the function would have diverged",104274131,2014-04-29 23:42:26
3572768,7111,12152417,46,what's up here?,106292746,2014-04-30 21:35:53
3572768,7111,12153257,193,"looks like you always pass in an Int, we might be able to save space by using an Int, Int map.",106292746,2014-04-30 21:56:07
3572768,319889,12287483,193,"That would be an int long map right? the second parameter is a count, which is a long. Using an Int would have the bigger risk of overflow?",106292746,2014-05-05 22:01:14
3572768,7111,12305404,184,"this is really filtering an Iterator and all the ones that pass wind up in the result iterator, all the ones that fail the filter wind up in the ListBuffer, right?",114085921,2014-05-06 04:30:28
3572768,7111,12305432,184,Can we rename (where is TraversableOnce in this picture)? And can we get more descriptive name and comment?,114085921,2014-05-06 04:31:06
3572768,7111,12305517,184,"Actually why not work on TraversableOnce?
```scala
def filter(to: TraversableOnce[T])(pred: T => Boolean): (ListBuffer[T], TraversableOnce[T]) = {
  val failed = ListBuffer[T]()
  val passed = new TraversableOnce[T] {
    def foreach(fn: T => Unit): ",114085921,2014-05-06 04:34:54
3572768,319889,12406597,184,"TraversableOnce has a much wider set of functions required:

method toTraversable in trait TraversableOnce of type => Traversable[T] is not defined
method copyToArray in trait TraversableOnce of type [B >: T](xs: Array[B], start: Int, len: Int)Unit is ",114085921,2014-05-08 03:25:22
3572768,7111,14371112,172,Can we rename this: `HeavyHittersCachingSummer`? I think Dynamic is not descriptive enough.,114085915,2014-07-01 00:48:32
3572768,7111,14479291,172,Any comment on this particular request?,114085915,2014-07-03 00:48:21
3572768,319889,14487465,172,Sorry I actually just missed this comment entirely. Rename sounds good. will do that now,114085915,2014-07-03 03:18:32
3657086,38527,12556022,9,"Can we have a couple of tests which use the monoid laws, and maybe some of the critical monoids in java land? IE SketchMap and HLL. Just want to make sure that the lookup works for our critical monoids.",110226286,2014-05-13 02:55:51
3657086,38527,12556272,51,Why are we doing this instead of just having the java Monoid class create a Class => Monoid mapping? This seems pretty brittle for saving not that many lines of writing.,110226286,2014-05-13 03:01:10
3657086,38527,12556772,38,"how will we get a ```SketchMap<String, Long>``` vs a ```SketchMap<String, Int>``` ? Should be reflected in the tests and we need a way to do this.",110226286,2014-05-13 03:10:56
3657086,164018,12556981,38,"This is not supported by this pull request.
But this can be augmented later.",110226286,2014-05-13 03:15:26
3657086,164018,12557068,9,"I'm not sure I get why we want to test the monoid laws here. This is just a lookup mechanism to help alleviate the lack of implicit in Java. So the test validates that the lookup mechanism works. caveat, for non parametric classes",110226286,2014-05-13 03:17:30
3657086,164018,12557185,51,"Could you give an example? I'm missing what you mean by ""the java Monoid class create a Class => Monoid mapping""",110226286,2014-05-13 03:20:07
3657086,38527,12562775,51,"ie instead of doing all this, just instantiating a HashMap<Class, Monoid<?>> that does this, with a setter that casts the output. This is in line with our general conversation around having safer links. That' sjust one of many options.",110226286,2014-05-13 06:06:10
3657086,164018,12613332,51,I have now added methods for this.,110226286,2014-05-14 03:50:51
3657086,38527,12671014,21,"Almost there, I think. Thank you @julienledem ! That said, I think the last thing we need is to test the monoids which take arguments. I think this needs a test of mapMonoid with different key types and stuff, to make sure that it all meshes together prop",112833272,2014-05-15 06:38:53
3948778,7111,13986206,10,"this change means something different in javadoc. The stuff on the first line is the summary, the rest is the detailed comments, I believe. Is that not correct?",128574259,2014-06-19 23:50:36
3948778,319889,13986433,10,"My understanding from wikipedia just now is that the first line, (on or after the opening of the comment) is the summary. then it expects a blank line or new paragraph to be the detailed",128574259,2014-06-19 23:54:31
3948778,319889,13986666,10,"BTW with this change in place the scaladoc for this constant looks ok
",128574259,2014-06-19 23:59:08
3948778,7111,13986784,10,"fine by me, then.",128574259,2014-06-20 00:00:57
4057205,7111,14530547,6,"you need to use MapEquiv here. `()` is the unit of this type, so this is not a failing test case. This is the expected behavior.

I would expect that you may get Map.empty here.",133324964,2014-07-03 23:36:31
4241701,38527,15376797,25,"the explanation of the difference in failure modes between sequence and join is not clear in this comment, imo",141413838,2014-07-25 03:20:14
4241701,232473,15376962,25,"Hmm... What I'm trying to say is that join and sequence are good primitives for functors that model concurrent computations.  (You could do everything with flatMap but you potentially waste time waiting on operations in order.  With join/sequence, if one ",141413838,2014-07-25 03:24:40
4241701,38527,15376989,41,"I don't think you need ;b, I believe b += t returns a ref to b",141413838,2014-07-25 03:25:22
4241701,38527,15377129,47,Put the laws in the comments for the applicative typeclass,141413838,2014-07-25 03:29:36
4241701,38527,15377281,25,"I think the comment is important, I just found the wording a little muddled.",141413838,2014-07-25 03:33:26
4241701,232473,15377346,25,"Better?  I'm trying to give a simple and concrete motivation as to why one would care about this typeclass.

/**
 * Simple implementation of an Applicative type-class.
 * There are many choices for the canonical second operation (join, sequence, joinW",141413838,2014-07-25 03:34:55
4241701,38527,15377410,80,typo,141413838,2014-07-25 03:36:51
4241701,38527,15377426,26,Move the laws into the class comments imo,141413838,2014-07-25 03:37:22
4241701,38527,15377680,28,dare we add ~> to algebird?!,141413838,2014-07-25 03:44:23
4241701,38527,15377824,24,"I think we should bump all laws into the comments of the class, instead of burying them.",141413838,2014-07-25 03:48:17
4241701,232473,15378030,80,s/Monad/Applicative/?  It's hard to see what's the line in focus here.,141413838,2014-07-25 03:54:29
4241701,232473,15378082,28,What does that do?,141413838,2014-07-25 03:55:50
4241701,38527,15381097,80,that' is a typo? I assume you meant that's?,141413838,2014-07-25 05:26:44
4241701,38527,15381110,27,This is much clearer. Thank you!,141369563,2014-07-25 05:27:13
4241701,7111,15384415,39,should we call this zip? Scala tends to do that.,141369563,2014-07-25 07:51:28
4241701,232473,15386774,80,oh that's a typo move from Monad.scala. :) fixed,141413838,2014-07-25 10:27:54
4241701,232473,15387046,39,"That could be a good name for it, one that at least doesn't confuse people expecting Haskell's Monad join (M[M[X]] => M[X]).  However, this operation for Seq produces a Cartesian product, not a zip (if you're using the instance that corresponds to the nor",141369563,2014-07-25 10:43:24
4241701,232473,15387206,39,"I'm also open to feedback on ""sequence"" - it's nice to have this in the trait since Future has an efficient override (Future.collect).  Is Seq the right type?  Traversable? ",141369563,2014-07-25 10:52:21
4241701,38527,15423662,39,"it could be a TraversableOnce, even... I know some people don't like that in APIs though",141369563,2014-07-26 01:47:33
4241701,232473,15426214,39,"Yeah TraversableOnce is a little restrictive.

def traverse\[T[\_] <: GenTraversable[\_], X](xs: T[M[X]])(implicit cbf: CanBuildFrom[T[X], X, T[X]]): M[T[X]]

might work, but I'll be damned if I can get the fold to typecheck.",141369563,2014-07-26 02:45:20
4241701,232473,15426843,39,"I'm pretty ok with keeping sequence and adding ""traverse"".  Had to add an ""asInstanceOf"" for reasons unknown (the bound was Any, not M[T], puzzling), but the tests pass...",141369563,2014-07-26 03:02:33
4241701,38527,15428360,39,"I don't think we need to geek out this hard, I think Seq is fine, no use muddling the api",141369563,2014-07-26 03:54:56
4241701,123326,15440308,39,"I would only recommend something analogous to Haskell's `liftA2` (you can call it whatever you want) as part of the `Applicative` trait, with a default implementation of `join`/`zip` (whatever you choose to call it) in terms of `liftA2`.  It's easier to w",141369563,2014-07-27 22:11:26
4241701,123326,15440312,39,Oops!  I totally missed that you already had `joinWith`.  Ignore me.,141369563,2014-07-27 22:12:12
4367803,38527,16004363,39,"Does this have more general use outside of KV stores? Given it is functionality in terms of tryPlus, do we want it to be in the base trait? I only ask because it seems quite specialized...",146709042,2014-08-08 22:16:32
4367803,7111,16005524,39,Good point. I don't know yet. Maybe we should remove it from the base trait.,146709042,2014-08-08 22:39:37
4367803,7111,16005587,116,"lift and sink should be protected, as should maxEvent and minEvent.",146709042,2014-08-08 22:40:37
4367803,7111,16005621,188,"should override maxEvent, since it is called below, and is just this here (saves an allocation).",146709042,2014-08-08 22:41:14
4367803,7111,16005643,307,should be private.,146709042,2014-08-08 22:41:36
4367803,7111,16005661,270,should be private.,146709042,2014-08-08 22:41:50
4367803,7111,16005699,43,"should return `Map[Int, Stamp]`",146709042,2014-08-08 22:42:25
4367803,7111,16005768,55,this is broken. need .map(_.swap) or just pad left here and not do the recursive call.,146709042,2014-08-08 22:43:52
4367803,38527,16616566,39,Given you have the method in the companion object I think tryPlus is good enough.,146709042,2014-08-23 00:25:32
4367803,38527,17120865,28,no suuuuper strong opinions here but imho there's enough code here that this could be a package and you could split things out a bit. Might be easier to read if they're in separate files and stuff. This is a giant object. But they are all heavily related ,146709042,2014-09-04 20:33:49
4529513,7111,17010920,30,"This should be ""DecayedVector[Map[Int, _]] is a monoid""",154675418,2014-09-03 00:49:46
4529513,7111,17011110,97,hadn't seen this before. an[AssertionError] must be thrownBy is what I knew. This is better.,154675418,2014-09-03 00:52:37
4529513,7111,17011189,171,why are these all commented out?,154675418,2014-09-03 00:53:44
4529513,7111,17011878,68,I guess this is blocked on bijection 0.7.0? I assume we broke binary compatibility with the Manifest changes.,154675418,2014-09-03 01:03:35
4529513,319889,17015709,30,Will fix.,154675418,2014-09-03 02:03:39
4529513,319889,17015721,97,"Yep, think it might not have been in older versions of scalatest",154675418,2014-09-03 02:03:52
4529513,319889,17015743,171,"Bad update on my behalf, needs to be re-enabled. Will fix.",154675418,2014-09-03 02:04:08
4577233,7111,17576675,282,I guess this should be Monoid[I] now.,156031326,2014-09-16 04:58:59
4577233,7111,17576681,288,Ring[I]?,156031326,2014-09-16 04:59:06
4579847,7111,17609702,317,This was changed to Ring[I] in the 0.7.1.,156057656,2014-09-16 20:45:34
4579847,7111,17610281,183,"can we add
```scala
implicit def applicative[I]: Applicative[({type L[O] = Fold[I, O]})#L] = new FoldApplicative[I]
```
So we can pick it up automatically.",156057656,2014-09-16 20:54:40
4579847,232473,17621681,183,Done,156057656,2014-09-16 23:43:16
4579847,232473,17621694,317,Done,156057656,2014-09-16 23:43:30
5104998,7111,20477750,86,why remove these assertions? Seems like it does not hurt to have those (as require).,179275065,2014-11-18 07:31:18
5104998,7111,20477812,150,"should we make a `.aggregator: MonoidAggregator[K, CMS[K], CMS[K]]` method on CMSMonoid?",179275065,2014-11-18 07:33:15
5104998,7111,20477827,86,"nevermind, I see where they were moved.",179275065,2014-11-18 07:33:45
5104998,7111,20478152,208,"Can we add tests that these methods inject properly: `depth(depth(i)) == i` for all i > 0, similarly with width.",179275065,2014-11-18 07:41:08
5104998,7111,20478238,471,"should these just be defs and reduce the object size? Seems like the JVM will inline the calls to param.eps, right and there is a method invocation on val access anyway, right?",179275065,2014-11-18 07:42:55
5104998,7111,20478294,482,where is the Ordering used here? Is it needed?,179275065,2014-11-18 07:44:10
5104998,7111,20478318,482,Ahhh. On creating CMSInstance.,179275065,2014-11-18 07:44:42
5104998,7111,20478499,580,"```scala
countsTable
  .counts
  .iterator
  .zipWithIndex
  .map { case (row, i) => row(params.hashes(i)(item)) }
  .min
```
Might be faster since we don't need to allocate to do the zipWithIndex, we just lazily build it up with an Iterator.",179275065,2014-11-18 07:49:12
5104998,7111,20478589,580,"or:
```scala
countsTable
  .counts
  .iterator
  .zip(params.hashes.iterator)
  .map { case (row, hash) => row(hash(item)) }
  .min
```",179275065,2014-11-18 07:50:53
5104998,7111,20478641,602,"```scala
(0 to (width - 1)).iterator.map(f).sum
```
Don't allocate a whole list, just sum up the iterator.",179275065,2014-11-18 07:52:00
5104998,7111,20478656,607,same iterator trick.,179275065,2014-11-18 07:52:16
5104998,7111,20478763,780,I think def here is better (and below).,179275065,2014-11-18 07:54:54
5104998,7111,20479065,975,do we need the K: Ordering bound here? No methods inside it use it.,179275065,2014-11-18 08:01:17
5104998,7111,20479203,30,"I think this is broken with the upgrade to scalatest. See #357 
I think you need:

`assert(monoidLaws[CMS[Short]])`

for these after the scalatest migration.",179275065,2014-11-18 08:04:52
5104998,127204,20495163,150,"Not sure -- I haven't used the `aggregator` functions yet so I can't really say where having one would be useful. :-)  (I assume the aggregator functions are used elsewhere in Algebird for ""generic"" operations.)

FYI:  At the moment all the `aggregator`",179275065,2014-11-18 16:52:00
5104998,127204,20495449,30,"Hmm, all these `property` based tests pass for me, even after merging in the latest code in `develop`.

`assert(monoidLaws[CMS[Short]])` even gives me a compile error (""Cannot resolve reference assert with such signature"").

Is there something I am mi",179275065,2014-11-18 16:58:07
5104998,127204,20501344,208,"Did you mean to say `depth(delta(i)) == i`?  Let me know if I misinterpreted your comment.

I think what you wanted to test is whether translating between the CMS parameters `delta` and `depth` is properly done by by the `delta()` and `depth()` function",179275065,2014-11-18 19:15:41
5104998,127204,20502379,471,"Yes, AFAIK `val` access is done through an accessor method.  The reason I used a `val` is to clarify the intent that it is a constant value.

In practice, wouldn't the size of a CMS instance be primarily determined by its counting table?  That is, would",179275065,2014-11-18 19:40:13
5104998,127204,20502779,580,"Good point, updated.

FYI: In my PR I tried to not touch any existing code if it wasn't necessary for the `CMS[K]` functionality (apart from a few whitespace changes that may have slipped in because of IDE formatting settings).",179275065,2014-11-18 19:49:16
5104998,127204,20502830,602,Changed.,179275065,2014-11-18 19:50:23
5104998,127204,20502921,607,"Changed.

Btw, at which point would you draw the line between allocating a list vs. using an iterator?  In the case of `width` (which may be in the hundreds or thousands, depening on `eps`) that seems to be clear.  What about depth, which is often < 20?",179275065,2014-11-18 19:52:30
5104998,127204,20503014,780,"See [my comment above](https://github.com/twitter/algebird/pull/354#discussion_r20502379) to your [earlier question](https://github.com/twitter/algebird/pull/354#discussion_r20478238) about `def` vs. `val`.

As I said, I'm fine either way -- just let me",179275065,2014-11-18 19:54:56
5104998,127204,20503213,975,"You're right, changed.",179275065,2014-11-18 20:00:23
5104998,127204,20503252,482,"Yeah, this seemingly innocent change of going from `CMS` to `CMS[K]` resulted in more context bound fiddling than I initially expected. ;-)",179275065,2014-11-18 20:01:35
5104998,7111,20522727,208,"Very thorough analysis as always. Adding the test has the value of keeping these pairs of functions related (I'm concerned someone makes some change to one, and since they should be consistent, things are broken in the future).

So, I'd rather add the t",179275065,2014-11-19 00:42:07
5104998,127204,20573866,208,"I have done some further experiments this morning, maybe the findings will help a little.

I already added test cases that document the good as well as the bad behavior of depth/delta roundtripping: https://github.com/miguno/algebird/commit/9c02f1a2070e",179275065,2014-11-19 20:24:55
5228368,7111,20054334,3,"can you add tests using monoidLaws and groupLaws for commutative and non-commutative cases?  An example non-commutative monoid would be String (I am not sure we actually have any non-commutative groups implemented, but for fun you could do quaternions).",184336962,2014-11-09 03:48:57
5248682,7111,20811685,19,"should we check that the result of ceil is <= Int.MaxValue? I know that overflow will go to Int.MaxValue, but while we are throwing exceptions, perhaps we should for some delta that is actually non-sensical in that it would require more than MaxValue dept",184473882,2014-11-25 01:43:40
5248682,127204,21088365,19,"Checking for `ceil <= Int.MaxValue` another option, and you make a good point regarding us checking for the practical limits of the CMS implementation (e.g. memory).  Hmm.

The reason I put the constraint on `delta` was to make it consistent with the th",184473882,2014-12-01 20:37:11
5248682,7111,21252462,19,sounds good to me.,184473882,2014-12-04 01:23:12
5311883,319889,21571943,17,why is the breakOut gone?,184862268,2014-12-10 06:21:29
5311883,319889,21572000,32,"Boolean is too common of a type, use an AnyVal case class to represent it",184862268,2014-12-10 06:22:10
5311883,319889,21572203,20,do we have tests for both of these with compact on/off? did we benchmark it?,184862268,2014-12-10 06:23:35
5311883,319889,21572233,73,toIterator rather than toSeq?,184862268,2014-12-10 06:24:01
5311883,319889,21572300,41,"There are huge if's now in the middle of this, do they share that much logic that its not worth just making them separate? Futures need to get threaded through the simpler one for this now?",184862268,2014-12-10 06:25:03
5311883,319889,21572349,18,Incrementor should probably be defined somewhere more common than in the HH caching summer?,184862268,2014-12-10 06:25:46
5311883,2523602,21572654,41,"so the internal MapContainer already has the `if` in the middle and this is how it looks
```
    def addValue(v: Value): (MapContainer, Int) = {
      if(size > compatSizeInt) {
        val newV = workPool{fSg.sumOption(Future.value(v) :: privBuf).get",184862268,2014-12-10 06:31:03
5311883,2523602,21576662,20,i have modified existing tests for compact off. Will add test for compact on,184862268,2014-12-10 07:49:22
5311883,7111,21699242,138,"1. algebird already has this in algebird-util.
2. I don't like the pattern of plus via sumOption. I think it is better to do: `a.join(b).map { case (l, r) => sg.plus(l, r)`
",186228061,2014-12-12 02:02:48
5533342,1847115,24430398,13,"@johnynek since you aren't running coverageReport, what does this actually end up publishing?",215090636,2015-02-11 00:18:02
5533342,1847115,24430502,13,"Sorry, I mean coverageAggregate - https://github.com/scoverage/sbt-scoverage#multi-project-reports",215090636,2015-02-11 00:19:19
5579937,2523602,21919483,5,you can achieve the same thing using composePrepare right?  Do we  really need a dedicated lift function? ,194858850,2014-12-17 01:25:02
5579937,44017,21920600,5,"This affects all of prepare, present and semigroup, so I don't see how composePrepare could achieve it. As an example `MinAggregator[Double].lift` gives you an `Aggregator[Option[Double], Option[Double], Option[Double]]`. How else would you do that succin",194858850,2014-12-17 01:40:20
5579937,123326,21923640,5,"I think the correct solution is actually to require a stronger `MonoidAggregator` (so that you can handle the case of an empty `TraversableOnce` and provide the following method on `MonoidAggregator` that generalizes `composePrepare`:

```scala
def pre",194858850,2014-12-17 02:18:03
5579937,123326,21924886,5,"Sorry, I forgot to mention one thing.  I think you should provide something similar to `lift`, but with this type signature:

```scala
    class Aggregator[A, B, C] {
        def toMonoidAggregator[A2] : MonoidAggregator[A, Option[B], Option[C]
    }",194858850,2014-12-17 02:32:47
5579937,44017,21925556,5,"`preFold` is the same as `sumBefore`, later in this PR, right?",194858850,2014-12-17 02:40:43
5579937,44017,21925652,5,"I like your `toMonoidAggregator` but might just call *that* `lift`? What do you think, @danielhfrank?",194858850,2014-12-17 02:42:05
5579937,123326,21926264,5,"Yeah, I like the name `lift` better than `toMonoidAggregator`.  I just chose a different name to avoid confusion.

You're also right that `preFold` is similar to `sumBefore`.  I think `preFold` is more general, but I think it's still worth keeping `sumB",194858850,2014-12-17 02:50:20
5579937,44017,21929362,5,"`preFold` is exactly equivalent to `sumBefore` followed by `composePrepare`, correct?",194858850,2014-12-17 03:27:39
5579937,123326,21932936,5,"Oh yeah, you're right.  Then you don't need `preFold` after all.  `sumBefore` suffices.",194858850,2014-12-17 04:21:54
5579937,64056,21937136,5,"Let me try to sum up, so to speak. Sticking with current names as they exist, it sounds like the only change we're talking about is, for the case where you want to go from `Aggregator[A,B,C]` to `Aggregator[Traversable[A], Option[B], Option[C]`, you would",194858850,2014-12-17 05:18:40
5579937,123326,21937819,5,The advantage of `MonoidAggregator` is that the result is defined for empty input streams.  You're probably more familiar with using `Aggregator`s in the context of doing `.group.aggregate(..)` in `scalding` where you're guaranteed that the set of values ,194858850,2014-12-17 05:27:45
5579937,64056,21945862,5,"Cool, I now see the method implementations that are unsafe in the general Aggregator trait. As I was saying off thread to @avibryant , I definitely see a lot of appeal in making this library code as flexible as possible. I'll update `lift` and the tests a",194858850,2014-12-17 07:57:57
5579937,7111,21946103,6,"let's use `TraversableOnce` here, which we usually use to cover `Iterator` and `Iterable`.",194858850,2014-12-17 08:03:09
5579937,7111,21946207,28,"1. can we avoid using `()` except for side Unit returning methods?

2. Can we use `TraversableOnce` here?",194858850,2014-12-17 08:04:54
5579937,7111,21946308,5,"Let's avoid the `()` on non-Unit methods.

+1 for returning MonoidAggregator here.",194858850,2014-12-17 08:07:34
5579937,7111,21946426,5,"Also, I do like the suggestion of having a separate method to convert an `Aggregator[A, B, C]` to `MonoidAggregator[A, Option[B], Option[C]]`",194858850,2014-12-17 08:10:52
5579937,2523602,21946879,5,"one thing that I have been discussing with @Gabriel439 offline is that if we have  nested lists like `List[List[A]]` and we use  `MonoidAggregator[Traversable[A], Option[B], Option[C]]` both of them will be reduced by monoid on B, which is fine for most s",194858850,2014-12-17 08:21:49
5579937,7111,21949698,5,"wouldn't this do it:

```scala
min.composePrepare { list: List[Int] => AverageAggregator(list) }
```
You want a way to put an Aggregator in your Aggregator more explicitly?

```scala
def composeAggregate[A0, B0](a: MonoidAggregator[A0, B0, B]): Ag",194858850,2014-12-17 09:50:49
5579937,7111,21949812,5,"I guess in light of this PR, `aggregateBefore` would be a better name.",194858850,2014-12-17 09:54:15
5579937,2523602,21950570,5,Yes this is what I was talking about. We should have a `aggregateBefore` method for this kind of use case. I will try to send a PR,194858850,2014-12-17 10:32:49
5611836,13840,22089652,21,Duplicate condition?,197227041,2014-12-19 11:41:46
5611836,13840,22089701,59,"Not sure if this is any faster:

```scala
  lowerChild.isEmpty && upperChild.isEmpty
```",197227041,2014-12-19 11:44:18
5611836,1601752,22089773,21,"Yep, fixed.",197227041,2014-12-19 11:50:23
5611836,7111,22134768,59,"+1 to this. match is elegant, but this code is in the hot path in many cases.",197227041,2014-12-20 06:06:33
5622897,7111,22180926,9,"I don't like doing a conversion as the first thing in a method.

What about making this method take `Iterator[A]`?

If you did that, I think you would implement this using scanLeft:
```scala
inputs.scanLeft(None: Option[B]) {
  case (None, a) => So",197644099,2014-12-23 01:17:19
5622897,44017,22183720,9,"Thanks for the scanLeft implementation, I was being lazy by not using that (for some value of lazy). 

I'd like to push back on having it take `Iterator[A]`, though, because that's inconvenient if you have, say, a `List`. I think the right thing to do i",197644099,2014-12-23 02:08:35
5622897,7111,22186088,18,"I think you can put `CanBuildFrom[Nothing, C, Out]` here, because you are not calling `bf.apply(inputs)`. It may increase the number of implementations since really you just need a builder factory.",198322189,2014-12-23 02:50:14
5622897,7111,22186241,18,"Also, what is the win here for `TraversableLike` rather than `TraversableOnce[A]` if we use the `Nothing` above? This also simplifies the type parameter, since you only have to pass the result type.",198322189,2014-12-23 02:53:11
5622897,44017,22186301,18,"Heh, you musta refreshed at just the wrong time, I changed to TraversableOnce.",198322189,2014-12-23 02:54:25
5622897,44017,22186328,18,If you use `Nothing` then you are not constraining the CanBuildFrom enough and it becomes useless (it will always just give you IndexedSeq).,198322189,2014-12-23 02:54:52
5622897,7111,22332561,17,what's the difference with this and applyCumulatively?,200937907,2014-12-30 05:48:00
5622897,44017,22333192,17,"Whoa, not sure how that stayed in there. Will delete.",200937907,2014-12-30 06:11:29
5696801,7111,22365553,13,"just for illustration, can you use two different input types for ag1 and ag2 (not both Int)?",201201172,2014-12-31 04:28:24
5696801,7111,22365562,6,"This is a nice addition.

Can you add a comment that the law here is this:
```scala
agg1.zip(agg2).apply(as.zip(bs)) == (agg1(as), agg2(bs))
```
",201201172,2014-12-31 04:28:31
5696801,7111,22365608,13,"also, can you use a List for the input so we test pushing more than one item through?",201201172,2014-12-31 04:29:50
5696801,24443,22365779,13,Sure thing! I'll push an amendment with those changes in a moment.,201201172,2014-12-31 04:33:53
5698697,7111,22394077,27,creating a bunch of these is going to be O(N^2) since we get O(N) hit on each one. Should we make it lazy val or def?,201223949,2015-01-01 03:58:18
5698697,7111,22394304,35,"order does not matter here, so `larger.reverse_:::(smaller)` will be faster. If you don't want to check the size, then `items.reverse_:::(other.items)`.",201223949,2015-01-01 04:09:26
5698697,7111,22394320,45,"I guess my lazy val suggestion makes no sense because of this, you are always checking it. Still, I think we should not have the O(N^2) algo.",201223949,2015-01-01 04:10:12
5698697,7111,22394424,47,probably worth it to use a mutable array here and only at the end toVector it. The whole point is optimization here.,201223949,2015-01-01 04:16:01
5698697,44017,22396632,27,We can explicitly track it.,201223949,2015-01-01 06:44:32
5698697,127204,22396765,27,"(And as I said above)

Double-checking:  IIRC `totalCount` in Algebird's CMS is the equivalent of the L1-norm of the counting vector in the CMS paper.  If that is true, then `totalCount` should not be `item.size` but:

```scala
override val totalCoun",201223949,2015-01-01 06:59:08
5698697,44017,22398105,27,"Items is not a sparse counting vector (although that might make sense), but simply a list of keys, which may contain duplicates. So `items.size` is the correct way to get the totalCount - this will be equivalent to the L1-norm of the counting vector once ",201223949,2015-01-01 12:24:17
5698697,127204,22398388,66,"It looks as if `count` is not being taken into account.  Shouldn't `+(x, 4)` result in the count of `x` being increased by 4?

This was the reason why I asked the `totalCount` question about `items.size` vs. `items.sum` (the L1-norm) -- size would be eq",201518626,2015-01-01 14:07:52
5698697,127204,22398542,5,"Can we use a const for `0` to explain the magic number, just like we do for EPS, DELTA, and SEED?",201518626,2015-01-01 15:06:24
5698697,127204,22398546,39,"We should add a `require(maxExactCount >= 0, ""maximum exact count must not be negative"")`.",201518626,2015-01-01 15:07:45
5698697,127204,22398552,53,"When `maxExactCount == 0` what should happen to this `case`?  That is, when it is zero my understanding is that the user wants to disable the exact counting optimization based on `CMSItems`, so this `case` statement should rather be ""if (zero) oldCode els",201518626,2015-01-01 15:11:41
5698697,44017,22398623,53,"We should probably just add `.toCMS` here. If `maxExactCount == 0`, that will trigger a conversion to `CMSInstance`.",201518626,2015-01-01 15:31:15
5698697,44017,22400471,66,"Thanks, good catch.",201518626,2015-01-01 23:31:55
5698697,7111,22420976,80,"1. don't we want the method `reverse_:::` which combines these two to save cost?
2. don't we want the smaller one on the left so we push the fewer items onto the bigger?",201518626,2015-01-03 03:02:26
5698697,127204,22439141,80,">  (2) don't we want the smaller one on the left so we push the fewer items onto the bigger?

The code is correctly pushing the smaller list onto the larger list:

```scala
scala> val larger = List(1,2,3,4,5,6,7,8,9)
larger: List[Int] = List(1, 2, 3",201518626,2015-01-04 20:27:10
5716406,7111,22422919,9,can we add some tests for this?,201874729,2015-01-03 04:09:00
5716406,7111,22423066,11,"can't you use `valueAsOf(this, halfLife, endTime)` here to be a bit more clear?",201874729,2015-01-03 04:13:44
5716406,7111,22423093,9,"so `averageFrom(h, 0.0, e) == average(h)` right?",201874729,2015-01-03 04:14:32
5716406,44017,22425430,9,"working on tests, but as I'm doing them I'm becoming suspicious of the original math. For example: the average (whether using `average` or `averageFrom`) of, say, `f(t) = t` is > t, and it diverges as `t` increases. That seems like a strange thing for an ",201874729,2015-01-03 05:36:10
5716406,44017,22425474,9,"`averageFrom(h, 0.0, e)` can be > `average(h)` if `e < n*h` for small `n`. That's intended; the `average` goes to time `-Inifnity`, whereas `averageFrom` does not.

However, `averageFrom(h, 0.0, e)` will converge to `average(h)` as `e` goes to infinity,",201874729,2015-01-03 05:37:46
5716406,44017,22425500,11,That's a method on the monoid and you don't have access to that here.,201874729,2015-01-03 05:38:37
5716406,44017,22426388,9,"(re being suspicious of the math - I definitely come up with the same answer when I do it from first principles, but I struggle with the intuition of an average being higher than any values it's seen so far; I'm sure this is something to do with discrete ",201874729,2015-01-03 06:13:31
5775580,7111,22770831,61,not using b worries me. Can you add a comment as to why this is safe? Why would we not combine a and b in some interesting way (a * Int.MaxValue + b) or something.,203722673,2015-01-12 05:29:51
5775580,7111,22770806,72,"Int.MaxValue is another way to say this, right?",203722673,2015-01-12 05:27:10
5775580,7111,22770847,107,see comments about my anxiety lack of using b.,203722673,2015-01-12 05:31:48
5775580,7111,22770821,68,this really can't ever throw due to how it is constructed. Is it worth a check that never succeeds? My thinking is that this is better in a test than in the run path.,203722673,2015-01-12 05:28:44
5775580,7111,22770865,111,can we also check that `approxA.min >= 0`?,203722673,2015-01-12 05:34:04
5775580,7111,22770885,64,I guess this was a bug before. Does the new test find this bug? Why didn't we see a test failure in the past?,203722673,2015-01-12 05:35:35
5775580,127204,22771439,61,"My reasoning was along those lines: http://stackoverflow.com/questions/3956478/understanding-randomness.  As long as the seed to Murmur is random we should get what we need.  My understanding is that ""randomVal1 (op) randomVal2"" will not improve the ""rand",203722673,2015-01-12 05:54:08
5775580,127204,22771572,111,"Ah, good catch. Will do. ",203722673,2015-01-12 06:07:16
5775580,127204,22771628,61,PS: And in case my reasoning does make sense I will add a code comment of course.,203722673,2015-01-12 06:13:34
5775580,127204,22779984,111,Done.,203722673,2015-01-12 16:16:08
5775580,127204,22780102,72,Yes.  I changed the line from `(1L << 31) - 1` to `Int.MaxValue1`.  (Note that I intentionally did not change the legacy code before because that change would have been unrelated to the BigInt-hashing change.),203722673,2015-01-12 16:19:34
5775580,127204,22782283,65,"No special thoughts here -- I simply used the same code as we see in Java's Hashtable implementation.  According to your suggestion I changed `0x7FFFFFFF` to `Int.MaxValue` because it clarifies the intent better than the hex numeral.

I compared benchma",203722673,2015-01-12 17:17:20
5775580,127204,22783272,68,I replaced the `assert` for all hash functions with a fuzzy test that verifies that hashes (i.e. slots) are always positive.,203722673,2015-01-12 17:40:24
5775580,7111,22770812,65,"the number on the right is Int.MaxValue, right? Any thoughts on why to say it one way or another?",203722673,2015-01-12 05:27:55
5775580,7111,22770842,114,see comments above about this.,203722673,2015-01-12 05:31:28
5775580,127204,22771497,64,"We do not have a direct test for this (may or may not be helpful, I am fine either way), but the new property-based tests for estimating inner products has been triggering the bug pretty reliably before I fixed it.  The reason we didn't see this bug befor",203722673,2015-01-12 05:59:54
5775580,127204,22780041,64,"I added two tests for each Top-% CMS and Top-N CMS that test for this bug.  Note that because the counting table has private access I use the workaround of ""identity"" inner products of single-item CMS (= the inner product of a CMS instance with itself) to",203722673,2015-01-12 16:17:49
5775580,7111,22918024,173,this is weird. Isnt' this x shadowed below?,204760718,2015-01-14 12:51:20
5775580,7111,22918026,220,shadowing again?,204760718,2015-01-14 12:51:31
5775580,127204,22918650,173,"You were right, this shadowing should not have been there.  The outer x/y loop was a relic from the previous test code.  Dumb copy-paste mistake of mine!",204760718,2015-01-14 13:22:50
5794913,7111,22968695,23,"seems like spark follows this style, which I assume that it means it can try to work even if there is no Ordering. Scalding requires the ordering, and uses the approach you suggest.",204208335,2015-01-15 03:49:38
5794913,44017,22753126,20,why `aggregatorOnAll` and `aggregatorByKey` rather than `aggregateAll` and `aggregateByKey`? The latter seem a closer fit to spark's `reduceByKey`,204208335,2015-01-10 07:32:17
5794913,7111,22760015,20,"There is already `aggregateByKey`. I will add tests and see if the implicit enrichment can differentiate based on the arguments. It may, or it may give the user a very confusing message. Let's see.",204208335,2015-01-10 23:30:41
5794913,127204,22923298,23,"- Edit: Doh, should have read the code more closely before asking the first question.  Never mind. :-)

- Any particular reason to give a default of `null` to `ordK` and/or to use an implicit parameter instead of `K: ClassTag: Ordering`?

    ```scala",204208335,2015-01-14 16:00:45
5794913,78851,33745873,16,"Latest Spark version is 1.4.0 now, not sure how you want to handle versioning",278417038,2015-07-02 08:59:28
5794913,78851,33746021,65,"I'm not too familiar with how the underlying operations work, but you may or may not need a commutative Semigroup for this to work out... it's very possible I'm wrong though.",278417038,2015-07-02 09:05:49
5794913,78851,33746064,37,Use `keyed` to be consistent? ... minor :-) ,278417038,2015-07-02 09:07:31
5794913,2221968,33746640,7,ToAlgebird?,278417038,2015-07-02 09:29:45
5794913,319889,33746726,16,Its provided so the user brings their own. Once the API's ABI compatible in spark this uses it should work fine for both,278417038,2015-07-02 09:33:06
5794913,319889,33795459,5,"was there a particular reason to make this change? It looks like its probably more efficient, but curious if you had a benchmark/profile you saw this in?",278417038,2015-07-02 21:24:12
5794913,319889,33795595,37,Could probably unwrap this in place here if the compiler doesn't mind to avoid the _1 and _2 references below,278417038,2015-07-02 21:25:42
5794913,319889,33795285,65,"it does need a commutative semigroup for both of these operations(in sumOption) to work. In practice thats often what users have/operations they want to do (take scalding's sumByKey). 

Not sure if it should be indicated clearer here",278417038,2015-07-02 21:22:31
5794913,319889,33795743,51,Shame no way to wire in sumOption here...but oh well.,278417038,2015-07-02 21:27:09
5794913,319889,33795659,32,"minor, but line is too long here for github viewing with scrolling, probably good to wrap it",278417038,2015-07-02 21:26:18
5794913,7111,33808593,5,"I didn't benchmark. I was thinking about using this to implement mapSide caching, which could have allowed at least using sumOption on the ""reducer"" side of the computation, but I back-peddled on that since we'd have to have parameters for the cachesize, ",278417038,2015-07-02 23:34:58
5890427,7111,23948513,479,"why do we need the implicit hasher here rather than doing `self.hash(a, b, width)(f(x))` below? This method, with the implicit parameter, seems appropriate for the `object` but not the trait. I don't see where this method uses `this` or `self`, which is w",213306850,2015-02-03 02:02:29
5890427,7111,23948533,501,same comment as above.,213306850,2015-02-03 02:02:41
5890427,7111,23949229,270,"damn scala. Equiv and scala.util.hashing.Hashing should be what we want here, but they are so broken and impoverished I guess we should think about it.

I really don't like using ClassTag in general, and I especially don't like it here when it is in fac",213306850,2015-02-03 02:11:36
5890427,127204,23949987,501,Fixed.  (And good catch.),213306850,2015-02-03 02:21:10
5890427,127204,23949977,479,Fixed.,213306850,2015-02-03 02:21:02
5890427,127204,23952262,270,"I'd be more inclined to say ""Damn Java Array!"" but otherwise I totally agree. ;-)

> Equiv and scala.util.hashing.Hashing should be what we want here, but they are so broken and impoverished I guess we should think about it.

I haven't used either of ",213306850,2015-02-03 02:47:21
5890427,7111,23953102,270,"Why is Equiv bad news?

The reason is that in the `object Equiv` there is an implicit Equiv for every type that just defaults to `a.equals(b)`. So, with that implicit hanging out, taking an `Equiv[T]` is not a guarantee of any kind of type-safe equivale",213306850,2015-02-03 02:57:58
5890427,127204,23953659,270,"Thanks for the explanation.  Then I don't have to feel to bad about not having heard of `Hashing` before. :-)

> The benefit you note with dropWhile is even more of a win.

Just to be clear:  If we push Ordering to only TopK, then we lose `dropWhile` ",213306850,2015-02-03 03:04:52
5890427,127204,23954034,270,So I guess the conclusion is:  Revert the `ClassTag` and bring back `Ordering` (for TopK only)?,213306850,2015-02-03 03:09:48
5890427,7111,23972823,270,"I think that's the most correct approach (where correct means that the typeclasses in play are the ones closest to what the code actually requires).

@jnievelt do you have any concerns?

Thank you, sir.

",213306850,2015-02-03 07:29:07
5890427,7111,24850069,13,"I think we need some tests to exercise the case that they are not all equal. Right now, equals(t: Any) == (t != null) and compare(a, b) == 0 would pass your tests",218961572,2015-02-18 03:20:19
5890427,127204,24886624,13,"Good catch regarding the `equals` test.  In the latest commit I enhanced the test spec of Bytes in general.

> compare(a, b) == 0 would pass your tests

As part of the changes I also enhanced the `compare` tests, although `compare(a, b) == 0` was alre",218961572,2015-02-18 15:56:47
5897127,7111,23106517,96,needs comments to explain the usage.,205891262,2015-01-17 03:19:02
5897127,7111,23106527,75,comment please.,205891262,2015-01-17 03:19:11
5897127,7111,23106691,3,"need tests for this to exercise and demo the code.

Also, the scala docs should exists.",205891262,2015-01-17 03:21:36
5897127,44017,23107549,3,"Yep, just wanted to get feedback on the API before I spent the time documenting it.",205891262,2015-01-17 03:35:32
5897127,7111,23108452,20,I wonder if it is worth making `IdentityPreparer[A]` that does not bother calling compose. It might help perf a bit since the jit does not have to realize identity does nothing.,205912340,2015-01-17 03:51:05
5897127,7111,23108821,3,"So this is a one pass transformer: compose `A => TraversableOnce[B]` as many times as we like, then aggregate.

This kind of composition comes up so much, I wonder if we should have that as a thing by itself. These things form a category, and combine is",205891262,2015-01-17 03:57:00
5897127,7111,23274321,45,shouldn't this have `def sum(implicit m: Monoid[T])`?,207822289,2015-01-21 09:23:44
5897127,7111,23274367,45,"nevermind, I see it below in both subclasses.",207822289,2015-01-21 09:24:52
5897127,7111,23274477,189,can't all these till the end be in Preparer?,207822289,2015-01-21 09:28:09
5897127,44017,23277147,189,"They could. Originally I had them without the 'Option' suffix (ie, `head`, not `headOption`) and so they would have conflicted with the semigroup versions. But I think it's better to be explicit.",207822289,2015-01-21 11:08:01
5897127,44017,23277278,189,(They are now moved),207822289,2015-01-21 11:14:19
5897127,44017,23277292,206,It's irritating that this returns an Aggregator rather than a MonoidAggregator. See issue #403.,208740055,2015-01-21 11:15:06
5904026,7111,23107743,13,"can you add a few comments:

1. how do you know there is only one item in this list?
2. I am confused about the algorithm have `>=` and `1.0` in both cases. Can you comment a bit?

It seems to me that you want something like:
`quantilePoints.filter ",205839337,2015-01-17 03:38:49
5904026,1825352,23262028,13,"I'm thinking situations like this:
Given an ordered and unique list of quantiles, e.g. [0, 0.1, 0.2, 0.3,... 0.9, 1.0] and specific value x. This method will return the estimated quantile for x in this QT.  Wondering if this is a valid and common use cas",205839337,2015-01-21 05:25:02
5904026,1825352,23409575,13,@johnynek  Does the above make sense to you?,205839337,2015-01-23 04:04:14
5999701,7111,23791796,5,"it might make sense to make the default maxSetSize to be something that depends on hllBits. At the extreme you could serialize every item coming in and increment a byte counter (although the in-memory may be much less or more, but still), then when it exc",210044610,2015-01-30 01:48:28
6151723,7111,24148066,24,`m.keys.count(cache.contains)`,214396455,2015-02-05 15:01:12
6151723,7111,24258421,20,let's make this one public too,214653442,2015-02-07 00:59:41
6151723,1825352,24260792,20,"Updated.
Just out of curiosity, what's the original reason to make the constructor private?",214653442,2015-02-07 01:35:06
6178923,44017,24283591,8,"these tests would be more informative if there were different aggregators used for each key. It would also be a better test if the aggregators had different intermediate types (like, the `B` in the agg's A, B, C type params).",215105901,2015-02-07 07:45:53
6178923,44017,24283599,30,I suspect that if it works up to 3 we don't need to test 4..22.,215105901,2015-02-07 07:46:12
6178923,7111,24283627,30,We're adding code coverage metrics. Keep it. :),215105901,2015-02-07 07:47:06
6403407,7111,25284837,71,why not add `if (reducedBits == bits) this else { ...`,222209880,2015-02-25 02:42:08
6403407,7111,25285107,75,this looks expensive for the sparse case. Can't we instead iterate over the keys that are present instead of all the buckets?,222209880,2015-02-25 02:44:37
6403407,7111,25285181,92,"again, let's go ahead and handle the `reducedBit == bits` case (like .take(0) is allowed, we might as well support this).",222209880,2015-02-25 02:45:20
6403407,7111,25285352,99,can you use IndexedSeqArrayByte here to avoid the copy that toIndexedSeq would do?,222209880,2015-02-25 02:47:00
6403407,7111,25285541,44,might as well allocate this outside the while loop so you can share across iterations for sure.,222209880,2015-02-25 02:49:13
6403407,7111,25285783,21,"can you test if you keep the bits the same it works, also if you increase the bits you get an exception.",222209880,2015-02-25 02:51:21
6411340,7111,25286091,78,can we make the member's private? Especially the vars?,222326841,2015-02-25 02:54:30
6411340,7111,25286253,74,there is a StatefulSummer law that you can use to test these things without much work. Can you wire that up?,222326841,2015-02-25 02:56:10
6411340,7111,25286434,24,let's add `java.lang.ref...` here.,222326841,2015-02-25 02:58:07
6411340,44017,25286730,78,"oops, yep, fixed",222326841,2015-02-25 03:01:03
6411340,44017,25286754,24,"it's actually not the java.lang ones, it's the scala.ref...",222326841,2015-02-25 03:01:23
6411340,7111,25287073,34,"why is there a listbuffer? I may be missing it, but it looks like you always sum so the list always has exactly one value. Did I miss that?",222326841,2015-02-25 03:04:15
6411340,7111,25287237,32,"the name here bothers me a bit because from the user's standpoint the only useful thing you get is size, right? I wonder why you are summing in here at all? And aren't we summing twice?",222326841,2015-02-25 03:06:11
6411340,1825352,25289652,49,Should we log something here to indicate the GC happens?,222334575,2015-02-25 03:33:06
6411340,1825352,25289911,80,"Can we use SummingWithHitsCache here, which is essentially a SummingCache with a counter of key-hits. We possibly can add Hadoop counters to track how many times we will have a miss key, and how many times we will grow the cache capacity.",222334575,2015-02-25 03:36:21
6411340,44017,25289928,34,This is a possibly unnecessary optimization - by boxing the value in a ListBuffer I avoid having to recreate SoftReference objects all the time.,222326841,2015-02-25 03:36:32
6411340,44017,25290340,32,"BTW open to suggestion for other names, this is really a private class anyway (and I'm happy to move it inside AdaptiveCache).",222326841,2015-02-25 03:41:18
6411340,7111,25313902,34,"Oh, so you just want a mutable cell? Can we do instead:

```scala
class Cell[T](init: T) { var value = init }
```
and just use that?",222326841,2015-02-25 09:31:57
6411340,44017,25317483,34,"Out of curiosity, why not

````scala
class Cell[T](var value: T)
````

But anyway, yes, will do.",222326841,2015-02-25 11:32:05
6411340,44017,25289860,49,"Yes, I wanted to, but wasn't sure in this context what the best way to do that would be...",222334575,2015-02-25 03:35:44
6411340,44017,25290255,32,"- Yes, the size is the only useful thing you get.
- I'm summing here to try to get the most accurate simulation possible of the memory used by the SummingCache for this stream of keys/values. The counterfactual here is ""how big would the SummingCache hav",222326841,2015-02-25 03:40:24
6411340,1825352,25991966,114,"Nit pick: call the case class CacheStats?  Nothing major, just it might be confused with the Scalding Stat and these two  are likely to be used together when recording these metrics to Hadoop counters.",224388547,2015-03-07 09:08:05
6562818,7111,26060394,5,"going to 31 is probably going to OOM no matter what for dense HLLs. You might want to only go to 29 or 28 or something, something just large enough to exercise this new code.",228186437,2015-03-10 00:15:08
6683641,7111,26966981,50,"this could be optimized by stopping at the first false:
```scala
val ilit = il.iterator
var contains = true
while(ilit.hasNext && contains) {
  contains = contains && bs.contains(ilit.next)
}
contains
```
it is mutable, but it might speed things ",234394968,2015-03-24 00:49:17
6683641,7111,26967047,7,can this be private?,234394968,2015-03-24 00:49:54
6683641,7111,26967383,20,in ++ should we optimize the case where `other.item == item` and not allocate? I guess that's rare.,234394968,2015-03-24 00:53:51
6683641,7111,26967436,22,"if we are checking equality here anyway, perhaps we should not use + if other == item?",234394968,2015-03-24 00:54:22
6683641,7111,26967533,44,let's not duplicate code here. Why not just use the default implementation of + below?,234394968,2015-03-24 00:55:33
6683641,1694935,26968057,22,"Sure, that would save an extra hashes calculation when we have a dataset with repeating element.
Rewriting to:
```
  def checkAndAdd(other: String): (BF, ApproximateBoolean) = {
    if (other == item) {
      (this, ApproximateBoolean.exactTrue)
   ",234394968,2015-03-24 01:01:30
6683641,1694935,26968558,20,"An extra ""if <string equality>"" shortcut is definitely cheaper than hashes calculations - benefit of this trade-off will depend on data consumed. Probably doesn't hurt to put the check there - but as you said, it would happens pretty rarely - data values ",234394968,2015-03-24 01:07:33
6683641,1694935,26968686,7,yes,234394968,2015-03-24 01:08:55
6683641,1694935,26969217,50,"Defintiely. I considered this ealier - performance measurements showed hash calculations and bit array conversions trumped everything small like this. If we do add this, how about:     
```
il.foreach { i => if (!bs.contains(i)) return false }
    retu",234394968,2015-03-24 01:14:39
6683641,1694935,26971602,44,"Good catch, actually this was not complete - to re-use hashes we will need more changes - all in latest commit.",234394968,2015-03-24 01:40:52
6683641,1694935,27028097,44,"We could also potentially not even add the new item after we figure it ""contains"" returns true in BFInstance, but our bit array wouldn't represent the presence of that element accurately if ""contains"" was only due to a collision.

This is not a problem ",234394968,2015-03-24 19:47:21
6705754,7111,26610910,72,"why .toDouble, isn't it a double?",231699508,2015-03-18 02:10:30
6705754,319889,26610996,72,"true, just a hold over, quite right",231699508,2015-03-18 02:11:40
6705754,7111,26611058,165,"while we are perfing out, why not use a while loop here?",231699508,2015-03-18 02:12:27
6705754,319889,26611140,165,"True, will do that",231699508,2015-03-18 02:12:55
6705754,7111,26611158,212,while loop?,231699508,2015-03-18 02:13:11
6705754,7111,26610764,9,"can we do:
```scala
o match {
  case ReadOnlyBoxedArray(that) => java.util.Arrays.equals(inArray, that)
  case _ => false
}
```",231699508,2015-03-18 02:08:31
6705754,7111,26880885,74,why no longer private?,231726304,2015-03-21 04:16:19
6705754,7111,26881002,162,"dropped lazy here. That's going to change the performance, right?",231726304,2015-03-21 04:18:25
6705754,7111,27518729,97,"should we while loop it here to be consistent? We could get the iterator, and do the hasNext, next unrolling?

Man, we really need some macros for this stuff (glanced at ScalaBlitz, does not seem to be exactly what we want here).",238247270,2015-04-01 01:18:16
6705754,319889,27519175,97,"Yeah sounds good, just running tests on the change locally.",238247270,2015-04-01 01:23:13
7123948,319889,28524038,31,Any reason to move this to an implicit val rather than the type constraint? ,245396239,2015-04-16 21:12:50
7123948,7111,28531351,31,"So you can have access to it if you need it. For instance, a number of methods in QTree now require a `Monoid[A]`, If you get passed only a QTreeSemigroup, you could not call them, so you can by getting the monoid out.

That's the reasoning. Maybe we ca",245396239,2015-04-16 22:32:34
7123948,7111,28531477,25,this comment is wrong. It is offset and sum for the same value. Right?,245396239,2015-04-16 22:34:05
7123948,7111,28531697,226,"there is actually an issue here. You can get a Monoid (or a Ring) from a Numeric, but it really does not have to be the same Monoid as you are using elsewhere. So, I guess what we really need is to take both a Numeric and a Monoid, and only use the Numeri",245396239,2015-04-16 22:36:23
7123948,319889,28532655,31,"Ah I see what you were doing here, I hadn't tweaked that the main effect of this change is to make a public field on the Semigroup that gives access to the monoid so you can pull it easily out later. Makes sense. ",245396239,2015-04-16 22:46:58
7123948,319889,28532742,226,"That seems like a pretty decent one, odds of the Numeric being incompatible in its toDouble conversion seem low",245396239,2015-04-16 22:48:00
7123948,2221968,28533199,31,"That's what implicitly is for, right?  The main benefit of having is as a parameter is that it doesn't have to be implicitly specified.",245396239,2015-04-16 22:52:40
7123948,123326,28533380,31,"I always thought the two approaches were equivalent, thanks to `implicitly` (as @jnievelt mentioned)",245396239,2015-04-16 22:54:26
7123948,319889,28534438,31,"It would wind up being just longer and redundant, you'd need to add another val to the class or def that was just 
val underlyingMonoid = implicitly[Monoid[A]] 

In either case it'll be picked implicitly, indeed the A: Monoid is just compiler magic for",245396239,2015-04-16 23:05:22
7123948,44017,28534490,25,"It's badly expressed. The point is that for a given bin with bounds (x,y), you are not just counting all k_i where x <= k_i < y, but also summing k_i. To put it another way, you are computing not just the curve of the distribution but the area under that ",245396239,2015-04-16 23:05:59
7123948,7111,28534530,31,"they are totally equivalent. If we want a blue bike shed I could say:

```scala
class QTreeSemigroup[A: Monoid](k: bits) extends Semigroup[QTree[A]] {
  def underlyingMonoid = implicitly[Monoid[A]]
  ...
}
```
that was just more characters. @jniev",245396239,2015-04-16 23:06:15
7123948,7111,28534615,226,@ianoc just to be sure I understand: you like the solution of taking both Monoid and Numeric?,245396239,2015-04-16 23:07:20
7123948,319889,28535161,226,"Yep, since I think its far more likely the non-default monoid will be defined by the user in closer scope. But they'll pick up the default Numeric for the type. I doubt there'd be much issue with having the default Numeric and a custom Monoid. Currently h",245396239,2015-04-16 23:13:12
7123948,7111,28539547,25,"do you think it is worth using:
```scala
   /**
    * If you are sure you only care about the approximate histogram
    * features of QTree, you can save some space by using QTree[Unit]
    */
   def offset(o: Long): QTree[Unit] = apply(o -> ())
``",245396239,2015-04-17 00:03:03
7123948,44017,28540236,25,"Yes, though I think `offset` is the wrong name (and that in fact it's totally fine to have that be `apply`)",245396239,2015-04-17 00:11:39
7123948,2221968,28549326,65,instead highlight that we're pulling one off the iterator before starting the loop,245745648,2015-04-17 01:58:38
7123948,7111,28559625,65,"not sure what you mean here, @jnievelt . The count starting at 1 is so (count % batchSize == 0) after batchSize loops. If we started at 0, we would compress the first time as the code was written.

Did you want something else?",245745648,2015-04-17 04:33:11
7123948,2221968,28560574,65,"That's not the case though.  If batchSize = 2, that condition will hold on the first pass through the loop, not the second.

It's a little weird to think about.  Here, the first compression will be on an uncompressed combination of 25 items.  Other comp",245745648,2015-04-17 04:52:47
7210734,7111,29290981,5,"what if we do this: add `varianceUnsafe: Double` (and similar) that don't check, and then make `def variance = if (count > 1) varianceUnsafe else Double.NaN`

Is that of any value?",247850329,2015-04-29 02:31:55
7210734,7837742,29293211,5,"If folks have some need for the statistics in the case of a very low count, then adding `varianceUnsafe` (etc.) makes sense. (But when would these numbers be of value? By definition, the statistics aren't defined in these edge cases.)

On the other hand",247850329,2015-04-29 03:00:08
7433296,44017,29819851,95,The level of duplication here with `SetSizeAggregator` bothers me. Can we not just introduce a backwards-compatible `apply` that takes a fn and wraps it in a `Hash128`?,254280379,2015-05-07 07:11:39
7433296,7111,29878120,95,"Sounds good to me. I was just lazy really (but also, SetSizeAggregator could have serialized the intermediate state with what it has on hand, using the Hash you can't, but that should be an orthogonal concern).",254280379,2015-05-07 22:58:29
7459750,252230,29990281,5,are there good defaults for k?,254878809,2015-05-09 11:10:26
7459750,44017,29998686,5,"the tree will have at most `2^k` nodes. So, like with HLL, the reasonable range is somewhere from 7...12 or so. 8 or maybe 9 seems like a decent default to me.",254878809,2015-05-10 09:16:30
7459750,44017,29998709,8,Should there be a version (maybe even the default version) that just picks the lower or upper bound here?,254878809,2015-05-10 09:20:06
7459750,44017,29998726,7,use `val`?,254878809,2015-05-10 09:22:49
7459750,44017,29998715,5,How about making this generic for any `N:Numeric` instead of requiring `Double`?,254878809,2015-05-10 09:20:40
7459750,7111,30188334,23,"that's pretty high, is it not?",255947230,2015-05-13 03:41:46
7459750,7111,30188307,19,why don't we want `QTreeSemigroup[Unit]` here? That will be less memory and won't hurt our ability to do percentiles.,255947230,2015-05-13 03:41:29
7459750,7111,30188370,5,"we just need `T: Ordering` here, right?",255947230,2015-05-13 03:42:25
7459750,7111,30188457,19,this is all the same as `agg(list)` isn't it? Why the manual reimplementation?,255947230,2015-05-13 03:43:34
7459750,7111,30188668,33,scaladoc comment please.,255947230,2015-05-13 03:46:00
7459750,7111,30188672,26,scala doc comment please.,255947230,2015-05-13 03:46:07
7459750,7111,30188708,27,I think this should be `QTree[Unit]`,255947230,2015-05-13 03:46:45
7459750,7111,30188686,27,can we use `Interval` here instead of `Tuple2`?,255947230,2015-05-13 03:46:24
7459750,7111,30188624,10,"we don't need the outer `{ }`, and this could be `trueRangeSum[T: Monoid](l: TraversableOnce[T], int: Interval[T]): T` to be more general",255947230,2015-05-13 03:45:32
7459750,252230,30188988,23,this was what avi suggested in a previous comment. Happy to change to whatever.,255947230,2015-05-13 03:51:42
7459750,252230,30189003,27,will fix.,255947230,2015-05-13 03:51:55
7459750,252230,30189100,10,"this line wasn't touched in my diff, nor was it called... I can change it if you want but it seems out of scope",255947230,2015-05-13 03:53:59
7459750,252230,30189190,19,didn't realize... will fix.,255947230,2015-05-13 03:55:37
7459750,7111,30195645,10,Ignore it if you like. I just saw it above the diff.,255947230,2015-05-13 06:09:13
7802567,7111,31554055,10,"might be nice to add a method like:
```scala
def sample(r: java.util.Random): Double
```
to get a sample from this distribution.",265733441,2015-06-02 23:23:22
7802567,7111,31554107,22,this can be an `object`,265733441,2015-06-02 23:23:53
7802567,7111,31554141,25,no need for `{ }` please avoid when not needed.,265733441,2015-06-02 23:24:10
7802567,7111,31554182,20,"we should not need `monoidLawsEq`, I think `monoidLaws` will do.",265733441,2015-06-02 23:24:30
7802567,7111,31554545,27,"please add an optimized sumOption:

```scala
def sumOption(its: TraversableOnce[GaussionDistribution]): Option[GaussionDistribution] =
  if (its.isEmpty) None
  else {
    var mean = 0.0
    var sigma = 0.0
    val it = its.toIterator
    while (",265733441,2015-06-02 23:27:25
7802567,7111,31554683,13,"this can be an `implicit val` to not allocate at every use (since this Monoid is a constant, and has no inputs).",265733441,2015-06-02 23:28:40
7802567,44017,31556345,10,Or possibly take it further and integrate with https://github.com/jliszka/probability-monad,265733441,2015-06-02 23:42:42
7802567,7111,31562826,10,I actually have some code internal to Twitter that has this as well as some bootstrap and chernov/hoeffding-bound based randomized testing. I should release that (and perhaps make it work with the the code above rather than mine which is just a Reader mon,265733441,2015-06-03 00:45:34
7802567,300693,31594471,27,great!,265733441,2015-06-03 10:21:24
7802567,300693,31594481,25,done,265733441,2015-06-03 10:21:35
7802567,300693,31594464,13,done,265733441,2015-06-03 10:21:18
7802567,300693,31594477,20,done,265733441,2015-06-03 10:21:30
7802567,300693,31594487,22,yep,265733441,2015-06-03 10:21:41
7802567,7111,31672168,15,"actually, this should be a method on the case class, and it should be scaled:
```scala
mean + r.nextGaussian() * math.sqrt(stddev)
```",266194069,2015-06-04 02:28:59
7802567,7111,31672376,7,"wait, this is not correct. It needs to be `sigma2` being the variance:

http://en.wikipedia.org/wiki/Sum_of_normally_distributed_random_variables

we can have a method to get the `stddev` to use the same name as: https://github.com/twitter/algebird/bl",266194069,2015-06-04 02:31:17
7802567,7111,31672457,10,"shouldn't need this. Since it is implicit in the companion object, scala should find it.",266194069,2015-06-04 02:32:07
7802567,300693,31672608,7,oh gotcha!! that's right :( ,266194069,2015-06-04 02:33:30
7903990,2221968,31982370,34,Seems like this should be rand.nextDouble * radius ?,268477608,2015-06-09 09:41:43
7903990,2221968,31982569,6,"Seems like this is too much.  We only use dot here, and that could be put somewhere else (EuclideanHashFamily helper object, etc.) if we really need to add it.",268477608,2015-06-09 09:51:18
7903990,2221968,31982813,5,This abstraction doesn't seem right.  LSH isn't confined only to vectors of doubles (that's specific to Euclidean space).  Also Hasher as a mapping of something onto an Int isn't specific to LSH.  Likely we'd want to have `Hasher[-T] { def hash(t: T): Int,268477608,2015-06-09 09:59:42
7903990,2221968,31982955,9,Why is this trait needed?  And why would it override hashCode?,268477608,2015-06-09 10:04:27
7903990,2221968,31982986,12,Why is this needed?,268477608,2015-06-09 10:05:44
7903990,7111,32053261,5,"Actually there is a scala.util.hashing.Hashing: http://www.scala-lang.org/api/2.11.4/index.html#scala.util.hashing.Hashing

Can we use that trait?",268477608,2015-06-10 00:28:35
7903990,7111,32054018,6,"Also note we have VectorSpace: https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/VectorSpace.scala

Seems you want to add InnerProductSpace:
http://en.wikipedia.org/wiki/Inner_product_space
```scala
tr",268477608,2015-06-10 00:35:27
7903990,7111,32054116,86,this should all be in InnerProductSpace when `F =:= Double`.,268477608,2015-06-10 00:36:30
7903990,7111,32054200,39,should not println.,268477608,2015-06-10 00:37:17
8117561,7111,33105697,8,"can this be `(K, ${aggType}Aggregator[A, B, C])` so it matches the others? We should not require a String as the key, I don't think.",273140634,2015-06-24 04:51:46
8117561,7111,33105756,14,can't we just change the `2` to `1` and get the same result?,273140634,2015-06-24 04:52:48
8117561,7111,33105814,14,I guess that would cause needless boxing in the middle. Your original approach is better in that regard.,273140634,2015-06-24 04:53:45
8117561,777356,33106786,14,"it didn't seem as simple as changing `2` to `1`...
with all these `%s` formatting, it's too hard infer anything about what the code-gen below does. so I'd leave it as is, at least until the original `2-max` part is refactored to use string interpolation ",273140634,2015-06-24 05:09:51
8117561,777356,33106819,8,:+1: sure!,273140634,2015-06-24 05:10:21
8285230,3485758,36542056,5,"If the scalacheck maintainer accepts my PR (https://github.com/rickynils/scalacheck/pull/188), then we'll be able to do the following:
- Ensure that ApproximateProperty props don't go in the same Properties class as normal props.
- For every Properties ",279106476,2015-08-07 22:40:30
8285230,7111,37015382,13,"but why couldn't we do something like:

```scala
// I need an exact value for my implementation:
def needExact(e: Exact): Gen[Input]
// but I could still implement this:
def inputGenerator: Gen[Input] = exactGenerator.flatMap(needExact) 
```
Am I ",279279042,2015-08-14 00:29:14
8285230,7111,37016404,23,"seems like what we really want is
```
trait ApproximateSet[S, -T] {
  def contains(set: S, t: T): ApproximateBoolean 
}
```
and use that as a typeclass rather than implicit conversions.
```
object ApproximateSet {
  def contains[S, T](s: S, t: T)",279279267,2015-08-14 00:39:15
8285230,7111,37017065,23,"Actually, what you are trying to do here is add a common interface to ApproximateBoolean and `Approximate[N]` right?

Maybe just do that directly rather than through implicit conversion.",279279267,2015-08-14 00:46:19
8285230,3485758,37022822,23,"Yeah, I'm trying to make a common interface to ApproximateBoolean and Approximate[N].

I like the idea of having a trait ApproximateSet[T]: 
```scala
trait ApproximateSet[T] {
  def contains(t: T): ApproximateBoolean
}

ApproximateBoolean extends ",279279267,2015-08-14 01:43:04
8285230,3485758,37029192,2,"Yeah, I keep getting a ""Unresolved dependencies: algebird-test"" error when I don't use ""-SNAPSHOT"". Is this happening to other people too?",279281665,2015-08-14 02:42:24
8285230,3485758,36251583,50,A better name for `falsePositiveRate` might be `falseFailureRate`,279106476,2015-08-05 03:44:17
8285230,3485758,36251676,72,"scalacheck prints these args when the test is run, so that we can see the number of successes, etc. when we run the tests",279106476,2015-08-05 03:45:42
8285230,3485758,36252185,5,"TODO
By default, scalacheck calls `check` on a property 100 times. However, we want it to call `check` on our property only once, so that the approximate property can run all `n` tests at once and decide whether there were too many failures.

Hopefully",279106476,2015-08-05 03:52:24
8285230,7111,36328317,13,what is this exact value corresponding to?,279279042,2015-08-05 22:23:02
8285230,7111,36328521,91,what's going on here?,279279042,2015-08-05 22:24:49
8285230,7111,36328783,29,"I'm concerned that this is not using the Gen.Parameters, so I'm afraid that when scalacheck gives us an example input that fails a test, we can't check it at the REPL. Is there some way to plumb through the Random instance from Gen.Parameters (I think has",279279042,2015-08-05 22:27:15
8285230,7111,36329360,6,this is really nice and quite well designed. Good work.,279279042,2015-08-05 22:32:05
8285230,3485758,36329601,13,"Exact is useful here so that we can generate appropriate test inputs. 

For example, suppose we're testing CMS[Long]. We need to generate some inputs so that we can query `exactList.frequency(x)` and `cms.frequency(x)` and compare them. 
We could simpl",279279042,2015-08-05 22:34:15
8285230,3485758,36330081,91,Added a comment,279279042,2015-08-05 22:38:22
8285230,7111,36330324,63,"let's link to:
https://en.wikipedia.org/wiki/Hoeffding%27s_inequality

and add the result;
```
When Prob(X = 1) >= p, then

Prob(sum(X) <= (p - eps)*n) <= exp(-2*eps*eps*n)

If we want that Prob <= fprate, then it is sufficient that, fprate = exp",279279042,2015-08-05 22:40:24
8285230,2221968,36331468,63,"diff = n * fprate, so it's correct in the numerator.

My only concern here is that the formula is for the Bernoulli version of Hoeffding's.  Since we're taking separate probability values from each result, we aren't guaranteed that they'll be uniform (v",279279042,2015-08-05 22:48:58
8285230,3485758,36331952,29,"This might not a problem since I'm not using scalacheck's error reporting mechanism. (I had to write my own hacky error reporter using scalacheck args.)
Here's an example of a failure:
https://travis-ci.org/twitter/algebird/jobs/74179669#L2565
It alway",279279042,2015-08-05 22:52:37
8285230,3485758,36333083,63,"The general case (https://en.wikipedia.org/wiki/Hoeffding%27s_inequality#General_case) is
```
P(sum(X) - sum(E[X]) >= nt) <= exp(-2*n*t^2)
```
(here I used `sum(X) = X_1 + ... + X_n` instead of `Xbar = 1/n (X_1 + ... + X_N)`)
So we have
```
   exp(",279279042,2015-08-05 23:01:19
8285230,3485758,36338662,63,"Whoops, I read Joe's comment again, and he's right. 
diff = n * t, so we need `diff = sqrt(-n * log(fprate) / 2)`.",279279042,2015-08-05 23:44:30
8285230,7111,36584242,63,"I agree. I overlooked the `n * t` on the outside.

I think the bound applies perfectly, with the assumption that our `Random` class is a real RNG. That is obviously not true, and in fact it is pseudo-random, but I don't see how that is escapable. We cou",279279042,2015-08-09 08:56:04
8285230,24443,36860337,29,"That link just gives me ""This is not an active repository"". Are there some creds needed to see it? Can you post a screenshot?",279279042,2015-08-12 18:43:58
8285230,24443,36861038,2,Why bump to a snapshot version here?,279281665,2015-08-12 18:50:17
8285230,3485758,36884133,2,"Whoops, I didn't mean to check that change in. I'll remove it",279281665,2015-08-12 21:54:52
8285230,319889,36887379,29,"It actually looks like the travis settings somehow got broken for algebird, it seems to be disabled in travis. /cc @caniszczyk ",279279042,2015-08-12 22:21:03
8285230,319889,36887808,2,We probably should actually swap all of them to work like this. We've seen some funky errors and mixed classpath's if you have a published version in the version.sbt. Not sure if its a new sbt thing or what. But can be a different PR,279281665,2015-08-12 22:24:28
8285230,7111,37443293,36,"can we call `list` `vec` instead? Also, `vec.count(_ == key)` is going to be faster here since it does not materialize a second vector.",293203627,2015-08-19 22:35:58
8285230,7111,37444346,2,should we be bumping the version?,293203627,2015-08-19 22:45:00
8285230,7111,37444405,5,"So, all of our tests only run with 1 sample now?",279106476,2015-08-19 22:45:30
8299869,7111,36267145,62,why did you remove the override here?,278963347,2015-08-05 08:30:26
8299869,7111,36267152,53,why no override? isn't this from HeavyHittersLogic?,278963347,2015-08-05 08:30:43
8299869,7111,36267214,171,"can we add a comment to this logic about what is going on? I think for each `K1`, we keep the top `heavyHittersN`.",278963347,2015-08-05 08:32:33
8299869,2221968,36330269,62,"Eh I kinda love-hate the override keyword.  It doesn't require that the base class/trait actually implements the method (i.e., so that we know if super is interesting).  Then again, plain def doesn't require that the base class/trait declares the method e",278963347,2015-08-05 22:39:58
8307224,7111,36483678,83,shouldn't this have maxExactCountOpt = None? so you don't have to pass it?,279051860,2015-08-07 06:13:44
8307224,7111,36483697,73,have an option with maxExactCountOpt = None?,279051860,2015-08-07 06:14:19
8307224,1825352,36542774,73,"I tried to add maxExactCountOpt = None here as well. But scala complains about duplicate definition of this def with the above (def monid), saying both of them have the same signature. I think it's because of type-erasure. 
Not sure if there is a good wa",279051860,2015-08-07 22:47:38
8307224,319889,36544201,73,you could add the dummy implicit route i guess to get around it,279051860,2015-08-07 23:01:19
8307224,1825352,36560559,73,"Offline discussed with @ianoc . DummyImplicit won't help here, since the dup definition lies in the helper method generated for default values.

I will create multiple versions of these methods, w/ or w/o the new maxExactCountOpt respectively. ",279051860,2015-08-08 01:57:22
8307224,7111,34674396,28,"just to be consistent, let's use foldLeft rather than foreach here (to avoid an unneeded var). I'm willing to have vars if they add performance, in this case the perf should be the same as:
```scala
newTable.foldLeft(CMSInstance[K](params))(_ + _)
```",279785675,2015-07-15 17:55:25
8307224,7111,34674480,39,there is a bug here. Let's fix it while we are at it. This is neglecting the total in CMSItem.,279785675,2015-07-15 17:56:19
8307224,7111,34674746,62,"let's do `exactCountTable.iterator.map ...` here so we are lazy until we hit the reduce. Also, what if exactCountTable is empty? I think reduce throws in that case. Might want to do .reduceOption and put a `getOrElse(Approximate.exact(0L))`",279785675,2015-07-15 17:58:59
8307224,7111,34674859,74,"you are not using this, right?",279785675,2015-07-15 18:00:09
8307224,7111,34674943,47,let's remove this duplication with a `toDense: CMS[K]` method which you can call here and in `+`.,279785675,2015-07-15 18:01:18
8307224,7111,34675129,28,"might need to do `newTable.foldLeft(CMSInstance[K](params)) { case (cms, (k, c)) => cms + (k, c) }` because `+` takes two args and not a tuple.",279785675,2015-07-15 18:03:31
8307224,7111,34674812,76,`other.exactCountTable.foldLeft(this)(_ + _)`,279785675,2015-07-15 17:59:39
8307224,1825352,34736347,47,Good call! I will put it to the companion object.,279785675,2015-07-16 03:16:30
8307224,1825352,34747366,39,Fixed.,279785675,2015-07-16 06:08:36
8307224,7111,34780754,73,"actually, this follows `CMSInstance` so let's keep it as is.",279833350,2015-07-16 17:18:14
8307224,7111,34780856,5,nice! Can we add a test to check this to also prevent any regressions?,279833350,2015-07-16 17:19:45
8307224,7111,34780709,73,suppose we call this `.empty`. What do you think?,279833350,2015-07-16 17:17:36
8307224,1825352,34854075,5,"By all means, actually I think ""override def +(x: K, count: Long): CMS[K] = CMSInstance[K](params) + (item, totalCount) + (x, count)"" also is not correct.
Should be using SparseCMS here ""override def +(x: K, count: Long): CMS[K] = SparseCMS[K](params) + ",279833350,2015-07-17 05:52:27
8307224,7111,35603533,28,"let's put the maxExactCountOpt into CMSParams. Without that, you can't really control it, right? Since CMSItem will always create with the default setting, right?",280321469,2015-07-28 05:24:33
8307224,1825352,35605409,28,@johnynek Good points. But that will make maxExactCountOpt available to all CMS subclasses. Is that desired?,280321469,2015-07-28 05:55:10
8307224,7111,35676556,28,"I agree it is only relevant to one part of the state machine, but similarly, the size is only depth/width is only relevant to when we create the hash count matrix (not to CMSItem or SparseCMS). So, I think it still fits as a parameter of the operation of ",280321469,2015-07-28 22:41:29
8307224,1825352,35714619,28,"Make sense. Has made the change as suggested.

On Tue, Jul 28, 2015 at 10:41 AM, P. Oscar Boykin <notifications@github.com>
wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/CountMinSketch.scala
> <https://github.com/twitter/algebird/pull/464",280321469,2015-07-29 04:36:35
8307224,7111,36255763,154,"wait, we don't want `++` here right? We want `Semigroup.plus(exactCountTable, other.exactCountTable)`.

If that's correct, can you write a test that exposes this bug so we don't have a regression on this?",280321471,2015-08-05 04:41:11
8307224,1825352,36258835,154,You're right. This should be a Semigroup add. I will make an iteration and also add a test.,280321471,2015-08-05 05:29:45
8307224,24443,36269425,4,Looks like this tag is missing info on the new param?,280321471,2015-08-05 09:56:36
8307224,1825352,36351591,4,@DanielleSucher  You're absolutely right! I will add actual comments here as well.,280321471,2015-08-06 01:42:22
8307224,24443,36353915,4,:sparkling_heart: ,280321471,2015-08-06 02:04:04
8323550,319889,37108233,20,implicit i think you want here,279307628,2015-08-15 00:00:43
8323550,319889,37108246,50,implicit here too,279307628,2015-08-15 00:00:51
8323550,319889,37108200,9,comments on cuber and roller traits would be great,279307628,2015-08-15 00:00:25
8323550,319889,37108369,10,can we use scalatest here instead of scalacheck so it runs with the other tests? It will get counted towards the metrics then of how many tests we've ran overall,279307628,2015-08-15 00:02:02
8323550,319889,37108508,17,can we add a test case here of a nested tuple or case class to show it not recursing,279307949,2015-08-15 00:03:26
8323550,319889,37108152,7,kill comment,279307628,2015-08-14 23:59:52
8323550,319889,37116480,97,can we just statically unroll this in the macro ? ,279319197,2015-08-15 01:33:24
8323550,319889,37116608,97,"we can then cache our Some allocations, right now we would re-allocate a lot",279319197,2015-08-15 01:34:48
8323550,7111,37131646,67,how is this different from Cuber?,279355324,2015-08-15 06:45:18
8323550,7111,37131654,86,don't we need `_root_.scala.` here?,279355324,2015-08-15 06:46:00
8323550,7111,37131665,97,+1 to unrolling in the macro. The nested flatMaps really deep will probably optimize poorly.,279319197,2015-08-15 06:47:06
8323550,7111,37131695,22,can we also verify the length is correct? toSet could be removing duplicates.,279355324,2015-08-15 06:49:31
8323550,7111,37131896,67,"okay, I get it. This is doing a prefix only, not the full data cube. Given that the type is isomorphic, it is easy to get confused. Can we make a shorter explanation at the top of the comment? Something like:
```scala
/**
 * For a tuple N produces a re",279355324,2015-08-15 07:08:39
8323550,7111,37131926,20,"can we add a method like:

```scala
  def cube[K, V](t: TraversableOnce[(K, V)])(implicit c: Cuber[T], sg: Semigroup[V]): Map[c.K, V] =
    MapAlgebra.sumByKey(t.toIterator.flatMap { case (k, v) => c(k).map((_, v)) })
```
and similarly for rollup?
",279307628,2015-08-15 07:11:32
8323550,3485758,37241500,10,I thought @johnynek preferred scalacheck over scalatest?,279307628,2015-08-18 02:53:12
8323550,3485758,37241739,17,Bar is a nested case class -- it contains a Foo,279307949,2015-08-18 02:55:55
8323550,3485758,37241940,22,Fixed,279355324,2015-08-18 02:58:11
8323550,319889,37241853,10,"He's not a huge fan of scalatest its true, but most of our tests are already scalatest, and it provides metrics on how many run. A big pain point is when tests don't get run, so it would provide us that data so we can graph/track in future.",279307628,2015-08-18 02:57:17
8323550,3485758,37242355,86,Fixed,279355324,2015-08-18 03:02:25
8323550,7111,37244246,95,"you can evaluate `((1 << ${index - 1}) & i) == 0` at compile time. What not:

```scala
 (1 to arity).map { index =>
  val some = newTermName(s""some$index"")
  if (((1 << ${index - 1}) & i) == 0) q""_root_.scala.None"" else q""$some""
}
```",299120864,2015-08-18 03:24:13
8323550,7111,37244371,95,"ahh, I see. It has `i` in it, which is not known at this time.",299120864,2015-08-18 03:25:29
8323550,7111,37251651,20,"the difference is that in scala, there is no optimizer that can avoid the allocation if you generate `Map[c.K, List[V]]` If you generate a TraversableOnce or Iterator, it is not so safe (you can't reuse it, and the type system does not know about ownershi",279307628,2015-08-18 05:03:46
8323550,3485758,37256255,18,"The trade-off here is to allocate lots more objects (the Semigroup, lots of Iterable singletons and Maps) in order to take advantage of sumByKey (rather than using Scala's groupBy). Is this a good idea?",299120940,2015-08-18 06:26:10
8323550,7111,37257428,79,can we test cubeSum and cubeAggregate at least?,299120940,2015-08-18 06:50:46
8323550,7111,37257804,18,"I don't think this approach is going to work well (the default Iterable is List, I think, so you're going to get repeated ++ on List which gives an O(N^2) algorithm).

You're better off doing something like:
```scala
val map: collection.mutable.Map[c.",299120940,2015-08-18 06:59:20
8323550,7111,37257872,38,"mapValues is lazy in scala, and we tend not to use it (because it keeps things in scope we don't expect, and we recompute the values over and over).",299120940,2015-08-18 07:00:44
8323550,7111,37257895,38,"so, prefer `.map { case (k, v) => (k, agg.present(v)) }` here.",299120940,2015-08-18 07:01:11
8323550,3485758,37328008,18,"I can't seem to find an immutable wrapper to a mutable map in the standard library. So our options here are 

* write a wrapper class
* return an immutable map by calling `.toMap` on the map
* return the mutable map, but specify the return type as `sc",299120940,2015-08-18 22:35:01
8323550,319889,37328980,18,"We have one around in algebird I believe.

BTW option 3 is bad because the contract there lets the underlying map move about on you, you can't presume its stable/immutable. Just that the handle you have is. Subtle but important difference",299120940,2015-08-18 22:42:36
8323550,3485758,37330980,18,"Ah, found the mutable backed map. ",299120940,2015-08-18 22:56:59
8323550,3485758,37340355,79,Added tests,299120940,2015-08-19 00:11:19
8323550,3485758,37340373,38,Fixed,299120940,2015-08-19 00:11:27
8323550,7111,37342008,14,let's make the value return type `List[V]` or `Iterable[V]`.,299120942,2015-08-19 00:26:56
8323550,7111,37342091,36,same make the value `List[V]` or `Iterable[V]`.,299120942,2015-08-19 00:27:40
8323550,7111,37342556,17,nice improvement.,299120942,2015-08-19 00:32:15
8323550,3485758,37350252,14,fixed,299120942,2015-08-19 01:38:13
8323550,3485758,37350263,36,fixed,299120942,2015-08-19 01:38:17
8372545,319889,34489865,31,should maybe change this val to aggType or something more indicative. Semigroup is an odd name for something that could be monoid.,279699773,2015-07-13 22:44:40
8372545,319889,34489860,41,"$i._2 is ambigious... well its not, but it doesn't operate like it reads. can we use ${i} here?",279699773,2015-07-13 22:44:37
8372545,777356,34593758,31,"I'd prefer not to use word `aggregator` to avoid confusion with an `*Aggregator`.
so either `semigroupType/semigroupField` or a `summer`, other suggestions?",279699773,2015-07-14 22:18:34
8372545,777356,34541876,41,:+1: ,279699773,2015-07-14 11:59:19
8372545,777356,34542099,31,"a monoid extends semigroup, and this val is used as variable name - and this `val` is actually a semigroup/monoid **contained** in a `Aggregator`.

so maybe `semigroupName` or `semigroupType` ?",279699773,2015-07-14 12:04:14
8394340,7111,34779860,31,can you also add `isNonZero`?,279832751,2015-07-16 17:02:55
8394340,7111,34779937,30,"for performance, it is really important to implement sumOption. See how we generated it here:

https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/GeneratedAbstractAlgebra.scala#L9",279832751,2015-07-16 17:04:19
8394340,7111,34780219,12,"there are stronger laws you can use. See:

https://github.com/twitter/algebird/blob/develop/algebird-test/src/test/scala/com/twitter/algebird/CountMinSketchTest.scala#L27

So, we should be able to check `semigroupLaws[Foo]` and we can be sure everythi",279832751,2015-07-16 17:09:17
8394340,7111,34780342,59,"this actually can't work. The pointwise version of a bunch of Fields is not a Field. You can use the `fieldLaws` test to verify that it will always fail.

Then we should remove the macro.

The issue is this: to be a field, only `0` can not have an inv",279832751,2015-07-16 17:11:22
8394340,3485758,34846263,31,"One way to make `isNonZero` more efficient is changing `def zero` to `val zero`. This will ensure that zero is only computed once. Then any call to `isNonZero(x)` will just return `x != zero`. This should be reasonably efficient.

What did you have in m",279832751,2015-07-17 03:41:17
8394340,3485758,34846305,12,Done,279832751,2015-07-17 03:41:57
8394340,3485758,34846319,59,Removed field macros.,279832751,2015-07-17 03:42:09
8394340,3485758,34846296,30,Done,279832751,2015-07-17 03:41:51
8394340,7111,34942724,17,"this is a really nice solution, and the code reuse is great. There is one issue here: what if you have conflicting `Semigroup[T]` and `Group[T]`. For instance, `Semigroup[Int]` could be multiplication, so `plus` would actually be addition, but `Group[Int]",279918589,2015-07-18 06:41:24
8394340,7111,34942751,40,"this is hugely useful. Nice work. It should almost go in its own package, but we can leave it here for now.

This will be really useful at Twitter to have this (and a similar one for scrooge (and java thrift) if possible).",279918589,2015-07-18 06:43:11
8394340,7111,34942668,31,"how is this working `Group[$param]`? Isn't `param` the name of the accessor, not the type?",279918589,2015-07-18 06:36:11
8394340,3485758,35021383,31,Nice catch! It should be `Group[${param.returnType}]`.,279918589,2015-07-20 22:37:57
8394340,7111,35040861,20,"I'm not sure these are running. We had some issue with this in the past. I really hate scalatest. It has so many styles.

The risk is this: semigroupLaws returns a Prop. It does not do any asserts. But scalatest works on asserts. So we had tests that we",280447428,2015-07-21 01:38:02
8394340,7111,35051985,56,let's add the `_root_.scala...` prefix to `TraversableOnce`.,279832718,2015-07-21 03:30:54
8408459,7111,34941932,12,this should just call hashBytes directly rather than copy the code.,279918269,2015-07-18 05:49:31
8408459,622449,35279474,6,this comment isn't needed anymore now that this is in the right home,280526542,2015-07-23 05:11:11
8588392,2221968,35603066,79,0 <= rank is redundant since we'll always run the require validation?,283978867,2015-07-28 05:16:35
8588392,3485758,35603209,79,"Yep, that's just for clarity.
I can remove it if you want.",283978867,2015-07-28 05:19:01
8588392,7111,35603339,79,"you can comment `// note 0 <= rank due to assert above`
or something, but let's not repeat the code.",283978867,2015-07-28 05:21:22
8588392,2221968,35603362,88,IMO just the first and last comment lines here are sufficient,283978867,2015-07-28 05:21:53
8588392,7111,35603775,11,`QTree.value(_)` I think will work.,283979664,2015-07-28 05:28:26
8588392,7111,35603760,8,"`QTreeSemigroup[Unit]` should work, I think, and is cheaper. People seem to be cargo-culting `QTreeSemigroup[Double]` Can we switch here?",283979664,2015-07-28 05:28:11
8588392,2221968,35604024,79,"I think it's more confusing actually.  If the code looks like it handles the case where rank < 0, a reasonable person may (initially) infer that it's possible for that to be true.",283978867,2015-07-28 05:31:53
8588392,3485758,35604341,8,Updated in latest commit,283979664,2015-07-28 05:36:58
8588392,3485758,35604331,11,Updated in latest commit,283979664,2015-07-28 05:36:51
8588392,3485758,35604388,79,That's a good point. I've fixed this in the latest commit.,283978867,2015-07-28 05:37:46
8588392,2221968,35604432,72,IMO remove the 'if' here,283980428,2015-07-28 05:38:31
8588392,3485758,35604662,72,Fixed,283980428,2015-07-28 05:42:23
8588392,3485758,36148921,63,Should we use lowerChildNullable and upperChildNullable in this method?,285091097,2015-08-04 06:05:12
8588392,319889,36150463,63,If its called from the 'hot path' i.e. in plus or sumOption then yes worth doing it,285091097,2015-08-04 06:35:41
8588392,3485758,36155511,63,"It's only called in quantileBounds, so optimizing it is probably not necessary",285091097,2015-08-04 08:50:30
8588392,319889,36155651,63,"Yeah I wouldn't bother there, best to keep the less functional stuff out of the non-critical speed paths.  -- That said, it could be worth adding a benchmark on how the results are usually extracted from QTree, all the benchmarks now are for combinations.",285091097,2015-08-04 08:55:27
8609616,2221968,35928062,9,This import isn't used in a few places,284321611,2015-07-31 03:21:02
8609616,2221968,35928024,40,bh doesn't seem to be needed here,284321611,2015-07-31 03:20:49
8697692,7111,36013034,85,"maybe just use `inputDataUnit.reduce(state.qtreeUnit.plus)` `.tail` could be O(N) on a bad Seq (some require copying, I believe).",285943537,2015-08-01 01:27:19
8697692,7111,36013064,90,reduce,285943537,2015-08-01 01:27:34
8697692,7111,36013076,95,reduce,285943537,2015-08-01 01:27:38
8697736,7111,36013684,81,"do we need the Unit? There is only one value, so I assume boxing is fast. If we specialize on it, we get an additional copy of all the methods with type parameters, which adds to the jar size.",285944161,2015-08-01 01:34:24
8697736,7111,36013785,97,"do these need to be private, the constructor is already private.",285944161,2015-08-01 01:35:29
8697736,7111,36013872,124,can we add a comment that this was due to benchmarking and not to change it unless you have run benchmarks to show that it is faster.,285944161,2015-08-01 01:36:37
8697736,7111,36014048,65,"we could reduce this a bit:
```scala
if (aNullable != null) {
  if (bNullable != null) {
    mergePees(aNullable, bNullable)
  }
  else aNullable
}
else bNullable
```",285944161,2015-08-01 01:38:51
8697736,319889,36014148,124,I have a series of micro benchmarks that i'll push that show this was faster,285944161,2015-08-01 01:39:56
8697736,319889,36014190,97,Since this is a case class this stops these being public vals' that someone can reference. nicer way for it?,285944161,2015-08-01 01:40:29
8697736,319889,36014210,81,"Probably not, will remove",285944161,2015-08-01 01:40:42
8697736,7111,36014550,90,"it's a bummer to lose the case class matching, but don't we need to add:

```scala
  def offset
  def level
  def count
  def sum
```
or we are breaking the API?

For instance, Zak has some code to serialize QTrees, I'm not sure if that code can",285944161,2015-08-01 01:45:01
8697736,319889,36015127,90,"I'm pretty sure the args here actually remain public, mima only reports the loss of some variants of this() constructors that I saw -- I'll run this through our internal stuff which should his tests before a merge",285944161,2015-08-01 01:51:30
8697736,7111,36015593,97,Okay. I didn't know that. Related to my comments on case class with private constructors.,285944161,2015-08-01 01:56:54
8697736,7111,36015823,90,"what about the unapply method on the object? We could lose the sugar of case class, but we still get source compatibility by adding manual apply/unapply/toString/equals/hashCode",285944161,2015-08-01 01:59:01
8697736,319889,36016172,90,"I'm happy to do that, think it looks nicer than this use of private? we have a few apply's already, unapply we probably want to more match the old apply too. So it might wind up making some of it nicer to migrate to",285944161,2015-08-01 02:03:01
8697736,3485758,36056508,207,Maybe use `scala.math.max` here to prevent boxing/unboxing?,285943083,2015-08-03 10:09:22
8697736,7111,36108973,207,"I don't think these box. I think they use AnyVal enrichments:

https://github.com/scala/scala/blob/v2.10.3/src/library/scala/runtime/RichInt.scala#L1

https://github.com/scala/scala/blob/v2.10.3/src/library/scala/runtime/RichDouble.scala",285943083,2015-08-03 22:33:06
8697736,7111,36109060,254,I guess this is faster than `Option[Double]` because Option is not specialized.,285943083,2015-08-03 22:33:53
8697736,319889,36109167,254,"Yep, private so figured safe internal thing to do",285943083,2015-08-03 22:35:00
8765812,7111,36774942,27,this comment looks like it should be on boundsContain. Can you move it?,293286114,2015-08-11 22:45:36
8765812,3485758,36784084,27,Done,293286114,2015-08-11 23:56:03
8905120,7111,37335534,6,can we make this a `val`? the def will allocate on each access.,299179429,2015-08-18 23:32:04
8905120,7111,37336094,4,"can we add a comment as to when you might want to use this?

A few years ago I benchmarked the PriorityQueue version to be much faster (but that was before we had the benchmark subproject sadly). Given that users generally don't care what the middle typ",299179429,2015-08-18 23:36:46
8905120,263956,37358054,6,done,299179429,2015-08-19 02:48:45
8905120,263956,37358359,4,"I've seen frameworks that check immutability of reduce functions, for example [https://github.com/GoogleCloudPlatform/DataflowJavaSDK/commit/ca2d22e198212c38e76b8b91ae8698dc2d877666](Dataflow). This would work around that. Also for the sake of completenes",299179429,2015-08-19 02:51:41
9089964,7111,38267071,5,"there are several choices here. For algebird internals, we really try to have benchmarks (see the benchmark subproject) to make the choice. Some alternatives:
```scala
// we can try with or without .toIterator, which may force some laziness we might wan",306778640,2015-08-30 04:42:11
9151749,2221968,39120566,4,"to instead of until?

I think it's the rhoW that's taken here?  On inspection the code seems a little not right (I could be missing something), but it seems like this is the count of the number of leading 0s, so it should include hashSize for the case t",307371868,2015-09-10 07:58:55
9151749,3198003,39219638,23,"should this be negativePowersOfTwo, not powersOfNegativeTwo? the current name implies we are doing (-2)^(mj) which is not the same as (2)^(-mj)",307371868,2015-09-11 02:59:00
9151749,44017,39120650,4,"You're always setting aside at least 4 bits for the bucket, so I think the max is actually 124 - this should be slightly more than needed.",307371868,2015-09-10 08:00:44
9151749,2221968,39120839,4,"Cool.  For the record the parts that look not right are in rhoW:
- terminal condition is that `contains` returns false, but contains doesn't do any bounds checking; is it possible to overrun the array, however unlikely?
- loop starts at 1 instead of 0. ",307371868,2015-09-10 08:07:06
9151749,319889,39120708,4,"Sorry looks like we raced on actions there. Can you have hashSize itself rather than hashSize -1? the tests are green, so it seems unlikely this is wrong per say right? or do we have a test missing? ",307371868,2015-09-10 08:02:21
9151749,4783076,39121486,4,this should be `negativePowersOfTwo`?,307371868,2015-09-10 08:26:13
9151749,44017,39121728,4,"Hm I'm confused as to what's being asked here.

@ianoc I'm quite certain we don't need more than `hashSize-1`
@jnievelt IIRC the definition of rhoW is ""index of first non-zero"", not ""number of zeros"" so that might explain starting at 1?
@kamalmarhubi ",307371868,2015-09-10 08:33:42
9679749,44017,41109240,35,`Bitamp` should be `Bitmap` (also appears elsewhere),321039338,2015-10-05 08:51:25
9763044,2221968,42068185,17,"fpProb is 'P' from the paper, while we need to specify P0 here.  By my reading we should be using:

BloomFilter(initialCapacity, fpProb * (1 - tighteningRatio))",327970217,2015-10-15 04:38:10
9763044,2221968,42072106,44,"I'm not sure about this check.  It may be more expensive than we need and I'm not even sure it would be correct.

From the paper, it seems that we want a (perhaps protected) method on BF which counts the number of set bits, and we want something like:
",327970217,2015-10-15 05:35:45
9927174,7111,42408552,71,"return type on public methods, please.",333262980,2015-10-19 23:34:09
9927174,7111,42408579,144,return type on public methods please.,333262980,2015-10-19 23:34:24
9927174,7111,42408604,152,"return type, please.",333262980,2015-10-19 23:34:34
9927174,7111,42408644,166,"type on public val, please.",333262980,2015-10-19 23:34:54
9927174,7111,42408665,175,"type on public val, please.",333262980,2015-10-19 23:35:03
9927174,7111,42410131,226,I don't like that both TDigest and the monoid know about delta. Can we make it so only one needs to?,333262980,2015-10-19 23:46:51
9927174,290883,42415879,226,"I think you're right, the monoid has no need to know.   That does imply the need for a policy on what it means when adding two t-digests with differing delta values.  My proposal would be just adopting the left-hand-side delta, which is simple and also al",333262980,2015-10-20 00:38:51
9927174,7111,42420058,157,can we remove this?,333262980,2015-10-20 01:15:46
9927174,7111,42420079,158,"this is not needed now, right? This is in the space right?",333262980,2015-10-20 01:16:01
9927174,7111,42420370,145,"you are using several types here, why not use a named type here? `UnsetValueIncrementMap` or something.",333262980,2015-10-20 01:18:25
9927174,7111,42889427,59,"this is non-deterministic, but I wonder if we track a seed which we update on merges if we can make it deterministic and yet keep the property that in expectation it is randomized.",333773736,2015-10-23 22:12:08
9927174,7111,42890043,24,can we call these Red and Black?,333773736,2015-10-23 22:17:12
9927174,7111,42890144,30,"`def key: K` is what we normally use here. You can override def with a val, but an abstract val has some bad properties (like opening up the val-init-order bug as a possibility).",333773736,2015-10-23 22:18:21
9927174,7111,42890255,34,I think this gives a warning because the `K` can't be checked. I think you need: `case data: Data[_] => key.equals(data.key)`,333773736,2015-10-23 22:19:28
9927174,7111,42890289,46,I'd prefer not to have abstract vals.,333773736,2015-10-23 22:19:48
9927174,7111,42890441,210,can we call these RedNode/BlackNode?,333773736,2015-10-23 22:20:58
9927174,290883,42890643,197,Input data is not pre-shuffled.   What you see there is a final shuffle which is for a final clustering compression.,333773736,2015-10-23 22:23:01
9927174,7111,42891056,210,"Actually, why not make:
```scala
case class RedNode[K](data: Data[K], lsub: INode[K], rsub: INode[K]) extends INode[K]
case class ...
```
or even:
```scala
case class INode[+C <: Color, K](color: C, lsub: INode[Color, K], rsub: INode[Color, K])
``",333773736,2015-10-23 22:27:07
9927174,290883,42891308,59,"Yes, definitely.  I was thinking of just using a Random object seeded with some variation of `hashCode` on the data, something along the lines of:

```scala
def deterministicShuffle[T](data: Seq[T]) =
  if (data.isEmpty) data else (new Random(data.hea",333773736,2015-10-23 22:29:18
9927174,290883,42891822,210,"Because they get inherited from, and scala doesn't seem to like inheriting from case classes.",333773736,2015-10-23 22:33:35
9927174,7111,42890381,177,same abstract val concern.,333773736,2015-10-23 22:20:34
9927174,7111,42890188,28,"this can be covariant: `Data[+K]`, which may be useful.",333773736,2015-10-23 22:18:47
9927174,7111,42889750,197,here is another randomization. Is this needed? Why not have the user shuffle if they want that behavior and just do the fold here?,333773736,2015-10-23 22:15:07
9927174,290883,42894078,177,I think updating these to be `def` instead of `val` will be relatively straightforward,333773736,2015-10-23 22:52:26
9927174,290883,42925148,28,"Covariance involves some open questions for me.  For example, if we want to inherit from SortedMap[K, +V], then I have to support a type-widening insert:
```scala
def +[V2 >: V](kv: (K, V2)): Map[K, V2]
```
Which I think I can do, but it isn't painles",333773736,2015-10-24 04:36:41
9927174,2221968,75730960,108,"What's the justification for this?  It doesn't seem to come from the paper.

In fact, there is explicit acknowledgment that two clusters could have the same centroid:
> For centroids with identical means, order of creation is used as a tie-breaker to a",498243513,2016-08-23 01:23:43
9927174,290883,75752800,108,"Allows centroid to serve as unique key, which simplifies things.   Multiple clusters with the same centroid adds nothing useful to the model.",498243513,2016-08-23 03:32:33
10046601,319889,44726801,3,why is this change in here? other than the compile step being before the test step whats the gain/reasoning?,338907574,2015-11-13 05:47:07
10046601,319889,44726860,29,object names generally are all capitalized,338907574,2015-11-13 05:47:36
10046601,290883,44730876,3,"The test was timing out.  Factoring out the compilation helps keep the actual 'sbt test' command from running too long.  This used to be a separate commit with its own message, but it was all squashed when I refactored the PR",338907574,2015-11-13 06:25:35
10046601,290883,44730962,29,"In this case the `tree` object is functioning more like a package, and so it seemed apropos to leave it lower case",338907574,2015-11-13 06:26:10
10046601,319889,44731076,29,why not make it a package then? this defining things in lower case objects then importing them immediately seems unusual. ,338907574,2015-11-13 06:27:18
10046601,7111,45268908,93,"why the casts here? Why not accept `NodeInc[K, V]` as the type for `ls`? same for the rest.",345783833,2015-11-19 05:13:44
10046601,7111,45269642,150,please put a return type on all public and protected methods.,345783833,2015-11-19 05:19:29
10046601,7111,45269801,93,Can you put a return type on `iNode`. What are we using here?,345783833,2015-11-19 05:20:43
10046601,7111,45270085,179,"why is this needed? What are the laws? Is it any different than:
```scala
case class PreparedMonoid[E, T](prepare: E => T, monoid: Monoid[T])
```
why define a new trait?",345783833,2015-11-19 05:22:56
10046601,7111,45270394,59,both `valueMonoid` and `prefixMonoid` have monoids on `V`. What if they are not related? Can we avoid using two monoids and just take a function from `P => V` here?,345783833,2015-11-19 05:25:40
10046601,7111,45270431,56,This is a very abstract name. Can you add a comment as to how it used?,345783833,2015-11-19 05:25:57
10046601,7111,45269506,120,"how does this cast succeed? Why is it needed?

It seems that `DataMap[K, V] <: DataMap[K] <: AnyRef`.

I'd really rather not have any casts.",345783833,2015-11-19 05:18:25
10046601,7111,45270574,57,why is it called a `keyOrdering` but it is a `Numeric`? Can we avoid `Numeric` which is a pretty strong type class.,345783833,2015-11-19 05:27:04
10046601,290883,45381896,93,"`iNode` is an abstract function defined in `...redblack.tree.Node`  (the very top of the hierarchy).  Its return type is `INode` (the highest level internal tree node type).   At that level, it has no knowledge of any sub classes, and so `ls` and `rs` hav",345783833,2015-11-20 01:44:26
10046601,290883,45383245,120,"It is being used so that the `xxxMap` classes can return their own type (encoded by self type `M`).   As far as I know, the only way to avoid it would be to extend the self types up into the tree classes.  I made a few attempts at that, and could not get ",345783833,2015-11-20 01:53:54
10046601,290883,45383431,179,"`PreparedMonoid` might be equivalent.   I couldn't find anything except `Monoid` when I looked.   If you already have something like it, that would be even better.
",345783833,2015-11-20 01:55:18
10046601,290883,45383827,59,"They do different things, and serve orthogonal purposes.  So they definitely aren't related.   I presume it is only a problem where implicits are in play.  Currently one of them is the different type `IncrementingMonoid` so it isn't generating any type co",345783833,2015-11-20 01:58:16
10046601,290883,45383945,150,"Sure, that will be no problem.",345783833,2015-11-20 01:59:12
10046601,290883,45384002,56,"Yes, I'll add some doc to explain it",345783833,2015-11-20 01:59:37
10046601,290883,45385299,57,"`keyOrdering` is just the general ordering relation for all keys, and in general it is only required to be `Ordering`.   However, in the case of the subclasses that provide nearest-neighbor queries, keys must also support a notion of distance, defined as ",345783833,2015-11-20 02:09:27
10046601,290883,45396216,179,"I don't actually see any definition of `PreparedMonoid`, is this a recent addition?",345783833,2015-11-20 03:32:03
10046601,290883,45409434,179,"I have some misgivings about the Algebird use of the `prepare` concept.  I believe it doesn't perform well when it is used on monoids with nontrivial structure.

As one example, consider a monoid defined over `Map` where `m1.plus(m1)` (or `m1 ++ m2`) is",345783833,2015-11-20 05:18:04
10046601,290883,46617531,179,"After working through #501, I think I can replace my `IncrementingMonoid` with `MonoidAggregator`, since `append` is the analog of `inc`",345783833,2015-12-04 05:48:08
10701384,7111,46465846,11,"can we rename `sg` to be `b` here? It is of type `b`, right? `sg` sounds like semigroup to me.",351298153,2015-12-03 03:51:51
10701384,290883,46468606,11,"good point, I habitually confuse types with their type classes",351298153,2015-12-03 04:12:48
10701384,7111,46705268,23,"I'm still not crazy about this documentation leaving out that this is disabling the sumOption optimization, that would have previously been there.

Have you tried a benchmark using a `Map[K, V]` value or HyperLogLog? Those two have been optimized a fair",351579905,2015-12-05 01:08:08
10701384,7111,46211360,24,"so, `appnd` must satisfy the law:

```scala
appdn(appnd(Monoid.zero, f1), f2) == Monoid.plus(appnd(Monoid.zero, f1), appnd(Monoid.zero, f2))
```
Otherwise `prepare` doesn't mean what we expect. If you agree, we should add this law to the comment.

",350594828,2015-12-01 06:10:11
10701384,290883,46214347,24,"I may be missing some angle here, but that seems like an opportunity for Scalding/Spark to take better advantage of `traversableOnce.aggregate(...)` over individual partitions.
",350594828,2015-12-01 06:33:53
10701384,44017,46215019,24,"@erikerlandson I think the question is whether the `append()` optimization is more effective than whatever optimization is in `sumOption`. They're both about eliminating unnecessary intermediate values of the type we have a `Monoid` on, but in different w",350594828,2015-12-01 06:39:09
10701384,44017,46215504,24,"To put it another way, if you ultimately think of this like a `def foldLeft[B](z: B)(f: (B, A) => B): B` on a `Seq[A]`, and you have some `Monoid[T]`, the question is do we have `B == T` (a constraint that `sumOption` gets rid of) or do we have `A == T` (",350594828,2015-12-01 06:42:55
12617352,6636815,54279788,3,with < 0.1 error?,396767664,2016-02-27 02:16:04
12617352,123326,54280117,3,Whoops!  Fixed,396767664,2016-02-27 02:18:19
13967586,7111,61132560,35,should this be `private[algebird]` why are the others if not?,427707449,2016-04-27 00:51:43
13967586,504464,61196628,35,"the  2 apply methods in companion object are now both called from other classes so they both need to be private[algebird]. the one on line 110 had to be opened up because of new SpaceSaver.apply method on line 16.

the main constructor is not used outsi",427707449,2016-04-27 09:45:07
14725042,7111,65796014,3,"in fact future is not even a group because `Throw/Failure` has no inverse, same with Try.",458443679,2016-06-04 09:46:23
14725042,319889,66339103,32,Where is defining zero now ? AdditiveMonoid? ,459855015,2016-06-09 04:00:55
14725042,7111,66378610,32,yes. Actually `AdditiveMonoid` is basically identical to our `Monoid`,459855015,2016-06-09 10:39:44
14725042,622449,66546385,32,why not just make this an implicit class? ,459855015,2016-06-10 07:43:38
14725042,622449,66546774,32,What's the difference between non-additive Monoid and additive Monoid?,459855015,2016-06-10 07:48:41
14725042,7111,66550227,32,"Multiplication and ""plus"" and 1 and ""zero"" is a valid Monoid. Algebird has
just settled this by saying we always prefer additive so that Monoid can be
a subclass of group.

Not everyone agrees with that design. So in algebra, there is a Monoid that
has a ",459855015,2016-06-10 08:36:10
14725042,622449,66557027,32,"sorry, still don't understand. Is this just about naming?
I thought a monoid was:
1) A set of elements, E
2) A (closed) binary operator over the elements in E
3) An identity element present in E

You can call the operator ""plus"" and the identity ""ze",459855015,2016-06-10 10:14:56
14725042,7111,66558640,32,"You aren't missing anything. It is totally a naming thing.

On Thursday, June 9, 2016, Alex Levenson <notifications@github.com> wrote:

> In algebird-core/src/main/scala/com/twitter/algebird/Monoid.scala
> <https://github.com/twitter/algebird/pull/523#dis",459855015,2016-06-10 10:48:34
14725042,7111,77917600,32,It would have to be an inner class of a trait to get the priority right. I think it is just clearer to manually handle it personally.,459855015,2016-09-08 05:39:55
14725042,17013,78121374,3,"Right. I assume that these are here for backwards compatibility?

(We do have `algebra.ring.Semiring` if you wanted to be more precise, although you might still not want to define `exception * 0` as `0`.)",458443679,2016-09-09 09:34:02
14725042,17013,78121521,32,"Right. Also, I think having one of the implicit classes extend the other would get ugly when both were defined in traits. This encoding seems pretty straightforward to me.",459855015,2016-09-09 09:36:22
14725042,17013,78121628,32,"Right, this is a distinction that was important to us over in Spire-land, and which @johnynek agreed wouldn't be too difficult to encode here. I think the strategy of having Algebird's instances extend both the *generic* and *additive* traits is an elegan",459855015,2016-09-09 09:38:03
14725042,17013,78126439,41,"It's slightly annoying to have to do this, but if you could provide the same thing from `AdditiveSemigroup` as well it would be really helpful.",508636435,2016-09-09 11:10:06
14725042,7111,78286508,41,"yeah, I can do that. I can just call the implicit on `.additive`, right?",508636435,2016-09-11 08:23:21
14725042,17013,78286962,41,"Yeah, I think that should do it.",508636435,2016-09-11 09:40:05
14725042,7111,79425402,18,"I put some basic tests of the algebra interop here (they don't use any of the test properties we export, so I think it is the right place).",515645181,2016-09-19 23:02:17
14725042,7111,79425223,3,"Well, we should remove them. Added #548",458443679,2016-09-19 23:01:19
14725042,2221968,81636415,19,"nit: do we already use `a`, `b` somewhere?  I do like `l`, `r` a little better, to emphasize that these are not commutative.",518594623,2016-10-04 03:47:31
14725042,2221968,81637983,30,Maybe def product = iter.product ?,518594623,2016-10-04 03:55:40
14725042,7111,81640798,30,"that would be no faster than the default product. That said, adding a custom `sumOption` and `product` there is a chance for improvement because we can remove half of the boxing that has to go on with `TraversableOnce`.",518594623,2016-10-04 04:10:10
15288782,44017,65917084,4,"typo (""sorteTake"")",459691655,2016-06-06 22:57:12
15288782,7111,65938172,6,can we call this `sortByTake` mirroring the style of using scala names? This is like `sortBy(fn).take(count)`,459749711,2016-06-07 01:03:29
15288782,7111,65938272,16,can we call `sortByReverseTake` since this is like `list.sortBy(fn).reverse.take(count)`,459749711,2016-06-07 01:04:01
15288782,7111,65938352,16,"also, can we add the equivalent scala to the comment?",459749711,2016-06-07 01:04:24
15422353,7111,66833013,8,"i think this is more commonly called `Reservoir Sampling`: https://en.wikipedia.org/wiki/Reservoir_sampling

random sample is imprecise (could also be constant fraction).

My preference would be for a default (constant) seed version also, and in scala",462843593,2016-06-14 00:30:10
15422353,1443419,67553622,30,"I chatted @joshualande offline about this, and this is a recap:
When this runs as distributed MapReduce, each jvm ends up using identical pseudo-rng that will pick same record positions when processing its respective split. Since this is not equivalent t",464170804,2016-06-18 01:18:42
15422353,7111,67576669,30,"yeah, in map-reduce this is a real issue. We could possible mitigate it somewhat by doing:
```scala
.map { t => ((t.hashCode & Int.MaxValue) ^ rng.nextInt(), t) }
```
rather than just `nextDouble`

which would at least mix data from the item along w",464170804,2016-06-18 04:15:16
15612478,319889,68652055,7,"Don't think it really matters, but doing an iterator here would be faster to avoid closure creation?",470280756,2016-06-28 03:42:23
15612478,622449,68655965,7,"yeah, while loop here too?",470280756,2016-06-28 04:04:24
15612478,7111,68657883,7,"since this is only one closure for the whole data and since the insert call is already expensive, I'm going to punt on this (since I'm not sure it will actually be faster). I can imagine the jit inlining this.",470280756,2016-06-28 04:16:01
15612644,622449,68654635,6,"did we find out in the CMS PR that foreach doesn't compile down to a while?
should this be a while loop? I could imagine dynamic dispatch on a closure costingmore than boxing, but who knows",470284402,2016-06-28 03:56:53
15612644,319889,68655052,6,Closure usage is far far cheaper than boxing. I guess its to do with inlining or new gen allocations. But boxing will show up orders of magnitude higher than it. But seems reasonable to eliminate it here ,470284402,2016-06-28 03:59:05
15612644,622449,68655143,21,"is .toShort a method call or is it like a cast in java? 

maybe sum into an Int and then .toShort at the end? ",470284402,2016-06-28 03:59:37
15612644,622449,68655407,6,"OK thanks, didn't really have an intuition for what the cost of method dispatch vs boxing (object allocation?) is. But yeah, seems like here we might as well use a while anyway.",470284402,2016-06-28 04:01:06
15612644,7111,68656924,6,"The only catch is `TraversableOnce` has no way to use `while` without `toIterator`. In that case, building an iterator can be more expensive that `foreach`. Consider an array. If you need to write `foreach` for an array, you can do:
```scala
def foreach",470284402,2016-06-28 04:10:00
15612644,622449,68668337,6,"that's a good point, didn't realize that TraversableOnce only has a conversion to Iterator. ",470284402,2016-06-28 05:29:28
15976356,401065,76711636,15,Use these in the changes to the `Gen`s above?,501037631,2016-08-30 07:18:17
15976356,401065,76711645,69,Are these being removed because of redundancy?,501037631,2016-08-30 07:18:21
15976356,7111,76717374,69,"Yes. They are tested by the replaced line (we only check one for each of
the checks, but that is fine).
On Mon, Aug 29, 2016 at 14:18 Ben Pence <notifications@github.com> wrote:

> In
> algebird-test/src/test/scala/com/twitter/algebird/CountMinSketchTest.",501037631,2016-08-30 08:23:32
15976356,7111,76717528,15,It's a different class and I didn't want to yak shave too much. Just want the minimal change to enable code coverage to work.,501037631,2016-08-30 08:25:26
16590908,401065,76506330,9,"`scala -Xlint:help` says that `adapter-args` is for ""Warn if an argument list is modified to match the receiver."" Is that to warn on implicit conversions?",501022134,2016-08-27 07:42:27
16590908,7111,76506976,9,"it is `Right(1, 2)` which is adapted to be `Right((1, 2))` because `Right(t: T)` takes one arg. This code is littered with that and it makes warnings totally overwhelm the errors (so I couldn't even find the errors).

It does not work on 2.10, so I'll r",501022134,2016-08-27 08:04:52
17983722,7111,83698259,4,this should only be added to `object CMSHasher` see the comment on this object.,536123260,2016-10-18 00:56:36
17983722,7111,83701025,6,"I'm afraid this is slow. Can you compare this to using `x.underlying.scale` and `x.underling.unscaledValue`? You could use the byte array from `unscaledValue` and perhaps multiply the scale by `a` before passing to the `Array[Byte]` hashing.

If this is",536123260,2016-10-18 01:10:55
17983722,7111,83697923,6,we should not need this. `CMSHasherImplicits` is legacy. Let's not add to it. Just add to the `object CMSHasher`.,536123260,2016-10-18 00:54:47
17983722,7111,83697985,5,let's not add to CMSHasherImplicits,536123260,2016-10-18 00:55:05
17983722,7111,83698711,12,"why didn't line 134 above work? Or, maybe it did here, but not for `Semirgoup, Monoid, Group`? If so, I guess we should fix that.",536123260,2016-10-18 00:58:44
17983722,1202170,83811330,12,"Well. I didn't go that far. My initial motivation was that eventually I no longer need to provide my own ```Semigroup[BigDecimal]```; as ```Ring[BigInt]``` was here and is used by ``Semigroup[BigInt]```, ```Monoid[BigInt]```, ```Group[BigInt]```, I just x",536123260,2016-10-18 16:08:55
17983722,1202170,83811031,6,"D'oh. Yes of course. Done. 

FWIW, ```x.underlying.unscaledValue.toByteArray``` does allocate a temporary array. From what I understand HotSpot'JIT is doing these days, inline + lifetime escape analysis should eventually make that a (very cheap) stack a",536123260,2016-10-18 16:07:09
17983722,1202170,83810682,4,"I went a little too far in the ""mechanised patch"" thing. Should've had paid more attention. this and the two previous fixed.

Shouldn't we gut CMSHasherImplicits, move its contents to CMSHasher's companion, leave ""implicit vals"" in place for compatibili",536123260,2016-10-18 16:05:04
17983722,7111,84139384,16,"I don't think you should need this. I think the issue is that you have the `Arbitrary` both implicit in BaseProperties imported as well as arbReasonableBigDecimals.

I'd rather not make the `BaseProperties` one implicit. That should fix the issue. That ",537523753,2016-10-20 01:43:30
17983722,1202170,84068818,15,"I'm not really happy with the syntax here (the ""implicit"" on line 30, and maybe the whole of line 30, is spurious). Not quite sure how to do it better. I tried to hide the low-priority implicits brought in by the Arbitrary object, but didn't quite succeed",537523753,2016-10-19 20:26:59
18016813,2221968,83951643,41,"May want to be extra careful here, since this is looking very much like a `Bijection[Set[T], Set[T]]`, though of course it would not obey the `Bijection` laws.",537066320,2016-10-19 04:10:15
18016813,2221968,83950631,30,Nit: slightly better to always do -- first?,537066320,2016-10-19 04:04:58
18016813,2221968,83950574,24,"This construction seems a bit awkward.  What about this sort of alternative?
```
sealed trait SetDiff[T] {
  ...
}

private case class SetDiffImpl[T](add: Set[T], remove: Set[T]) extends SetDiff[T] {
  ...
}
```",537066320,2016-10-19 04:04:39
18016813,44018,83955737,41,"By careful you mean, change the name of the method?",537066320,2016-10-19 04:33:38
18016813,44018,83955914,24,"Hey! Thanks for the review - I was cueing off of the approach here: https://gist.github.com/tpolecat/a5cb0dc9adeacc93f846835ed21c92d2

Can you explain what you mean by awkward?",537066320,2016-10-19 04:34:52
18016813,7111,83956346,24,"the benefit of this style is that it preserves pattern matching, which is nice, but otherwise disables all the other means to create a new instance.",537066320,2016-10-19 04:37:29
18016813,7111,83956545,30,"note `add` and `remove` are disjoint. It does not matter which you do first. No GC can happen of any entries until `other` and `this` go out of scope, so, I don't *think* there is an issue.",537066320,2016-10-19 04:38:49
18016813,7111,83957016,41,"I see what you mean. since the `foo(bar)` and `foo.invert(bar)` both work, it can look similar from that perspective to an Injection or Bijection.

I'm not too worried. Are you @jnievelt ?",537066320,2016-10-19 04:41:33
18016813,2221968,83960678,24,"Ah just seems odd to me to have everything anonymous class instances.  But maybe it's not a big deal?

W.r.t. pattern matching, I have a hard time weighing that vs. encapsulating the mechanism here (is there a clear use case for decomposing?).",537066320,2016-10-19 05:04:21
18016813,44018,83956039,30,"Hmm, both end up filling up internal sets, so I'm not sure why we'd get any change. (If we were actually growing then shrinking a set I agree.)",537066320,2016-10-19 04:35:34
18016813,2221968,83960998,41,"I thought about `swap`; I suppose `revert` also works in the context of ""Diff"".  But I think a doc comment may be fine too.",537066320,2016-10-19 05:06:12
18020246,44018,86625749,1,no longer needed!,549397006,2016-11-05 03:23:20
18020246,44018,86625823,9,this fixes a bug with `IndexOutOfBoundsException` in the tests.,549397006,2016-11-05 03:23:43
18020246,44018,86625639,3,I gathered as many of these as I could from the web.,549397006,2016-11-05 03:22:35
18020246,44018,86625719,3,copied this from the wiki and converted `*` to `+` in the semigroup and monoid sections.,549397006,2016-11-05 03:23:09
18020246,44018,86624544,36,all I did here was undo the line wraps.,549397006,2016-11-05 03:16:12
18020246,44018,86624972,121,for now we only depend on core to generate tutorial stuff... users can add if they want to write docs for the non-core projects.,549397006,2016-11-05 03:18:37
18020246,44018,86624352,5,"this is required to check that all documentation still builds; `tut` actually compiles all the docs(!!), so regressions to the docs will cause a build failure here.",549397006,2016-11-05 03:15:09
18020246,44018,86624603,48,same here.,549397006,2016-11-05 03:16:37
18020246,44018,86624595,45,link to the new website.,549397006,2016-11-05 03:16:32
18020246,44018,86624869,25,all projects in here get API docs for 2.11 and up.,549397006,2016-11-05 03:17:55
18020246,44018,86624451,13,required to build the docs microsite and generate jekyll.,549397006,2016-11-05 03:15:41
18020246,44018,86625606,2,copied from the wiki.,549397006,2016-11-05 03:22:23
18020246,44018,86624519,6,Love this badge.,549397006,2016-11-05 03:16:00
18020246,44018,86624292,2,this page gets copied over as a microsite page now.,549397006,2016-11-05 03:14:47
18020246,44018,86625328,7,"this is the ""REPL"" page from the wiki, with a nice new index, converted to `tut`.",549397006,2016-11-05 03:20:47
18020246,44018,86625576,1,"this is a modified and trimmed version of the README, converted to `tut`.",549397006,2016-11-05 03:22:12
18020246,44018,86624570,36,andddd add backticks around code.,549397006,2016-11-05 03:16:22
18020246,44018,86624664,75,moved these here from the wiki.,549397006,2016-11-05 03:16:53
18020246,32164772,86632353,6,"This looks wrong, it says cats-core on the page not algebird core",549397006,2016-11-05 04:06:09
18020246,319889,86634059,7,"Be good to link to this from the parent page, shows up in the index, but be good to be easier to find",549397006,2016-11-05 04:16:53
18020246,319889,86633370,65,Link doesn't seem to work on the site,549402717,2016-11-05 04:12:47
18181718,11097008,90738410,39,"we should optimize this. This is terrible using `Stream` here.

Paging @non",541443661,2016-12-03 07:32:03
18352698,44018,85977686,304,"@non @johnynek would love some advice on how to efficiently share the calculations going on here and in `fromLong`, without creating an intermediate return tuple for the values that both functions need.

That said... `bucketsFromLong` is the only thing ",546887568,2016-11-02 00:23:51
18352698,44018,85977781,304,"this is exactly `toBuckets(fromLong(s, k))` btw",546887568,2016-11-02 00:24:16
18352698,44018,85977980,197,I wonder if it'd be a good idea to skip the zero checking by adding a `trait ExpHist` and a `case object EmptyExpHist`.,546887568,2016-11-02 00:25:07
18352698,44018,85978049,46,"we never really need `k`, but it shows up in the paper.",546887568,2016-11-02 00:25:25
18352698,44018,85978205,117,"this is the only reason I'm not able to use an iterator, this pushing back into the vector. I wonder if we can implement this better with some carry Option. thoughts?",546887568,2016-11-02 00:26:06
18352698,44018,85978360,181,this was a little subtle. We have to step AFTER adding because the range of timestamps of the new items we're pushing in might be larger than windowSize.,546887568,2016-11-02 00:26:42
18352698,44018,85978446,162,"here we can step BEFORE, because we know that there's only a single timestamp coming in.",546887568,2016-11-02 00:27:01
18352698,11097008,85988568,304,"can you add that comment: `bucketsFromLong(s, l) == toBuckets(fromLong(s, k))`

This is a different representation right? Can we have a different AnyVal wrapper to distinguish?",546887568,2016-11-02 01:08:12
18352698,11097008,85988254,287,"what about `final case class CanonicalRepresentation(toVector: Vector[Int]) extends AnyVal`

Also, maybe add these specialized types under `object ExpHist`.",546887568,2016-11-02 01:06:39
18352698,11097008,85988326,325,can this be a method on an `AnyVal` class?,546887568,2016-11-02 01:06:58
18352698,11097008,85987883,280,"this confuses me. If you are returning the coefficients of `s^i` in the `i'th` position of the vector, then why isn't the vector infinite? We can take infinite powers?",546887568,2016-11-02 01:05:02
18352698,11097008,85987012,219,can you add a `Approximate[Long]` return value? Those compose somewhat.,546887568,2016-11-02 01:00:53
18352698,11097008,85987181,269,what about the bugs on inlining you found? Are we sure none of these exhibit this? Downstream folks still could if they compile with `-optimize`.,546887568,2016-11-02 01:01:38
18352698,11097008,85987533,284,what is `ret`? The returned array? Can we comment to that?,546887568,2016-11-02 01:03:22
18352698,11097008,85989437,91,fancy! :) Hacker's Delight in the house.,546887568,2016-11-02 01:11:58
18352698,11097008,85987228,287,no curlies...,546887568,2016-11-02 01:01:50
18352698,44018,85997015,284,fixed up,546887568,2016-11-02 01:45:40
18352698,44018,85997219,219,"boom, will do",546887568,2016-11-02 01:46:38
18352698,44018,85997583,219,"don't we want `approximate[Double]`, since we want the estimate to fall in the middle of the range?",546887568,2016-11-02 01:48:27
18352698,44018,85998180,280,huge typo! should have been 2^i. Fixed up the docs too.,546887568,2016-11-02 01:51:18
18352698,44018,85998198,287,removed,546887568,2016-11-02 01:51:22
18352698,44018,85998244,287,I like it. I moved the whole object inside `ExpHist` - will add these as well.,546887568,2016-11-02 01:51:37
18352698,44018,85999408,325,"boom, moved that and `toBuckets`",546887568,2016-11-02 01:57:06
18352698,44018,87061059,219,"okay, added!",546887568,2016-11-09 03:10:26
18352698,7111,87530623,97,"I wonder about using a `foldMutable` here and accumulating a batch of `Bucket` and then doing an `addAll` which might be a lot faster, but we can punt on this if you like.",552190819,2016-11-11 11:04:53
18352698,7111,87530402,392,there is going to be a fair amount of boxing cost here. Actually calling `Monoid.sum( )` will avoid some of that since `Monoid` is specialized on `Long`,552190819,2016-11-11 11:01:27
18352698,7111,87530167,204,I wonder if we should make an `case class Timestamp(toLong: Long) extends AnyVal` to prevent value/timestamp confusion. Seems really easy to get those wrong. What do you think?,552190819,2016-11-11 10:58:05
18352698,7111,87530452,403,"what about:
```scala
rep.iterator
  .zipWithIndex
  .flatMap { case (i, exp) => Iterator.fill(i)(1L << exp) }
  .toVector
```",552190819,2016-11-11 11:02:16
18352698,7111,87529950,82,"can we move this inside the `else` branch below? We can compute delta before sorting and if it is zero, just step to the max time?",552190819,2016-11-11 10:55:40
18352698,44018,87634678,403,done,552190819,2016-11-12 02:29:35
18352698,44018,87635226,392,"how about

```scala
Monoid.sum {
        rep.iterator.zipWithIndex
          .map { case (i, exp) => i.toLong << exp }
      }
```",552190819,2016-11-12 02:33:02
18352698,44018,87636142,204,"yeah, let me thread it through and see what it looks like",552190819,2016-11-12 02:38:50
18352698,44018,87638807,82,done,552190819,2016-11-12 02:55:21
18352698,7111,87640996,392,???? ,552190819,2016-11-12 03:09:09
18352698,44018,87641460,97,"added a test and this impl:

```scala
def fold: Fold[Bucket, ExpHist] =
    Fold.foldMutable[Builder[Bucket, Vector[Bucket]], Bucket, ExpHist](
      { case (b, bucket) => b += bucket },
      { _ => Vector.newBuilder[Bucket] },
      { x => addAll",552190819,2016-11-12 03:11:32
18352698,44018,85991421,304,"For sure, I'll add some AnyVal wrappers now.",546887568,2016-11-02 01:20:21
18352698,44018,85998139,219,"let's talk about this one before I add it, so I can add appropriate tests as well.",546887568,2016-11-02 01:51:04
18854897,32289876,88058803,21,"May be nice to provide an alternative here: `use j(Array[Byte], Int) instead` or something.",556770847,2016-11-16 00:45:24
18854897,11097008,88059488,66,why don't we want `sumOption` here rather than `reduce(_ + _)`? Or some logic that checks if there are more than `k` things to aggregate use `sumOption`?,556774731,2016-11-16 00:48:09
18854897,11097008,88058987,140,actually I guess the `floor` and `ceil` should be reversed. We can't widen the bound and still claim the probability is the same. I think this is a (minor) off-by-one bug.,556774731,2016-11-16 00:46:10
18854897,32289876,88084362,33,"Perf nit: Is the `!seen` worth it here? If the set already contains `k`, then `seen += k` should be functionally equivalent to a containment check, with no mutation anyway. I guess the question is, is `negativePowersOfTwo` expected to be slower than check",556779702,2016-11-16 02:44:13
18854897,32289876,88082834,87,"nit: feel free to ignore, but I think having `return` on its own line is worth it here. Mainly, I saw the 0.toByte below, figured there was a `return` somewhere, but wasn't able to easily locate the return statement in this code.",556779702,2016-11-16 02:36:56
18854897,32289876,88082541,43,"I don't think this does anything if `need == 0`, so you can just `need > 0`.",556779702,2016-11-16 02:35:27
18854897,17013,88089525,140,"I'm happy to change that, but the bug seems to have been present before. Do you think it's worth fixing it here, or merging this PR (without differences) then making that change?",556774731,2016-11-16 03:07:44
18854897,17013,88089616,43,Agreed.,556779702,2016-11-16 03:08:07
18854897,17013,88089978,33,I think we need to avoid double-counting a particular `k`. If we remove the check then I think `sum` will be wrong.,556779702,2016-11-16 03:10:00
18854897,310250,88090876,33,"Ah, of course, for some reason I missed that we were adding it into sum :| That said, you can still skip this check by using `add`, which returns `false` if the set already contains the element:

```scala
if (t >= threshold && seen.add(k)) {
  sum += ",556779702,2016-11-16 03:14:17
18854897,17013,88115349,33,"Ooh, nice!",556779702,2016-11-16 05:18:20
18854897,11097008,88139072,140,"Let's wait, but we should not forget it, I think.",556774731,2016-11-16 07:36:10
18854897,11097008,88295465,27,`0.12.3`,557022842,2016-11-17 02:12:02
18854897,11097008,88296391,65,where is the `20%` coming from? Can you add a comment?,557022842,2016-11-17 02:16:38
18854897,11097008,88295382,7,I think this should be `0.12.3`,557022842,2016-11-17 02:11:41
18854897,17013,88085345,66,That's a good idea -- I'll try it. I had something fancier here that actually hurt performance so I had reverted to what was previously happening (more or less).,556774731,2016-11-16 02:48:46
18965515,44018,88685731,4,this webhook reports our build status to gitter.,558995245,2016-11-19 00:10:55
18965515,44018,88685844,53,this was annoying... if I write `tut` the build will fail.,558995245,2016-11-19 00:11:25
18965515,44018,88686290,12,I pulled the `fold` function out to share between the `semigroup` and `monoid`.,558995245,2016-11-19 00:13:53
18965515,44018,88685990,4,I moved `Roller` into its own file.,558995245,2016-11-19 00:12:17
18965515,44018,88686231,39,this data structure has no changes. I moved it out of `Cuber.scala`.,558995245,2016-11-19 00:13:32
18965515,44018,88686340,254,open to suggestions on the ordering here!,558995245,2016-11-19 00:14:11
18965515,44018,88686613,28,and now this is going to become a discussion of why abstract algebra is useful in programming,558995245,2016-11-19 00:15:41
18965515,44018,88686575,1,these get their own files.,558995245,2016-11-19 00:15:29
18965515,44018,88686490,8,I broke all of these out into their own files.,558995245,2016-11-19 00:15:06
18965515,44018,88685959,5,"we haven't published yet, so it's fine to break here.",558995245,2016-11-19 00:12:07
18965515,44018,88686707,12,we don't need this explicit dependency. sbt-microsites upgrades will bring it along for the ride.,558995245,2016-11-19 00:16:09
18965515,310250,88690188,14,"```
Given two operations, if the second fails before the first completes, one can fail the entire computation right then. With `flatMap`, one would have to wait for the first operation to complete before failing it.
```

This isn't quite true - if you",558995245,2016-11-19 00:33:37
18965515,11097008,88709357,14,"You can do this ONLY if the `Eq[Error]` is the trivial one: `eqv(a, b) == true`.

But yeah, not strictly true in the way the laws are usually written.",558995245,2016-11-19 02:18:46
19148495,44018,89538792,27,bumped these up to commutative monoid tests from the old monoid-only tests.,563055046,2016-11-25 02:53:48
19148495,44018,89538730,26,All this is moved to `Gen.scala` and `Arbitrary.scala`,563055046,2016-11-25 02:52:49
19148495,44018,89538831,6,WIP!,563055046,2016-11-25 02:54:29
19148495,44018,89538713,20,moved to `ExpHistInstances.scala` in the scalacheck package,563055046,2016-11-25 02:52:33
19148495,44018,89538692,14,moved into `Min` and `Max` tests,563055046,2016-11-25 02:52:17
19148495,44018,89538606,24,"what do you think of this style, vs jamming everything into a single file?",563055046,2016-11-25 02:50:59
19148495,44018,89538677,5,moved to Arbitrary.scala`,563055046,2016-11-25 02:52:08
19148495,44018,89538770,48,I managed to get rid of this diverging implicit expansion by adding a `[T]` parameter onto the `intervalArb` sub-generators.,563055046,2016-11-25 02:53:16
19148495,44018,89538821,8,tests work great as long as you extend `CheckProperties`.,563055046,2016-11-25 02:54:17
19148495,44018,89538579,19,"ah, these gets ordering instances as well.",563055046,2016-11-25 02:50:29
19148495,44018,89679722,16,"Ah, thank you @morazow! I'll make the change tomorrow when I add the actual documentation updates.",563105264,2016-11-27 07:07:47
19148495,44018,89698999,88,I followed `cats` here by only implementing this for `Stream` and `Vector` in addition to list.,565303154,2016-11-28 04:42:13
19148495,44018,89698985,34,should be more efficient.,565303154,2016-11-28 04:41:45
19148495,1108429,89679192,16,"Hello @sritchie, 
I was just checking this pr. I think the above statement meant to be "".. last item"".",563105264,2016-11-27 06:26:12
19214770,44018,89702675,51,"this is annoying - this is the ONLY reason this change is binary-incompatible. @isnotinvain, can you check if Twitter is using this anywhere internally?",565396455,2016-11-28 07:05:38
19214770,7111,89703295,35,Let's do sumOption on this semigroup.,565396455,2016-11-28 07:32:15
19214770,7111,89703318,46,"Can you add the old one with the broken name, mark it deprecated and just call this one? Let's not break binary compat if we don't have to.",565396455,2016-11-28 07:33:55
19214770,7111,89703258,42,Would be nice to override sumOption while we are at it can avoid a lot of reboxing.,565396455,2016-11-28 07:30:24
19214770,7111,89703347,51,Let's just call the new one.,565396455,2016-11-28 07:34:36
19214770,7111,89703426,11,Why change the name of the test?,565396455,2016-11-28 07:38:47
19214770,7111,89703305,37,Add sumOption.,565396455,2016-11-28 07:32:52
19214770,7111,89703303,33,Add sumOption,565396455,2016-11-28 07:32:43
19214770,44018,89704279,11,"I was trying to make them all consistent - we have `Laws`, `Spec`, `Specification`, `Tests`... what do you think of `Spec` for everything? `Laws` is fine too, but I'd love them to match.",565396455,2016-11-28 08:09:38
19214770,44018,89705028,33,done,565396455,2016-11-28 08:34:55
19214770,44018,89705030,37,done,565396455,2016-11-28 08:34:57
19214770,44018,89704335,51,???? done,565396455,2016-11-28 08:11:09
19214770,44018,89705034,46,done,565396455,2016-11-28 08:35:05
19214770,44018,89705027,42,done,565396455,2016-11-28 08:34:49
19214770,44018,89705026,35,Done.,565396455,2016-11-28 08:34:45
19214770,32008959,89842184,4,this was missing `semigroupSumWorks[T]`.,566311898,2016-11-29 02:06:04
19214770,7111,89846620,41,"we almost certainly want the `sumOption` on this one since we can skip enumerating the iterator in this case (in fact, `sumOption` is just `headOption` but for some terrible reason, `TraversableOnce[T]` does not have that.",566311898,2016-11-29 02:27:54
19214770,7111,89849034,113,"should we move this up to being on the companion:
```scala
def maxSemigroup[T](implicit ord: Ordering[T]): Semigroup[T] = ...
```
then call it here? People might want to reuse this.

Also, note this is a `Semilattice` when we merge `algebra` we can ",566311898,2016-11-29 02:39:01
19214770,7111,89851238,20,can we bump this up to `commutativeMonoidLaws`? I think so.,566311898,2016-11-29 02:49:25
19214770,7111,89859874,27,"I think there is a `commutativeMonoid` here too, right? `""""` is the `zero`?

`Min[String]` is the one that is just a semigroup because there is no max string.",566311898,2016-11-29 03:23:07
19214770,7111,89857843,27,"don't think we really need two here, for same reason as I mentioned.",566311898,2016-11-29 03:16:27
19214770,7111,89849775,51,same comment about sharing a generic `minSemigroup`,566311898,2016-11-29 02:42:23
19214770,7111,89846773,36,"we have to enumerate everything for last, so this is fine without sumOption.",566311898,2016-11-29 02:28:32
19214770,7111,89850539,27,"not sure we should do this this way. The cats way is to make a trait for each, then in the `everything` you mix in all the traits (which have no priority issues).

maybe we can do that here? `OrderingArb` or something for these `Max, Min, First, Last`, ",566311898,2016-11-29 02:46:06
19214770,7111,89860558,29,what's going on with this object? Can we have a comment if it is really needed?,566311898,2016-11-29 03:25:07
19214770,7111,89858189,18,String is a monoid. You mean non-commutative?,566311898,2016-11-29 03:17:33
19214770,7111,89847132,31,"we could share this code in `object First`:
```scala
  def firstSemigroup[T]: Semigroup[T] = ...
```
  then `implicit def semigroup[T]: Semigroup[First[T]] = firstSemigroup[First[T]]`

and below you can share the `sumOption` in the aggregator.",566311898,2016-11-29 02:30:01
19214770,7111,89851432,27,may not need this. The main reason we do it is to test both a commutative and non-commutative underlying semigroup.,566311898,2016-11-29 02:50:27
19214770,7111,89850593,27,same comment about factoring `gen`,566311898,2016-11-29 02:46:22
19214770,7111,89860073,39,"this is duplicated above, I think the first should be `Min[String]`",566311898,2016-11-29 03:23:42
19214770,7111,89848396,72,this seems like a busted comment. What does cats have to do with scala.collection? I assume this may be referring to some method in cats? Is it in cats.kernel?,566311898,2016-11-29 02:35:55
19214770,7111,89849722,30,"actually, we should have this as a low priority. `Ordering` extends `Equiv` so both at the same level may block `Equiv`. Maybe not, but we can add a test like: `implicitly[Equiv[Max[Int]]]` in the tests to call this code.",566311898,2016-11-29 02:42:07
19214770,7111,89850922,22,"wish I had caught this before, but generally taking type classes in case class construction is usually a bad pattern, and instead take it on the method calls. But maybe we didn't publish with this yet.",566311898,2016-11-29 02:47:56
19214770,44018,89863531,31,"nice, done",566311898,2016-11-29 03:34:37
19214770,44018,89863983,72,"yup, busted.",566311898,2016-11-29 03:36:11
19214770,44018,89864558,113,fixed,566311898,2016-11-29 03:38:04
19214770,44018,89865996,51,shared,566311898,2016-11-29 03:42:47
19214770,7111,89865065,97,`Equiv.universal`,566331686,2016-11-29 03:39:40
19214770,7111,89865676,200,`Equiv.universal`,566331686,2016-11-29 03:41:48
19214770,7111,89862405,48,`Equiv.universal`,566331686,2016-11-29 03:30:36
19214770,7111,89862584,78,`Equiv.universal`,566331686,2016-11-29 03:31:11
19214770,7111,89862307,29,this is just `Equiv.universal`. Can we use that and deprecate `defaultEq`?,566331686,2016-11-29 03:30:15
19214770,7111,89866043,228,`universal`,566331686,2016-11-29 03:42:57
19214770,7111,89865385,150,`Equiv.universal`,566331686,2016-11-29 03:40:39
19214770,7111,89865636,179,`Equiv.univeral`,566331686,2016-11-29 03:41:37
19214770,44018,89866690,22,"Removed! We didn't need it at construction. I wanted to enforce that it was a numeric type, but the arb does that.",566311898,2016-11-29 03:45:16
19214770,44018,89866899,20,"yup, worked",566311898,2016-11-29 03:45:59
19214770,44018,89867340,18,"good catch - I was using the same tests in `MinLaws` and `MaxLaws`. I'll change types. I was looking to exercise a semigroup, since it's defined differently from the monoid",566311898,2016-11-29 03:47:34
19214770,44018,89867434,29,"nope, deleted, that was waste from a shared function I had then killed. good catch.",566311898,2016-11-29 03:47:56
19214770,44018,89863556,41,fixed,566311898,2016-11-29 03:34:42
19214770,44018,89865974,30,"didn't actually cause any problems, but I added the tests.",566311898,2016-11-29 03:42:43
19215151,7111,89703627,24,Why the renaming?,565396063,2016-11-28 07:46:37
19215151,7111,89703704,49,Why not abstract class here (you used elsewhere and is gentler on binary compatibility.,565396063,2016-11-28 07:48:53
19215151,44018,89929606,49,"It's in the tests only, so I think it's fine - and we need `trait` to mix it into the tests above.",565396063,2016-11-29 10:23:50
19215151,44018,89929631,24,I did this before our discussion on the other PR. will change it back!,565396063,2016-11-29 10:24:05
19268536,44018,90047888,21,"everything except for this change is a formatting thing that removes the extra space before `:`. Strange that the checked-in script didn't generate the checked-in code, by the way.",567168988,2016-11-30 00:34:10
19268536,7111,90056015,21,What I think it is: code formatting has run on the code.,567168988,2016-11-30 01:07:31
19269997,7111,90079243,79,this should probably be moved to `algebird-test/main` so people can reuse it.,567197398,2016-11-30 02:50:45
19269997,7111,90079448,21,we should keep an open issue to add all the `todos` that we would like but couldn't yet do with binary compatibility.,567197441,2016-11-30 02:51:38
19269997,7111,90074871,4,"yeah, i don't *think* equality exactly makes sense on this, and this is a pretty weak test. In any case, I would not make it implicit if we move it here. Call it something like `consistentEquiv`",567197441,2016-11-30 02:35:21
19269997,7111,90083782,58,this is also a commutative monoid.,567197398,2016-11-30 03:06:57
19269997,7111,90078107,71,"huh. I mean, what if you do `(x ++ x) == (x ++ y) && (y ++ y) == (y ++ x)` (saving the `x ++ y` since that should be the same as `y ++ x`.

What is going on here? I assume it is either:
1. something to do with TopK not being associative
2. sparse repr",567197441,2016-11-30 02:46:35
19269997,7111,90083720,58,strange my codecov plugin things `Monoid[Try[Int]]` is untested. Hmmm.. Can we add `semigroupLaws[Try[Min[String]]]` to test a semigroup?,567197398,2016-11-30 03:06:44
19269997,7111,90077326,63,Nice catch!,567197441,2016-11-30 02:43:47
19269997,7111,90082953,5,looks like `trySemigroup` and `tryMonoid` are untested.,567197398,2016-11-30 03:03:57
19269997,7111,90066008,7,"I think this is ignoring heavy-hitters, which is probably not what people expect. I would leave it with the tests otherwise I think there is a lot of chance for surprise.",567197441,2016-11-30 01:54:07
19269997,44018,90089241,71,"Ugh, annoyingly that fails.  The problem is when you compare `++` and `sumOption` on a singleton list.",567197441,2016-11-30 03:24:19
19269997,44018,90094847,58,bumped. I had to modify the generators to use `Exception` vs `Throwable`. It's actually not commutative to add a `Throw[Error]` and `Throw[Exception]`.,567197398,2016-11-30 03:43:14
19269997,44018,90094463,5,fixed with explicit imports in each property's scope.,567197398,2016-11-30 03:41:52
19269997,44018,90091372,21,https://github.com/twitter/algebird/issues/587,567197441,2016-11-30 03:31:10
19269997,44018,90090898,79,done,567197398,2016-11-30 03:29:30
19269997,44018,90094691,58,"ah, it was pulling in the ring! fixed with custom imports.",567197398,2016-11-30 03:42:43
19269997,44018,90094522,19,added them to the issue about binary compatibility,567197441,2016-11-30 03:42:03
19269997,44018,90064314,7,"I moved these from the tests - are you okay with this, or do you want these to stay in implicit scope in the tests?",567197441,2016-11-30 01:46:31
19269997,44018,90064340,4,same comment here about moving this from the tests.,567197441,2016-11-30 01:46:39
19269997,44018,90064754,5,I missed this before when I reverted the `Spec` thing.,567197441,2016-11-30 01:48:35
19269997,44018,90064825,5,these mixins weren't doing anything.,567197441,2016-11-30 01:48:51
19269997,44018,90064915,5,these were running because of the use of `check`.,567197441,2016-11-30 01:49:12
19269997,44018,90065014,14,removed check from all of these and tightened the test with commutative.,567197441,2016-11-30 01:49:33
19269997,44018,90065047,63,these just weren't running at all.,567197441,2016-11-30 01:49:43
19269997,44018,90065122,71,this is sketchy. What are your thoughts here? Tests fail without the equiv instance.,567197441,2016-11-30 01:50:03
19269997,44018,90065250,12,scalacheck includes function arbs now!,567197441,2016-11-30 01:50:41
19269997,44018,90065367,65,uses equiv now,567197441,2016-11-30 01:51:04
19269997,44018,90065440,21,this broke binary compatibility when I tried to create a companion object for `MinHashSignature`.,567197441,2016-11-30 01:51:24
19269997,44018,90065553,19,"I kept these here to maintain binary compatibility, even though they're broken and untested.",567197441,2016-11-30 01:51:51
19273119,7111,90140436,74,do we want `iter.iterator.map(...` so we maybe avoid a copy of the `Iterable`?,567256395,2016-11-30 07:39:09
19273119,7111,90275457,74,"I think we do want the outer copy of the iterable, but not the second one that gets made to do this map. For this one I do think we want to pass an iterator to sumOption.",567256395,2016-12-01 00:52:29
19279790,44018,90278343,4,"yup, I added it to the 0.13.0 cleanup - I'll add the link here.",567385363,2016-12-01 01:05:15
19279790,44018,90278593,38,"yeah, that's probably right. Probably worth removing...I guess we have to allocate a `Tuple2` anyway even if we abstract out the code. We might as well just create the `AveragedValue` directly.

so kill this?",567385363,2016-12-01 01:06:25
19279790,7111,90274891,2,We should mention the two main facts: 1) allows you to get the average and the count with one pass over the data. 2) tracks the average using a stable algorithm that won't overflow for big data (as long as there are fewer than 2^63 items generally).,567385363,2016-12-01 00:49:41
19279790,7111,90272746,4,Can we add an issue and a link to the issue. In my experience TODOs in code are generally ignored.,567385363,2016-12-01 00:40:43
19279790,7111,90274276,5,Can we mention it is a Group meaning you can subtract values?,567385363,2016-12-01 00:46:59
19279790,7111,90274456,7,Seems like just showing some example of getting the average of a bunch of Longs or Doubles would be fine.,567385363,2016-12-01 00:47:47
19279790,7111,90274519,7,Maybe also showing the Aggregator.,567385363,2016-12-01 00:48:03
19279790,7111,90273458,38,This breaks the stability of the algorithm doesn't it? We go to lengths to not just do the simple thing in plus and here we go back to the simple thing. I don't know if we can speed up sumOption without duplicating code.,567385363,2016-12-01 00:43:46
19279790,7111,90720165,17,"you could actually make this return `First[T]`, I think.",569559580,2016-12-03 05:10:34
19279790,7111,90279334,38,"Well that's what I meant about copy/paste. We could do a while loop that mutates a double and Long. That would be no allocation, but would duplicate code unless we pull the shared code out into a method that accepts Longs and Doubles and returns a double.",567385363,2016-12-01 01:09:45
19279790,7111,90715473,40,"while we are at it, should we add:
```scala
def +(that: Double): AveragedValue = AveragedValue(count + 1L, ....)`
def +[N](that: N)(implicit num: Numeric[N]): AveragedValue = this + (num.toDouble(that))
```",569558650,2016-12-03 04:37:29
19304005,44018,90279013,26,"good call, added it back.",567941383,2016-12-01 01:08:19
19304005,44018,90263809,54,we've got a few!,567941383,2016-12-01 00:02:39
19304005,44018,90263748,46,"they've got dropdowns for all combinations on the top right of the page... so good, and way easier to keep relevant.",567941383,2016-12-01 00:02:32
19304005,7111,90271951,26,Should we remove the mailing list entirely? Seems like some might still prefer it.,567941383,2016-12-01 00:37:09
19304005,44018,90263615,5,"this is in seconds, which means the badge only refreshed once per month! This drops the timeout to 1 hour.",567941383,2016-12-01 00:02:11
19337958,32008959,90536770,4,this is hurting our coverage!,568597898,2016-12-02 05:03:57
19337958,11097008,90552988,10,aren't you ignoring `size`?,568597898,2016-12-02 06:37:24
19337958,11097008,90553077,9,can we put a narrow return type on this? Maybe `BufferedReduce[T]`?,568597898,2016-12-02 06:37:53
19337958,44018,90524875,4,gotta increase the coverage!,568817068,2016-12-02 03:57:51
19390076,44018,91866139,27,"It instantiates the dense representation in the lazy Val. I wonder if some but gets flipped? If so seems like a regression in 2.12, but one that doesn't affect the behavior. Maybe we should make a minimal test case to see if this is true for all classes w",573687318,2016-12-12 05:39:52
19488881,32008959,91093838,21,"Another ask - could we serialize a couple of examples and put a base64-encoded string of the bytes into the test, so that we can guarantee that the serialization doesn't change? I can see us making a change here that wouldn't break the tests, but would br",572200159,2016-12-06 22:57:25
19488881,32008959,91093614,16,"would you mind converting this to a scalacheck test? Something like

```scala
property(""SpaceSaver serializes properly"") { ss: SpaceSaver[String] =>
  val spaceSaverAsArrayByte = SpaceSaver.toBytes(ss, stringToArrayByte)
  SpaceSaver.fromBytes(spaceS",572200159,2016-12-06 22:56:21
19488881,28847,91104179,16,"Will do. I wanted to do it, but before I wanted to be sure the PR could be accepted ???? ",572200159,2016-12-06 23:43:44
19488881,7111,91313273,94,`case f@Failure(_) => return f` would avoid an allocation.,572771040,2016-12-07 23:17:36
19488881,7111,91312722,72,Couldn't other operations on `bb` throw? I think we need an outer Try to catch those exceptions too (or use a try/catch block inside the method.,572771040,2016-12-07 23:15:09
19488881,7111,91313885,38,"Can we also add a test that exercises Failure? Like pass an empty array, and see that you get Failure not an exception thrown.

So basically: `forAll { a: Array[Byte] => ` deserialization does not throw? You get Success or Failure.",572771040,2016-12-07 23:20:22
19488881,7111,91312982,103,Why do you need Try here rather than just Success? Could this throw?,572771040,2016-12-07 23:16:19
19488881,28847,91323995,103,"True, I changed it",572771040,2016-12-08 00:01:12
19488881,28847,91323980,38,Done,572771040,2016-12-08 00:01:09
19488881,28847,91324014,72,You're right. I've changed it,572771040,2016-12-08 00:01:15
19488881,28847,91324006,94,Won't compile. One is a `Try[T]` the other is a `Try[SpaceSaver[T]]`,572771040,2016-12-08 00:01:14
19488881,28847,91253517,71,Changed,572855635,2016-12-07 17:24:02
19488881,44018,91580563,38,"Pending this one change this looks great to me! @ElPicador, thanks for responding to these rounds of feedback. With this extra test the new serde code will have 100% coverage :)",572771040,2016-12-09 02:50:37
19488881,32008959,91753195,38,"oh, sorry, I was thinking of the test that @johnynek requested.",572771040,2016-12-10 00:56:48
19488881,28847,91681206,38,@sritchie I'm not sure to understand what change you are talking about. ,572771040,2016-12-09 17:19:35
19493994,7111,91197394,6,can we do `conf = $conf` etc.. so it is valid scala code?,572281072,2016-12-07 07:33:18
19637705,7111,91872339,246,Let's try to see if we can just jump Successible and Predecessible up to Ordering. I can't think of a good reason to have Partial there.,574166784,2016-12-12 09:18:56
19637705,7111,91872225,21,Think we need a test for mapNonDecreasing.,574166784,2016-12-12 09:16:05
19637705,7111,91872211,11,Let's make apply and `&&` final,574166784,2016-12-12 09:15:40
19637705,7111,91873052,21,"So a law might be: forAll intervals and values t, if we map t and the interval, contains returns the same value.

To make the function non-decreasing we will need to do something like make a new fn and apple the first and if the result is less return th",574166784,2016-12-12 09:35:50
19637705,11097008,92068966,227,don't need `ord` now that `Successible` has an Ordering right?,574434138,2016-12-13 07:53:45
19637705,44018,92069044,21,done,574166784,2016-12-13 07:54:21
19637705,44018,92069032,11,done,574166784,2016-12-13 07:54:15
19637705,11097008,92069379,5,"similar: `next(t).map(ordering.lt(t, _)).getOrElse(true)`",574434138,2016-12-13 07:56:44
19637705,11097008,92069013,236,"we don't need `ord` here, right?",574434138,2016-12-13 07:54:07
19637705,11097008,92069178,5,"this can be more succinct now: `prev(t).map(ordering.lt(_, t)).getOrElse(true)`",574434138,2016-12-13 07:55:16
19672635,69841,92471585,5,"Thank you for the feedback.

I'm not sure that I follow completely. Do you mean changing the signature to: `def apply[Hash128[A]](numEntries: Int, fpProb: Double)`?

And I guess that by number 2 you mean making those changes to the definitions in `alg",574911795,2016-12-15 03:37:56
19672635,7111,92498627,5,"change apply to:

```scala
def apply[A](numEntries: Int, fpProb: Double)(implicit hash: Hash128[A]): BF[A] = ...
```",574911795,2016-12-15 05:56:50
19672635,7111,93668445,25,can we keep these `seed` APIs and make the passed `seed` the `defaultSeed` of the instance? I think that will keep the old behavior.,580482343,2016-12-23 01:54:03
19672635,7111,93668677,52,"I think we should rename `seed` to `defSeed` to avoid a collision in names below, and it should be the `defaultSeed` for the instance created.",580482343,2016-12-23 01:55:38
19672635,7111,93668968,96,let's make this `BF[T]`,580482343,2016-12-23 01:57:27
19672635,7111,93668053,16,this should be `val defaultSeed = self.defaultSeed`,580482343,2016-12-23 01:51:36
19672635,7111,93668949,92,let's make this `T: Gen: Hash128`.,580482343,2016-12-23 01:57:17
19672635,7111,93669419,26,"I don't think you need this here. This is not an implicit conversion anymore, but an instance for the typeclass `Hash128[A]`. For String, Long, Array[Byte], Int you don't need to do anything. (As a side note: we should implement a macro to do this for cas",580482343,2016-12-23 02:00:08
19672635,7111,93668885,71,can we make this `BF[T]` and make the type: `[T: Gen: Hash128]`?,580482343,2016-12-23 01:56:56
19672635,7111,93668188,6,"can we make this `def defaultSeed: Long`? we can override a `def` with a val, but vals in traits have some strange issues (init order bug) and we just try to avoid them unless there is a compelling reason.",580482343,2016-12-23 01:52:27
19672635,7111,93667097,5,can we add the return type to this method please (while we are cleaning up).,580482343,2016-12-23 01:45:04
19672635,69841,93681560,26,Aha. I see. I had missed specifying the type for `BloomFilterMonoid` here which meant that I god a compilation error about multiple type classes matching. But specifying the type solved that.,580482343,2016-12-23 03:21:07
19672635,7111,92270411,5,"what I would rather do is this:

1. use `Hash128[A]` here.
2. change `Hash128[K]` to have:
```scala
trait Hash128[K] {
  def hashWithSeed(seed: Long, k: K): (Long, Long)
  def hash(k: K): (Long, Long) = hashWithSeed(Hash128.DefaultSeed, k)
}
```",574911795,2016-12-14 05:29:01
19672635,69841,92550585,5,:+1:,574911795,2016-12-15 14:21:32
20136695,622449,95046127,35,it's ok to mutate the passed in array?,591199830,2017-01-07 08:56:52
20136695,622449,95045924,9,"in scala, is xs.toArray a no-op? xs will already be an array right?",591199830,2017-01-07 08:53:55
20136695,622449,95045975,13,does CBitSet take a size hint or anything like that?,591199830,2017-01-07 08:54:34
20136695,622449,95046080,33,what does `cb.type` do here? ,591199830,2017-01-07 08:56:12
20136695,7111,95047192,9,"I don't really know the details, but `Int*` has type `_*[Int]` or something, which is a seq, but not an Array as far as I know.",591199830,2017-01-07 09:16:02
20136695,7111,95047238,13,not the examples I see from their code. It is doing compression of the differences between the indices. I don't see immediately how such a hit would be used.,591199830,2017-01-07 09:16:52
20136695,7111,95047270,33,"`cb.type` means you are returning literally `cb`. So this lets you see that though it is mutated, the return value is the mutated thing.",591199830,2017-01-07 09:17:28
20136695,7111,95047330,35,"In general, I'd say no, but since this is just a little convenience class for this code, and we only pass `Arrays` below that are ephemeral, I think it is okay.",591199830,2017-01-07 09:18:43
20136695,622449,95048132,33,"oh, that's neat",591199830,2017-01-07 09:34:21
20136695,622449,95048152,33,so it guaruantees that the passed in cb will be `eq` to the return value? ,591199830,2017-01-07 09:34:48
20136695,622449,95048163,35,ok,591199830,2017-01-07 09:35:01
20136695,7111,95048194,33,yes. And the compiler verifies that.,591199830,2017-01-07 09:35:39
20265538,7111,95242246,17,can you add this to `abstract class BF[A]` instead? I'd rather have `a.hammingDistance(b)`.,594107207,2017-01-10 04:46:31
20265538,7111,95241849,50,can you write `> 0` here?,594107207,2017-01-10 04:44:34
20265538,7111,95241776,43,"can we do: `forAll { (a: BF[String]) => BloomFilter.hammingDistance(a, BFZero) == a.numBits }`?",594107207,2017-01-10 04:44:09
20265538,7111,95242311,50,"also `<= width`, right?",594107207,2017-01-10 04:46:56
20265538,7111,95242026,113,"can you add the `createBFWithItems(List())` case as well, just to test emptiness again?",594107207,2017-01-10 04:45:38
20265538,7111,95241591,19,this branch is untested. I think we need to generate `BFZero` in the test. Can you explicitly add some tests there?,594107207,2017-01-10 04:42:59
20265538,7111,95523042,13,Do we really need this assert? The code below does not seem to actually require it.,594812842,2017-01-11 15:21:50
20265538,550921,95633626,13,I wonder how frequently this method will be used. If not frequently then may be this should go into the companion object to avoid cluttering the base class. ,594812842,2017-01-12 01:54:48
20265538,550921,95633794,78,"extra ""should""",594812842,2017-01-12 01:55:38
20265538,550921,95633709,45,"Extra ""the"".",594812842,2017-01-12 01:55:16
20265538,550921,95636646,19,Note that this can be made more efficient. BFZero and BFItem can be handled specially and underlying compressed bitmap of BFSparse has a xorCardinality method that avoids intermediate allocations. ,594812842,2017-01-12 02:10:06
20265538,550921,95633853,102,"Extra ""compute"".",594812842,2017-01-12 01:55:57
20265538,69841,95646215,13,"I'd be happy to move this anywhere you think it should go. I started out keeping it in the `BloomFilter` and I can place it back in there, or move it to the `BF` companion object if you prefer that. ",594812842,2017-01-12 02:56:22
20725745,69841,98017031,28,Good point. I've removed it.,604504577,2017-01-26 23:27:59
20725745,550921,97659151,28,This import seems redundant.,604504577,2017-01-25 05:48:31
21009698,6636815,99414655,13,curious as to why this is extending Ring? can we not just extend Rig? Maybe document the rationale? ,611255971,2017-02-04 04:17:10
21009698,6636815,99414671,27,here too?,611255971,2017-02-04 04:17:18
21009698,6636815,99414015,37,s/z/zero?,611255971,2017-02-04 04:13:20
21009698,7111,99417719,40,"then whe we override `zero` below you have the chance for confusion (in fact, you can create an infinite loop if you are not careful).",611255971,2017-02-04 04:35:46
21009698,6636815,99429667,40,ah yeah :-),611255971,2017-02-04 05:49:02
21009698,310250,99888278,64,Did you mean to have the implicit parameter be `Rng[V]` here?,612538541,2017-02-08 02:08:19
21009698,310250,99888311,70,Same here.,612538541,2017-02-08 02:08:25
21009698,7111,99896087,64,"sadly no, because algebra does not use the import-to-get-instances style. If we did that it would break source compatibility for people that expect to get Map rings.",612538541,2017-02-08 02:42:29
21009698,6636815,99408459,40,leave the name as zero?,611255971,2017-02-04 03:42:41
21486014,6636815,101851489,7,should we just delete this line? and the two other commented ones?,620184079,2017-02-18 05:32:42
21486014,7111,101862476,7,"I left them to make it easier in the future since we will, probably, turn it off again.",620184079,2017-02-18 06:43:50
23068263,7111,109586852,31,what is up with the `IS`?,661884164,2017-04-04 13:40:04
23068263,7111,109586827,20,"don't need to capture `sem`. `Semgroup.plus(a, a)` would work.",661884164,2017-04-04 13:39:48
23068263,7111,109587117,7,"let's not comment out algebirdSpark. It is a pain that `2.12.x` won't build, but CI knows about it. Can build with `sbt ++2.11.8 compile` on the command line.",661884164,2017-04-04 13:42:24
23068263,34304635,109734661,7,"Will change, didn't mean to commit this. Cool, I'll build that way.",661884164,2017-04-05 00:58:33
23068263,34304635,109734892,31,"I'll change these, I got into doing that as a note-to-self.",661884164,2017-04-05 00:59:32
23068263,34304635,109734934,20,"???? 
",661884164,2017-04-05 00:59:44
24984884,32008959,121257396,55,looked like we don't have a test yet that exercises the `zero`.,703587282,2017-06-10 20:29:08
24984884,32008959,121257409,56,"is there a sumOption implementation that would be more efficient that we should add here as well, for adding multiple curves at once?",703587282,2017-06-10 20:30:14
24984884,32008959,121257384,33,"do you want to take the two points directly instead of using this assertion, head, last combo?",703587282,2017-06-10 20:27:53
24984884,32008959,121257443,35,can we use the monoid laws?,703587282,2017-06-10 20:32:30
24984884,32008959,121257420,82,we never call this without default args - should we remove the default 100?,703587282,2017-06-10 20:31:03
24984884,32008959,121257455,25,if you add an object with an `implicit def monoid: Monoid[Curve] = CurveMonoid` you won't need to declare the same in the tests.,703587282,2017-06-10 20:33:20
28178070,7111,136638743,14,why is this change made?,773293885,2017-09-02 01:28:31
28178070,7111,136639427,4,"there is an option for inlining from the sources. Can we change to that?
How about:
https://gist.github.com/retronym/29932ea76712ff374d1363c9eda6eabe

`-optimize -opt-inline-from:com.twitter.algebird.*` or something, so we can inline from the current ",773293885,2017-09-02 01:32:10
28178070,12052552,136770006,14,"I had a problem with ```%%``` which instructs sbt to substitute current scala version to artifact name so I set the version of spark-core by myself, leaving the library version.
```
[warn] 	::::::::::::::::::::::::::::::::::::::::::::::
[warn] 	::     ",773293885,2017-09-04 15:38:12
28178070,12052552,136782016,4,"There is an option ```-opt:l:project``` which seems like the one that can be used, however it requires some research. For basic testing, it looks like it doesn't break binary compatibility.",773293885,2017-09-04 16:37:39
28178070,7111,137053940,14,"We have to leave this as is, or we can't publish this module for 2.10 and 2.11. Note this here:

https://github.com/twitter/algebird/blob/develop/build.sbt#L255

should prevent spark from being set up for 2.12.",773293885,2017-09-06 00:02:06
28178070,37792,137075180,4,"`-opt:l:project` is also deprecated in 2.12.3, I recommend upgrading to 2.12.3 and using `-opt:l:inline` with `-opt-inline-from:com.twitter.algebird.**`",773293885,2017-09-06 01:24:09
28449133,11097008,137905292,4,can we add this for `Monoid` and `Group` too?,778980923,2017-09-09 05:53:27
28449133,11097008,137905415,7,what is countminsketch got to do with anything here?,778980923,2017-09-09 05:54:36
28449133,11097008,137906437,5,"why was this added here. Seems a weird way to test bigdecimal?

Can we instead add a file like `NumericAlgebraTests.scala` that has something like:
```scala
class NumericAlgebraTests extends CheckProperties {
  property(""test bigdecimal"") {
    // c",778980923,2017-09-09 06:04:28
28449133,41405,137907260,4,they're already there... this was the one gap,778980923,2017-09-09 06:12:41
28449133,41405,137907338,5,yeah... I wanted to add _something_ as a test... even if it was crude... I'll add this instead,778980923,2017-09-09 06:13:26
28449133,41405,137907464,7,copy-pasta... I didn't read at all but it comes directly from `def testBatchedMonoid`,778980923,2017-09-09 06:14:43
28449133,41405,137911027,22,"This one keeps failing for me with errors like ```
[info] NumericAlgebraTests:
[info] - test int
[info] - test bigdecimal *** FAILED ***
[info]   GeneratorDrivenPropertyCheckFailedException was thrown during property evaluation.
[info]    (CheckPrope",779005191,2017-09-09 06:57:31
28449133,7111,137913954,22,"it may not be distributive

did you check?

Float and Double are not.",779005191,2017-09-09 07:51:11
28449133,41405,137914137,22,"when I test with
```
scala> def foo[T](a: T, b: T, c: T)(implicit rng: Numeric[T]) = {
     |     Equiv[T].equiv(rng.times(a, rng.plus(b, c)), rng.plus(rng.times(a, b), rng.times(a, c))) &&
     |     Equiv[T].equiv(rng.times(rng.plus(b, c), a), rng.p",779005191,2017-09-09 07:56:28
28449133,41405,137914352,22,"ahhh... it's rounding errors
```
scala> val a = BigDecimal(1.627209798210513)
a: scala.math.BigDecimal = 1.627209798210513

scala> val b = BigDecimal(""606303697535274687"")
b: scala.math.BigDecimal = 606303697535274687

scala> val c = BigDecimal(""-",779005191,2017-09-09 08:03:10
28449133,7111,137914537,22,"you can set up a custom `Equiv` instance:

```scala
implicit val closeEnough: Equiv[BigDecimal] = new Equiv[BigDecimal] {
  val eps = BigDecimal(1e-10) // or something.
  def equiv(a: BigDecimal, b: BigDecimal) = 2 * (b - a).abs / (b.abs + a.abs) < e",779005191,2017-09-09 08:08:15
28449133,41405,137917773,7,@johnynek: This may not be a good idea. I can go into it but when you add two BigDecimals that have sufficiently different scales it is possible to lose precision. And when testing out the distributive properties of rings the way in which the precision is,779090616,2017-09-09 11:00:33
28449133,7111,137930884,7,"This is fine, but can we do the biggest scale we can do with the tests passing consistently? Would 24 work for instance?",779090616,2017-09-10 00:14:23
28623296,7111,138767918,4,these numbers were invalid doubles and 2.12.3 won't parse them. scala 2.11 I think parses them to 0.0.,782853660,2017-09-14 06:48:49
28623296,7111,138768013,16,make sure we are only inlining from the local project. I *think* this is the correct invocation.,782853660,2017-09-14 06:49:29
28623296,37792,138805528,16,"you **also** need the `-opt:l:inline` flag, `-opt-inline-from` alone doesn't enable the optimizer, it just configures it.",782853660,2017-09-14 13:21:38
29386351,7111,142546309,4,this is a weird style anyway...,799078240,2017-10-04 06:02:00
34075243,7111,164153893,44,Let’s not use this m. You can get the zero from the p by case matching.,898918140,2018-01-27 00:19:20
34075243,2523602,164167236,30,"This looks great! What do you think about allowing user to pass a `PriorityQueue` instead of just a Queue (AFAIK scala PQ doesnt extend Queue). The way code is written right now, its implying that I need a commutative monoid to guarantee deterministic beh",898918140,2018-01-27 01:08:25
34075243,2523602,164168058,63,Not sure if its possible to do it in this implementation but it would be nice to generalize how elements are evicted from the window. Right now it seems like I can only do fixed windows but I would really like to do time based rolling windows as well. For,898918140,2018-01-27 01:12:04
34075243,7111,164191098,30,"actually, I think `Window[T](total: T, items: Queue[T])` is better. We don't really want people to do something like `Window(100)` do we? that will have no items in the queue, and I imagine break the laws.",898918140,2018-01-27 02:47:02
34075243,40888923,164198757,30,"If you look at `items`, it fills in the queue if none was provided, i.e meant for initialization. The intent is to have a simple interface where you can wrap a window around a single object and sum in a sensible way:
```
implicit wm = WindowMonoid(2)
",898918140,2018-01-27 03:17:04
34075243,40888923,164203198,63,"My thought was to eventually have two classes/monoids, based on whether we want aggregations over fixed items or fixed time.

```
// Monoid defines aggregation for fixed window length, e.g. last 28 elements. Queue fixed to 28.
case class Window[T](tot",898918140,2018-01-27 03:35:15
34075243,2523602,164203965,63,"That seems reasonable but I am still not sure why we cant use `ProrityQueue` instead of `Queue`? As a user I would like to control the ordering and if I am passing you a PQ, I can do that by specifying my own comparator  ",898918140,2018-01-27 03:38:31
34075243,7111,164935741,54,"what about a
```scala
  def fromIterable[T](ts: Iterable[T]): Window[T] = {
    val monT: Monoid[T] = p.join
    val right = ts.toList.takeRight(windowSize)
    val total = monT.sum(right)
    Window(total, Queue.empty[T] ++ right)
  }
```
",903205983,2018-01-31 09:58:48
34075243,7111,164935078,16,"can we have a second one:
```scala
forAll { (ts0: List[Int], ts1: List[Int], n: Int) =>
  val expected = Queue((ts0 ::: ts1).takeRight(n): _*)
  val mon = new WindowMonoid(n)
  val got = mon.plus(Window(ts0.sum, Queue(ts0: _*)), Window(ts1.sum, Queue",903205983,2018-01-31 09:53:37
34075243,7111,164934588,96,can you make this a scaladoc comment on the case class?,903205983,2018-01-31 09:49:57
34075243,7111,164936976,60,"I think you can optimize `sumOption` somewhat here: you can take blocks of data and ignore the left if the right is full. PS: scalding uses this if it exists, so overridding sumOption on Semigroup (or any subclass) can be a very nice performance win on ma",903205983,2018-01-31 10:08:28
34075243,7111,164935179,41,can you add more comment to this javaDoc param?,903205983,2018-01-31 09:54:15
34075243,40888923,165271853,60,@johnynek: Overwrote sumOption below.,903205983,2018-02-01 14:52:22
34075243,40888923,165271870,16,Done,903205983,2018-02-01 14:52:31
34075243,40888923,165271974,54,"@johnynek: I did this, and generalized to `Traversable`.",903205983,2018-02-01 14:53:18
34075243,7111,165273393,138,.empty is more efficient since you avoid allocating the varargs wrapper.,904659174,2018-02-01 15:04:29
34075243,7111,165273567,142,Using fromTraversable here is ignoring that you already have a queue. I think summing the queue and reusing it will be a significant performance improvement ,904659174,2018-02-01 15:06:03
34075243,7111,165273826,65,Can we use Iterable? Scala 2.13 is changing the collections to avoid Traversable: https://www.scala-lang.org/blog/2017/02/28/collections-rework.html#traversable-and-iterable,904659174,2018-02-01 15:07:59
34075243,7111,165857744,85,for performance (not calling fold on each plus call) we are probably better to have two subclasses of `WindowMonoid` which could be an abstract class. We can decide once when we allocate which path to choose. Then the jit should be able to inline both ins,905388438,2018-02-05 05:02:36
34075243,7111,165857661,82,can we make this a `val` so we don't have to do the computation and allocation again on each call?,905388438,2018-02-05 04:59:58
34893337,7111,167924318,8,Same comments as above.,916561798,2018-02-14 00:38:07
34893337,7111,167924235,7,"Can you also test this for a custom type that does not have a special instance defined?

Also, scala has .max on Iterable. Can we just use that rather than sorted.last?",916561798,2018-02-14 00:37:49
34893337,1233114,167973774,7,Done.,916561798,2018-02-14 03:25:09
35303101,17013,170018131,139,"It's probably possible to geek out on this even further, but this looks good to me for now.",924043590,2018-02-23 00:36:54
35460306,7111,171385455,8,can you put this on the companion object? that should preserve binary compatibility and we can release it in the 0.13 branch.,927246354,2018-03-01 05:08:11
35460306,7111,171386224,26,"if you implement this as a private method on the companion that matches the case class we have, I think we can make this binary compatible.

```scala
private def buildArrayMulti[H](h: MinHasher[H], hasherbuffers: Seq[Array[Byte]])(fn: Seq[H] => H): Arr",927246354,2018-03-01 05:11:12
35460306,9172187,171626258,26,"Thanks for reviewing.  Actually, buildArrayMulti is an abstract method called by  calls other buildArray virtual method.  If I move it to companion object, I'll have to move all of them to companion object.  Does it make sense to extend MinHasher32 and im",927246354,2018-03-02 01:04:43
39213505,35946362,187728182,15,Nitpick: there are [two ways](https://github.com/milessabin/shapeless/issues/233) to spell the h-word but this isn't one of them. ???? ,1006888289,2018-05-12 03:44:55
39213505,35946362,187728792,1,"I know (from experience) that people are going to complain about the following not doing what you might expect:
```scala
import com.twitter.algebird._
import shapeless._
```

I'd probably call the package `generic` or `derivation` to avoid the whole",1006888289,2018-05-12 03:47:34
39213505,35946362,187727144,8,Isn't it usually the tail where you need to worry about the divergence checker?,1006888289,2018-05-12 03:40:07
39213505,35946362,187733592,11,"I find the following little confusing. Given:

```scala
import com.twitter.algebird.Monoid
import shapeless.{ ::, HNil }

abstract class Base { def x: Int }
case class Foo(x: Int) extends Base
object Base {
  implicit val baseMonoid: Monoid[Base]",1006888289,2018-05-12 04:07:56
39213505,7111,187734552,8,"yeah, not really sure that is needed at all... probably insufficiently reviewed internally.

Should we add the Lazy if it is not needed? I really don't know when it is (e.g. it must not be here, since we are not using it on the tail).",1006888289,2018-05-12 04:12:39
39213505,35946362,187734628,8,@oscar I think this might be causing the failures on 2.10? Checking now…,1006888289,2018-05-12 04:13:01
39213505,7111,187734674,11,"how did you even discover that?

I'll add a test and try to fix it.",1006888289,2018-05-12 04:13:16
39213505,7111,187734810,1,"yeah, I hit this myself. Generic would be consistent with circe, right? derivation is your custom macros, right?",1006888289,2018-05-12 04:13:47
39213505,35946362,187736050,1,"Yeah, `generic` would be consistent with circe, and I think it'd have my vote.",1006888289,2018-05-12 04:19:48
39213505,35946362,187737607,8,"Hmm, swapping the `Lazy` from heads to tails everywhere doesn't fix 2.10. Taking a look now.,",1006888289,2018-05-12 04:28:09
39213505,35946362,187739978,8,Removing the `Lazy` altogether makes at least the `Semigroup` one compile. My guess is some lingering version of [this bug](https://github.com/milessabin/shapeless/issues/367)—I can try to minimize this weekend and open a Shapeless issue.,1006888289,2018-05-12 04:41:44
39310487,7111,188149788,29,"@ianoc can you double check this? This triggered a warning in scalac (which we ignored), but it looks like we intended to increment the count, but lost the `v`. What do you think?

I guess this means this cache was always pruning...",1009086670,2018-05-15 09:26:52
39310487,32164772,188150048,29,"ouch, yeah this change looks right/looks like a bug. ",1009086670,2018-05-15 09:29:08
39311788,2523602,188163797,30,"Not sure about all the `HList` stuff but this seems like a combinator on `ApplicativeAggregators`. I would think that if I have:

```scala
val a: MonoidAggregator[Animal, ColorStats, Result] = ...
val b: MonoidAggregator[Animal, ShapeStats, Result]= .",1009098313,2018-05-15 11:40:28
39311788,2523602,188163932,41,"Same comment as above, why cant be implement this as a combinator using ApplicativeAggregators?",1009098313,2018-05-15 11:42:06
43435578,7111,207381458,5,minor nit: `val builder`?,1089433955,2018-08-03 04:31:31
1235069,64314,3271220,14,"wow, a project that doesn't depend on gauva!",35821771,2013-03-07 05:37:24
1249680,64314,3344042,19,log enough at debug level so that we could debug this in production if necessary,36382083,2013-03-13 03:21:46
1425585,550519,4079277,11,I don't think we need this. Users should bring in their own slf4j implementation,39238076,2013-05-03 23:51:56
1425585,550519,4079297,35,trace of debug,39238076,2013-05-03 23:52:32
1425585,550519,4079294,23,log.debug or maybe trace instead. Don't really want to see this flooding logs. Same for the others,39238076,2013-05-03 23:52:30
1425585,550519,4079299,35,or*,39238076,2013-05-03 23:52:37
1425585,550519,4079304,44,trace or debug,39238076,2013-05-03 23:52:45
1425585,550519,4079315,20,"log.debug? same for the rest of these.
We might also want some more information about the request for these, esp the signature",39238076,2013-05-03 23:53:27
1425585,550519,4079319,26,"Debug?
Some information about the request would be nice (like the normalized request/signature base string. I think thats provided to you in OAuth1Request)",39238076,2013-05-03 23:53:32
1425585,550519,4079317,23,"Debug?
Also probably want information like the current timestamp/timestamp window ",39238076,2013-05-03 23:53:30
1425585,882312,4081184,11,"I need to bring in the dependency to use the logging classes. Are you talking about the ""slf4j.version"" property or the entire dependency?",39238076,2013-05-04 01:49:52
1425585,550519,4081452,11,i'm talking about the dependency on slf4j-simple. Depending on slf4j-api should be enough,39238076,2013-05-04 02:09:07
1425585,882312,4081850,11,"will remove. I needed it to test the output, but you're right. It's not needed to compile/test.",39238076,2013-05-04 02:33:56
1425585,550519,4101183,12,"should be static: 

Object StandardUnpacker {
  private val log = LoggerFactory.getLogger(getClass)
  ...
}",39422458,2013-05-07 01:42:22
1425585,882312,4102345,13,fixed.,39422458,2013-05-07 02:40:57
1425585,550519,4102523,12,private?,39842914,2013-05-07 02:49:54
1425585,550519,4102527,14,private?,39842914,2013-05-07 02:50:03
1425585,882312,4104008,14,done,39842914,2013-05-07 04:25:33
1425585,882312,4104001,12,done.,39842914,2013-05-07 04:25:25
1425585,550519,4101184,13,should be static,39422458,2013-05-07 01:42:26
1425585,882312,4102361,12,fixed.,39422458,2013-05-07 02:41:50
1431304,550519,4101203,16,Is ACCESS_TOKEN defined somewhere? We can probably take it out if we're not using it anywhere anymore,39414482,2013-05-07 01:43:19
1431304,550519,4101291,55,/s/ACCESS_TOKEN/BEARER_TOKEN/,39414482,2013-05-07 01:47:10
1621282,550519,4787405,13,"I think we should include a test case where there's a request body in GET, which we would now accept. Can we also rename paramsInPost to paramsInRequestBody or something?",46387258,2013-06-20 05:16:00
1621282,14240,4800872,13,I'll rename the params and add a test. Thanks for reviewing.,46387258,2013-06-20 21:37:11
1649246,64314,4899392,26,i prefer using unicode escapes sequences instead (eg \uXXXX),47416811,2013-06-26 23:58:14
1649246,64314,4896845,14,"my guess is that a decent percentage of the time the string is all isUnreserved chars. How about a quick loop through to check if it is and only do the expensive String.getBytes if its not? (and if its not, you should just to basically jump right to the r",47204786,2013-06-26 22:30:07
1649246,550519,4899011,14,done,47204786,2013-06-26 23:44:40
1649246,550519,4901016,26,done,47416811,2013-06-27 01:02:32
2237393,550519,6897524,62,might as well move the timestamp validation before the nonce validation,59291684,2013-10-11 00:19:25
2237393,550519,6927597,7,"instead of dealing with null, can we make this an Option instead?",63583314,2013-10-12 02:42:25
2237393,550519,6927950,5,Verifier?,63583314,2013-10-12 02:59:19
2556120,64314,8171491,9,shouldn't this stay joauth?,74267773,2013-12-07 02:47:23
2556120,64314,8171518,27,"add `<scope>test</scope>`

oh right i can read diffs that aren't side by side. sorry about that.",74267773,2013-12-07 02:48:25
2556120,64314,8171579,127,isn't this the default for a maven project? (not sure),74267773,2013-12-07 02:50:02
2556120,1490238,8171753,9,"yes, changing.",74267773,2013-12-07 02:54:43
2556120,1490238,8171799,27,"guava is needed at runtime.

scala needed only for test. It is already in test scope. I think the diff is messed up, and hard to read.",74267773,2013-12-07 02:56:21
2556120,12202,8173211,27,If we are just depending on guava for com.google.common.io.BaseEncoding... how about we just avoid it the extra dependency?,74267773,2013-12-07 03:44:10
2556120,1490238,8173819,27,"Yes, we only need BaseEncoding. How do I remove extra dependency? exclude?

I looked at the guava pom, it only depends on one.

https://code.google.com/p/guava-libraries/source/browse/guava/pom.xml
",74267773,2013-12-07 04:05:12
2556120,12202,8173867,27,"I was just suggesting to use JDK classes to avoid bringing in another dependency.

It's up to @kevinoliver though if he doesn't mind the extra dep",74267773,2013-12-07 04:06:53
2556120,1490238,8174000,27,It is not available in JDK now. I think they plan to add it in jdk8.,74267773,2013-12-07 04:12:13
2556120,1490238,8174014,127,"ya, removing.",74267773,2013-12-07 04:12:41
2556120,64314,8174769,6,rm blank line,74267773,2013-12-07 04:39:28
2556120,64314,8174784,149,do encode/decode need to be public?,74267773,2013-12-07 04:39:50
2556120,64314,8174880,51,"2 choices — rm since this is commented out? or fix it to not be a lie ;) i think you can do:

StringBuilder.setLength(0);
StringBuilder.trimToSize();",74267773,2013-12-07 04:42:34
2556120,64314,8174902,97,nitpick: append('='),74267773,2013-12-07 04:43:11
2556120,64314,8174999,92,should this sig return just List<> instead of ArrayList?,74267773,2013-12-07 04:46:37
2556120,64314,8175020,125,i think the comment's indentation is off ,74267773,2013-12-07 04:47:23
2556120,64314,8175045,235,indentation,74267773,2013-12-07 04:47:58
2556120,1490238,8175476,51,"I assumed setLength was resizing the underlying buffer. It seems not. So, this will work. I can make this change.

",74267773,2013-12-07 05:01:20
2556120,1490238,8175503,6,fixed,74267773,2013-12-07 05:02:18
2556120,1490238,8175573,149,I can make it package access.,74267773,2013-12-07 05:04:20
2556120,1490238,8175704,51,"It will be good to deploy the code without the StringBuilder pooling and measure the perf. Then, add pooling and see if it is really helping. Since, the buffers are not that big, we may not see a big gain. ",74267773,2013-12-07 05:07:55
2556120,1490238,8175726,97,fixed,74267773,2013-12-07 05:08:44
2556120,1490238,8175998,92,"I could. One more import :(, and I am not expecting a different List impl. ",74267773,2013-12-07 05:17:17
2556120,1490238,8176070,125,fixed,74267773,2013-12-07 05:19:31
2556120,1490238,8176081,235,fixed,74267773,2013-12-07 05:19:59
2556120,64314,8177410,51,"fwiw, i think we want to focus on minimize object allocations more than strict performance here. but i am fine with that approach.",74267773,2013-12-07 06:15:03
2556120,64314,8177495,48,final for key and value please,74267773,2013-12-07 06:19:21
2556120,64314,8177520,94,this a bit sketchy since it public and therefore mutable. my rec: make this.params a List and then wrap the argument params in Collections.unmodifiableList,74267773,2013-12-07 06:20:24
2556120,64314,8177554,23,lol i keep reading this as `singer`,74267773,2013-12-07 06:21:59
2556120,64314,8177570,96,final for both,74267773,2013-12-07 06:22:45
2556120,64314,8177602,69,"i think these can be final? 

--fixed",74267773,2013-12-07 06:24:08
2556120,64314,8177614,193,"final

--fixed",74267773,2013-12-07 06:24:28
2556120,64314,8177625,270,"use an initial size of 4

--fixed",74267773,2013-12-07 06:24:45
2556120,64314,8177631,212,"Collections.singletonMap(x, y)",74267773,2013-12-07 06:25:12
2556120,64314,8177639,60,"just return Map instead

-- fixed",74267773,2013-12-07 06:25:33
2556120,64314,8177666,325,wellllll not exactly an npe,74267773,2013-12-07 06:26:35
2556120,64314,8177672,325,"maybe rename throwNullException to throwMalformedException ?

--fixed",74267773,2013-12-07 06:26:54
2556120,64314,8177721,52,"final for these?

--fixed",74267773,2013-12-07 06:29:07
2556120,64314,8177740,128,"String.equalsIgnoreCase? 

-- fixed",74267773,2013-12-07 06:29:43
2556120,64314,8177743,131,String.equalsIgnoreCase? ,74267773,2013-12-07 06:29:49
2556120,64314,8177754,147,"Collections.singletonList(quotedHandler)
-- fixed",74267773,2013-12-07 06:30:12
2556120,64314,8177770,170,"size this right: 1 + kvHandlers.size

--fixed",74267773,2013-12-07 06:31:23
2556120,64314,8177773,174,"same here

-- fixed",74267773,2013-12-07 06:31:31
2556120,64314,8177791,221,"Collections.emptyList

- fixed",74267773,2013-12-07 06:32:14
2556120,64314,8177796,226,"Collections.singletonList(kvHandler)

--fixed",74267773,2013-12-07 06:32:30
2556120,64314,8177804,214,"do this please (you already have a logger)

-- fixed",74267773,2013-12-07 06:32:49
2556120,64314,8177870,38,is this necessary? can we just call isUnreserved((char)b) ?,74267773,2013-12-07 06:36:05
2556120,64314,8177900,137,"since this is a library i feel like these should be should all be debug level logs wrapped behind isLoggable

-- fixed",74267773,2013-12-07 06:38:00
2556120,64314,8177909,39,private final,74267773,2013-12-07 06:38:28
2556120,64314,8177912,46,return List,74267773,2013-12-07 06:38:36
2556120,64314,8177925,64,use Map,74267773,2013-12-07 06:39:04
2556120,64314,8177929,57,private  final,74267773,2013-12-07 06:39:10
2556120,64314,8177934,68,List,74267773,2013-12-07 06:39:20
2556120,64314,8177936,83,rm?,74267773,2013-12-07 06:39:30
2556120,64314,8177952,105,final,74267773,2013-12-07 06:39:53
2556120,64314,8177958,198,"something is off with indents here or in javadoc

--fixed",74267773,2013-12-07 06:40:28
2556120,64314,8177964,196,"comment that it is not thread safe?

-- fixed
",74267773,2013-12-07 06:40:42
2556120,64314,8177981,31,"rm extra space after new

-- fixed",74267773,2013-12-07 06:41:19
2556120,64314,8177987,45,"final

-- fixed",74267773,2013-12-07 06:41:37
2556120,1490238,8178499,48,fixed,74267773,2013-12-07 07:09:20
2556120,1490238,8178527,94,fixed,74267773,2013-12-07 07:10:54
2556120,1490238,8178544,96,fixed both,74267773,2013-12-07 07:11:48
2556120,1490238,8178697,212,It is adding to the map from the parent class. not a singleton-map.,74267773,2013-12-07 07:21:27
2556120,1490238,8178933,214,it was printing the stack trace to console before. I was not sure if someone depends on that output.,74267773,2013-12-07 07:37:56
2556120,64314,8178949,214,"not a real api, so i think its fine to change. our clients don't rely on
that.


On Fri, Dec 6, 2013 at 4:38 PM, Manoj Cheenath <notifications@github.com>wrote:

> In src/main/java/com/twitter/joauth/Unpacker.java:
>
> > +        Request.ParsedReq",74267773,2013-12-07 07:39:16
2556120,1490238,8178981,38,I will add a todo. Dont want to change behavior with this change.,74267773,2013-12-07 07:42:13
2559675,550519,8209259,5,"i'd keep the test case with null and just add another with """"",74077715,2013-12-10 02:36:29
2559675,550519,8209268,5,"hmm, ifNonEmpty is already defined to ignore null, is this necessary?",74077715,2013-12-10 02:36:38
2559675,882312,8214818,5,"The problem is ifNonEmpty also ignores """" when we don't want it to.",74077715,2013-12-10 05:13:18
2559675,550519,8215074,5,"oh yeah ofc, sorry can't read code",74077715,2013-12-10 05:19:21
2562235,64314,8250880,13,"do we publish scala bindings? how about this instead:

`Written in Java, with minimal dependencies`",74092223,2013-12-11 05:43:52
2674230,64314,8489018,5,shouldn't this stay on snapshot until its released?,78122968,2013-12-20 06:45:27
2674230,1490238,8489117,5,"I want to release it, and use the released version in birdcage. What is the process for releasing? I already pushed 6.0.0 to sonatype",78122968,2013-12-20 06:49:53
6313118,64314,24835899,25,"i think this needs to be appended always (not in an else).

which in turn indicates that this is missing a unit test? or a test should fail with it written like this?",218960949,2015-02-18 00:45:17
6313118,912564,24836755,25,I don't think so.  The original string is only appended if a replacement is not appended.  I changed the original code and removed the toAppend local variable and inlined the other appends.  ,218960949,2015-02-18 00:55:04
6313118,64314,24837021,25,you're right. i misread it :/,218960949,2015-02-18 00:57:49
6313118,1490238,24855936,16,"We already know the first char in %. So, we have to only match the next two char. It may not make a noticeable difference in perf though. So, I am fine as is.",218960949,2015-02-18 04:30:43
42099,72943,917837,5,"Since we've defined ""Defensive Purpose"", I think it makes sense to use it here instead of leaving open what ""defensively"" might mean here. Although I just realized this in now a circular loop. :(
My intent was to have (a) and (c) included under ""defensive",4107769,2012-06-02 02:41:05
42099,72943,917847,14,"Left in heir language (just ""feel good"" language at this point) and removed the right to sublicense in favor of new article 5",4107769,2012-06-02 02:42:23
42099,72943,917874,16,Intended to remove the onus for enforcing the defensive purpose of IPA from the inventor (or worse heir) and make it automatic. This leaves the court to decide if Company or Assignee violated the IPA clauses in Section 2; if they did use patent offensivel,4107769,2012-06-02 02:46:56
371103,26920,403256,4,"Can you please revert this change? I'll update README.md with all the changes when I release the new version of twitter-text-{java,js,ruby}",1437122,2012-02-01 02:46:05
371103,485754,404826,4,Done :),1437122,2012-02-01 08:38:21
2431539,892499,7614028,5,"(without them) might be more clear as
Autolink url with embedded parentheses without linking surrounding parentheses",70552458,2013-11-13 08:04:51
25151,438572,425565,5,This regex is requiring an underscore for the suffix where there might be none,3723998,2012-02-08 05:21:01
27150,342886,438324,8,"I'm not sure these names are really meaningful to the operator. Any particular reason not to name ""SETTLE_BEGIN"" e.g. ""COPY_COMPLETED"" or ""UNBLOCK_WRITES"" instead?",3770410,2012-02-10 22:53:33
27150,342886,438330,9,"Same here, maybe ""UNBLOCK_READS""?",3770410,2012-02-10 22:54:48
49318,51152,561659,4,"Perhaps this should be an option for reload, rather than its own command?",4248795,2012-03-15 13:06:35
49318,449460,564671,4,"Yeah, that totally makes more sense. Done and pushed!",4248795,2012-03-16 00:43:11
25257,49146,385576,57,we should prevent against sql injection here and escape /* and */,3727186,2012-01-26 04:18:27
25257,342886,405097,63,"It would be good to include a sentinel here denoting this as an annotations comment. It could be as simple as a single character, e.g. ""/*~"" but it should not be ""!"" as that is already in use for MySQL's /*!12233 */ version-context comments. It would be g",3727190,2012-02-01 10:21:30
25257,342886,405108,64,"This makes the values very easy to sort out in shell but actually makes them somewhat awkward to parse otherwise. I'd love to actually see this be something more well-defined (especially around escaping) such as JSON, so that parsing it is more reliable/s",3727190,2012-02-01 10:31:46
25257,49146,414974,80,"if we're using JSON, then we need to properly escape keys and values to make sure they are valid json strings.",3727191,2012-02-04 01:03:52
25257,49146,421426,68,"I think you can just lift this method, and construct the JSON hash itself manually.",3727148,2012-02-07 06:34:51
25257,7153,424336,68,"Sure, if we prefer that I can do it. I just assumed we'd want an easy way of throwing away the extra code once we are on a newer version of Scala. By inserting the whole file we can just throw that away without making any code changes outside of an import",3727148,2012-02-08 00:55:56
48899,51152,560707,12,"Prefer format strings: ""blah%s-%d"".format(_, _)",4243051,2012-03-15 05:24:30
48899,51152,560714,14,Unnecessary type?,4243051,2012-03-15 05:25:37
48899,313605,560735,14,"Scala compiler fun. Without this, it curiously gets confused about which constructor applies. Previously, we used the 5 arg constructor of which there is exactly one, so it apparently was fine.",4243051,2012-03-15 05:29:00
48899,313605,560747,12,Done.,4243051,2012-03-15 05:30:51
49203,51152,561517,11,Is this synchronized method going to be in the hot path? Perhaps consider replacing the mutable HashMap with an unbounded Guava MapMaker?,4247255,2012-03-15 10:15:20
49203,51152,561519,16,"It's the factory getting memoized here, right?",4247255,2012-03-15 10:16:13
49203,313605,561586,16,"No, it is the AsyncDatabase that actually is cached.",4247255,2012-03-15 11:25:37
49203,313605,561684,11,"CacheBuilder seems like a good fit, but querulous seems to currently depend on a old version of Guava (r09). I'd rather we upgrade and use that, but I prefer defer to a separate change. The current approach is no worse than what we already use to memoize ",4247255,2012-03-15 13:24:58
64044,51152,594745,77,The name 'runnable' is overloaded... would prefer isRunnable.,4438741,2012-03-23 10:17:23
64044,51152,594754,133,"Rescue accepts a PartialFunction, so you can remove `e => e match {...}` and just use case statements in the body of the block.",4438743,2012-03-23 10:24:03
64044,51152,594756,144,"It would help to name future something that indicates that it is the 'unbounded time' future, as opposed to the future generated by 'within'.",4438743,2012-03-23 10:26:00
64044,51152,594764,148,This last check is unnecessary: un-rescued exceptions will be propogated anyway.,4438743,2012-03-23 10:30:55
64044,51152,594768,24,"To make a setting required, make it abstract instead:
`var workPoolSize: Int`",4438743,2012-03-23 10:34:00
64044,313605,596995,77,Done.,4438741,2012-03-23 21:47:02
64044,313605,596997,133,Done.,4438743,2012-03-23 21:47:23
64044,313605,597005,144,Added a clarifying inline comment.,4438743,2012-03-23 21:49:40
64044,313605,597010,148,Done.,4438743,2012-03-23 21:49:51
64044,313605,597078,24,Done.,4438743,2012-03-23 21:55:24
64600,313605,611748,1,"I have limited understanding of sbt (Scala newbie :)), but where are these versions being picked up from?",4447588,2012-03-28 01:51:13
64600,313605,611758,17,Please document what you are trying to do here.,4447588,2012-03-28 01:52:23
64600,313605,611777,9,I guess you are disabling all tests that require mysql? ,4447588,2012-03-28 01:54:27
64600,152910,611779,1,"an update-versions task in standard-project can generate this file, at least when this project is used in embedded mode in the birdcage.  when in detached mode in github, this file can just be edited directly by hand.  ",4447588,2012-03-28 01:54:33
64600,152910,611788,9,"Correct, there is no mysql running on the CI server, so these tests fail if executed in CI.",4447588,2012-03-28 01:55:24
64600,266686,612857,6,we can probably move this to the top of the file.,4447588,2012-03-28 06:20:41
72350,266686,623767,50,I would just use count here.,4599373,2012-03-30 03:49:22
72350,313605,623937,50,Done.,4599373,2012-03-30 04:36:21
1125379,51152,607531,23,This takes o(n) time... do we know how often the gauge is triggered?,21660347,2012-03-27 13:03:26
1125379,51152,607542,67,Would throwing Cancellation cause the ThreadLocal connection to leak?,21660347,2012-03-27 13:06:44
1125379,313605,607558,67,"No, because the wrapping FuturePool catches all exceptions and converts to Future.exception (i.e. Throws). That's why I thought the TODO should be okay for now.",21660347,2012-03-27 13:11:05
1125379,313605,607573,23,"Guess it would be however often Hummingbird polls, once a minute? ",21660347,2012-03-27 13:14:36
1125379,313605,607585,67,Added a comment about this in the code.,21660347,2012-03-27 13:17:04
1125488,87195,2037,5,i think Time.epoch is now the preferred way.,21661186,2011-02-16 14:09:31
50790,407044,566996,110,"ok, floating point precision changes can certainly lead to a difference of the old and new results, even with the same seeds, ok then!",4273028,2012-03-16 14:08:31
50790,187046,603759,110,"we never specify eta values in config which would underflow Java float's rep accuracy, and the value is generally up-casted to double when used, e.g. in CachingCVB0Mapper when constructing TopicModel instances.",4273028,2012-03-26 20:58:45
50790,187046,603768,110,p.s. Why doesn't Hadoop Configuration have setDouble/getDouble methods? :/,4273028,2012-03-26 20:59:45
50790,407044,604815,110,"I don't think we really need to worry about smoothing parameters  < 1.4E-45, so this shouldn't really be an issue, right?",4273028,2012-03-26 23:31:46
50790,407044,604822,5,"Should we not be calling this ""SNAPSHOT"" anymore, since we'll be actually calling it the ""0.7-T1"" release?",4273028,2012-03-26 23:32:35
50790,187046,605173,5,"I'm planning on using maven-deploy-plugin to automate deploy of all artifacts. The plugin has a special flag `updateReleaseInfo` which can be used to force release version (strip `-SNAPSHOT` from version strings):

http://maven.apache.org/plugins/maven-de",4273028,2012-03-27 00:21:39
50790,407044,605199,5,"your first plan may be just fine.  no need for formality here.  Linux kernel got by with emailed patches, and I hear that stuff is pretty stable. ;)",4273028,2012-03-27 00:27:04
63682,187046,588377,30,bah. Sad this can't be extracted from second arg. I'll test with this.,4432695,2012-03-22 04:43:35
74438,187046,628861,5,"quote vars, but avoid quoting globbing part of expression.",4643172,2012-03-31 03:19:14
74438,187046,628863,6,quotes here too,4643172,2012-03-31 03:19:30
74438,407044,629266,5,"so, I'm just copying the way they do it above - should we correct all the path / glob handling in this file throughout?",4643172,2012-03-31 05:30:10
74438,187046,630831,5,"I'd rather not fix all the deficiencies of this script now, but suffice to say, this bash isn't particularly defensive. On platforms where spaces in paths are more common (Windows) you could get into trouble if path vars are not quoted.

http://mywiki.woo",4643172,2012-04-01 20:59:20
77001,187046,636547,25,"Please add a precondition so we don't allow naive clients to shoot themselves here.

How about reset document, topicVector fields to null before each new key and ensure those vars are null before assignment?",4692763,2012-04-03 04:03:41
77001,407044,646024,25,"Before each key?  You mean each value?  reduce() will be called once per docId, and in that we have local variables for document and topicVector.  Then we iterate over the (at most 2-element) value iterator, setting one or both of document and topicVector",4692763,2012-04-04 22:03:04
89317,407044,683795,4,I think this will mean that methods like update() will fail by silently blocking forever.  Not sure if that's a good idea.,4935491,2012-04-14 01:13:50
89317,187046,684559,4,Oof. Right. I've added a Precondition there.,4935491,2012-04-14 04:21:20
289643,407044,612013,13,is this new param used anywhere?,8011066,2012-03-28 02:32:07
289643,187046,612092,13,"I had planned on using it for analysis of inference convergence.

I should likely have added this commit to #6. I'll close this one and add there.",8011066,2012-03-28 02:48:08
75315,480660,1398781,32,What's the deal with all this whitespace?,4660659,2012-08-17 03:59:16
90532,480660,1405918,5,Bad whitespace,4963940,2012-08-17 23:58:54
90532,480660,1405922,13,whitespace,4963940,2012-08-17 23:59:10
94401,258980,1407693,25,Can we make this method private?,5033442,2012-08-18 03:43:50
295329,8579,1470546,5,"Instead of having some partial duplication with the other `add_data` method, let's just modify that one to return a list of tasks as well. (i.e., replace that method with your new one)",8177735,2012-08-28 05:28:29
295329,8579,1470548,14,Let's just call this `add_element`,8177735,2012-08-28 05:28:55
295329,578238,1470602,5,Good call. Done.,8177735,2012-08-28 05:39:58
295329,578238,1470607,14,Done.,8177735,2012-08-28 05:40:36
305822,8579,1483141,24,This variable isn't used?,8510402,2012-08-29 13:32:25
305822,8579,1483153,26,"minor: You only use these variables once, so maybe just leave them as fields on `task`. Your call.",8510402,2012-08-29 13:34:10
305822,8579,1483164,35,"Confusing name, since you already have another variable called `task`.",8510402,2012-08-29 13:35:37
305822,8579,1483184,32,"You won't actually get an exception if there's no evaluation with the given name, right? You'll just get nil in return.",8510402,2012-08-29 13:39:57
305822,8579,1483202,35,minor: What do you think about renaming the `add_element`/`add_data` methods to `add_task`/`add_tasks` or `add_task_data`/`add_tasks_data`?,8510402,2012-08-29 13:43:44
305822,8579,1483226,53,Can you wrap/refactor this? It's something we'd want to do often.,8510402,2012-08-29 13:47:15
305822,8579,1483249,58,This assignment[:Answer] stuff is very specific -- feels like it should be refactored out. (maybe a new class to hold these things?),8510402,2012-08-29 13:51:11
305822,578238,1488148,32,You're right. I wrote this after seeing that doing Evaluation.find(1) where no Evaluation with id 1 exists throws an exception. I'll change this.,8510402,2012-08-29 22:41:23
305822,578238,1488166,35,Sounds a lot more consistent. Should I do this in a separate CL?,8510402,2012-08-29 22:42:30
305822,578238,1488176,53,I'll refactor this into a helper function in MTurkUtils. Sounds good.,8510402,2012-08-29 22:43:33
305822,578238,1488203,58,I agree. I'll look into this.,8510402,2012-08-29 22:45:30
305822,8579,1488655,35,Either a separate CL or this one is fine.,8510402,2012-08-29 23:22:17
305822,578238,1489100,24,"I was confused about this... Isn't whether we submit to production or not determined by the task's evaluation? There is a boolean field, prod, in evaluation that controls this.",8510402,2012-08-29 23:51:57
305822,8579,1492556,24,"As discussed in person, I think this variable should override the production/sandbox field in the evaluation (so that we can easily run integration tests offline). However, this param is a task-level param, whereas the evaluation holds an evaluation-level",8510402,2012-08-30 05:47:58
305822,8579,1492565,8,Can you clarify what this will return if no judge has yet submitted a response to this task?,8668941,2012-08-30 05:48:51
305822,8579,1492571,8,"Also, what will happen if we asked for multiple judgments on the task?",8668941,2012-08-30 05:49:22
305822,8579,1492579,64,"As discussed, assignment might be nil, so the following line may throw an error.",8668941,2012-08-30 05:49:52
305822,578238,1492925,8,"If there are no responses, the Answer field in the Assignment will be omitted. The Assignment should never be nil. I'm basing this off of: http://docs.amazonwebservices.com/AWSMechTurk/2007-06-21/AWSMechanicalTurkRequester/ApiReference_GetAssignmentsForHI",8668941,2012-08-30 06:48:05
305822,578238,1492927,64,Fixed.,8668941,2012-08-30 06:48:23
305822,8579,1502520,8,"But `getAssignmentsForHIT(task.evaluation.mturk_hit_type => task.mturk_hit)` might be nil or empty, right? (If no judge has yet responded. I forget which it is.)

Yeah, multiple Turkers can answer a specified question. We don't currently have this functio",8668941,2012-08-31 03:30:39
305822,258980,1517707,15,The shebang needs to be the first line (above the copyright header),9129026,2012-09-03 21:19:45
305822,258980,1517717,23,Is there a reason you're using HumanEval instead of ClockworkRaven?,9129026,2012-09-03 21:21:15
305822,258980,1517734,56,#each_with_object is generally preferred over #inject for building a Hash,9129026,2012-09-03 21:26:30
305822,258980,1517740,19,see note about #each_with_object above,9129026,2012-09-03 21:27:43
305822,578238,1519445,15,Good catch!,9129026,2012-09-04 08:30:51
305822,578238,1519453,23,No reason really; this should be renamed to ClockworkRaven to be more clear. But it's probably a good idea to wait until this CL goes through to rename so it gets working ASAP.,9129026,2012-09-04 08:35:04
305822,578238,1519454,56,I knew some method like this had to exist. Thanks.,9129026,2012-09-04 08:35:34
305822,8579,1520646,17,Did you mean to commit this?,9782225,2012-09-04 13:55:34
305822,8579,1520672,42,I'm still meh on identifying Evaluations by their names. Could you add a comment that you're assuming names are unique (which is indeed the case for now)?,9782225,2012-09-04 14:00:30
305822,8579,1520705,69,"minor: You could also write

    task_result.status = case assignment[:AssignmentStatus]
    ...

(Both are fine with me, just an fyi in case you don't know.)",9782225,2012-09-04 14:05:10
305822,8579,1520726,14,"Could you add that `humanEvalTaskType` is the name of the evaluation, and that you're using it as the unique identifier?

(Though again, as mentioned above, I don't really like using the name as the uid.)",9782225,2012-09-04 14:07:37
305822,578238,1525426,17,I'm unclear on the right way to control whether we're doing operations on the dev or prod databases. How is this usually done?,9782225,2012-09-04 22:39:32
305822,8579,1529832,68,"Indent the `when`s. I like Github's style guide: https://github.com/styleguide/ruby, though this seems to be fairly standard as well: http://en.wikipedia.org/wiki/Switch_statement#Ruby",9960804,2012-09-05 06:28:10
305822,8579,1529849,30,"I think I mentioned this earlier, but: we currently require all mc questions to be answered, but I could potentially see this changing. Can you do a similar 'No response given' in case `mc_question_option` is nil, or is there a reason not to? (Or I'm fine",9960804,2012-09-05 06:32:29
305822,578238,1536148,30,"From what I understand, the response from MTurk is only the MCQuestionOption ID, from which I can get the MCQuestionOption and MCQuestion. If the MCQuestionOption ID is nil, then I can't access the MCQuestion's label/question to produce a (label, ""No resp",9960804,2012-09-05 22:59:56
353871,8579,1668418,37,"Could you add some small comments about this and the EvaluationsDatable class? I'd be confused if I hadn't seen that Railscast episode :)
[maybe just link to that Railscast page]",12619104,2012-09-23 06:08:32
353871,258980,1702538,42,This is vulnerable to SQL injection. See http://guides.rubyonrails.org/active_record_querying.html#conditions for how to use an array or a hash -- it's never OK to use string interpolation when building SQL queries.,12619104,2012-09-27 06:47:11
353871,258980,1702558,41,"This method is a little confusing, and while I don't see any SQL injection vulnerabilities here, it might be good to explain why, in this case, the string interpolation you're doing is OK so future updates don't accidentally introduce injection vulnerabil",12619104,2012-09-27 06:53:15
353871,480660,1708364,41,"Turns out this was vulnerable to injection, so I fixed it by validating
against a whitelist, as suggested in
http://stackoverflow.com/questions/7771103/rails-3-activerecord-order-what-is-the-proper-sql-injection-work-around

On Wed, Sep 26, 2012 at 6:",12619104,2012-09-27 20:39:59
376958,8579,1603483,11,minor: `task.mturk_hit.nil?`,11350647,2012-09-14 04:00:19
378725,8579,1604811,4,"So instead of using the `doSubmitToProduction` field when we want to do testing, we'll simply create evaluations specifically as Sandbox jobs? (Makes sense to me, just confirming.)",11409704,2012-09-14 09:32:11
421119,8579,1670612,8,"Maybe I'm just not used to it yet, but I actually find the details helpful, so I'm not in favor of the auto-collapse. (and since there's nothing else on the page, the details aren't cluttering anything up) 
Agree/disagree?",12216093,2012-09-24 11:57:51
421119,258980,1675387,8,"I prefer to auto-collapse, but that's probably because I'm usually creating test evaluations for development rather than evaluations I care about. Maybe we can compromise and not auto-collapse, but when the user does collapse manually, we set a cookie or ",12216093,2012-09-24 22:26:33
459165,258980,2088354,33,"I think overall_pay_rate actually better avoid outliers -- a single fast judgement can generate a very high pay rate, but if we take all the times together, it better smooths out outliers.",16144548,2012-11-10 04:07:14
617750,57716,2352400,19,Naming the struct is unnecessary if you're immediately typedef'ing it.,21842045,2012-12-08 02:23:26
617750,57716,2352406,32,Use minheap_t; heap_t will collide with some other things happening in certain Ruby runtimes. ;-),21842045,2012-12-08 02:23:59
617750,57716,2352415,45,No string.h for memset?,21842045,2012-12-08 02:24:39
617750,57716,2352425,58,Include stdbool and use bools. You're in C99.,21842045,2012-12-08 02:25:27
617750,57716,2352458,7,Remove the debug comments.,21842037,2012-12-08 02:28:36
617750,57716,2352466,211,"Just use ""long"", ""long int"" is a bit... dated.",21842037,2012-12-08 02:29:34
617750,57716,2352471,38,Use calloc?,21842037,2012-12-08 02:30:08
617750,57716,2352474,206,We don't have an ERANGE available?,21842037,2012-12-08 02:30:28
617750,57716,2352498,86,1-based iteration?,21842037,2012-12-08 02:32:15
617750,61584,2352522,86,oops. a holdover from a previous implementation.,21842037,2012-12-08 02:34:27
32415179,2133546,156708057,6,Could we change this to http://www.rubydoc.info/gems/thrift/Thrift? We're actually on 0.10.0 now.,863498854,2017-12-14 00:22:31
15465200,1925,67267971,8,Can we kill 2.10.x support?,464340442,2016-06-16 07:08:16
362294,39559,1561720,5,""" a project's "", not "" a projects' """,10639439,2012-09-09 15:16:59
366780,5101,1603379,5,"can you just set src here? also, doesn't look like you're using proxy.path anywhere…

```js
src = url.parse(process.env.HTTP_PROXY);
```",10966153,2012-09-14 03:46:05
366780,17759,1603975,5,"Ah, you are right.",10966153,2012-09-14 05:29:50
367621,5101,1623240,16,hm.. probably better to link to our official one: https://github.com/twitter/bower-server,12100821,2012-09-18 02:15:08
367621,5101,1623283,7,i don't see how this would work without my suggestion above,12100821,2012-09-18 02:18:13
367621,5101,1623281,21,"maybe just rewrite this as

```
module.exports = require('rc') ('bower', {
  //Bower Defaults
  directory: 'components', 
  json:      'component.json',
  endpoint:  'https://bower.herokuapp.com'
});
```",12100821,2012-09-18 02:18:08
369430,5101,1623379,10,"i think i'd like it a bit better if it was written like:

```js
if (!err) return this.cleanUpLocal();

fstream.Reader(this.path)
  .on('error', this.emit.bind(this, 'error')
  .on('end', rimraf.bind(null, this.path, this.cleanUpLocal.bind(this)))
  .pipe(",11574738,2012-09-18 02:28:03
369430,22743,1623761,10,"looks good, thanks",11574738,2012-09-18 03:07:36
370443,5101,1647739,9,could you change this back to var. we've consciously not used the comma operator in variable definitions.,12416131,2012-09-20 11:12:16
370443,3871,1648420,22,multiple var statements,12582106,2012-09-20 13:23:24
939989,7082,2836783,48,I think we must enable the `dot: true` option so that glob matches the `.git` and other files that start with a `.`. If it' s not actually removing the `.git` folder (wich I think it's not) can you add a test for it?,26876644,2013-01-31 07:37:00
939989,7082,2836817,21,"This could be changed to just: `removePatterns.push.apply(removePatterns, this.json.ignore)`.
Probably faster because no new array is created.",26876644,2013-01-31 07:39:44
977602,3871,2943093,30,util.inherits,29079753,2013-02-08 21:31:27
978226,7082,2952842,7,Needs to be updated to `packages`.,29082846,2013-02-09 16:33:47
978226,7082,2952843,7,Also add a space after the function.,29082846,2013-02-09 16:34:24
978226,483194,2965101,7,Good catch!,29082846,2013-02-12 00:35:05
1240884,3871,3313447,26,"Isn't it preferable to list this after most likely usage?

So `install` first and `completion` last.",36075041,2013-03-11 15:09:11
1240884,6258,3322035,26,"It seems that a lot of popular software uses alphabetical ordering (npm, git) because it's easier to skim for a command/option that you're looking for information about.",36075041,2013-03-12 00:03:58
1240884,3871,3322157,26,"k, preference I guess",36075041,2013-03-12 00:09:50
1241047,3871,3313217,68,Using a specific git tagged version from a remote package,36082463,2013-03-11 14:46:08
1241047,3871,3313226,58,I noticed you're using `package` a lot. Any reason we're not using `component`?,36082463,2013-03-11 14:47:24
1241047,3871,3313252,135,...and it should be tagged,36082463,2013-03-11 14:50:14
1241047,3871,3313275,204,The `.bowerrc` defines some options:,36082463,2013-03-11 14:52:18
1241047,3871,3313308,292,The `component.json` defines some keys:,36082463,2013-03-11 14:56:02
1241047,3871,3313363,297,"This is vague, but I guess we still haven't decided what this property actually does. The current description makes it sound like it's more of a whitelist. But if it is, then why do we have `ignore`.

I always thought of it more of a 'hey, here's the st",36082463,2013-03-11 15:00:30
1241047,3871,3313368,305,"my-project

we prefer them to be slugged, even though we don't enforce it atm.",36082463,2013-03-11 15:01:03
1241047,3871,3313369,307,"""main"": ""path/to/main.css"",",36082463,2013-03-11 15:01:26
1241047,3871,3313407,491,move to wiki?,36082463,2013-03-11 15:04:44
1241047,6258,3325401,58,Mainly because it seems to be more of a generic package manager - you could have multiple components in a package. I don't think it was particularly intentional.,36082463,2013-03-12 03:10:16
1241047,6258,3325418,68,Done.,36082463,2013-03-12 03:11:07
1241047,6258,3325433,135,Done.,36082463,2013-03-12 03:12:18
1241047,6258,3325447,204,Done.,36082463,2013-03-12 03:12:58
1241047,6258,3325450,292,Done.,36082463,2013-03-12 03:13:06
1241047,6258,3325466,297,"Yep, I just lifted the existing explanation because I still don't know what `main` is actually for. I'll change the description to be more in line with yours / how npm uses it.",36082463,2013-03-12 03:14:16
1241047,6258,3325481,305,Done.,36082463,2013-03-12 03:15:24
1241047,6258,3325484,307,Done.,36082463,2013-03-12 03:15:30
1241047,6258,3325500,491,"I was wondering where to put this stuff, but then most of it didn't seem particularly useful. Feel free to add to the wiki.",36082463,2013-03-12 03:16:35
1241047,6258,3342563,7,"""package management"" -> ""front-end package management"" …to account for anyone who thinks this is the same as npm.",36361068,2013-03-13 02:03:20
1241047,3871,3342688,7,:+1: ,36361068,2013-03-13 02:10:58
1241047,7082,3365537,58,"The local folder can be a local git project. In that case, the #version applies. I think that we should merge folder and package to just package.",36375152,2013-03-14 05:16:38
1241047,7082,3365545,76,Maybe we should mention that the contents are extracted,36375152,2013-03-14 05:17:28
1241047,7082,3365561,127,"Not true. At the moment, bower register can be made in any directory. It doesn't use the local component.json either.",36375152,2013-03-14 05:19:01
1241047,7082,3365597,173,"Uninstall does not accept a folder. If you install a folder, you uninstall it by its basename or by the name specified in its component.json (if any)",36375152,2013-03-14 05:22:24
1241047,7082,3365614,211,"Shouldn't the name be search_path? This is not related to the readme, but just leaving the note here.",36375152,2013-03-14 05:23:44
1241047,7082,3365628,280,Should we say that `bower init` makes this easier?,36375152,2013-03-14 05:24:38
1241047,6258,3365665,127,Yeah. But I think this is a bug :). We should require and read the manifest in the dir the command is being run in.,36375152,2013-03-14 05:27:57
1241047,6258,3365671,211,I thought about that too,36375152,2013-03-14 05:28:36
1241047,7082,3365743,127,"Yes, it makes sense and we will probably do it.

Though, as an advantage, I've been registering components that I use without having to clone the repository and make a component.json for it.",36375152,2013-03-14 05:33:08
1241047,34408,3365809,127,I'd rather say this is a feature,36375152,2013-03-14 05:37:40
1241047,6258,3378768,211,"It's a pretty common convention in JSON, e.g., https://dev.twitter.com/docs/api/1.1/get/statuses/mentions_timeline",36375152,2013-03-15 00:29:26
1241047,3871,3379683,211,"Maybe, but definitely annoying. I always have to add `/*jshint camelcase:false */` when using the Twitter API...",36375152,2013-03-15 01:17:30
1241047,3871,3406194,315,Remove the first `/`,36499209,2013-03-18 03:05:40
1241047,3871,3368861,127,"It's a feature for now, when Bower is not widely accepted yet, since it's makes it a lot easier to use semver tagged repos without a component.json. But I don't see this as something that should be supported in 1.0.",36375152,2013-03-14 13:10:21
1241047,3871,3368864,211,"Why are you using underscore notation, this is JS, it's camelCase even though it looks ugly.",36375152,2013-03-14 13:11:19
1241047,3871,3368865,280,"Yes, mention that.",36375152,2013-03-14 13:11:35
1254936,3871,3396201,7,not familiar with Make. Why the `package.json`?,36488389,2013-03-16 00:04:16
1254936,34408,3396388,7,It's a dep,36488389,2013-03-16 00:11:28
1254936,3871,3396527,7,"But why is it needed? Package.json is always there. Shouldn't the `node_modules` folder be the dep, since that's thing the decides if `npm install` should be run or not.",36488389,2013-03-16 00:18:21
1254936,34408,3396567,7,node_modules can't be a dep to node_modules,36488389,2013-03-16 00:20:59
1254936,3871,3397643,7,"That's fine, but you didn't answer my first question. Why is it there at all?

What it should do is check if the node_modules folder is there and if not execute `npm install`.",36488389,2013-03-16 01:21:09
1254936,3832,3402382,7,"Yeah, that's what it does, but it also checks if `package.json` is more recently modified and runs it again.

If you change the package.json file you probably need to update npm right?",36488389,2013-03-16 09:17:58
1254936,3871,3403111,7,@richo thanks for clearing it up. That's exactly what I wanted to hear.,36488389,2013-03-16 19:03:24
1256224,7082,3405228,18,you forgot to rename the variable here.,36496494,2013-03-17 16:51:28
1256224,7082,3405229,15,Sorry I think I mislead you. It's removeListener. See: http://nodejs.org/api/events.html,36496494,2013-03-17 16:52:14
1303614,3871,3632018,92,"`__defineGetter__` is non-standard, use `Object.defineProperty`",37577393,2013-04-03 12:35:33
1303614,76371,3640677,92,"Definitely - `__definedGetter__` isn't just non-standard, it's deprecated. `Object.defineProperty` is also more expressive.",37577393,2013-04-03 22:09:43
1303614,1565,3640729,92,fd3bf981dc8e96906225b30d9fa78999467fd432,37577393,2013-04-03 22:12:05
1303614,76371,3640781,92,you. rock. :D,37577393,2013-04-03 22:14:20
1303614,1565,3638785,92,"Should we change that every where. Its used in a few other spots in the code base, like for `localPath`.",37577393,2013-04-03 20:32:38
1309410,3871,3711609,19,"`var notifier = updateNotifier({ packagePath: '../package.json' });`

then `pkg` isn't needed.",37617305,2013-04-09 16:35:10
1309410,576009,3711673,19,"`pkg` was already there for other things, I only changed whitespace on that `require()`.",37617305,2013-04-09 16:40:19
1309410,3871,3711698,19,"Oh, didn't notice, nvm",37617305,2013-04-09 16:41:50
1309410,7082,3712232,21,"This can't be done in every command, e.g.: `bower list --paths`
Basically, in commands that output `json` like that one nothing else can be outputted. 
",37617305,2013-04-09 17:24:37
1309410,576009,3712654,21,Could we output on stderr?,37617305,2013-04-09 17:55:02
1309410,3871,3712948,21,"`.notify()` is only a convenience method, create your own, all you need is on the `notifier` instance.

But I don't think we should output on stderr, that should be reserved for actual errors, not workarounds.",37617305,2013-04-09 18:11:28
1309410,7082,3712873,21,this would require a change in the `update-notifier` package. It does `console.log`. //cc @sindresorhus ,37617305,2013-04-09 18:07:36
1309410,7082,3713269,21,"Yes, we can, totally forgot that. Anyway `stderr` is not only for errors but for additional information.
> Standard error is another output stream typically used by programs to output error messages or diagnostics",37617305,2013-04-09 18:31:08
1318892,576009,3829584,19,"Might want to add the IRC details here to save people from having to hunt through to find it. Also, there is a [Google Groups mailing list](https://groups.google.com/forum/?fromgroups#!forum/twitter-bower)",37684763,2013-04-17 14:52:46
1318892,576009,3829955,145,"Typo - I think ""you agree to allow to license your work"" should be ""you agree to license your work"". Not sure how much legal water this clause will hold though.",37684763,2013-04-17 15:21:38
1318892,3871,3830209,19,:+1: ,37684763,2013-04-17 15:41:46
1318892,3871,3830219,25,Why? GitHub creates links for you,37684763,2013-04-17 15:42:20
1318892,3871,3830299,145,"@wibblymat it's not really a legal clause, just a reminder. Same would apply even without it.",37684763,2013-04-17 15:46:44
1318892,26243,3835330,9,"I'd lose the above two paragraphs. They're nice, but I don't think people would ready it.",37684763,2013-04-17 20:28:31
1318892,6258,3839071,25,Because those change every time you edit the title.,37684763,2013-04-17 23:40:15
1318892,3871,3841249,25,"Yes, so, it's not like we're going to update the title every day.",37684763,2013-04-18 01:36:45
1318892,6258,3841336,25,I did this because the titles in my issue-guidelines _have_ changed a few times. This is more robust that GitHub's auto-generated stuff.,37684763,2013-04-18 01:41:05
1318892,3871,3841551,25,"Whatever works for you, just saying.",37684763,2013-04-18 01:51:39
1318892,6240,3849828,9,I'm +1 to losing these two. Developers who are interested in contributing who take the time out to read this already realise much of this imo.,37684763,2013-04-18 14:23:55
1318892,6258,3860278,9,"This isn't just for ""external contributors"", it's for us too. An agreement that explicitly lays out how we expect to treat each other.",37684763,2013-04-18 23:35:54
1318892,6258,3860281,19,Good idea.,37684763,2013-04-18 23:36:06
1318892,33439,3868342,25,@sindresorhus also see: https://github.com/necolas/issue-guidelines/commit/d23af60ac99ce16416d1799a8ce5b53f0fab52da#commitcomment-2919116 :),37684763,2013-04-19 11:09:54
1341375,3871,3964182,15,colors,37841394,2013-04-26 00:07:26
1341375,3871,3964197,11,> Fix `bin/bower` not exiting with a exit code more than 0 when an error occurs,37841394,2013-04-26 00:08:25
1341375,7082,3964203,15,"My editor corrected to colours lol.
Colors is american english right?",37841394,2013-04-26 00:08:46
1341375,6258,3964900,11,"should be ""…AN exist code GREATER than…""",37846721,2013-04-26 00:42:18
1724505,133444,5079701,15,`… if respond_to?(:register_postprocessor)` ?,48185465,2013-07-09 05:00:50
2852846,133444,9060959,5,"this will trigger for `.mustaches` too, for example - perhaps we want `scope.pathname.basename.to_s.split('.').include?('mustache')`?",84394551,2014-01-22 07:23:05
2852846,133444,9060979,5,the 5th version was only to fix a caching issue - let's make this one be `0.2.1` to get the version number back under control,84394551,2014-01-22 07:23:52
2852846,178359,9063484,5,"That's possible, but then we also get non-extensions, like mustache.extensions.js would match.
What about /\.mustache(?:\.|\Z)/ or something like that, i.e. either followed by period or end of string.",84394551,2014-01-22 09:27:12
2852846,178359,9063488,5,I was wondering about this. Will change. Thanks.,84394551,2014-01-22 09:27:29
2852846,133444,9063500,5,true - `scope.pathname.basename.to_s.split('.').all_but_first.include?('mustache')` where `all_but_first` is `[1..]` or something?,84394551,2014-01-22 09:28:24
17386468,87195,153033,50,"(code style) and line 62, 110, 117, 225, 256, 264",520124561,2011-10-04 09:54:45
17386468,87195,153035,247,"what does it mean for a ruby line to begin with ""=""?
",520124561,2011-10-04 09:58:51
17386468,87195,153036,257,"if (_) {
  ...
} else {
  ...
}

also on line 265",520124561,2011-10-04 09:59:25
17386468,87195,153037,254,braces (or just put it on one line).,520124561,2011-10-04 09:59:55
17386468,87195,153040,6,"there are so many ctor params, it's pretty foggy from context what they're used for.

i can think of a couple of ways to fix that:
1. make a case class with good defaults and use that in the ctor, so most people will use the ""name=value"" form
2. define th",520124561,2011-10-04 10:03:36
17386468,61584,153972,247,typo. I must've hit undo in my editor before committing.,520124561,2011-10-04 22:55:34
917327,7053,2645332,6,Super minor nitpick: I'd indent everything from this line on.,25973189,2013-01-15 10:21:10
917327,7111,2645538,6,"I didn't want to make a major diff on this, because no one will be able to tell what is going on (due to the whitespace showing up).

Do you prefer I add this, thus obscuring the actual minor change?",25973189,2013-01-15 11:11:37
917327,7053,2645596,6,I don't really care. This just my OCD self with regards to indentation.,25973189,2013-01-15 11:22:08
1158607,7111,3159661,61,"Injection, right?  Use the option catcher on invert, right?",33899197,2013-02-27 02:53:12
1158607,44018,3159688,61,"Yeah, but my worry here is that we lose information by turning the exception into an option then rethrowing (within the `KSerializer`).",33899197,2013-02-27 02:55:15
1158607,7111,3162923,61,"So, maybe when we get to 2.10, we need:
```scala
trait TryInjection[A,B] {
  def apply(a: A): B
  def invert(b: B): Try[A]
}
```
In the mean time, this is fine, and/or add a KryoInjection for people who want to squash (which can just call the Bijec",33899197,2013-02-27 06:03:11
1158607,7111,3162938,61,"We could also change Injection to have `invert(b: B): Either[Throwable, A]`",33899197,2013-02-27 06:04:00
1158607,44018,3231605,11,KryoBijection should accept Kryo as a param.,34060120,2013-03-05 03:28:25
1158607,7111,3324760,11,It has a method getKryo you can override.,34060120,2013-03-12 02:33:01
1158607,7111,3325673,2,ImplicitBijection?,36207678,2013-03-12 03:26:41
1158607,7111,3325679,2,"Actually, change to Injection[T, Array[Byte]]
",36207678,2013-03-12 03:26:57
1203926,44018,3182424,38,flush after each one?,34676623,2013-02-28 08:22:59
1203926,7111,3182460,38,"If we don't, we've see bufferoverflow in kryo. If the output is not backed by outputstream, this is a noop.",34676623,2013-02-28 08:26:20
1256826,44018,3406889,21,"Nice. Can you add the types to the return values?

```scala
val bytes: Array[Byte] = KryoInjection(someItem)
val option: Option[AnyRef] = KryoInjection.invert(bytes)
```

I think the second ret value is correct.",36500169,2013-03-18 07:21:02
1323012,44018,3882480,15,"want to add a ""TODO: Remove when JavaSerializationInjection shows up in Bijection""?",37714916,2013-04-20 03:02:11
1324228,44018,3888076,7,"I know KryoBijection is deprecated, but I'm a little worried that we're making this change to KryoInjection vs KryoBijection before deprecating. Seems to me that we should apply this fix to KryoBijection, have KryoInjection use KryoBijection calls, then m",37723404,2013-04-22 00:30:55
1324228,7111,3899674,7,Why are you worried?  The Bijection still works exactly like it did before.  I just don't want to waste the effort of optimizing something the code already marks as TODO delete.,37723404,2013-04-22 22:06:54
1324228,44018,3900847,7,"I don't think it requires much effort. Move code you wrote here to Bijection and remove  `allCatch.opt` from invert and boom, done. Then have Injection call Bijection, just as before, with allCatch.opt.

The benefit is that existing users get a fix for ",37723404,2013-04-22 23:00:53
1327110,44018,3922622,5,"Hey, can you move this to `~/.sbt/plugins.sbt`? then you get it for all of your projects and we can keep it out of this bad dawg.",37742741,2013-04-23 23:43:55
1327110,13840,3922994,5,"Great point, sorry about that. Just removed it!


On Tue, Apr 23, 2013 at 11:44 AM, Sam Ritchie <notifications@github.com>wrote:

> In project/plugins.sbt:
>
> > @@ -3,3 +3,6 @@ resolvers += Resolver.url(""sbt-plugin-releases"", new URL(""http://scala",37742741,2013-04-23 23:58:27
1327110,44017,3926264,5,"Hey @sritchie, would that same approach work for the sbt-gpg plugin for you guys too? That way I wouldn't have to keep commenting it out to publish local snapshots of algebird :)",37742741,2013-04-24 02:26:12
1327110,44018,3926505,5,"Hell yeah it would! @johnynek added it to a few, but we're going to 
remove them in favor of this, I think.

> avibryant <mailto:notifications@github.com>
> April 23, 2013 2:26 PM
>
> In project/plugins.sbt:
>
> > @@ -3,3 +3,6 @@ resolvers += Resolver.url",37742741,2013-04-24 02:37:34
1416314,7111,4030547,7,can you leave one using the implicit bijection so we can see that is working?,38876507,2013-05-01 04:23:56
1500459,7111,4301982,21,"Can't we do `CanBuildFrom[Nothing, T, C]` and avoid taking c?",42414322,2013-05-20 23:09:30
1500459,13840,4302173,21,"Well, the CanBuildFrom implicit needs to capture the actual type of the originating collection in its first type parameter, so using `Nothing` would not do what we want here. Using `CanBuildFrom[C, T, C]` lets us get a builder that knows how to take eleme",42414322,2013-05-20 23:19:01
1500459,7111,4423564,21,"But we never use the From parameter. It seems strange that we actually throw `c` away. I think this code would work just as well with:
```scala
def forTraversableSubclass[T, C](isImmutable: Boolean = true)(implicit mf: ClassManifest[C], cbf: CanBuildFro",42414322,2013-05-29 02:45:06
1500459,13840,4424134,21,"If we get rid of the `c` param, won't we have to register the traversables
like this?

```scala
  .forTraversableSubclass[Any, Queue[Any]]()
  .forTraversableSubclass[Any, List[Any]]()
```

I was keeping the `c` param to help the type inferencing ",42414322,2013-05-29 03:18:35
1500459,7111,4426118,21,Fair enough. Let's merge what we have and if we can simplify later we will.,42414322,2013-05-29 05:41:52
1504653,7111,4529553,42,please don't change the style. This makes the functional changes harder to find.,43820236,2013-06-04 23:23:27
1504653,7111,4529558,27,revert style change,43820236,2013-06-04 23:23:37
1504653,7111,4529564,24,explain why this cast is needed.,43820236,2013-06-04 23:23:52
1504653,7111,4529673,67,"Please change this to mane a separate instance:

Injection[Any, ByteBuffer]

I don't see the need to put fromInputStream on KryoInjection.

You can put it on RichKryo if you really want.",43820236,2013-06-04 23:28:05
1504653,44018,4311482,43,Keep the type on public methods,42486647,2013-05-21 11:42:24
1581344,7111,4641189,40,"change to
```scala
class KryoRegistrationHelper(val prefix: String)
```
and replace summingbird with the prefix",45148671,2013-06-11 23:51:02
1581344,7111,4662941,35,"Performance isn't crucial in this code path.  Can we change this to Injection[Base64String, String] and just use allCatch on inverting the decode?

I don't like leaving this unsafe code in when perf isn't killing us.",45167564,2013-06-12 23:14:20
1581344,44018,4664336,35,How about we move this to a separate RB? I'd rather not do more work in this one.,45167564,2013-06-13 00:05:34
1581344,7111,4664799,35,"That's fine, but please mark as TODO and rename the object to UnsafeBase64StringUnwrap.",45167564,2013-06-13 00:26:32
1581344,44018,4664897,35,"The code is already in production in summingbird -- best to keep the diff a complete move and then make functionality changes later, so the diffs are really clear.",45167564,2013-06-13 00:30:30
1581344,44018,4671252,35,"Added the TODO, good call.",45167564,2013-06-13 06:34:57
1643237,13840,4855784,14,"Isn't it safer to do this?

```scala
  import scala.util.control.NonFatal

  try {
    Some(kryo.readClassAndObject(input))
  } catch {
    case NonFatal(_) => None
  }
```",47084323,2013-06-25 04:04:46
1643237,8976,4856004,14,"I don't know what you mean exactly by ""safer"".  I'm under the impression that you should not try and recover from any `T <: Error`.  Scala defines a set of exceptions with `NonFatal` which would also be an improvement from the current behavior, however.  ",47084323,2013-06-25 04:17:37
1643237,13840,4856063,14,"Oh wow, I didn't realize there was `Exception.nonFatalCatch`. ",47084323,2013-06-25 04:20:38
1650517,13840,4884348,22,Super nice cleanup!,47280583,2013-06-26 10:35:08
1650517,44018,4896883,15,done.,47278632,2013-06-26 22:31:33
1650517,44018,4896880,16,"yup, will add.",47278632,2013-06-26 22:31:29
1650517,7111,4894480,16,"this is sealed, so why not just .`forClass[Right[Any]]` `forClass[Left[Any]]` which should save the reflection subclass lookup.",47278632,2013-06-26 20:55:26
1650517,7111,4894496,15,"Also final, so I think forClass will do.",47278632,2013-06-26 20:56:06
1650517,7111,4894518,4,WTF? what is the toInt there?,47278632,2013-06-26 20:56:53
1650517,7111,4894535,22,yes. nice.,47280583,2013-06-26 20:57:18
1652173,13840,4893509,40,A default buffer size of `4096` will be used here. I guess that's sufficient? Maybe it would be nice to make it configurable to avoid always resizing the output buffer for scenarios where we know a priori that we'll exceed 4K. May or may not affect perfor,47406664,2013-06-26 20:20:53
1652173,13840,4893549,60,Should we invoke `Output#clear()` in `releaseOutput` to ensure that when someone gets a resource from the pool it's already cleared out?,47406664,2013-06-26 20:22:22
1652173,7111,4894592,40,"We haven't seen an issue with the 4k buffer since we flush internally when we are writing collections.

That said, reading a config param would be fine. Pull req? :)",47406664,2013-06-26 20:59:15
1652173,7111,4894610,60,"yes, that is better. Will update",47406664,2013-06-26 20:59:57
1652173,13840,4894665,40,"I don't need it badly enough at this time to go back to writing Java code. :) (Joking, if I have the time I'll do it).",47406664,2013-06-26 21:02:17
1723066,44018,5077796,6,Update this one as well (to 2.9.3),48180255,2013-07-09 03:12:45
1723433,44018,5078615,33,"Since there's no interface or anything defining this method, I think it'd be better to just create 

```java
public class SingleRegistratar<T> extends IKryoRegistrar {
  public SingleRegistrar(Class<T> klass, Serializer<T> serializer)
  // etc etc
}",48181762,2013-07-09 03:52:45
1742058,44018,5099454,34,Funky. Didn't know that this was the way in Java.,48239193,2013-07-10 00:35:00
1742058,44018,5099488,32,"Nice, this lets us get rid of that switch we duplicated in cascading.kryo.",48239193,2013-07-10 00:36:19
1742058,44018,5099476,67,I wonder if we should make this a variadic method.,48239193,2013-07-10 00:35:42
1750913,44018,5129627,63,way better.,48271102,2013-07-11 03:54:10
1750913,44018,5129671,5,"We started with implicit conversions, moved away... and now we're back, mature and understanding of the consequences.",48271102,2013-07-11 03:56:10
1778710,44018,5242814,19,Can you comment this? This is the maximum on the number of kryo instances in the pool? I can't see anywhere that allows the user to configure this.,49423875,2013-07-17 19:16:30
1778710,44018,5242869,104,"i'm getting a bit lost in all of these changes, so you may have covered this before -- but do we have a configuration key for this accept-all setting, or are we just assuming that the user can override getKryo and provide their own instance?",49423875,2013-07-17 19:19:22
1778710,44018,5242824,19,"number of output instances, rather.",49423875,2013-07-17 19:16:50
1778710,44018,5242842,45,We need to port the README over from cascading.kryo.,49423875,2013-07-17 19:18:15
1778710,7111,5244722,45,"I actually don't think many people will wind up using the map-based config. There is a static method that lets you set the config from the classes, and that's the safer way to go. What keys we use in the Configuration is almost an implementation detail.",49423875,2013-07-17 20:21:35
1778710,7111,5244768,104,"this logic was broken out into this:

https://github.com/twitter/chill/blob/develop/chill-java/src/main/java/com/twitter/chill/config/ReflectingInstantiator.java",49423875,2013-07-17 20:22:58
1809863,44018,5351210,164,"Oh, actually, my bad. The way this README is laid out, we should actually add the suffixes to each one.",50921482,2013-07-23 22:38:29
1809863,44018,5351199,164,Same here.,50921482,2013-07-23 22:37:54
1809863,44018,5351192,154,No need for a suffix here.,50921482,2013-07-23 22:37:48
1809863,7111,5351483,164,"chill and bijection are the only scala ones. The others don't have suffixes (they are pure java). Right? (also, I am testing with scalding now with snapshot, it is right. :))",50921482,2013-07-23 22:46:52
1902412,44018,5661174,11,"ah, got it. Nice work, dude! Thanks for this fix.",53175660,2013-08-08 20:46:42
1902412,13840,5660895,11,"Hey @sritchie! The original issue that I found was that the class returned from `obj.elemManifest.erasure` is actually incorrect when `T` is marked as @specialized, e.g. `(Int,Int)`. Kryo picks up the right `Class` when you call `writeClassAndObject`. I j",53175660,2013-08-08 20:38:20
1902412,7111,5659634,25,still want this so we can see the correct ClassManifest on the other end.,53175661,2013-08-08 19:56:05
1902412,7111,5659535,10,I'd like to keep this even though it is unused except in the constructor. A more careful equals might care if the ClassManifest is the same. Or a reflective use on the other end might use the ClassManifest.,53175661,2013-08-08 19:53:10
1902412,7111,5659602,12,"should we just do:
```scala
kryo.writeObject(out.array)
```
here?

That might be the better fix. Then we get any optimizations on Array serializations that may be registered and don't repeat code.",53175661,2013-08-08 19:55:29
1902412,44018,5660493,11,"Do we still want to writeClassAndObject at this point, since we just wrote the manifest? would ""writeObject"" do?",53175660,2013-08-08 20:25:23
1902412,7111,5659692,7,thanks for adding this.,53175661,2013-08-08 19:57:33
1912497,13840,5702574,8,I guess we have to stick with 2.0.5 instead of 2.2.2 (latest stable release) because chill requires Scala 2.9?,53240316,2013-08-12 08:30:27
1912497,13840,5702581,60,OMG semicolon! :-),53240316,2013-08-12 08:31:08
1912497,13840,5702585,29,Space between `if` and `(value != null)` ?,53240316,2013-08-12 08:31:49
1912497,7111,5702619,60,Copy and paste from Java. :),53240316,2013-08-12 08:37:40
1912497,7111,5702695,8,"Yes, but I don't *think* the binary API we touch here cares. This *should* work for a later version if all the methods are still present, and they should be if they are following semantic versioning.",53240316,2013-08-12 08:57:17
1912497,38128,5708821,27,"I'm not familiar with ChillConfig but I'm guessing java is involved or you'd do something instead like this to avoid returning an explicit null and NPE's

Try( typesafeConfig.getString(key) ).toOption",53304786,2013-08-12 18:17:06
1912497,38128,5708988,38,"Tighten it up?

def set(key: String, value: String): Unit = value match {
      case null => typesafeConfig = typesafeConfig.withoutPath(key)
      case _ => typesafeConfig = ConfigFactory.parseString(""%s = \""%s\"""".format(key, value)).withFallback(typ",53304786,2013-08-12 18:23:29
1912497,38128,5709136,26,"Do you really want this to be empty - if the value passed into the set is null, you may, in the set function, need a ConfigFactory.load to read the config in /resources/the.conf
 ",53304786,2013-08-12 18:28:51
1912497,38128,5709175,46,actorFor  is deprecated in akka 2.2.0 (latest),53304786,2013-08-12 18:30:41
1912497,38128,5709273,45,"Note that this may return a null, and actorFor may return may return system.deadLetter so the handling is put on the consumer  

",53304786,2013-08-12 18:35:47
1912497,38136,5709324,38,"    def set(key: String, value: String): Unit =
      typesafeConfig = Option(value) map { v => ConfigFactory.parseString(""%s = \""%s\"""".format(key, v)).withFallback(typesafeConfig) } getOrElse typesafeConfig.withoutPath(key)

;)",53304786,2013-08-12 18:38:23
1912497,38128,5709732,45,"If this is for an Akka Extension, you''ll also want something like this:


object AkkaSerializer extends ExtensionId[AkkaSerializer] with ExtensionIdProvider {
  
  override def apply(system: ActorSystem): AkkaSerializer = super.apply(system)
 
  o",53304786,2013-08-12 18:54:50
1912497,7111,5716073,27,"Yes, chill has a java base so it is usable with Hadoop without scala (which is used by the clojure project cascalog).",53304786,2013-08-12 22:51:20
1912497,7111,5716260,45,"How could these events happen on deserialization? Wouldn't the string representation not be null from Akka? So write should never get a null, right?

Also, can you suggest a better way to serialize ActorRef?",53304786,2013-08-12 22:58:16
1912497,7111,5716307,45,"Wasn't clear on this. I was able to use this as a serializer without making it an Extension. Does a custom serialization need to be an Extension?

I could add this code, but I was unclear as to why it worked in 2.0.5 without it.",53304786,2013-08-12 22:59:23
1912497,7111,5716609,26,"The motivation was so people could make an empty one, use it with chill.config.ConfiguredInstantiator and see what the result was (to avoid coding config by hand).

That said, they can pass an empty one in by hand.",53304786,2013-08-12 23:08:47
1912497,7111,5716624,46,"Until twitter moves to 2.10 internally, we will be building both 2.9.3 and 2.10.",53304786,2013-08-12 23:09:24
1912497,38136,5717263,45,"Hi!

Custom Serializers need not be Extensions: http://doc.akka.io/docs/akka/2.2.0/scala/serialization.html#Creating_new_Serializers

Cheers,
√",53304786,2013-08-12 23:27:56
2030463,44018,6118146,76,nice,57591330,2013-09-03 11:22:01
2092311,44018,6308013,5,Add an actual deprecation tag,57972947,2013-09-12 02:38:50
2092311,7111,6308558,5,"that will break compatibility technically. Also, if it works for you, I guess it is fine. You know if it fails. Externalizer does something different.",57972947,2013-09-12 03:05:08
2092311,44018,6308570,5,"the comment sounds like a deprecation, but okay...",57972947,2013-09-12 03:05:44
2359999,319889,7360283,32,Why flush after each object?,67903617,2013-11-01 05:46:09
2359999,1123342,7360834,32,"Because that is what Traversable does https://github.com/twitter/chill/blob/develop/chill-scala/src/main/scala/com/twitter/chill/Traversable.scala#L31.

I think @johnynek added Traversable maybe he can comment on why or if that is needed here.",67903617,2013-11-01 06:15:49
2359999,7111,7413603,32,"If you don't flush, the Kryo output can overflow.",67903617,2013-11-05 04:16:46
2423863,319889,7566275,65,I think in some similar cases you might have called flush here? not sure how this will behave if Message is big -- responsibility of the loop that might call write though instead?,70109252,2013-11-12 00:35:44
2423863,319889,7566317,48,"Seems like a great time for some scalacheck's, though not a blocker on this PR",70109252,2013-11-12 00:37:03
2427239,7111,7567422,23,"okay, forgot what this does. This is testing that a core type (maps in this case) are registered so that we don't have to write the whole class name into the stream. I think we can't make this change. We need to figure out a way to make this pass (even if",70213412,2013-11-12 01:13:23
2427239,504464,7568484,23,"this serialization stuff makes my head hurt.

ok so the registration
  .forConcreteTraversableClass(Map[Any, Any]('a -> 'a, 'b -> 'b, 'c -> 'c,
'd -> 'd, 'e -> 'e))

was actually meant to register a HashTrieMap. what threw me off was the
comments a",70213412,2013-11-12 01:45:56
2427239,504464,7568778,23,"if i change this line:
  .forConcreteTraversableClass(Map[Any, Any]('a -> 'a, 'b -> 'b, 'c -> 'c,
'd -> 'd, 'e -> 'e))
to
  .forConcreteTraversableClass(HashMap[Any, Any]('a -> 'a, 'b -> 'b, 'c ->
'c, 'd -> 'd, 'e -> 'e))

it works. i also checked ",70213412,2013-11-12 01:54:07
2646453,319889,8373430,5,Extending things in the akka package? really needed?,77251334,2013-12-17 00:17:50
2646453,109276,8376253,5,Yea. *Serialization.currentTransportInformation* is private to the *akka* package. On the second thought this probably means that it should not be accessed from outside and *ActorRef* should be serialized in some other way. I will investigate that.,77251334,2013-12-17 01:35:30
2987052,7111,9597782,17,can we make a single val holding the version of bijection?,88485074,2014-02-11 02:23:32
2987052,7111,9597791,30,repeated version num (see above).,88485074,2014-02-11 02:23:43
2987052,7111,9597893,28,"can we add a KryoRegistrar that will handle adding the default serializer for any subclass of SpecificRecordBase? See the one we have for thrift or protobuf, for instance",88485074,2014-02-11 02:25:46
2987052,7111,9598026,28,"actually, we didn't (for some reason) make KryoRegistars for those two cases.

Can you make a function that returns a registrar for a given T? You use something like this in your test.",88485074,2014-02-11 02:29:11
3167170,319889,10237448,4,"Version we deprecated at..

Kill todo :)",93617807,2014-03-04 07:28:01
3167170,7111,10242934,33,.orNull is a bit shorter than .getOrElse(null),93630485,2014-03-04 11:54:21
3252768,7111,10617565,91,does this need to be commented?,96202610,2014-03-14 23:26:27
3252768,504464,10617675,91,"yes, until this is in algebird release:
https://github.com/twitter/algebird/pull/289


On Fri, Mar 14, 2014 at 1:26 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In
> chill-algebird/src/main/scala/com/twitter/chill/algebird/AlgebirdSerializers.s",96202610,2014-03-14 23:28:22
3252768,38527,11450467,91,That was merged,96202610,2014-04-09 23:24:57
3638355,26155,12268004,17,"Should be ""GenericRecordSerializer"", no?",107451157,2014-05-05 10:39:29
3638355,26155,12268718,76,"Hey @MansurAshraf,

Thanks for the patch. Unfortunately, it's not solving the problem for me. For some reason the Avro record appears to be corrupted during the round trip so that the equality check passes yet the toString method on `user` returns `{""na",107451157,2014-05-05 11:48:18
3638355,2523602,12284241,76,"Hey @hammer,

you are not crazy :-) I can confirm  Generic Avro record that get serialized through Chill/Kryo are not get deserialized properly, however bijections-avro is serializing/deserializing them just fine. AvroSerialiazer that i wrote is basical",107451157,2014-05-05 20:43:45
3638355,319889,12285109,76,Can someone add/include a test thats failing? Will help us help debug,107451157,2014-05-05 21:04:17
3638355,2523602,12285646,76,"just to further confirm that when using Generic Record, AvroSerializer is not even getting engaged so its probably an issue with registering the correct Kyro serializer with GenericRecord ",107451157,2014-05-05 21:18:11
3638355,38527,12304645,18,GenericAvroCodecs[T](schema.getOrElse(null)) should work,109022573,2014-05-06 04:06:42
3638355,7111,12394251,20,`GenericAvroCodecs[T](schema.orNull)`,109022576,2014-05-07 23:40:23
3638355,7111,12394560,20,"actually, in this case, why not just take `schema: Schema = null`?",109022576,2014-05-07 23:44:45
3638355,7111,12394598,51,"wait, It is Kryo, not Kyro.",109022576,2014-05-07 23:45:24
3638355,7111,12394644,17,Kryo actually.,109022576,2014-05-07 23:45:41
3790476,7111,13256118,12,"can we do .forClass here? subclass is pretty dangerous because the type information of which subclass you have is lost. If you want to support subclasses, we need to write the class name, instantiate that, and fill it back up.",116056253,2014-05-31 04:38:19
4018504,319889,14335782,5,Should this maybe be split out as a separate class from the normal collections -- I presume eventually we may want all the collections wrappers? ,131781059,2014-06-30 10:11:05
4018504,28831,14336277,5,I guess that's a decision for the project lead(s) ...,131781059,2014-06-30 10:20:38
4018504,319889,14357515,5,"Ok then, lets do that so. Split out the wrappers from the core collections. ",131781059,2014-06-30 20:50:22
5702859,44018,22387753,29,"this should be ""kryoInstantiator"", not ""kyro""",201405850,2015-01-01 00:00:59
5702859,44018,22387773,37,CachedKryo,201405850,2015-01-01 00:01:58
5702859,1013898,22388031,29,Can you clarify what you mean by this?,201405850,2015-01-01 00:09:19
5702859,319889,22388202,39,this all looks like it needs synchronization and isn't thread safe? spill thread could be creating one of these the same time as another thread,201405850,2015-01-01 00:16:43
5702859,319889,22388204,49,should have a test,201405850,2015-01-01 00:16:50
5702859,1013898,22388441,39,"There is only one ""thread"" area, where the single cachedKyroInstantiator is assigned (line 169). That is perfectly safe on all cache-coherent architectures (find one these days that isn't). If you want we can add a synchronized around this to feel better ",201405850,2015-01-01 00:25:34
5702859,1013898,22388460,49,"Yup, also going to test fastSplitKey but wanted to make sure you guys generally approved first.",201405850,2015-01-01 00:26:21
5702859,1013898,22388475,37,"Hi, not exactly sure what you are suggesting?

CachedKyroInstantiator gets renamed to CachedKyro?

But your other comment seems to suggest that something is named kyro that should not be?

",201405850,2015-01-01 00:27:05
5702859,319889,22388727,39,Well you could build new ones too and general have strange behaviour/performance since the test for null & base64 would be out of date in the process of executing it.  The performance cost is almost zero to the synchronization block and it means the code ,201405850,2015-01-01 00:36:30
5702859,44018,22389195,37,"Sorry, I just wanted you to change the mis-spelled ""Kyro"" names to ""Kryo"".

—
Sent from Mailbox

On Wed, Dec 31, 2014 at 10:27 AM, zakattacktwitter
<notifications@github.com> wrote:

>> @@ -149,4 +149,44 @@ protected static String serialize(Kryo k",201405850,2015-01-01 00:53:53
5702859,7111,22389980,49,above your code seemed to assume a null key returned a null result. But here you are not doing that. I'd rather check explicitly above.,201405850,2015-01-01 01:18:25
5702859,7111,22390056,39,"+1 to Ian here. Java claims all the time that uncontented locks are almost free on JVM. We should benchmark, but I think it will not be measurable.",201405850,2015-01-01 01:21:03
5702859,1013898,22390079,49,"Oscar, are you talking about fastSplitKey? We still check for null *before* we call fastSplitKey in the ConfiguredInstantiator constructor. Is that not sufficient? Its the same way we protected .split("":"") previously.",201405850,2015-01-01 01:22:08
5702859,7111,22390112,6,I think you should do this after checking key is not null. I'd rather be direct that assume some contract on fastSplitKey.,201405850,2015-01-01 01:22:41
5702859,7111,22390439,6,"Just to be clear: a missing key in the conf returns null, so we need to handle the case where the KEY is missing.",201405850,2015-01-01 01:35:34
5702859,7111,22390523,6,duh.... Turns out sometimes you need to read more than the diff. Sorry.,201405850,2015-01-01 01:38:52
5702859,7111,22390564,49,nevermind. False assumption on my part. Disregard.,201405850,2015-01-01 01:40:28
6388604,7111,25191342,68,"are these numbers positive? If so, `writeLong(words[i], true)` might be a win.",221841455,2015-02-24 02:07:38
6388604,43769,25191624,68,"No, they are not. The `words` contain the the bits from the bitset. Depending on how the user sets the bits, they might represent very negative numbers ;)",221841455,2015-02-24 02:10:54
6388604,7111,25191625,88,can you write this as a test? The new bytes must be `<=` the old bytes?,221841455,2015-02-24 02:10:54
6388604,7111,25191837,67,can you add a test that the random bitset is the same in the old and new cases?,221841455,2015-02-24 02:13:22
6388604,7111,25215945,68,Okay. I didn't know if they stored deltas to the next present value.,221841455,2015-02-24 06:58:50
6834988,319889,27228982,61,Why the akka changes/why did the akka version change? ,236522800,2015-03-26 22:23:26
6834988,319889,27228923,52,Why are all these commented?,236522800,2015-03-26 22:22:54
6834988,37238,27230112,52,this workarould should be fixed.,236522800,2015-03-26 22:34:52
7883548,7111,31946193,5,"this is going to write 4 extra bytes for each record, right? Even 4 bytes is more than we need, as we don't expect 4 GB records.

Why not cast this to an int here and save the data (consider serializing Unit with this, which will now take twice as much ",267891320,2015-06-08 23:46:57
7883548,7111,31946843,6,we need to move to `Try[ObjectInstantiator[AnyRef]]` here. Our use of `Either` predates us scala having `Try`.,267891320,2015-06-08 23:54:03
7883548,319889,31946968,5,"If this is a legit use case, should probably move this to a varInt encoding, would probably be a win over our usual int in some cases.",267891320,2015-06-08 23:55:13
7883548,7111,32081340,39,we need tests for this. This is super testable with scalacheck.,268722994,2015-06-10 06:15:27
8177829,622449,33405922,23,"can you add one more clause for `RuntimeException` to cover `IllegalArgumentException` and friends, and update the Strings in these exceptions ",275599463,2015-06-27 05:02:25
8386878,7111,34675547,4,we shouldn't drop scala 2.10 support. Twitter (and other big companies take a long time to upgrade such things). We need our tests to run on the version we use.,279786226,2015-07-15 18:08:58
8386878,7111,34675600,59,interpolate,279786226,2015-07-15 18:09:44
8386878,7111,34675589,53,"while we are cleaning up, can we use string interpolation?",279786226,2015-07-15 18:09:35
8386878,7111,34675774,17,"let's add a type here if we can. Can't these all be the same type?
```scala
def newOrElse[K](cls: Class[_ <: K],
  it: TraversableOnce[Class[_ <: K] => Try[ObjectInstatiator[K]],
  else: => ObjectInstatiator[K]): ObjectInstatiator[K] = {
```
should ",279786226,2015-07-15 18:12:03
8386878,7111,34675621,46,"while we are cleaning up, can we use string interpolation?",279786226,2015-07-15 18:09:57
8386878,7111,34682674,27,`.collectFirst { case Some(x) => x }` is better than `find.flatten`,279786226,2015-07-15 19:20:42
8386878,7111,34686578,59,"add the type, switch to Try.",279786226,2015-07-15 19:54:03
8386878,7111,34686652,47,what is the shaded jar? Can you comment on what is shaded here?,279786226,2015-07-15 19:54:45
8386878,7111,34686799,91,"why are you bumping these up? Do we need it? This going to force it on everyone downstream (which includes scalding, spark, summingbird, and a lot of people internal at Twitter).",279786226,2015-07-15 19:55:57
8386878,7111,34686550,50,"same `t: Class[_ <: K]` should do it, and we can convert to `Try[ObjectInstatiator[K]]` here. There was no `Try` when we wrote this.",279786226,2015-07-15 19:53:51
8586666,7111,35599998,43,"is the toList needed there? That is going to be a full iteration through things again.

A few notes:

1. you could use `0 until rows`. rather than the `-1`.
2. map/flatMap on Range is not lazy, so this is going to fully materialize the filtered table",283951239,2015-07-28 04:30:50
8586666,7111,35600084,43,"4. Also, I think you're better off writing `((Int, Int), V)` than `(Int, Int V)` because tuple2 is specialized and it won't write the type token twice.",283951239,2015-07-28 04:32:12
8586666,7111,37464597,22,we should add this to the AlgebirdRegistrar. Sorry I didn't notice that before.,283951238,2015-08-20 01:35:50
8586666,3626857,37467193,22,"Yeah, I have tried it before and, sorry, I do not know how to do that generic way. The `SketchMapSerializer` requires the implicit `SketchMapMonoid`, which need to be specified before, but to do that I need to create one with very specific `SketchMapParam",283951238,2015-08-20 01:58:40
8586666,7111,37472991,29,"okay, I had somehow overlooked the issue these cause. Sorry. Ideally there are no parameters to a kryo serializer, but that's not easy to do given how AdaptiveMatrix holds on to the `Monoid[V]` which was probably a design flaw.

Could we get by here at ",283951238,2015-08-20 02:49:02
8586666,7111,37473023,60,"there is `AdaptiveMatrix.zero(rows, cols)` for this case.",283951238,2015-08-20 02:49:24
8586666,7111,37473046,57,can you explain these two lines of code?,283951238,2015-08-20 02:49:37
8586666,3626857,37576849,60,"Yes, i can make this change. ",283951238,2015-08-21 01:24:28
8586666,3626857,37578131,57,"I am not 100% sure what lines you refer to, but would assume that 
` val rows = if (rowsOrig == 0) skmMonoid.params.depth else rowsOrig` and `val cols = if (colsOrig == 0) skmMonoid.params.width else colsOrig`.
 As I was saying that we wrote this serial",283951238,2015-08-21 01:37:28
8586666,3626857,37578872,29,"The reason we have skmMonoid is to support old serialized versions of SketchMap produced with old version of algebird 0.4, but can be eliminated (please see the other comment about that for more info).
You know, I have tried to remove this implicit Sketc",283951238,2015-08-21 01:44:10
8901245,7111,37251913,43,"still not totally safe, because if you deserialize `Externalizer[String]` or `Externalizer[Int]` both will not throw until you call .get and it fails to cast to `String` or `Int`.

We could solve one layer deep, but then it could also fail for collectio",299139350,2015-08-18 05:07:56
8901245,7111,37252023,33,"apply is not a great name for an implicit do name shadowing causing issues there, I believe. Maybe call the implicit something else and have it call apply?",299139350,2015-08-18 05:09:29
8901245,319889,37254449,33,orly? didn't know of such a thing. Will change,299139350,2015-08-18 05:50:08
8901245,319889,37254424,43,"Ok cool, seems reasonable",299139350,2015-08-18 05:49:46
10012074,7111,42889027,22,"I'm worried about the thread-safety of testKryo. We could be sharing it across threads, and there is no guarantee it is thread-safe.

Could we either borrow from the KryoPool to test or use a lock to guard access?",334447901,2015-10-23 22:08:18
10512855,7111,45267877,17,"shouldn't this be:
```scala
def forClass[T](t: Class[T])(fn: () => T): ObjectInstantiator[T] =
    new ObjectInstantiator[T] {
       override def newInstance() = {
         try { fn() }
```",347130617,2015-11-19 05:05:21
10512855,7111,45267965,27,also can we add the `T` parameter here?,347130617,2015-11-19 05:06:00
10512855,7111,45268194,36,add `T`,347130617,2015-11-19 05:07:48
10512855,7111,52396472,5,is there no int? should we throw here if the long > Int.MaxValue,387062579,2016-02-10 08:03:59
10512855,7111,52396624,5,"Oh, the code is below. Why not unsigned varint?",387062579,2016-02-10 08:05:26
10512855,7111,52396846,152,"this is a lie, right?",387062579,2016-02-10 08:07:20
10512855,7111,52397129,23,"`Either[Throwable, A]` should be `Try[A]`. This code predates scala Try.",387062579,2016-02-10 08:09:58
10512855,319889,52474993,23,Will update file,387062579,2016-02-10 23:45:34
10512855,319889,52474971,152,"Looks like one(this code isn't mine), add test, or kill comment? 

```
        while (((b = in.readByte()) & 0x80) != 0 && i < 42) {
            value |= (b & 0x7F) << i;
            i += 7;
        }
        if(i == 42) { // Over read!
          ",387062579,2016-02-10 23:45:26
10512855,319889,52479373,5,"I think this flowed out of the kryo api for bytes written returning a long... at the entry point to that i goto an int now, so everything else just ends up being integers",387062579,2016-02-11 00:09:43
13724138,6682,59125164,13,Quick question: what's the best place to register this? And what happens if it already happens to have been registered by some other means?,422882995,2016-04-10 08:41:53
13724138,7111,59438355,5,that's a bummer.,422882995,2016-04-13 02:29:42
13724138,7111,59438312,13,I think we should make a `Java8ClosureRegistrar` that is an `IKryoRegistrar`: https://github.com/twitter/chill/blob/develop/chill-java/src/main/java/com/twitter/chill/IKryoRegistrar.java and it should be a no-op when we are not on java8 (as you have below,422882995,2016-04-13 02:29:23
13724138,6682,59439463,5,":frowning:

We could make this constant a function of Scala version if you'd like to keep using the old value for the old build matrix entries.",422882995,2016-04-13 02:37:15
13724138,6682,59439508,13,Good idea; will do.,422882995,2016-04-13 02:37:38
13724138,37792,60410825,13,"this won't be necessary in M5, fixed in https://github.com/scala/scala/pull/5100",428263828,2016-04-20 20:54:31
13724138,6682,86703912,13,"Whoops, forgot about this comment until now. I've created a `Java8ClosureRegistrar` to abstract away this code.",422882995,2016-11-07 09:37:28
16521995,7111,76156433,9,"whey remove the old one? This will break people, no?",499582359,2016-08-25 06:11:36
16543219,7111,76519797,39,"these are all basically the same. Can we share the code? Something like:
```java
public abstract class UnmodifiableJavaCollectionSerializer<T, U> extends Serializer<T> {
    protected U getInner(T t);
    protected T build(U u);

    @Override
    ",500022750,2016-08-28 00:46:11
20101537,32008959,94510059,1,Are we also going to have to backport the doge release business? I think so.,590398442,2017-01-04 08:07:26
20101537,32008959,94510170,30,"hmm, odd that this doesn't have coverage even though without it the tests failed.",590398442,2017-01-04 08:08:41
20101537,32008959,94510024,30,"do we care about the README on each of these branches reflecting the 0.7.x, etc and proper kryo version?",590398442,2017-01-04 08:07:02
20101537,32008959,94510210,3,"we'll need to bump this as well - that'll get covered by the cherry-pick, I guess.",590398442,2017-01-04 08:09:02
20101537,7111,94510424,3,"huh, I guess we overlooked this.",590398442,2017-01-04 08:11:12
20101537,32008959,94512043,35,"Oh! Nice, I didn't realize that I DID merge these changes and that they're backwards compatible. Nice.",590436124,2017-01-04 08:25:55
21662981,7111,102629325,42,I don't think we can do this. Storm 1.0 actually transitively depends on chill 0.8 so this does not make sense.,629578205,2017-02-23 10:55:04
25822539,7111,123865698,204,"we don't need a `var` to a mutable stack do we? I think a `val` here is fine and no need to reassign below (or use a `var` to a `List[Class[_]]` as the stack, or use a tail-recursive loop and no var or mutable. :)",721797907,2017-06-24 07:38:42
25822539,7111,123865797,31,"is this false before? Can we add a test that checks that?

Ideally we see something fail until we run the cleaner.",721797907,2017-06-24 07:41:10
25822539,7111,123865744,339,"this looks like you've just reformatted, right?",721797907,2017-06-24 07:39:39
25822539,7111,123865411,53,"can we add `: Unit = ` since procedure syntax is deprecated?
",721797907,2017-06-24 07:32:12
25822539,7111,123865401,39,can we make this `final`?,721797907,2017-06-24 07:31:51
25822539,7111,123865510,80,`:Unit =`,721797907,2017-06-24 07:33:47
34303264,7111,165170498,38,"can you add all new items at the end of the list? Otherwise, I think we could change the tokens and some people have (ill-advisedly) persisted kryo data into long term storage.",897470263,2018-02-01 04:01:18
34303264,7111,165171536,7,"so this test protects the future, but not people in the past right? They all get broken right?

Could we work around that? Maybe add a new registrar that people can opt in to adding?",897470263,2018-02-01 04:05:36
34303264,32861838,165376809,38,yes... I will follow your next proposal and put all new items into a separate registrar.,897470263,2018-02-01 22:47:30
34303264,32861838,165378836,7,"Right, this would break compatibility for projects that have already used chill for long term storage. Defining a separate registrar is OK for me (although the order of entries in the registrar will be less orderly that way).

I'm thinking along these l",897470263,2018-02-01 22:53:38
44695547,7111,213055462,6,I think we should use `TraversableSerializer` here. I think `.forConcreteTraversableClass` will do the job.,1114012357,2018-08-28 00:41:39
1327480,44018,3927771,6,"you forgot to replace ""/brokers""",37745338,2013-04-24 03:54:08
1562794,7111,4603132,53,I like this approach.,44049478,2013-06-09 06:54:50
1562794,7111,4603135,47,Is ScalaScheme a dumb name? Why not just tormenta.Scheme[T]?,44049478,2013-06-09 06:55:45
1562794,7111,4603138,79,"If we are doing this, why not take an Iterable from the beginning?  I guess some of these will be Iterable already and the toIterable will be a noop. Hmm..",44049478,2013-06-09 06:58:32
1562794,7111,4603142,22,+T?,44049478,2013-06-09 07:00:04
1562794,7111,4603151,57,what is you return an empty Vector?  Will this match work?  Why not .isEmpty here?,44049478,2013-06-09 07:03:57
1562794,7111,4603152,45,"Sleep is super evil. I'm skeptical about this, but I don't know storm well enough. Let's chat in person about this one.",44049478,2013-06-09 07:05:28
1562794,44018,4625463,57,Nil matches the empty vector.,44049478,2013-06-11 06:02:29
1562794,44018,4625467,22,"Yup, unfortunately",44049478,2013-06-11 06:02:41
1562794,44018,4625484,79,"Yeah, stupid Storm only uses Scheme when decoding from bytes. Do you mean take an iterable instead of an array?",44049478,2013-06-11 06:03:55
1562794,44018,4625488,47,"Yeah, probably better.",44049478,2013-06-11 06:04:07
1562794,44018,4625511,45,"It's Storm's Time class, which works together with Storm's testing time-manipulation features.",44049478,2013-06-11 06:05:57
1562794,7111,4625747,79,I meant on like 67 and then 71,44049478,2013-06-11 06:29:03
1562794,44018,4625787,79,"Confirmed that Iterable no-ops, so I like the more general solution. http://www.scala-lang.org/api/current/index.html#scala.collection.Iterable",44049478,2013-06-11 06:32:42
1562794,7111,4625828,47,Can this be +T?,45038461,2013-06-11 06:36:22
1562794,7111,4625837,70,"doesn't need to be T, `cast[U](u: U)`",45038461,2013-06-11 06:37:00
1562794,7111,4625849,71,I think we can get the T out of here for variance,45038461,2013-06-11 06:37:55
1562794,7111,4625859,20,"`[-T, +U]` I think",45038461,2013-06-11 06:38:38
1562794,7111,4625869,20,but not a big deal as long as SchemeSpout has variance,45038461,2013-06-11 06:39:41
1562794,7111,4625978,26,"I don't think this is what we want. Why does the result have to be to super class?

Why not:

`def getSpout[R](transformer: Scheme[T] => Scheme[R])`
or:
`def getSpout[U >: T, R](transformer: Scheme[U] => Scheme[R]):`",45042190,2013-06-11 06:53:10
2067382,7111,6225457,35,"you are calling toList here anyway, why not make it a val so it is safe to call getSpout more than once.
```scala
private val itemsList = items.toList
```
And make sure to use itemsList in flatMap.

The Once part of TraversableOnce is important. The",57695343,2013-09-08 00:14:14
2067382,44018,6226273,35,good call. changed.,57695343,2013-09-08 05:16:49
2121853,2523602,6574082,26,"@sritchie It is just sticking type on TraversableSpout. I thought most people working with Avro will need these so I pushed them back out and wrote bunch of tests. At the end of the day, it is just a specialize subtype of  TraversableSpout with bunch of t",58293138,2013-09-25 19:39:33
2121853,44018,6574305,26,"I guess what I'm wondering is, why do we need a specialized type? I think the tests you added should all pass with the basic traversablespout, right?",58293138,2013-09-25 19:45:54
2121853,2523602,6574558,26,"yes they would. I will modify the tests to work directly off of
traversablespout
and send a PR


On Wed, Sep 25, 2013 at 9:46 AM, Sam Ritchie <notifications@github.com>wrote:

> In
> tormenta-avro/src/main/scala/com/twitter/tormenta/spout/avro/Avr",58293138,2013-09-25 19:53:46
3684505,7111,13309345,29,can you comment if this code needs kafka08? It looks quite similar to the 07 code. I wonder if we could avoid the duplication at all.,111087455,2014-06-03 02:52:57
3684505,2523602,13310818,29,"Yes the code looks very similar but it is using Kafka-08 APIs underneath
which are not backward compatible with Kafka 07


On Mon, Jun 2, 2014 at 4:53 PM, P. Oscar Boykin <notifications@github.com>
wrote:

> In
> tormenta-kafka-08/src/main/scala/c",111087455,2014-06-03 03:32:52
3684505,4714717,18428339,34,"You can use ""org.apache.storm""  % ""storm-kafka"" % ""0.9.2-incubating"" instead of storm-kafka-0.8-plus. storm-kafka-plus was merged back into storm-kafka and is no longer being maintained.",114071062,2014-10-04 14:20:40
3684505,4714717,18428355,39,"I don't think forceFromStart should always be set to true. The optional parameter forceStartOffsetTime determines the start point and defaults to -1 (LatestTime) . It isn't related to the stateUpdateIntervalMs.

See: https://github.com/kafka-dev/kafka/b",114071062,2014-10-04 14:29:21
3949015,319889,13991019,24,"Don't do it like this, basically you build a new sub class with the previous metrics + these being the result of a metrics call. -- If you look how we do the flatmap operations you should see the model.",128571978,2014-06-20 01:14:27
3949015,7111,13998414,24,"that's what we had before, though.",128571978,2014-06-20 03:39:41
3949015,232760,13998478,24,"Yea, we can leave it as we had before, but then modify summingbird code ( https://github.com/twitter/summingbird/blob/develop/summingbird-storm/src/main/scala/com/twitter/summingbird/storm/StormPlatform.scala#L223) to catch the returning new object after ",128571978,2014-06-20 03:41:42
3949015,7111,14200037,6,"I think you are only using chill-java here. chill, for historical reasons, depends on chill-java and is where the scala serializers live.",130667309,2014-06-25 22:28:29
3949015,7111,14200073,6,"Nevermind, I see that you are using the ScalaKryo... below.",130667309,2014-06-25 22:29:30
3949015,7111,14200155,27,why this change?,130667309,2014-06-25 22:30:42
3949015,7111,14200406,12,why do we need this? It seems like it is dangerous in that it will throw away already registered metrics.,130667309,2014-06-25 22:35:44
3949015,7111,14200606,35,"I'm a bit concerned about adding the diamond dependency on chill here just for this 8 line class. Maybe it is better in summingbird or internally where there is already a chill dependency.  What do you think?

Sorry that dependency management is a pain.",130667309,2014-06-25 22:39:57
3949015,7111,14200680,8,"why isn't this the same as:

```scala
spout.registerMetrics(metrics).getSpout(transform)
```
Why do we need a method that throws away the old metrics? Nervous here.",130667309,2014-06-25 22:41:03
3949015,319889,14201085,35,"I wonder should we just be folding tormenta into summingbird.... does it get used much outside it? without these we can't really do the metrics, which then comes up in the SchemeSpout. (we can do flat map transformers but not metrics i guess?)",130667309,2014-06-25 22:48:08
3949015,232760,14201159,27,We need to be able to access the metricFactory from FlatMappedSchemeSpout (line 36),130667309,2014-06-25 22:49:41
3949015,232760,14203794,12,"getSpout(transform, metrics) is called from getSpout and passed the metricFactory. metricFactory is appended to in registerMetrics call, so all metrics should show up in that def. Are you talking about KafkaSpout and KestrelSpout here? There yes, we don't",130667309,2014-06-25 23:36:29
3949015,232760,14205790,8,"What do you mean by old metrics?

I worked through trying to remove the metrics as an explicit parameter to getSpout() and instead using the member function metricFactory to pass the metrics to RichStormSpout (in internal KafkaSpout). The issue is: we s",130667309,2014-06-26 00:09:07
4032939,38527,14369012,24,"It looks like https://issues.apache.org/jira/browse/STORM-263 was resolved, do we still need this different Externalizer?",132429000,2014-07-01 00:08:55
4032939,38527,14369019,36,I think https://issues.apache.org/jira/browse/STORM-263 was resolved?,132429000,2014-07-01 00:09:02
4032939,319889,14369259,36,"The namespace for the storm project has moved to apache, moving onto the latest version isn't straight forward :/",132429000,2014-07-01 00:14:09
4032939,7111,14369731,35,why `-T` but not `+U`?,132429000,2014-07-01 00:22:03
4032939,38527,14369788,21,isn't IRichSpout Serializable?,132429000,2014-07-01 00:23:11
4032939,7111,14377396,27,please put your name here. Sam and I did not write this.,132429000,2014-07-01 02:38:03
4032939,7111,14377481,65,remove this. Just use getSpout.,132429000,2014-07-01 02:39:46
4032939,7111,14377541,64,"add a `.transformWith(transformer: SchemeTransformer[T, R]): SpoutProvider[R]` method instead of getSpout below.
",132429000,2014-07-01 02:40:55
4032939,7111,14377637,64,What is the contract of getSpout here? What are the Tuples that come out?,132429000,2014-07-01 02:43:26
4032939,7111,14377685,35,Why is this a case class? Seems like a trait is better choice. I don't think we will be doing case matching on these.,132429000,2014-07-01 02:44:40
4032939,7111,14377717,35,"We should add a not that this is isomorphic to FlatMapFn is scalding: 
https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/typed/FlatMappedFn.scala",132429000,2014-07-01 02:45:25
4032939,7111,14377738,37,collect might be nice here.,132429000,2014-07-01 02:45:48
4032939,7111,14377805,20,"shouldn't we put this on the base trait? Seems weird that you have to work the SpoutProvider to get flatMap/etc... That was not the case before, right?",132429000,2014-07-01 02:46:53
4032939,7111,14377886,23,can we add comments here. What if we wrap twice? Why isn't this on the base SpoutProvider? Can you add a comment to that effect?,132429000,2014-07-01 02:48:53
4032939,7111,14377894,17,`trait Proxied[+T]`,132429000,2014-07-01 02:49:10
4032939,7111,14377950,21,I prefer `trait SpoutProxy[T <: IRichSpout] extends IRichSpout with Proxied[T]` so we don't have type erasure on self.,132429000,2014-07-01 02:50:38
4032939,7111,14378028,34,"```scala
class RichStormSpout[T <: IRichSpout](val self: T,
  @transient metrics: () => TraversableOnce[Metric[_]]) extends SpoutProxy[T] {
```",132429000,2014-07-01 02:51:42
4032939,7111,14378075,34,rename fn to pollFunction.,132429000,2014-07-01 02:52:45
4032939,7111,14378254,17,"can you add some comments here as to what fn was doing? Previously, while extending Spout[T], it was clearer.

Why is the fn here? It seems like a bolted on flatMap which should really just be the .flatMap function on SpoutProvider? Why not wrap this is",132429000,2014-07-01 02:56:31
4032939,7111,14378369,24,Can we add a todo and a link to the copy-paste of this? Was it in scalding or summingbird that this also appears?,132429000,2014-07-01 02:59:12
4032939,319889,14380934,24,Its in summingbird also. I've added an issue and when updated there'll be a todo in the code here linking to the issue.,132429000,2014-07-01 04:06:22
4032939,319889,14381478,64,"This is called at the end similar to toPipe from typed pipe to just hand off to storm. So getSpout has no contract on the output of the types. A spout provider has the output type of T, but there isn't any way I know of to enforce this contract on the inn",132429000,2014-07-01 04:20:44
4032939,319889,14381560,65,"I'm not sure exactly how that should be done, if getSpout returns a SchemeTransformer => Spout instead of spout I can see it. But I might be missing something? ",132429000,2014-07-01 04:23:11
4032939,319889,14382140,37,Added collect,132429000,2014-07-01 04:38:44
4032939,319889,14382159,64,** edit. I added a simple Spout trait. It purely has a type T to indicate the type of the output of the spout.,132429000,2014-07-01 04:39:07
4032939,319889,14382462,23,"Mostly to keep the base trait small is why, the flatmap ones being lifted out seemed like a nice separation, so these ones are too. Will add comment as to how multiple ones behave.",132429000,2014-07-01 04:50:24
4032939,319889,14382610,17,"The twitter spout is a bit special since it doesn't use a scheme. I didn't want to be overriding all the methods for metrics or flatmap functions if i could. I've added that Spout trait so its more obviously typed, and pass in the SchemeTransformer to it.",132429000,2014-07-01 04:56:09
4032939,38527,14431687,31,"As with Oscar, I am a bit confused as to why the getSpouts are directly coupled with needing a transformation?",132506239,2014-07-02 03:13:26
4032939,38527,14431768,33,"as above, why is getSpout coupled with a transformer, instead of transforming the provider and then calling getSpout? It feels like we are mixing two things here, one is the transformation of the closure and the other is getting the provided thing (true i",132506239,2014-07-02 03:15:33
4032939,38527,14432605,36,you ignore the transformer?,132506239,2014-07-02 03:41:36
4032939,319889,14432820,36,Mm... that seems bad,132506239,2014-07-02 03:46:25
4567680,38527,17486670,23,"since you have matchers, why not use shouldBe instead?",155920674,2014-09-12 20:59:55
4567680,38527,17486699,19,```result.asScala shoulBe empty```,155920674,2014-09-12 21:00:28
4567680,319889,17487346,19,"These are not Predef asserts, they are scalatest ones, which are all sorts of awesome",155920674,2014-09-12 21:12:35
4567680,38527,17487640,19,"ooh, are these the ones that give you structural information? regardless, looks good then!",155920674,2014-09-12 21:18:31
4567680,319889,17487702,19,"Not full structural, but they do auto break out the assert and make nice errors. The full diagramatic ones ran into some bugs in algebird. Enabling them again isn't hard with a few regex's so we should probably try again at some point. They do make some a",155920674,2014-09-12 21:19:38
4968281,319889,18994554,5,change to be an def openHook(fn: => TopologyContext => Unit,173217313,2014-10-17 04:53:30
4968281,319889,19042986,9,This looks wrong? as did the old one. Why is the function defined rather than being abstract? or a sys.error at the least,173560416,2014-10-18 01:56:58
5310515,232760,21552203,6,algebird seems to be not used here?,184853928,2014-12-10 01:56:44
10948694,7111,47046298,19,"I can't see that the return type is correct and this is not going to do something wonky.

Could you do: `(result.asScala.toList.map(_.get(0)): T) == expectedResult` so the compiler will fail if it is broken, or the new state of the art:
```scala
def e",357247338,2015-12-09 10:57:50
16342767,7111,75237472,62,do you want to use `var hook1 = 0` and then `hook1 = hook1 + 1` and make sure we wind up with `1`? This isn't checking for multiple calls.,494929943,2016-08-18 08:46:11
16342767,2221968,75356806,62,"The closures that set these also check for multiple calls.  But I can switch it out for `AtomicInteger`, etc., if that's cleaner.",494929943,2016-08-19 00:58:05
18731748,7111,87529336,11,"I think it is polite to duplicate this:
https://github.com/twitter/bijection/blob/develop/bijection-core/src/main/scala/com/twitter/bijection/BinaryBijections.scala#L67

But maybe we can be sure that it does not matter that we mutate the caller? Can we",553928394,2016-11-11 10:47:16
18731748,7111,87529414,20,while you are at it can you make this: `Scheme(Iterator.single(_))`,553928394,2016-11-11 10:48:38
18731748,134219,88598082,11,"This part (`ByteBuffer`) is kinda concern me. I'm not sure what is a best way to mirror `ByteBuffer` in tormenta:
- we can make `ByteBuffer` -> `ByteArray` transformation in tormenta's spout/scheme itself and expose old API with `ByteArray`. 
- we can e",553928394,2016-11-18 12:27:20
18731748,7111,88715155,11,"One thing is that if we are always copying the ByteBuffer we are losing wins from using ByteBuffer.

I wonder if we should use Bufferable here, which assumes ByteBuffer:
https://github.com/twitter/bijection/blob/develop/bijection-core/src/main/scala/co",553928394,2016-11-19 02:47:40
18731748,134219,88744064,20,Done,553928394,2016-11-19 05:35:34
18731748,134219,88744434,11,"`Bufferable` looks awesome, updated.
I'm wondering should I move `BufferableScheme` to tormenta-core (I don't like dependency on bijection from core), leave as now in tormenta-avro (I think this one is the best) or create separate tormenta-bijection (whi",553928394,2016-11-19 05:37:51
18731748,7111,88757054,18,"this does not seem to have anything to do with Avro, does it? Why can't this go in the core of tormenta?",559183220,2016-11-19 07:07:32
18731748,7111,88756798,25,can we see if `: Manifest` can be replaced with `: ClassTag` using the latest bijection? Manifest is deprecated and we really need to move off of it. Removing it everywhere would be nice.,559183220,2016-11-19 07:05:23
18731748,7111,88757129,21,can we have an apply method that takes a `Bufferable[T]`?,559183220,2016-11-19 07:08:07
18731748,134219,88906799,25,Done,559183220,2016-11-21 22:41:00
18731748,134219,88906933,18,"That's true but I decided to leave it here, I prefer do not introduce module for one simple class.",559183220,2016-11-21 22:41:35
582006,44018,2275906,80,"This LOOKS like it was a typo. Fixing it in the move. Any comments, anyone?",20487040,2012-11-30 15:39:12
582006,44018,2556817,80,Fixed in a different pull req.,20487040,2013-01-05 07:04:12
582006,7111,2560843,38,"why the call to .super? Super is just pass through, right? Why not just not override?",29462983,2013-01-07 06:02:55
582006,7111,2560845,39,Why the call to super?,29462983,2013-01-07 06:03:11
582006,7111,2560847,21,Why not go ahead and put this in scalding?,29462983,2013-01-07 06:04:44
800646,12202,2623453,0,please add copyright/license headers,25555773,2013-01-12 03:28:12
800646,12202,2623456,0,please add copyright/license headers,25555773,2013-01-12 03:28:19
800646,12202,2623457,2,please add copyright/license headers,25555773,2013-01-12 03:28:25
800646,12202,2623458,2,please add copyright/license headers,25555773,2013-01-12 03:28:31
800646,12202,2623462,2,please add copyright/license headers,25555773,2013-01-12 03:28:39
817246,44018,2687228,5,"Are we explicitly using chill anywhere in scalding-commons? If so, we still need this, we can just bump the version.",25851552,2013-01-18 03:35:17
817246,44018,2687268,52,Did elephant-bird do this with a threshold? Could we increment a counter of the total + of tuples processed as well and pass that into `shouldError`?,25851552,2013-01-18 03:37:36
817246,7111,2687272,43,"We should print at least the number of errors we got, and perhaps the last one.",25851552,2013-01-18 03:37:45
817246,568000,2687270,5,"oops yes added it back in, with the bumped version.",25851552,2013-01-18 03:37:44
817246,7111,2687331,43,"actually, I'd rather:
```scala
// This possibly throws
def check(errors: Iterable[Throwable]): Unit
```
And then, your code becomes:
```scala
errors += e
check(errors)
None
```
And then the subclass can control the exception.",25851552,2013-01-18 03:42:07
817246,568000,2687718,43,"Agreed with changing it to check, and that is now fixed. I'm doing e.printStackTrace() to print out each error. I think that's fine for default logging behavior for now, but would you rather it be something else?",25851552,2013-01-18 04:14:42
817246,568000,2687665,52,I wrote the ErrorThresholdLzoCodec so anyone who wanted to just use a simple number threshold could do that easily. I think that addresses this?,25851552,2013-01-18 04:09:20
817493,7111,2689894,29,"I'm nervous about deleting rather than marking deprecated.

Why do you prefer to delete?",25853254,2013-01-18 07:10:46
1199094,44018,3165021,64,"Would you mind making the ""reducers"" argument optional as well?",34045271,2013-02-27 09:03:04
1261649,44018,3456715,102,removing this field means that it's currently not possible to read out of a pail. Can you keep this argument and make a second method in the companion object that instantiates a pailsource meant for reading? maybe `def source` and `def sink` instead of `d,36529807,2013-03-21 00:39:26
1261649,7111,3461996,94,"This should be an implicit parameter, which is how Bijection/Injection was designed to be used (as a typeclass).",36529807,2013-03-21 05:13:29
1261649,7111,3462012,94,"Instead of taking mytype, can you take (implicit cmf: ClassManifest[T]) and then use .erasure to get the class out below.",36529807,2013-03-21 05:14:22
1261649,7111,3462022,39,"It is better to write an example that uses Inkection more directly.

1) Can you take an implicit injection (commented below).
2) If you need to reference that injection, the two ways I would recommend: Injection.int2BigEndian or Injection.connect[Int, ",36529807,2013-03-21 05:15:19
1261649,7111,3462073,23,"Where is this limitation imposed? Can you make a link to that code?  That really sucks.

Does it not even give you the JobConf or anything?",36529807,2013-03-21 05:20:09
1261649,7111,3499025,150,"No need for this, right?  This is the default implementation.",36876359,2013-03-23 05:05:37
1261649,7111,3499031,153,Can you prefer: /**  */ style comments which get picked up by the scaladoc tool?  These are ignored.,36876359,2013-03-23 05:06:04
1261649,7111,3499039,170,Can you add a comment that this is to guarantee a default constructor which dfs-datastores uses internally to call .toString (is that what you said?),36876359,2013-03-23 05:07:22
1261649,7111,3499048,70,Can you write the return type (which makes it easier to keep binary compatibility).,36876359,2013-03-23 05:08:33
15615927,269478,78304237,29,can you just remove these lines rather than just commented out them?,470372252,2016-09-12 05:57:20
15615927,269478,78304242,34,Same here.,470372252,2016-09-12 05:57:32
15615927,269478,78304264,38,"import all the dependencies, rather than importing *",470372252,2016-09-12 05:58:28
2799813,83686,9168474,2,Typo.,82744824,2014-01-25 07:39:19
790826,7111,2601683,39,can we get a lower case for vals? Any reason to not stick with that convention?,25306808,2013-01-10 14:01:00
790826,20591,2601791,39,"sure, I have no preference, its your library. The reasoning for the uppercase is that they are a form of constructor.

will get to it soon.",25306808,2013-01-10 14:34:19
816743,7053,2682303,30,Maybe ```ThriftStructCodec``` since this is what the class is called? Scrooge uses a different name for Java generated classes.,25848005,2013-01-17 22:45:11
816743,141360,2689439,2,Update to 2013?,25847967,2013-01-18 06:23:02
816743,44018,2677454,30,"Maybe just `ScalaCodec`, since `scrooge` is already in the package name. Same comment for classes below.",25848005,2013-01-17 14:19:05
816743,44018,2677457,22,Do you need this import?,25848005,2013-01-17 14:19:27
816743,44018,2677471,13,"Man, bummer that we need to pull in util-codec (though I don't see this code depending on this explicitly?

I bet if this target adds ""http://maven.twttr.com/"" as a repository, you can remove the exclusion and this explicit dependency on util-codec. Thi",25848005,2013-01-17 14:21:31
816743,7053,2684252,30,Ah that would not work because of masking. Sure ```ScalaCodec``` sounds good.,25848005,2013-01-18 00:36:16
837754,7111,2749248,35,need a test for function.,26117419,2013-01-24 04:30:20
837754,7111,2749254,32,use isBijection to check both direction.,26117419,2013-01-24 04:30:36
839866,7111,2753581,136,yes it does. Please move there. no print statements here.,26252346,2013-01-24 11:25:53
839866,7111,2753594,120,"This are not needed. They are just transformations of the Function2[Int,Int,Option[Int]] which does the same thing (that's the reason we have bijection!)

See https://github.com/twitter/bijection/blob/develop/bijection-core/src/main/scala/com/twitter/bi",26252346,2013-01-24 11:27:07
839866,7111,2753602,104,"Can you give a clearer description? Also, does this need to be public?",26252346,2013-01-24 11:27:46
839866,7111,2753605,50,"longer name, please.",26252346,2013-01-24 11:28:06
839866,7111,2753611,22,"I don't think you want Rep[Int] here because this was already used to refer to strings like ""123"".  You need to introduce a new type, such as:
```scala
case class EnglishInt(get: String)
```
And then I think you have a Bijection[Int, EnglishInt]. I th",26252346,2013-01-24 11:30:02
839866,7111,2753616,28,This stuff should all be private vals in the companion object for EnglishInt.,26252346,2013-01-24 11:31:34
839866,7111,2753614,22,"Actually, if you define a:

```scala
object EnglishInt {
  implicit val bijectionToInt: Bijection[Int, EnglishInt] // The compiler will find it because this is the companion object for one of the types.
}
case class EnglishInt(get: String)
```",26252346,2013-01-24 11:31:13
839866,7111,2753620,33,Good names here. Very clear!,26252346,2013-01-24 11:32:13
911094,44018,2631172,5,"So if we have Bijections in scope to, say, `Set[B]` and `List[B]` and I write `.as[Iterable[B]]`, which will this pull?

Also, should this be `[A, _ <# B]` so we follow Scala's type inference?",26773235,2013-01-14 12:48:45
911094,7111,2639455,5,"I think it will be an ambiguous implicit error, and it won't compile.",26773235,2013-01-15 02:23:30
911513,44018,2631166,7,"Man, this is ugly. I wonder if java usage is reason enough to break these out as named classes (even if it's ugly).",26774427,2013-01-14 12:42:54
911513,7111,2639376,7,"We could add a bunch of classes:

```scala
class JLong2String extends Bijection[JLong, String @@ Rep[Long]] {
  // ...
}
```
But that is a ton of work, and in the mean time, I think we should at least add these java tests.  You can add a todo, but ",26774427,2013-01-15 02:18:44
949667,7111,2881618,31,make sg implicit?,28229248,2013-02-05 02:36:49
949667,7111,2881646,56,implicit?,28229248,2013-02-05 02:38:38
949667,44018,2882044,56,Done!,28229248,2013-02-05 03:03:15
955147,44018,2921082,79,"Nice, makes sense.",28131226,2013-02-07 09:20:55
955147,44018,2921123,4,Funky.,28131226,2013-02-07 09:26:56
955329,7111,2881379,51,Predicate not supplier,28138376,2013-02-05 02:19:45
1138435,44018,2965786,74,Will this give back a null or throw? I think it throws.,29505046,2013-02-12 01:18:49
1138435,44018,2965799,74,"Ah, maybe not with enum.",29505046,2013-02-12 01:19:23
1138435,7111,2965804,74,I added a test. It gives null.,29505046,2013-02-12 01:19:39
1158442,12202,3034400,3,"You shouldn't need this, I work on JGit and we publish the bits to Maven Central.",29778885,2013-02-16 02:58:28
1158442,44018,3034793,3,"sbt-git is on an old version:

https://github.com/sbt/sbt-git/blob/master/build.sbt#L11",29778885,2013-02-16 03:26:00
1158442,12202,3035927,3,"Thanks, took of my manager hat and issued a pull request:
https://github.com/sbt/sbt-git/pull/15

Hopefully we can remove this as JGit doesn't guarantee that repo will always be available.",29778885,2013-02-16 04:48:42
1158442,44018,3036032,3,"Nice!


On Fri, Feb 15, 2013 at 1:48 PM, Chris Aniszczyk
<notifications@github.com>wrote:

> In project/plugins.sbt:
>
> > @@ -1,3 +1,8 @@
> > -resolvers += ""releases""  at ""http://oss.sonatype.org/content/repositories/releases""
> > +resolvers ++",29778885,2013-02-16 04:56:45
1158442,44018,3037984,3,Now you just need to get the public finagle build off of the public twitter maven repo.,29778885,2013-02-16 08:08:32
1161487,44018,3040602,5,nitpick -- weird wrapping! Wrap the whole parameter.,30190967,2013-02-17 09:56:36
1261629,44018,3456371,17,still good?,36529666,2013-03-21 00:25:02
1576078,44018,4879646,5,How about we keep 2.10.0 in here as well? Or is that a silly way to proceed?,44975089,2013-06-26 03:25:34
1576078,132262,4883610,5,"I think that all of the 2.10.x scalas are supposed to be binary compatible forwards and backwards.  The new style of publishing for scala packages is to only publish 2.10 instead of the full version, so a publish which published to both 2.10.0 and 2.10.2 ",44975089,2013-06-26 08:36:19
1622757,7111,2557117,40,"I think this should have ```andThen Bijection.utf8``` and return ```: Bijection[T,String]```",25150071,2013-01-05 07:53:48
1622757,7111,2557118,20,"return ```Bijection[T,Array[Byte]]``` instead, I think.",25150071,2013-01-05 07:54:10
1622757,7111,2557123,31,"return ```Bijection[T,Array[Byte]]``` I think.",25150071,2013-01-05 07:54:30
1630871,7111,4844002,6,I think we want both the Option version and this one (to keep some compatiblity with existing code). If you do `.as[Option[T]]` you just throw away the exception and return None.,47014447,2013-06-24 20:15:48
1630871,7111,4844086,17,"Don't we want a `getOrThrow(e: Either[Throwable, T]): T` which will throw the original exception? I am afraid this code swallows all the errors:
```scala
scala> Left(new Exception(""h"")).right.get
java.util.NoSuchElementException: Either.right.value on ",47014447,2013-06-24 20:18:53
1630871,2618,4845015,6,will do.,47014447,2013-06-24 20:50:01
1630871,2618,4845045,17,will look into this.,47014447,2013-06-24 20:51:23
1707565,7111,5072247,83,"Should this not be `[T, String]`? Json is always a string right?",48171359,2013-07-08 23:32:02
1707565,13197,5074085,83,"Hi Oscar,

The problem with using [T,String] is that I would have to convert Array[Byte] to a String and back myself and that opens the whole issue of Charset encoding. Should I use UTF-8, platform's default charset or let the user specify the Charset e",48171359,2013-07-09 00:44:47
1712588,7111,5071449,39,"no need for this one. If you use: `Bijection.connect[DateTime, java.util.Date]` it will find this from the inverse of the above.",48169967,2013-07-08 23:04:11
1712588,7111,5071517,9,please make a bijection-jodatime package. We want bijection-core to have no dependencies other than java and scala.,48169967,2013-07-08 23:06:10
1712588,7111,5071532,16,this is a bijection. Remove here.,48169967,2013-07-08 23:06:34
1712588,7111,5071564,8,this one is already defined in numeric bijections.,48169967,2013-07-08 23:07:33
1712588,2027151,5089187,8,Done. I removed date2Long,48169967,2013-07-09 18:17:27
1712588,2027151,5089224,39,You are correct. Done.,48169967,2013-07-09 18:18:45
1712588,2027151,5107271,9,the new pull request that I submitted has a new package with the build.scala modified to incorporate dependency. ,48169967,2013-07-10 08:04:56
1712588,2027151,5130140,1,I have already changed the package name in pull request [4fefd06] (https://github.com/CruncherBigData/bijection/commit/4fefd06af150a7d156d419f6582809f42267a3e8) ,48452594,2013-07-11 04:18:21
1712588,7111,5071416,14,this is not a bijection (the invert might fail). Please only add it as an Injection,48169967,2013-07-08 23:02:59
1712588,7111,5126369,1,the joda should be moved to the new directiory and package you made.,48452594,2013-07-11 01:31:33
1712588,7111,5156377,1,"Please push to this branch, so that this pull req is updated or close this one and start a new one.

If I still see joda here, it is still in this pull request.",48452594,2013-07-12 05:14:56
1712588,2027151,5089650,9,"Would you kindly explain ""bijection-jodatime package"" , do you want me to add the dependency here in the library dependancy section .... or no dependancy at all. Can you give me an example please.
```scala
  lazy val bijectionCore = Project(
    id = """,48169967,2013-07-09 18:36:56
1712588,7111,5071423,33,only an injection,48169967,2013-07-08 23:03:13
1712588,2027151,5089217,33,Done. I removed from joda2String DateBijections,48169967,2013-07-09 18:18:23
1712588,2027151,5089200,14,Done. I removed date2String from DateBijections,48169967,2013-07-09 18:17:54
1712588,2027151,5092967,9,got it thanks.,48169967,2013-07-09 20:36:46
1712588,44018,5090944,9,"Bijection is split into a bunch of submodules: bijection-guava, bijection-json, bijection-netty, etc, all of which depend on bijection-core. 

All of these lazy vals are separate modules:

https://github.com/twitter/bijection/blob/develop/project/Buil",48169967,2013-07-09 19:32:23
1723192,7111,5078194,20,Can we leave this with a TODO for 0.6.0?,48180617,2013-07-09 03:31:53
1723192,44018,5078229,20,"Sure, done",48180617,2013-07-09 03:33:25
1761939,7111,5179773,10,"no need to extend GeneratedTupleInjections.
",48591350,2013-07-13 21:30:17
1761939,2027151,5180666,41,ok I will work on writing the test cases for it. ,48591350,2013-07-14 04:58:43
1761939,7111,5179772,9,"no need to extend GeneratedTupleInjections.
",48591350,2013-07-13 21:30:12
1761939,7111,5179786,41,"all of these need tests. They are easy to write when you reuse the testing code in bijection-core: `isBijection[DateTime, Long]` is all you need to write after you write the test file and a generator for DateTime objects. ",48591350,2013-07-13 21:33:04
1761939,2027151,5180426,36,You are correct the [getMillis] (http://joda-time.sourceforge.net/apidocs/org/joda/time/base/BaseDateTime.html#getMillis() never throws neither does the [Long constructor]  (http://joda-time.sourceforge.net/apidocs/org/joda/time/DateTime.html#DateTime(lon,48591350,2013-07-14 03:04:30
1761939,2027151,5179178,4,you are correct. I removed both classes from the core package. ,48452594,2013-07-13 16:27:37
1761939,7111,5179761,24,"you already have the bijection, and this library automatically constructs injections from bijections.  Remove this one.",48591350,2013-07-13 21:27:45
1761939,7111,5179758,36,"isn't this a bjiection?  getMillis never throws, and construction from Long never throws, right?",48591350,2013-07-13 21:26:52
1761939,7111,5179778,7,"let's directly use jodatime. I don't see the win that we are getting by using a wrapper, and in general, it is a good idea to keep the dependencies minima due to causing diamond dependency problems downstream.",48591350,2013-07-13 21:31:32
1761939,7111,5179767,18,"this is already in NumericBijections in the main package, please remove it here.",48591350,2013-07-13 21:28:52
1761939,7111,5175641,4,"you are still importing joda in the bijection package in bijection-core.

Does that not show up in your view of this?",48452594,2013-07-13 02:50:09
1761939,7111,5323539,19,extra space.,50584809,2013-07-22 21:41:24
1761939,7111,5323526,18,let's only depend on jodatime. Deep dependencies cause diamond problems.,50584809,2013-07-22 21:40:57
1761939,7111,5323504,3,"these are merge conflict notices.

Take a look at this:
http://genomewiki.ucsc.edu/index.php/Resolving_merge_conflicts_in_Git",50584809,2013-07-22 21:39:42
1761939,44018,5354011,22,"So, this is a merge conflict -- you need to resolve the conflict (by choosing one and deleting the other).",51318508,2013-07-24 00:13:08
1761939,44018,5353990,4,These still need to be removed.,51318508,2013-07-24 00:12:32
1761939,44018,5353995,11,These still need to be removed.,51318508,2013-07-24 00:12:45
1761939,44018,5353993,6,These still need to be removed.,51318508,2013-07-24 00:12:41
1761939,44018,5356665,19,Do we need this one?,51389813,2013-07-24 01:53:09
1761939,2027151,5363037,19,"yes absolutely we do need this dependency, otherwise the build will fail.  (http://stackoverflow.com/questions/13856266/class-broken-error-with-joda-time-using-scala)",51389813,2013-07-24 08:30:47
2206066,7111,6787797,11,"might want to add the comment that you are ensuring you have the String, Array[Byte] via utf8 (which is the default, BTW, but this does make it safer in case someone accidentally changes the default (why!?!?!) in Injection).",59070684,2013-10-07 00:21:18
2206066,7111,6787800,19,"this breaks binary and source compatibility. Are you sure want to inconvenience for that? You could probably make this work just adding methods, which would keep others compatible, right?",59070684,2013-10-07 00:22:28
2206066,7111,6787814,97,"want to add a comment that this is always a UTF8 string (so the get failing is a Bug, not an exception case)?",59070684,2013-10-07 00:25:17
2206066,2523602,6805163,19,"@johnynek  I tried to keep the compatibility but couldnt find a good way to do it. The problem is that prior to Avro 1.7.5, you had SpecificRecord and GenericRecords and you needed SpecificDatumReader and GenericDatumReader to serialize/deserialize them, ",59070684,2013-10-07 23:14:53
2206066,2523602,6805189,97,I will add the comment,59070684,2013-10-07 23:15:29
2206066,2523602,6805196,11,I will add the comment,59070684,2013-10-07 23:15:46
2445633,319889,7644744,12,Is this touched on heavily outside of bijection itself? -- cleaner to just break the api if its not being used much? Or is it?,70762746,2013-11-14 06:05:54
2445633,7111,7645063,12,I doubt seriously anyone is using it on earth other than below in this file. Fix now?,70762746,2013-11-14 06:19:29
2445633,319889,7645227,12,"I think so, lets just get it out of the way, incase someone starts... :)",70762746,2013-11-14 06:25:23
2496293,132262,7848566,54,this seems to ignore the executor?,72400818,2013-11-22 12:18:51
2496293,132262,7848584,56,what is permit used for?,72400818,2013-11-22 12:20:30
2496293,132262,7848604,66,efficiency,72400818,2013-11-22 12:22:10
2496293,7111,7868143,54,"Twitter futures don't use the executor. How can we wrap them with fidelity and also use it?

Should we execute func with the executor rather than in the current thread?",72400818,2013-11-23 03:30:50
2496293,7111,7868162,56,cargo culted from util I think. It makes it impossible to call ready on the future without using Await (in util).,72400818,2013-11-23 03:31:29
2740471,7111,8997296,23,can you add spaces after `: `.,80565499,2014-01-20 13:15:22
2780471,7111,8997317,48,why is T needed here?,83760186,2014-01-20 13:18:14
2780471,7111,8997321,50,same. Can we lose T?,83760186,2014-01-20 13:18:27
3950710,319889,13997364,2,"lets stick 13.5 while we are bumping, latest stable.",128622460,2014-06-20 03:12:08
4321529,7111,15788389,4,"I think `connect[A, C, B]` works here. ImplicitBijection will reverse if needed. Can you verify that does not work?",145061441,2014-08-05 04:41:27
4321529,7111,15788406,10,"this is `connect[B, A, C]` right?",145061441,2014-08-05 04:41:54
4517810,132262,16879195,23,"you should check out the assert macro and diagrammatic asserts, it's incredibly cool.",155413705,2014-08-29 07:23:17
4517810,132262,16879237,54,"is this blocking you?  it depends on finagle, not sure I can really speed this up, but we can try to figure out if the dependency on finagle is necessary or superfluous.",155413705,2014-08-29 07:25:39
4517810,319889,16879270,54,The scrooge serializer one is blocking for this one yeah. Or we will have to do a bunch of sbt magic to not publish this target for 2.11. We have this here and in some other projects as part of serializing scrooge generated thrift objects. (Here its an in,155413705,2014-08-29 07:27:07
4517810,319889,16880979,23,"FYI for anyone else who sees this: http://www.artima.com/docs-scalatest-2.2.0-RC1/index.html#org.scalatest.DiagrammedAssertions

Those look very slick. I'll swap all these shouldEqual over to asserts to get the base info. Looks like we can flick those o",155413705,2014-08-29 09:00:07
4517810,7111,16912539,4,"nice catch (or, nice throw!)",155413709,2014-08-29 23:16:27
4517810,319889,16912961,4,"the warnings housekeeping tossed it up, also just a an interesting one: json4s needs a manifest, though in our code we can supply the call site with a TypeTag and ClassTag and scala has an implicit conversion to a manifest for it.",155413709,2014-08-29 23:24:52
4517810,7111,16913100,219,I have no idea what this TODO means anymore. :/,155413709,2014-08-29 23:27:42
4517810,7111,16913257,8,can probably remove this.,155413709,2014-08-29 23:30:20
4517810,7111,16913298,78,wonder why this is commented out. I don't recall.,155413709,2014-08-29 23:31:01
4517810,7111,16913352,27,this comment looks out of date.,155413709,2014-08-29 23:31:36
4517810,319889,16913373,78,Yeah don't really know. We could file some issues against these to re-activate or delete?,155413709,2014-08-29 23:32:06
4517810,7111,16913622,30,"Can we add the `.as[Option[T]]` test here? Maybe it will pass, but if not, we might have a hint.

It might be due to the way the .as[Option[T]] used to look for an injection. Which, perhaps we should remove, and do .tryAs[T] or something.",155413709,2014-08-29 23:36:30
4517810,319889,16913836,30,"I'm happy to add it in a different PR, but doesn't feel like it belongs here in the vein of just getting this in and hammer on more tests after?",155413709,2014-08-29 23:40:37
4517810,7111,16913980,54,"Wait, scrooge serialization depends on finagle? Seems like that is an over-fat target. Seems like there should be a target (for analytics work, for instance) that does not pull in finagle. Just the serializations.",155413705,2014-08-29 23:42:45
4517810,38527,16914493,84,"do we want to just have a method in the package which is the following:

```def klass[T](implicit ct: ClassTag[T]): Class[T] = ct.runtimeClass.asInstanceOf[Class[T]]```

Not a big deal at all but could get rid of the boilerplate at least.",154618028,2014-08-29 23:52:21
4517810,132262,16920793,54,"Yeah, I agree.  scrooge-core already doesn't depend on finagle, my guess would be scrooge-serialization could be refactored to just depend on scrooge-core and not scrooge-runtime (which does depend on finagle), but I haven't checked it out yet.",155413705,2014-08-30 02:03:08
4517810,132262,16920884,54,"Just took a look, it doesn't depend on finagle in pants, only in sbt--I think it was an oversight.  I'll look into fixing the dependencies and then see if I can publish scrooge-core and scrooge-serializer soon.",155413705,2014-08-30 02:05:25
4517810,319889,16921101,54,"Awesome @mosesn , thanks for looking into it. That would be great. As it is our workaround will let us publish for 2.11 now minus these. But would be great to have all the builds common if we can. ",155413705,2014-08-30 02:10:35
4517810,7111,16921241,84,sounds good to me.,154618028,2014-08-30 02:13:48
4550835,319889,17273783,13,be good to cut down the line length here,156830585,2014-09-09 04:19:34
4550835,319889,17273946,25,Should this have 2 dots in a row?,156830585,2014-09-09 04:23:46
4550835,319889,17273998,25,"Looks like it should from your lower usage, how does it expand?",156830585,2014-09-09 04:25:05
4550835,38527,17274165,25,"That's the quasi quotes syntax to expand into the right number of arguments

So you you do $name(..$list) it will generate code for a method call name
with list.size elements.

Quasi quotes rule",156830585,2014-09-09 04:27:20
4550835,319889,17274183,25,Wow. awesome. Yes they really do,156830585,2014-09-09 04:27:56
4550835,7111,17277255,44,"It might be worth using:

```scala
try { Success(code) }
catch {
  case NonFatal(e) => Failure(e)
}
```
Which is to say, inline the Try creation so that there is not another closure in there, while we are trying to improve performance.",156830585,2014-09-09 06:07:00
4550835,7111,17277325,38,"shouldn't we recursily convert case classes into `Map[String, Any]`? I mean, if you are using this, presumably using the case class is a problem, so we would want the whole structure flattened into a Map, right?",156830585,2014-09-09 06:10:01
4550835,38527,17455508,38,Yep -- just a matter of time to implement.,156830585,2014-09-12 04:15:11
4550835,38527,17455512,44,Good idea,156830585,2014-09-12 04:15:15
4550835,7111,17561770,77,Can we add a test checking recursive case class to tuple unwrapping?,156830597,2014-09-15 23:59:31
4550835,38527,17561807,57,"I think instead of explicitly calling caseClassToMap, we should be safe calling ```implicitly[Bijection[T, Map[String,Any]]]``` which has the benefit of allowing the user to override our generated values (currently not possible). @travisbrown, if I were t",156830597,2014-09-16 00:00:08
4550835,7111,17565722,57,"If that works, great. I guess the T is not erased since you have it in the tpe. Actually, how can that work? Won't it have to change the method signature to get the implicit bijection?

I'm happy with this working the same way all the way down. At least",156830597,2014-09-16 01:12:53
4550835,38527,17566864,77,Sure,156830597,2014-09-16 01:34:04
4555618,7111,17334891,4,"might be better to say ""Conversion.asMethod works on subtypes""",155718233,2014-09-10 04:24:45
4555618,132262,17335116,4,done,155718233,2014-09-10 04:32:04
4585466,7111,17683827,4,implicit class is the way to go on these things now.,157817046,2014-09-17 23:31:59
4585466,7111,17683891,20,extends AnyVal,157817046,2014-09-17 23:33:06
4585466,38527,17684545,4,Done,157817046,2014-09-17 23:42:27
4585466,38527,17684565,20,Can't do this if it is an implicit class,157817046,2014-09-17 23:42:45
4585466,7111,20054123,13,"this should be in TypeclassBijection if you ask me. This will be common one. Also Equiv would be interesting there.

Do this, and I think we should merge.
",156117973,2014-11-09 03:17:31
5371929,7111,21654501,91,"while you are refactoring these, I always thought the extra level of indirection here (method calls inv.apply/fn.apply), was wasteful. We don't need it in a macro. We could just inline the method calls.",185296005,2014-12-11 09:24:03
5371929,319889,21655109,91,"Sure, should update to that now...",185296005,2014-12-11 09:44:04
5371929,7111,21696131,11,"when I tried to call these macros, it says it could not use a default argument in the repl. Does this work for you in the REPL `caseClassToMap[A]()`?",186307579,2014-12-12 01:23:35
5371929,7111,21696341,15,Is this the right way to match? Can't we also `eval(recursizeApply)` and get the Boolean?,186307579,2014-12-12 01:26:09
5371929,7111,21696606,64,can we put `Try[$T]` as the return type? I saw scala infer `Try[T] with Product with Serializable` here in my fastTry macro.,186307579,2014-12-12 01:29:20
5371929,7111,21696888,46,"why not ImplicitBijection here? That is how we usually do this to deal with the Equivalence between `Bijection[A, B]` and `Bijection[B, A]`.",186307579,2014-12-12 01:32:46
5371929,319889,21697261,15,i guess most of the ones i'd seen were around pattering mattering against the expression we've gotten. We could also evaluate it. I'm not really sure which is preferable. Here i guess its a toss up?,186307579,2014-12-12 01:37:58
5371929,319889,21697268,64,sure,186307579,2014-12-12 01:38:04
5371929,7111,21722959,8,"this is weird. We can't ever use these right? Should we mark them not implicit?

I think we should just not stack them. Have something like:

```scala
object MacroImplicits {
  object Recursive {

  }
  object NonRecursive {
  
  }
}
```
the",186307582,2014-12-12 08:02:00
5371929,7111,21723008,11,Could you verify that calling using the default argument works (in the REPL)?,186307579,2014-12-12 08:03:03
5371929,319889,21723544,8,"We can use the recursive ones in the lower priority, the maps is what I was pinging you about the other day. That doesn't make sense. I think we can hit both for the case classes since only one of them will match. (Aborting in the macro just removes it fr",186307582,2014-12-12 08:19:42
5371929,7111,21724334,8,"Can you add the comment about us using abort in the macro to stop the implicit search. That will be tricky if you just look at the types.

Can we remove the map one since it does not make sense?",186307582,2014-12-12 08:41:23
5371929,319889,21724793,46,"So the test fail that its not a macro generated thing anymore, since i guess we wrap it in ImplicitBijection?",186307579,2014-12-12 08:53:57
5371929,319889,21724808,11,It doesn't... default args don't work in macros i believe... Will nuke.,186307579,2014-12-12 08:54:21
5371929,319889,21724887,8,Done,186307582,2014-12-12 08:56:51
5373316,319889,21655256,17,Does the inv type signature of A work here? since we can inline it at the callsite we can just take a FN B => A and do it in place? nifty,185305392,2014-12-11 09:49:04
5373316,7111,21695971,17,"inv is basically a lazy parameter that is inlined (same idea as fastTry).

```scala
val maybeNum = ""12""
fastAttempt(maybeNum)(maybeNum.toInt)
```
I *assume* that if we put just the function, it will inline the function object and then call the apply",185305392,2014-12-12 01:21:22
5492604,7111,21724293,5,"might be better to do:

`./sbt ++2.11.4 clean coverage test`

or something for two reasons:

1) use the local launcher script so we control the sbt version.
2) use scala 2.11, which I think scoverage requires.",186128241,2014-12-12 08:40:11
6357435,319889,25084709,17,twitter_finagle? are there other finagle projects? should drop the twitter_,220285369,2015-02-21 00:08:25
6357435,319889,25085065,12,"Should this be a finagle-mysql module? doesn't seem to use finagle core, and similarly a finagle core set of injections wouldn't want the mysql dep. Especially given its experimental",220285369,2015-02-21 00:13:22
6357435,7111,25094436,2,Let's update to 2015,220285369,2015-02-21 02:11:58
6357435,7111,25094471,17,"+1, also note the com.twitter prefix.",220285369,2015-02-21 02:12:21
6357435,7111,25097000,79,"can you use:

Inversion.attempt here?

https://github.com/twitter/bijection/blob/develop/bijection-core/src/main/scala/com/twitter/bijection/Inversion.scala#L29",220285369,2015-02-21 02:43:46
6357435,7111,25097025,91,Inversion.attempt,220285369,2015-02-21 02:44:10
6357435,7111,25097019,85,Inversion.attempt,220285369,2015-02-21 02:44:05
6357435,7111,25191100,78,"this is not how attempt works. Yours will throw if the inversion fails. It should be:
```scala
Inversion.attempt(v) { v => timestampValue.unapply(v).get }
```",221338635,2015-02-24 02:05:09
6357435,301,25192928,78,"Oh! Thanks, fixed!",221338635,2015-02-24 02:25:12
6443490,301,25442641,35,"There were some overflows happening involving timestamps millions of years in the future. I've constrained this to only generate timestamps until year 9999, that solved the problem.",223364976,2015-02-26 23:48:57
6443490,301,25442931,77,"This is here to compare two `RawValue`s generated from `Timestamp`s. Because they contain byte arrays, just `==`ing them does not work as expected.",223364976,2015-02-26 23:52:03
6443490,319889,25444388,36,would be good to stick the type on these val's here and below so can easily see what they are/how different,223364976,2015-02-27 00:08:22
6443490,319889,25444471,77,probably good to put your comment on GH here into your comment on line 90,223364976,2015-02-27 00:09:28
6903808,319889,27526175,8,"I made this do the iterator approach, but the real thing wart remover was complaining about was the use of return",238753817,2015-04-01 02:41:08
7194001,132262,28749658,15,idk should this be owned or shared?,247405294,2015-04-21 09:41:36
7194001,319889,28782209,5,is the bump required? ,247405294,2015-04-21 19:22:49
7194001,193897,28796830,5,"it's not a frivolous bump if that's what you mean, if we want the new Buf apis (Shared/Owned) we need it, but it's also possible to define a bijection for the 6.20 Bufs",247405294,2015-04-21 21:37:42
7194001,319889,28796966,5,"No thats ok, once its required to access the API's you need for the change the bump is fine",247405294,2015-04-21 21:39:09
7194001,193897,28797721,15,The [ChannelBuffer bijection](https://github.com/twitter/bijection/blob/71ed7b50d3ef4b5083060457dec6e52b6f65bad8/bijection-netty/src/main/scala/com/twitter/bijection/netty/ChannelBufferBijection.scala#L34) wraps the byte array on application and copies on,247405294,2015-04-21 21:47:36
7194001,132262,28798148,15,"Hmm, maybe we should namespace them slightly differently and supply both?  I feel like the point of Owned vs Shared was that we wanted folks to have to think about what it was OK to do with the data, so maybe we should do it here too (since we intend for ",247405294,2015-04-21 21:51:40
7194001,7111,28803259,13,"can we get some comments here to explain the differences? I guess in one case (shared?) you are copying the underlying buffer, but in the other you are not, which only makes it safe if you ""own"" the Buf/Array[Byte] in question. Is that right?",247728150,2015-04-21 22:44:54
7194001,193897,28803674,13,"That's right, it describes ownership of the underlying byte array with implications of defensive copying. I'll add a note.",247728150,2015-04-21 22:49:12
7194001,319889,28902404,13,"we now have objects Owned and shared under twitter_util, the namespacing there doesn't make too much sense. A sub package or object to put them into a Buf namespace so it aligns more with util I think would be good here",247728150,2015-04-22 23:44:16
7194001,132262,28919695,13,"actually, could we add Shared / Owned type aliases, and then use different type classes for .as[Shared] vs .as[Owned] or is scala too smart for that?",247728150,2015-04-23 03:07:26
7194001,319889,28919976,13,"I don't believe that'll work anyway -- You could though add them in as AnyVal case classes here, and make the injections be to those. It would be a similar strategy as to how the Base64String stuff is done",247728150,2015-04-23 03:11:30
7194001,7111,28921534,13,"something like:

```scala
case class Owned(bytes: Array[Byte]) extends AnyVal
case class Shared(bytes: Array[Byte]) extends AnyVal
```
then you can do `buf.as[Shared].bytes` if we want to go that way. I kind of like usage of types for this kind of d",247728150,2015-04-23 03:35:08
7194001,132262,28934424,13,"Those wouldn't work for APIs that need to take Bufs though, right?  You'd need to do `bytes.as[Owned].unwrap`, which is practically as bad as

```scala
val Buf.Owned(bytes) = buf
val buf = Buf.Owned(bytes)
```

I think @ianoc's idea for a Buf.Owned",247728150,2015-04-23 08:29:29
7194001,193897,29447395,13,@mosesn / @johnynek / @ianoc everybody happy with a com.twitter.bijection.twitter_util.Buf namespace to hold the Shared and Owned objects?,247728150,2015-04-30 21:52:50
7194001,319889,29447545,13,"Sure, good with me",247728150,2015-04-30 21:54:41
7194001,132262,29450179,13,works for me,247728150,2015-04-30 22:24:29
7732306,2523602,31200299,116,should this be ```Try{b.copyBytes}```? Are we positive this can never throw an exception?,263519543,2015-05-28 08:07:28
7732306,2523602,31200452,28,"you can also do

```
Arbitrary.arbitrary[Array[Byte]].map(new ImmutableBytesWritable(_)))

```
then you dont need ```arbitraryByteArray``` on line 25",263519543,2015-05-28 08:12:58
7732306,2523602,31200576,68,"Is the whole ```Option(...).toTry``` done to avoid a null check? IMO it would be more efficient to just do 

```
Try{
  if(null check) sys.error(...)
 else result
} 
```

",263519543,2015-05-28 08:19:28
7732306,2523602,31201302,44,I think ```buildCatchInvert(Bytes.toBytes)(Bytes.toLong)``` should be fine and Scala should infer the types?,263519543,2015-05-28 08:49:37
7732306,401065,31251407,44,"Unfortunately, scala's type inference will not. However, there may be a less verbose type annotation.",263519543,2015-05-28 21:23:29
7732306,319889,31257274,44,"buildCatchInvert[Long,Array[Byte])(Bytes.toBytes)(Bytes.toLong) might work here? ",263519543,2015-05-28 22:28:40
7732306,319889,31257388,57,"just use ()'s for the simple statement, and always . before map's

no ws after the map",263751936,2015-05-28 22:29:59
7732306,401065,31258328,44,So it does. The Wise Mr. Ian!,263519543,2015-05-28 22:39:44
7732306,7111,31357019,62,"seems like it is better to do:
```scala
Bytes.toString(b.get, b.getOffset, b.getLength) match {
  case null => Failure(new Exception(s""Could not read string from: $b""))
  case str => Success(str)
}
```
no need to throw and catch or use `Try { }`",263946420,2015-05-30 00:29:39
7732306,7111,31357330,62,"you could use fast attempt:
https://github.com/twitter/bijection/blob/develop/bijection-macros/src/main/scala/com/twitter/bijection/macros/Macros.scala#L21

which is a macro and has no perf cost:
```scala
fastAttempt(b)(Bytes.toString(b.get, b.getOff",263946420,2015-05-30 00:33:11
7732306,7111,31357383,69,"could use `fastAttempt(b)(Bytes.toInt(b.get, b.getOffset, b.getLength))`

and so on below.",263946420,2015-05-30 00:33:42
7732306,7111,31357515,30,this is not needed. This is the default.,263946420,2015-05-30 00:35:13
7732306,7111,31357722,49,"what are these testing? I don't think they are testing the ImmutableBytesWritable stuff, are they?",263946420,2015-05-30 00:37:47
7732306,7111,31357763,105,"this is testing your code, but the stuff above is just retesting existing stuff in bijection, right?",263946420,2015-05-30 00:38:23
7732306,7111,31358014,25,"this is not robust enough. I think we need something like this:
```scala
for {
  bytes <- Arbitrary.arbitrary[Array[Byte]]
  offset <- Gen.choose(0, bytes.length - 1)
  len <- Gen.choose(0, bytes.length - offset)
} yield new ImmutableBytesWritable(b",263946420,2015-05-30 00:41:36
7732306,7111,31358079,45,"the Array[Byte] ones are not from this code, are they? Can't they be removed?",263946420,2015-05-30 00:42:12
7732306,7111,31358158,74,"does this have to be a LooseInjection? Can any of them be the standard approach (Int, Long, etc?) It is better to have the tests be as strict as can be.

I would think that some of them will pass with `isInjection`.",263946420,2015-05-30 00:43:10
7732306,401065,31361824,49,"This test ensures that, in a situation where 3 different values are backed by different parts of the same byte array, the hbase injection inversions still work.",263946420,2015-05-30 01:30:01
7732306,401065,31362273,105,"Most of the `T -> ImmutableBytesWritable` injections do not use the existing `T -> Array[Byte]` injections and, instead, use overloaded `Bytes` methods to reduce copying of the underlying byte array.",263946420,2015-05-30 01:34:52
7732306,401065,31362341,25,"OK, will do",263946420,2015-05-30 01:35:37
7732306,401065,31363056,45,"These `Array[Byte]` injections may be superfluous. Their purpose is for the situation where you have a value serialized as `Array[Byte]` with hbase encoding. I would need to know more about how people use hbase before I'm confident in removing them.

Pe",263946420,2015-05-30 01:44:15
7732306,401065,31361668,30,You're talking about the `Equiv` impl? I added that earlier to ensure the test methods were picking up the right ones. I will remove it.,263946420,2015-05-30 01:28:09
7732306,401065,31370093,74,"Yes you are correct. I just checked: the `ImmutableBytesWritable` `.equals` method *is* offset and length; therefore, the strict injection check should work with the global catchall `Equiv[T]`.",263946420,2015-05-30 03:24:37
7732306,7111,31374845,49,Oh I see. The HBaseInjections are available in both `Array[Byte]` and `ImmutableBytesWritable` form. got it.,263946420,2015-05-30 05:23:30
7816021,7111,31581655,18,"you need `s""Could not read ...` not the `s` to do interpolation. This is a common bug and a bit of a pain with interpolation.

I'd recommend actually: `s""$b decoded to null, which is disallowed.""`",266067850,2015-06-03 04:27:25
7816021,7111,31581719,4,I think this is just `.dependsOn(bijectionMacros)` you don't need to depend on the test code (as we are doing in these other examples).,266067850,2015-06-03 04:28:46
7819045,7111,31589579,15,"what about Macros.fastAttempt here to avoid the closure. :) Maybe no win, but it can't hurt.",266137677,2015-06-03 07:24:39
7819045,7111,31589679,17,I wonder if it is better to do `.newInstance` here rather than deepCopy?,266137677,2015-06-03 07:27:05
7819045,7111,31589742,3,shouldn't we do the same trick on CompactScalaCodec too?,266137677,2015-06-03 07:28:51
7819045,7111,31589778,17,"also, maybe Macros.fastAttempt",266137677,2015-06-03 07:29:28
7819045,319889,31593084,15,"Perf sensitive code, might as well take every little bit. ",266137677,2015-06-03 09:30:18
7819045,319889,31593105,17,"So thats a good question, not sure why its always deep copy. I took it from the existing code. Any idea if there was a bug/functional reason between the two? ",266137677,2015-06-03 09:30:58
7819045,319889,31593144,3,"Probably, it'll take more work to go through its serialization to ensure its sane though. Do we know if its used much to make it worth it? ",266137677,2015-06-03 09:32:15
7819045,7111,31660600,3,Somehow I missed the new protocol implementation (was that left out of the first commit?) I get it now.,266137677,2015-06-04 00:30:31
7819045,319889,31660711,3,"Yeah sorry I did a got commit -am and missed the files. :/

On Wednesday, June 3, 2015, P. Oscar Boykin <notifications@github.com>
wrote:

> In
> bijection-scrooge/src/main/scala/com/twitter/bijection/scrooge/ScroogeCodecs.scala
> <https://github.com/twit",266137677,2015-06-04 00:31:38
7819045,622449,32697536,143,"you could try the trick used here:
https://github.com/apache/parquet-mr/blob/d6f082b9be5d507ff60c6bc83a179cc44015ab97/parquet-column/src/main/java/org/apache/parquet/io/api/Binary.java#L90

Charset.decode instead of new String",266181885,2015-06-18 09:00:51
7819045,319889,32699655,143,"It doesn't mention any relative performance numbers, much faster? ",266181885,2015-06-18 10:17:30
7819045,622449,32762644,143,"If this is the one that I'm thinking of, up to 40x faster, but it only applies to java6 and was fixed in java7. But I could be wrong.",266181885,2015-06-18 23:31:57
7819045,319889,32763601,143,"Well we are moving to java8, so not sure it matters much if fixed in java7

On Thu, Jun 18, 2015 at 11:32 AM, Alex Levenson <notifications@github.com>
wrote:

> In
> bijection-thrift/src/main/scala/com/twitter/bijection/thrift/TArrayBinaryProtocol.scala
>",266181885,2015-06-18 23:40:10
7819045,622449,32764662,143,"I can't really tell, a read a blog post just now that said they fixed it for single-byte charsets, but not yet for multi-byte charsets like utf8.",266181885,2015-06-18 23:48:44
8386654,7111,34673248,12,does not look like this method would need `:ClassTag` to me. Am I missing something?,279785068,2015-07-15 17:41:31
8386654,7111,34673577,12,"This is also type-unsafe. If you pass the wrong schema here, I guess nothing will fail until you go to call apply on the injection. We should at least add a comment that it is the responsibility of the caller to verify that the Schema matches the type T. ",279785068,2015-07-15 17:45:25
8386654,453150,34674558,12,"You are right about `ClassTag`, will remove it.

If the schema is similar (e.g. same record name) it seems to kind of work. When it's completely wrong, it throws `java.lang.ClassCastException: org.apache.avro.generic.GenericData$Record cannot be cast to",279785068,2015-07-15 17:56:55
8386654,453150,34675091,12,"Too bad you can't just extract a schema from the class. I could instantiate it with the default constructor and call `getSchema`, but that sounds a bit hacky.

    val record = classTag[T].runtimeClass.newInstance().asInstanceOf[T]
    val schema = rec",279785068,2015-07-15 18:02:59
8386654,7111,34681243,12,But how would this be different than: https://github.com/twitter/bijection/pull/223/files#diff-5722c7a78a89c696ada627a7d0e51c7dR104,279785068,2015-07-15 19:06:59
8386654,7111,34681072,12,"Does that work? If all Avro classes have `.getSchema` and an empty constructor, I don't actually see that as hacky.",279785068,2015-07-15 19:05:26
8386654,453150,34682132,12,"`.getSchema` is part of `SpecificRecordBase` and the empty constructor is required by the spec. The unit tests also run successfully.

The difference with `toBinary` is I'd pass in the schema to `SpecificDatum{Writer,Reader}`. If you don't, it will fail",279785068,2015-07-15 19:15:08
11781299,319889,50592082,24,"is the charset threadsafe itself? 

Maybe we should have more like a () => {
val cs = Char...
})
? if threadsafe though doesn't seem like any reason to ofc",377374080,2016-01-23 05:18:55
11781299,319889,50592224,31,"We do an extra allocation of a ByteBuffer class here always now, should we maybe only put this in the error handling portion of things?",377374080,2016-01-23 05:19:54
11781299,7111,50593276,31,"the decoder requires a ByteBuffer, so bb is that. I can't seem to find a way to avoid that allocation.",377374080,2016-01-23 05:29:53
11781299,319889,50594055,31,"Oh ok, from reading the comment i thought we were using ByteBuffer so the toString in the event of an error was nicer. It looks like we mean the toString function on the decoder is better?",377374080,2016-01-23 05:37:07
11781299,7111,50602031,31,"the attempt function includes a toSting of the argument, which in this case is the ByteBuffer.",377374080,2016-01-23 06:51:00
12003885,319889,51493436,5,does one normally not put this into the ~/.sbt/0.13 folder ?,382718895,2016-02-02 06:40:39
12003885,319889,51493496,1,Why move from project/Build.scala to a build.sbt? is this now the more blessed way? ,382718895,2016-02-02 06:41:10
12003885,319889,51493597,14,where does this formatting style come from ? ,382718895,2016-02-02 06:41:59
12003885,7111,51493974,14,me personally... :) I just cleaned it when adding do it.,382718895,2016-02-02 06:44:53
12003885,319889,51494034,14,Could we use scalriform? the old one is closer to how we format most of our scala I suppose,382718895,2016-02-02 06:45:26
12003885,7111,51494147,1,"yes, and the plugins are a pain to config without it. There is some autoImport thing that is now standard, so people assume you are using that.",382718895,2016-02-02 06:46:16
12003885,7111,51494264,5,"well, sbt release has some possibly per project options, so I put it here, but it won't publish a dirty directory.",382718895,2016-02-02 06:47:18
12003885,7111,51494389,14,Happy to. Can it run on .sbt files?,382718895,2016-02-02 06:48:07
12352358,2221968,53061540,5,"I'd put a comment, that for cases where it's possible to have 2B, just try using 2B.  I'd also drop the () and maybe just toDouble on the length, since that's the thing that can be large.",390658726,2016-02-17 03:12:45
12352358,7111,53062783,5,"actually, the bug is that dec.maxCharsPerByte returns a `Float`. That can only store all integers up to `2^{24}`. After that it steps up by 2. So the toInt truncates by 2 in that case, not rounding down by one.

I don't know what `2B` means in this case",390658726,2016-02-17 03:20:15
12352358,2221968,53064003,5,"2B = 2 billion (1 << 31), since that's how toInt handles larger values.

But yeah, Float -> Double makes more sense than integral -> Double, so that seems fine.",390658726,2016-02-17 03:28:13
13182641,7111,57202755,6,"can we add `% ""provided""` to this and the next line?",410037756,2016-03-24 00:34:31
14433216,3114547,61933066,37,If you have ideas on how to close the converter properly it'll be most welcome.,438642538,2016-05-04 01:39:08
14433216,7111,61934442,42,"what if we take an `implicit JavaFutureToTwitterFutureConverter` here as a parameter, and then it is the responsibility of the user to create and eventually stop their futureConverter?",438642538,2016-05-04 01:47:07
14433216,3114547,61944237,42,"We could do that but that would complicate the usage of the api, no?",438642538,2016-05-04 02:51:24
14433216,7111,61950318,42,"yes, but having a thread started as a private val is kind of a non-starter, I think. It will impact serialization and it will consume resources for everyone who use this or not.",438642538,2016-05-04 03:30:16
14433216,3114547,61955997,42,Yup :(,438642538,2016-05-04 04:05:11
14433216,132262,61983768,32,"This seems overly complicated (and induces a lot of latency).  How about instead the default is that we use a thread per future? the base implementation would be something like:

```scala
import com.twitter.util.{FuturePool, Promise, Future}
import ja",438642538,2016-05-04 09:05:50
14433216,3114547,62082173,32,"Wouldn't using one thread per future be a bit wasteful compared to the current approach?
On the other hand, this approach would simplify the API as there wouldn't be a need for an implicit parameter.  
Also, could you explain what you mean by ""induces a",438642538,2016-05-05 00:42:24
14433216,132262,62095553,32,"@BenFradet I think we should still use the implicit parameter.

Yes, it would be wasteful.  That's why I also proposed the Timer approach, which I think is quite similar to your approach, and is appropriate for cases where there may be many futures.  Th",438642538,2016-05-05 02:01:19
14433216,7111,62098508,32,"thread per future seems like a bad idea to me.

I'm not crazy about the polling all the time, but maybe the current approach is equivalent to the timer anyway (assuming a well implemented `Timer`).

We could do both approaches:
```scala
abstract cla",438642538,2016-05-05 02:22:03
14433216,132262,62102466,32,"@johnynek yep, that's exactly what I'm proposing.",438642538,2016-05-05 02:49:05
14433216,3114547,62164376,32,@mosesn thanks for the explanation!,438642538,2016-05-05 16:12:22
14433216,3114547,62170417,40,"Since I can't use `CompletableFuture` I found this way around, I don't know if there is a better way, feedback welcome.",439776922,2016-05-05 17:28:41
14433216,3114547,62175070,40,"For that matter, I don't know why [toJavaFuture](https://github.com/twitter/util/blob/develop/util-core/src/main/scala/com/twitter/util/Future.scala#L1232) returns a future of some subtype of A and not just a future of A.",439776922,2016-05-05 18:19:06
14433216,132262,62198104,35,"it might make sense to expose an `injection` which doesn't need a converter too, in case folks are only going `JFuture => TwitterFuture`.",439776922,2016-05-05 21:52:10
14433216,132262,62198585,42,I'm not sure this is worth entailing the dependency.  How do you feel about rolling your own with `FutureTask`?,439776922,2016-05-05 21:55:23
14433216,3114547,62213626,35,You mean going `TwitterFuture => JavaFuture`?,439776922,2016-05-05 23:32:44
14433216,3114547,62213724,42,I'll look into it.,439776922,2016-05-05 23:33:21
14433216,132262,62222113,35,"Ah, yeah, my mistake.",439776922,2016-05-06 00:30:31
14433216,132262,62222547,40,"I think it's because \forall B <: A, TwitterFuture[B] <: TwitterFuture[A], but the same isn't true for JFuture, since they encode covariance differently.",439776922,2016-05-06 00:33:16
14433216,3114547,62234543,40,"Ah ok, thanks for explaining",439776922,2016-05-06 01:46:01
14433216,3114547,62393582,48,"For some reason:

```scala
new FutureTask[T](new Callable[T] {
  override def call(): T = t
}
```
and
```scala
new FutureTask[T](new Runnable {
  override def run(): Unit = ()
}, t)
```

wouldn't work and take forever",440597257,2016-05-07 04:29:59
14433216,3114547,62415791,35,"However I'm not sure how I would go about inverting without a converter, ideas?",439776922,2016-05-07 19:15:15
14433216,132262,62419409,35,injections only need to go one way.  you can just return None if it's not a ConstFuture.,439776922,2016-05-07 23:55:15
14433216,3114547,62422829,41,"@mosesn I tried this approach, could you tell me what you think? thanks",441157176,2016-05-08 04:14:40
14433216,132262,62432960,43,we need to fail `p` too.  `p.setException(e)` should be sufficient here.,441157176,2016-05-08 21:46:51
14433216,132262,62432937,52,"the threading model is determined by the timer, not be the implementation.  most timers have a small, bounded thread pool, and they typically default to a size 1 thread pool.

it might also be worth noting that the minimum `checkFrequency` will be affec",441157176,2016-05-08 21:44:53
14433216,132262,62433027,32,maybe worth adding a note that we use an unbounded threadpool to avoid potential deadlocks.,441157176,2016-05-08 21:51:40
14433216,132262,62433086,41,LGTM,441157176,2016-05-08 21:54:17
14433216,132262,62433249,48,@BenFradet did you try calling `run` on the task after you created it?,440597257,2016-05-08 22:02:37
14433216,3114547,62709651,78,"I think we do, I haven't found out how yet.
If it'd had been a j.u.Timer we would have been able to do:
```scala
if (javaFuture.isDone) {
  p.updateIfEmpty(Try(javaFuture.get()))
  timer.cancel()
  timer.purge()
}
```
But c.t.u.Timer doesn't expo",441997882,2016-05-10 23:55:00
14433216,132262,62710263,78,we need to call `task.cancel()`.  you might need to mutate a reference.,441997882,2016-05-10 23:58:31
14433216,3114547,62711031,33,"Agreed to remove the implicit and for the doc.
I still think it's useful based on @mosesn remark that if someone needs only to go `TwitterFuture` => `JavaFuture` it makes sense to expose something which doesn't take any useless implicits.",441997882,2016-05-11 00:03:20
14433216,3114547,62529482,48,"yup, you were right :flushed: ",440597257,2016-05-09 23:32:26
14433216,3114547,62532097,52,"Out of curiosity, how do you find out the granularity of the timer you're using?",441157176,2016-05-09 23:49:25
14433216,132262,62554501,52,"read the docs :(.  you're right though, it might be useful to expose it programmatically.

briefly: j.u.Timer, 1 millisecond, j.u.c.ScheduledThreadPoolExecutor, 1 millisecond, netty HashedWheelTimer is configurable (1.ms minimum), finagle default timer ",441157176,2016-05-10 02:04:58
14433216,3114547,62559307,52,I thought you meant twitter util's Timers.,441157176,2016-05-10 02:39:13
14433216,132262,62561547,52,"@BenFradet I do, but there are many underlying implementations for the twitter util Timers.  In particular, we have support for j.u.Timer, j.u.c.ScheduledThreadPoolExecutor, netty HWT, and our own mocked out timer we can manipulate time for.",441157176,2016-05-10 02:54:25
14433216,3114547,62564581,52,"My bad then, I skimmed through [Timer.scala](https://github.com/twitter/util/blob/develop/util-core/src/main/scala/com/twitter/util/Timer.scala) too rapidly.",441157176,2016-05-10 03:13:30
14433216,7111,62593138,78,do we not need to unschedule this task once completed?,441997882,2016-05-10 06:54:07
14433216,7111,62593253,41,don't you want `TwitterFuture(jf.get)` since `.get` can throw?,441157176,2016-05-10 06:55:43
14433216,7111,62593494,33,"can we add some comment that the invert here fails on any java future that is not done? This is a bit surprising to have both an `Injection` and `Bijection` between two types. I don't think this weak one should be implicit, if you ask me. It can be here w",441997882,2016-05-10 06:58:09
14433216,7111,62593533,64,no need for `{ }` here,441997882,2016-05-10 06:58:29
14433216,132262,62888598,78,"Here's an example:

```scala
var task = null
task = timer.schedule(...) {
  ...
  task.cancel()
}
```",441997882,2016-05-12 00:18:07
14433216,3114547,62885216,78,@mosesn I'm not sure to get what you mean.,441997882,2016-05-11 23:56:59
14433216,7111,62897713,78,"you could do
`lazy val task = timer.schedule(...)  { ... task.cancel() }`

lazy val can be recursive. I prefer that to the var here.",441997882,2016-05-12 01:11:01
14433216,3114547,62899166,78,"I was afraid the first solution wouldn't work / be too awful.

I'll try the second one, didnt know this could be possible, thanks.
",441997882,2016-05-12 01:19:24
14433216,7111,62913802,78,"you'll have to force the `task` after though. Something like `require(task != null)` to actually schedule it, which is also a bit janky.",441997882,2016-05-12 02:48:07
14433216,3114547,62915803,78,indeed :'(,441997882,2016-05-12 03:00:08
17229638,7111,80334618,8,can we add a new method name and not break binary compatibility?,516523636,2016-09-24 05:00:20
17229638,453150,80358193,8,"Sure, it's what I suggested when we changed `toBinary`, but you guys decided it was unnecessary. I'll update the PR.",516523636,2016-09-24 17:18:47
17229638,7111,80531037,8,"does this actually use the `ClassTag`? I don't see where. If not, since we already dropped it in a previous version, why not correct that issue?",518939976,2016-09-27 00:47:02
17229638,7111,80531008,36,"I'd live to remove the `ClassTag` here if possible, but that would be a binary incompatible break, so we can leave it as a TODO for now.",518939976,2016-09-27 00:46:54
17229638,453150,80551190,8,"Good point, done!",518939976,2016-09-27 02:18:16
17229638,453150,80551219,36,Ok I added a todo.,518939976,2016-09-27 02:18:24
19186044,36124,89669634,43,Good catch,564208985,2016-11-26 18:33:26
19186044,8973,89669290,43,duplicate?,564208985,2016-11-26 18:11:13
19243754,7111,89886741,5,why the 3 `+++`? I thought it was just `++`?,566431119,2016-11-29 05:19:55
19243754,6636815,89889364,5,Had to hook up the sbt-doge plugin to ensure that the overridden crossScalaVersions is respected. Without this I still get the error in the 3 projects we want to skip. I think we've done something similar in: https://github.com/twitter/chill/pull/253/,566431119,2016-11-29 05:33:09
19243754,6636815,90080097,9,"Yeah so I originally tried to do that. The `+++$TRAVIS_SCALA_VERSION coverage` command doesn't work with the sbt-doge plugin for some reason (see above): https://github.com/twitter/bijection/pull/258#issuecomment-263434782

I needed to pull in the sbt-d",566478494,2016-11-30 02:54:06
19243754,7111,90062452,9,"do we need to enable this in the build? Can't we do `+++$TRAVIS_SCALA_VERSION coverage test` or something?

What is it about this change that is requiring us to always do coverage?",566478494,2016-11-30 01:37:39
19243754,36124,90066324,9,"That's a good point. As a dev just trying to see if you broke the tests, you probably wouldn't want coverage to run anyway.",566478494,2016-11-30 01:55:44
19243754,44018,90265797,5,one last thing - do we want this binary check for 2.10 as well? In algebird we only check the 2.11 build.,567381737,2016-12-01 00:10:29
19651325,132262,91911927,52,DM me and we can chat about it.,574628822,2016-12-12 17:38:35
902684,4694,2495377,54,This test appeared twice. I removed one instance.,29462984,2012-12-23 04:02:48
942658,92540,2851862,92,Got beef with this test?,26922237,2013-02-01 05:07:40
942658,75006,2851890,92,"I ripped `supports_standard?` from the other classes, it's only a private for FF now because that was the only place using it.  Does this make sense?

It was in commit 7a6cbd5f6e6c6c",26922237,2013-02-01 05:09:23
942658,92540,2853155,92,I like.,26922237,2013-02-01 06:35:49
942658,92540,2856303,44,"honestly this whole condition isn't needed, which reduces the need for the browser ivar. I doubt firefox will drop support for ""allow"" anytime soon. @imelven?",26922237,2013-02-01 14:18:16
942658,4326,2879648,44,"The tentative plan is to deprecate the old header (including the old syntax e.g 'allow') somewhere around Firefox 24 which is an ESR, but there's a lot of dependencies that need to be addressed first.",26922237,2013-02-05 00:34:35
977188,92540,2938197,5,hmm in this case we should just remove the w3c reference,29077512,2013-02-08 11:27:45
977188,92540,2938246,23,"in this case, w3c is the correct thing to use",29077508,2013-02-08 11:39:27
977196,92540,2938331,17,w3c/w3c -> WebKit/W3C,29077553,2013-02-08 11:57:58
977196,92540,2938380,17,w3c -> WebKit/W3C,29077606,2013-02-08 12:06:05
977196,92540,2938404,14,w3c -> webkit,29077607,2013-02-08 12:09:32
1142451,63283,3018092,23,I think `defined?` is pretty heavy. Why not just `if @secure_headers_options` or `if not @secure_headers_options.nil?` ? Is `nil` a valid value?,29549943,2013-02-15 02:00:33
1142451,562610,3018136,25,why not superclass.respond_to?(:secure_header_options) ?,29549943,2013-02-15 02:03:10
1142451,92540,3018257,25,This indicates my testing was incorrect or this block is never actually used. I suppose @secure_headers_options is always defined? (no nil is not a valid value here),29549943,2013-02-15 02:09:31
1142451,75006,3018579,25,"+1 on that, was gonna say it was checking `:options` and not `:secure_headers_options`

The defined check would only be needed if you ever needed to set @ivar to nil, which is probably not the case here, so an `if @ivar` is fine.",29549943,2013-02-15 02:27:57
1169884,63283,3102704,4,Uh...is this a merge conflict with the other pull request?,31714561,2013-02-22 00:45:38
1169884,92540,3104975,4,"Nah, decided even though the effect is the same, a ? method returning a boolean made more sense to me. ",31714561,2013-02-22 02:45:35
1169884,92540,3106490,4,"sorry, the other branch is based off this one, so no conflict",31714561,2013-02-22 04:13:31
1170042,92540,3105140,15,"tl;dr :forward_endpoint is used in the CSPController to forward the requests. FF_CSP_ENDPOINT represents the route to the CSPController

`:forward_endpoint` is used in the controller that forwards the csp reports. The constant represents the route that ",31715403,2013-02-22 02:54:11
1170042,63283,3108491,15,"Yeah, wow.",31715403,2013-02-22 06:14:20
1170042,63283,3102674,15,So the value of `:forward_endpoint` doesn't matter?,31715403,2013-02-22 00:43:32
1229790,63283,3289639,10,Sent *to* the server or *by* the server? (I suspect the latter?),35639143,2013-03-08 05:18:40
1229790,63283,3289665,19,Seems to contradict line 110?,35639143,2013-03-08 05:19:47
1229790,92540,3292620,10,_by_ the server. ,35639143,2013-03-08 09:04:40
1229790,92540,3292622,19,i hate this readme,35639143,2013-03-08 09:04:52
1296753,92540,3555020,78,"this should just take the header instance, not the individual values, relic of older code. some other time.",37528328,2013-03-27 22:59:12
1598590,562610,4711713,43,I always use kind_of? over is_a? but don't know if this is preferred.,45691401,2013-06-15 03:32:37
2038573,92540,6219529,17,Error if no CSP policy set,57786388,2013-09-07 01:47:29
2038573,92540,6219545,81,openssl adds the filename to the output with some decoration. There's probably a flag I'm missing to get hex output without the framing.,57786388,2013-09-07 01:48:26
2038573,92540,6219558,28,"LOL reading the write header, writing the potentially wrong header. Just another reason to store the ContentSecurityPolicy object in env and set a single string rather than doing gsub after the fact.",57786388,2013-09-07 01:49:19
2038573,92540,6219594,30,ensure this can be set during runtime (for guard-like support without restarting the server),57786388,2013-09-07 01:51:00
2038573,92540,6219598,18,this is C/P'd from above. Generalize.,57786388,2013-09-07 01:51:19
2038573,8910,6219770,75,Any reason you aren't doing this in Ruby? Only hurts platform compat and requires file I/O for no obvious reason.,57786388,2013-09-07 01:57:03
2038573,92540,6221248,75,It's a super paranoid integration test that shows it works to non ruby people. It's behind the debug flag and probably won't be in the final branch anyways. ,57786388,2013-09-07 03:08:40
2038573,72200,16560240,28,:+1: ,57786388,2014-08-22 00:09:38
2038573,72200,17022748,35,"This causes improperly formatted `script-src` when there's multiple script hashes.  As is, the output for two hashes, `abcde` and `fjhij` is:

    script-src 'sha256-abcde fghij'

This should be:

    script-src 'sha256-abcde' 'sha256-fghij'

Here",57786388,2014-09-03 04:15:47
2038573,92540,17023351,35,"It should also be sha1. Only sha1 is supported for now afaik.

Please do submit a PR if you have the time, including your other changes. Or submit a fresh PR :)",57786388,2014-09-03 04:35:17
2038573,72200,17025208,35,"Here we go: https://github.com/twitter/secureheaders/pull/109

Should it really be `sha1`? `sha256` works for me in Chrome 37.",57786388,2014-09-03 05:20:21
2038573,92540,17025312,35,Oh sweet. Didn't know that.,57786388,2014-09-03 05:23:10
2038573,72200,17081254,21,"This could be an issue if the superclass is itself a subclass of `ApplicationController`, yeah? i.e.:

    MyController < AuthenticatedController < ApplicationController

Is it too hacky to recursively look up the superclass tree until it finds `super",157163985,2014-09-04 02:24:48
2038573,92540,17086438,21,"Sounds about right, I think that's only the case when you override settings from one controller to another. I guess this has just never come up :shrug: ",157163985,2014-09-04 04:04:29
2386324,725710,7421744,49,This seems like a typo... What's with the ']' just hanging there?,68931322,2013-11-05 11:20:27
2386324,725710,7421750,45,Did you mean to remove this?,68931322,2013-11-05 11:21:12
2386324,92540,7421773,45,"yeah, using a static nonce is not something I would encourage :) in fact, I should rip out https://github.com/twitter/secureheaders/blob/master/lib/secure_headers/headers/content_security_policy.rb#L216 too",68931322,2013-11-05 11:24:18
4364225,63283,15970519,99,`elsif` -> `else`?,146689889,2014-08-08 04:16:31
4365401,63283,16012154,30,"Was there a specific reason for this, or just hygiene?",146823168,2014-08-09 00:37:01
4365401,92540,16016642,30,"Because of ```[""'nonce-#{nonce}'"", ""'unsafe-inline'""]```

We could end up with a nested array and add unsafe-inline twice. So it's more to cover up a janky api.

",146823168,2014-08-09 02:08:54
4516436,92540,16857941,7,copy/paste error ;),155227092,2014-08-28 23:19:13
4516436,3847,16858802,7,"Oops! Good catch, just pushed a fix.",155227092,2014-08-28 23:30:44
4530353,92540,17025268,5,missing a } ?,156118923,2014-09-03 05:21:49
4530353,72200,17025498,5,*facepalm* copy paste error...,156118923,2014-09-03 05:29:48
4530353,72200,17025513,5,fixed & force-pushed,156118923,2014-09-03 05:30:08
4538940,92540,17135639,43,:+1: ,156422022,2014-09-05 00:17:26
4538940,92540,17135835,22,"The experimental flag is meant to be used only in the case that you are enforcing and want to add a report-only header. So yes, set both headers.",156422022,2014-09-05 00:20:59
4538940,72200,17137951,22,Got it :+1: ,156422022,2014-09-05 00:56:29
4940792,92540,18807825,19,this line is particularly questionable,172127135,2014-10-14 08:52:41
4946746,3847,18856589,4,"It's just the 1.9 hash syntax that is causing this to fail, just change to 1.8 syntax:

`gem 'coveralls', :require => false`",172377150,2014-10-15 01:37:31
5203686,72200,20329561,108,extra newline :trollface: ,184157926,2014-11-14 05:40:05
5904974,919420,23137971,9,"This seems to work correctly, and allows stuff like the `skip_before_filters` to still work as expected.",207876044,2015-01-19 05:53:31
5904974,92540,23178914,4,"I think we should future proof this by including the headers this gem sets, even if they aren't in default headers.

i.e. csp, csp report only, hpkp, xdownload, etc",207876044,2015-01-20 01:47:58
5904974,919420,23194150,8,"Good point on that @oreoshake RE: adding the other headers to future proof it. Might also be nice if there was a way to reach in and grab the header names directly from each `Header` class, but I couldn't think of a good way to do it.",208271325,2015-01-20 06:34:28
5904974,92540,23194959,8,"Yeah, each header class does have a name constant, but with CSP it's a little awkward. I think the string values are fine.

Please add the hpkp headers too twitter/secureheaders/pull/132",208271325,2015-01-20 06:56:32
5904974,92540,23348206,9,"I feel like this would raise an error on rails < 4, default_headers wouldn't even be defined! Must be more rails method missing crap magic.",207876044,2015-01-22 07:51:51
5907671,92540,23118803,42,"nit: can you `join(';')` instead of prefixing some with ""; ..."" ?",206001895,2015-01-17 07:13:29
5907671,92540,23119132,33,nice. can you add a test ensuring this header isn't set by default?,206001895,2015-01-17 07:24:33
5907671,92540,23119686,62,please add a test for the pin values,206001895,2015-01-17 07:43:47
5907671,92540,23119727,31,is it valid to set this without at least one pin- entry?,206001895,2015-01-17 07:45:14
5907671,54115,23120437,31,"yes -- only `max_age` is required. from http://tools.ietf.org/html/draft-ietf-websec-key-pinning-21#section-2.1.1

""""""According to the processing rules of Section 2.1, the UA MUST ignore
   pin-directives with tokens naming hash algorithms it does not",206001895,2015-01-17 08:12:20
5907671,92540,23120497,31,":cool: , thanks for the pointer.",206001895,2015-01-17 08:14:58
5907671,97583,23122212,62,"@oreoshake - This (`\""#{hash}\""`) is the quoting that is necessary in Firefox 35 and will soon be mandatory in Chrome Canary. :+1: ",206001895,2015-01-17 10:11:08
5907671,97583,23122245,60,"As noted in http://tools.ietf.org/html/draft-ietf-websec-key-pinning-21#section-4.3 and http://tools.ietf.org/html/draft-ietf-websec-key-pinning-21#section-2.5:

> The given set of Pins contains at least one Pin that does NOT
      refer to an SPKI in ",206001895,2015-01-17 10:14:12
5907671,97583,23122323,45,"You may want to add a note and/or a warning that `report_uri` and `Public-Key-Pins-Report-Only` have not yet been implemented yet in Chrome: https://code.google.com/p/chromium/issues/detail?id=445793#c2 (I'm not sure of the status in Firefox). Similarly, ",206001895,2015-01-17 10:22:32
5907671,97583,23122204,80,"This block seems unneeded. Supporting a scheme relative URL in the config implies the resulting final URL will go over `http` or `https` based on some sort of context. But, it will always get set to go over `https`. I vote that `report_uri` is documented ",206001895,2015-01-17 10:09:13
5907671,97583,23122457,4,I think draft 21 is the latest. ,206001895,2015-01-17 10:41:50
5907671,97583,23125988,40,"This syntax feels a little awkward (could just be me). Given that it would be extremely rare for each pin to use their own hash type, it may make sense to just set it globally:

```
...
pin_hash: ""sha256"",
pins: [""pin1base64hash"", ""pin2base64hash""],",206001895,2015-01-17 22:35:27
5907671,54115,23128159,40,SHA256 is the currently only supported hash algorithm but I wanted this to be flexible in the case it is extended.,206001895,2015-01-18 03:10:41
5907671,54115,23128186,60,good catch ill add that check.,206001895,2015-01-18 03:14:01
5907671,54115,23128142,80,:+1:,206001895,2015-01-18 03:07:01
5907671,97583,23128503,40,"Yeah, I definitely think it should be flexible enough to support alternate hash algos. I just thought the array of hashes syntax was a bit awkward. I'll leave up to @oreoshake since it is purely stylistic preference. ",206001895,2015-01-18 03:52:40
5907671,92540,23179103,40,"LOL `secure_headers` thrives on awkward abuse of the `Hash` class. 

But seriously, I like the ""array of hashes"" syntax more than either suggestion. I never said I was good at API design.",206001895,2015-01-20 01:51:08
5907671,97583,23179202,40,Ha...fair enough :smile:,206001895,2015-01-20 01:52:49
5907671,92540,23338273,91,"please use the 1.8.7 hash syntax => (sorry, still need to support 1.8.7)",208178962,2015-01-22 04:59:45
5907671,92540,29723428,45,"How about something like 

> Be aware that pinning error reporting is governed by the same rules as everything else. If you have a pinning failure that tries to report back to the same host, by definition this will not work. 

@ptoomey3 Do people typi",206001895,2015-05-06 04:18:30
7430921,725710,29917566,4,https://tools.ietf.org/html/rfc7469 now :),254143978,2015-05-08 10:18:55
8266975,725710,33836138,5,You mean :ruby_22 at the end here?,278643465,2015-07-03 06:33:52
9707396,725710,41221680,23,"base_uri, no?

https://developer.mozilla.org/en-US/docs/Web/Security/CSP/CSP_policy_directives#base-uri",322295916,2015-10-06 07:53:42
9707396,92540,41225328,23,"definitely, thanks for the :eyes:",322295916,2015-10-06 09:38:27
9844452,55791,42276203,15,"Since we're using these in the `request.env`, it seems like they should be more unique to avoid conflicts. Maybe `SECURE_HEADERS_HPKP`, for example?",331114594,2015-10-16 23:44:09
9844452,55791,42276643,32,"It seems a bit weird to me to be using class-level instance variables so much. That seems to be how it was before this PR, but at some point do you think it would be worthwhile to to refactor to have a Configuration instance that is passed around?",331114594,2015-10-16 23:48:22
9844452,55791,42276985,78,Wouldn't hurt to freeze the results of `make_header(config)` too.,331114594,2015-10-16 23:51:05
9844452,55791,42277024,88,ditto here.,331114594,2015-10-16 23:51:30
9844452,55791,42277236,124,"This is a weird syntax for accessing a method. How about `SecureHeaders::Configuration.default_headers`, unless you think `::` is more idiomatic.",331114594,2015-10-16 23:53:25
9844452,55791,42277836,113,Using `each_with_object` instead of `inject` would save you a line on [L140](https://github.com/twitter/secureheaders/pull/181/files#diff-e7fcd10663004caed933b95e0ff2e643L65).,331114594,2015-10-16 23:59:23
9844452,55791,42277902,113,This block is pretty complex and hard to read. Do you think any of the logic could be extracted into helper methods?,331114594,2015-10-16 23:59:50
9844452,55791,42280844,117,"Are these two separate API's for overriding the config per-request? If so, it would be nice to just pick one to go with for simplicity's sake.",331114594,2015-10-17 00:29:25
9844452,55791,42281059,254,A comment here would be good. I don't understand this.,331114594,2015-10-17 00:32:30
9844452,92540,42281873,117,good call. ,331114594,2015-10-17 00:41:19
9844452,92540,42282006,113,Agreed. I think the code is trying to be too generic when there's many possible cases. ,331114594,2015-10-17 00:42:42
9844452,92540,42282957,15,All of these CONFIG_KEYS will be scoped to https://github.com/twitter/secureheaders/pull/181/files#diff-e7fcd10663004caed933b95e0ff2e643R23 in https://github.com/twitter/secureheaders/pull/181/files#diff-e7fcd10663004caed933b95e0ff2e643R160. That will be ,331114594,2015-10-17 00:52:17
9844452,92540,42283352,32,"Yeah, that will also make it easier to scope the configuration for the given precomputed overrides. ",331114594,2015-10-17 00:56:18
9844452,92540,42286035,113,Re `each_with_object` zomg I love this post ruby 1.8.7 world I now live in. ,331114594,2015-10-17 01:24:56
10282588,3847,44025053,89,missing a `:` here,341288319,2015-11-05 22:34:33
12394473,92540,53276900,13,"Much nicer! However, this should probably be a constant.",391612804,2016-02-18 14:43:44
12394473,860028,53316513,13,Derp. Late night. Thanks :smile: ,391612804,2016-02-18 22:01:15
12394473,860028,53318231,16,"@oreoshake Actually, I just noticed that all of these methods are included in `set_security_headers` (except `prep_script_hash`) How's this, instead?",391823634,2016-02-18 22:15:42
12394473,92540,53357517,16,The reason for setting the different `before_filter`s is that it makes it possible to use `skip_before_filter` for each individual header. Calling `set_security_headers` would remove this granularity.,391823634,2016-02-19 02:24:31
12394473,860028,53360389,16,Oooh of course. Thanks for the clarification ^_^,391823634,2016-02-19 02:41:13
13074608,370308,56240411,37,@oreoshake is there an easier way to access the config from this context?,407352799,2016-03-16 04:04:33
13074608,92540,56240715,37,`req.env[SECURE_HEADERS_CONFIG]` should suffice.,407352799,2016-03-16 04:06:23
13074608,370308,56240744,5,For this feature to work correctly `SecureHeaders::Middleware` needs to come before the session middleware (or simply at the top of the rack stack).,407352799,2016-03-16 04:06:32
13074608,92540,56240991,37,Or maybe make `config_for` public? https://github.com/twitter/secureheaders/blob/44c8c3edfe6c5456274c448ba68371b20fe649d7/lib/secure_headers.rb#L225,407352799,2016-03-16 04:08:06
13074608,92540,56241060,5,This should be fine.,407352799,2016-03-16 04:08:34
13074608,370308,56242813,37,"Sounds good to me, will help keep things dry",407352799,2016-03-16 04:19:46
13077896,97583,56670074,5,"Given this PR is optimizing policy overrides are, I was surprised there was no test to validate that you are in fact only busting the cache once even if there are > 1 overrides. Does that seem a reasonable thing to add?",408740162,2016-03-18 22:08:05
13077896,97583,56670241,5,Would it also make sense to add a test to verify that overrides never end up touching `csp` and only touch `dynamic_csp`? ,408740162,2016-03-18 22:08:54
13077896,92540,57049058,5,Added a test [here](https://github.com/twitter/secureheaders/pull/232/files#diff-5ffee118dcfe384935df780237dadf39R109) for the cache busting. I'll have to think about your second item.,408740162,2016-03-23 02:04:25
13459314,92540,58581283,31,I think this would be better if the conditions were swapped so we can short circuit on a hash lookup instead of a regex match.,419464682,2016-04-06 00:36:12
13459314,92540,58585145,14,Please add a deprecation warning here. I know it's brand new code but I plan to get rid of it and use this format.,419464682,2016-04-06 00:56:41
13459314,3847,58591781,14,Absolutely. I was going to ask you about that. I was thinking I'd add it on configuration,419464682,2016-04-06 01:32:46
13459314,92540,58789375,40,missing closing `}`,420390914,2016-04-07 04:57:51
13459314,92540,58789460,28,:+1:,420390914,2016-04-07 04:58:28
13459314,92540,58789654,107,is this valid? I'm asking because I have no idea if that means the same thing as `SameSite=Strict`,420390914,2016-04-07 04:59:48
13459314,92540,58798111,80,I wonder if it would be better to parse out the flags into fields so we can use accessors instead of regex to test if the value needs to be modified. ,420390914,2016-04-07 06:15:30
13459314,3847,58889720,40,"nice catch, thanks!",420390914,2016-04-07 22:17:57
13459314,3847,58890013,80,"That's a good point. `CGI::Cookie` does some of this already, but unfortunately falls a little bit short since it doesn't support attributes other than `Secure` and `HttpOnly`. I'll take a stab at parsing out the cookie.",420390914,2016-04-07 22:19:38
13459314,3847,58891576,107,"My first read of the spec led me to believe this was a shortcut for `Strict` but now i'm not so sure. Here's the [relevant section](https://tools.ietf.org/html/draft-west-first-party-cookies-07#section-4.1) in the spec:

>   If the ""attribute-name"" case",420390914,2016-04-07 22:27:41
13459314,92540,58909513,107,"> Now that I've re-read it, my interpretation of that would be that rule 1 would apply and it would be ignored.

That's my understanding as well.

>  If so, samesite: true shouldn't be valid and I'll remove it.

:+1: 

Thanks!",420390914,2016-04-08 00:17:28
13459314,3847,58912300,107,"Do you think it's worth supporting booleans on Strict/Lax? Like:

```ruby
config.cookies = {
  samesite: {
    strict: true
  }
}
```

Use of a boolean on either would prevent a rule of any sort for the other enforcement mode. This could be chec",420390914,2016-04-08 00:34:23
13459314,92540,58912961,107,"Yes. Also, I think the sample you provided would be the ideal setup that people would want to work towards. ",420390914,2016-04-08 00:38:13
13459314,3847,58913101,107,":+1:  alrighty, i'll adjust this",420390914,2016-04-08 00:39:04
13459314,3847,58974717,80,"I ripped some code out of `CGI::Cookie` and implemented a rudimentary parser so that we can avoid regex testing (2e74b8120a75144e952afe06ebe7ad12d1c98e5f). I like this approach better, thanks for the suggestion. ",420390914,2016-04-08 09:51:04
13459314,92540,59433959,17,"This isn't valid anymore, right?",422172990,2016-04-13 02:00:02
13459314,92540,59434419,82,use symbols here?,422172990,2016-04-13 02:02:54
13459314,3847,59437582,17,"that's correct, `samesite` will only accept a `Hash`, I'll fix this",422172990,2016-04-13 02:24:28
13459314,3847,59438808,82,"We can certainly do that, my reasoning for using strings was that parsing the cookie in order to decompose it would require `to_sym` on strings in order to set these to a truthy value. I guess now that Ruby garbage collects symbols this is less of a conce",422172990,2016-04-13 02:32:42
13459314,92540,59630829,73,Looks like you used \` instead of ' so copy pasting failed :smile:,425029219,2016-04-14 04:40:16
13459314,3847,59640375,73,Whoops! :banana:  I've been doing some React/JSX stuff lately and this probably was a bad context switch. Fixed now. :smile: ,425029219,2016-04-14 06:00:23
14178954,582528,60973542,5,"Is this supposed to be two separate strings instead of continuing the PKP-RO string?
```
'Public-Key-Pins-Report-Only', 'Referrer-Policy'
```",433395697,2016-04-26 02:30:59
14178954,92540,60974672,5,"Good :eyes:, I didn't catch that. ",433395697,2016-04-26 02:38:35
14178954,5992174,61006761,5,Ahh! Soz,433395697,2016-04-26 06:19:40
14178954,5992174,61007056,5,"Yep, addressing # 2 and typo in railtie now.",433395697,2016-04-26 06:22:53
14590054,92540,62583184,27,"In the ""before"" column, setting a config value to `false` was also a way to opt-out of a header. i.e. `config.x_download_options = false`.",442078377,2016-05-10 05:20:06
14590054,92540,62583355,21,"Please add a link to the [nonce docs](https://github.com/twitter/secureheaders#nonce) here. The view helpers are preferred, but they aren't the only way to use nonces.",442078377,2016-05-10 05:21:44
16139924,169974,74843637,36,"Would smarter defaults be to swap these conditions and allow a report only by default?

```rb
self.csp = OPT_OUT
self.csp_report_only = ContentSecurityPolicyConfig::DEFAULT
```

Or would this break backwards compatibility with existing implementati",488338033,2016-08-16 05:01:27
16139924,169974,74843926,112,???? ,488338033,2016-08-16 05:03:18
16139924,92540,74850609,36,"Well moving to report only shouldn't break existing implementations, but the previous default was an enforced policy. The change to enforce-by-default was made at the last major version bump iirc so there's no reason to go ""backwards"" here. This PR does c",488338033,2016-08-16 05:55:59
16139924,169974,74850739,36,Sounds perfectly sane :),488338033,2016-08-16 05:56:55
16139924,169974,75221488,150,same question as https://github.com/twitter/secureheaders/pull/281/files#r75221331. does this need to be swapped to use `opt_out?` too?,494966233,2016-08-18 05:46:40
16139924,92540,75221681,79,Seems so! Fixed in 3afd1dd,494966233,2016-08-18 05:48:20
16139924,92540,75221751,168,Note to self: wat ⁉️ ,494966233,2016-08-18 05:48:49
16139924,92540,75221892,24,This `dup` is only necessary because we actually modify the underlying arrays of the config with lots of `!` methods. A naive attempt to remove the ! methods and the `dup` failed miserably. But this is a smell worth cleaning up.,494966233,2016-08-18 05:50:03
16139924,169974,75221989,168,I was about to comment on this and say a similar thing about the readability of this ????  The `def blah; end.map do |klass|` definitely makes for it slightly difficult to follow. Is there an approach that we could take here to break this up a bit?,494966233,2016-08-18 05:50:58
16139924,169974,75222494,152,"sorry to be a broken, nagging record but it looks like we've got a few instances of the `!= OPT_OUT` in here still. would you like me to comment on each one I find or are you OK to just do a giant find + replace?",494971716,2016-08-18 05:54:57
16139924,92540,75223667,168,"This is going to take another non-trivial, but overdue refactoring of the way CSP vs CSPRO are handled. The result should be much cleaner. Passing around symbols and class objects with all sorts of special casing have trickled down.",494966233,2016-08-18 06:04:36
16139924,92540,75223840,152,I'll do a pass and ping you when this and the refactor mentioned below are ready for :eyes: ,494971716,2016-08-18 06:06:26
16139924,169974,75221331,79,"should this be using the `opt_out?` method? i.e.

```rb
if [:both, :enforced].include?(target) && !config.csp.opt_out?
```",494966233,2016-08-18 05:45:15
17603750,169974,81872009,1,This might be better suited in the `configuration.md` so people have a quick and easy point of reference for starting out?,525218448,2016-10-05 05:59:59
17603750,92540,81873900,1,"combine this page with the ""hash"" page.",525218448,2016-10-05 06:16:25
17603750,92540,81873839,1,This seems a little small to stand on its own.,525218448,2016-10-05 06:15:52
17603750,92540,81887653,1,"I agree. This page, docs/README.md, and docs/configuration.md should probably all live in the original readme",525218448,2016-10-05 08:37:35
18514864,725710,86482206,5,"Not a fan of pinning to a specific version, as it makes it a big pain to fix when there's a security issue or something with a gem. Can't we just do `""~> 0.16.8""` or something if that's the minimum version we actually need?",548512384,2016-11-04 09:55:39
20125359,92540,94830080,20,:+1:,590940878,2017-01-06 03:05:53
23023549,92540,109491855,57,:+1:,660930856,2017-04-04 01:33:05
23023549,92540,109489928,7,"I prefer `""`",660930856,2017-04-04 01:25:22
23023549,92540,109489821,5,I prefer to spell out the full name of the header spec.,660930856,2017-04-04 01:25:00
23023549,92540,109491889,66,`report-uri` is quoted. Interesting.,660930856,2017-04-04 01:33:15
23023549,92540,109489752,12,I prefer to spell out the full name of the header spec.,660930856,2017-04-04 01:24:43
23023549,169974,109525069,12,Good call! Fixed via 39cbb52,660930856,2017-04-04 04:09:03
23023549,169974,109525261,66,"This did strike me as odd too but, you know, specs? `¯\_(ツ)_/¯`",660930856,2017-04-04 04:09:57
23023549,169974,109525670,7,Oh my! What caveman would ever commit files with mixed quotes?!?! ????  Fixed in 9faf299 ,660930856,2017-04-04 04:11:38
23424628,320632,111432137,7,"This is asserting that a _particular_ warning isn't logged; we probably want to assert that _no_ warnings are logged:

```ruby
expect(Kernel).to_not receive(:warn)
```",669486755,2017-04-13 23:33:45
24838044,92540,118576753,5,This one seems odd. Is it saying use kwargs instead?,700119447,2017-05-26 03:26:46
24838044,92540,118577011,25,"This is kind of a bummer. Same for https://github.com/twitter/secureheaders/pull/330/files#diff-16a93318ee7771ce5483636b9959f4ec. Should we just not use `@instance_var_name`?
",700119447,2017-05-26 03:28:00
24838044,92540,118577109,9,This one seems strange as well.,700119447,2017-05-26 03:28:21
24838044,3847,118578239,5,"apparently `prevent_dup` wasn't used. I didn't want to remove it b/c I figured there was a reason it existed, but prefixing the arguement with an underscore suppresses the warning.",700119447,2017-05-26 03:33:39
24838044,3847,118578502,25,"yep, these are unfortunate. This was the most common warning: ""warning: instance variable @ivar not initialized""",700119447,2017-05-26 03:35:08
24838044,92540,118578659,5,"Strange. It's [definitely used](https://github.com/twitter/secureheaders/blob/fd559f2acc591c04e0c9563e3f9e857e7ce6e6c9/lib/secure_headers.rb#L233) and important.

As a side note: I'm ok with making strange changes to appease a tool in the name of keepin",700119447,2017-05-26 03:35:52
24838044,3847,118578859,9,the problem here was that the block parameter `source_expression` was identical to that of the outer parameter (`source_expression.each`),700119447,2017-05-26 03:36:52
24838044,3847,118579410,5,"Ohhh. just realized, this is a method call, so I think it should actually just be `config = config_for(request, true)`",700119447,2017-05-26 03:39:19
24838044,92540,118580904,5,"???? an early mentor of mine emphasized not passing around ""magic booleans"" (or any magic things really). I guess we could add a second method or treat the value as an options hash.

Maybe in 4.0 we can drop < 2.1 and use kwargs. ",700119447,2017-05-26 03:46:12
24838044,3847,118582234,5,"I agree, kwargs would be a logical change here ✅  

To get around the warning, this would probably work too:

```ruby
prevent_dup = true
config = config_for(request, prevent_dup)
```",700119447,2017-05-26 03:52:23
24838044,92540,118582581,5,:+1:,700119447,2017-05-26 03:53:55
24838044,92540,118587636,5,Would this get enforced by CI? It looks like `--warnings` will still return a 0 exit code. It would be nice to enforce this.,700155646,2017-05-26 04:19:05
24838044,3847,118592430,5,"good point. I'm not sure if `--warnings` will, but maybe via `RUBYOPT` it can be enabled. I'll see if I can figure out a way to enforce it.

One thing to note is that there are a few deprecation warnings which we don't want to cause the suite to fail.",700155646,2017-05-26 04:44:49
24838044,3847,118624320,5,"This has me stumped. I can't seem to figure out how to make the suite fail when there are warnings outputted. 

I guess another route to go would be to add rubocop. I created a branch where I added rubocop and was able to bring it down to ~270 violation",700155646,2017-05-26 09:33:42
24838044,92540,118775606,5,"> This has me stumped

Thanks for trying. I think we can :ship: what we have here if you think it's :+1: 

> I guess another route to go would be to add rubocop.

That would be great! I'm happy to help whittle this down.",700155646,2017-05-27 02:36:41
24838044,323865,118848250,5,"IIRC warnings go to STDERR, so you should be able to just enforce that STDERR is empty in CI",700155646,2017-05-29 03:03:07
24838044,92540,119177011,5,"> IIRC warnings go to STDERR, so you should be able to just enforce that STDERR is empty in CI

:thinking: that might be a bit too strict. Other stderr might happen. I guess we can go with that strategy until we find it doesn't work. Any ""other"" stderr ",700155646,2017-05-31 01:21:36
24838044,3847,119263401,5,Locally (perhaps on Travis as well) i've been getting warnings from `pry` that would probably turn up in stderr as well. ,700155646,2017-05-31 10:19:37
25029654,92540,119913877,13,What's this for?,705516460,2017-06-03 00:44:01
25029654,3847,119915905,13,"Oops! ????  I was trying to make running `bundle exec rake` run both rspec and rubocop and left this by accident

btw, I think we could probably move `--format progress` to `.rspec` and remove the block here.",705516460,2017-06-03 00:54:03
25029654,92540,119934205,13,"> btw, I think we could probably move --format progress to .rspec and remove the block here.

:+1: ",705516460,2017-06-03 02:24:49
25029654,3847,119937406,13,"Fixed now. 

FYI, I removed the `desc ""Run Rspec""` line as well as it overrode the description it inherits from RSpec.",705516460,2017-06-03 02:42:20
25687816,97583,123030360,1,Doh..need to bump the actual version too. ,719088798,2017-06-20 23:40:30
25687816,97583,123030709,1,Or do you all prefer to just suck in the changes and do the version bumping yourself?,719088798,2017-06-20 23:41:56
25687816,97583,123032485,5,"I updated this, since it is the URL that Mike West referenced. The current URL seems to have not been updated recently. ",719088798,2017-06-20 23:49:20
25687816,92540,123044082,1,"> Or do you all prefer to just suck in the changes and do the version bumping yourself?
 
If we weren't on the same team I'd probably complain, it's :cool: ???? ",719088798,2017-06-21 00:35:06
25687816,97583,123044886,1,Ok..I bumped the gem version number in https://github.com/twitter/secureheaders/pull/334/commits/d2070ea581004db8b0b3a83550ffccccb46c8846. ,719088798,2017-06-21 00:38:10
25687816,68412,123045206,5,"Yeah. Linking to the editor's draft is generally the right thing to do. The document on `w3,org` is practically always out of date. :)",719088798,2017-06-21 00:39:21
25687816,92540,123046515,57,:+1:,719125974,2017-06-21 00:44:21
25687816,92540,123044331,55,whitespace,719101809,2017-06-21 00:36:04
25687816,92540,123046394,31,I'd prefer literals in the `eq`. It feels like you're comparing the output of the same function to itself.,719125974,2017-06-21 00:43:52
25687816,92540,123044973,35,"> an Array of String

Strings",719101809,2017-06-21 00:38:29
25687816,97583,123047750,31,Yeah..debated that myself and laziness won out :smile:. I'll change it. ,719125974,2017-06-21 00:49:28
25687816,97583,123048427,55,doh..darn you sublime whitespace auto-detect. ,719101809,2017-06-21 00:52:06
26522317,3847,127806515,5,"I wonder if it would make sense to define the default as `{ secure: true, httponly: true}` as opposed to checking for `nil` in the configuration.

I'm of the opinion that if a configuration is defined (even if it disables `secure` or `httponly`), you sh",737307168,2017-07-18 02:48:01
26522317,3847,127805243,6,???? for adding support for `SecureHeaders::OPT_OUT` this was a HUGE miss on my part in the initial implementation.,737307168,2017-07-18 02:42:38
26522317,92540,128070856,5,"Per https://github.com/twitter/secureheaders/pull/341#issuecomment-315867482, I think we should go with

```ruby
config[:secure] = true unless config[:secure] == OPT_OUT
config[:httponly] = true unless config[:httponly] == OPT_OUT
```",737307168,2017-07-19 02:21:22
28315280,97583,137082296,77,"This is the bit I think I simplified. But, a second set of eyes to make sure I didn't remove some underlying assumption would be ✨ ",776297166,2017-09-06 01:49:39
28315280,97583,137082447,127,I don't think I saw any `:string` types so I removed it here. ,776297166,2017-09-06 01:50:17
28315280,97583,137082810,151,"If someone sent something bogus like `sandbox: false` we would technically catch that here. But, we never actually reach this code if you do that, since there is some higher level code that does something like `next unless value` for all directives. I did",776297166,2017-09-06 01:51:45
28315280,92540,137087837,86,"We can get rid of `nonce_added?` and just check that `directive.to_s.end_with?(""_nonce"")`. It's pretty dirty that nonces are essentially added as extra directives. Probably best to clean that up, but in a separate PR.",776297166,2017-09-06 02:13:51
28315280,92540,137088330,151,???? now that we use the `OPT_OUT` pattern that should probably be revisited,776297166,2017-09-06 02:16:05
28315280,97583,137097068,151,You caught me..I noticed this as well and punted :-). I'll take a quick pass at addressing it. ,776297166,2017-09-06 02:55:04
28717197,725710,139293632,29,after_action is more common nowadays,784777194,2017-09-17 02:37:14
28717197,725710,139293622,14,"ALL_TYPES, perhaps?",784777194,2017-09-17 02:36:52
28717197,169974,139322430,31,Looks like you've got an extra newline here that we could probably get rid of to keep the markdown examples pretty.,784777194,2017-09-18 05:04:05
28717197,169974,139322334,4,"> It serves as a reference to all the available options.

This isn't quite true since not all of the directives have all available options. For example, HSTS:

```rb
# Add ""; preload"" and submit the site to hstspreload.org for best protection.
confi",784777194,2017-09-18 05:00:16
28717197,169974,139322362,4,We could also just treat those dangerous directives differently and allow them to not be the full available options so people cannot shoot themselves in the foot without knowing it. ,784777194,2017-09-18 05:01:29
30068101,97583,145750439,1,"I also updated the name of this test, as ""expect certificate"" was ever so slightly confusing :smile:. ",813076347,2017-10-19 23:17:36
30068101,169974,145817078,1,Thanks! I think this was my bad from when I had it named `expect_ct_spec` => `expect_certificate_spec` ???? ,813076347,2017-10-20 03:38:49
31228814,92540,151293080,9,Should this be a passthrough to `nonced_stylesheet_link_tag` instead?,837166166,2017-11-16 08:31:34
31228814,92540,151293004,26,Should just be a passthrough call to `nonced_javascript_include_tag`? ,837166166,2017-11-16 08:31:01
31228814,92540,151293164,21,What is the reason for the alias? Can we accomplish the same thing without the metaprogramming?,837166166,2017-11-16 08:32:16
31228814,25614,151293979,9,"No, `nonced_style_tag` generates `<style>` whereas `nonced_stylesheet_link_tag` generates a `<link />`",837166166,2017-11-16 08:38:15
31228814,25614,151294099,21,"We could, but for the purpose of this test the method is identical. Would you prefer that?",837166166,2017-11-16 08:39:10
31228814,25614,151294296,26,"The Rails API is a little different:

`javascript_tag(content_or_options_with_block = nil, html_options = {}, &block)`

`javascript_include_tag(*sources)`

It might work as a passthrough though, if that's preferred?",837166166,2017-11-16 08:40:34
33807419,221390,162778519,2,"You may want to remove the ""depending on browser"" part from the method comments.",893359359,2018-01-20 17:30:33
33900934,97583,163036146,62,Since we are now validating the config before we generate headers we need to use a legit value for `plugin_types`. ,895512836,2018-01-23 03:04:58
33900934,97583,163034814,20,The linter told me that a few locations needed a small style update. ,895512836,2018-01-23 02:59:58
33900934,97583,163032156,109,"I kept `Configuration.get`..but it now only ever returns the global configuration. I'm guessing almost nobody was calling `Configuration.get`, so we could rename this to something like `Configuration.default_config` or something if you like. ",895512836,2018-01-23 02:51:42
33900934,97583,163035375,26,"@oreoshake - I know we had chatted about the expectations of `merge`. But, given that `merge!` was overwriting existing values, it seems like `merge` should to the same (or `merge!` should do the opposite). It seems like `append` should be used for any ki",895512836,2018-01-23 03:02:00
33900934,97583,163032766,182,"In the spirit of ""cache less"" , I just made `hpkp_report_host` a dynamic method invocation. Plus, it was the only attribute that didn't have some config class backing it..so it made defining our attributes cleaner :smile:. ",895512836,2018-01-23 02:53:55
33900934,97583,163034462,4,"As of https://github.com/twitter/secureheaders/pull/383/files#diff-5b9420dafe46fa9c6c8ac3415ab06102R91 I realized we no longer really ever had a need to look at this value. Plus, it feels like `CONFIG_KEY` is something that the config object should know a",895512836,2018-01-23 02:58:42
33900934,97583,163031350,60,"We were only validating the config during the initial `Configuration.defautl { ...  }`. But, we never did any checks when an override is applied. So, before we actually send out the header, we validate again. ",895512836,2018-01-23 02:48:50
33900934,97583,163032408,74,"`target` didn't seem to be used so I removed it. Plus, whatever the intent with ""target"", we probably couldn't support it anyway (i.e. same issue as named overrides). ",895512836,2018-01-23 02:52:39
33900934,97583,163031057,18,"Since all the caching and stuff has been removed I needed up moving some of the ""make me a header"" logic down into the actual `Configuration` object. So, these classes are defined in https://github.com/twitter/secureheaders/pull/383/files#diff-5b9420dafe4",895512836,2018-01-23 02:47:46
33900934,97583,163031702,69,Yay for killing off this `update_cached_csp` business ???? ,895512836,2018-01-23 02:50:12
33900934,97583,163033458,189,"I was originally doing all this overrides stuff inside the main `secure_headers.rb`. But, most of the code in that class assumes a `request` object. But, we might want to apply an override to a config outside of that context. For example, at GitHub, we ha",895512836,2018-01-23 02:55:53
33900934,97583,163036015,26,This test exercises the bug in https://github.com/twitter/secureheaders/issues/380. ,895512836,2018-01-23 03:04:31
33900934,97583,163035832,5,"I'm now validating `report_only` inside the actual config object. So, we can't go setting `report_only: true` unless we are going to be validating it with a `ContentSecurityPolicyReportOnlyConfig`. ",895512836,2018-01-23 03:03:49
33900934,97583,163034712,11,"As of https://github.com/twitter/secureheaders/pull/383/files#diff-5b9420dafe46fa9c6c8ac3415ab06102R186 I made the `make_header` logic super general. So, I adjusted al the classes to support the same interface. ",895512836,2018-01-23 02:59:37
33900934,97583,163030158,10,The configuration now references some of the individual header objects..so it had to move. ,895512836,2018-01-23 02:44:36
33900934,97583,163031617,62,I made the `generate_headers` ignorant to HTTPS. We could send additional data into `make_headers` to let be smart about HTTPS. ,895512836,2018-01-23 02:49:52
33900934,92540,163948806,109,:+1: to renaming it,895512836,2018-01-26 03:46:50
33900934,92540,163950817,147,"???? ""headerable""",895512836,2018-01-26 03:54:31
33900934,92540,163951478,256,"What do you think about removing this ""could be an object, could be a hash"" support? ",895512836,2018-01-26 03:56:55
33900934,92540,163952790,3,why is user_agent required here but optional elsewhere?,895512836,2018-01-26 04:02:16
33900934,92540,163952445,26,I think we should move as far away from treating this like a hash as possible. Using verbs like append/combine/overwrite would be clearer. But we'll have to alias and deprecate first.,895512836,2018-01-26 04:00:39
33900934,92540,163949869,60,"That was somewhat intentional, for ""performance"" reasons. A goal was to make it hard to do the wrong thing at runtime. But I'm fine with this too.",895512836,2018-01-26 03:50:51
33900934,92540,163950134,81,:+1:,895512836,2018-01-26 03:52:00
33900934,92540,163952052,203,Should we raise an exception if one of these is `nil`? That would be a clear indicator of a bug but I don't want to bring someone's site down because of it. ,895512836,2018-01-26 03:59:13
33900934,97583,164793782,3,"no good reason..only because we always pass it when it is used. But, for consistency it would be fine...eventually this is passed to a method that has a `user_agent = OTHER` default value. I'll make it match the others. ",895512836,2018-01-31 00:13:37
33900934,97583,164794036,3,Maybe I should have it (and the others) match the `user_agent = OTHER` pattern though.,895512836,2018-01-31 00:14:20
33900934,97583,164822348,256,"Meh..I think choosing one or the other feels awkward in different places. For example, during initial config it feels really natural to do:

``` ruby
Configuration.configure do |config|
  config.csp = {
    default_src: %w(https: 'self')
  }
end
`",895512836,2018-01-31 01:40:59
33900934,97583,164837762,5,We call this in more tests now that it is an exception to reconfigure the default configuration. ,903155739,2018-01-31 02:36:24
33900934,97583,164837238,122,"This private class method makes tests uglier, but it seems worthwhile to preserve hiding the actual default config from public callers. ",903155739,2018-01-31 02:34:16
33900934,97583,164837479,4,Since we are defaulting `user_agent` to `nil` in various places I thought it made sense to also override `user_agent` if `nil` ends up being passed. ,903155739,2018-01-31 02:35:13
33900934,97583,164838556,23,It isn't enough to `nil` out the default config anymore since we are checking `defined?(@default_config)` when we throw an `AlreadyConfiguredError`.,903155739,2018-01-31 02:39:36
33900934,97583,164838135,71,"Yup..this makes a handful of tests uglier, but I don't like making private internal data more visible simply for the sake of tests. ",903155739,2018-01-31 02:37:50
33900934,97583,164837030,17,"In the spirit of preserving the integrity of the default config I added this. It is my assumption that a caller should only ever being calling this configuration block a single time, correct? If it is called more than once it implies that we could be runn",903155739,2018-01-31 02:33:33
33900934,97583,164837967,41,For groups of tests that want to play with the default configuration we need to reset it so we don't get an `AlreadyConfiguredError`,903155739,2018-01-31 02:37:13
33900934,92540,164867796,17,"> It is my assumption that a caller should only ever being calling this configuration block a single time, correct?

There were guards in place to prevent doing exactly that. Not sure if they survived the change.",903155739,2018-01-31 04:23:14
33900934,97583,164868626,17,"But don't the tests do a bunch of `Configuration.default {...}` between tests? That implies it was ok to reconfigure the default config a bunch of times, no? ",903155739,2018-01-31 04:26:46
34745726,169974,167702068,4,Was this intended to be committed?,915819364,2018-02-13 06:07:43
34745726,169974,167702145,6,nice!,915819364,2018-02-13 06:08:01
34745726,92540,167705608,4,"Yep, it's pretty useful for anyone using `guard`. Didn't feel the need for a separate PR",915819364,2018-02-13 06:21:37
34745726,169974,167705732,4,???? ,915819364,2018-02-13 06:22:15
37668410,169974,180927267,7,:tada:,973872865,2018-04-12 06:27:05
37668410,169974,180927421,80,Do you want to rewrap this line?,973872865,2018-04-12 06:28:08
37668410,92540,180930355,80,"Heh, I should probably take a pass over all of the comments. I'm sure there's plenty of outdated info.",973872865,2018-04-12 06:47:04
37668410,92540,180930445,64,Removing the `user_agent` argument is a breaking change that will require a deprecation release.,973872865,2018-04-12 06:47:47
1258133,76141,3419646,7,"Looks like you're not using the array methods any more, so you don't need to convert arguments to an array.
Also applies in some cases below.",36508233,2013-03-19 02:10:33
1258133,2548,3420968,7,Fixed.,36508233,2013-03-19 03:12:04
1258133,76141,3421007,31,"Why is this called ""origin""?",36508884,2013-03-19 03:14:10
1258133,76141,3421077,62,don't need origin here.,36508884,2013-03-19 03:17:27
1258133,2548,3421149,31,"I challenged kpk to think of a better name. we couldn't, and besides, it was previously known as ""args.pop()""",36508884,2013-03-19 03:20:59
1323039,6258,3882946,37,This could alias 'flight' to 'components/flight' instead. Would be cleaner and avoid modifying the flight-jasmine library code.,37715071,2013-04-20 03:40:07
1323039,24613,3888156,37,done,37715071,2013-04-22 01:04:20
1323039,76141,3905588,4,Is this serializable? Looks like a complex object.,37715066,2013-04-23 02:45:50
1323039,24613,3905887,4,it's serializable,37715066,2013-04-23 03:03:55
1323039,76141,3906217,46,Don't think you need this block.,37715066,2013-04-23 03:25:00
1323039,76141,3906257,3,"Not a fan of the space between function and the parens. But, hey, whatever.",37715066,2013-04-23 03:26:51
1323039,76141,3906284,20,I recommend removing this block.,37715066,2013-04-23 03:28:12
1323039,76141,3906339,32,Is this dependable? Do you ever see flakiness from the Jasmines?,37715066,2013-04-23 03:31:03
1323039,24613,3906481,32,not so far,37715066,2013-04-23 03:39:55
1167950,64344,3075315,55,capitalization,31705500,2013-02-20 12:13:31
1167950,64344,3075313,0,This is probably a good idea for debugging.,31705500,2013-02-20 12:13:14
1168783,64344,3086901,4,jQuery*,31709472,2013-02-21 02:38:02
1173477,1401104,3130914,6,Do we want to make this today?,43859366,2013-02-25 12:49:35
1173477,46672,3130925,6,It's updated in my local branch. Will push once I get a :+1: on the one outstanding pul request.,43859366,2013-02-25 12:50:37
1178512,1401104,3112051,17,"why not just have '6' instead of 'maxConcurrentConnections || 6', I don't see how maxConcurrentConnections could be instantiated at this point? ",31752085,2013-02-22 13:23:14
1178512,46672,3112067,17,"`maxConcurrentConnections` is a static variable shared between each `Transport` instance. So if you have the following code:

```javascript
$('.typeahead-one').typeahead({
  maxConcurrentConnections: 10
});

$('.typeahead-one').typeahead({
  maxCo",31752085,2013-02-22 13:26:44
1178512,1401104,3112100,17,"aha, makes sense. I was considering the single transport case. ",31752085,2013-02-22 13:31:04
1178512,1401104,3112212,17,"One more thing we should discuss is if it makes sense to have the transports share a cache. Might make more sense to give each transport its own cache instance, reducing the coupling between the activity on the inputs. ",31752085,2013-02-22 13:51:13
1178512,334894,3126425,69,"i think this is not being used in the ajax call anymore, which i'm guessing is wrong? 
it should overwrite the `ajaxSettings.url`",31968440,2013-02-23 16:31:05
1178512,46672,3127901,69,"Good catch, I'll make sure to address this.",31968440,2013-02-24 10:17:49
1179613,64344,3112277,14,What about something like this: `this.$input[0].scrollWidth >  this.$input.width()`?,31756059,2013-02-22 14:03:19
1179613,46672,3112298,14,Don't think that'll work in Firefox. https://bugzilla.mozilla.org/show_bug.cgi?id=343143,31756059,2013-02-22 14:07:35
1179613,64344,3112364,14,Damn.,31756059,2013-02-22 14:19:47
1182990,379067,3126204,8,This doesn't allow CORS,31838572,2013-02-23 12:11:15
1202133,64344,3175275,8,Why a suffix instead of a prefix? Does `this.$menu.off('.tt');` not work with prefixes? Just curious because I haven't seen this before…,34495486,2013-02-28 01:19:39
1202133,46672,3175353,8,http://docs.jquery.com/Namespaced_Events,34495486,2013-02-28 01:23:52
1202133,64344,3175367,8,"Awesome, thanks for the link.",34495486,2013-02-28 01:24:46
1251320,64344,3357623,14,.getHighlightedOrFirstSuggestion()?,36444549,2013-03-13 22:37:18
1251320,46672,3357660,14,The hint will always be the the first suggestion in the dropdown.,36444549,2013-03-13 22:38:34
1251320,64344,3357816,14,What if I arrow up or down?,36444549,2013-03-13 22:44:17
1251320,64344,3357830,14,"Oh, then it changes the value, so there's no hint. Carry on…ship it.",36444549,2013-03-13 22:44:44
1563963,64344,4596242,4,":not(.t-suggestion) => :not(.tt-suggestion)?

Seems like any click should just close it if this is typo code works, so maybe we should just add this.close() to _handleSelection?",44210331,2013-06-08 00:58:46
1563963,620357,4599975,4,"aha, fixed it  :not(.tt-suggestion) . :)

_handleSelection is invoked when mouseclick  [dom].tt-suggestion, but not  header/footer ,so maybe we should  add an click listener like this. ",44210331,2013-06-08 05:09:32
1757264,64344,5147751,12,Gotcha,48310598,2013-07-11 23:11:26
1757264,64344,5145725,12,Perhaps `src/**/*` to avoid having to add/update/remove files more than once?,48310598,2013-07-11 21:45:37
1757264,46672,5147645,12,"The files from *src/* need to be loaded in a certain order, so using a wildcard won't work.",48310598,2013-07-11 23:08:28
1757264,64344,5145754,167,"I think we can drop ""From"" if we want.",48310598,2013-07-11 21:47:12
2501114,1457063,8247514,23,"Love this addition and find it really useful, but shouldn't this be 'matches == 1' and trigger 'matched' if there is only a single suggestion?

Edit:

Ah, I now see the commit where you changed it to trigger if there are *any* suggestions. My requirem",73512615,2013-12-11 04:09:21
2501114,2973530,8350567,23,"The original code used == , but that resulted in a bug where the user clicked an item other than the first item, and the matched event returned the first item instead.  This happened before I made use of the hint variable, maybe it's ok to switch to == no",73512615,2013-12-14 10:18:52
2984680,46672,9570853,8,"You don't need to use `call` here. Instead, you can just do:

```javascript
local = local();
```

Also a shorter way  of writing this would be:

```javascript
function getLocal(o) {
  var local = o.local || null;

  return _.isFunction(local) ",88451454,2014-02-10 04:04:17
2984680,1329,9571978,8,"I was thinking that using .call(null) can prevent potential misuse of 'this' in the function that's being passed in (doesn't seem like it could happen now, but could guard against future changes)",88451454,2014-02-10 07:16:56
2984680,46672,9572066,8,"Not a bad idea, but that would only make a difference in strict mode. In non-strict mode, both `local()` and `local.call(null)` will invoke `local` with the context set to the global object i.e. `window`.

This actually brings up a good point, should ty",88451454,2014-02-10 07:35:58
3097192,1565,10136748,10,"I think `main` should just be `""dist/typeahead.bundle.js""`.

Or, this `boodhound.js` should really be its own bower package and repo.",91563872,2014-02-28 02:02:08
3110302,46672,10375037,12,"should *not* empty dropdown menu, right?",91922516,2014-03-07 14:14:37
3110720,46672,10408428,10,Maybe add `SearchIndex#all` so that we don't have to reach into the internals of SearchIndex here.,92199377,2014-03-08 15:07:44
3110720,46672,10408435,15,I'm on the fence when it comes to whether or not remote suggestions should be included within default suggestions. Any particular reason why you decided not to include them?,92199377,2014-03-08 15:09:55
3110720,46672,10408439,4,"Rather than pass in `minLength`, might be clearer to pass in a bool flag for whether or not to show default suggestions.",92199377,2014-03-08 15:10:48
3110720,46672,10408452,15,"Should this be:

```javascript
if (this.minLength === 0 && this.input.getQuery() === '') {
  this.dropdown.update('');
}
```",92199377,2014-03-08 15:14:18
3110720,2229546,10411651,15,"@jharding I didn't need to use remote for my particular use case, and this mirrored the behaviour of #390, which seemed to have a lot of interest.",92199377,2014-03-09 06:37:53
3110720,2229546,10411652,4,Agreed.,92199377,2014-03-09 06:38:11
3110720,2229546,10411656,15,Probably,92199377,2014-03-09 06:38:50
3110720,2229546,10411760,10,Done,92199377,2014-03-09 07:10:12
3110720,107780,12102268,40,I *believe* that updating the dropdown at this point is redundant because the dropdown is updated again within the `this.dropdown.open()` call.,102808512,2014-04-29 21:21:53
3110720,107780,12102937,61,"These lines are causing problems for me when manually closing the dropdown. At this point I would expect to want to see the placeholder. Also, the `val` variable here is undefined (it gets set in the clause above) and so I end up seeing 'undefined' in my ",102808512,2014-04-29 21:35:56
3670653,1522315,12469638,31,Simple quote pour les strings,110667584,2014-05-09 14:51:42
3670653,1522315,12469643,31,Simple quote pour les strings,110667584,2014-05-09 14:51:48
3670653,982054,12469958,31,c'est le minifier qui transforme les simple quotes en double ;) ,110667584,2014-05-09 15:04:31
3670653,982054,12469965,31,même remarque que ci dessus,110667584,2014-05-09 15:04:58
3670653,982054,12469969,27,la preuve ;),110667584,2014-05-09 15:05:10
5424695,2442648,21746828,62,Should be `that.showDefault`,185662332,2014-12-12 21:32:30
5931114,39349,24529597,23,"Would call with signature of `that.highlight(query, suggestions)` as the results may not correlate directly with the query, for instance misspellings corrected with Levenshtein distance.",208127330,2015-02-12 03:21:06
13289764,1422009,59051212,8,"Is this even necessary ? I don't think that `rendered` is used after this, so I think we can remove this line.",412431178,2016-04-08 23:24:36
1212179,64314,3211840,4,"rm extra colon at the end.

also, i'd just comment that you can add this to your project's maven pom.xml

also worth noting that artifacts are published to maven central.",34993420,2013-03-02 04:55:44
1212179,64314,3211843,11,add a comment like <!-- or whatever is latest -->,34993420,2013-03-02 04:56:01
1255023,64314,3397831,43,i'd prefer the dead code was removed.,36488951,2013-03-16 01:31:36
1255023,64314,3397842,39,final,36488951,2013-03-16 01:32:26
1257652,64314,3415439,38,i think both these should be `static final`,36505382,2013-03-18 22:43:45
1257652,64314,3415449,41,add some Preconditions not null,36505382,2013-03-18 22:44:19
1257652,64314,3415469,57,does hosebird ever end a line with just a \r or just a \n? i think its just \r\n...,36505382,2013-03-18 22:45:19
1257652,64314,3415543,35,`final`,36505382,2013-03-18 22:49:14
1257652,64314,3415569,69,"i haven't looked at all the edge cases, but can buffer.length - end ever be less than 0? if so, i suspect this could throw. is it worth wrapping it in a Math.max(0, ...)?",36505382,2013-03-18 22:50:32
1257652,64314,3415586,81,would it help logging at debug or trace level the bytes that we've received so far (as a string)?,36505382,2013-03-18 22:51:26
1257652,64314,3415668,100,/r => \r,36505382,2013-03-18 22:54:47
1257652,64314,3415703,147,extra whitespace min(,36505382,2013-03-18 22:56:15
1257652,64314,3415805,160,rm,36505382,2013-03-18 23:00:33
1257652,550519,3416563,160,"sorry, what did you want me to remove? github is confusing me",36505382,2013-03-18 23:32:51
1257652,64314,3416736,160,the contentless `@throws IOException` line,36505382,2013-03-18 23:41:04
1257652,550519,3416773,57,i think hosebird only writes a \n after a delimited length ,36505382,2013-03-18 23:42:46
1257652,550519,3416784,69,"end should never be greater than buffer.length, since end correspondes to the number of bytes read to that buffer.
also end is set to 0 just before this.",36505382,2013-03-18 23:43:24
1257652,550519,3416807,81,"might help, not sure how we'd handle cases where the last byte is actually half of a multibyte character though. Does creating a string for cases like that throw?",36505382,2013-03-18 23:44:26
1257652,64314,3416975,81,yeah it'd throw... lets punt on it for now.,36505382,2013-03-18 23:53:55
1259572,64314,3435279,28,rm the println,36516683,2013-03-19 22:47:52
1259572,64314,3435307,25,instead: `throw new UnsupportedOperationException();`,36516683,2013-03-19 22:48:50
1259572,64314,3435309,31,instead: `throw new UnsupportedOperationException();`,36516683,2013-03-19 22:48:55
1259572,64314,3435326,52,space before {,36516683,2013-03-19 22:49:31
1259572,64314,3435458,19,are you doing a defensive copy here? seems reasonable i guess.,36516683,2013-03-19 22:55:10
1259572,64314,3435570,13,"this seems simple enough, an alternative might be to use Guava's ByteStreams.join() and work with InputSupplier<InputStream>s.

i guess i'm not certain when you end up reading from multiple InputStreams in the client code? hmm, my best guess is that you",36516683,2013-03-19 22:59:32
1259572,64314,3435520,31,no go time on the println,36516683,2013-03-19 22:57:53
1325679,64314,3904719,5,"i'd prefer this wasn't exposed at this level. instead you should be able to ask the RateTracker directly for this. instead you could expose a getRateTracker() method here, but even then, i'd like to understand why you need to expose it here.",37733782,2013-04-23 02:03:04
1325679,249590,3904913,5,This was actually just for testing. See the test in ClientBuilderTest.java to make sure the custom RateTracker is actually being used by the BasicClient returned from ClientBuilder. Welcome suggestions for a better way.,37733782,2013-04-23 02:13:22
1325679,64314,3905131,5,"cool, then in that test, i would just keep a reference to the RateTracker you are going to pass into the ClientBuilder and you can ask the reference for the value. but given that, i'm not sure its testing all that much. i'd be fine without this extra test",37733782,2013-04-23 02:24:02
3222246,1490238,10461468,14,"yep, UrlCodec.encode() is the correct usage.",94733889,2014-03-11 10:25:56
3222246,1490238,10461488,5,"Looks good, ship it.",94733889,2014-03-11 10:28:44
3222246,550519,10496477,5,after talking about this offline: 2.0.0-SNAPSHOT,94733889,2014-03-12 03:12:14
3241001,12202,10553109,33,"TwitterObjectFactory#createDirectMessage
http://twitter4j.org/oldjavadocs/3.1.0-SNAPSHOT/twitter4j/TwitterObjectFactory.html#createDirectMessage(java.lang.String)

?",95853735,2014-03-13 11:23:15
3241001,64314,10572448,33,"i don't think we can get the raw json string for the ""direct_message"" key from `json` here.",95853735,2014-03-13 22:25:08
3442627,64314,11408563,18,"Hmm, what does this mean for the lifecycle of the `client`? It looks like `ClientBase.run()` shuts down the shared `ClientConnectionManager` when it exits which seems wrong to me.

I /think/ that means we should consider that your first approach isn't c",101940391,2014-04-09 00:59:56
3442627,550519,12121863,18,"i don't see a point of having the SitestreamController coupled as part of the Client anymore. I vaguely remember that we wanted to be able to easily make controlstream requests if a Twitter4jSitestreamClient was set up, but it seems reasonable that people",101940391,2014-04-30 04:02:36
3442627,3728938,12123758,18,"It seems like it would be fine as a separate entity. I guess the only caveat here is that once the reader connection is closed, the SitestreamController is no longer useable (there's no sitestream to control), and I guess I should at least document that t",101940391,2014-04-30 05:01:02
3442627,550519,12202576,52,"i think if we go down this path, we shouldn't take in an HttpClient as an argument, and probably have the sitestreamHosts host list as a default argument.",106440047,2014-05-02 00:24:56
3442627,3728938,12203087,52,"Hosts as a default argument, I agree. I think keeping either the ConnectionManager or the HttpClient as a parameter may still be valuable because it allows for the same kind of ConnectionManager configuration we do for the regular Client.",106440047,2014-05-02 00:35:11
3442627,550519,12203769,52,"oh sorry, you're right, i misread the code.

Do you think it'd be worth it to keep the createSitestreamController() for Twitter4jSitestreamClient?",106440047,2014-05-02 00:48:17
3442627,3728938,12204899,52,Sure. We can have it do roughly the same thing that's happening here with all the defaults.,106440047,2014-05-02 01:11:59
3442627,3728938,12205041,52,"Actually... Can it be kept? Unless you can get the auth details from the BasicClient from within the Twitter4jSitestreamClient, this probably won't work.",106440047,2014-05-02 01:15:09
3732921,64314,12984728,17,"I know hosebird allows you to do this, but our preference would be that these types of connections would go to stream.twitter.com instead. I'm not sure we'll allow this for forever (I'm also not saying we're removing it now). So given that, I'd prefer to ",113143661,2014-05-23 08:21:51
3732921,3228508,13008386,17,Thanks for the reply Kevin but I'm not sure I understand. Isn't the 'follow' parameter required for a site stream connection per https://dev.twitter.com/docs/api/1.1/get/site ? Or are you saying that site stream support in HBC is kind of deprecated?,113143661,2014-05-23 21:58:25
3732921,64314,13016305,17,"Well this is embarrassing… You're correct. In our internal code we worked around this flaw by adding it via `addQueryParameter(""follow"", id)`

But. I think a better approach is enforcing this in the SitestreamEndpoint constructor. Then we can enforce th",113143661,2014-05-24 00:50:39
3774937,64314,13348621,5,add a space after if,115084582,2014-06-03 22:50:56
3774937,64314,13348634,19,add a space after if,115084582,2014-06-03 22:51:06
3874415,12202,13623374,1,remember the license header information (see other files for an example),124824660,2014-06-11 03:19:11
3874415,2612267,13655811,1,done,124824660,2014-06-11 20:35:25
3931116,64314,13924601,24,"SimpleDateFormat is not a thread safe class, so i worry when i see it in a static variable.

i think the solution here is to inline this into `formatDate` and just pay the cost of creating one every time its called. this isn't perf sensitive part of the",125959795,2014-06-18 21:24:00
3931116,64314,13924654,25,"change fromDate and toDate be private and final.
",125959795,2014-06-18 21:25:06
3931116,64314,13924712,49,do these have to be mutable? what is the use case given that they are passed into the ctor.,125959795,2014-06-18 21:26:13
3931116,64314,13924729,39,"i think we should have constants for ""fromDate"" and ""toDate""",125959795,2014-06-18 21:26:44
3931116,64314,13924752,49,"also, not to mention even if this is in fact necessary, it needs a not null check.",125959795,2014-06-18 21:27:13
3931116,64314,13924780,26,can all of these be private?,125959795,2014-06-18 21:27:46
3931116,64314,13924874,15,theres some extra whitespace after uri,125959795,2014-06-18 21:29:38
3931116,64314,13924980,24,"i don't think Simple in the name adds much value. how about EnterpriseStringProcessor? 

also, please add short javadoc for the class. eg saying that its intended for use with x,y,z",125959795,2014-06-18 21:31:35
3931116,64314,13925086,24,ok actually maybe the name is just LineStringProcessor since its not really coupled to the enterprise stuff. i would still call out in the javadoc where its intended use cases are.,125959795,2014-06-18 21:33:35
3931116,64314,13926694,12,my preference is to have separate test classes for each class under test.,125959795,2014-06-18 22:02:24
3931116,64314,13926714,1,please add notice at top of file,125959795,2014-06-18 22:02:49
3931116,64314,13926739,15,break up long line,125959795,2014-06-18 22:03:19
3931116,64314,13926820,43,its bad form in maven to have more than 1 main per module. perhaps just keep the code but comment it out?,125959795,2014-06-18 22:04:57
3931116,64314,13926826,31,its bad form in maven to have more than 1 main per module. perhaps just keep the code but comment it out?,125959795,2014-06-18 22:05:04
3931116,64314,13926893,21,one thing i'm a bit wary of is having a concrete class extend another concrete class. this often leads to sadness. might be worth introducing an AbstractEnterpriseStreamingEndpoint,125959795,2014-06-18 22:06:22
3931116,2612267,13927076,24,fixed,125959795,2014-06-18 22:10:13
3931116,2612267,13927231,25,fixed,125959795,2014-06-18 22:13:07
3931116,2612267,13927307,15,fixed,125959795,2014-06-18 22:14:50
3931116,2612267,13928271,39,fixed,125959795,2014-06-18 22:31:15
3931116,2612267,13928329,49,made final,125959795,2014-06-18 22:32:07
3931116,2612267,13928646,26,these are extended by EnterpriseStreamingEndpoint,125959795,2014-06-18 22:37:30
3931116,2612267,13928702,1,fixed,125959795,2014-06-18 22:38:50
3931116,2612267,13928729,15,fixed,125959795,2014-06-18 22:39:21
3931116,2612267,13928796,43,commented out main,125959795,2014-06-18 22:40:26
3931116,2612267,13929317,31,commented out main,125959795,2014-06-18 22:49:06
3931116,2612267,13933511,1,fixed,125959795,2014-06-18 23:56:12
3931116,2612267,13933520,15,fixed,125959795,2014-06-18 23:56:20
3931116,2612267,13933550,43,commented out main,125959795,2014-06-18 23:56:43
3931116,2612267,13933566,31,commented out main,125959795,2014-06-18 23:57:02
3931116,2612267,13935029,12,moved to LineDelimitedStreamProcessorTest,125959795,2014-06-19 00:24:46
3931116,2612267,13935051,39,added to Constants,125959795,2014-06-19 00:25:11
3931116,2612267,13935286,49,made final,125959795,2014-06-19 00:30:19
3931116,2612267,13935724,21,added AbstracEnterpriseStreamingEndpoint,125959795,2014-06-19 00:39:04
3931116,3728938,13983669,31,Any particular reason this block is commented out for the example?,128545989,2014-06-19 23:05:12
3931116,64314,13983767,29,i think this can be private now,128545989,2014-06-19 23:06:33
3931116,64314,13983801,24,put statics before members,128545989,2014-06-19 23:07:14
3931116,3728938,13983806,31,Any reason main() is commented out for this example?,128545989,2014-06-19 23:07:18
3931116,64314,13983830,27,rm blank line,128545989,2014-06-19 23:07:31
3931116,2612267,13984611,31,Bad form to have more than 1 main per package in maven. Per Kevin's advice,128545989,2014-06-19 23:21:10
3931116,2612267,13984650,29,@noonhub can you get this,128545989,2014-06-19 23:21:41
3931116,2612267,13984658,24,@noonhub dido,128545989,2014-06-19 23:21:48
3931116,2612267,13984679,27,@noonhub dido ,128545989,2014-06-19 23:22:02
3931116,2760671,13999758,29,done,128545989,2014-06-20 04:11:55
3931116,2760671,13999765,24,done,128545989,2014-06-20 04:12:02
3931116,2760671,13999787,27,done,128545989,2014-06-20 04:12:31
3931116,3728938,14097485,29,I think this is referring specifically to the queryParameters map,128545989,2014-06-24 01:17:33
3931116,3728938,14097696,7,Do these now need the Override annotation in BaseEndpoint now?,128647849,2014-06-24 01:22:15
3931116,3728938,14098408,35,"I think I prefer the more-concise empty method where it's just on one line, but take it or leave it.",128647849,2014-06-24 01:35:20
3931116,3728938,14098434,6,"same comment about empty method thing, but for all of these (it does make the example a bit lengthy)",128647849,2014-06-24 01:35:56
3931116,2760671,14254253,7,fixed,128647849,2014-06-26 22:37:02
3931116,2760671,14260667,6,I'm into it. This was mainly due to intellij auto-formatting not liking the single line method declaration. I found the configuration to fix that though. :),128647849,2014-06-27 00:18:53
5705207,64314,22403191,5,I don't see `close()` on `Client` or `BasicClient`. Should this be `hosebirdClient.stop()` instead?,201476575,2015-01-02 07:04:20
5705207,1617408,22431651,5,"Yep, I'm an idiot",201476575,2015-01-03 21:04:56
1296727,44018,3554559,71,"Yeah, good call. I was having some issues with the damned `this.type` -- I took a second stab at an immutable cache trait that moves it down.",37528149,2013-03-27 22:37:12
1296727,7111,3563139,40,ttl? specs?,37532568,2013-03-28 06:14:41
1296727,7111,3563190,25,This is a shitty cache.  Really hot keys get evicted fast.  Let's stick to well studied/state-of-the-art caches.,37532568,2013-03-28 06:19:03
1296727,7111,3563195,55,get(k).isDefined?,37532568,2013-03-28 06:19:38
1296727,7111,3563203,43,Can you add scaladoc and explain what a minimal implementation does? (get/put/hit/evict).,37532568,2013-03-28 06:20:40
1296727,7111,3563213,25,Can we rename this MapCache?,37532568,2013-03-28 06:21:33
1296727,7111,3563241,43,"extends Map[K,V]?

I think you just need to implement iterator, which isn't a big pain, and change put to +, evict to -.",37532568,2013-03-28 06:24:08
1296727,44018,3564208,43,Discussed offline... turned out to be a big pain.,37532568,2013-03-28 08:27:20
1296727,44018,3564239,25,Removed.,37532568,2013-03-28 08:33:33
1296727,44018,3564260,40,Fixed TTL.specs on the way.,37532568,2013-03-28 08:35:52
1296727,44018,3564264,25,Done,37532568,2013-03-28 08:36:07
1296727,7111,3575057,102,"Still don't like touch.  Can I talk you into:

```scala
/** Note the value is lazy so it is safe to do:
 * {{{  ensure(k, f(k)).get(k) }}}
*/
def ensure(k: K, v: => V): Cache[K,V]
```
",37538491,2013-03-29 00:01:34
1296727,7111,3575087,111,skeptical we need this method if we assume caches are always local.  Can we cut it?,37538491,2013-03-29 00:02:42
1296727,7111,3575205,111,"It's worse than that, what happens if some of the set gets evicted by the end?  This method seems ill-specified.",37538491,2013-03-29 00:07:45
1296727,7111,3575238,46,Seems like policy being forced here.  Are you sure you never want to cache an exception?,37538613,2013-03-29 00:09:37
1296727,7111,3575266,47,"non exhaustive match, right?  What about None?",37538613,2013-03-29 00:10:35
1296727,7111,3575282,47,"Duh, you caught it above. I'm still not perfect. :(",37538613,2013-03-29 00:11:13
1296727,7111,3575391,81,"Think we need:
```scala
 @tailrec
 final def effect(f: T => (S,T)): (S,T) = {
   val oldValue = atomic.get()
   val withEffect = f(oldValue)
   if (atomic.compareAndSet(oldValue, withEffect._2)) withEffect else update(f)
}
```",37538613,2013-03-29 00:16:23
1296727,7111,3595014,34,"I'm not sure this makes as much sense for MutableCache.  The problem is that this is not atomic.  Since the cache can change by the time you get after the hit, it's changed.  For immutable, this method makes sense.

I would say that for mutable cache yo",37541036,2013-03-30 23:16:59
1296727,7111,3595884,31,"since the cache is mutable, this k could be evicted by now, right?  I think this is more reason to have hitAndGet on mutable caches and pattern match on that result.

Also, can't this case be dropped since it is the same as the Some(cached) case after t",37541036,2013-03-31 07:08:07
1296727,7111,3595885,51,with getAndHit this logic also becomes (slightly) simpler.,37541036,2013-03-31 07:09:32
1296727,7111,3693220,28,I think you need T <: AnyRef here for AtomicReference to actually work correctly (since it deals with reference equality).,37541050,2013-04-08 17:47:16
1296727,7111,3693339,40,I don't understand how we can be sure that the underlying map (Cache) here won't break the LRU promise of this map.  Can you add a comment to explain this more clearly?,37541050,2013-04-08 17:54:40
1296727,7111,3693383,72,I think you need newMap.put because this might also cause an eviction in the underlying cache you are wrapping.  I dont think this code is handling that case.,37541050,2013-04-08 17:57:07
1296727,7111,3693397,83,"Can we use iterator here, which might be more direct (potentially use less memory) than generating the map.",37541050,2013-04-08 17:57:53
1296727,7111,3693420,30,How about call by name here?  I think having to always write the supplier is a bit ugly.,37541050,2013-04-08 17:59:28
1296727,7111,3693576,12,How about withCache that takes an immutable Cache and then behind the scenes creates the MutableCache.,37541050,2013-04-08 18:09:35
1296727,7111,3693561,23,awesome.,37541050,2013-04-08 18:08:49
1296727,44018,3701127,72,"Good catch, will fix.",37541050,2013-04-09 00:25:50
1296727,44018,3701132,83,"Sure, sounds good to me.",37541050,2013-04-09 00:25:58
1296727,44018,3701134,30,Yup.,37541050,2013-04-09 00:26:07
1296727,7111,3701621,32,this is not right is it?  Don't you need `cacheRef.get.contains(k)`,37528146,2013-04-09 00:49:49
1296727,44018,3701648,32,"nice!
",37528146,2013-04-09 00:50:45
1296727,7111,3701730,78,"Should we add a method to just clean out any that need to expire?

Something like putClocked without a kv?  Something like:
```scala
def removeExpired: TTLCache[K,V]  = /* if none expired this, else remove */
```",37528146,2013-04-09 00:54:32
1296727,44018,3702569,78,Done in #79 ,37528146,2013-04-09 01:46:11
1296727,44017,3552044,71,"Just curious, why delegate this default implementation to a companion object instead of just having it directly in the trait?",37528149,2013-03-27 20:47:04
1296727,7111,3574896,44,Can we move this to Atomic.scala?,37538491,2013-03-28 23:54:06
1296727,7111,3575325,34,Can we share this function within get?,37538613,2013-03-29 00:12:50
1296727,7111,3575368,52,no guarantee the cache can hold all these keys.  I think you need the updateWithState here and actually do the lookup on the old cache before you commit.,37538613,2013-03-29 00:14:50
1296727,7111,3575824,28,"document the meaning of the law, please.",37538613,2013-03-29 00:37:37
1298627,7111,3581516,30,"I think we want:

Injection[T, ChannelBuffer]

Going backwards from ChannelBuffer may fail, but this should guarantee you can go forward.",37541972,2013-03-29 06:55:17
1298627,7111,3581555,45,"Skeptical about V: ChannelBuffered rather than keeping RedisStore simple and using things like:

https://github.com/twitter/storehaus/blob/develop/storehaus-algebra/src/main/scala/com/twitter/storehaus/algebra/ConvertedStore.scala#L28

with it.  Our a",37541972,2013-03-29 07:00:19
1298627,2618,3582280,45,"I'm discovering the provided facilities as I'm writing and hadn't come across that yet. It looks like it accomplishes the same task, typed values. I created the typed values because I needed a numeric value so that I could support the underlying client's ",37541972,2013-03-29 09:08:18
1298627,2618,3582555,45,"Here's the new rub

Cannot find Monoid type class for org.jboss.netty.buffer.ChannelBuffer

[error]     MergeableStore.fromStore(new ConvertedStore(redisStore)(StringToChannelBuffer(_)))

If I don't have primitive type ( string, int, long ) baked in",37541972,2013-03-29 10:09:18
1298627,44017,3582630,45,"I think maybe what you want is to have RedisIntStore etc extended ConvertedStore, and wrap a basic RedisStore (from which they'll grab the redis client and use it directly to implement merge)?",37541972,2013-03-29 10:26:44
1298627,2618,3597888,45,Specialized mergable stores are now implemented in terms of composing ConvertableStores. One thing that was a surprise was this compilation type error the convertable stores when I didn't explicitly provide its type args. https://gist.github.com/softprops,37541972,2013-04-01 08:02:45
1298627,7111,3693687,38,"It seems that these are not the same transform: invert(apply(x)) != Some(x).

Why aren't you doing something like: StringToCB(a.toString)?",37552240,2013-04-08 18:16:54
1298627,2618,3694487,38,I think I originally had something like the opposite of this for invert but went testing found that redis just returned channel buffers encoding longs a strings rather than longs. You've got a good point there though. I'll see if there aren't any side eff,37552240,2013-04-08 19:00:58
1298627,7111,3701939,38,"If that's the case, I guess this is just a weird nature of the finagle redis client.

I don't mind a weird Injection, I'd just like it to be private since someone else might not notice the asymmetry.",37552240,2013-04-09 01:09:11
1298627,7111,3701962,34,Can we make this private and pass it explicitly due to the weird asymmetric nature of the encoding?,37552240,2013-04-09 01:10:41
1298627,2618,3702069,60,That may be a failure case here. I'll check for it tonight. Thanks for all your feedback. Good stuff.,37552240,2013-04-09 01:17:50
1298627,7111,3805066,59,Please put the return type on any public methods (binary compatibility is a pain otherwise),37552264,2013-04-16 06:25:48
1298627,7111,3805093,93,"you don't need to do this.

Only implement this method if the underlying store has some multiPut that is better than doing a single put over and over.  The default implementation will call put over and over.  You only have to implement either put OR mul",37552264,2013-04-16 06:28:45
1298627,7111,3805124,22,"Don't like this.

If you have an Injection from String to ChannelBuffer in scope, then you can do:

import com.twitter.bijection.Conversion.asMethod

""hello world"".as[ChannelBuffer]

which at least decorates the place where you are doing the conve",37552264,2013-04-16 06:33:07
1298627,2618,3805491,93,this multiput here partitions kv into deletes and store updates and then uses the wrapped stores ability to delete and update more than one value ( Set[ChannelBuffer] ) in one call. The member set store store here provides a different view of the set that,37552264,2013-04-16 07:24:50
1298627,44017,3517252,48,"Maybe I'm missing something here, but if we don't have a value for every key, won't this lead to us returning a completely empty result, instead of values for the keys we do have?",37552232,2013-03-26 00:00:33
1298627,2618,3517811,48,I thought about this as well be I didn't see a deterministic way to map the values returned by mGet to their corresponding keys [here](https://github.com/twitter/finagle/blob/master/finagle-redis/src/main/scala/com/twitter/finagle/redis/StringCommands.sca,37552232,2013-03-26 00:25:12
1298627,44017,3518031,48,"It looks to me like redis.size should always be == keys.size, because Redis returns EmptyBulkReply for missing keys, which is getting mapped, in the code you linked, to None. So you can probably just throw an exception on this line if it ever happens, bec",37552232,2013-03-26 00:35:21
1298627,2618,3518381,48,Ok. Is there a storehaus-specific exception to be thrown or do I need to call something like [Future.exception(ex)](https://github.com/twitter/storehaus/blob/develop/storehaus-memcache/src/main/scala/com/twitter/storehaus/memcache/MemcacheStore.scala#L51),37552232,2013-03-26 00:53:00
1298627,2618,3518428,48,Or maybe [MissingValueException](https://github.com/twitter/storehaus/blob/develop/storehaus-core/src/main/scala/com/twitter/storehaus/FutureOps.scala#L27)?,37552232,2013-03-26 00:55:12
1298627,44017,3518693,48,Not sure. @sritchie @johnynek what's the right thing to do for basically an assertion failure?,37552232,2013-03-26 01:06:36
1298627,44018,3518735,48,"If redis returns a smaller keyset, I'd say map missing keys to a Future.exception -- you might create your own in this case, since if this assertion fails I don't know that we can glean any information at all about what happened to the missing value.",37552232,2013-03-26 01:08:59
1298627,44017,3519595,48,"To be clear, if redis returns a smaller keyset the whole response is suspect. (Also to be clear: this is different from my assumption at the top of this thread :). ",37552232,2013-03-26 01:56:20
1298627,7111,3701991,60,this monoid rolls over when you do: Int.MaxValue + 1 == Int.MinValue.  Is that what Redis does?,37552240,2013-04-09 01:12:15
1298627,2618,3702051,34,No reason not to.,37552240,2013-04-09 01:16:49
1308264,7111,3693120,10,"Can you add back an additional selectFirstSuccessfulTrial without the predicate so we don't break binary compatibility?

",37609247,2013-04-08 17:37:21
1308264,7111,3693612,10,"I guess the next release is a binary incompatible one, so you can disregard. If you agree, we can just merge this now.",37609247,2013-04-08 18:11:17
1308329,7111,3693947,51,How are these ChannelBuffer serialized?  Can you add a comment to explain this?,37609729,2013-04-08 18:30:22
1308329,7111,3702025,51,"More specifically, are they just channelbuffers of UTF-8 strings?",37609729,2013-04-09 01:14:51
1308329,814892,3702079,51,That's correct. Will add a comment.,37609729,2013-04-09 01:18:25
1308329,814892,3702082,49,"Thanks, will fix this",37609729,2013-04-09 01:18:36
1308329,2618,3702375,98,are these strings expected to be pre-sanitized for sql injection? I'm not that familiar with the finagle mysql client but I'd actually feel a little more at ease if it were using prepared statements.,37609729,2013-04-09 01:34:45
1308329,814892,3702863,98,finagle-mysql does support that. Will switch to using prepared statements,37609729,2013-04-09 02:02:08
1308329,44018,3744644,42,Can you add an example usage that shows what sort of strings are allowed? You can add code snippets in scaladoc between {{{ and }}}.,37631733,2013-04-11 04:10:33
1308329,44018,3744651,27,"This is the place for a more detailed doc on what this is and how one might use it. For example, do I need tables set up especially for this store, or can I use it with existing stores?",37631733,2013-04-11 04:11:16
1308329,44018,3744677,69,"or mkString(""("", "","", "")"") to get the ends",37631733,2013-04-11 04:13:20
1308329,44018,3744669,69,"Stream.continually(""?"").take(ks.size).mkString("","")",37631733,2013-04-11 04:12:54
1308329,44018,3744684,65,you shouldn't need to use this mutable map builder; more comments below.,37631733,2013-04-11 04:13:41
1308329,44018,3744720,80,"by calling get here, you block and lose the whole async property.",37631733,2013-04-11 04:16:09
1308329,44018,3744783,80,"To get a proper return future, do something like:

```scala
FutureOps.liftValues {
  mysqlResult.map { case (_, rows) => // map the future rather than calling get
    val rowMap = rows.toMap                // this shouldn't lose any data; because you",37631733,2013-04-11 04:21:44
1308329,44018,3744790,91,don't call get on the future here,37631733,2013-04-11 04:22:04
1308329,44018,3744795,116,"don't get the future ever, just map it:

```scala
client.prepareAndExecute(DELETE_SQL, k.getBytes).map { _._2 }
```",37631733,2013-04-11 04:22:37
1308329,44018,3744800,119,comment,37631733,2013-04-11 04:22:49
1308329,814892,3757537,80,"I've changed it to the following. Let me know if this looks correct:

```scala
FutureOps.liftValues(ks, mysqlResult.map { case (_, rows) => rows.toMap }, { (k: K1) => Future.value(Option.empty) })
```",37631733,2013-04-11 22:26:22
1308329,44018,3757682,81,"what is ""row"" here? I get nervous about ""get"", ever. If it's an option, we need to handle the None case as well.",37639062,2013-04-11 22:34:34
1308329,44018,3757686,96,same comments here.,37639062,2013-04-11 22:34:44
1308329,814892,3758030,81,"It's from finagle: https://github.com/twitter/finagle/blob/master/finagle-mysql/src/main/scala/com/twitter/finagle/mysql/ResultSet.scala#L46

It's an option, which is None only when the column name does not exist in the result. We shouldn't be hitting t",37639062,2013-04-11 22:50:42
1308329,44018,3784820,104,"Future.None, please",37609713,2013-04-14 05:39:00
1308329,44018,3641196,48,Looks good. You'll need to delete if the supplied value is None and set if it's Some.,37609736,2013-04-03 22:34:11
1308329,7111,3693920,49,"Can you keep a keyMap:
```scala
val keyMap = ks.map { k => (k.toString, k) }.toMap
```
And then use it below instead of the cast?  This is a little defensive (your code would work in almost all cases), but I don't like the cast.",37609729,2013-04-08 18:29:05
1317134,7111,3804993,51,"Can we get stringStore instead?  strings seems confusing as a name
",37672532,2013-04-16 06:17:19
1317134,7111,3805000,32,Mark TODO move this into bijection-netty.  I think we're going to be reimplementing this one over and over.,37672532,2013-04-16 06:18:22
1317134,2618,3805929,32,Done and [done](https://github.com/twitter/bijection/pull/109),37672532,2013-04-16 08:46:45
1318323,44018,3822658,16,calling get on opt is never good. what if you're None?,37680795,2013-04-17 03:25:27
1318323,814892,3822795,16,This line is actually calling get on the future and storing the returned opt in foundOptV.,37680795,2013-04-17 03:33:48
1321499,44018,3864255,26,"Can we rename ""RetryingReadableStore"" for spelling? Sorry for the nitpick.",37704295,2013-04-19 02:50:37
1321499,44018,3864272,16,"""After a couple of retries""... can you beef this up a little with more information about how the stream of durations is used?",37704295,2013-04-19 02:51:40
1321499,7835,3864303,26,Sure.  I always find it hard to come up with meaningful and terse class names :),37704295,2013-04-19 02:54:26
1321499,44018,3864363,52,Do we want to retry unsuccessful puts?,37704295,2013-04-19 02:58:26
1321499,44018,3864366,52,"Also, override multiPut as well",37704295,2013-04-19 02:58:39
1321499,44018,3864355,37,"Does it make sense to match against Duration.Zero and skip the timer? We also need to handle Duration.Top, I think. This whole block might be easier to reason about with a pattern match:

```scala
  backoffs match {
    case Stream.Empty => FutureOps.",37704295,2013-04-19 02:57:57
1321499,7111,3864461,19,Why not an Iterable[Duration]?,37704295,2013-04-19 03:03:38
1321499,7835,3864532,19,"Stream[Duration] is used in Finagle's RetryPolicy.  I'm just following what they use in Finagle:

https://github.com/twitter/finagle/blob/master/finagle-core/src/main/scala/com/twitter/finagle/service/RetryingFilter.scala",37704295,2013-04-19 03:07:29
1321499,7835,3864566,37,"Sam, thanks a lot for the advice.  This looks a lot better.  Again I was following some existing code in Servo.",37704295,2013-04-19 03:09:23
1321499,7835,3864645,52,"Will override multiPut.

I don't think it's necessary to retry on unsuccessful puts.  The retry for `get` is for values that don't meet our predicate.  For `put` there's no such semantics I think.",37704295,2013-04-19 03:14:31
1321499,7111,3866020,36,This should be Future.exception(e) right? otherwise we can't distinguish absent keys.,37705766,2013-04-19 05:09:56
1321499,7111,3866087,36,"how about Iterable[Duration] and use head and tail? Then you can use List, Vector, or Stream.",37705766,2013-04-19 05:17:31
1321499,7111,3866090,25,Iterable here.,37705766,2013-04-19 05:17:51
1321499,7111,3866104,19,"Stream is Iterable.

Let's accept the most general.",37704295,2013-04-19 05:19:27
1321499,7835,3866119,36,Sure.,37705766,2013-04-19 05:21:46
1321499,7111,3866146,52,"[-K, V]

contravariant on K",37705766,2013-04-19 05:26:14
1321499,7111,3866155,26,"class RetryingReadableStore[-K,+V]

add variance.",37705766,2013-04-19 05:26:59
1321499,7835,3866160,26,Good catch!  Thanks.,37705766,2013-04-19 05:27:44
1380262,44018,3987372,35,`case IntValue(d) | ShortValue(d) `.... etc for all of these that are the same,38116380,2013-04-27 04:29:16
1380262,44018,3987373,49,same here,38116380,2013-04-27 04:29:21
1380262,44018,3987383,19,"Can you define an enum for these?

http://www.scala-lang.org/api/current/index.html#scala.Enumeration",38116380,2013-04-27 04:30:34
1380262,814892,3991938,35,"looks like variable binding here is not yet supported?
https://issues.scala-lang.org/browse/SUGGEST-25

```
[error] storehaus/storehaus-mysql/src/main/scala/com/twitter/storehaus/mysql/ValueMapper.scala:55: illegal variable in pattern alternative
[er",38116380,2013-04-28 22:58:21
1380262,814892,3991975,19,fixed,38116380,2013-04-28 23:18:20
1380262,44018,4003796,17,"Could you replace everything below with...

```scala
def validPairs[T] = Arbitrary.arbitrary[List[(T, Option[T])]] suchtThat(!_.isEmpty)
```",38427875,2013-04-29 22:59:48
1380262,814892,4022956,17,fixed,38427875,2013-04-30 22:22:01
1417507,44018,4033295,36,"oh boy, this is a huge bug if that's the real meaning of the API. Can you link me to a doc?",38917981,2013-05-01 11:46:21
1417507,7111,4309564,36,We need to be sure about this before merge.,38917981,2013-05-21 06:55:34
1417507,7111,4309580,9,might be safer to make it `withPutTtl` in case there are multiple TTLs (note the trait has the Put).,39836198,2013-05-21 06:57:53
1421905,44018,4082092,73,`.lift(0)` -> `.flatten`,39033094,2013-05-04 02:50:18
1421905,44018,4082100,73,"`.getOrElse(Option.empty)` can probably just be `.flatten`, so `result.headOption.flatten`",39033094,2013-05-04 02:51:06
1421905,44018,4082108,89,"use

```scala
row(kCol).map(MySqlValue(_))
```",39033094,2013-05-04 02:51:43
1421905,44018,4082131,90,"Docs, please?",39033094,2013-05-04 02:52:39
1421905,44018,4082141,61,"Can you document the conventions you're introducing -- Some("""") vs None, etc?",39033094,2013-05-04 02:53:02
1421905,44018,4082169,52,"Prefer `map` to the pattern match, again",39033094,2013-05-04 02:54:07
1421905,44018,4096567,38,`v.flatMap { d => MySqlStringInjection.invert(d.toString) }`,39803221,2013-05-06 22:08:41
1421905,814892,4096695,38,fixed,39803221,2013-05-06 22:15:50
1438544,44018,4095381,4,"Are these the redis defaults, or defaults required by travis?",39706295,2013-05-06 21:00:23
1438544,44018,4095391,4,"Also, would you mind adding a note to the README on how to configure your local machine to run the redis tests?",39706295,2013-05-06 21:00:47
1438544,44018,4095408,21,"I see you're becoming a Scalacheck wizard! After spending some time with scalacheck, I feel queasy writing non-fuzz tests.",39706295,2013-05-06 21:01:37
1438544,2618,4095522,4,Thanks!,39706295,2013-05-06 21:08:30
1527866,44018,4483853,50,I like this pattern.,43297694,2013-06-01 00:36:37
1625206,7111,4831949,22,"is it too restrictive to return `Future[Option[V]]` which is the original input to the function? This way, the caller knows the value that was actually set into the store.

This does make buffering a pain, and I'm speculating on use cases, so ....",46562451,2013-06-23 03:11:29
1625206,44017,4831970,22,"I was mostly just going by analogy with put, which also returns Future[Unit]. 

Buffering being a pain is a good point, and for me right now that outweighs any hypothetical benefit of returning it (I know that we'd want buffering with this, I'm not sure",46562451,2013-06-23 03:24:30
1625206,7111,4843629,21,missed the todo. Carry on.,46562451,2013-06-24 20:01:21
1625206,7111,4831955,21,"Can you say something about the contract here?  Above you return an exception if it doesn't succeed once.

If we have that, we might also put `retryingUpdate(k : K)(fn : Option[V] => Option[V]) : Future[Unit]` that will rescue and retry if there is a co",46562451,2013-06-23 03:15:39
1625206,44017,4831966,21,One of my todos in the pull req was a combinator that wrapped a retry around this. I think that's better than a separate method? I could be convinced either way.,46562451,2013-06-23 03:21:38
1649082,7111,5294638,30,"this is in BIjection 0.5.2 now, right?",50611284,2013-07-19 20:17:43
2043488,44018,5309481,59,the unpivot :),56800360,2013-07-21 21:33:33
2043488,7111,6424778,120,"agree, but we can follow up.",56800358,2013-09-18 08:59:12
2043488,7111,6424863,35,"this could be a Mergeable too, with the monoid[Map[ChannelBuffer, Double]] right?

It would have the same semantics as that with zIncrBy, right? Worth adding?",56800358,2013-09-18 09:07:13
2069456,13840,6230445,21,We probably want to limit the scope of this import to the place(s) where it's used.,57786521,2013-09-09 09:09:25
2069456,13840,6230447,43,too many spaces,57786521,2013-09-09 09:10:00
2069456,13840,6230449,41,Does it make sense for `quorumNames` to be a `Seq[String]` ?,57786521,2013-09-09 09:10:21
2069456,13840,6230456,39,Do these need to be public `val`s?,57786521,2013-09-09 09:11:07
2069456,13840,6230469,77,no space,57786521,2013-09-09 09:12:39
2069456,13840,6230478,63,Code style nit: I believe the rest of the code base does not wrap the case statement blocks inside of `{` and `}`.,57786521,2013-09-09 09:13:15
2069456,13840,6230507,30,These classes look very similar to the classes defined above. Any way to DRY this up?,57786521,2013-09-09 09:16:38
2069456,13840,6230522,53,spacing,57786521,2013-09-09 09:18:30
2069456,44018,6281764,79,"worried about Future.apply here... this does call-by-name, so it actually won't start processing until the user does anything. I think we need to make a FuturePool and create a future that way, so that this computation becomes async BUT doesn't block. Tho",57942258,2013-09-11 04:23:18
2069456,44018,6281773,85,Same here; this won't start processing until someone tries to touch the future.,57942258,2013-09-11 04:23:35
2110186,7111,6424715,38,"doesn't this block?

You can use a FuturePool to make this async, or they have an async API, right?",58629344,2013-09-18 08:53:07
2110186,7111,6424726,18,"Might just want:

```scala
Try(a.getN.toLong)
```
to catch the errors for sure.",58629344,2013-09-18 08:54:28
2110186,814892,6439336,38,"Looks like they do have an async client:
http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/AmazonDynamoDBAsyncClient.html
http://aws.amazon.com/articles/5496117154196801",58629344,2013-09-18 22:00:36
2110186,34711,6439803,38,"Brain fart on my part, too much time working on Play apps. Should have been a FuturePool and not a regular Future. I took a look at their Async client initially but it is based on Java futures which are pretty gross and hard to work with in Scala. The Inj",58629344,2013-09-18 22:15:52
2110186,34711,6439832,18,Cool I can make that change. I wasn't sure what your preference was regarding using existing Injections/Bijections vs using the native ```.to*``` methods,58629344,2013-09-18 22:16:57
2110186,12202,6439863,1,don't forget copyright headers please,58629344,2013-09-18 22:17:50
2110186,814892,6439974,38,Makes sense. Maybe just add a comment to document that that option has been explored.,58629344,2013-09-18 22:21:26
2110186,34711,6441986,38,"@rubanm good point, will do. ",58629344,2013-09-18 23:27:04
2110186,34711,6442010,1,@caniszczyk can you please point me to the appropriate copyright headers. Also should those headers be in every file or just certain files? ,58629344,2013-09-18 23:27:57
2110186,12202,6442090,1,"@rweald 

See any source file... but something like this..
/*
 * Copyright 2013 Twitter Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the ""License""); you may
 * not use this file except in compliance with the License. You may obtain
 ",58629344,2013-09-18 23:30:24
2110186,12202,6442105,1,"e.g., see https://github.com/twitter/storehaus/blob/develop/storehaus-algebra/src/main/scala/com/twitter/storehaus/algebra/Algebras.scala",58629344,2013-09-18 23:30:48
2110186,7111,6527367,50,"Let's make this a constructor parameter, and then handle the defaults with apply methods in the DynamoStore.

In my view, using the processor count is a better default:
`val processors = Runtime.getRuntime().availableProcessors;`",58629347,2013-09-24 01:47:21
2110186,34711,6529987,50,"You read my mind. I was just working on doing the constructor argument this afternoon. 

Good point about using processor count as a more sane default. ",58629347,2013-09-24 03:19:56
2113734,44018,6473306,44,"`.map(_.get)`, I think.",58242351,2013-09-20 02:06:27
2113734,44018,6473328,66,"`Future.value`, otherwise this ends up being call-by-name and, I believe, not triggering until someone tries to access the future.",58242351,2013-09-20 02:07:07
2113734,44018,6473369,52,Future.value,58242351,2013-09-20 02:08:38
2113734,34711,6476111,44,"good call, that is much more idomatic. Already made the change. ",58242351,2013-09-20 04:13:01
2113734,34711,6476338,66,That is kind of the behavior I was going for. The operation not being performed until the future is accessed seemed to more closely match the behavior of a remote database where the IO operation is not guaranteed to be performed until you access the futur,58242351,2013-09-20 04:27:22
2243467,13840,6905770,29,"Minor, but did you mean to say `final` here instead of `sealed`? I don't see any subclasses of `Stack` in this file. I believe it's the same case for `LIRSStacks`.",59381362,2013-10-11 05:53:08
2243467,13840,6905890,23,"Given that `Stack` has a `maxSize`, I wonder if it makes sense to not have an ever-increasing index value in `backingIndexMap` and `backingKeyMap`, but instead re-use the integers within (0 to maxSize) to avoid overflow for very large maps.",59381362,2013-10-11 06:01:42
2243467,38527,6906033,29,I misunderstood what sealed does. What's the preferred way to make a class private? Just to make it final? Make the constructor private?,59381362,2013-10-11 06:12:25
2243467,38527,6906059,23,"I thought about this, and I definitely agree. There's a bit more complication to it than than, though.
You could have something with the inc 1, then another thing with the inc 2, then you thing with inc 2 starts cycling, so it goes up to 3, then 4, then ",59381362,2013-10-11 06:14:57
2243467,13840,6906088,29,"Sealed is usually used when you have a fixed number of implementations, and they must be defined within the same source file. In this case maybe you'd want to just say `private[storehaus]`. I'm not sure what the other caches do, but at least you're signal",59381362,2013-10-11 06:17:19
2243467,13840,6906263,23,"Yes, I thought of that too. It's a bit tricky. I'm also curious what the clojure implementation of this does. Also, do we want to make this cache thread-safe? We could use the spin lock implementation Atomic.scala (same package) if we needed to. 

> On ",59381362,2013-10-11 06:30:55
2243467,13840,6907459,23,"Also, it looks like the existing [LRUCache](https://github.com/twitter/storehaus/blob/develop/storehaus-cache/src/main/scala/com/twitter/storehaus/cache/LRUCache.scala#L40) is also using an unbounded index (although it's a Long, not an Int). So, might not",59381362,2013-10-11 08:51:20
2243467,38527,6926979,23,I added a CyclicIncrementer which solves this problem in a pretty generic way. Want me to use it for LRUCache?,59381362,2013-10-12 02:12:51
2243467,38527,6927010,29,"Oscar didn't love all the privates. He suggested tossing it all in a private class if I really care, otherwise just leaving it. What do you think is the best way? I just don't want people to depend on internals.",59381362,2013-10-12 02:14:12
2243467,13840,6928307,29,"Actually, it's funny that you mention that. Today I saw a pull request come
in for Scala's new pickling support that attempted to make classes private
that were not intended for external consumption. The initial approach was
to mark things as ""private[",59381362,2013-10-12 03:17:56
2243467,13840,6928477,23,"Cool! I'll check out the CyclicIncrementer now. It's up to Oscar if he
wants to use it for LRUCache. :) Also, sorry I was thinking of the thread
safety issue from the consumer's perspective, but I think that's probably
outside of the scope of what stor",59381362,2013-10-12 03:26:59
2243467,7111,7536645,28,"comment on the meaning here. (A bit like ""free"" right? in a malloc sense).",68917396,2013-11-09 02:46:05
2243467,7111,7536725,39,Successible[K]?,68917396,2013-11-09 02:49:01
2243467,7111,7536760,108,successible?,68917396,2013-11-09 02:50:04
2243467,7111,7536817,99,"I think the way to do this is:
`def ordering: Ordering[K]` but you might get it implicitly one instances.",68917396,2013-11-09 02:52:26
2243467,7111,7536826,98,not sure why this is implicit.,68917396,2013-11-09 02:52:45
2243467,7111,7536874,96,"why not:
```scala
case class CyclicIncrement[K](side: Side, value: K)(implicit val ordering: Ordering[K])
```
What else are we getting here?",68917396,2013-11-09 02:54:25
2243467,7111,7536933,111,"strictly, this breaks the ordering laws: A < B < C < A. So, A < A.

Perhaps rename this to def offset(that: Side) with the same logic. Do you need Ordered?",68917396,2013-11-09 02:56:37
2243467,7111,7536996,229,Can this be `IdProvider[T]`?,68917396,2013-11-09 02:59:06
2243467,38527,7574541,39,"Once that patch is in, definitely",68917396,2013-11-12 04:45:37
2243467,38527,7574579,108,Agreed,68917396,2013-11-12 04:46:40
2243467,38527,7574705,98,"ease of use, but agree that it shouldn't be",68917396,2013-11-12 04:50:36
2243467,38527,7574742,96,"This is what I had originally. Since there will be theoretically a ton of CylicIncrements, it seemed preferable not to have the extra object reference. I could see making it an abstract class though so we can force the Ordering",68917396,2013-11-12 04:51:51
2243467,38527,7574782,111,"No, we don't need Ordered. Good catch.",68917396,2013-11-12 04:53:09
2243467,38527,7574882,229,"Sure, it can be an IdProvider[CyclicIncrement[T]].",68917396,2013-11-12 04:55:46
2243467,38527,7575134,96,"I remember why this is a trait and not an abstract class, it's because making it an abstract class throws off the specialization",68917396,2013-11-12 05:03:27
2243467,7111,8284606,37,"doesn't Successible have an ordering? You could weaken this to Successible and just get the ordering from there, right?",74706759,2013-12-12 05:31:42
2243467,7111,8284711,103,don't think this should have an implicit param. You never need this method.,74706759,2013-12-12 05:34:13
2288938,7111,7078254,21,"nice!

I think we also need a multiGet implementation for performance at scale.",65252835,2013-10-19 09:31:13
2316396,44018,6391641,36,"I don't think we need this, as the user can accomplish the same thing with anothing logging combinator around the inner store.",66634456,2013-09-17 03:29:19
2316396,44018,6391663,44,"So one problem with this approach, even though it does this nice connection limiting thing, is that each entire batched multiGet will take as long as the slowest key. And if a single kv pair fails, the entire batch will fail.",66634456,2013-09-17 03:30:29
2316396,35101,6391739,36,good point; I'm still not used to thinking in terms of combinators,66634456,2013-09-17 03:33:42
2316396,35101,6392355,44,"* added an implicit FutureCollector (which I think should allow the user to decide how to handle a failed get)
* removed batchFn

I believe BatchedReadableStore is fully asynchronous, but the delay of futures being fulfilled is an inevitable consequenc",66634456,2013-09-17 04:03:51
2316852,13840,7178828,14,Does the `t: Time` ever get used here? Maybe we don't care.,66677158,2013-10-24 08:45:56
2316852,13840,7178831,16,Same here.,66677158,2013-10-24 08:46:15
2316852,2618,7179008,14,Here and a few other places @ryanlecompte  mentioned seem to be missing the application of `t`,66677158,2013-10-24 09:03:01
2316852,132262,7183126,14,"the api for Closable is

trait Closable {
  final def close(): Future[Unit] = close(Time.Top)
  def close(deadline: Time): Future[Unit]
}

the deadline is advisory.",66677158,2013-10-24 14:29:07
2316852,132262,7183162,14,You can use Future.value unless client.release might throw an exception.,66677158,2013-10-24 14:31:12
2316852,7111,7195876,14,"actually, this is bug, right? Since it will make this lazy, which means it isn't closed unless someone gets the future.",66677158,2013-10-24 22:57:30
2316852,132262,7204243,14,is client.release lazy?  I don't understand.,66677158,2013-10-25 03:52:19
2316852,44018,7204292,14,"@johnynek means using `Future.apply`, as opposed to shipping this blocking operations off to a future pool. My understanding is that `Future.apply` uses a call-by-name parameter, which means that client.release won't happen until the user tries to do some",66677158,2013-10-25 03:54:15
2316852,132262,7204628,14,"https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/util/Future.scala#L58

it uses a call-by-name parameter, but that's just so that it can wait to call it until it's wrapped in a Try().  the difference between Future.value ",66677158,2013-10-25 04:12:35
2316852,7111,7227681,14,"Right. I misunderstood that and thought it was lazy. So, the current thing is fine.",66677158,2013-10-26 01:38:58
2344220,44018,7286854,5,The devil's word!!,67599896,2013-10-29 23:22:53
2344220,319889,7287038,5,"Haha, true. Its the way to get the closest behavior as before from specs2 :)",67599896,2013-10-29 23:27:39
2344220,44018,7287188,5,"It's a mutable lib anyway, so this is good.",67599896,2013-10-29 23:31:55
2359746,7111,7535653,33,unit is probably confusing.,67885350,2013-11-09 02:09:23
2359746,7111,7535784,70,Can we move the pure abstracts to the top to make it easier to see what I need to implement to get one?,67885350,2013-11-09 02:14:47
2359746,7111,7535829,22,"seems like this is a Mergebable with a commutative monoid. Maybe that abstraction is not needed.

I do think that Long is needed. We can exhaust Ints over here, dude. We are doing *Big Data*. ;)",67885350,2013-11-09 02:16:34
2359746,7111,7536161,26,"Not convinced that there is a clear meaning of this. It seems like you want something like this object here:

https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/MomentsGroup.scala#L26

Is that right?",67885350,2013-11-09 02:29:19
2359746,7111,7536170,33,(because it is not Unit).,67885350,2013-11-09 02:29:36
2359746,2618,7538457,22,"Haha. Now that you mention you're right but this would add a requirement on algebra to import that type right? Right now this module only depends on core and would need a separate package to bring in Mergable and friends. 

Re: the Int comment. Great po",67885350,2013-11-09 03:56:43
2359746,2618,7538497,26,I'll have a look this weekend.,67885350,2013-11-09 03:57:50
2359746,2618,7538513,33,timeUnit it is!,67885350,2013-11-09 03:58:28
2359746,2618,7538527,70,Yep.,67885350,2013-11-09 03:58:51
2378416,7111,7415251,55,"this is not an override. That's a bit weird. It means it can't work with any code that wants a multiPut. That's a shame.

Also, batching is probably something that should be done with a combinator for all stores. See:

https://github.com/twitter/store",68672587,2013-11-05 05:06:58
2378416,814892,7418856,55,"Makes sense.

I'll move this to a separate batched store version, though, it looks like all the sql logic will need to go to a separate `MySqlBatchedStore` which extends the generic `BatchedStore`?",68672587,2013-11-05 07:30:32
2378416,7111,7420522,55,"It may extend or users can use the combinator: new BatchedStore(mySqlStore, 1000) or: mySqlStore.batched(1000) or something.",68672587,2013-11-05 09:16:24
2378416,7111,7453935,39,do you want to sequence these futures? Now the order is non-deterministic. Is that what you want?,69141378,2013-11-06 09:51:08
2378416,7111,7453949,66,Future.Unit.,69141378,2013-11-06 09:51:58
2378416,7111,7453970,120,"I think you want to sequence these, not do them in parallel, right?",69141378,2013-11-06 09:53:31
2378416,814892,7456070,39,"I'm thinking this is okay since order is not important here, and all these futures complete as part of object instantiation?",69141378,2013-11-06 13:36:57
2378416,814892,7456073,66,Fixed.,69141378,2013-11-06 13:37:02
2378416,814892,7456281,120,"Good catch. The keysets are disjoint, but it's probably better to sequence these within the transaction.",69141378,2013-11-06 13:56:17
2378416,7111,7479418,39,Yes. I was dreaming of Haskell and lazy everywhere... Ian also corrected me.,69141378,2013-11-07 04:49:01
2378416,7111,7479575,89,lazy val,69200511,2013-11-07 04:53:30
2378416,7111,7479578,109,lazy val,69200511,2013-11-07 04:53:38
2378416,7111,7479592,120,add a comment that this a sequence because the inner *F are lazy above.,69200511,2013-11-07 04:54:01
2378416,7111,7479619,120,Why isn't this the putResult? It is a bit hard for me given the size of this method to see where the final `Future[Unit]` is that we are flatmapping.,69200511,2013-11-07 04:55:02
2378416,7111,7479657,126,why can't you just .handle the above flatMap cascade and then return that finally as the result of the flatMap.,69200511,2013-11-07 04:56:04
2378416,814892,7488409,126,Wasn't sure the handle combinator works that way. Fixed.,69200511,2013-11-07 13:51:24
2378416,814892,7488626,120,Hope it is a little cleaner now that .handle is in this cascade.,69200511,2013-11-07 14:05:59
2378416,7111,7500884,129,why not just `v => putResult.unit`?,69423253,2013-11-07 23:32:19
2378416,814892,7510332,129,Changed the combinator on the earlier mapCollect output to flatMap. Works now.,69423253,2013-11-08 04:12:58
2394104,7111,7453730,46,"this is a bug in the original and copied here. Can you fix both?

This is a local variable, so it will never block. It should be a member variable I think.",69142355,2013-11-06 09:33:07
2394104,814892,7455916,46,Fixed.,69142355,2013-11-06 13:20:40
2394684,7111,7453593,19,where?,69162191,2013-11-06 09:24:40
2394684,7111,7453594,21,where?,69162191,2013-11-06 09:24:50
2394684,7111,7453607,38,why not request here?,69162191,2013-11-06 09:26:06
2394684,7111,7453613,44,why not request.unit?,69162191,2013-11-06 09:26:31
2394684,7111,7453618,37,why doesn't this extend ReadableStoreReporter?,69162191,2013-11-06 09:27:00
2394684,7111,7453624,47,maybe just StoreReporter?,69162191,2013-11-06 09:27:12
2394684,7111,7453630,48,request.unit?,69162191,2013-11-06 09:27:24
2394684,7111,7453644,24,these names are confusing. I think we should change one. Look how similar they are.,69162191,2013-11-06 09:28:37
2394684,7111,7453654,35,"no need for this, I think. just def.",69162191,2013-11-06 09:29:07
2394684,7111,7453668,31,why not a concrete class here and pass in the store and reporter?,69162191,2013-11-06 09:29:29
2394684,7111,7453677,30,I think concrete class is better in this case.,69162191,2013-11-06 09:29:51
2394684,7111,7453681,31,I prefer concrete.,69162191,2013-11-06 09:30:07
2394684,319889,7472268,30,"If I make these concrete the overrides are going to be strange?

class ReportingMergeableStore[K, V] extends MergeableStore[K, V]
                                        with ReportingStore[K, V]
i.e. Reporting store needs to be a trait to be mixed in",69162191,2013-11-07 01:08:49
2394684,7111,7536235,37,Maybe make this WritableStoreReporter?,69162191,2013-11-09 02:32:04
2394684,7111,10497312,36,"How about:
```scala
trait ReadableStoreReporter[S <: ReadableStore[K, V], K, V] extends ReadableStore[K, V] {
  def self: S // don't lose the type when we wrap.
  def close = self.close // don't forget to close.
}
```",95488649,2014-03-12 03:43:41
2394684,319889,10498018,36,"SGTM, changed",95488649,2014-03-12 04:38:24
2394684,814892,10500230,43,Should the trace methods be `protected`?,95526289,2014-03-12 05:49:26
2394684,319889,10532987,43,"Yep, sounds about right. Added",95526289,2014-03-13 00:31:49
2394684,814892,10533821,26,"I was a little confused at first as to why join instead of f map ...
But this makes it possible to perform the side effect either sequentially or in parallel I guess?",95712218,2014-03-13 00:45:48
2394684,319889,10533893,26,"its to effectively just separate the two, they are independent futures in this model that we select one from to return to the user",95712218,2014-03-13 00:46:59
2410319,814892,7520740,44,"Nice, LGTM.

Was wondering if this should be `WritableStore`, but I guess it doesn't make sense to have TTL for a write-only store.
Should this trait be moved back to `Store.scala` then?",69631917,2013-11-08 14:36:04
2410319,2618,7526051,44,"Good point. Unless anyone else disagrees, I think I'm going to make this `S <: WritableStore`. The reason being the placement of encoding of semantics. Since the encoding of the disassociation of a value from its key is provided in terms of the Option sig",69631917,2013-11-08 20:26:02
2410319,7111,7534723,16,"I think this can be: `[-K, -V]`",69690091,2013-11-09 01:38:47
2410319,7111,7535030,25,-V?,69690091,2013-11-09 01:48:16
2419712,7111,7566631,51,"Can I challenge you to implement multiMerge? Merge is implemented in terms of that, so you get that for free. Is that too hard?",70104103,2013-11-12 00:47:04
2419712,814892,7584065,51,"It looks like implementing multiMerge will require directly executing INSERT or UPDATE queries, instead of relying on the underlying put (which in-turn executes its own SELECT query per key to decide whether to INSERT or UPDATE).

Definitely doable. (We",70104103,2013-11-12 13:50:00
2419712,7111,7639979,76,.map here and not bother with lifting into Future.value.,70601061,2013-11-14 03:39:19
2419712,7111,7639989,82,.map here.,70601061,2013-11-14 03:39:29
2419712,814892,7650931,76,"Yep, fixed.",70601061,2013-11-14 12:45:06
2421124,7111,7549654,56,What if there another merge racing with this one? Is there no way to use the cas token here to only put if it is still empty? Or to create which will fail if someone else races with it?,69980795,2013-11-11 02:06:47
2421124,7111,7549663,31,"Why is this abstract?

Also, can you add a comment that this store is same for multiple concurrent writers to the same key, BUT that you might see a performance hit if there are too many concurrent writers to a hot key. The solution is to group by a hot",69980795,2013-11-11 02:09:13
2421124,7111,7549673,31,"I see now, there is no Semigroup. What do you think about just adding:
```scala
implicit inj: Injection[V, ChannelBuffer], override val semigroup: Semigroup[V]
```
so this can be concrete?",69980795,2013-11-11 02:12:05
2421124,814892,7550573,56,"Good point.
Unfortunately, it looks like cas tokens do not apply to missing keys. So we'll need another way.
Making the put method `synchronized` seems too heavy.
Would be nice to be able to lock on the keystring perhaps.",69980795,2013-11-11 06:30:39
2421124,814892,7550574,31,Makes sense. Also allows testing this class in isolation.,69980795,2013-11-11 06:30:44
2421124,7111,7550915,56,"I think you want .add:
https://github.com/twitter/finagle/blob/master/finagle-memcached/src/main/scala/com/twitter/finagle/memcached/Client.scala#L134

If you get a false, back, retry. Else you are good. Right?",69980795,2013-11-11 07:42:12
2421124,7111,7550923,54,Yes. You can put a default in the object.,70102669,2013-11-11 07:44:03
2421124,7111,7550938,69,"We might add a note:

If we get a lot of retries, we might want exponential backoff: use a timer to wait a random interval between [0,t), then [0,2t), then [0,4t), then [0,16t), etc...

For now, I'm sure the max-retries is enough.",70102669,2013-11-11 07:46:44
2421124,814892,7551377,56,"Ah, this works perfectly. Thanks.",69980795,2013-11-11 09:18:24
2463286,2618,7710384,32,In scala-land I like to steer clear of java-bean naming conventions. how about exposing something like `IterableReadableStore#iterator` ala [Map#iterator](http://www.scala-lang.org/api/current/index.html#scala.collection.immutable.Map). `getAll` also impl,71337642,2013-11-17 03:48:06
2463286,2618,7710387,35,can the iterable returned above just implement [iterable#withFilter](http://www.scala-lang.org/api/current/index.html#scala.collection.Iterable),71337642,2013-11-17 03:49:25
2463286,814892,7710454,32,Makes sense. Keeps the method name familiar and less scary.,71337642,2013-11-17 04:05:04
2463286,7111,7710518,32,"There is an object in util called a spool:

https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/concurrent/Spool.scala

It may be that this returns a `Future[Spool[(K1,V)]]` which means that the we can make multiple future",71337642,2013-11-17 04:23:16
2463286,7111,7710541,29,"1) This is cool, but I doubt many stores we want to use it with can actually be iterated like this.

2) Here is a second idea: make this `ReadableStore[OuterK, ReadableStore[InnerK, V]]`. I think that can be done without the Iterable for now.",71337642,2013-11-17 04:27:30
2463286,7111,7710544,40,already the default implementation. I don't think this is needed.,71337642,2013-11-17 04:28:00
2463286,7111,7710547,41,"already the default implementation, isn't it?",71337642,2013-11-17 04:28:18
2463286,7111,7710553,28,"I think you probably only need an `Injection[(OuterK, InnerK), K]` which could be a bit more flexible (i.e. K could be a string representation of a key).",71337642,2013-11-17 04:31:08
2463286,814892,7717237,29,"Yep, the point on not many stores being iterable is valid.

I'm not completely clear how making this extend `ReadableStore[OuterK, ReadableStore[InnerK, V]]` would help in avoiding Iterable though. Seems to me like we need some way to know which `K`s in",71337642,2013-11-18 13:25:28
2463286,7111,7733435,29,"So, get(outerK) does nothing but adds a prefix. Then when someone calls .get on the inner store, you build the real keys and make the call.

I don't think you need to enumerate.",71337642,2013-11-19 01:28:04
2463286,814892,7746971,29,"Ah, I think I understand now :) Thanks.
So something like:

```scala
override def get(outerK: OuterK) : Future[Option[ReadableStore[InnerK, V]]] =
  Future.value(Some(ReadableStore[InnerK, V] {
    override def get(innerK: InnerK) {
    val k = inj",71337642,2013-11-19 09:06:47
2463286,7111,7803313,35,"the usual pattern is that the injection be implicit. If you want to call explicitly, you can still do so. What do you think of that?",71807398,2013-11-21 02:54:46
2463286,7111,7803321,39,implicit inj?,71807398,2013-11-21 02:55:06
2463286,814892,7815634,35,Makes sense. Made it implicit.,71807398,2013-11-21 11:47:35
2499194,7111,7866041,34,"I think this should be a Future[Spool[(K,V)]]. We don't want blocking on .next. It should be easy to convert an Iteratable to a Spool to get the map implementation.",72486884,2013-11-23 02:22:57
2499194,7111,7916346,37,can these two methods move to the companion object?,73249811,2013-11-26 13:24:09
2499194,7111,7916352,53,"can we call this ""items"" or ""spool""? Iterator seems misleading.",73249811,2013-11-26 13:24:41
2499194,7111,7916358,55,seems like you can get a default implementation of this by action on the spool. Isn't there a filter method there?,73249811,2013-11-26 13:25:28
2499194,7111,7916375,31,"don't you need to Await on the whole spool? A function that Awaits a `Future[Spool[T]] => Iterator[T]` is what we need, right?",73249811,2013-11-26 13:26:55
2499194,814892,7916420,55,"Yep, spool has a filter method. So seems like we don't need this here.",73249811,2013-11-26 13:30:11
2499194,13840,7917009,34,"This will actually eagerly evaluate the iterator, which I don't think you want. See this:

```scala
scala> def fillSpool[K, V](it: Iterator[(K, V)], s: Promise[Spool[(K, V)]]): Unit = {
     |     if (it.isEmpty) {
     |       s() = Return(Spool.emp",73254432,2013-11-26 14:22:19
2499194,13840,7917198,34,Should we just use the existing [SpoolSource](https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/concurrent/SpoolSource.scala) to create these?,73254432,2013-11-26 14:42:33
2499194,814892,7949967,34,"You're right. We'd want lazy evaluation here. The following did not work for me either:
```scala
def iterator2Spool[K, V](it: Iterator[(K, V)]): Spool[(K, V)] = {
  if (it.isEmpty) {
    Spool.empty[(K, V)]
  } else {
    Spool.cons(it.next, Future.",73254432,2013-11-27 14:46:06
2499194,13840,7962934,34,"Do we actually want a Spool here? It seems to me that a Spool is useful when you want to essentially have a Stream whose tail is evaluated not lazily, but rather asynchronously (still eagerly, but just asynchronously). I guess we could see how it's used i",73254432,2013-11-28 00:01:41
2499194,814892,7974742,34,"Yep, seems like we'll need to create a lazy version of Spool (doable I think), or maybe use Stream[Future[(K, V)]] instead.

@johnynek thoughts?",73254432,2013-11-28 08:07:47
2499194,132262,7976099,34,"Why not use an Iterable[Future[(K, V)]]?",73254432,2013-11-28 10:10:11
2499194,132262,7976512,34,"Thinking about this more, it might be best to provide an api that lets you provide a batchSize, and just return an Iterable[Future[(K, V)]].  The other possibility would be to supply a new Cursor abstraction, which lets you specify a batch size.

```sca",73254432,2013-11-28 11:06:49
2499194,7111,8011779,34,"thoughts:
1) lazy or bust.
2) I think a type like:
```scala
trait FStream[+T] {
  def head: Future[T]
  def tail: FStream[T]
}
```
is what we want (I think a StreamT monad transformer on Future is what is happening here, I think scalaz has this).",73254432,2013-12-01 02:24:13
2499194,132262,8012709,34,"1)  Are you going to permit people to do out of order requests?  What will you do if I do 
```scala
// assume stream: FStream[A]
val tail = stream.tail
tail.tail.head
tail.head
```
?  Does the iterable abstraction really support that?

2)  I thin",73254432,2013-12-01 10:09:35
2499194,2618,8096865,54,Just a thought. `entries` may be a better name for this. From a user perspective Stores are a lot like `java.util.Maps` in which the equiv name would be `entries`. I totally get `items` though for those you are from a python background and have a dict in ,73254432,2013-12-04 21:56:19
2499194,51152,8837789,34,"Hey gang: Spool _is_ supposed to have deferred behavior, but we found a few bugs in the `*::` syntax that were forcing the tail. I'll see if I can ""force"" a `util-core` release including the fix. #rimshot",73254432,2014-01-14 02:47:12
2499194,51152,8880797,34,"Ok, @evnm released util-core 6.11.0, which includes the Spool fix: https://github.com/twitter/util/commit/12faddbf07cea18742c38fe9c85b3193d99fd882",73254432,2014-01-15 06:15:10
2499194,51152,9015804,28,"It should be possible to do this without the fillSpool method:

```
def iteratorToSpool[K, V](it: Iterator[(K, V)]): Future[Spool[(K, V)]] = Future.value {
  if (it.hasNext)
    it.next *:: iteratorToSpool(it)
  else
    Spool.empty
}
```",84102409,2014-01-21 02:42:41
2499194,7111,9017165,5,why did we lose `+V`?,84102409,2014-01-21 03:20:33
2499194,7111,9017228,50,"can't this be `[+K, +V]`? That would be nice.",84102409,2014-01-21 03:22:18
2519556,7111,7911898,42,"does this block? If so, we need to use a FuturePool. If not, can you add a comment to that effect?",73207011,2013-11-26 07:51:37
2519556,2523602,7914788,42,forced Kafka to use async producer so this should be non blocking now,73207011,2013-11-26 10:57:52
2519556,814892,7917018,42,What do you think of implementing multiPut instead of put?,73207011,2013-11-26 14:23:12
2519556,2523602,7935348,42,That wont work with Storm. I need T=>Future[Unit] for it to work with Storm see https://github.com/twitter/summingbird/blob/develop/summingbird-storm/src/main/scala/com/twitter/summingbird/storm/StormPlatform.scala#L119,73207011,2013-11-27 02:00:38
2519556,319889,7941997,42,"Put could be implemented in terms of multiput though, so if storm gets that sort of ability (entirely possible since Writer can co-locate with a flatmapper to get some win here) at a future date?",73207011,2013-11-27 05:18:43
2519556,2523602,7973296,42,Take a look at multiput,73207011,2013-11-28 06:34:28
2519556,7111,8011791,47,"don't know why you need the Injection. You never invert right? V1 => V is fine, right?",73668657,2013-12-01 02:28:02
2519556,7111,8011793,59,like this.,73668657,2013-12-01 02:28:12
2519556,7111,8011795,34,is it better to take the Producer as the arg? Are you doing this to avoid serialization?,73668657,2013-12-01 02:29:11
2519556,7111,8011798,48,"`kvs.map { case (k, v) => new ProducerData(k, v) }.toList` is probably cleaner.",73668657,2013-12-01 02:30:59
2519556,7111,8011803,51,"I'm worried that we are abusing the Future. I think we want a true future, that when in is done, we know the method has completed, and if it fails it becomes an exception.

This can be done by taking a FuturePool in the class constructor, and stay synch",73668657,2013-12-01 02:33:00
2519556,2523602,8014432,47,i don't need injection but Store already has a [convert](https://github.com/twitter/storehaus/blob/develop/storehaus-core/src/main/scala/com/twitter/storehaus/EnrichedStore.scala#L37) function defined and I thought it would be a good idea to be consistent,73668657,2013-12-02 01:08:41
2519556,2523602,8014435,34,Yes you get serialization exception if producer is not lazy,73668657,2013-12-02 01:10:56
2519556,2523602,8014436,48,I will fix that,73668657,2013-12-02 01:11:07
2519556,2523602,8014452,51,"@johnynek I have never used this before but here is the first stab at it. Were you thinking something along this line? Let me know what else you want me to change
```
override def multiPut[K1 <: K](kvs: Map[K1, V]): Map[K1, Future[Unit]] = {
    val s ",73668657,2013-12-02 01:16:57
2519556,7111,8048715,51,"Yes. This is what I would suggesting. Although, I think
```scala
.flatMap { _ => FuturePool {  } }
```
http://twitter.github.io/util/util-core/target/doc/main/api/com/twitter/util/FuturePool.html
May need an executor supplier `() => ExecutorService` ",73668657,2013-12-03 09:24:35
2519556,7111,8284963,80,"K,V might be clearer.",74706492,2013-12-12 05:40:39
2519556,7111,8284995,22,can we factor this at all? Even separate files? We have Avro + Kafka going on here.,74706492,2013-12-12 05:41:37
2519556,7111,8285016,128,separate file?,74706492,2013-12-12 05:42:15
2519556,7111,8285053,50,"this needs to be a (lazy?) val in the class, otherwise it will have no effect. There is no one waiting or s, it is a new variable.",74706492,2013-12-12 05:43:37
2519556,7111,8285065,46,"this should flatMap with acquiring with s as well, I think (the AsyncSemaphore)",74706492,2013-12-12 05:44:04
2519556,7111,8285133,100,` serializer: Class[_ <: Encoder[V]]` for type safety.,74706492,2013-12-12 05:46:23
2519556,7111,8285197,63,"object LongDecoder?

Also, can we not make a function from an `Injection[T, Array[Byte]]` to a pair `(Encoder[T], Decoder[T])`. Seems like that would be useful.",74706492,2013-12-12 05:48:18
2519556,7111,8285287,63,"Also, we might want:

```scala
trait FromInjectionDecoder[T] extends Decoder[T] {
  def injection: Injection[T]
  def toEvent(m: Message) = injection.invert(m.payload).get
}
// mix in the above, to make a class we could instantiate by name to use I",74706492,2013-12-12 05:50:45
2636889,7111,8350401,23,CalendarBucket perhaps?,75131897,2013-12-14 09:28:19
2636889,7111,8350412,53,should this take a TimeZone to allow non-UTC choices?,75131897,2013-12-14 09:29:25
2648657,7111,8378179,58,doesn't this need to also look at the clock?,77310924,2013-12-17 02:27:00
2648657,319889,8378467,58,"Yep, it should... updated.",77310924,2013-12-17 02:34:20
2648657,7111,8378674,58,I think get(k).isDefined is clearer.,77327093,2013-12-17 02:39:40
2648657,7111,8378768,62,"the backingCache is mutable, so I am worried about the correctness here. I think you get a concurrent modification exception if someone messes with that.

Is it worth calling: .toList.iterator at the end to force the materialization before the method re",77327093,2013-12-17 02:42:04
2648657,7111,8378832,23,"I think you can make a law here: if you put something with a TTL of T, and wait >= T, then it cannot be in there. Also, if you put with TTL t, and wait 0 time, it should always (almost, except due to scheduling) be in there.",77327093,2013-12-17 02:43:32
2648657,38527,8445180,68,I think you can remove these comments now right? Otherwise this all lgtm,77381322,2013-12-19 01:30:51
2648657,2618,8446113,5,Can we make the `ttlInMillis` param a `com.twitter.util.Duration`? It's a little more consistent with [ttl writeables](https://github.com/twitter/storehaus/blob/develop/storehaus-core/src/main/scala/com/twitter/storehaus/WritableStore.scala#L45) and preve,78035508,2013-12-19 01:52:41
2648657,319889,8446295,5,"ttlinMillis follows the other TTL caches i'm afraid though. So i guess its being referentially consistent closer to where it is? Not sure which ones should go to the other overall..

Also the function name is to align with the non-mutable cache variety",78035508,2013-12-19 01:57:51
2648657,2618,8446739,5,"on the first point. the one thing I see as a user, is that the first argument is a long and the unit type is encoded in the name. the compiler doesn't enforce messing up on the second piece of that information with a Long type but a  duration would. For t",78035508,2013-12-19 02:10:15
2648657,319889,8446815,5,I agree having 2 params without typing here isn't ideal. I more was just talking about the self-consistency(since you had referred to it too). I don't mind updating both this and the TTLCache to use the duration class instead? Might be the right answer he,78035508,2013-12-19 02:12:09
2648657,7111,8448659,5,"I also think Duration is the right way to go. As for fixing the other, we can add a method to do Duration and mark the old one as deprecated (and add a this constructor that calls the duration one as well).

When in doubt, lean towards the types.",78035508,2013-12-19 02:58:02
2648657,2618,8450254,5,"> When in doubt, lean towards the types.

I didn't coin the phrase but I like ""let the types tell the story""",78035508,2013-12-19 03:39:17
2648657,2618,8457411,16,You can also say Duration.fromMilliseconds(ms) to avoid bringing in a new import. No big though.,78035510,2013-12-19 07:32:39
2648760,7111,8378905,4,can we rename .withOption?,77314114,2013-12-17 02:45:17
2651739,7111,8411182,46,"I'm very confused as to how this can work. I think you would need the Manifest an the Store level.

Can you explain in a comment how scala is resolving the Manifest below in get (which does not take a Manifest)?",77427179,2013-12-18 01:17:52
2651739,7111,8411488,38,"I'm skeptical that this can work for any K, V. How is serialization done? Can you add a comment on the restrictions here (and hopefully encode that in the type system)?",77427179,2013-12-18 01:27:03
2651739,2557200,8411765,46,"I am actually very confused by how the `Manifest` should work on this case as well. But I think you are correct that adding the `Manifest` to the class level would better solve this problem. Will change it. Thank you.

On the explanation part, this is t",77427179,2013-12-18 01:33:46
2651739,814892,8684031,44,"What are your thoughts on having the index generated in the background? I think the default is false?

http://docs.mongodb.org/manual/tutorial/build-indexes-in-the-background/",77427179,2014-01-07 08:27:34
2651739,814892,8684123,53,"This is a blocking call I think. So we'll probably need to wrap this in a future pool.

For example, see dynamo store:
https://github.com/twitter/storehaus/blob/develop/storehaus-dynamodb/src/main/scala/com/twitter/storehaus/dynamodb/DynamoStore.scala",77427179,2014-01-07 08:32:58
2651739,814892,8684125,56,Ditto,77427179,2014-01-07 08:33:08
2651739,2557200,8684204,44,Will probably open a new field on the constructor to let user specify this behavior. Sorry about lacking the updates. I have been communicate with [casbah](https://github.com/mongodb/casbah) team on how to properly do the serialization/deserialization. Cu,77427179,2014-01-07 08:38:31
2651739,814892,8769760,40,Can you default num threads to Runtime.getRuntime.availableProcessors. Or is there a specific reason this has been set to 3?,80903797,2014-01-10 03:23:31
2651739,814892,8769771,76,"Seems like getAs returns None if the types do not match:

https://github.com/mongodb/casbah/blob/master/casbah-commons/src/main/scala/Castable.scala#L43

Should we instead throw an exception?",80903797,2014-01-10 03:23:36
2651739,814892,8769988,40,This print statement can be removed,80903797,2014-01-10 03:31:05
2651739,2557200,8780139,76,"There is currently a [bug](https://jira.mongodb.org/browse/SCALA-136), which makes casbah not very type safe. This complicates the problem. Open to suggestion on how to do this.",80903797,2014-01-10 11:34:18
2651739,814892,8837729,76,"My only concern is silent failures. As it stands now, None can mean either key not found or value type mismatch.
Perhaps, do something like:
```scala
col.findOne(MongoDBObject(keyName -> key)) match {
  case None => None // key not found
  case Some(",80903797,2014-01-14 02:45:43
2651739,7111,8838451,76,"+1 to this. Future.exception(sys.error(""Could not cast %s of type: %s to %s"".format(object, object.getClass, manifest[V].erasure)))",80903797,2014-01-14 03:04:12
2651739,7111,8840377,48,"So, my original concern is still in play: what K and V are valid? I glanced at the Mongo docs, but I didn't see it. I see that it claims to accept Any, but I think that is not correct. Something like Primitives + arrays or maps or something sounds more li",80903797,2014-01-14 04:03:53
2651739,814892,8845334,48,Seems like both [read](https://github.com/mongodb/casbah/blob/master/casbah-core/src/main/scala/MongoCollection.scala#L244) and [write](https://github.com/mongodb/casbah/blob/master/casbah-core/src/main/scala/MongoCollection.scala#L795) paths are bounding,80903797,2014-01-14 06:30:11
2651739,2557200,8847670,48,"@johnynek: Do you mean [NotNothing](https://github.com/mongodb/casbah/blob/master/casbah-commons/src/main/scala/Implicits.scala#L135)? If not, do you think that explicitly list all the supported types is a bit too verbose? This basically means all `Primit",80903797,2014-01-14 08:00:22
2651739,2557200,8847983,76,"I had something like this:

```scala
col.findOne(MongoDBObject(keyName -> key)) match {
  case None => None // key not found
  case Some(object) => object.getAs[V](valueName) match
    case None => {
    // We cannot just throw exception here, sinc",80903797,2014-01-14 08:15:54
2651739,814892,8873902,48,"I think using `MongoLongStore` etc will let you bypass `getAs` altogether, right? You could define your own `Injection[Long, MongoDbObject]` to deal with type conversion.

Alternatively, if we follow the typeclass `MongoValue` approach, you can represen",80903797,2014-01-15 03:05:22
2651739,814892,8988999,57,Can you correct the comment about MongoObjectStore,83360996,2014-01-19 03:00:59
2651739,814892,8989000,93,Won't this always be `V`?,83360996,2014-01-19 03:01:02
2651739,814892,8989002,94,"Looks like this has been [fixed](https://github.com/mongodb/casbah/commit/f565ae13fdb7f06c36f6d7f5f55da6d263f802e6).

Is there an easy way to upgrade to casbah 2.7 so we get this? If not, we can file an issue to do it later.",83360996,2014-01-19 03:01:16
2651739,2557200,8990443,94,"I will double check this. I would love to do sth with this one. It is ugly. But last time I tried, 2.7.0 was not on the repo yet.",83360996,2014-01-19 08:16:40
2651739,2557200,8990594,94,"I double checked the maven repo. Cannot find 2.7.0 anywhere, but jira says the release date for 2.7 is supposed to be Nov, 2013. Already shoot an email to casbah team for more details.",83360996,2014-01-19 08:44:39
2651739,7111,8995370,33,Nice!,83773815,2014-01-20 08:29:34
2651739,7111,8995393,101,do we need this branch? why is it not safe to return `Some(value)`? comment? Looks like we are doubling the getAs code here.,83773815,2014-01-20 08:35:22
2651739,2557200,8995439,101,This branch is required for casbah 2.6.x if you need type safe. Casbah would return `Some(value)` to you even if the type is not correct and you will get `ClassCastException` on `Option.get`. This has been fixed on 2.7.x casbah release. What do you guys t,83773815,2014-01-20 08:43:12
2652964,7111,8410774,5,"can we rename ""onMergeFailure""+",77458851,2013-12-18 01:08:19
2653035,7111,8410924,5,can we also add that this forces multGet/multiPut to be the default implementation?,77460554,2013-12-18 01:11:45
2660127,7111,8438827,56,"not sure it matters, but this could be covariant.",77949938,2013-12-18 22:22:39
2660127,2618,8439587,56,yea. I was playing with some examples in the sbt console and that occurred to me but it didn't seem to buy me anything.,77949938,2013-12-18 22:43:11
2787611,7111,8837688,41,can you add type on all public vals/defs?,81976404,2014-01-14 02:44:27
2787611,7111,8837707,36,private?,81976404,2014-01-14 02:44:57
2787611,7111,8837727,52,caseClassInjection? Also this should probably be A <: Product to get it closer to case classes.,81976404,2014-01-14 02:45:42
2787611,7111,8837738,63,longer name.,81976404,2014-01-14 02:45:58
2787611,7111,8837803,77,this is probably dangerous. Do we need it to be implicit?,81976404,2014-01-14 02:47:28
2787611,7111,8837811,75,comment looks correct.,81976404,2014-01-14 02:47:39
2787611,7111,8837834,70,what does this ++ do? Can you comment?,81976404,2014-01-14 02:48:28
2787611,7111,8837843,77,"Also, always add a type for implicit vals/defs.",81976404,2014-01-14 02:48:44
2787611,7111,8837908,56,is this thread-safe? Can you link to the docs? Otherwise we need be careful about thread-pool work.,81976404,2014-01-14 02:50:08
2787611,7111,8837950,113,maybe get the mutex here?,81976404,2014-01-14 02:51:19
2787611,7111,8837991,31,"can you add a comment as to where this is used, if at all. If not, let's pull it from this PR. I like to merge smallest viable units.",81976404,2014-01-14 02:52:23
2787611,2523602,8838675,31,"There is already a PR for all the injections (https://github.com/twitter/bijection/pull/157). I am going to create a Store that takes case class as values that automatically get converted to Json and I need the injection for that. Something like this

`",81976404,2014-01-14 03:10:07
2787611,2523602,8838853,70,"++ is an associative operation on two JValue. Please see https://github.com/json4s/json4s/blob/master/ast/src/main/scala/org/json4s/JsonAST.scala#L134

Json4s is already implementing Scalaz's semigroup and monoid trait. I didnt want to drag that in here",81976404,2014-01-14 03:15:40
2787611,2523602,8841032,56,"General consensus in elastic search community is that all clients are threadsafe. Please see the links below

http://elasticsearch-users.115913.n3.nabble.com/Is-NodeClient-thread-safe-td2816264.html

http://elasticsearch-users.115913.n3.nabble.com/Tra",81976404,2014-01-14 04:23:37
2787611,814892,8851279,34,"Should `nodes` be a `List[(String, Int)]`?

Still learning about elasticsearch architecture. I'm wondering if there are ever cases where two instances run on the same host.",81976404,2014-01-14 13:04:04
2787611,2618,8861034,70,">  I didn't want to drag that in here
 
 Please don't :). All kidding aside, I don't think it'd be needed. Have you looked at [Merge](https://github.com/json4s/json4s/blob/master/ast/src/main/scala/org/json4s/Merge.scala#L66-L67)?

It has a slightly d",81976404,2014-01-14 21:39:49
2787611,2618,8861099,41,very cool. Glad to see twttr is picking up on json4s. I'm a fan of a common (ast) interface that you can swap out backends for :),81976404,2014-01-14 21:41:44
2787611,814892,8989185,26,What do you think about moving this to storehaus-core? There can possibly be a mysql version of this.,83364304,2014-01-19 03:32:53
2787611,2523602,8992615,26,I am dine with that as long as @johnynek is cool with that. I suspect he will ask me to change some things around. In addition to MySql we can potentially use QueryableStore for HBase and Mongo as well,83364304,2014-01-19 22:44:48
2787611,7111,8995315,43,Is this safe to call from different threads? Link to docs allowing that?,83897903,2014-01-20 08:21:38
2787611,7111,8995325,32,should this be a Spool? so we can keep fetching in the case of a large search result? Can you at least add a comment on this?,83897903,2014-01-20 08:23:29
2787611,7111,8995355,26,"can you make this: `QueryableStore[-Q, +V]`? I don't see the need to force this to be a subclass of `Store[K, V]` (for instance, I can't write to Google, but I can query it).

Also, and I think Avi asked this, what is the main difference here to: `Reada",83364304,2014-01-20 08:26:42
2787611,7111,8995367,26,"My preference is to add a method to do something like:

`def queryable: Readable[Q, Seq[V]]`

longer term, getting something like the Spool in the value might be the right thing, but I am skeptical of large async requests.",83364304,2014-01-20 08:28:43
2787611,814892,9097215,24,"Just a thought - if we are going to use ReadableStore, can we just make this: 
```scala
trait QueryableStore[Q, V] extends ReadableStore[Q, Seq[V]]
```",84609026,2014-01-23 06:20:48
2787611,814892,9097251,146,minor - commented out code,84609026,2014-01-23 06:22:00
2787611,2523602,9098634,24,hmm I am not sure about that. To me QueryableStore produces a ReadableStore but is not a  ReadableStore itself. ,84609026,2014-01-23 07:16:23
2787611,814892,9100742,24,"Ok makes sense. I can see the goal for having this trait as a kind of factory class -- enabling a store to produce a queryable version of itself.

(Was just wondering if there is a way to avoid a layer of indirection here if we thought of a queryable st",84609026,2014-01-23 08:57:21
2787611,7111,9435670,35,"since the bijection code got merged, can we make this private so we don't get a binary incompatibility when we remove it?

I want to publish this week.  That or we can get bijection out today, and then fix this up tomorrow or thurs?",86846911,2014-02-05 02:54:03
2787611,2523602,9436669,35,"If you can push bijection out today, I can make the change by tomorrow. Let
me know if this works


On Tue, Feb 4, 2014 at 1:54 PM, P. Oscar Boykin <notifications@github.com>wrote:

> In
> storehaus-elasticsearch/src/main/scala/com/twitter/storehaus/elast",86846911,2014-02-05 03:17:08
2787611,7111,9530687,2,these whitespace/comment only changes are not ideal. Please try to keep the diff as focused as possible on the functional bits. This makes it easier to miss meat in a code review.,86869757,2014-02-07 13:00:03
2787611,7111,9530710,30,can you add the return type here? public methods should have types.,86869757,2014-02-07 13:02:09
2787611,7111,9530712,38,return type.,86869757,2014-02-07 13:02:21
2787611,7111,9530724,43,"what's up with the transient? If we serialize this, but null that out, it will be broken right?",86869757,2014-02-07 13:03:00
2787611,7111,9530745,93,"kvs.map { case (k, _) => (k -> f.unit) }(breakOut)

is easier on the GC. mapValues is lazy, so it keeps holding the V instances.",86869757,2014-02-07 13:05:18
2787611,7111,9530759,30,"super long line, can you wrap it?",86869757,2014-02-07 13:06:46
2787611,7111,9530761,40,"can you wrap this line after ""=""",86869757,2014-02-07 13:07:06
2787611,7111,9720830,93,"the mapValues line needs to be deleted, right? It's not used anymore now that you added the map( )(breakOut)",86869757,2014-02-14 01:35:49
2787611,7111,9720960,24,"Let's make it covariant to match store.
`trait QueryableStore[Q, +V]`

Q could possibly be made contra variant, but it a bit of a pain due to the way we are returning a store. Also, queries are less likely to be subclassed. I'd leave that as is.",84609026,2014-02-14 01:38:22
2933752,319889,9481867,5,"Remove the eclipse plugin, you can add them locally if you want them for your ide",86878366,2014-02-06 05:37:10
2933752,319889,9481878,1,/bin ? ,86878366,2014-02-06 05:37:24
2933752,319889,9481896,32,"import me.prettyprint.hector
import hector.api{HConsistencyLevel, ConsistencyLevelPolicy, ...}",86878366,2014-02-06 05:38:01
2933752,319889,9481945,102,magic value in thread pool size?,86878366,2014-02-06 05:39:27
2933752,319889,9481951,107,"space after ,",86878366,2014-02-06 05:39:35
2933752,319889,9481964,119,"extra tabbing after None, 

case None => futurePool {",86878366,2014-02-06 05:40:00
2933752,319889,9482007,128,"This looks pretty weak, can we not have a better type laid down here",86878366,2014-02-06 05:40:51
2933752,319889,9482033,156,Looks like these mostly should be multiPut and multiGet with the default wrappers for get and put calling those?,86878366,2014-02-06 05:41:24
2933752,319889,9482089,97,"Using Tuple2[] seems strange (List[...]], List[..]]) would be a more normal scala way to specify it.

Though using a tuple two here is bad anyway, create a case class to encapsulate the info",86878366,2014-02-06 05:42:36
2933752,319889,9482097,52,Huh? ,86878366,2014-02-06 05:42:49
2933752,319889,9482124,37,These long intro's don't belong in every file,86878366,2014-02-06 05:43:20
2933752,814892,9482127,14,I think you don't need to explicitly add algebird-core if you are already depending on storehausAlgebra.,86878366,2014-02-06 05:43:25
2933752,814892,9482131,5,Just curious why we need this,86878366,2014-02-06 05:43:29
2933752,319889,9482133,42,Looks like it should just be a doc on the method?,86878366,2014-02-06 05:43:33
2933752,319889,9482145,48,"summingbird != storehaus, not sure why it bleeds in here?",86878366,2014-02-06 05:43:49
2933752,814892,9482149,48,"The wrapper is meant to hide any consistency semantics of the underlying store. It depends on the application, but you'd usually want a consistency level that does not lose data. Perhaps, make the consistency level as an input param to the store.",86878366,2014-02-06 05:43:52
2933752,44018,9482173,160,Looks like you could clean these up with bijection.,86878366,2014-02-06 05:44:25
2933752,814892,9482193,95,"Going by convention used in other wrappers, can you name this just `CassandraStore`?",86878366,2014-02-06 05:44:43
2933752,319889,9482201,66,Fixed magic settings?,86878366,2014-02-06 05:44:53
2933752,319889,9482237,88,This seems like a cassandra 101 thing not too relevant here.,86878366,2014-02-06 05:45:42
2933752,319889,9482245,87,Are there cassandra stores which don't allow consistency levelss?,86878366,2014-02-06 05:45:58
2933752,319889,9482278,92,Does this need to be a trait at all and not just left a constructor parameter? dynamically changing these within one store seems very edge case,86878366,2014-02-06 05:46:38
2933752,319889,9482305,50,Why? It would always make sense to provide them?,86878366,2014-02-06 05:47:10
2933752,319889,9482356,108,Looks like for most of these we need a mutator monad that we can execute to try cut down some of this code duplication,86878366,2014-02-06 05:48:07
2933752,319889,9482390,131,Option(result.get).map(_.getValue),86878366,2014-02-06 05:48:47
2933752,319889,9482439,99,"Should be expanded out to the key, value at the start of the method",86878366,2014-02-06 05:49:55
2933752,319889,9482503,110,Your trying to get the old value before insert here? this seems like a method that could be very unreliable as the query could hit another node and not include the increment so you decrement again?,86878366,2014-02-06 05:51:17
2933752,319889,9482532,97,"Actually not entirely, since that node going down or anything else makes the counter increment potentially unstable with a ONE.",86878366,2014-02-06 05:52:10
2933752,319889,9482574,1,Serializers don't seem like they belong in storehaus? Injections to be added to bijection?,86878366,2014-02-06 05:53:08
2933752,814892,9483999,92,+1 for constructor parameter,86878366,2014-02-06 06:29:31
2933752,814892,9485156,110,Looks like we need to use at least Quorum in conjunction with some [CAS style](https://www.instaclustr.com/blog/2013/08/06/whats_new_in_cassandra_2.0_part_2.html) updates. Not sure if Hector supports it.,86878366,2014-02-06 07:06:30
2933752,2988233,9493936,14,"thanks, this is correct, changed it",86878366,2014-02-06 16:30:36
2933752,2988233,9493958,5,"thanks, removed it.",86878366,2014-02-06 16:31:54
2933752,2988233,9497654,110,"thanks guys, yes, this is a rather difficult one. 
@ianoc : thanks, i don't know if i fully understood your comment, but i still want to make use of counters (yes i'm aware of get and set style concurrency problems here) to have merges come around the no",86878366,2014-02-06 18:53:56
2933752,2988233,9498023,97,"Thanks for the comment! Actually I don't fully oversee which situations will have impact for coutners (except for reads, for which it is obvious). I read that counters use some mechanism similar to vector clocks in any case. A _strongly_ consistent read o",86878366,2014-02-06 19:13:35
2933752,2988233,9504305,50,"Thanks. After some re-thinking you're right for multi-put using a Mutator. Multi-get won't make difference to the default-implementation, because range-queries over row-keys is usually not supported (depends on Cassandra-Partitioner which is usually a ran",86878366,2014-02-06 22:41:30
2933752,2988233,9504625,87,"Thanks, sorry for the confusion. I fixed LongStore which initially did not allow to change consistency-levels according to your suggestion to set the consistency level using the constructor.",86878366,2014-02-06 22:47:43
2933752,2988233,9505398,108,"Thanks, sounds cool. As i'm new to Scala i almost implemented a variant of an IO-Monad but that version seems overkill to me as it requires _many_ more lines of code (like 6 classes/traits + a bunch of inner classes) than the original code and i still fee",86878366,2014-02-06 23:02:25
2933752,814892,9514540,97,"So the counter is basically a commutative monoid partitioned across nodes, and merged at read time?
Yeah looks like we'll need ALL to be strongly consistent.",86878366,2014-02-07 02:35:08
2933752,814892,9514733,110,"Yes, having retries to deal with race conditions is one option. [MergeableMemcacheStore](https://github.com/twitter/storehaus/blob/develop/storehaus-memcache/src/main/scala/com/twitter/storehaus/memcache/MergeableMemcacheStore.scala) does something simila",86878366,2014-02-07 02:39:53
2933752,7111,9530822,14,"actually, Ruban, not exactly. You should declare any dependencies you explicitly use. Not declaring it puts the build at risk. It's not clear to the tools what the true dependencies are. We see a lot of errors with pants due to not declaring explicit depe",86878366,2014-02-07 13:16:14
2933752,7111,9530845,67,"please wrap this line:
hostnames: String,
clusterName: String,
...",86878366,2014-02-07 13:18:36
2933752,7111,9530860,66,"can you add some types:
```scala
case class Host(name: String)
case class Cluster(name: String)
case class Keyspace(name: String)
case class ColumnFamily(name: String)
```
All these strings are going to make it too easy to get the order wrong. Let'",86878366,2014-02-07 13:20:57
2933752,7111,9530863,81,use the types introduced above here.,86878366,2014-02-07 13:21:16
2933752,7111,9530869,102,"agree. the pool size should be a parameter, or default pool with the number of CPUs.",86878366,2014-02-07 13:21:52
2933752,7111,9530898,97,This Serializer[Any] does not look type-safe. Can't we make this more precise?,86878366,2014-02-07 13:25:08
2933752,7111,9530926,104,fixed pool size again.,86878366,2014-02-07 13:29:03
2933752,814892,9530928,14,"Ah yes, makes sense. I notice the other modules explicitly declaring as well.",86878366,2014-02-07 13:29:27
2933752,7111,9531025,37,"if you really need this, let's do it this way:
```scala
class InjectiveSerializer[T, U](original: Serializer[U])(implicit injection: Injection[T, U]) extends Serializer[T] {
  // now use the injection to convert to U, and then call the method or origin",86878366,2014-02-07 13:42:00
2933752,7111,9531036,145,worried about this. This is not type safe. Can you be clearer about the use of this class?,86878366,2014-02-07 13:43:34
2933752,7111,9531040,156,don't like that we are losing types here.,86878366,2014-02-07 13:44:02
2933752,7111,9531168,131,"this creates a race. If the read and increment cannot be done atomically, this gives incorrect results.

Am I missing something? Imagine a counter at 5. Two calls come in put(6), put(7). The reads go together, then the increments: `5 + (6 - 5) + (7 - 5)",86878366,2014-02-07 13:55:01
2933752,7111,9531188,88,why are you using a Converted store with identity and no change in the values?,86878366,2014-02-07 13:56:49
2933752,2988233,9532526,110,"@ianoc @rubanm  Ooooops, sorry, my comment meant the _put_ method, which actually is the unreliable one. Now i understand @ianoc 's comment. This one here cannot be 100% reliable return the old value in any case, but should reliably be eventually consiste",86878366,2014-02-07 15:44:13
2933752,2988233,9532932,131,"Thanks, yes, that's a dangerous get-and-set situation. Problems already arise with a single put (with outdated values). However, counter columns cannot be reset. CAS style updates (as @rubanm proposed) seem to be unsupported on counter columns. The questi",86878366,2014-02-07 16:08:40
2933752,2988233,9533033,37,"Thanks, sounds cool. I'll give it a try.",86878366,2014-02-07 16:15:54
2933752,2988233,9533149,97,"Thanks. I think the style storehaus is using stores is different from what i intitially wanted to get from dynamic composites and in the end i mixed it up, sorry for that. i tried to use a dynamic composite store. This has the advantage that - in theory -",86878366,2014-02-07 16:22:01
2933752,2988233,9533381,88,"Hm. Thanks for asking, to be honest I copied that over from a different store implementation and modified the types in a no-brainer. Actually i do not fully understand ConvertedStore - 
i suspect i can safely remove the ConvertedStore?",86878366,2014-02-07 16:33:18
2933752,2988233,9533424,145,"Actually i imagined generating all TupleXY variants as well as Scala-List-based serializers and so on in the future. Right now, we can just throw it away.",86878366,2014-02-07 16:34:53
2933752,2988233,9545263,110,@ianoc @rubanm unfortunatly i was wrong. It is not possible to set/read the timestamp on counter columns.,86878366,2014-02-07 23:38:44
2933752,7111,9721004,88,"Yes, I think you don't need that at all.",86878366,2014-02-14 01:39:26
2933752,814892,11979851,94,lock id generation code can possibly be moved to a helper method,104473699,2014-04-25 06:00:50
2933752,814892,11979869,118,"Does cassandra support batched gets? If so, implementing multiGet would be ideal.",104473699,2014-04-25 06:01:39
2933752,814892,11979873,110,val res seems unused,104473699,2014-04-25 06:01:44
2933752,2988233,11985483,118,@rubanm Cassandra supports various types of queries. In the case of having querying row in which one picks multiple columns it behaves similar to a batched get (c.f. http://rantav.github.io/hector/source/content/API/core/1.0-1/me/prettyprint/hector/api/qu,104473699,2014-04-25 12:27:39
2933752,814892,12019652,1,"This and some other files are missing the correct twitter + apache license header.
Could you please add them? You can find examples in the current source code. Thanks.",104473700,2014-04-26 03:57:59
2933752,814892,12019662,14,"Hmm.. There was an earlier proposal to add a SplittableStore for a similar use-case:
https://github.com/twitter/storehaus/pull/191#issuecomment-32304833

Perhaps it's now time to add it. How about?
```scala

trait SplittableStore[R, K, V](store: Rea",104473700,2014-04-26 03:58:19
2933752,814892,12019691,161,Do we need to use this trait here? It's probably better to have a separate store for the slice queries as suggested in my earlier comment.,104473700,2014-04-26 03:59:37
2933752,814892,12021207,71,Same here. Can this be moved to a separate splittable / slice store?,104473700,2014-04-26 05:07:17
2933752,814892,12021271,69,Don't think we should be using `Any` here. Did you mean `CassandraSerializable` ?,104473700,2014-04-26 05:11:30
2933752,814892,12021487,22,"If I understand correctly, this trait is being used in order to have the ability to switch out the locking mechanism to zoopkeeper?

What do you think of also having a local version that just uses `AsyncMutex`? See [KafkaStore](https://github.com/twitte",104473700,2014-04-26 05:20:50
2933752,814892,12021593,80,`K1 <: K` ?,104473700,2014-04-26 05:30:21
2933752,814892,12021712,14,"Using `PartiallyIterableStore` adds it's own version of `multiGet` in which the keys are not of the same type. Using it in this fashion mutates the core store abstractions imo, which is why I think the slice queries should go in a separate SplittableStore",104473700,2014-04-26 05:41:43
2933752,814892,12021822,161,"How about something like
```scala
type KeyPair = (RK, CK)
class CassandraCompositeSliceStore[KeyPair, V](store: CassandraCompositeStore[KeyPair, V]
  extends SplittableStore[((KeyPair), (KeyPair), KeyPair, V](store) ?
```
instead of using this trait",104473700,2014-04-26 05:58:01
2933752,2988233,12026066,14,"Thanks for you comments! The idea with the SplittableStore sounds awesome (although it seems to me semantics differs a lot). However, it sounds surprising to me that this shall be a decorator to ReadableStore (i.e. can it be implemented simply in terms of",104473700,2014-04-27 01:04:09
2933752,2988233,12026114,69,Thanks for your comment! Yes and no. CassandraSerializable is a type class for types that can be serialized with Cassandra. In the end i used Any because i leave it to clients to either use List[T:CassandraSerializable] or a single T:CassandraSerializable,104473700,2014-04-27 01:16:46
2933752,2988233,12026128,80,"Thanks for the comment. Yes, indeed, with understanding why, there seems to be s.th. wrong here...?! Why didn't the compiler complain?! Interesting...",104473700,2014-04-27 01:21:02
2933752,814892,12252749,14,"Sorry I meant that the PartiallyIterable trait adds the following method:

```scala
def multiGet(start: K, end: Option[K] = None, maxNumKeys: Option[Int] = None,
  descending: Boolean = false): Future[Iterable[(K, V)]] 
```

while ReadableStore alr",104473700,2014-05-03 04:43:03
2933752,814892,12252858,80,It's because you don't have the generic type `K` defined anywhere in this class.,104473700,2014-05-03 04:50:06
2933752,814892,12253182,69,"To keep it type-safe, we should bound both the key and value types.

While the union type would probably work, I think this should be kept simple for now.
Something like:
```scala
class CassandraDynamicCompositeStore[RK : CassandraSerializable, CK : ",104473700,2014-05-03 05:17:34
2933752,2988233,12691466,69,"Ruban, good point; i definitely agree that variable types should be constraint as much as possible! However having composite keys (which will require collections or s.th. similar) is essential for some use cases. (e.g. see http://www.datastax.com/docs/1.1",104473700,2014-05-15 19:23:58
2933752,2988233,12692282,14,"Hi Ruban, yes, I will provide a trait for SplittableStore. To me, it seems that SplittableStore is a way to get an efficient implementation for key distribution for the cascading tap PR (though putting constraints on how the keys must be enumerated). In f",104473700,2014-05-15 19:38:13
2933752,814892,13115437,69,"Sorry for the late response. If composite keys are going to be the more common case, how about forcing a collection always? For the non composite case, you could pass in a list of one element perhaps. ",104473700,2014-05-28 09:33:17
2933752,814892,13115513,14,"Not sure I completely understand this. Can you clarify why the need to ""enumerate all types of basic SplitableStores in a sealed trait and let this be the decorated type""?",104473700,2014-05-28 09:38:06
2933752,2988233,13322116,14,Ok. I'm back from holidays... time to work on this. Maybe we discuss this all due to the fact that I don't really understand the combinator approach and why this should be a combinator (i think this is similar to a decorator in old school GoF-pattern-term,104473700,2014-06-03 12:31:06
2933752,814892,16631625,51,Looks like these two are unused. Can you omit them and maybe add these later with the cascading tap change.,153233561,2014-08-23 21:52:02
2933752,814892,16631668,64,Is there a non-batched version for writes? Is that significantly faster than issuing batches of size 1? Just wondering if there should be a separate `put` implementation here.,153233561,2014-08-23 22:02:09
2933752,814892,16631672,92,"Similarly, do you think a `multiGet` implementation of this would be useful?",153233561,2014-08-23 22:02:51
2933752,814892,16631685,61,These seem unused?,153233561,2014-08-23 22:06:27
2933752,814892,16631691,61,Ah scratch that. didn't realize they are implicits,153233561,2014-08-23 22:07:42
2933752,814892,16631721,122,Stores are designed to be completely async. Can you move this into a flatMap instead of blocking here,153233561,2014-08-23 22:14:08
2933752,814892,16631725,123,same here,153233561,2014-08-23 22:14:20
2933752,814892,16631727,157,same here and in other places. flatMap the future instead,153233561,2014-08-23 22:15:29
2933752,814892,16631734,126,"I don't have a solution for this, but is there a better way to structure the code when there are so many implicits involved? @johnynek @ianoc any pointers?",153233561,2014-08-23 22:18:23
2933752,814892,16631819,70,"If you are always calling init, can the Option be dropped here?",153233561,2014-08-23 22:32:25
2933752,814892,16631862,70,Ah this is for idempotence ok. Please disregard my comment.,153233561,2014-08-23 22:37:08
2933752,814892,16631880,72,This seems a little heavy. Do you think a `ConcurrentHashMap` can be used instead?,153233561,2014-08-23 22:39:49
2933752,814892,16631895,84,"Probably more efficient if we avoid the additional lookup.
```scala
val mutex = new AsyncMutex(maxWaiters)
lockMap += mId -> mutex
mutex
```",153233561,2014-08-23 22:42:54
2933752,2988233,17464730,51,"Hi Ruban, thanks for all your comments. Sorry for the delayed answer, but i hoped to complete the cascading stuff earlier, but we are still working on it. All updates i will mention will be comprised in the Cascading PR - sorry for that, but it would make",153233561,2014-09-12 11:25:49
2933752,2988233,17464809,64,"Good question. Yes there is. I don't know how Datastax' driver is working internally, so i will look at its source code (it is based on a different protocol than the old version). I consider this a feature request for a later version so i can delay it som",153233561,2014-09-12 11:30:16
2933752,2988233,17466037,92,Not for a single get of a key as CQL doesn't support OR to retrieve multiple rows.,153233561,2014-09-12 12:23:44
2933752,2988233,17466049,122,"ok for all of those, will be in the update",153233561,2014-09-12 12:24:10
2933752,2988233,17466750,84,"yes, good point, will come with StorehausTap",153233561,2014-09-12 12:47:35
2955229,7111,9531241,35,I think ks could be weakened to `Iterable[K]` which can be lazy and not something that can anwer `.contains` calls.,87073694,2014-02-07 14:01:06
2955229,7111,9531286,48,"don't we want something like `RecordReader[Ref[K], Ref[V]]` where `class Ref[T](var get: T)`",87073694,2014-02-07 14:05:27
2955229,7111,9531297,51,"I think we need to force the future in next, and we also need to consider batching or spooling here.",87073694,2014-02-07 14:06:22
2955229,7111,9531323,30,you don't use the store do you?,87073694,2014-02-07 14:08:17
2955229,7111,9531336,32,"seems like we should put the K, V into the tuple in a standard way, like 0, 1 elements. Also, we should perhaps use .orNull on the value.",87073694,2014-02-07 14:09:33
2955229,7111,9531401,35,"actually, I think we are going to want a Spool[K] here, or even `() => Spool[K]` or the equivalent.

In fact, on the source side, maybe what we want is a Spool source, and a way to convert a
`(Spool[K], ReadableStore[K, V]) => Spool[(K, Option[V])]`
",87073694,2014-02-07 14:13:52
2955229,7111,9531421,39,"I've never implemented an InputSplit, but I'm concerned about managing the parallelism here. Ideally, it would be great to read + write from as many tasks as the stores can take.",87073694,2014-02-07 14:15:34
2955229,2988233,11722079,35,"@rubanm @johnynek Thanks for starting this. I'm too new to writing cascading taps but since I'm working on this now, I wondered how one can actually pass in constructor params to InputFormat?  Can I use JobConf for this or other external serialization mea",87073694,2014-04-17 12:44:26
2955229,814892,11760489,35,"@AndreasPetter  I had a brief chat about this with @johnynek sometime back.

Config parameters can be passed via the JobConf I think. Here is an example of how cascading-jdbc does it for JDBCTap:
https://github.com/Cascading/cascading-jdbc/blob/2.5/cas",87073694,2014-04-18 05:30:27
3025013,44018,9781983,27,"typo here, I think: maxMultiGetSize => minMultiGetSize",88934136,2014-02-17 11:17:46
3025013,44018,9781991,45,"`(Some(list).filterNot(_.isEmpty), empty)`",88934136,2014-02-17 11:19:23
3025013,44018,9781998,45,"I know you hate equivalent tiny suggestions like this, but... use it or lose it for me!",88934136,2014-02-17 11:19:49
3025013,7111,9799581,45,"After working with people to debug perf issues on storm, I am more reluctant to use a function call where an if statement will do. Same with core code in scalding: I've been putting in while (or tailrec) loops where I might have done allocations and funct",88934136,2014-02-18 00:59:41
3025013,38527,9841352,5,"I don't like using self for the name of a val since we usually use self as the local variable to get around ""this"" serialization issues. Goes against our own code convention IMHO.",89233630,2014-02-19 03:58:28
3025013,319889,9843731,35,"Following from our lunch discussion, this does seem like a premature optimization. Do we know/think the cost of checking the size of a list is likely to be an important factor?",89233630,2014-02-19 04:51:22
3025013,7111,9845798,35,`.size` is O(N) on a list. That seems like it is worth counting separately to me. If you ask for 1000 sized batches each and every get is going to traverse a O(1000) sized list. I think that one is worth keeping actually.,89233630,2014-02-19 05:42:20
3025013,7111,9845818,35,Especially given that it is here and tested (not the min batch 1 does not flush and exercise the fact that it is counting correctly).,89233630,2014-02-19 05:43:07
3025013,319889,9845963,35,"It would seem like we are using the wrong data structure in our Atomic if we want this behavior? array blocking queue or something would have this wrapped up. We have had this pattern elsewhere, it seems like an odd one to be replicating and not factoring",89233630,2014-02-19 05:46:49
3120627,2523602,10066005,29,Dont we need 'put if absent' semantic to be atomic to prevent a (cache stampede)[http://en.wikipedia.org/wiki/Cache_stampede]. I was thinking we will have to take AsyncMutex and flatmap that before we do anything. Or is the expectation that client will en,92221240,2014-02-26 09:14:58
3120627,814892,10067757,29,"Good question. Not sure if we need ""put if absent"". I guess the idea is to refresh the cache value on every write (for the write-through case).

Agree on making this threadsafe with a mutex. It'd be nice to have a more lightweight / lock-free solution h",92221240,2014-02-26 11:03:37
3120627,7111,10072447,30,what if the cache fails?,92221240,2014-02-26 16:12:46
3120627,7111,10072481,33,this is only going to return when we get into the cache. Is that what you want? We should comment about these cases in the class comments.,92221240,2014-02-26 16:14:17
3120627,7111,10072530,35,prefer `case some => Future.value(some)` rather than referencing the outer object.,92221240,2014-02-26 16:16:18
3120627,7111,10072639,49,"The FutureCollector is exactly designed to control this behavior. For the cache, you probably always want best effort collect.

That said, I think what you want is that any that fail on the cache to go to backingStore.",92221240,2014-02-26 16:21:01
3120627,814892,10153056,30,"I think we should fetch the key from backing store, as you suggested as well. So treating a cache miss and cache fail the same.",92221240,2014-02-28 09:54:25
3120627,814892,10153058,33,"Cache operation should be best effort, but we should probably return only after the cache put succeeds or fails. Let me know if this doesn't make sense.",92221240,2014-02-28 09:54:28
3120627,814892,10153060,35,Fixed,92221240,2014-02-28 09:54:35
3120627,814892,10153061,49,"Makes sense, fixed.",92221240,2014-02-28 09:54:38
3120627,2523602,10153354,55,This maybe premature optimization so feel free to ignore but it would be sweet if we only use mutex in scenario where there is a cache miss and we have to go to the backing store. In case of a cache hit there is no need to lock  as its just a read only op,92775057,2014-02-28 10:10:30
3120627,814892,10153695,55,"Makes sense. In database terms, this would give us ""read committed"" isolation level, which should be good enough in this case I think.",92775057,2014-02-28 10:36:54
3120627,2523602,10153983,58,"erm.. I think there is a bug in this code now. Imagine two threads coming one after the other in a cache miss scenario. First thread will do a cache.get, acquire the mutex and do a get on the backing store. In the mean time second thread will do a cache.g",92781117,2014-02-28 10:56:26
3120627,814892,10184409,58,"I do see a case where we can have threads queued up trying to get a hot key on cache miss. Also a cache get is probably going to be less expensive than getting from backing store again. But, is this expected to happen fairly frequently?

Just wondering ",92781117,2014-03-01 05:33:00
3120627,2523602,10347709,58,I think an additional cache get would be fine,92781117,2014-03-06 23:11:13
3120627,814892,10374366,58,"Thought some more about this. Looks like we'll need to place the cache get inside the mutex block if we want this behavior.

The current code doesn't break any store semantics as the latest value in backing store is written to cache.

So we can either",92781117,2014-03-07 13:17:09
3400596,814892,11261372,1,This file needs the copyright/license header,100112435,2014-04-03 22:05:42
3400596,814892,11261373,5,I like this idea. Did you intend to use f to throw exceptions with some probability? It's not currently being used in this code though.,100112435,2014-04-03 22:05:43
3400596,45977,11282036,1,"ok, thanks",100112435,2014-04-04 08:24:27
3400596,45977,11282078,5,"Yeah, I was originally intend to use configurable possibility.
But when I run some test, WriteThroughStore won't pass `storeTest` on random exceptions.
I should set possibility to `1.0f`, but removed those function instead..",100112435,2014-04-04 08:28:19
3400596,814892,11305351,5,I see. Will investigate failures on random exceptions separately.,100112435,2014-04-04 22:50:05
3472668,814892,11645083,12,seems unused,102931132,2014-04-15 22:04:01
3472668,814892,11645103,101,minor - space between K and <%,102931132,2014-04-15 22:04:27
3472668,814892,11645193,109,"There is some asymmetry in the code i.e. using view bound for converting to byte array vs injection invert for converting back from byte array.

Don't know of any good alternative though.",102931132,2014-04-15 22:06:13
3472668,814892,11646329,64,Just a thought - seems like `indexedKeys` can become an overhead when dealing with large keysets. Is there a any way to avoid this? perhaps an implicit `Array[Byte] => K` ?,102931132,2014-04-15 22:29:19
3472668,2523602,11692372,64,"See comment above, would love to switch to ```Array[Byte] => K``` but cant figure out how due to covariance constrain on multiput. I am sure there is a better way to do this so looking forward to some feedback",102931132,2014-04-16 21:16:38
3472668,2523602,11692376,109,"so this is the same issue we were [discussing](https://gist.github.com/MansurAshraf/10336681) on twitter. I would love to have an Injection[K,Array[Byte] but I cant come up with  one without resorting to janky hacks. So I ended up using view bound for Key",102931132,2014-04-16 21:16:42
3472668,814892,11760346,64,"Hmm, I can't think of any good way around it.
@johnynek / @ianoc  Any suggestions?",102931132,2014-04-18 05:21:24
3472668,7111,11796146,61,"I am not a fan of implicit functions used this way, personally. This means you have to live the K => Array[Byte] in scope. I would prefer a Codec[K] here, which is not a Function and won't give K strange methods like .length, that Array[Byte] has.

What",102931132,2014-04-20 04:17:59
3472668,7111,11796154,78,"can this not be Codec[K]? Are there cases where you don't want reversibility (hashing the key, I guess, but has that come up)?

",102931132,2014-04-20 04:21:18
3746108,7111,13027966,25,also provided?,113455685,2014-05-25 01:44:40
3746108,7111,13027988,44,please add return types on public methods (and those below).,113455685,2014-05-25 01:49:56
3746108,7111,13028088,51,return types here and below.,113455685,2014-05-25 02:13:02
3746108,7111,13028106,39,"I am worried about this since dispatcher is not lazy, the whole point of this thing is that it was to avoid serializing some network handles, etc...

Also, this class seems to have nothing directly to do with Kafka, does it?",113455685,2014-05-25 02:17:32
3746108,7111,13028109,87,this lazy is not needed. It is always forced.,113455685,2014-05-25 02:18:16
3746108,7111,13028111,100,why the lazy? It is not being used here.,113455685,2014-05-25 02:18:38
3746108,7111,13028117,42,"I'm confused here. Future { } makes what is in there lazy. Is that what you want? If no one forces the future, that is never called, right?

Don't you actually want to put this in a future pool with perhaps an async mutex?",113455685,2014-05-25 02:20:20
3746108,7111,13028126,42,"actually, not correct. Future { } is call-by-name, but it executes immediately in a try-catch block. Still don't you want the async and pool?",113455685,2014-05-25 02:23:11
3746108,2523602,13091128,39,"Dispatcher is just a type alias for ``` ((K, V)) => Future[Unit] ``` so should be evaluated when its actually invoked. 

As for your second point, I agree that class has nothing to do with Kafka but it already exist in storehaus-kafka module and renamin",113455685,2014-05-27 22:46:14
3746108,2523602,13091350,42,unfortunately futurepool is not playing nice with Kafka 0.8. My original implementation was with  futurepool but that results in intermittent thread deadlocks. See https://github.com/twitter/util/issues/98 for more info,113455685,2014-05-27 22:50:21
3818655,7111,13408797,136,any reason this is not a val?,122352161,2014-06-05 01:32:03
3818655,7111,13408858,54,why final var?,122352161,2014-06-05 01:33:04
3818655,7111,13409044,160,"can we add a comment to the effect? Also, I think this could potetially be a standard combinator: KeyFilteredStore, and in the enrichments, .filterKeys( ), right?",122352161,2014-06-05 01:35:55
3818655,7111,13409070,164,this this should live outside and you should pass in the filter function.,122352161,2014-06-05 01:36:25
3818655,319889,13409095,136,"Sure, it does a bunch of operations before returning a lambda function",122352161,2014-06-05 01:37:01
3818655,319889,13409149,160,Not obviously since there is an operation generation step. I can add the comment though,122352161,2014-06-05 01:37:47
3818655,7111,13409170,16,is this needed? Might save an atomic op to skip it.,122352161,2014-06-05 01:38:09
3818655,319889,13409171,164,"The filter is a def, so we would need to supply the constructor for a per usage filter function. Not sure I see the gain in the complexity?",122352161,2014-06-05 01:38:09
3818655,7111,13409196,14,"remove commented code, please.",122352161,2014-06-05 01:38:31
3818655,319889,13409210,16,It was there just to avoid the potential overflow eventually since its an atomic int,122352161,2014-06-05 01:38:49
3818655,7111,13409225,16,why not delayed here?,122352161,2014-06-05 01:39:04
3818655,7111,13409316,16,"I would still do, `Future.Unit.delayed(10).flatMap { _ => self.put(kv) }`",122352161,2014-06-05 01:40:29
3818655,7111,13409419,45,"maybe in the object, make a convenience method to set the whole thing? Or at least a comment demoing.",122352161,2014-06-05 01:42:14
3818655,814892,13424958,168,I'm guessing these are needed in spite of the multiGet/multiPut implementation below because ProxyStore?,122352161,2014-06-05 10:32:28
3818655,814892,13425000,14,Will making this tunable be of any use?,122352161,2014-06-05 10:35:22
3818655,814892,13425271,16,"Is the idea here to delay the execution of the future or to delay its completion, or does it not matter which one it is?
Seems like get/put are doing the earlier while multiGet/multiPut the latter?",122352161,2014-06-05 10:53:51
3818655,319889,13816602,14,"thats a good question, maybe, but we also maybe have configuration operation overload. Not sure what we would want there.",122352161,2014-06-16 21:56:46
3818655,7111,13880255,8,"there is a difference in this change. Here you are hitting the clock even when the item is absent. Originally, we only check the clock if the item is present. This will make cases of high miss rate more expensive. Can you keep it in the closure, but just ",127230841,2014-06-18 00:38:33
3818655,7111,13880315,16,"overflow is not a problem is it? You are checking `% 1000 == 0` which will be fine for negative numbers:
```scala
scala> -1000 % 1000
res0: Int = 0
```",122352161,2014-06-18 00:39:36
3818655,814892,13882178,46,Was wondering if this can be made a `ConcurrentHashMap`. But looks like it can't because an update here optionally performs pruning which needs a global view of the hash map?,127230841,2014-06-18 01:12:02
3818655,814892,13882182,34,Seems to be copied over from `Proxied` in storehaus-core. Do we need this scaladoc here as well?,127230841,2014-06-18 01:12:11
4063266,7111,15605608,13,"can you add a default version equivalent to the old one? No need to break people if we don't need to, right?",133579921,2014-07-31 00:16:40
4063266,7111,15605627,13,same here.,133579921,2014-07-31 00:16:55
4063266,3114547,15608447,13,"Yup sure, was thinking of doing that initially.",133579921,2014-07-31 01:07:11
4403167,7111,17076144,17,"can we delete the ""h"" in asynch for consistincy with stumbleupon.async?",149046816,2014-09-04 01:08:13
4403167,7111,17076168,27,Can we say .future like scala Promise does?,149046816,2014-09-04 01:08:36
4403167,7111,17076203,26,Let's make this extend AnyVal and require scala 2.10. Twitter has finally moved off of 2.9.,149046816,2014-09-04 01:09:04
4403167,7111,17076334,19,"rather than junk up all subclasses with this method, can we not just import RichDeffered._?",149046816,2014-09-04 01:10:47
4403167,7111,17076407,60,.unit is a method on twitter Futures.,149046816,2014-09-04 01:11:58
4403167,7111,17076421,52,.unit rather than the .map here.,149046816,2014-09-04 01:12:12
4534288,7111,17076697,26,can we not do 2.11 here?,156254044,2014-09-04 01:17:11
4534288,7111,17076734,85,yikes... 0.7.0,156254044,2014-09-04 01:17:47
4534288,38527,17076824,26,Our deps haven't published for 2.11 yet,156254044,2014-09-04 01:19:16
4534288,38527,17076831,85,"Yeah, that's what we are using at Twitter...................not sure what we want to do about that",156254044,2014-09-04 01:19:23
4534288,2523602,17077256,85,"Acc to David Helder, Twitter's fork of Kafka 0.7.0 has a Scala_2.10 version
as well. Not sure if its published outside though


On Wed, Sep 3, 2014 at 1:19 PM, Jonathan Coveney <notifications@github.com>
wrote:

> In project/Build.scala:
>
> > @@",156254044,2014-09-04 01:26:24
4969472,814892,19041662,77,"Looks like this one can be implemented as a ConvertedStore?
if you have an `Injection[String, ChannelBuffer]`

```scala
class HttpStringStore(store: HttpStore)
  extends ConvertedStore[String, String, ChannelBuffer, String](store)(identity)(inj)
```",173277966,2014-10-18 01:33:05
5179334,319889,19971220,22,"Cut down these line lengths, can't really read this in github's diff viewer",183266877,2014-11-07 03:06:32
5179334,2523602,20023830,22,@ianoc let me know if its more readable now,183266877,2014-11-08 00:26:36
5179334,814892,20025688,50,Can Monoid be dropped in favor of Semigroup? Doesn't look like zero is needed for aggregation if you filter out missing keys?,183311622,2014-11-08 00:58:55
5179334,2523602,20028351,50,That would require doing one addition pass over all the values which seems inefficient. This way i can do one pass and fill all the empty values with Monoid.zero,183311622,2014-11-08 01:43:29
5179334,814892,20030268,50,"The filter can be placed in the reduce function right. Or am I missing something?
```
seq.reduceOption { (l, r) =>
    (l, r) match {
      case (Some(lv), Some(rv) => Some(s.plus(lv, rv))
      case (Some(lv), None) => ..
      case (None, Some(rv)",183311622,2014-11-08 02:13:00
5179334,814892,21499822,27,"Not familiar with the immediate use case in mind, but can/should the fanout keys be of a different type to support those cases as well?

```scala
class FanoutStore[-K, +V: Semigroup, LK, S <: ReadableStore[LK, V]](fanout: K => Set[LK],
    stores: Set",185300167,2014-12-09 07:46:30
5179334,7111,25281450,27,"This is a cool idea, but question: why not make it:
```scala
class FanoutStore[-K, K1, +V: Semigroup, S <: ReadableStore[K1, V]](fanout: K => Iterable[K1], stores: K1 => Iterable[S])
```
the `Set[(LK => Boolean, S)]` seems confusing to me. It seems yo",185300167,2015-02-25 02:06:26
5179334,7111,25281479,23,Semigroup.,185300167,2015-02-25 02:06:39
5272422,7111,21061749,10,"So, the intent of hit is that it is refreshing the cache. If you don't want to refresh the cache and keep the key hot, you use get.

I think you want a slightly different behavior actually. You want a TTL that expires from the first entry, no matter wha",184776900,2014-12-01 00:21:20
5272422,319889,21062033,10,"This possibly does look like an error though(just a different thing than this is aiming to fix...), in that hit should use get on the cache followed by a += so that we don't hit something that has already expired. Effectively the value shouldn't be in the",184776900,2014-12-01 01:00:03
5272422,3025481,21304675,10,"The way I discovered the ""issue"" was by using a CachedReadableStore with a MutableTTLCache being the cache implementation of the store. I am basically using it to store metadata about some object that doesn't change frequently, but is needed on a frequent",184776900,2014-12-04 20:53:36
5310532,232760,21552361,18,better error here,184854032,2014-12-10 01:58:32
5310532,232760,21552531,64,should this be a snapshot version?,184854032,2014-12-10 02:00:27
5310532,319889,21615821,18,"Copied and pasted from our other build files, so slow to change unless we bump them all...",184854032,2014-12-10 23:40:37
5310532,319889,21615850,64,Might aswell be?,184854032,2014-12-10 23:40:57
5532596,7111,21768468,19,injections are usually accepted implicitly. Why the difference here?,186391023,2014-12-13 02:48:15
5532596,7111,21768549,5,can we add the same comment here that CAS is used so that it can safely be used when one thread/node does not own a key space.,186391023,2014-12-13 02:49:20
6655049,814892,26808448,54,This is defined in the parent class so not needed here right? Likewise for `multiPut` and `close(time: Time)`,229820655,2015-03-20 05:35:46
6655049,814892,26808542,46,This can be just `Option(db.get(k))`? given absent keys return null,229820655,2015-03-20 05:37:39
6655049,814892,26808622,82,Which one does this override? Don't see a version that takes in `Duration`. Should this just take in `Time`?,229820655,2015-03-20 05:39:12
6655049,814892,26808717,13,Should we force an encoding here?,229820655,2015-03-20 05:41:27
6655049,814892,26808812,54,"Ah, please disregard. Just saw your PR comment about implementing this. ",229820655,2015-03-20 05:43:49
6655049,814892,29257651,32,numThreads can be defaulted to Runtime.getRuntime.availableProcessors perhaps. Some of the other store wrappers that use future pool do this.,250350361,2015-04-28 20:58:10
6655049,814892,29258417,40,"This can just be .map { case (key, v) => ... } right?",250350361,2015-04-28 21:05:26
6655049,814892,29258660,28,"Could you add some more comments about this store's usage, what the parameters mean etc. Thanks.",250350361,2015-04-28 21:08:07
6655049,814892,29259095,54,need to also specify the encoding here?,250350361,2015-04-28 21:12:29
6655049,814892,29259896,33,"We could make this Store[K, V] and and accept an implicit Codec[K] and Codec[V].

Not a blocker though given we have a combinator that can be used instead. ConvertedStore I think.",250350361,2015-04-28 21:20:23
6655049,7111,29279453,33,"Actually, I tend to prefer wrapping as close to the underlying store as possible and using combinators (I know @ianoc has some information that can cause problems, but otherwise we have a ton of duplication, which I also think is a problem). What do you t",250350361,2015-04-29 00:30:36
6655049,7111,29280700,35,"is this thread-safe? Can you link to docs showing this? If not, we should use:
https://github.com/twitter/util/blob/master/util-core/src/main/scala/com/twitter/concurrent/AsyncMutex.scala

Then we'd do something like:
```scala
dbMutex.acquireAndRun(f",250350361,2015-04-29 00:45:02
6655049,814892,29284293,33,"Makes sense to me.

@BenFradet Could you change to something like:
```scala
class LevelDBStore[K: Codec, V: Codec]( ... )
  extends Store[K, V]
```
There are a few existing stores that use Codec to convert between T and Array[Byte] that can serve a",250350361,2015-04-29 01:25:03
6655049,319889,29284323,33,"It can be a performance concern, but unless its been identified as one I'd just leave it to combinators ",250350361,2015-04-29 01:25:19
6655049,814892,29284613,33,"Ah, sorry I misread the comment. Yes combinators it is then. @BenFradet please disregard my earlier comment.",250350361,2015-04-29 01:28:07
6655049,3114547,29285675,40,"Yup, I meant to change that but forgot, thanks for reminding me.",250350361,2015-04-29 01:37:25
6655049,3114547,29290904,28,Will do.,250350361,2015-04-29 02:31:04
6655049,3114547,29291465,54,Yup.,250350361,2015-04-29 02:38:03
6655049,3114547,29291790,35,Will look into it and post my findings.,250350361,2015-04-29 02:42:19
6655049,814892,29443648,46,This can be just `storehausCore`?,250750482,2015-04-30 21:08:11
6655049,3114547,29448304,46,"Yup, I think that's what I meant to do when I did [this](https://github.com/twitter/storehaus/pull/258/files#diff-215113124f1de02f228327ba7abb45f7R251).",250750482,2015-04-30 22:03:14
6655049,7111,30255921,105,this should be: `futurePool { db.close() }.flatMap { _ => super.close(time) }`,251766434,2015-05-13 22:45:13
7500553,814892,30107378,5,"Actually, the second arg should be `underlying.flag` instead of 0?",255614326,2015-05-12 11:18:43
7500553,6539,30168112,5,"I have no idea what flag does, but this would change the existing behavior right? Should we also pass flags into CAS?",255614326,2015-05-12 23:56:57
7500553,814892,30203998,5,"Found an explanation here
https://github.com/memcached/memcached/blob/master/doc/protocol.txt#L155
and here
http://stackoverflow.com/questions/12228097/what-is-the-flags-arg-in-finagle-memcached-set-method

The flag is opaque to the server and is ret",255614326,2015-05-13 10:50:19
7500553,814892,30204069,5,"Ah, didn't notice your latest rev. Should be added to the cas call as well I think.",255614326,2015-05-13 10:52:45
7616727,198588,30660297,21,Would you like if I pattern matched on the Option here to avoid the allocation for None case (using Future.None)?,260277576,2015-05-20 04:53:00
7616727,198588,30660439,17,"Would you mind if I flattened this?

```scala
underlying.client.gets(key).flatMap {
  case Some((cbValue, casunique)) => // ...
  case None => // ...
}
```",260277576,2015-05-20 04:55:25
7616727,198588,30660979,21,"If it's not hot, I'd prefer to just keep it as is.",260277576,2015-05-20 05:04:49
7616727,814892,30672428,17,sounds good,260277576,2015-05-20 10:39:16
7616727,814892,30672456,21,"I don't think we've seen any regression because of this, but @ianoc might know more. Doesn't hurt to change it I guess.",260277576,2015-05-20 10:40:28
7616727,814892,30730838,17,We have `AbstractBijection` for this. A little clearer than extending the trait.,260631391,2015-05-20 23:04:17
7616727,814892,30730880,18,`override def`,260631391,2015-05-20 23:04:32
7616727,198588,30731036,18,It doesn't override though.,260631391,2015-05-20 23:05:41
7616727,198588,30731424,17,"From [Bijection.scala](https://github.com/twitter/bijection/blob/develop/bijection-core/src/main/scala/com/twitter/bijection/Bijection.scala#L68):
```scala
/**
 * Abstract class to ease Bijection creation from Java.
 */
abstract class AbstractBijecti",260631391,2015-05-20 23:09:05
7616727,814892,30732035,17,"It was originally created for java compatibility yes but we have mixed usage of that in scala as well. nbd though, this can be left as is.",260631391,2015-05-20 23:15:03
7616727,814892,30732811,18,"This is more of a variation in style I guess. Personally, override is clearer to the reader without having to look if it comes from the base trait. Maybe doesn't make sense to do this for `apply`.",260631391,2015-05-20 23:22:01
7616727,198588,30733186,18,I changed this to use the builtin Buf bijection which I just realized we have. This is now moot.,260631391,2015-05-20 23:25:45
9151165,7111,39202057,12,"1) I think you want: `^2\.1[0-2]\.*` here.
2) Can we use the same approach in all the new code we add? startsWith is dangerous (consider version 2.91.0 which is not the same as 2.9.x).",307366936,2015-09-11 00:24:09
9151165,7111,39202088,22,please don't add commented code.,307366936,2015-09-11 00:24:26
9151165,7111,39202450,77,is this thread-safe? Should we use the AsyncMutex to ensure only one query is running?,307366936,2015-09-11 00:27:50
9151165,7111,39202537,117,thread safety question here.,307366936,2015-09-11 00:28:44
9151165,7111,39202509,97,can we add a comment about why this is thread-safe here?,307366936,2015-09-11 00:28:28
9151165,7111,39202787,91,isn't this flatMap? Why transform here?,307366936,2015-09-11 00:30:38
9151165,7111,39203009,29,why does this take an `Option[T]` rather than T? same question below.,307366936,2015-09-11 00:32:36
9151165,146404,39232266,31,`shapeless.syntax.std.traversable._` would be better for consistency and clarity.,307366936,2015-09-11 05:55:04
9151165,146404,39232524,20,Why not `Generic`?,307366936,2015-09-11 06:00:07
9151165,146404,39232569,62,"Why not 2.2.5? Tests pass just fine on 2.2.5 with a couple of minor changes (that are arguably improvements, anyway).",307366936,2015-09-11 06:01:01
9151165,146404,39232755,113,These `*->*` are strictly weaker than their `Mapped` counterparts above.,307366936,2015-09-11 06:05:14
9151165,146404,39232820,52,I'd recommend including the `Case.Aux` annotation here.,307366936,2015-09-11 06:06:57
9151165,146404,39233047,34,I'm recommend specifically importing `~>>` for clarity.,307366936,2015-09-11 06:11:00
9151165,146404,39232923,59,You shouldn't need the `Aux` here—using `mapper.Out` as the return type should give you the same static type.,307366936,2015-09-11 06:08:50
9151165,146404,39233015,31,This import looks unnecessary?,307366936,2015-09-11 06:10:27
9151165,146404,39233137,36,"99% of the times I think I have a use for `*->*` it turns out that I don't, and I don't think you need it here (see inline comments below).",307366936,2015-09-11 06:12:29
9151165,146404,39233223,81,If you know that `P` is a `CassandraPrimitive` why not capture that in the types?,307366936,2015-09-11 06:14:12
9151165,146404,39233023,35,Also unnecessary?,307366936,2015-09-11 06:10:39
9151165,146404,39233539,34,"Using `Generic` would give you both directions in a single type class (and allow you to avoid all the `HListerAux` boilerplate). If you want evidence that you've got a tuple (as opposed to some other `Product`, there's an `IsTuple` type class).",307366936,2015-09-11 06:21:15
9151165,146404,39233373,44,"I'd be very tempted to define a custom type class that provides a conversion directly from an `HList` of `CassandraPrimitive`s to a `List[String]`. It would save a lot of `Mapper` / `ToList` pairs below, and I personally think I'd find it clearer.",307366936,2015-09-11 06:17:46
9151165,319889,39232612,36,"why hadoop1, not hadoop 2? ",307366936,2015-09-11 06:01:55
9151165,146404,39233681,106,Type annotations would be better.,307366936,2015-09-11 06:24:28
9151165,146404,39233768,98,"This is a candidate for `DepFn1` treatment, since `K` uniquely determines the `S`.",307366936,2015-09-11 06:26:22
9151165,146404,39233703,112,Why not skip the `N` and just use `CassandraPrimitive[M]` directly?,307366936,2015-09-11 06:25:02
9151165,319889,39232657,10,"We don't cross compile for 2.9 anymore, do we need this at all?",307366936,2015-09-11 06:03:06
9151165,319889,39232698,59,can we depend on cassandra core normally and just mark it as provided? ,307366936,2015-09-11 06:03:55
9151165,9324881,39554373,12,I will do as ianoc suggested and throw that out.,307366936,2015-09-16 00:32:56
9151165,2988233,39554492,22,Yes... sorry.,307366936,2015-09-16 00:34:01
9151165,2988233,39554588,77,It is thread safe. I'll add http://docs.datastax.com/en/drivers/java/2.0/com/datastax/driver/core/Session.html as a comment,307366936,2015-09-16 00:35:07
9151165,2988233,39554623,97,same here,307366936,2015-09-16 00:35:38
9151165,2988233,39554644,117,same here,307366936,2015-09-16 00:35:51
9151165,2988233,39668147,62,2.2.5 doesn't seem to distinguish between scala 2.10.x any more. is it safe to assume that it will be working with all 2.10s?,307366936,2015-09-16 23:36:31
9151165,2988233,39668243,36,"sorry, must be removed as this pr does not depend on cascading nor hadoop",307366936,2015-09-16 23:37:16
9151165,2988233,39668325,10,"no, thanks, will remove it",307366936,2015-09-16 23:37:59
9151165,146404,39782983,62,@AndreasPetter It'll work with any 2.10 after 2.10.1.,307366936,2015-09-17 23:42:08
9151165,2988233,46474920,52,"Sorry to bother you again, but I'm not able to bring ""annotation"" in useful context here - I'm not really a shapeless pro. What I do understand is that I use CaseBuilder (and therefore Case) under the hood by using `at`. I found an annotation.scala in sha",307366936,2015-12-03 05:04:29
9151165,2988233,46477630,52,"@travisbrown ah sorry, I just understood that you stated that it would be better to specify the return type with Case.Aux. Forget my previous comment, sorry.",307366936,2015-12-03 05:25:41
9151165,2988233,46873497,98,"Sorry to bother you again... I made a few changes such that `trait Row2Result[S <: HList] extends DepFn1` creating some dependent `Aux[S <: HList, K <: HList]` and using the dependent `Out` type from `DepFn1`. It (almost) seems to work except that the com",307366936,2015-12-08 04:35:44
9151165,146404,46881593,98,"Sorry, I was using `DepFn1` as shorthand for the approach of making the uniquely-determined type parameter a type member. If the `apply` on `DepFn1` doesn't have the right signature, it'd make sense just to change this to `RowResult[K <: HList] { type Out",307366936,2015-12-08 05:39:37
9151165,2988233,48864866,29,"The semantics of CASStore was indeed already subject to an internal emotional debate a few month ago. Added a comment and some tests showing the semantics which is implemented: None means, that there must not exist a token previously (and the operation is",307366936,2016-01-06 00:38:48
12815305,7111,55132269,43,can you document this class. Clearly mutation is going on behind the scenes. We prefer to avoid that when at all possible.,401489132,2016-03-06 11:01:55
12815305,7111,55132341,42,"what is the threading story here? Is this async?

Is it threadsafe?

The `Future { }` as you probably know only catches exceptions but does the work in this thread.",401489132,2016-03-06 11:06:10
12815305,7111,55132352,49,"No need to implement this if there is nothing faster than a bunch of `put` calls. This is here for systems that have batch APIs.

Also, this is imprecise because if all but the last succeed, the caller will think they all failed. At least fix that issue",401489132,2016-03-06 11:08:22
12815305,7111,55132359,88,"can we use `ClassTag` here, which is what replaced Manifest?",401489132,2016-03-06 11:09:21
12815305,7111,55132406,48,how do these get used if below? It seems kafka creates the serializers with reflection.,401489132,2016-03-06 11:14:28
12815305,7111,55132437,71,"this is going to change the jar name.

What do you think of having a kafka-09 module instead of ending support for 08? I actually don't know if anyone is using the 08 modules, but I hate to force an upgrade on someone or more realistically leave them st",401489132,2016-03-06 11:16:22
12815305,3114547,55136505,71,"The main goal was to move to the new producer which is supported in 0.8 and 0.9 and having only one jar which would be named `storehaus-kafka` instead of having one per version.
What do you think?",401489132,2016-03-06 18:22:29
12815305,3114547,55136529,48,"AFAIK, this all object is not used anywhere and was thinking of removing it.",401489132,2016-03-06 18:24:37
12815305,3114547,55136657,42,"This is async and send back a java future but I wouldn't know how to convert it to a twitter-util future.
If you have any insight on how to do that, that'd be greatly appreciated.",401489132,2016-03-06 18:37:38
12815305,2523602,55136773,48,Its used [here] (https://github.com/twitter/storehaus/blob/develop/storehaus-kafka-08/src/main/scala/com/twitter/storehaus/kafka/KafkaStore.scala#L92). Lets not remove it as its very convenient to use Injections as Kafka Encoders,401489132,2016-03-06 18:48:48
12815305,7111,56544012,48,"yeah, I see that Kafka has non-reflective ways to pass the Serializers, so let's leave them.",401489132,2016-03-18 00:28:08
12815305,7111,56544430,48,I don't see where this is used.,403908898,2016-03-18 00:30:08
12815305,3114547,56561637,48,"Yup, it seems to be an artifact from the last implementation.
Will remove.",403908898,2016-03-18 02:12:56
12815305,7111,56907311,53,"sorry, just noticed this pattern. What is going on here? Why lazy, then we force it? Why not just return line 51 directly?

Same below...",409331590,2016-03-22 05:16:35
12815305,7111,56907664,116,no need for this lazy here... is there? Looks like a misunderstanding of how lazy works.,409331590,2016-03-22 05:19:11
12815305,7111,56910999,42,"I looked into this. I found this:
http://stackoverflow.com/questions/11529145/how-do-i-wrap-a-java-util-concurrent-future-in-an-akka-future

so, what we would need to do is something like this:
```scala
class JavaToScala {
  case class Link[T](futur",401489132,2016-03-22 05:48:32
12815305,7111,56911354,77,why the `Manifest` bound here and not `ClassTag`?,409331590,2016-03-22 05:51:41
12815305,7111,56911645,42,"I think it is worth doing this right. This would mean that you would pass such a `JavaToScala` instance that has a thread inside into the class construction, and you could reuse them across `KafkaStore` instances or have `apply` methods to just allocate a",401489132,2016-03-22 05:54:35
12815305,3114547,56950258,53,"This is legacy code from the current implem.
As stated in the pr desc, the main goal was to upgrade the producer so I haven't really looked into the code.

But since we're here we might as well do a proper refactor.",409331590,2016-03-22 15:27:43
12815305,3114547,56950383,42,"Thanks, I'll look into that.",401489132,2016-03-22 15:28:44
12815305,3114547,56956819,42,It's too bad there are no bijections available between java future and twitter future like there is between scala future and twitter future.,401489132,2016-03-22 16:28:46
12815305,7111,57201232,42,"Indeed. Once we have it here, we should copy it to bijection, but waiting to get a version of bijection is a pain.",401489132,2016-03-24 00:26:25
12815305,3114547,57511903,58,"Here's the ""hack"" I found to turn a `Future[RecordMetadata]` into a `Future[Unit]`, input welcome.",413739598,2016-03-26 17:23:45
12815305,3114547,57511910,69,I think we should also support another version of `put` which gives us back a `Future[RecordMetadata]` like the original kafka api.,413739598,2016-03-26 17:24:38
12815305,3114547,57517611,58,"nvm, I just used a `map`, way better",413739598,2016-03-27 01:40:52
12815305,7111,57533142,67,we should probably stop the thread converting java to twitter futures (and complete all the open promises with some exception).,414214548,2016-03-28 01:52:47
12815305,7111,57533146,39,"should we take the timeout as argument? Always using 1 second seems like it could cause issues to me, now that I think about it.",414214548,2016-03-28 01:53:29
12815305,3114547,57535629,39,"yup, agreed",414214548,2016-03-28 05:20:02
12815305,7111,57626071,42,I don't see how `while` is in play here rather than `if`,414758407,2016-03-29 03:15:05
12815305,7111,57628714,71,"there is a race here if some one calls apply after stop. That could be okay if we advertise that they must be synchronized, or we could handle by having a bigger state:
```
sealed abstract class State
case object Closed extends State
case class Open(l",414758407,2016-03-29 03:32:56
12815305,7111,57628855,81,should add the `cancel` method here.,414758407,2016-03-29 03:33:50
12815305,3114547,57680443,71,"Thanks for pointing that out, will look into your solution.",414758407,2016-03-29 14:11:17
12815305,3114547,58121025,71,I'm not sure I quite get how the `swapOpen` should fit in `run`.,414758407,2016-04-01 03:21:52
12815305,3114547,58232939,71,"Here's what I have so far:

```scala
    override def run(): Unit =
      try {
        if (!Thread.currentThread().isInterrupted)
          loop(list.getAndSet(EmptyState))
      } catch {
        case e: InterruptedException =>
      }

    @",414758407,2016-04-01 23:45:55
12815305,7111,59262466,65,"I think this needs to be `swapOpen` and if you get false, you need to `foreach(_.cancel)`, right?
```scala
swapOpen(notDone) match {
  case (cancels, false) => cancels.foreach(_.cancel)
  case (next, true) => loop(Open(next))
}
```",419836698,2016-04-12 02:07:13
12815305,7111,59272923,61,"actually, I think returning `Option[List[Link[_]]]` would be more idiomatic. When you get `None` you still have the argument. `Boolean` can be confusing what is meant.",419836698,2016-04-12 03:14:49
12815305,7111,59273145,65,"or with `swapOpen(n: List[Link[_]]): Option[List[Link[_]]] = ...`

```scala
swapOpen(notDone) match {
  case None => notDone.foreach(_.cancel)
  case Some(next) => loop(Open(next))
}
```",419836698,2016-04-12 03:16:01
12815305,7111,59273533,96,"I don't think you need this since once `Closed` shows up, `loop` should terminate.",419836698,2016-04-12 03:18:08
13354236,3114547,57513436,32,I removed this test since it's always true because the `genNegativeTTLTime` generate ttls between 80 and 480.,413785747,2016-03-26 20:14:43
15010292,7111,64636861,6,do we need the self? I dont see how?,452466562,2016-05-26 02:25:27
15010292,550921,64647233,6,My bad. I was trying something else earlier and forgot to remove the self. Removed.,452466562,2016-05-26 03:29:00
15010292,3114547,66858456,15,"oops, I didn't see this. I'm fixing those in #300 ",457137065,2016-06-14 03:12:03
15513813,7111,67625908,27,I think we need `put` here and we need to handle key eviction.,466181973,2016-06-20 06:38:08
15513813,7111,67625909,37,I think we need `backingCache.evict` here.,466181973,2016-06-20 06:38:21
15513813,7111,67625913,48,I think we need `evict` here,466181973,2016-06-20 06:38:54
15513813,7111,67625914,82,evict.,466181973,2016-06-20 06:39:03
15513813,7111,67625921,92,backingCache.evict (and clean up the other keys removed from lirsStacks.,466181973,2016-06-20 06:39:30
15676627,3114547,69629205,33,"I excluded the future converter stuff, I don't know if this is the best way to go about things, input welcome.",472883574,2016-07-06 03:12:58
15676627,7111,69604697,15,"I think we want to drop `_2.10` and let sbt do it: `""com.twitter"" %% (s""storehaus-$s"") % ""0.15.0-RC1""`",473084825,2016-07-06 00:32:54
15676627,3114547,69624080,15,will do,473084825,2016-07-06 02:35:46
15716844,7111,70017632,24,"if we make this return `ReadableStore[K, V]` does it break mima? We don't really want to return that subclass.",474933402,2016-07-08 09:15:59
15716844,7111,70017703,51,"this should be `Map[K1, Future[Option[V]]` we should definitely not expose the `Promise` which is actually mutable.",474933402,2016-07-08 09:17:30
15716844,7111,70017753,32,let's not do this. This is allocating where in the past we were avoiding allocations. This could slow down operations in a path that may be important for performance.,474933402,2016-07-08 09:18:29
15716844,7111,70017781,21,can we use `.map(Future.value)` style instead?,474933402,2016-07-08 09:18:59
15716844,7111,70018277,13,why the name change here?,474933402,2016-07-08 09:27:31
15716844,3114547,70030011,32,"Good to know, I'll fix it.",474933402,2016-07-08 13:23:26
15716844,3114547,70030098,13,The file and the class didnt have the same name so I picked one. I can definitely go the other way around though.,474933402,2016-07-08 13:24:46
15716844,3114547,70134884,24,"it does break mima, I'll add an exclusion",474933402,2016-07-09 03:19:51
15741656,7111,70159916,7,while we are at it can we do: `pairs.iterator.map { }.toList.groupBy` which might be marginally faster.,475545233,2016-07-09 08:36:06
15741656,7111,70159999,6,no return type here?,475545233,2016-07-09 08:40:37
15741656,7111,70160071,39,"while we are here, I think it is binary compatible (though not source) to change to:
```scala
def iteratorToSpool[T](it: Iterator[T]): Future[Spool[T]] = ...
```
Not sure why this forces `(K, V)`",475545233,2016-07-09 08:44:49
15741656,7111,70160085,29,why is this needed? I don't see it used by name?,475545233,2016-07-09 08:45:24
15741656,3114547,70164646,41,it's used here,475545233,2016-07-09 16:02:23
15741656,7111,70262122,41,Ahh.,475545233,2016-07-11 20:58:55
15793145,7111,71564703,65,"honestly I'd just do `r.getResponse != null` here or:
```scala
.flatMap { r => r.getResponse match {
     case null => Iterator.empty
     case resp => Iterator.single(resp.getId -> Option(resp.getSourceAsString))
   }
}
```",477570596,2016-07-21 00:02:06
15793145,7111,71564984,100,"this comment is a lie. There is no optimization of multiGet here, right? delete?",477570596,2016-07-21 00:03:37
15793145,3114547,71578741,65,Is there a reason to prefer `Iterator.empty` / `Iterator.single` over `None` / `Some`?,477570596,2016-07-21 01:19:58
15793145,3114547,71879690,65,@johnynek curious about this one,477570596,2016-07-22 20:40:29
15793145,7111,71913209,65,"ahh, sorry. In library code, I advocate for a little bit of geeking out in the name of perf. In this case, actually `Option[T]` is not `TraversableOnce` but there is an implicit conversion. Since you are making the `Option` you could just have well have m",477570596,2016-07-23 00:16:35
15793145,3114547,71915129,65,"Ok, thanks!",477570596,2016-07-23 00:29:27
15793145,7111,72111699,47,as a TODO for us in the future: this is not a good pattern. `FuturePool` should be passed by constructors (often implicit).,481189605,2016-07-26 00:54:38
15793145,3114547,72112166,47,Noted,481189605,2016-07-26 00:56:51
15883230,7111,72126734,54,don't need `{ }` here or on `put`.,482437763,2016-07-26 02:18:39
15883230,7111,72137044,66,"okay, geekout time. Can we not use the `futurePool` here and instead write a function to convert `Deferred[T]` to `Future[T]`?

http://tsunanet.net/~tsuna/async/api/com/stumbleupon/async/Deferred.html?is-external=true

I think we just want something l",482458973,2016-07-26 03:22:23
15883230,7111,72137163,70,"same comment here. In fact, I think this is more wrong since I think this is not actually waiting till the client has closed.",482458973,2016-07-26 03:23:11
15883230,7111,72137203,71,same comment.,482458973,2016-07-26 03:23:26
15883230,7111,72137256,99,same comment.,482458973,2016-07-26 03:23:42
15883230,7111,72137320,99,actually this is different.,482458973,2016-07-26 03:23:56
15883230,7111,72137491,29,we should have a todo to pass in the `FuturePool`. Should not make these internally,482458973,2016-07-26 03:25:01
15883230,7111,72137680,33,"if you are going this route, use `.foreach`:
```scala
Option(conf.get(""hbase.zookeeper.quorum"")).foreach { _ =>
  conf.set(""hbase.zookeeper.quorum"", quorumNames.mkString("",""))
}
```",482458973,2016-07-26 03:26:09
15883230,7111,72137909,46,"why is this outside of the Future, I wonder, and nothing else is?",482458973,2016-07-26 03:27:26
15883230,7111,72137956,46,"ahh, because we close it at the end.... got it.",482458973,2016-07-26 03:27:40
15883230,7111,72138785,35,"actually, below I think we want to use `toFuture[T](d: Deferred[T]): Future[T]` and actually not use the `FuturePool` at all, I think. In fact, I think we could possibly remove the `futurePool` and the `threads` val.",482458973,2016-07-26 03:32:21
15883230,7111,72140659,35,"I wonder if what we really want is a
```scala
case class Table(asBytes: Array[Byte])
case class Column(asBytes: Array[Byte])
case class ColumnFamily(asBytes: Array[Byte])
case class Key(asBytes: Array[Byte])
case class Result(timestamp: Long, valueA",482458973,2016-07-26 03:42:35
15883230,7111,72293044,35,"maybe not reuse the same name there, maybe call the above proposal something different.",482458973,2016-07-27 00:06:20
15883230,3114547,72578924,57,"I tried awaiting the result of this async call, however it hangs forever. As is, it doesn't do anything anyway.",483552046,2016-07-28 14:58:34
15883230,7111,72728643,11,"looks like you missed:
```
[error]  * method futurePool()com.twitter.util.ExecutorServiceFuturePool in class com.twitter.storehaus.asynchbase.AsyncHBaseStringStore does not have a correspondent in new version
[error]    filter with: ProblemFilters.excl",483600667,2016-07-29 07:56:26
15883230,3114547,72751049,11,"Indeed, my bad. Will fix later today.",483600667,2016-07-29 14:22:23
16081423,7111,74288818,62,"can we use `s""Cannot convert ${value.getClass} to ${manifest[V]}""`",487844444,2016-08-11 00:19:42
16081423,7111,74289073,66,same comment.,487844444,2016-08-11 00:20:58
16081423,7111,74289154,50,seems like this method should really be returning `Try[V]` rather than an option and throwing. :/,487844444,2016-08-11 00:21:20
16081423,3114547,76102358,50,"Sorry I haven't been able to work on that for a while, I've been a bit overwhelmed with other things.

I wanted your input regarding this:

```scala

  protected def getValue(valueObject: MongoDBObject): Try[V] =
    valueObject.getAs[V](valueName)",487844444,2016-08-25 00:32:30
16081423,7111,76102887,50,"looks good to me, I'd just add:
```scala
s""Cannot convert $value of type ${value.getClass} to ${manifest[V]}""
```
so we can see the full value and type in the exception message.",487844444,2016-08-25 00:35:44
16081423,3114547,76103214,50,"Ok, but what about the

```scala
case None =>
  if (valueObject.get(valueName).isEmpty)
```

case?",487844444,2016-08-25 00:37:34
16081423,7111,76120015,50,I think it `.isEmpty` is fine if we are never looking at the `Some(contents)` to get the data out.,487844444,2016-08-25 02:12:56
16081423,7111,76180450,66,I think we want `Try[Option[V]]` here actually. Some things are legitimately `None`.,499627899,2016-08-25 12:00:14
16081423,7111,76180499,77,"I think this should be `Return(None)` on this branch, which is to say it was really empty.",499627899,2016-08-25 12:01:15
16081423,7111,76180511,81,this should be `Return(Some(value))`,499627899,2016-08-25 12:01:27
16081423,7111,76180533,88,let's put the return type `: Class[_]` I think.,499627899,2016-08-25 12:01:52
16081423,7111,76180654,60,"this should be:
```scala
futurePool {
  col.findOne(MongoDBObject(keyName -> key)) match {
    case None => Future.None
    case Some(v) => Future.const(getValue(v))
  }
}.flatten
```
I think.",499627899,2016-08-25 12:03:51
16081423,3114547,76183627,66,"Yeah, that's what I wanted your input on earlier.",499627899,2016-08-25 12:51:14
16081423,7111,76185470,66,"Sorry I overlooked that before.
On Wed, Aug 24, 2016 at 19:51 Ben Fradet <notifications@github.com> wrote:

> In
> storehaus-mongodb/src/main/scala/com/twitter/storehaus/mongodb/MongoStore.scala
> <https://github.com/twitter/storehaus/pull/324#discussion_",499627899,2016-08-25 13:13:40
16081423,3114547,76187716,66,No problem.,499627899,2016-08-25 13:38:55
16597077,7111,76519960,30,can we change this to `k -> kvs(k)` rather than `.get(k).get`?,501203442,2016-08-28 00:58:43
16597077,7111,76519972,37,what about `insertKvs.toMap.mapValues(inj)`? I think that will work.,501203442,2016-08-28 00:59:28
16597077,7111,76519986,49,same `k -> kvs(k)` comment,501203442,2016-08-28 01:00:03
16597077,7111,76520009,51,"looks like a lot of `get` there. what about:
```scala
existingKvs.map { case (k, v) =>
   k -> inj(semigroup.plus(result(k).get v))
}
```",501203442,2016-08-28 01:02:57
16597077,7111,76520051,80,can we say `Iterator.continually` which I think is slightly faster than a Stream if we are just calling `mkString`?,501203442,2016-08-28 01:06:23
16597077,7111,76520059,96,"can we use `case (k, v) =>` here?",501203442,2016-08-28 01:07:05
16597077,7111,76520067,105,"`flatMap { case (k, v) => List(k, v) }` I think we will work if you keep the return type annotation.",501203442,2016-08-28 01:08:00
16597077,7111,76520090,98,"pretty skeptical about the `.getOrElse("""")` can you think why that is safe? If we can't invert, shouldn't we be passing that up or something? We are in a `Future` so we can give a failed result. I think we need to lift the `Try` into a `Future` at this po",501203442,2016-08-28 01:09:59
16597077,7111,76520101,125,`mysqlResult(_.headOption.flatten)`,501203442,2016-08-28 01:10:20
16597077,7111,76520159,150,`Iterator.continually`,501203442,2016-08-28 01:14:28
16597077,7111,76520158,120,"let't not use `getOrElse`, let's properly lift that into the `Future`.
```scala
// put this in some package object if we don't already have it somewhere.
def toTwitterFuture[T](t: Try[T]): Future[T] = t match {
  case Success(t) => Future.value(t)
  ",501203442,2016-08-28 01:14:28
16597077,7111,76520169,150,Can we share this utility function with the other one?,501203442,2016-08-28 01:15:09
16597077,7111,76520172,153,no getOrElse here.,501203442,2016-08-28 01:15:17
16597077,7111,76520191,162,"```scala
rows.iterator.collect { case (Some(k), v) => (k, v) }.toMap
```
is better ",501203442,2016-08-28 01:16:48
16597077,7111,76520257,202,"```scala
newKeys.iterator.collect {case k if kvs.contains(k) => k -> kvs(k) }.toMap
```
I think is better (one pass over the data, not 3)",501203442,2016-08-28 01:21:31
16597077,7111,76520320,220,"```scala
existingKvs.iterator.collect { case (k, Some(v)) => (k, v) }.toMap
```",501203442,2016-08-28 01:23:35
16597077,7111,76520336,235,"```scala
existingKvs.iterator.collect { case (k, None) => k }
```",501203442,2016-08-28 01:24:31
16597077,7111,76520417,255,"can we do:
```scala
def commitOrRollback(): Future[Unit] =
  commitTransaction
    .handle { case e: Throwable => rollbackTransaction.flatMap { _ => Future.exception(e) } }

for {
_ <- insertF
_ <- updateF
_ <- deleteF
_ <- commitOrRollback
} y",501203442,2016-08-28 01:30:03
16597077,7111,76520427,287,let's fix the `getOrElse`,501203442,2016-08-28 01:30:44
16597077,7111,76520439,299,getOrElse has to go,501203442,2016-08-28 01:31:29
16597077,7111,76520451,49,can we do `case other => ` and include `$other` in the error message? Helps debugging usually.,501203442,2016-08-28 01:32:28
16597077,7111,76520459,72,lets include the value in the error message.,501203442,2016-08-28 01:32:46
16597077,3114547,76521585,80,"I didn't know about that, if you don't mind would you care to explain why?",501203442,2016-08-28 02:50:59
16597077,3114547,76521604,98,"To be honest, I just wanted to get rid of [the deprecation warning](https://github.com/twitter/storehaus/blob/develop/storehaus-mysql/src/main/scala/com/twitter/storehaus/mysql/ValueMapper.scala#L134) but I guess the `getOrElse` was the reason it was depr",501203442,2016-08-28 02:53:06
16597077,3114547,76830312,34,@johnynek I'd like to know what you think about this.,502906492,2016-08-30 23:27:50
16597077,7111,77912101,28,"I'd rather:
```scala
val bldr = Vector.newBuilder[T]
val tryRes = ts.iterator.foldLeft(Try(())) {
  case (f: Failure[_], _) => f
  case (Success(_), Success(t)) => bldr += t
  case (_, Failure(err)) => Failure(err)
}.map { _ => bldr.result() }
toT",502906492,2016-09-08 04:59:15
16597077,3114547,77958669,28,"Interesting, thanks a lot for your input. Will make the changes.",502906492,2016-09-08 14:39:34
16597077,3114547,78299427,196,the `&& kvs(k).isDefined` was missing compared to the original version,510764393,2016-09-12 00:56:05
16597077,3114547,78299478,212,the `.toSeq` was missing as a result the iterator was consumed by `deleteKeys.size` when building the sql request and `deleteParams` was empty.,510764393,2016-09-12 00:59:42
17104786,7111,80322373,35,"can we make two lines:
```scala
.map {
  case e if e.isEmpty => None
  case xs => Some(Map(xs: _*))
}
```",513564762,2016-09-24 03:37:05
17104786,3114547,80958391,35,done :+1: ,513564762,2016-09-28 23:22:16
17104786,7111,80972262,20,"Is this really the semigroup that redis is doing? I tend to doubt it. Seems like the value is more like `Map[ChannelBuffer, Double]`. Can we add a test that the semigroup we declare here is consistent with how redis works?

We could do that by comparing",520718909,2016-09-29 00:26:39
17758279,7111,82701231,9,allCatch predates `scala.util.Try`. Can we move to that?,529589788,2016-10-11 06:24:52
17758279,7111,82701527,29,"```scala
.foreach { c =>
  Try(c.cleanup()).recover {
    case error => println(s""failed to cleanup $c: ${error.getMessage}"")
  }
}
```",529589788,2016-10-11 06:27:58
18208958,7111,84993570,106,let's remove this.,541932524,2016-10-26 03:29:03
18208958,7111,84993645,118,don't need `{ }` for single expression methods.,541932524,2016-10-26 03:29:23
18208958,7111,84991992,64,I don't think we should have the `println` around.,541932524,2016-10-26 03:22:00
18208958,7111,84992411,49,"```scala
ks.iterator.map { key =>
  (key, reqMap.map(_.get(key)))
}.toMap
```
would be more direct than building the map yourself (and maybe faster since it can use a MapBuilder).",541932524,2016-10-26 03:23:52
18208958,7111,84991785,9,"can we instead follow the style of the rest of the project and use `Injection[A, PostgresValue]` here instead?",541932524,2016-10-26 03:21:00
18208958,7111,84993789,18,would it be too much work to add a `PostgresMergeableStore` that does `merge` in a transaction? That would be nice to have for several use cases.,541932524,2016-10-26 03:30:11
18208958,7111,84993036,33,"can we pass a limit here? I'm also worried that we may have more than one item. I would rather limit to 2, then do:

```scala
result.flatMap {
  case Nil => Future.None
  case h :: Nil => Future.value(Read[V].read(h.get(Symbol(vCol))))
  case other ",541932524,2016-10-26 03:26:29
18208958,7111,84993435,12,why the extra wrapper on `Element`?,541932524,2016-10-26 03:28:19
18208958,1828428,84997216,18,"Sure, I will do it!",541932524,2016-10-26 03:46:34
18208958,1828428,84998356,12,to change Postgres driver(finagle-roc) in future(if we we want to).,541932524,2016-10-26 03:52:40
18208958,7111,85013406,9,"you could do in your package:
```scala
type PostgresValueConverter[A] = Injection[A, PostgresValue]
```
then in the `object PostgresValue { ...` define the implicits and it should be pretty clean and pick them up automatically.",541932524,2016-10-26 05:15:01
18208958,7111,85013510,12,I see. That's fine if we are going to automatically handle the conversions I think.,541932524,2016-10-26 05:15:32
18208958,1828428,85197417,18,"Well, that part turns out to be kind of tricky). How can we implement merge since we use async driver( separate calls client.query(""BEGIN"") and client.query(""COMMIT;"") can lead to unknown result, since some requests can be made simultaneously  and can be ",541932524,2016-10-27 02:09:32
18208958,7111,86409947,28,"okay, I'm really sorry. I overlooked that your `Read` and `Show` were not inverses of each other. One is going to `String` the other is coming from a PostgresValue. I wish I had noticed that.

I'd actually prefer the way you had it to throwing exception",542730308,2016-11-04 01:17:28
18208958,7111,86408987,6,why do we need this?,542730308,2016-11-04 01:13:15
18208958,7111,86408954,6,do we need this? I don't see where.,542730308,2016-11-04 01:13:04
18208958,7111,89171277,30,"why do we need to throw here? Why not just put this in the future?
```scala
private def toV(p: PostgresValue): Future[V] = vInj.invert(p) match {
  case Success(v) => Future.value(v)
  case Failure(e) => Future.exception(e)
}
```
then use `toV(v).f",561208725,2016-11-23 01:44:26
18208958,7111,89169873,144,"`Future.value(Map.empty)` is better since it avoids the call-by-name parameter, and since that is a constant, you might save it as a `private[this] val` and avoid the reallocation.",561208725,2016-11-23 01:37:42
18208958,7111,89172284,73,I don't like this approach since we have no guarantee that `toString` is going to work. Why can't use a full injection to `PostgresValue` then use some safe mechanism to go from `Value[Any]` to `String` that can be interpolated in a SQL statement. I assum,561208725,2016-11-23 01:49:39
18208958,7111,89170866,20,"can we avoid the throwing? I know we don't use it, but I really don't want to add code that throws unless we have no other way.

Here I can see two ways:

1. just add the code to wrap the primitives below in `PostgresValue`, which does not seem hard.",561208725,2016-11-23 01:42:40
18208958,7111,89169137,62,"foldLeft is generally faster because you may get some sharing:
```scala
val smaller = if (m1.size < m2.size) m1 else m2
val bigger = if (m1.size < m2.size) m2 else m1
smaller.foldLeft(bigger) { case (m, (k, v)) =>
  val newV = Semigroup.maybePlus(v, ",561208725,2016-11-23 01:33:40
19555492,550921,91883651,76,fixed,573115625,2016-12-12 13:04:05
19555492,550921,91883647,22,Makes sense. Don't want to merge latest algebird in this change. Is it ok to simplify this separate review where I can merge algebird. I've left a todo for now.,573115625,2016-12-12 13:03:59
19555492,550921,91883979,81,Done,573115625,2016-12-12 13:11:15
19555492,550921,91883660,76,Replaced with Array.,573115625,2016-12-12 13:04:17
19555492,7111,91866292,22,"1. the latest algebird has `Semigroup.maybePlus` this does this, but it always returns `V` not `Option[V]` which I think is correct (you can just box in `Some` as needed).",573115625,2016-12-12 05:44:58
19555492,7111,91866334,76,can we put spaces in types: `fs: Map...`,573115625,2016-12-12 05:46:23
19555492,7111,91866357,76,I'm not crazy about using `Seq`. I'd rather use `List` or `Vector` so the contracts are clearer.,573115625,2016-12-12 05:47:07
19555492,7111,91866400,81,"what about `AtomicReferenceArray[(K, Either[Throwable, V])]` here instead. Seems easier to follow",573115625,2016-12-12 05:48:55
19555492,7111,91866427,76,"If this is to be private, it can even be `Array`.",573115625,2016-12-12 05:50:21
19555492,7111,91866450,85,doesn't this need to be an `AtomicReference`? How is it safe to modify this var from many threads?,573115625,2016-12-12 05:51:46
19555492,7111,91866528,118,"failures has to be a future right? You are returning a copy here, but the futures are not done yet. If you could have a `Map` you could see what keys have failed, and you can't can you? I think this has to be `Future[Map[K, ..]]`. I am not sure `Future[No",573115625,2016-12-12 05:55:27
19555492,550921,91883713,118,"Yes, that was totally wrong. I've fixed it now and added tests as well.",573115625,2016-12-12 13:05:24
19555492,7111,92532375,18,"can we not use `todo` and instead file issues. We don't always close issues, but we approximately never address todos.",579204877,2016-12-15 10:19:13
19555492,7111,92532564,53,"looking at this again it seems like rather than `Either[Throwable, V]` we could just use `Try[V]` which is basically the same.

Then this method signature could be:
`def collectWithFailures[K, V](fs: Map[K, Future[V]]): Future[Map[K, Try[V]]]` which ac",579204877,2016-12-15 10:21:39
19555492,7111,92532863,93,"if you are going to geek out on while loops above, doing the same here is probably worth it:
```scala
val mapIt = fs.iterator
var i = 0
while(mapIt.hasNext) {
  val kv = mapIt.next
  fv._2.respond {
    case Return(v) =>...
  }
  i += 0
}
```",579204877,2016-12-15 10:24:44
19555492,550921,92550854,53,"The idea of Either[Throwable, V] to Try[V] is great, indeed Try is basically the same in this context and simpler.

Combining successful and failed results will be inefficient since we need to immediately do multiput for the successful ones and so need ",579204877,2016-12-15 14:24:53
19555492,550921,92551236,93,"Implemented this, it does add a bit of complexity. Also does avoid one wrapping/unwraping for each item in the map.",579204877,2016-12-15 14:30:07
19555492,550921,92551383,18,"Sounds good. Not sure if filing a jira before the change is merged would be a good idea. Will file the jira after this change merges. This is a bit of problem with filing jiras in such cases, it is something that would need to be kept track separately.",579204877,2016-12-15 14:31:52
19624951,7111,91871937,27,"I think this code got migrated to bijection anyway, so we can use that on the next bump.",573929175,2016-12-12 09:07:03
19624951,7111,91872044,27,Added #337,573929175,2016-12-12 09:10:18
19624951,7111,91865499,21,can we bump this to `0.1.12`? I think that's the latest with a bugfix we found.,574829517,2016-12-12 05:12:23
21603535,34011182,102262119,49,Part of the upgraded finagle memcache client needed com.twitter.common.metrics.Gauge so this exclude was removed. ,628144129,2017-02-22 01:06:51
21603535,7111,102264387,29,this should be `0.13.0`,628144129,2017-02-22 01:16:22
21603535,7111,102264615,87,"can we go to `1.13` branch? Also, while we are at it, can we move this version up to the top of the file where we set the other versions?",628144129,2017-02-22 01:17:20
21603535,6636815,111037919,35,can upgrade to 0.17.0,628841689,2017-04-12 06:36:01
21603535,34011182,111038532,35,Excellent. I will do that right away. Thanks!,628841689,2017-04-12 06:41:23
21603535,6636815,111605996,12,we can uncomment this now right?,669982278,2017-04-15 00:28:52
21603535,6636815,111650622,37,think the latest version is 6.43.0. Let's use that?,669982278,2017-04-15 06:43:19
21603535,6636815,111606172,12,I think we dont need to run coverage (as we're doing this for 2.11) and mima (as this will be the first 2.12 build). ,669982278,2017-04-15 00:29:59
22399517,550921,115103534,19,"Again, not sure how important it is to support 2.10. If not then looks like we can avoid this compat code.",657226852,2017-05-06 06:18:16
22399517,550921,115103272,48,Not sure how important it is to support 2.10. Having two versions of external dependencies makes maintenance harder.,657226852,2017-05-06 06:15:23
22399517,489976,116313892,19,"Of course making the decision to not to support Scala 2.10 any more will make maintenace easier.

I see that #343 just gets approbed so this present PR (#344) does not makes any sense now.

Thank you for upgrading  storehaus to Scala 2.12 and a newer ",657226852,2017-05-13 03:06:29
24236767,134219,115342789,8,Should we do this for 2.11?,688224440,2017-05-09 03:18:28
24236767,134219,115342914,7,If we add 2.12 here then should we also enable travis for 2.12?,688224440,2017-05-09 03:19:01
24236767,134219,115343190,5,Do we need it in this review?,688224440,2017-05-09 03:20:10
24236767,7111,115348192,38,is there no`client.del(k)` we can call?,688224440,2017-05-09 03:42:20
24236767,7111,115348655,37,is there no `client.del(set)`?,688224440,2017-05-09 03:44:20
24236767,7111,115348154,33,"we don't need to wrap with a `Seq`. Could we just call `client.del(k)` maybe? Also, this seems like a a race to me. the del could happen after the set. We should use flatMap to sequence:
```scala
for {
  _ <- client.del(k)
  _ <- ttl.fold(Future.Unit)",688224440,2017-05-09 03:42:08
24236767,7111,115348889,34,"this should be a bijection, not an Injection (there is an implicit from Bijection to Injection, by the way so you can pass this as the injection above).",688224440,2017-05-09 03:45:33
24236767,7111,115346223,12,what's the story here?,688224440,2017-05-09 03:34:07
24236767,7111,115346544,5,+1 to minimize. I prefer to keep the diffs as minimal as possible (and personally never mix style and logic changes if possible).,688224440,2017-05-09 03:35:31
24236767,7111,115348611,26,`0L` and `-1L` is the better way to do this.,688224440,2017-05-09 03:44:07
24236767,7111,115348697,44,same comment about `client.del(set)`.,688224440,2017-05-09 03:44:33
24236767,7111,115346662,4,this seems like a maybe logical change. Are we sure there is nothing to replace it?,688224440,2017-05-09 03:36:00
24236767,7111,115346300,7,can we use `2.11.11` and `2.12.2`?,688224440,2017-05-09 03:34:27
24236767,550921,115385019,12,Ahh... this got carried over from Ben's original PR. Let me uncomment this.,688224440,2017-05-09 07:29:26
24236767,550921,115383145,38,"del is deprecated:
  @deprecated(""remove netty3 types from public API"", ""2016-03-24"")
  def del(keys: Seq[ChannelBuffer]): Future[JLong] =
",688224440,2017-05-09 07:12:55
24236767,550921,115384453,44,del is deprecated.,688224440,2017-05-09 07:24:10
24236767,550921,115385249,5,Removed.,688224440,2017-05-09 07:31:54
24236767,550921,115382932,37,There is but it's marked deprecated.,688224440,2017-05-09 07:11:17
24236767,550921,115383545,33,del is deprecated unfortunately. Taken care of the race.,688224440,2017-05-09 07:16:18
24236767,550921,115384851,8,"No, I guess in the original PR Ben may have added it for consistency. Let me remove it.",688224440,2017-05-09 07:28:01
24236767,550921,115404073,4,Applied the alternative way of doing this.,688224440,2017-05-09 11:13:19
24378103,134219,116101743,85,Is `buf.length` the same as `.readableBytes`?,690456062,2017-05-12 04:03:34
24378103,550921,116106512,85,"yeah, seem to be afaict.",690456062,2017-05-12 04:26:29
24440951,7111,116301888,11,so we need to make sure not to merge with this setting.,691698050,2017-05-13 01:58:39
24440951,550921,116302064,11,"yes, this is just for trying out faster.",691698050,2017-05-13 01:59:27
4377353,132262,16029301,1,we typically assume that users know how to use sbt.  maybe it would make more sense to just include the libraryDependencies and resolvers lines?,147161011,2014-08-10 08:08:19
4377353,132262,16029303,9,"instead of `% ""twitter-server_2.10""` this should be `%% ""twitter-server""` which will automatically fill in the scala version.",147161011,2014-08-10 08:09:00
4377353,132262,16029305,16,this is not quite right--let's drop the _2.10.,147161011,2014-08-10 08:09:41
4377353,132262,16029308,18,"does this link render properly?  have you tried it locally?

let's not capitalize twitter-server.",147161011,2014-08-10 08:10:36
4377353,132262,16029310,20,"thinking about this more, I'm not sure that we should add this at all.",147161011,2014-08-10 08:11:10
4377353,106317,16032782,16,"So I tried this, and when I removed the ""_2.10"" from the string, then sbt can't find the dependency.

[error] (*:update) sbt.ResolveException: unresolved dependency: com.twitter#twitter-server;1.7.3: not found

Any thoughts?
",147161011,2014-08-11 00:08:58
4377353,132262,16032865,16,"If you look at what you have here, and what you have above, you'll notice that the syntax is slightly different.  Here, you have two %, and above you use just one.  The %% appends the scala version.",147161011,2014-08-11 00:25:19
4377353,4955808,16095546,18,"WHO ARE YOU...




------------------ 原始邮件 ------------------
发件人: ""Moses Nakamura"";<notifications@github.com>;
发送时间: 2014年8月10日(星期天) 中午11:10
收件人: ""twitter/twitter-server""<twitter-server@noreply.github.com>; 

主题: Re: [twitter-server] Doc improv",147161011,2014-08-12 09:48:22
8160083,132262,33322045,22,here too,274479773,2015-06-26 06:22:46
8160083,132262,33322041,19,I think you can drop case in this case,274479773,2015-06-26 06:22:41
8160083,132262,33322083,20,"maybe namespace them both under ""sys"" or ""system""?",274479773,2015-06-26 06:23:56
8160083,132262,33322014,3,"can you put .idea in your global gitignore?  Intellij is just your opinion, man.",274479773,2015-06-26 06:21:42
8160083,132262,33322215,19,"there isn't anything which guarantees that these will only be called once–it shouldn't really matter, it'll just fail, and there isn't really an obvious reason why we'd want to call it more than once, but for cleanliness, it might be better to stick these",274479773,2015-06-26 06:28:21
8160083,250678,33383987,3,"Sure, I can remove .idea from here, but fwiw I was just following convention from related projects.

https://github.com/twitter/finagle/blob/master/.gitignore#L18
https://github.com/twitter/util/blob/master/.gitignore#L11
https://github.com/twitter/os",274479773,2015-06-26 23:45:48
8160083,250678,33384656,19,"I think case is required to pattern match on the tuple that results from iterating over sys.env, which is a map.

Regarding only running the code once, I was following your comment from 7fb92dc3, where you asserted that since TwitterServer is a singleto",274479773,2015-06-26 23:52:45
8160083,132262,33389056,19,"whoops, yeah, I confused Function1[Tuple[A, B], C] (where case is not optional) with the Function2[A, B, C] case (where case is optional).

good call, happy to keep it under the assumption twitter-server is a singleton.  I think I wanted it so that it w",274479773,2015-06-27 00:43:03
8160083,132262,33421444,5,"can we scope these as Seq(""system"", ""properties"", key), and Seq(""system"", ""env"", key) instead?",276350169,2015-06-28 15:40:45
8160083,132262,33421454,22,"feel free to ignore:
instead of copy/pasting these tests, we can write a for-loop.",276350169,2015-06-28 15:41:51
10385074,132262,44441170,15,can we put the comma on the previous line?,341680287,2015-11-11 01:03:52
10385074,240199,44476557,15,:+1: ,341680287,2015-11-11 05:38:06
15183136,132262,65441730,17,"line length should be cols <= 100, please",456405698,2016-06-02 04:01:28
15183136,132262,65442512,12,line length for scaladoc should be cols <= 80,456405698,2016-06-02 04:05:32
15183136,132262,65442606,11,"scaladoc looks like this:

```scala
/**
 * lorem ipsum....
 *...
 */
```",456405698,2016-06-02 04:06:02
15183136,132262,65442645,12,no need for `@des`,456405698,2016-06-02 04:06:14
15183136,132262,65443322,12,"I'm not sure this is the right place to elaborate on this.  Since `EventsHandler` is already a `Service` which defines the `apply` method, we can rely on `Service`'s definition for apply.  Maybe the right place to put the comment is on the object itself?",456405698,2016-06-02 04:10:26
15183136,132262,65443414,14,"ditto, this restates the type signature.",456405698,2016-06-02 04:11:01
15183136,132262,65443391,13,"this line seems to restate the type signature, so let's skip it.",456405698,2016-06-02 04:10:52
15183136,132262,65443638,17,"I don't think this dense style of comments makes the code more clear.  we typically use this style of inline comments when something tricky is going on, not to explain every single line of code.

if you think the code is unclear, maybe you could make a ",456405698,2016-06-02 04:12:30
15183136,132262,65443867,43,this comment doesn't make this code easier to read to me.,456405698,2016-06-02 04:13:59
15183136,1925,65477087,10,"Gives a nice => Provides
objct => object",456581506,2016-06-02 09:43:48
15183136,1925,65477228,60,"Seems odd for the message to mention an error, but for it to log at INFO.",456581506,2016-06-02 09:46:22
15183136,1925,65477181,59,handling the ?,456581506,2016-06-02 09:45:25
15183136,1925,65477162,63,perticular => particular,456581506,2016-06-02 09:45:04
15183136,132262,65485889,9,this is still not the right style.  please note: *two* asterisks are necessary for it to be generated as scaladoc.,456581506,2016-06-02 12:29:26
15183136,132262,65485927,16,I think this is clear from the code.  let's skip it.,456581506,2016-06-02 12:30:13
15183136,132262,65485984,22,this doesn't do any tracking.  it only returns the serialized version of the sink.,456581506,2016-06-02 12:31:04
15183136,132262,65486055,27,I don't think this is right?  does this really return json?  it looks like it returns html.,456581506,2016-06-02 12:32:26
15183136,132262,65486086,29,"this code is already clear, does not need a comment.",456581506,2016-06-02 12:32:58
15183136,132262,65486094,33,this comment doesn't make the code more clear.,456581506,2016-06-02 12:33:07
15183136,132262,65486146,12,drop this–it's already clear from the type signature.,456581506,2016-06-02 12:34:04
15183136,132262,65486155,13,drop this–it's already clear from the type signature.,456581506,2016-06-02 12:34:13
15183136,132262,65486242,52,this is already clear from the code.  this comment doesn't make it more clear.,456581506,2016-06-02 12:35:39
15183136,132262,65486317,59,"this is already done above in the Reader.copy, and I think the code is already quite clear.",456581506,2016-06-02 12:36:45
15183136,132262,65486376,41,needs two asterisks.,456581506,2016-06-02 12:37:40
15183136,132262,65485863,10,This method is not really about syntactic sugar?  And I don't think it describes the actual logic of the method?,456581506,2016-06-02 12:29:00
15183136,132262,65486344,63,"the code was already clear, drop this line.",456581506,2016-06-02 12:37:19
15183136,132262,72111170,10,"this scaladoc still doesn't make it clearer to readers what this method does.  if it's not adding anything, maybe we should drop it?",457348155,2016-07-26 00:51:48
15183136,132262,72112130,37,"I think we can make this more clear by simplifying this: how about:

> Constructs a response given a content type and a byte stream.",457348155,2016-07-26 00:56:38
15183136,132262,72112227,42,"this isn't an array, and the parameter restates the information embedded in the type.",457348155,2016-07-26 00:57:13
15183136,132262,72112279,39,this is already clear from the parameter name,457348155,2016-07-26 00:57:24
15183136,132262,72112319,41,not sure this adds much,457348155,2016-07-26 00:57:42
15183136,132262,72112373,39,how about dropping the `@param` and `@return` for this method?,457348155,2016-07-26 00:57:59
15183136,132262,72112606,23,simply: `use JsonSink to serialize the [[com.twitter.util.events.Sink]] to HTML`,457348155,2016-07-26 00:59:20
18192825,132262,85374998,18,"I'm not sure that this is completely exchangeable for the premain.  What if someone had set up other loggers and was depending on this keeping the LogFormat?  Can we keep the premain and have it use the defaultFormatter?

Also, please add a type ascript",543695893,2016-10-27 23:24:36
18192825,1350674,85385757,25,"Do we need to make this public? I don't see a reason we need to. I'm going to bet that it was to allow the override in `LogFormat`, but if you use a type ascription per @mosesn suggestion, we can lower the type bound on it to just `Formatter` with dynamic",543695893,2016-10-28 00:20:50
18192825,4402,85395894,25,"leaving LogFormatter private ends up not compiling due to ""leakage"" of the private class. Is final an acceptable change?",543695893,2016-10-28 01:13:38
18192825,1350674,85396684,25,Where is it leaking from? Do you mind posting the error message?,543695893,2016-10-28 01:17:51
18192825,4402,85397378,18,I can't find a use case where replacing premain with this override changes behavior except for one. That's not there are none only that all the changes I've tried work as before except for the one I'm trying to change (that overriding defaultFormat AFTER ,543695893,2016-10-28 01:21:21
18192825,132262,85397865,25,I think @bryce-anderson is right here.,543695893,2016-10-28 01:23:55
18192825,4402,85411353,18,@mosesn using LogFormatter this way means that when the premain in Logging runs it uses this formatter rather than the default defaultFormatter. When I override defaultFormatter in my code the premain in Logging uses my formatter. I can certainly add a pr,543695893,2016-10-28 02:38:15
18192825,132262,85422344,18,Why do you have to add a premain to your code?  I don't understand.,543695893,2016-10-28 03:37:30
18192825,132262,85477758,18,why do you call this instead of keeping it the way it was before?,543920740,2016-10-28 13:24:46
18192825,4402,85546326,18,@mosesn The goal here is to replace the mechanism used to set the default logging format. As things are today ```com.twitter.app.Logging``` has an exposed method ```defaultFormatter``` designed and documented to allow ```TwitterServer``` users such as mys,543920740,2016-10-28 21:53:41
18192825,132262,85557778,18,@crispywalrus right.  my question is why you call configureLoggerFactories instead of iterating over the loggers and setting the formatter.,543920740,2016-10-28 22:49:20
18192825,4402,85562567,18,@mosesn Basically its' because that doesn't need to be done after the change. Switching to use ```com.twiiter.logging._``` means delegating the low level iterating over the loggers and setting the format. In return we get the ability to override the defau,543920740,2016-10-28 23:15:36
18192825,132262,85404468,18,"@crispywalrus are you sure you're using `defaultFormatter` in your premain?  I don't see why it would fail, and can't reproduce it locally.
",543695893,2016-10-28 01:58:31
18192825,7875,90131974,18,@crispywalrus I agree that this is broken and we're working on a solution to this internally as removing the LogFormat trait from TwitterServer is a rather large change in our internal codebase. Thanks!,543920740,2016-11-30 06:41:50
18192825,4402,90134133,18,I re-added the trait with changes to make it work as it did but to allow others (such as myself) to change the default logging format by overriding the ```com.twitter.app.Logging``` traits default. This foundered on the fact that the trait changed and los,543920740,2016-11-30 06:55:12
1743522,918962,5102951,16,"Bit pedantic, but it may be good to make this final. Also, is it intentional that you're passing in JobFilePreprocessor rather than this class (JobFile)?",48243885,2013-07-10 02:48:33
1743522,944921,5104651,16,checked in an update,48243885,2013-07-10 04:05:24
1743522,918962,5105235,37,"Sorry for a late comment, but it would be good to have a consistent naming style. I believe the standard for naming variables is the camel case (""confMatcher"") rather than hyphens (""conf_matcher"").",48248529,2013-07-10 04:42:10
1743522,944921,5103230,16,Good catch. I will change this.,48243885,2013-07-10 03:00:46
1743522,944921,5121212,37,"yes, done",48248529,2013-07-10 22:32:17
1798736,61025,5281429,36,"Should the parse() implementation throw this exception, rather than returning a boolean and creating it here?  The implementation itself will have more context on what actually went wrong.",50575523,2013-07-19 03:40:29
1798736,918962,5285018,50,Same here.,50575488,2013-07-19 07:51:51
1798736,918962,5283965,34,"It would be good to re-word this javadoc, as it's no longer an abstract class and thus there are no ""subclasses"".",50575525,2013-07-19 06:08:12
1798736,944921,5285095,27,"that's right, will rectify this now unnecessary check",50575488,2013-07-19 08:01:39
1798736,61025,5281795,68,I think it would be safer to throw an exception here instead of returning null.  Calling this will a null InputStream is really an error case in my opinion.,50575523,2013-07-19 03:57:23
1798736,944921,5285220,55,"Okay, just chatted with Sangjin and realized I need to call LOG.error(object, throwable) and not LOG.error(object).. fixing this now",50575488,2013-07-19 08:20:36
1798736,61025,5281846,84,"throw IllegalArgumentException here, since 2.0 is not supported yet.",50575523,2013-07-19 03:59:09
1798736,61025,5281296,31,"I think this should be an interface, rather than an abstract class, since there is no shared implementation.  Also I think naming this ""JobHistoryFileParser"" would be better than ""JobHistoryFileDecipher"".  The word ""decipher"" implies that the log files ar",50575523,2013-07-19 03:33:57
1798736,918962,5284142,75,Ditto,50575527,2013-07-19 06:24:35
1798736,944921,5284283,40,"This is how it is being used presently:
https://github.com/twitter/hraven/blob/master/hraven-etl/src/main/java/com/twitter/hraven/mapreduce/JobFileTableMapper.java#L176

The intention of this check in is to retain the same behavior.

The parse method",50575527,2013-07-19 06:36:24
1798736,918962,5285013,37,Looks like the if style is inconsistent with others?,50575488,2013-07-19 07:51:32
1798736,918962,5284114,40,"I don't quite understand how jobHistoryListener is supposed to be used. It looks like it is initialized every time parse() is called? First, is this class never used in a multi-threaded environment? Is it intended that every time parse() is called, the jo",50575527,2013-07-19 06:22:56
1798736,944921,5281972,31,changing the name and to an interface,50575523,2013-07-19 04:04:48
1798736,918962,5283977,38,"Since this is now an interface, there is no need to say ""abstract"". The same for the other methods.",50575525,2013-07-19 06:08:53
1798736,61025,5281742,26,"Do we need to retain this reference to a parser instance?  I think it would be better to remove this, make the createJobHistoryFileParser() method static, and have it always return a new instance.  Unless we suspect that creating a parser for 2.0 will be ",50575523,2013-07-19 03:55:10
1798736,918962,5284097,46,"Since this class doesn't extend any, the super() call is superfluous. In fact, the (default) constructor itself is superfluous...",50575527,2013-07-19 06:20:35
1798736,944921,5285169,55,"Yes, I wanted to print the stack trace and I tried this out but it didn't print the stack trace. Here is what I tried:

The x.printStackTrace() prints it, the earlier line prints only the error message. What am I missing?

	@Test
	public void checkfi",50575488,2013-07-19 08:12:17
1798736,61025,5282123,37,"It would be better to use something like the actual 1.0 history file format here, something like this string:

""Meta VERSION=\""1\"" .\n"" +
""Job JOBID=\""job_201301010000_12345\"""" ",50575523,2013-07-19 04:12:12
1798736,944921,5282275,37,"Yes, I actually wanted to use a entire file here and check the puts returned. But that turned out to be too much of task of generating a generic history file and I reverted back to some string.",50575523,2013-07-19 04:19:52
1798736,944921,5284422,75,I think {@inheritDoc} may be suitable,50575527,2013-07-19 06:49:27
1798736,918962,5284140,50,Indeed this is not javadoc as it doesn't start with two *'s. :) We should fix that and remove (non-javadoc)?,50575527,2013-07-19 06:24:23
1798736,918962,5284161,88,Ditto,50575527,2013-07-19 06:25:57
1798736,944921,5284246,46,"Yes, this can be removed now. Earlier it was extending a base class.",50575527,2013-07-19 06:32:05
1798736,61025,5281342,39,This method should similarly be named parse(),50575523,2013-07-19 03:36:20
1798736,944921,5281948,36,Sounds good. I debated on this and then thought it might be clearer to send back a false than have the exception inside. But will change this to throw the exception from the implementation side itself rather than returning,50575523,2013-07-19 04:03:36
1798736,61025,5281673,65,"For the moment, it doesn't seem like we need the JobKey parameter here, only the InputStream for the history file.",50575523,2013-07-19 03:52:10
1798736,61025,5285035,27,You can drop this check now that you've modified the factory to always return an instance or throw an exception.,50575488,2013-07-19 07:53:24
1798736,944921,5285094,37,"okay, will fix this and the next if",50575488,2013-07-19 08:01:13
1798736,918962,5284981,40,OK thanks for the explanation.,50575527,2013-07-19 07:48:05
1798736,918962,5285001,55,"Sorry to comment more on this, but I would recommend

```java
LOG.error("" Exception during parsing hadoop 1.0 file"", ioe);
```

instead.

It would log the exception message and the full stack trace. I think that's closer to what you wanted.",50575488,2013-07-19 07:50:30
1798736,944921,5284317,50,"This ""points"" to the javadoc as specified the in the interface JobHistoryFileParser. Is that not recommended? ",50575527,2013-07-19 06:38:56
1798736,918962,5284160,66,"I think 

LOG.error(""your log message"", ioe);

would do what these 2 lines are doing.",50575527,2013-07-19 06:25:42
1798736,944921,5284028,38,"Yes correct, removing them now",50575525,2013-07-19 06:12:59
1798736,61025,5324085,67,nit: add braces for each if/else statement,50575484,2013-07-22 22:02:39
1798736,61025,5323983,58,"This should use the constructor version: ProcessingException(String, Throwable)

Otherwise you lose the stack trace of the underlying IOException",50575484,2013-07-22 21:58:33
1798736,61025,5324088,78,same here,50575484,2013-07-22 22:02:50
1798736,61025,5324001,37,Should declare that ProcessingException is thrown,50575484,2013-07-22 21:59:24
1798736,61025,5323907,35,Drop this line as it's no longer true.,50575484,2013-07-22 21:55:47
1861992,944921,5489331,5,That's a good catch. let me see if I can modify the code further to not use these. ,52835503,2013-07-31 02:21:19
1861992,918962,5488674,5,These two classes exist only on hadoop 2.0. So it likely means that this class won't compile or run on hadoop 1.0. Is that expected?,52835503,2013-07-31 01:57:14
1861992,918962,5488405,144,The same here?,52835503,2013-07-31 01:46:19
1861992,944921,5489009,23,"No, will change it to int. ",52835503,2013-07-31 02:10:29
1861992,918962,5488205,23,"More curious than anything else, but is there a reason to use short instead of int?",52835503,2013-07-31 01:38:16
1861992,918962,5488168,46,"It might make sense to refactor this into a small private static method, as this logic is used in other places (like line 100).",52835503,2013-07-31 01:37:17
1861992,944921,5489017,46,"yes, sounds good",52835503,2013-07-31 02:10:47
1861992,918962,5488374,123,"I don't think NumberFormatException is thrown here, no?",52835503,2013-07-31 01:44:50
1861992,918962,5488459,198,"A small comment but since JobHistoryKeys is an enum, shouldn't we be able to use the switch statement instead of if's?",52835503,2013-07-31 01:48:14
1861992,944921,5489077,198,"Yes, I will change to enum. Too many if-else-ifs",52835503,2013-07-31 02:12:30
1861992,944921,5489060,123,"Ah, you're right, I previously had Bytes.toBytes(Integer.parseInt(value)) while I was developing this and then over the course, I changed that. I will remove the catch",52835503,2013-07-31 02:11:51
1893480,944921,5594657,81,"yes, these should be static, they are not instance specific initialized finals. ",53115153,2013-08-06 06:10:21
1893480,918962,5593863,81,"Are these (lines between 81 - 104) constants? If so, shouldn't they be static?",53115153,2013-08-06 05:11:03
1893480,918962,5593788,61,"This warning is actually telling us something. JobId is being set but is never read, which means it is really not being used. Should we remove this field? The actual information is captured in jobNumber.",53115153,2013-08-06 05:06:52
1893480,944921,5594610,61,"yes, it was being used earlier in a key generation but not anymore. am removing it.",53115153,2013-08-06 06:06:30
1893480,944921,5594624,121,"No, good catch. Will change to private",53115153,2013-08-06 06:07:14
1893480,944921,5594631,213,"yes, fixing this. (have it that way everywhere else in the file, but somehow missed this one)",53115153,2013-08-06 06:07:57
1893480,918962,5593951,213,"A small nit, but I believe the preferred style is
} else {",53115153,2013-08-06 05:15:40
1893480,918962,5593903,121,Are counterNames and eventRecordNames supposed to be public?,53115153,2013-08-06 05:13:25
1893480,944921,5619197,169,Will iterate over the enum.values instead of adding individual ones,53325846,2013-08-07 03:50:56
1893480,944921,5619215,117,will make the counterNames and eventRecordNames static,53325846,2013-08-07 03:51:27
1893480,61025,5672499,7,"Looking at a sample file, I think ""TOTAL_COUNTERS"" is the same as what we're treating as just ""COUNTERS"" in Hadoop 1.0.  So I don't think we need this extra prefix.  Correct me if I'm wrong.",53325848,2013-08-09 03:56:43
1893480,61025,5672602,18,"Should both of these be using the same prefix?  Having TASK_COUNTER and TASK_ATTEMPT share seems okay, provided that TASK_COUNTER is only stored in a task row, and TASK_ATTEMPT is only reported/stored in a task attempt row, ie. we don't have collisions fo",53325847,2013-08-09 04:03:04
1893480,61025,5672615,17,Why are all of these commented out?,53325848,2013-08-09 04:03:45
1893480,61025,5672671,15,Please undo all of the formatting changes in this file.  Formatting-only changes make it difficult to track when lines of code changed through standard tools.,53325848,2013-08-09 04:06:49
1893480,61025,5672685,15,Please undo formatting changes.,53325848,2013-08-09 04:07:16
1893480,61025,5672740,15,Please undo formatting changes,53325848,2013-08-09 04:10:25
1893480,61025,5672823,125,"Since eventRecordNames is static, the initialization of these should be static as well, outside of an instance constructor.",53325848,2013-08-09 04:15:00
1893480,61025,5672830,108,Should be COUNTER_NAMES,53325848,2013-08-09 04:15:18
1893480,61025,5672834,109,Should be EVENT_RECORD_NAMES,53325848,2013-08-09 04:15:31
1893480,61025,5672847,113,Should be OLD_TO_NEW_MAPPING,53325848,2013-08-09 04:16:26
1893480,61025,5672931,125,Some of this boilerplate can be omitted by expanding the Hadoop2RecordType enum into a full-fledged class.  Let's review in person.,53325848,2013-08-09 04:21:21
1893480,61025,5673002,203,"Since FSDataInputStream extends InputStream and the Hadoop 1.0 version originally used InputStream, why was the parse() method changed to take String historyFileContents?  This will result in unnecessary byte[] -> String -> byte[] conversions.",53325848,2013-08-09 04:25:03
1893480,61025,5673158,25,"Since we don't need the String form, the byte[] -> String conversion (and subsequent String -> byte[] reconversion) is unnecessary.  Let's just use byte[] here.",53325848,2013-08-09 04:33:13
1893480,944921,5673166,7,"There are task level counters which are called ""COUNTERS"" and the job level ones which are called ""TOTAL_COUNTERS"", ""MAP_COUNTERS"" AND ""REDUCE_COUNTERS"" ",53325848,2013-08-09 04:33:35
1893480,944921,5673189,17,I will remove those as they are no longer need. ,53325848,2013-08-09 04:34:45
1893480,1529651,5754442,289,"Could fields.get(k) be null ? If so, defensive coding would use fields.isNull(k) first to check.",53325852,2013-08-14 07:08:08
1893480,1529651,5754486,2,Minor nit: for new files you probably want to use the current year.,53325852,2013-08-14 07:12:26
1893480,944921,5773253,289,"Sounds good, I will add the null check. It is probably very unlikely that there are no fields in the job history file since that means an empty job history file was created which I don't think will happen unless there is a bug in the history file writing.",53325852,2013-08-15 00:22:46
1893480,61025,5885653,111,This seems a little unexpected if it's possible we're reading a v1 file.  Maybe we should return null in this case instead?,56060369,2013-08-21 06:08:23
1893480,944921,5886089,111,"Hi Gary, (maybe I didn't follow completely) The sub-string for a 1.0 history file is ""Meta VERS"" since the first line in 1.0 is 'Meta VERSION=""1"" .;'. Hence this won't throw the exception. I have a unit test at TestJobHistoryFileParserFactory.java that co",56060369,2013-08-21 06:44:28
1893480,61025,5934819,111,"I see.  Still seems a little weird that in the 2.0 case it returns the version string, and in the 1.0 case it returns a truncated string (doesn't seem quite consistent with the method name).  I would either name it getVersion2StringFromFile or change it t",56060369,2013-08-23 00:47:27
1893480,61025,5935179,129,"Fix the text here (no longer uses InputStream).  Maybe make it ""Job history contents should not be null"".",56060369,2013-08-23 01:02:05
1893480,61025,5935446,172,Why is a static variable being populated in the constructor?  Move this into a static block instead.,56060369,2013-08-23 01:12:32
1893480,944921,5989493,111,"Yes, so I have changed it now. Made the function check for both versions' strings and return accordingly ",56060369,2013-08-27 01:52:57
1893480,61025,5994222,673,No need to duplication this functionality betwee printAllJobPuts() and printAllTaskPuts().  You should just have a single method: printPuts(List<Put> puts).  Then pass either jobPuts or taskPuts as an argument.,57063451,2013-08-27 05:13:42
1893480,61025,5994409,25,"We don't need a separate call to rawService here.  We already have the history file contents present in the Result instance passed in to the map() method.  Just do something like (taken from JobHistoryRawService.getJobHistoryInputStreamFromResult()):

 ",57063451,2013-08-27 05:24:54
1893480,61025,5994615,66,"These row keys don't look right to me.  We might be missing something in parsing the task attempts for 2.0.  The row key for a task attempt should only differ from the related task row by an additional ""_[0-9]+"".

So, for example, for the two keys:

+",57063451,2013-08-27 05:39:07
1893480,944921,6012748,66,Thanks Gary for that catch! I have updated the code to generate the task keys to be the same as 1.0 now,57063451,2013-08-27 23:02:27
2008366,944921,6078938,38,This would create a new counter object each time? Maybe we could just increment it if it exists?,57556928,2013-08-30 08:32:40
2008366,944921,6078949,38,"Okay just checked, CounterMap's add function does that already. I had forgotten",57556928,2013-08-30 08:33:41
2008366,61025,6091068,38,"Yes, this does create a new Counter instance every time, so there is a fair amount of allocation that can happen. The only easy way I see around this is to make the Counter class no longer immutable, which I'm not sure is something we want to do, given th",57556928,2013-08-30 22:05:49
2280854,1529651,7048977,20,Let's break this line around ~80 characters or so.,64287749,2013-10-18 03:07:04
2394071,1529651,7475805,4,"Rather than making the factory depend on HBase, let's move the common function to a new common (abstract ?) base class for the two JobHistoryFileParserHadoop classes. Then each class can extend this base class and use the shared functionality.",69190790,2013-11-07 02:49:58
2394071,1529651,7475857,36,Let's also have a test for Hadoop 1,69190790,2013-11-07 02:51:17
2394071,944921,7482409,36,"Yes, added  TestJobHistoryListener#checkHadoopVersionSet()",69190790,2013-11-07 06:29:39
2394071,918962,7483078,44,"If having subclasses inherit a common implementation is the goal, using an instance method is preferred (i.e. non-static). Using static methods for inheritance purposes is bit of an anti-pattern.",69366510,2013-11-07 06:57:27
2415663,48907,7541675,20,"We do not check for the exceptional case of having both hadoop1 and hadoop2 user names blank. It is ok if we believe that will never happen, but I see that we do check for this exceptional case in JobHistoryService.java ",69782546,2013-11-09 06:03:33
2415663,48907,7541792,67,"Seems that we can benefit from the following helper function:
getEither(Configuration, String[] candidateParams, String default),
which iterates over candidateParams and return the first that is not blank, or returns the default.",69782546,2013-11-09 06:09:11
2415663,944921,7542301,20,"That is a good observation. I will make it consistent across both place to check for this exceptional case, regardless of the current improbability. ",69782546,2013-11-09 06:31:41
2415663,944921,7542341,67,"Hmm, to move this out: there's not much else going on in this function. Even if this were moved to a helper function, it would still remain as this nested set of if checks. I'm open to ideas on how to make it cleaner.",69782546,2013-11-09 06:34:34
2415663,918962,7542625,28,"It seems like the same logic is repeated here and JobDescFactoryBase.create(). Also, we would want the same consistent username handling anywhere we need to retrieve the username, right? Would it make sense to isolate it into a utility method somewhere so",69782546,2013-11-09 06:52:24
2415663,944921,7543234,8,should add some javadoc for class description,69802168,2013-11-09 07:42:38
2415663,944921,7543240,51,Need to add javadoc here too,69802168,2013-11-09 07:42:57
2415663,918962,7543401,1,"Sorry to be picky, but we need the license here. :)",69803027,2013-11-09 08:00:18
2415663,918962,7543409,48,"Meant to say ""contains"" (not ""constains"")?",69803027,2013-11-09 08:00:56
2415663,944921,7549653,1,"Oh yes, we do! Will add it.. thanks! ",69803027,2013-11-11 02:06:43
2415663,944921,7549665,48,"Ugh, yes.. good catch! Changing it now",69803027,2013-11-11 02:09:33
2415663,1529651,7584249,25,"This method does a set, yet has a return value. That seems a little odd. Besides I think we don't need a username put, because that is already part of the key right ?",70329683,2013-11-12 14:10:56
2415663,1529651,7584280,54,"When you eliminate the setHravenUserNamePut, you don't need to pass in the hRavenUserName here, you can simply pass in the jobKey and extract user from that.
The javadoc should probably describe which argument is modified (namely the jobPut).",70329683,2013-11-12 14:14:26
2415663,1529651,7584349,25,"Weird, I commented on a different line (namely on the setHravenUserNamePut, not this one.
Here I'd say, just remove the hRavenUserName argument and derive it from the conf right here by using the ConfUtil.getUserNameInConf. That way you can eliminate the",70329683,2013-11-12 14:20:37
2415663,1529651,7584377,36,Nit: in many other such cases we just stored a constant called HRAVEN_QUEUE_BYTES and did the byte conversion once.,70329683,2013-11-12 14:23:03
2415663,1529651,7584457,25,jobKey.getUserName() should do the trick.,70329683,2013-11-12 14:30:19
2415663,944921,7597605,25,"Hi Joep, I think you were looking at an outdated commit. There is no setHravenUserNamePut function anymore. There is only one set method which is for the queue name. And it does not return anything. Also, as you have suggested, I am already getting the us",70329683,2013-11-12 23:40:48
2496195,1529651,7869162,4,"Why not store as enum ?
Perhaps even default to TWO (assuming that more and more folks will be migrating to Hadoop 2) ?",72397996,2013-11-23 04:08:03
2496195,1529651,7869181,12,This could simply return the enum itself couldn't it ?,72397996,2013-11-23 04:08:37
2496195,1529651,7869226,117,"Here you'd have to use a method on the Hadoop version enum to get an enum from a string.
It could also have a default (or could be null).",72397996,2013-11-23 04:10:31
2496195,1529651,7869260,234,"I'd change the order of the compare to avoid NPE if this.hadoopVersion is null.
Constants.HADOOP_VERSION.TWO.equals(this.hadoopVersion)
",72397996,2013-11-23 04:12:15
2496195,944921,7876956,234,I will change this but this won't throw an NPE since the getValueAsString returns empty string if not present in the hbase result,72397996,2013-11-24 03:43:55
2496195,944921,7876958,4,"Okay, will change this",72397996,2013-11-24 03:44:13
2559244,1529651,8202477,62,"I'm happy to reduce a lot of boilerplate code to use this method.
However, in other cases we have thrown a MissingColumnInResultException when a column is not there.
I think that is more appropriate then just returning a legal value for the long.

Thi",74074439,2013-12-09 23:36:49
2559244,1529651,8202503,89,Ditto comment: MissingColumnInResultException,74074439,2013-12-09 23:37:29
2559244,1529651,8202512,123,MissingColumnInResultException,74074439,2013-12-09 23:37:47
2559244,48907,8203432,28,"I am not if it is better to use the constants directly from the hadoop libs (such as JobConf.MAP_MEMORY_MB, ...) or it is better to redefine them in hRaven.",74074439,2013-12-10 00:02:46
2559244,48907,8203839,76,"I guess there must be a good reason to have two separate methods for extracting the long value: one directly from bytes and one after conversion to String. Nevertheless it would help if we document this reason. Also, one might consider combining these two",74074439,2013-12-10 00:14:21
2559244,48907,8204083,97,"Later in Line 99 we already check for existence of the qualifier. So, it seems that the check here is redundant.",74074439,2013-12-10 00:20:37
2559244,48907,8204298,44,It seems that Bytes.toBytes could be moved outside the loop.,74074439,2013-12-10 00:25:32
2559244,48907,8204362,43,I am confused about the purpose of the loop. Currently javaOpts is set based on only the last Put object in the jobConfPuts list. Is that what we wanted?,74074439,2013-12-10 00:27:27
2559244,48907,8204423,47,if javaOpts is blank printing it might not help. How about printing the qualifier's name instead.,74074439,2013-12-10 00:29:10
2559244,48907,8204609,65,"I am confused: if it is in bytes and we want to convert to MB, should not we divide it by 2^20 instead of 2^10?",74074439,2013-12-10 00:34:52
2559244,48907,8204657,53,"I am assuming the rest of this function is correct since I did not have a good idea how the input string would look like. For future readers of the code, it might help to put an example string as a comment.",74074439,2013-12-10 00:36:17
2559244,48907,8204862,76,How about making it final?,74074439,2013-12-10 00:42:20
2559244,48907,8205165,16,"Looking at the rest of the code, it seems that returning this -1L special value eventually leads to throwing an exception:
+ if (postPuts == null) {
+        throw new ProcessingException
If that an exceptional case, it might be a good idea to throw an",74074439,2013-12-10 00:51:09
2559244,944921,8206325,47,"Yes, will print the qualifier name",74074439,2013-12-10 01:19:41
2559244,944921,8206342,53,the comment exists on lines 65 and 66 in this function,74074439,2013-12-10 01:20:07
2559244,944921,8206496,43,"Right, I need to check for blank/initial value like in the other places where values are populated while iterating in a loop",74074439,2013-12-10 01:23:39
2559244,944921,8206499,44,will do,74074439,2013-12-10 01:23:47
2559244,944921,8206672,28,"Hmm, good question. Usually we redefine them so that we know which exact key we are looking for. If we use JobConf.MAP_MEMORY_MB and the key itself changes from ""mapreduce.map.memory.mb"" to ""something.mapreduce.map.memory.mb"", now we end up with different",74074439,2013-12-10 01:28:31
2559244,944921,8207374,62,"Yes, I thought about this too. A few things here. We are trying to get a value from the put, not from the hbase result. The column is not missing here, it's the value that is ""wrong"", since it was not converted to a long.. Also, this is very unlikely sinc",74074439,2013-12-10 01:47:05
2559244,944921,8208108,97,I was thinking about this.. I think I will remove the .has check and keep only the kvlist size > 0 check,74074439,2013-12-10 02:05:57
2559244,48907,8213117,53,Then I am confused about the lastChar logic. And also why split over space (Line 81)?,74074439,2013-12-10 04:26:43
2559244,944921,8213758,53,"the ""mapred.child.java.opts""  are the Java opts for the task tracker child processes. So say the conf file can contains ""mapred.child.java.opts"" : "" -Xmx1024m -verbose:gc -Xloggc:/tmp/@taskid@.gc"" . Now notice the last character for Xmx value is 'm', whic",74074439,2013-12-10 04:46:11
2559244,48907,8214211,53,makes sense. (and I guess the last cannot be 'k' or 'g'.),74074439,2013-12-10 04:57:56
2559244,48907,8214314,52,What if XmxStr.length < 1? Is it an error? Is it ok that we return 0L in this case?,74074439,2013-12-10 05:00:21
2559244,944921,8214682,53,"Actually, it can be.. it could be any of -Xmx:size[g|G|m|M|k|K]

http://docs.oracle.com/cd/E15289_01/doc.40/e15062/optionx.htm#i1027399
This means I need to divide accordingly, I will update this code.",74074439,2013-12-10 05:10:04
2559244,1529651,8215695,44,Would it make sense to overload the getStringValueFromPut util method to just pass in the string and have it do the Bytes.toBytes(qualifier part) ?,74074439,2013-12-10 05:40:08
2559244,1529651,8215795,54,"We should separate he logic that pulls -Xmx from a string from the code that deals with HBase puts etc.
That way we can have a separate and clean method that can be simply unit tested.
-Xmx could have an optional k or m (for kilo or MB) argument right ?",74074439,2013-12-10 05:44:38
2559244,48907,8305101,20,"Curious why not using Configuration.getLong(String name, long defaultValue)?",74300714,2013-12-12 23:35:27
2559244,48907,8305453,59,minor: @return xmx value in MB,74300714,2013-12-12 23:46:27
2559244,48907,8305780,87,"It might be a good idea to use ""default:"" to throw an exception here, rather than relying on 0L to represent such error.",74300714,2013-12-12 23:56:00
2559244,48907,8305896,84,How about uberized case mentioned in the comments at Line 112.,74300714,2013-12-13 00:00:20
2559244,48907,8305938,84,How about AM's memory mentioned at Line 111?,74300714,2013-12-13 00:01:43
2559244,48907,8306024,74,"At Line 122, we can that we do not want to throw an exception. But it seems that we still do it!",74300714,2013-12-13 00:03:57
2559244,48907,8306296,37,It seems that getMegaByteMillisPut never returns null!,74300714,2013-12-13 00:11:57
2559244,48907,8306368,59,minor: it appears that JobKeyConverter could be singleton.,74300714,2013-12-13 00:14:04
2559244,944921,8308542,20,"Oh cool, I didn't see this function. Will update the code to use it and remove this.",74300714,2013-12-13 01:19:15
2559244,944921,8308567,59,"yes, good idea to mention in the javadoc that it's returned in mb.. ",74300714,2013-12-13 01:19:57
2559244,944921,8308691,87,"So the jvm option will not accept anything other than K, G or M. It will throw an error. But let me add in a default option just to round off the bases.

$ java -Xmx1024Z k.java
Invalid maximum heap size: -Xmx1024Z
Could not create the Java virtual ma",74300714,2013-12-13 01:23:17
2559244,944921,8308739,74,"Hah, good catch, the comment is old... will update the comment! ",74300714,2013-12-13 01:24:26
2559244,944921,8308777,84,"Actually, again, the comment is out of context. It applies to hadoop2 but the function is for hadoop1 megabytemillis calculation. I will update the javadocs",74300714,2013-12-13 01:25:41
2559244,944921,8308884,59,"yes, could be, but as such that won't be part of this code fix since this change does not really affect the job key converter in any way.. ",74300714,2013-12-13 01:28:27
2559244,1529651,8309022,14,Appears to be the comment from the previous method.,74300714,2013-12-13 01:31:51
2559244,944921,8309138,14,"yes, I am updating all comments carefully now. ",74300714,2013-12-13 01:35:27
2559244,1529651,8310613,20,"Any reason not to make this a static final ?
There is not state captured in JobKeyConverter that would hurt re-use is there ?",74300714,2013-12-13 02:13:21
2559244,48907,8310698,87,"That sounds great! I was actually referring to the check later at Line 121:
if (Xmx75 == 0L) {
      LOG.error(""Xmx value is 0? check why"");
But I guess I now understand that the purpose of the check above is for accidental mistakes and 0L did not mean",74300714,2013-12-13 02:15:33
2559244,1529651,8310702,51,I'd use a lower case X for the arg name.,74300714,2013-12-13 02:15:41
2559244,1529651,8310904,35,"Would it make sense to turn the comparison around like so:
JobHistoryKeys.LAUNCH_TIME.toString().equals(JobHistoryKeys.HADOOP2_TO_HADOOP1_MAPPING.get(key))
or do we know for sure that JobHistoryKeys.HADOOP2_TO_HADOOP1_MAPPING.get(key) will never return ",74300714,2013-12-13 02:21:06
2559244,944921,8319358,27,"there are two new lines in part of the code, not sure why they got checked in, will remove them. they are not affecting anything, only blank new lines",74609471,2013-12-13 06:32:08
2559244,944921,8319371,33,Need to add the javadoc return value,74609471,2013-12-13 06:32:48
2812360,944921,8982071,28,"Just realized, the getJobName may return null and this may throw a NPE. Will update the pull request for this and other places",83583404,2014-01-18 05:12:00
2853868,944921,9065596,15,"Although the current code does not do this, we need to check if the jobtracker String is null/empty else the ""jobtracker.indexOf"" will throw an NPE. Also, will be good to have a unit test for the null/empty conf settings.",84429529,2014-01-22 12:31:53
2853868,944921,9065619,12,Maybe use StringUtils.isEmpty(jobtracker) instead of jobtracker == null. ,84429529,2014-01-22 12:33:39
2853868,393209,9065917,12,are we expecting hadoop 2 configuration to have JOBTRACKER_KEY set to empty?,84429529,2014-01-22 13:01:48
2853868,393209,9065953,15,"Added a check to protect against NPE. """".indexOf is fine.",84429529,2014-01-22 13:04:44
2933324,1127216,9474394,33,"Just about code style. This could be rolled into helper function where jobConf == null and LOG.info could be done once by passing Constancts.MAP_MEMORY_MB_CONF_KEY and Constants.REDUCE_MEMORY_MB_CONF_KEY. 

If not, jobConf == null can be check outside a",86872203,2014-02-06 02:31:50
2933324,944921,9474812,33,"Hmm..This is a generic void populatePut function. It's called for each string put that is generated. We don't need to check if job conf is null for each such put, there are jobs with 70k puts. If we did, then it would be 2 if checks for each put, one for ",86872203,2014-02-06 02:41:00
2933324,944921,9476453,33,Checking if I can modify the code a bit more to collapse things,86872203,2014-02-06 03:21:05
3033780,918962,9835074,38,I see some of these constants are not marked as final. I think it was not intentional? Please mark all of them final so they cannot change.,89024211,2014-02-19 01:33:16
3033780,944921,9835374,38,"Yes, they should be final. will change it, thanks! ",89024211,2014-02-19 01:40:11
3033780,918962,9835503,50,"If it is truly unused, I think it's okay to remove it (and introduce it later when it is needed).",89024211,2014-02-19 01:43:05
3033780,918962,9835643,65,I don't think it's possible?,89024211,2014-02-19 01:46:09
3033780,918962,9835815,26,"Please override hashCode() as well since you overrode equals(), especially if it is going to be used as keys for a hash-based data structures.",89024211,2014-02-19 01:49:34
3033780,918962,9835903,55,"Unnecessary ""}""?",89024211,2014-02-19 01:51:42
3033780,918962,9836091,39,"Nit: as a general practice, it's good to not use wildcard imports... They introduce all the classes in that package into the namespace even if you don't use them, and can create collisions that induce errors.",89024211,2014-02-19 01:55:22
3033780,918962,9836775,155,Time unit?,89024211,2014-02-19 02:09:53
3033780,918962,9836792,201,Time unit?,89024211,2014-02-19 02:10:21
3033780,918962,9837099,84,if (noRunId),89024211,2014-02-19 02:17:20
3033780,944921,9886720,155,"The + timer will log the time unit in seconds or milliseconds. For example, the line would appear something like this:
 In createFromScanResults For cluster someHadoopClusterName Fetched from hbase 20 rows, 200 columns, 24054 bytes ( 0) MB, in total time",89024211,2014-02-20 05:29:46
3033780,944921,9887960,26,"Yes, done. Also added unit tests for the same",89024211,2014-02-20 06:01:44
3033780,918962,9889508,85,This seems like a pretty weak version of hashCode(). How about using things like HashCodeBuilder to generate the hash code?,90224428,2014-02-20 06:46:55
3033780,944921,9889879,85,okay let me do that,90224428,2014-02-20 07:00:35
3146599,918962,10236977,23,Can be final...,92956384,2014-03-04 07:12:44
3146599,918962,10237014,40,"I suspect these are being added automatically by IDE, but they do not really describe the arguments, returned values, etc. It would be good to either add useful descriptions or remove them. There are more of these in other methods below.",92956384,2014-03-04 07:14:06
3146599,918962,10237063,49,"A simple primitive ""long"" type is fine. Although Long (object) would work as well, I don't think the object form is needed or helpful here.",92956384,2014-03-04 07:15:19
3146599,918962,10237107,90,"This is really a nit, but ""/**"" is reserved for javadoc comments. If you want to make a simple multi-line comment, you can open it with ""/*"" (single asterisk). More below.",92956384,2014-03-04 07:16:23
3146599,918962,10237221,128,"I don't quite understand this. The main thing is that we're reading the same index from prunedFileList as well as origList. If I'm reading this right, the indices on prunedFileList has no relation with the indices on origList. You'd skip files from origLi",92956384,2014-03-04 07:20:02
3146599,918962,10237242,176,Could be simply (!dirCreated),92956384,2014-03-04 07:20:43
3146599,918962,10237302,235,"The same can be easily achieved using the SimpleDateFormat. You could easily do

DateFormat df = new SimpleDateFormat(""YYYY/MM/dd"");
String formatted = df.format(new Date());",92956384,2014-03-04 07:22:46
3146599,918962,10237323,72,"Could simply be ""long"" (primitive).",92956384,2014-03-04 07:23:25
3146599,944921,10237582,128,"The intention here of looking for a i-1 or i+1 file is that, usually these files appear one after the other on disk. Hence we take a quick look to see if i+1 or i-1 is the conf file for this history file. If not, that's good, we add it to toBeRemovedFileL",92956384,2014-03-04 07:33:08
3146599,944921,10237607,49,"Sounds good, will make this and other changes mentioned",92956384,2014-03-04 07:34:04
3146599,918962,10307479,283,nit: if (moved != true) => if (!moved),93850992,2014-03-05 23:57:48
3146599,918962,10307569,129,"Took me a while to figure out that this is the file name of the conf. It might be good to rename this from ""fileName"" so it is clear what this is...",93850992,2014-03-05 23:59:59
3146599,918962,10307758,187,"Hmm, this won't work if anything is removed from prunedFileList.

The moment we call prunedFileList.remove(i), the index above i would shift down by one. So, this would surely throw an ArrayIndexOutOfBoundsException.

A safer approach to iterate when ",93850992,2014-03-06 00:04:28
3146599,944921,10309825,187,"Yes, let me add some tests for this and make the changes ",93850992,2014-03-06 00:51:17
3146599,944921,10309973,129,"Yes, I see that now, let me change the name to something better",93850992,2014-03-06 00:54:36
3146599,918962,10355028,172,"Now it no longer moves multiple files. It moves one file and one file only, right? Should it be named to relocateFile?",94154275,2014-03-07 01:57:40
3146599,918962,10355125,145,"The reason we can remove the job id once we looked at one file is because we expect no more than one file in this list for a given job id, right? I understand that because we discusses this, but it might be good to add comment here so it is clear.",94154275,2014-03-07 01:59:43
3146599,1529651,10370306,122,"Upside of moving large files out of the way is that we won't have to try to process them again in the next round.
However, keep in mind that for small files we don't actually move the files to HBase, we upload a copy. The original is kept in place to be ",94328408,2014-03-07 08:32:49
3146599,1529651,10370389,122,"Perhaps a workaround is to rig up a second JobHistoryServer looking at the new ""large file"" root, as long as we still maintain the same directory structure, it may be able to pick up the files there.
In that case we don't completely loose ability to have",94328408,2014-03-07 08:35:29
3146599,944921,10451146,122,"(Updating as per my chat with Joep). I thought about skipping files. The rationale about moving them to a different location on hdfs was, after the retention period is over, we would no longer have the file on hdfs if we were to skip them and leave them a",94328408,2014-03-11 03:21:46
3146599,944921,10453502,122,"
Would copying them to a different hdfs directory be reasonable (instead of move)? That way, we don't run the risk of losing the data and we also don't affect customer view of things. The downside is we keep two copies of such huge files for the duration",94328408,2014-03-11 04:16:28
3386473,1529651,11263135,45,"Let's see if we can use the last modification date of the file. That is really when the job completed, but is a whole lot closer than 0, which would mean that the job drops out of the view of most queries spanning a few days.
We'd also have a a lot of pr",100021257,2014-04-03 22:41:24
3386473,944921,11268027,45,"Sounds good, thanks.. Accordingly, I have updated the pull request with a getApproxSubmitTime function in job history raw service",100021257,2014-04-04 00:23:51
3386473,918962,11272476,40,Final? (AVERAGE_JOB_DURATION too?),100174397,2014-04-04 02:00:13
3530335,918962,11818082,58,"This input stream is not closed. We should follow a standard try-finally pattern for closing the input stream. With java 7, you could also do the try-with-resources pattern, but I don't think hraven requires java 7, so that's out of the question.",103851767,2014-04-21 23:07:16
3530335,918962,11819100,26,I think the multiple tests here are largely redundant as they all exercise the same formula and there is no difference in the way it works between these tests. Just live with one?,103851767,2014-04-21 23:27:10
3602681,944921,12122244,5,This is the only change to fix #81 ,106274925,2014-04-30 04:12:38
3602681,944921,12122258,17,This is being remove to fix #80 since queue is part of job conf,106274925,2014-04-30 04:13:11
3602736,944921,12123150,14,"if either start or end time is not passed in, it will default to 0. In the https://github.com/twitter/hraven/blob/master/hraven-core/src/main/java/com/twitter/hraven/datasource/JobHistoryService.java#L274 , if start/end times are 0, they are not added to ",106275215,2014-04-30 04:41:26
3706223,944921,12855296,29,This could be a problem if multiple jars of different versions are present for hraven-core and hraven-etl. Could we pick the latest? And also echo that we are picking the latest so that it's not done behind the scenes.,112330577,2014-05-20 22:02:56
3706223,944921,12855762,6,"Setting a default constant value inside a private function that is invoked with different keys at different places in the code is not a good idea. It can be set in Constants.java similar to DEFAULT_YARN_SCHEDULER_MIN_MB .
Also the next if for memoryMb ==",112330577,2014-05-20 22:12:08
3706223,393209,12917019,4,We should avoid this.,113025592,2014-05-22 00:26:51
3706223,944921,12918725,4,"So it looks like the default value for mapreduce.map.memory.mb is 1024 as per the settings in MRJobConfig.java 

So it does not seem like a good idea to set defaults to random values that one particular instance of hRaven might be using.  Do you see the",113025592,2014-05-22 00:59:25
3706223,1529651,12935353,6,"Why remove this check ?
If mapreduce.reduce.memory.mb is not found in the config, why silently return the mapper memory MB for that instead ? Do you find cases where the reducer memory was not set and you're getting exceptions ?",113025592,2014-05-22 10:23:45
3706223,3000812,12939454,4,"My bad indeed, i should have set it to the default config value. I just put this value arbitrary to make things work, i'm gonna correct this.",113025592,2014-05-22 13:23:00
3706223,3000812,12941076,6,"Hi, you're right. I just had the problem with a mapper, and I didn't handle the reducer. I'll change it to check if it's whether a map or a reduce key.",113025592,2014-05-22 14:14:07
3706223,944921,13160317,5,"A small correction. This could be rewritten as 
if (Constants.MAP_MEMORY_MB_CONF_KEY.equals(key)) {

Similarly for the reduce memory mb key. ",115192994,2014-05-29 03:33:46
3706223,944921,13344144,5,If key is null this will throw a NullPointerException. A better way to do this could be if (Constants.MAP_MEMORY_MB_CONF_KEY.equals(key)). Similarly for reduce memory mb. ,116233800,2014-06-03 21:28:34
3809874,944921,13317013,38,minor: I think this setting may be unnecessary since there isn't (yet) a custom serializer for TaskDetails. ,118705370,2014-06-03 07:26:12
3809874,944921,13317057,40,"minor: Any chance we could also include timer logging like other end points do? 
Stopwatch timer = new Stopwatch().start(), stop; etc ? Also log the number of tasks being returned (you can see how the other endpoints are logging). It is just very helpful",118705370,2014-06-03 07:28:24
3809874,230143,13318666,38,"My understand was that `@Path(""tasks/{cluster}/{jobId}"")` sets the URL of this REST endpoint, and `@Produces(MediaType.APPLICATION_JSON)` sets the `ContentType: application/json` in the header, both seem to be necessary?",118705370,2014-06-03 09:24:41
3809874,230143,13319128,38,"Oh sorry I realize now you mean the serialization context, I will look into it.",118705370,2014-06-03 10:04:00
3809874,944921,13344339,12,"Just curious, any particular reason these are being removed..",119292544,2014-06-03 21:31:52
3809874,944921,13344762,163,"I don't see a problem to keep this here, but would like to note that this won't be getting called from anywhere unless this Main() was invoked. ",119292544,2014-06-03 21:40:17
3809874,944921,13345049,41,"Minor: what I meant in the previous comment was adding a statement like: 
List<TaskDetails> tasks = jobDetails.getTasks();
if(tasks != null) { 
  LOG.info(""For endpoint /tasks/"" + cluster + ""/"" + jobId + "", fetched "" + tasks.size() + "" tasks, spent tim",119292544,2014-06-03 21:45:55
3809874,230143,13351977,12,Since they were duplicated between all the fetchFlow* methods I moved them to right before the URL call in `retrieveFlowsFromURL`,119292544,2014-06-03 23:47:32
3809874,230143,13352016,163,"Noted, I just wanted some way to run that code path :)",119292544,2014-06-03 23:48:14
3809874,230143,13352208,41,"Oops, added sorry.",119292544,2014-06-03 23:52:10
3809874,1529651,13516598,85,Overall looks great. Just wondering why an inner class ?,122788406,2014-06-07 05:46:06
3914506,1529651,13895872,7,"We should add a comment explaining how we're using the TTL here and why we're dropping older data.
It will be hard to infer from the code that there will be a column per job for each flow just so that we can check if we've see the job already to get an a",126924991,2014-06-18 06:25:02
3914506,1529651,13896188,78,"Either separately, or as part of the appSummaryService but we should probably add a column in the raw table info family to indicate whether or not we have done aggregation of this particular job.
That way we can process historic files, or at least know w",126924991,2014-06-18 06:40:06
3914506,1529651,14002000,44,"It is very confusing to call this runId.
This appears to suggest that we aggregate data within a run, which we don't.
We aggregate up to a day or week. So this field is a day or week.
aggregationId may be better, with explanation this could be a day, w",126924991,2014-06-20 05:22:30
3914506,1529651,14002619,146,do you mean to log appAggKey.toString ?,126924991,2014-06-20 05:45:17
3914506,944921,14003414,297,"After discussing with Joep, consider using checkAndPut for queues",132524788,2014-06-20 06:18:07
3914506,944921,14003473,296,need to take care of race condition here,132524788,2014-06-20 06:20:53
3914506,944921,14003655,300,"Also here, use checkAndPut for cost so that we don't run into race conditions",132524788,2014-06-20 06:29:08
3914506,1529651,14144806,15,Just realized that we need to make sure that we update the README.md as well.,132524788,2014-06-24 23:03:11
3914506,944921,14144937,15,"Yes, I need to draft up a section for aggregation, schema etc in README and update the project desc. ",132524788,2014-06-24 23:05:40
4023291,1529651,14387735,15,drop authors,132023153,2014-07-01 08:51:44
4023291,1529651,14387748,1,Need copyright header on all new files before we can accept them.,132023153,2014-07-01 08:52:40
4023291,1529651,14387803,4,Adding additional (optional) support sounds great. Here it looks like you are making a graphite sink the default.,132023153,2014-07-01 08:56:51
4023291,1529651,14387816,5,"you are referring to rmcuser, which as it seems from other pull requests, happens to be user that you use to run some of this.
What does userplatform mean ?",132023153,2014-07-01 08:57:29
4023291,1529651,14387826,5,"drop author, add head to all files please.",132023153,2014-07-01 08:58:46
4023291,1529651,14387832,13,"drop author, add head to all files please.",132023153,2014-07-01 08:59:10
4023342,944921,14330416,52,A minor improvement suggestion -maybe have a variable that stores the lastProcessRecord.getMaxModificationTimeMillis() since it is being called thrice in this code block? ,132027165,2014-06-29 22:30:16
4037083,918962,18475546,8,"Any reason you used ""hraven_..."" as the names of these new tables? Doesn't look like that is the naming convention followed by other tables?",132564212,2014-10-06 23:31:22
4037083,944921,20243052,8,"I think using an hraven prefix for table names is the better way ahead considering that the hbase datastore can contain tables from other applications as well.
For existing tables, renaming them now may be a bit more complex since hbase does not have a r",132564212,2014-11-13 02:22:20
4037083,918962,20395173,139,Is returning the object type Boolean necessary? I think it is just fine to use the primitive type (boolean). Using the object would unnecessarily cause boxing and unboxing and sometimes cause subtle bugs.,184507315,2014-11-15 06:52:48
4037083,918962,20395183,175,"I would suggest using simply ""false"".",184507315,2014-11-15 06:53:14
4037083,918962,20395210,191,"In this case, is the intent returning 0? Or do we want to throw an exception?",184507315,2014-11-15 06:53:55
4037083,918962,20395229,255,Would suggest Long -> long for the same reason as above.,184507315,2014-11-15 06:54:25
4037083,918962,20395270,287,"We had an offline discussion about not limiting this to 2 tries. What do you think?

Also, (status != true) -> !status",184507315,2014-11-15 06:55:37
4037083,918962,20395276,295,Same here,184507315,2014-11-15 06:55:46
4037083,918962,20395278,303,Same here,184507315,2014-11-15 06:55:55
4037083,918962,20395339,327,Double -> double,184507315,2014-11-15 06:57:29
4037083,918962,20395347,337,Same,184507315,2014-11-15 06:57:41
4037083,918962,20395389,463,Long ... = null -> long ... = 0;,184507315,2014-11-15 06:58:58
4037083,918962,20395439,18,final,184507315,2014-11-15 07:00:18
4037083,918962,20395446,34,Long -> long,184507315,2014-11-15 07:00:28
4037083,918962,20395494,42,"A recommended pattern for logging exceptions is

LOG.error(""<your message>"", exception);

This includes the stack trace so you can remove the following line as well.",184507315,2014-11-15 07:01:51
4037083,918962,20395586,48,Same here,184507315,2014-11-15 07:05:05
4037083,918962,20396037,51,Boolean.FALSE -> false,184507315,2014-11-15 07:13:32
4037083,918962,20396054,59,Boolean.TRUE -> true,184507315,2014-11-15 07:13:47
4037083,918962,20396065,67,ditto,184507315,2014-11-15 07:13:58
4037083,918962,20396075,75,ditto,184507315,2014-11-15 07:14:12
4037083,918962,20396079,14,Long -> long,184507315,2014-11-15 07:14:25
4037083,918962,20396086,133,Long -> long,184507315,2014-11-15 07:14:45
4037083,918962,20396099,46,"Boolean.FALSE -> false

(and more of that in the file)",184507315,2014-11-15 07:15:11
4037083,918962,20396166,48,Long -> long,184507315,2014-11-15 07:17:35
4037083,918962,20396199,123,"could be simply

if (reAggregationFlag || (aggregationFlag && !rawService.getStatusAgg(...)))",184507315,2014-11-15 07:18:49
4037083,918962,20396482,104,"Although it is existing code, it makes me wonder. If this threw an exception, can you proceed to the next? I would think newAppsKeys is null, and you'd get a NullPointerException in line 117.",184507315,2014-11-15 07:27:12
4037083,944921,20449584,42,"Actually, this isn't throwing the exception, it is only logging it, hence the ""+"" ",184507315,2014-11-18 00:22:25
4037083,918962,20451385,42,"Right. I wasn't suggesting that it is throwing an exception. It's regarding a recommended logging pattern when you have an exception object on hand. LOG.error("""", exception) does not throw the exception.",184507315,2014-11-18 00:51:31
4037083,944921,20457229,104,"I looked through the code again, it looks like the function createNewAppKeysFromResults will always return a non-null list (either empty or populated). And I also see some ""Long"" objects there which can be changed to ""long"" ",184507315,2014-11-18 02:17:00
4037083,944921,20473082,191,Added throwing exception (line below),184507315,2014-11-18 06:03:06
4037083,944921,20473340,8,I modified the table names to be prefixed with job_history so that it is more consistent with other hraven tables ,132564212,2014-11-18 06:07:39
4037083,918962,20616408,55,final?,184507318,2014-11-20 06:22:26
4037083,918962,20617598,369,"Let's wrap it with

if (LOG.isTraceEnabled()) {
...
}",184507318,2014-11-20 06:44:41
4037083,918962,20619451,459,if (LOG.isTraceEnabled()),184507318,2014-11-20 07:21:21
4037083,918962,20619494,515,if (LOG.isTraceEnabled()),184507318,2014-11-20 07:22:23
4138214,1529651,14850739,1,Note Vulture in the commit comment as well as in the top-level directory name.,136635572,2014-07-12 06:25:17
4138214,1529651,14850741,1,Minor nit: 2014 ?,136635572,2014-07-12 06:25:39
4138214,1529651,14850748,34,"Grep for hadoopJobMonitor and also in comment ?
May want to do a grep -R for ""ulture"" through the entire directory tree.",136635572,2014-07-12 06:26:43
4138214,1529651,14850779,42,"Use jmxterm-1.0-alpha-4 and pull this in through Maven, rather than checking a binary in ?",136635572,2014-07-12 06:31:17
4138214,1529651,14850788,22,VULTURE env variable. change to HADOOPJOBMONITOR ?,136635572,2014-07-12 06:32:12
4138214,1529651,14850835,26,"Need to add a comment here that if your internal version of Hadoop has different counters, that the rest call that pulls task stats will fail to work properly due to counters not translating to enums correctly.",136635572,2014-07-12 06:40:32
4138214,1529651,14850844,21,"We need to probably match this with the rest of the hRaven release and/or figure out how we put this in the assembly w/o running into trouble with different versions of Hadoop. Perhaps having two profiles ?
One way or the other we need to make sure that ",136635572,2014-07-12 06:42:06
4138214,48907,14914694,42,"There is a bug with that version: https://bugs.launchpad.net/jmxterm/+bug/1240813
jmxterm is not a very stable solution. It is more of a temporary approach to be replaced in future.",136635572,2014-07-15 07:12:55
4687507,1529651,18005481,12,"Change looks great. Let's add a unit test case where we grab a 2.4 history file, anonymize it, and add it to confirm we can get these new stats out. ",157472117,2014-09-25 03:43:45
4687507,944921,18115315,12,"Sounds good, added a test case and a file",157472117,2014-09-27 02:36:16
5208263,918962,20390392,18,I thought that JobId.JOB_PREFIX.equalsIgnoreCase(prefix) is not needed?,184190882,2014-11-15 05:09:17
5208263,918962,20392929,18,"Given that JobId never has prefix = JOB_PREFIX, can't we remove the latter check?",184190882,2014-11-15 05:56:20
5208263,918962,20392970,14,checkVersions -> checkHistoryFileTypes?,184190882,2014-11-15 05:57:24
5208263,918962,20392986,25,version -> historyFileType?,184190882,2014-11-15 05:57:49
5208263,918962,20393035,14,getVersion -> getHistoryFileType?,184190882,2014-11-15 05:58:45
5208263,918962,20393049,36,version -> historyFileType?,184190882,2014-11-15 05:59:05
5208263,918962,20393055,46,Ditto,184190882,2014-11-15 05:59:13
5208263,918962,20393060,55,Ditto,184190882,2014-11-15 05:59:20
5208263,918962,20393069,5,Ditto,184190882,2014-11-15 05:59:31
5208263,918962,20393081,5,Ditto,184190882,2014-11-15 05:59:40
5208263,918962,20393090,6,Ditto,184190882,2014-11-15 05:59:50
5208263,918962,20393099,11,Ditto,184190882,2014-11-15 06:00:08
5208263,944921,20393446,36,"Okay, I need to do one more pass for version. ",184190882,2014-11-15 06:09:09
5208263,944921,20393525,14,"Yes, I think all the unit tests need to be renamed to reflect version to filetype naming change",184190882,2014-11-15 06:11:28
5208263,918962,20620624,75,"Out of curiosity, how is this number (21) derived?",184311001,2014-11-20 07:50:14
5208263,918962,20620640,41,hadoopVersion -> fileType maybe? :),184311001,2014-11-20 07:50:43
5208263,918962,20620682,48,"This first null check is not necessary, as String.equalsIgnoreCase() checks for null and returns false if it is false.",184311001,2014-11-20 07:51:45
5208263,918962,20621054,45,"Nit: in java this style of if conditions is not necessary as there is no risk of accidental assignment. It should be plain 

if (historyFileType == null) {",184311001,2014-11-20 08:00:22
5208263,918962,20621130,67,"The extra space is not needed. The logger adds "":"" at the end of the message followed by the exception's message.
",184311001,2014-11-20 08:01:54
5208263,918962,20621133,76,Ditto,184311001,2014-11-20 08:02:01
5208263,918962,20621199,19,Nit: I believe the hRaven coding style (which is the same as Hadoop's) is to always use the braces for if's....,184311001,2014-11-20 08:03:49
5208263,918962,20621226,48,Long -> long,184311001,2014-11-20 08:04:34
5208263,918962,20621284,67,"Nit: it can be expressed more concisely as

for (Map.Entry<String,JsonNode> field: rootNode.getFields()) {
  // job history keys are in upper case
  ...",184311001,2014-11-20 08:06:07
5208263,918962,20621316,145,Long -> long,184311001,2014-11-20 08:07:12
5208263,944921,20670928,67,"I see, didn't know, thanks.. will remove it where ever I see it next ",184311001,2014-11-21 02:29:51
5208263,944921,20671387,67,"Yes, I think so too. But rootNode is a JsonNode object and that has .getFields which returns an iterator. The other two methods it has are .getKey or .getValue. It has .get which needs an index number to passed in. It does not have a get function which re",184311001,2014-11-21 02:36:48
5208263,944921,20671540,145,"Yes, I could not change that one since the Interface had that Long as the return type. Also in the getMegaByteMillis in other parsers, there are places where null is being returned (which can be changed to return 0 but that would be several more changes i",184311001,2014-11-21 02:39:26
5208263,944921,20671554,19,"yes, fixed",184311001,2014-11-21 02:39:42
5208263,944921,20671654,45,fixed,184311001,2014-11-21 02:41:23
5208263,944921,20671707,48,fixed,184311001,2014-11-21 02:42:05
5208263,918962,20671976,67,"Ah, I thought (mistakenly) getFields returned an Iterable, in which case the enhance for syntax applies. I should have looked more carefully. NVM.",184311001,2014-11-21 02:45:55
5208263,918962,20671984,145,Got it. Thanks.,184311001,2014-11-21 02:46:08
5208263,944921,20672120,5,(communicated with Sangjin offline) keeping this one as versionPut since we would explicitly like to indicate that this is a hadoop version related put ,184190882,2014-11-21 02:48:06
5208263,944921,20672761,75,"(Will add a comment in the code as well), since spark job keys have a prefix of ""spark"", it is 5 + regular job key length (which is 16 (epoch and seq), hence spark job key length is 21.",184311001,2014-11-21 02:56:28
5521024,918962,21783146,13,"Nit: might be bit easier to read the code it this is named something like ""processed"" or ""alreadyProcessed"". ""Success"" seems a little confusing.",186314755,2014-12-13 07:38:52
5521024,918962,21783180,28,We can return here instead of line 502.,186314755,2014-12-13 07:40:05
5521024,918962,21783227,21,"Nit: this could simply be
    isThisAttemptTheFirst = attemptid.endsWith(""0"");",186314755,2014-12-13 07:41:36
5521024,1529651,21851227,29,"Probably best to capture only the kinds of exceptions that can be thrown by the code you run.
Let's make sure that we don't catch other exceptions such as InterruptedException, or OOME's.",193891713,2014-12-16 02:50:08
5521024,1529651,21851387,7,"Explain that if processing fails this method returns false. The current use-case of re-processing in case we're not sure is ok with this, but we should make the behavior explicit / future use-case proof.",193891713,2014-12-16 02:52:19
10469411,918962,45402048,32,It still seems unused?,346039400,2015-11-20 04:21:20
10469411,918962,45402768,41,It looks like creating a simple hRavenModule is repeated in a few other places. It might be better to extract it into a method and call it instead.,346039400,2015-11-20 04:27:26
10469411,918962,45403161,96,"This comment is not correct, right?",346039400,2015-11-20 04:30:21
10469411,918962,45403324,79,"Any reason this has to be public, or can it become private? The same for JobDetailsSerializer.",346039400,2015-11-20 04:31:44
10469411,918962,45404063,30,How does this work? Do we just concatenate all the fields in this param without any delimiters?,346039400,2015-11-20 04:37:23
10469411,918962,45404290,116,builderIncludeFlowFields looks identical to builderIncludeJobRegex? You meant to process includeFlowFields here?,346039400,2015-11-20 04:39:11
10469411,918962,45404545,192,Same here (builderIncludeJobFields is identical to builderIncludeFlowFields).,346039400,2015-11-20 04:40:59
10469411,918962,45404984,290,Same issue here.,346039400,2015-11-20 04:44:21
10469411,918962,45405179,16,I think you meant to use java.util.Arrays.,346039400,2015-11-20 04:45:40
10469411,918962,45403366,151,Comment misplaced?,346039400,2015-11-20 04:32:08
10469411,918962,45806090,304,"Is this ""includeFlowField"" or ""include""?",350406836,2015-11-25 05:43:13
10469411,918962,45806172,359,"You want to use buildParam() here too, right?",350406836,2015-11-25 05:43:55
10469411,7706318,45678380,79,"The other serializer classes have been public, hence continued to have these as public classes. If I make the JobDetailsSerializer class, then the hRavenRestClient class complains at line 504 https://github.com/twitter/hraven/pull/141/files#diff-d6dfbdd20",346039400,2015-11-24 07:41:29
10469411,7706318,45673617,41,"Sounds good, will do ",346039400,2015-11-24 06:55:38
17931707,918962,83521664,11,"While we're at it, we should probably mention the java 8 requirement in README.md.",534683557,2016-10-15 07:52:09
17931707,1529651,83522766,11,"Good point, I'll update that and push a change to the PR.",534683557,2016-10-15 08:28:52
17947368,7706318,83694859,38,"I think the indentation may be a bit off, but it's nothing major. I will edit it later when I am updating things for a final merge. ",535108220,2016-10-18 00:38:29
23187969,94390,110760847,68,let's move it to debug.,664140153,2017-04-11 03:53:48
23187969,6636815,110764914,68,sure,664140153,2017-04-11 04:13:14
23187969,7706318,110765394,68,"Yes, chatted with Piyush offline. We can change the default one using compression to debug mode and keep the ""not using compression"" in info mode",664140153,2017-04-11 04:15:36
1728601,266382,5081955,4,"Hmm, interesting idea but not type safe. I think I'd recommend this:

    case class Config(interface: String = ""localhost"", port: Int = 8080)

That gives you type safe config with defaults all in one spot.",48199168,2013-07-09 09:02:07
1728601,266382,5082044,25,"Nice, I like this approach a lot. Suggestion, use `Seq` matchers instead of `List` matchers, so you don't have to convert the `args` array to a list:

    import annotation.tailrec

    @tailrec
    def parseConfig(config: Config, args: Seq[String]):",48199168,2013-07-09 09:15:27
1728601,266382,5082696,5,Don't worry about this; @christy13 is changing it as part of issue #6.,48205781,2013-07-09 10:53:34
1728601,266382,5082705,14,See above.,48205781,2013-07-09 10:54:06
1728601,266382,5082712,12,Delete.,48205781,2013-07-09 10:55:11
1743098,266382,5102190,8,"I know this is common Twitter style, to curly-brace the shit out of everything, but I don't like it :P",48242594,2013-07-10 02:16:16
1745152,480242,5105438,46,"I prefer something like ""content: %s url: %s"".format(request.entity, request.uri).replaceAll(""\n"", """")

But that might be bikeshedding it a bit. Otherwise lgtm",48248951,2013-07-10 04:56:10
1745152,266382,5106087,32,"+1 to @andrewnguyen, I think :)

Also, we want to log *all* requests, not just the assets route. So you'll probably want to do something like:

    val route = logRequest(showRequest) { assetsRoute ~ markdownRoute ~ interpreterRoute }",48248951,2013-07-10 05:46:15
1745152,2222744,5106224,32,"Removing ""_"" cause compile error, as the function showRequest needs a parameter.

The logRequest is logging all requests, as it is in front of assetsRoute which filters all traffic. Moving to front of the train makes it cleaner though. Will do.",48248951,2013-07-10 06:03:12
1745152,480242,5105417,32,!DAN! says the _ might not be necessary,48248951,2013-07-10 04:54:19
1760811,266382,5155850,29,"Not quite the right wording here, but I'll go back over it later.",48557552,2013-07-12 04:37:29
1760811,266382,5155798,19,"if you're just testing the assets route, then use `assetsRoute` here.",48557552,2013-07-12 04:33:29
1760811,141103,5155789,19,"Yeah when the slash is omitted you get a fun error when it can't find it:
    The reference was null (ContentSpec.scala:23)",48557552,2013-07-12 04:33:09
1760811,266382,5155787,7,alphabetize,48557552,2013-07-12 04:32:56
1760811,266382,5155774,35,this still cray,48557552,2013-07-12 04:32:24
1760811,266382,5155769,32,I think you want this `mainFile` thing to be the `markdownRoot` that all tests share,48557552,2013-07-12 04:32:10
1760811,266382,5155688,27,Still should be factored out.,48557552,2013-07-12 04:27:42
1760811,266382,5155675,19,"If the initial slash is actually necessary (which it might not be), don't hardcode it. Do what you had before to determine the path separator.",48557552,2013-07-12 04:26:42
1760811,266382,5155660,20,"Misleading name... It's not a route, it's a root. Canadians.",48557552,2013-07-12 04:25:46
1760811,266382,5155617,9,this isn't the version of scalatest we're using :P,48557552,2013-07-12 04:21:51
1760811,266382,5152820,5,"Maybe consider making three of these:

    ""The assets route"" should { ... }
    ""The markdown route"" should { ... }
    ""The interpreter route"" should { ... }",48557549,2013-07-12 02:06:10
1760811,141103,5152780,20,I took it from Document.scala thought I'd keep it consistent,48557549,2013-07-12 02:04:23
1760811,266382,5152741,6,unused?,48557549,2013-07-12 02:02:52
1760811,266382,5152737,20,don't think you need this,48557549,2013-07-12 02:02:43
1760811,266382,5152725,24,"extract `getClass().getResource(""markdown"")` into a helper `val markdownRoot`",48557549,2013-07-12 02:02:21
1760811,266382,5152695,36,there's got to be a better way to do this :P,48557549,2013-07-12 02:01:16
1760811,266382,5152655,15,"For higher-order functions like `flatMap`, `filter`, `collect`, etc., it's common style to use infix operator syntax like:

    foos flatMap { foo =>
      ...
    }

In other words, no dot. Same comment applies to l29 and l34.",48557549,2013-07-12 02:00:06
1760811,266382,5152590,42,newline,48557549,2013-07-12 01:58:07
1760811,266382,5152578,15,"Don't need to convert to `List`; just have this method return `Seq[File]` instead (which should be ok with the `Array[File]` you get back from `listFiles`.

Also, use parentheses for `listFiles()` to indicate it's not a pure function.",48557549,2013-07-12 01:57:38
1760811,583486,5151858,4,?,48368159,2013-07-12 01:32:35
1760811,141103,5155913,53,It's an odd Option[HttpHeader].   Evil I tell ya.,48557552,2013-07-12 04:43:08
1760811,266382,5155867,53,What's the `.value.value` stuff about? Is it like a `Future[Option[String]]` or something?,48557552,2013-07-12 04:39:03
1776954,266382,5156955,38,"Oh, I think I like `receiveOne` better than `within`+`expectMsg`. But leave a timeout, just so Travis builds don't hang. In principle these requests should be handled very quickly, but ... :trollface:",48597451,2013-07-12 06:00:43
1776954,266382,5156938,28,"You can't reuse the interpreter between tests, unfortunately, since it's stateful. Need to spin up and then kill an interpreter for each test (see the example I wrote).",48597451,2013-07-12 05:58:37
1776954,266382,5156914,27,Is this change needed?,48597451,2013-07-12 05:55:55
2128969,181457,9457729,32,"You can too add the link to demo project
http://twitter.github.io/interactive/emmys2013
it's the same path for each project

:+1: 

  ",58334889,2014-02-05 18:33:46
2035766,2221968,6138320,30,Should assert on filteredBatches.  Also the contains check implies the isEmpty check,57780155,2013-09-04 02:13:38
2035766,44018,6138335,30,"good call, thanks for the catch.",57780155,2013-09-04 02:14:03
2035766,7111,6138403,27,"don't you mean, .last?",57780155,2013-09-04 02:16:14
2035766,44018,6138453,27,"ugh, yes. fixed.",57780155,2013-09-04 02:18:08
2035766,7111,6138518,28,"want to go ahead and put, .sorted here? It also needs to be sorted.",57603055,2013-09-04 02:20:31
2035766,7111,6138663,6,"seems in conflict with the versionsToKeep.

Shouldn't we takeRight(versionsToKeep)?",57603049,2013-09-04 02:25:26
2035766,2221968,6138673,28,"All of this requires that batches is already sorted (the .last here and in the VersionedStore, and the existing progression?).  I had assumed it was guaranteed to be sorted already.  If this is not the case, maybe it should just be sorted at the top?",57603055,2013-09-04 02:25:44
2035766,2221968,6138761,6,"I think the spirit of versionsToKeep allows that it isn't necessarily the last as many versions.  For Ouroboros, we'd definitely want the ability to compute just one new one (the most recent) at a time, while keeping a history of a few checkpoints.",57603049,2013-09-04 02:29:28
2035766,7111,6138826,6,Fine by me.,57603049,2013-09-04 02:31:40
2066688,568000,6220500,19,i think this comment is wrong?,57691040,2013-09-07 02:28:03
2069930,44018,6253257,8,"What do you think of making BatchID a sealed trait:

```scala
sealed trait BatchID
case class LongBatch(id: Long) extends BatchID
case object UnitBatch extends BatchID

object BatchID {
  def apply(id: Long) = LongBatch(id)
  val unit = UnitBatch",57827669,2013-09-10 03:32:51
2069930,44018,6253277,12,This is weird. Why not just ignore the input?,57827669,2013-09-10 03:33:40
2069930,44018,6253298,20,So we're riffing on the 1L upper bound... the whole unit batcher idea is getting more strange.,57827669,2013-09-10 03:34:40
2069930,44018,6253329,27,Doesn't `batchesCoveredBy(totalBatchInterval)` return `Empty`?,57827669,2013-09-10 03:35:49
2069930,44018,6253345,29,Don't we have that ExclusiveUpper type you mentioned?,57827669,2013-09-10 03:36:29
2069930,44018,6253358,4,rename to earliestIs_<=,57827669,2013-09-10 03:36:58
2069930,7111,6256588,8,"We would break the sequencing (prev, next), etc...",57827669,2013-09-10 07:46:32
2069930,7111,6256594,12,"If you are talking about other batches, you probably have a bug. I don't want to hide it. I can imagine throwing here.",57827669,2013-09-10 07:47:15
2069930,7111,6256598,20,"it isn't changing, it's just being subjected to tests it was failing.",57827669,2013-09-10 07:47:54
2069930,7111,6256616,27,That does not type check. Rephrase?,57827669,2013-09-10 07:49:53
2069930,7111,6256659,29,good call.,57827669,2013-09-10 07:56:40
2069930,7111,6256679,8,Think this is too big a change for this one. Not sure we can make it work without really replumbing all the logic of the unit batcher.,57827669,2013-09-10 07:58:44
2069930,7111,6256702,12,"Also, in some real sense, this is accurate. The unit batcher puts everything in Batch(0). All batcher have some intervals of time that are unoccupied. For instance BatchID(Long.MaxValue) is almost never occupied. What should we return there?

I think Em",57827669,2013-09-10 08:01:40
2069930,44018,6257842,27,"Hey, sorry. I thought that batchesCoveredBy was an interval, and it looked like a bug that passing that particular interval into batchesCoveredBy would return Empty... but I see that I'm goofing the types.",57827669,2013-09-10 10:32:45
2082086,44018,6275443,24,typo,57904731,2013-09-11 00:08:45
2111273,7111,6443362,26,let's go ahead and get a sealed trait and name the cases here. I think cons-celling Either's is harder to read.,58264628,2013-09-19 00:10:30
2111273,7111,6443444,71,weird name. Looks like foldr. How about andThen?,58264628,2013-09-19 00:13:57
2111273,319889,6443479,51,Is it safe to call remove without a synchronized here?,58264628,2013-09-19 00:15:01
2111273,44018,6443482,71,"it's unused, I'll delete.",58264628,2013-09-19 00:15:03
2111273,44018,6443505,51,This code is copy pasted straight out of Storm. it's a Marz special.,58264628,2013-09-19 00:15:48
2111273,7111,6443519,95,isn't this folder?,58264628,2013-09-19 00:16:18
2111273,7111,6443538,107,I think the case class OptionMapItem(op) would be more readable.,58264628,2013-09-19 00:17:05
2111273,7111,6443593,4,"can you comment on this change? Seems orthogonal, but I'm not 100% sure. It's okay to include it here, I just want to understand.",58264628,2013-09-19 00:18:48
2111273,44018,6443735,4,"It's unnecessary to have a special name for the sink, now that we allow NamedProducers to stack after the final sumByKey.",58264628,2013-09-19 00:24:07
2111273,44018,6443799,26,done,58264628,2013-09-19 00:26:41
2111273,44018,6443806,95,"meant to delete, no reason for a special func.",58264628,2013-09-19 00:26:53
2111273,7111,6443876,4,Cool. Glad to have the jank out.,58264628,2013-09-19 00:30:14
2111273,7111,6444042,121,"```scala
LeftJoinedProducer(producer, StoreWrapper(storeSupplier)) =>
```
might be cleaner. Up to you.",58226898,2013-09-19 00:35:41
2111273,44018,6444131,121,will do.,58226898,2013-09-19 00:39:36
2111311,7111,6443666,5,"not crazy about this. We already have the get method, can you just expose the keys?

```scala
def nodes: Set[Producer[P, _]] = graph.keys
```",58263851,2013-09-19 00:21:31
2111311,7111,6443711,27,"`.dependantsOf(n).getOrElse(Set[Producer[P, _]]())`

on the Dependants object (if we keep the one you construct).",58263851,2013-09-19 00:23:13
2111311,7111,6443736,22,Why wrapping in this object?  Let's lift the case class VizGraph out.,58263851,2013-09-19 00:24:09
2111733,7111,6449260,230,rather this be: `must beTrue`,58272848,2013-09-19 03:36:32
2113094,319889,6464997,6,Max line length?,58304405,2013-09-19 21:25:34
2113094,319889,6465018,8,Should be noted these are OSX specific instructions,58304405,2013-09-19 21:26:16
2113094,44018,6465041,6,I'd rather let the browser do fluid wrapping.,58304405,2013-09-19 21:26:59
2113094,44018,6465054,8,fixed,58304405,2013-09-19 21:27:33
2113094,319889,6465070,19,"I'd leave this out, or point them at a tarball release/master, having new people go straight for develop however stable probably isn't ideal?",58304405,2013-09-19 21:28:03
2113094,44018,6465104,19,"sure, I'll add git checkout master",58304405,2013-09-19 21:29:01
2113094,44018,6465119,19,"actually, since we now have tests, I'd rather keep this, and just keep the documentation up to date. We have the same responsibility on develop to keep the docs current.",58304405,2013-09-19 21:29:49
2113094,44018,6465128,19,"AND they're reading this on the develop branch, so any pull req that changes this will come with accompanying code. If we point to master, the develop README will fall out of sync.",58304405,2013-09-19 21:30:16
2113112,7111,6465267,5,private,58280723,2013-09-19 21:34:47
2113112,7111,6465277,4,comment: //Lut == Lookup Table,58280723,2013-09-19 21:35:03
2113112,7111,6465282,5,"Also, make it a val. It is constant.",58280723,2013-09-19 21:35:20
2113112,7111,6465348,24,"val (nodeLUT, name, LUT) = curLut",58280723,2013-09-19 21:37:46
2113112,7111,6465374,28,don't need the curlies here.,58280723,2013-09-19 21:38:37
2113112,44018,6465400,4,Or just name it NameLookupTable,58280723,2013-09-19 21:39:43
2113112,7111,6475272,28,can we use n :: dependenciesOf to be sure that is O(1)?,58280724,2013-09-20 03:29:58
2113112,7111,6475353,51,"no need start.toList, right?",58280724,2013-09-20 03:32:53
2113112,7111,6475398,58,case IdentityKeyedProducer(_) =>,58280724,2013-09-20 03:34:44
2113112,7111,6475468,60,"can you add a comment:
// Compute the lines and new names for the nextNode",58280724,2013-09-20 03:38:07
2113112,7111,6476038,46,"`:+` is O(N) on List. Want this to be O(1) else the whole algorithm goes to O(N^2) and we probably care about that.

let's do `h :: deps`",58280726,2013-09-20 04:08:05
2115772,44018,6497932,194,typo,58352436,2013-09-21 02:05:37
2115772,7111,6498187,67,remove (),58352442,2013-09-21 02:16:40
2115772,7111,6498217,82,macro would be good for these repeated methods.... 2.10...,58352442,2013-09-21 02:18:08
2115772,7111,6498244,119,what do you mean forward and reverse? Can you comment here? Is it data flow direction or dependency direction?,58352442,2013-09-21 02:19:12
2115772,319889,6498794,119,"Replacing with dependsOn, and dependantOf maps. And including a comment for clarity",58352442,2013-09-21 02:45:40
2115772,319889,6498885,82,Yeah its kind of frustrating that they can't be pushed into the trait or otherwise better cleaned up. I moved most of those helpers into the copies so at least they are straight copy and paste now,58352442,2013-09-21 02:50:59
2115772,7111,6500166,227,add comment here to explain it more.,58352444,2013-09-21 04:11:14
2115772,7111,6500233,227,Change to boolean: `mergeableWithSource()`?,58352444,2013-09-21 04:17:49
2115772,7111,6503153,19,"are any of these used? (storm imports)?

Can you audit and remove anything unnneed? It will make it easier to think of using this on other platforms.",58352425,2013-09-21 22:50:25
2115772,7111,6503155,40,don't think this is used,58352425,2013-09-21 22:50:48
2115772,7111,6503158,149,do we still need this in here? I think it probably belongs elsewhere.,58352425,2013-09-21 22:51:49
2115772,7111,6503159,157,elsewhere.,58352425,2013-09-21 22:51:56
2115772,7111,6503162,196,registry is a set. Why the reverse?,58352425,2013-09-21 22:53:32
2115772,7111,6503164,192,"explain the intent of this class, please.",58352425,2013-09-21 22:54:19
2115772,7111,6503165,209,confusing name since Topology means something in storm and this class is unrelated to it. Maybe DagBuilder?,58352425,2013-09-21 22:55:00
2115772,7111,6503173,213,"this is weird that you have two apply methods that return two different types. They should either be renamed, or return one type.

For apply, I think it works for Function-like objects (one return type), or constructor-like methods (return an instance o",58352425,2013-09-21 22:57:19
2115772,7111,6503175,213,"Wait, got cusfused by the inner class with a lowercase name.",58352425,2013-09-21 22:57:57
2115772,7111,6503178,218,let's make this a function that returns the StormRegistry. Would that work? These methods can still be inner functions defined as they are.,58352425,2013-09-21 22:59:10
2115772,7111,6503179,224,make this the final return of the buildReg function.,58352425,2013-09-21 22:59:27
2115772,7111,6503180,305,add a TODO with a link to a github issue (support self merges in the Dot-planner).,58352425,2013-09-21 23:00:36
2115772,7111,6503183,285,"same TODO. I think this is solvabale pretty easily: replace (x ++ x) with x.flatMap { t => Set(t, t) }. When we make the big list of merges at the head of a FlatMap node, all of them need to be distinct actually. If anything is repeated, we need to do the",58352425,2013-09-21 23:02:47
2115772,7111,6503186,260,"rename: maybeSplitThenRecurse.
Take the outerProducer as the second parameter and keep the logic of outerProducerMergableWithSource local to the method. This makes it easier to understand by reading this method as a unit.",58352425,2013-09-21 23:06:10
2115772,7111,6503201,245,"make two functions here:

// one node, NOT recursive through dependencies
def mergableWithSource(dep: Prod[_]): Boolean
def allDepsMergeableWithSource(d) = mergebaleWithSource(p) && Producer.dependencies(p).forall(allDepsMergeableWithSource)

Thes y",58352425,2013-09-21 23:14:23
2115772,7111,6503207,264,put parens in the boolean so people can be sure they read the precedence correctly. I always get nervous here.,58352425,2013-09-21 23:16:27
2115772,7111,6503228,90,why not add this strings in genClusters? I don' see that fn is recursive.,58352425,2013-09-21 23:23:00
2115772,7111,6503232,36,make this a private fn to make it a bit more readable.,58352425,2013-09-21 23:24:33
2115772,7111,6503237,62,why two spaces here?,58352425,2013-09-21 23:26:04
2115772,7111,6503245,96,Let's rename this the companion to VizGraph.,58352425,2013-09-21 23:28:14
2115772,7111,6503248,100,can we get an apply(Producer): String? This will be good for putting in configs.,58352425,2013-09-21 23:29:07
2115772,7111,6503254,255,"Add something like:

The purpose of this method is to see if we need to add a new physical node to the graph, or if we can continue by adding this producer to the current physical node.

Is that right?",58352425,2013-09-21 23:31:10
2115772,7111,6503260,176,"in this method, can we rename ""outerProducer"" to ""dependantProducer"" to reinforce the directionality?",58352425,2013-09-21 23:33:29
2115772,7111,6503267,175,comment on this inner loop. I think this inner loop is actually constructing the members of the physical node. Is that right?,58352425,2013-09-21 23:34:54
2115772,7111,6503270,128,put the return type to make it more readable.,58352425,2013-09-21 23:35:54
2115772,7111,6503283,131,"Add a todo: dependent types could be used to prove that the getOrElse is never triggered.

http://stackoverflow.com/questions/2693067/what-is-meant-by-scalas-path-dependent-types",58352425,2013-09-21 23:38:33
2115772,7111,6503284,135,don't we want .get here? Are we ever calling this method when src or dest are not locate-able?,58352425,2013-09-21 23:39:09
2115772,7111,6503298,36,"by this, I mean the naming function above:

private def defaultName[T](node: T): String = node.getClass.getName.replaceFirst(""com.twitter.summingbird."","""")

val preferredName = requestedName.getOrElse(defaultName(node))",58352425,2013-09-21 23:42:12
2115772,7111,6503315,225,Why is intermediate flatmap the default?  Comment?,58352425,2013-09-21 23:44:28
2115772,7111,6503322,229,"What does this method do? Collect means something in scala, so be careful with that name (it is like a filtering map).

Seems like we add the producer and it's dependencies to the registry. Is that true?

Maybe, addWithDependencies is a good name?",58352425,2013-09-21 23:46:24
2115772,319889,6503554,19,Removed nearly all imports,58352425,2013-09-22 01:20:07
2115772,319889,6503560,131,"I'll add the TODO, though looking at that i'm not sure how it can be used to prove the locates will return nodes?",58352425,2013-09-22 01:22:31
2115772,319889,6503562,135,"Yep, I had just read before that doing get outside tests is bad, but having an exception does make sense here",58352425,2013-09-22 01:23:07
2115772,319889,6503597,196,"The reverse is of the list inside the storm node, not the registry itself",58352425,2013-09-22 01:45:19
2115772,319889,6503633,192,"Like so many things, it used to encapsulate more. Looking at these contents, i'll remove the class in favor of just the Set[StormNode]",58352425,2013-09-22 02:02:09
2115772,319889,6503651,218,"Yep, it works. Moving to that",58352425,2013-09-22 02:09:04
2115772,319889,6503654,225,"I'll add a comment, but its basically your default state. If there is nothing special about the storm node its an IntermediateFlatMap one ",58352425,2013-09-22 02:09:46
2115772,319889,6503667,229,"Done, and comment before function explaining such",58352425,2013-09-22 02:13:25
2115772,319889,6503679,255,"Yes, added",58352425,2013-09-22 02:17:24
2115772,319889,6503710,100,"  def apply(stormDag: StormDag, writer: Writer): Unit = writer.write(apply(stormDag).toString)
  def apply(tail: Producer[Storm, _], writer: Writer): Unit = apply(DagBuilder(tail), writer)
  def apply(tail: Producer[Storm, _]): String = apply(DagBuilder",58352425,2013-09-22 02:44:42
2115772,7111,6505784,141,"Why not:
```scala
Producer
  .dependenciesOf(dependantProducer)
  .foldLeft(innerDag) { {dag, dep) => dag.connect(dep, dependantProducer) }
```
Would that work and save some code duplication with dependenciesOf?
",58255047,2013-09-22 22:24:44
2115772,7111,6505837,141,"Let's address this, if you agree in a next PR.",58255047,2013-09-22 22:53:59
2117191,44018,6506354,4,"Do we want that, or do we want to force a foreach on every element of the stream?",58393098,2013-09-23 02:33:39
2117191,44018,6506356,8,"If we figure out that it's an issue, anyway.",58393098,2013-09-23 02:34:31
2117191,7111,6506451,4,"Well, the plan is right, but I agree the .run method is probably wrong. Let me fix it up.",58393098,2013-09-23 03:15:46
2117191,7111,6506560,4,"Think this is right now.  That said, Memory is a toy, and not really usable for anything.",58393098,2013-09-23 03:40:18
2117191,44018,6506590,9,"if you want to force it to empty, don't we need `left.filter(_ == false)`?",58264241,2013-09-23 03:47:47
2117191,7111,6506704,9,yes.,58264241,2013-09-23 04:23:17
2117191,44018,6507308,8,"Okay here, since we don't anchor by default.",58393098,2013-09-23 07:24:50
2117344,7111,6507033,15,"how is Gen.choose being used here at all?  Why not
```scala
Gen.listOf(Gen.chooseInt).map(Producer.source[Memory,Int](_))
```",58265157,2013-09-23 06:11:09
2117344,7111,6507035,13,don't like mixing our own approach with the scalacheck. Why not just use scalacheck all the way through?,58265157,2013-09-23 06:11:54
2117344,7111,6507043,25,"I think the pattern is: when you want an implicit Gen, you take an implicit Arbitrary, and then call .arbitrary on it to get the Gen (kind of confusing, but that is the pattern I think):

https://github.com/rickynils/scalacheck/blob/master/src/main/scal",58265157,2013-09-23 06:15:08
2117344,319889,6507065,13,"So I ran into two things with these:

1) value() makes a constant so we only have 1 source of each type
2) Without the List aspect List[Int]() == List[Int]() , so the normal comparators all align up.

Its that or needing to use eq instead which seeme",58265157,2013-09-23 06:23:42
2117344,319889,6507087,15,"the Gen.choose is purely to get the right typing out of it at the far side.

Needs heavy testing to check these, cause lots of false failures. Any changes to this portion of the logic i'd rather do in another PR. These are a bit of a minefield of transi",58265157,2013-09-23 06:31:09
2117344,7111,6507209,15,"Okay. We can merge. We can use `Equiv[T]` to check equality, and define Equiv on these problematic nodes as we need, perhaps.",58265157,2013-09-23 07:06:37
2118618,7111,6522328,51,"replace `arbitraryIntPair.arbitrary` with `Arbitrary[(Int, Int)].arbitrary` and delete arbitraryIntPair",58273224,2013-09-23 23:08:02
2124076,7111,6551050,138,we need to make sure `andThen` on identity is free. We need to override andThen on the identity to just return the right hand argument.,58306254,2013-09-24 22:51:20
2124076,7111,6551082,132,where is this being used?,58306254,2013-09-24 22:52:29
2124076,319889,6551151,132,"... its not, it went away with putting the identity in at the start of the producer fold, will remove",58306254,2013-09-24 22:54:27
2124076,7111,6551376,53,should be transitiveDependants.,58306254,2013-09-24 23:01:12
2124076,7111,6551551,31,"How is this useful?  Seems like FMItem is no longer used.

Is that right?",58306254,2013-09-24 23:06:43
2124076,319889,6551632,31,"True, deleting",58306254,2013-09-24 23:09:04
2124076,7111,6559902,195,is that reveresedNodeSet?,58306252,2013-09-25 04:18:23
2124076,7111,6605904,135,"rename dependsOn to dependenciesOf?

Also, the right hand side looks reversed. Is it right? Can you explain this in a comment?",58306252,2013-09-26 21:34:53
2124076,7111,6618232,434,.foreach,58312006,2013-09-27 04:32:33
2125082,7111,6619787,58,skeptical we need this. Seems like an internal detail.,58312011,2013-09-27 06:32:53
2125082,7111,6619793,39,can we say toSource?,58312011,2013-09-27 06:33:09
2125082,7111,6619801,67,style: no curlies if they are not needed. no () if they are not needed.,58312011,2013-09-27 06:33:34
2125082,319889,6620405,58,"I'm not sure of a particularly great way when I only have the type to give me a new version of the subclass?

Use case is that when I walk the producer graph I end up with Node's which are arranged source -> sink, but since we look at our graphs normall",58312011,2013-09-27 07:45:27
2165376,44018,6648912,16,"If you want to add more info, here's what's really going on:

""Until Summingbird upgrades its Scalding dependency to 0.9.0, parallel test execution will cause transient test failures""",58559741,2013-09-30 05:12:29
2165376,44018,6648915,7,"""Hack because some versions of SBT accidentally stick the the incremental version on the end of the jar name. SBT publishes without the incremental version, so for proper resolution we need to do some string butchery.""",58559741,2013-09-30 05:15:00
2165376,44018,6648918,6,"""hasn't built util-* and finagle-* against 2.9.3.""",58559741,2013-09-30 05:15:17
2207790,13840,6809149,49,?,59081831,2013-10-08 01:29:46
2207790,319889,6809214,49,"The initial pass has no notion of a setup call, to avoid dead letters if the source actor comes up first and starts firing messages(think testing). there is a sleep. It really needs to be configured/kicked once we believe the cluster is setup -- or indeed",59081831,2013-10-08 01:31:55
2207790,7111,6809355,49,I guess we need a master node that supervises all the Actors (you may have one) can send a start message after everything is setup.,59081831,2013-10-08 01:36:26
2207790,319889,6809448,49,"No there's not one of those yet, just the 3 types of actors so far. Doing this beyond something firing these up and the controlling entity just sending configuration messages we probably want to decide how it should be distributed... nothing to do with Ak",59081831,2013-10-08 01:39:53
2207790,13840,6810067,40,"Neat class! Is this meant to be invoked concurrently, though? The `scala.collection.mutable.Queue` is not thread-safe. If a single instance could be invoked from multiple threads, you probably want to just switch to a `java.util.concurrent.ConcurrentLinke",59081831,2013-10-08 02:01:04
2207790,319889,6810660,40,"This is just a clone of the one under storm right now -- in either case they are called from single threaded locations. Without putting it in a general purpose utility location i'm not sure we need to worry about it?

",59081831,2013-10-08 02:21:07
2207790,13840,6810794,40,"Ah, makes sense! Just something to keep in mind in case it's ever used in that fashion. Thanks for the clarification.",59081831,2013-10-08 02:25:59
2207790,115552,6817920,72,"Premature optimization comment: Is this called often?
Cause replaceAllLiterally creates a regex and a replace all, meaning you are paying the cost of compiling a regex 5 times, and copying the string 5 times, when you can just do a for loop and test for ",59081831,2013-10-08 11:37:27
2207790,115552,6817933,1,missing header,59081831,2013-10-08 11:39:33
2207790,115552,6817940,1,what's happening? :),59081831,2013-10-08 11:40:07
2207790,17067,6819980,47,case object Emit,59081831,2013-10-08 13:51:50
2207790,319889,6829260,72,"Swapped it to a single replaceAll with a regex for all character matches... the regex should be just built one but can deal with it later if its important. -- It shouldn't be too much of a hot spot, only occurs during setup",59081831,2013-10-08 20:40:27
2207790,319889,6829306,1,"Should have a collector on the flat mappers before we goto a summer, this is really just copied and pasted from storm. I'll nuke for now till we have something non-commented here",59081831,2013-10-08 20:41:47
2207790,319889,6829421,1,Added,59081831,2013-10-08 20:45:37
2207790,7111,6847419,33,"data: Either[(Any, (Any, Any)]
Would be better than try catch",59173417,2013-10-09 09:41:37
2207790,7111,6847427,43,Let's have a type for targetNames. Let's not repeat the storm issue of using strings.,59173417,2013-10-09 09:42:28
2207790,7111,6847466,71,If the first thing we do is cast... You know what to do,59173417,2013-10-09 09:49:24
2207790,7111,6847476,80,"Case f: Future

But when would this happen/not?",59173417,2013-10-09 09:50:26
2207790,7111,6847478,91,Externalizer,59173417,2013-10-09 09:50:44
2207790,7111,6847516,23,Options should definitely move into core if they are useful across planners,59173417,2013-10-09 09:55:54
2207790,7111,6847530,36,"Issue, this should take Future[Unit]",59173417,2013-10-09 09:57:37
2207790,7111,6847784,59,No manifest I think.,59173417,2013-10-09 10:27:44
2207790,38136,7973452,10,"Seq(""2.9"", ""2.10"") exists scalaVersion.startsWith :-)",73586179,2013-11-28 06:44:19
2207790,38136,7973719,36,This is highly not recommended. use scala.util.control.NonFatal,73586179,2013-11-28 06:59:36
2207790,38136,7973826,43,:+1: to what @johnynek said,59173417,2013-11-28 07:06:32
2207790,38136,7973835,47,?,73586179,2013-11-28 07:06:57
2207790,38136,7973847,57,Might look nicer as a for-comprehension,73586179,2013-11-28 07:07:33
2207790,38136,7973850,76,foreach,73586179,2013-11-28 07:07:45
2207790,38136,7973951,101,Why toList?,73586179,2013-11-28 07:13:32
2207921,7111,6812042,6,"change to ""shouldEmit""",59082644,2013-10-08 03:14:35
2207921,7111,6812153,19,can't we put this above the `items.foreach`?,59082644,2013-10-08 03:18:00
2217364,13840,6846046,22,"super minor, but you can just say `.headOption.isDefined` here instead of explicitly matching on it.",59144574,2013-10-09 07:05:01
2217364,319889,6846240,22,Made that change prior to merge,59144574,2013-10-09 07:24:15
2234598,7111,6873710,161,Nonde => Node.,59258788,2013-10-10 03:58:59
2234598,7111,6873737,148,no akka here.,59258788,2013-10-10 04:01:13
2234598,7111,6873738,141,akka,59258788,2013-10-10 04:01:19
2234598,7111,6873748,85,akka,59258788,2013-10-10 04:02:00
2234598,7111,6873769,32,be consistent with Producer and Prod.,59258788,2013-10-10 04:03:01
2234598,7111,6873784,28,"is this right? What about also?

Don't we want depData.allNodes?",59258788,2013-10-10 04:03:54
2234598,7111,6873796,53,akka,59258788,2013-10-10 04:04:34
2234598,7111,6873836,28,entireGraphOf,59258788,2013-10-10 04:07:29
2236437,7111,6875040,15,back to sample?,59271694,2013-10-10 05:11:55
2248214,7111,6923376,9,"case (time, (key1, value)) =>",59566273,2013-10-11 23:45:07
2248618,7111,6924896,31,StormSource,59599543,2013-10-12 00:46:16
2253672,7111,6933250,8,Let's add Timestamp.Min as a val in object Timestamp for this one.,60727672,2013-10-13 06:02:09
2253672,7111,6933251,15,also Timestamp.Max as a val in that object.,60727672,2013-10-13 06:02:35
2253672,7111,6933252,32,Timestamp.Min (and .Max below).,60727672,2013-10-13 06:03:09
2253672,7111,6933255,91,"new Date() uses currentTimeMillis. This is a bug.

Can we add a unit test to prevent such a regression?",60727672,2013-10-13 06:04:06
2253672,7111,6933256,106,let's add a .prev and .next to Timestamp and this becomes: `earliestTimeOf(batchID.next).prev`,60727672,2013-10-13 06:05:05
2253672,7111,6933258,5,add a .toDate method on the Timestamp and call it here.,60727672,2013-10-13 06:05:43
2253672,7111,6933260,17,some .prev on the Timestamp.,60727672,2013-10-13 06:06:02
2253672,7111,6933262,36,"Timestamp is not mutable, so you can remove this comment and just return: beforeBound.upper",60727672,2013-10-13 06:06:51
2253672,7111,6933264,25,"toDate, prev, next",60727672,2013-10-13 06:07:31
2253672,7111,6933266,12,"these will all be now. I think we need something like Gen.choose(some time in 2005 in long, some time in 2025 in long)",60727672,2013-10-13 06:09:10
2253672,7111,6933267,28,add `def now: Timestamp` which wraps the currentTimeMillis call.,60727672,2013-10-13 06:10:02
2253672,7111,6933268,50,replace with Timestamp.now.,60727672,2013-10-13 06:10:28
2253672,7111,6933271,81,add a `def incrementMillis(millis: Long): Timestamp` to Timestamp? (similar incrementSeconds?),60727672,2013-10-13 06:12:24
2253672,7111,6933272,89,`hourlyBatcher.earliestTimeOf(maxBatch.next).prev`,60727672,2013-10-13 06:12:45
2253672,319889,6933274,12,"I had it being arbitrary longs before and tests failed, where do we generate the Dates that work? ",60727672,2013-10-13 06:13:38
2253672,7111,6933276,33,Timestamp.Min.,60727672,2013-10-13 06:14:21
2253672,7111,6933277,25,d == Timestamp.Max,60727672,2013-10-13 06:14:40
2253672,7111,6933284,13,"TODO: we should change this to: Values(time.millisSinceEpoch, item) which may serialize better (since it is a Long + object rather than using Timestamp which will be object, object",60727672,2013-10-13 06:16:52
2253672,7111,6933288,44,"If we go down this road, we need to register a Kryo serializer so this is not slower than using the Long.",60727672,2013-10-13 06:18:35
2253672,7111,6933303,12,https://github.com/twitter/summingbird/blob/feature/remove_java_util_date/summingbird-batch/src/test/scala/com/twitter/summingbird/batch/Generators.scala?pr=%2Ftwitter%2Fsummingbird%2Fpull%2F295#L31,60727672,2013-10-13 06:27:04
2253672,7111,6933364,39,"`def now: Timestamp = Timestamp(System.currentTimeMillis)`

wouldn't that clean things up a bit?",60806182,2013-10-13 06:58:01
2253672,319889,6933372,39,"Good call, adding.",60806182,2013-10-13 07:08:02
2256056,319889,6935849,40,drop the braces?,61442896,2013-10-14 02:13:39
2256056,7111,6935863,40,":) yep. I saw that on github after I pushed. I had added them to get a val, I later removed.",61442896,2013-10-14 02:16:33
2262360,7111,6959596,11,"I don't think this is needed, and we may be screwing up if we are not careful. We could dave duplicated classes.",62364862,2013-10-15 04:53:36
2262360,7111,6959627,4,"don't like this name. util-online or something to make it clear that this is our stack (bijection, algebird) + storehaus, util.",62364862,2013-10-15 04:55:06
2262360,7111,6959645,7,CacheSize should move to core. We use offline too for mapside aggregation.,62364862,2013-10-15 04:55:56
2262360,7111,6959671,5,"this is the old builder code. Is it still needed outside of there? If not, can we move it there?",62364862,2013-10-15 04:57:01
2262360,319889,6960269,11,"the with cross isn't needed? The other usage(storm) uses it like this, so it won't make things 'worse' anyway I don't think?",62364862,2013-10-15 05:31:04
2262360,319889,6960277,4,"util-online doesn't seem to really do it, it encapsulates configs and everything that aren't quite so much utility are they? streaming-common maybe?",62364862,2013-10-15 05:31:42
2262360,319889,6960278,7,k,62364862,2013-10-15 05:31:52
2262360,44018,6960298,11,"I think withCross IS needed, because util isn't published for scala 2.9.3. You won't be able to build without it, I don't think.",62364862,2013-10-15 05:32:58
2262360,319889,6960375,11,"It is, i just checked, no 2.9.3 util-core published :/",62364862,2013-10-15 05:39:11
2262360,7111,6961200,11,cool. Just want to make sure we keep that right. Using withCross should be consistent in out stack. Thanks for checking.,62364862,2013-10-15 06:49:25
2262360,7111,6961218,4,"what about summingbird-storehaus? It seems that storehaus is the main dependency there, right?",62364862,2013-10-15 06:50:55
2262360,319889,6961266,4,"Well BatchID is from storehaus, but most of it is the use of futures in general, FlatMapOperation is just a chain series of flatmaps. Also the OnlinePlanner can live here, that takes the producer graph and turns it into the physical graph -- even if the p",62364862,2013-10-15 06:54:58
2269630,2221968,6991299,83,Is this where you wanted to use capturedBatcher?,63256995,2013-10-16 07:48:37
2269630,2221968,6991343,104,Just roll this into prepareOld?,63256995,2013-10-16 07:53:03
2269630,2221968,6992019,53,througt -> through,63256995,2013-10-16 09:17:15
2269630,7111,6992133,83,good catch!,63256995,2013-10-16 09:30:26
2269630,13840,6992196,40,semi!,63256996,2013-10-16 09:37:58
2269630,2221968,6992249,40,The semicolon is intentional?  But I think general practice would use () here as a hint that this is a Unit function with side effects.  I would possibly consider the same for takeNext but ¯\(°_o)/¯,63256996,2013-10-16 09:43:20
2269630,7111,6992343,40,"there was a lambda in an earlier draft and that confused the compiler. If you guys need it gone, I'll re-do it, but unless we have other bigger changes, I'm personally not concern with it.",63256996,2013-10-16 09:53:23
2269630,13840,6992428,22,"I think `groupedSum` can be tightened up a bit if you use a `BufferedIterator` (a simple wrapper over `Iterator` that gives you access to `head`, which lets you peak at the next element in the iterator without consuming it):

```scala
  def groupedSum[",63263194,2013-10-16 10:01:54
2269630,7111,6992585,22,actually it is more that is needed. Semigroup.sumOption(t: TraversableOnce[T]) is what we want to call here. resorting to calling plus in big aggregations should be seen as a fail.  I'm going to punt on this until we can get an implementation that tackle ,63263194,2013-10-16 10:19:18
2269630,13840,6992617,22,"Ah, I see. Sounds good!",63263194,2013-10-16 10:23:40
2301184,319889,7108763,18,Get a temp path here than /Users....,66189265,2013-10-22 02:17:49
2301184,44018,7110510,68,"Just add a println warning now, no need for a logger.",66189265,2013-10-22 03:11:55
2301184,44018,7110522,69,`startBatch.next`,66189265,2013-10-22 03:12:18
2301184,44018,7110560,19,"make timezones implicits, also add

```scala
implicit val parser = DateParser.default
```

Then remove explicit calls to tz and dateparser.",66189265,2013-10-22 03:13:48
2301184,44018,7110576,27,I guess this is where you're going to check that the state was actually created?,66189265,2013-10-22 03:14:15
2301184,44018,7110589,30,"Going to recommend that you take a startTime as you do now, PLUS a Duration. If you want, you can make it an Option[Duration], and then internally use one batch if the user doesn't specify.",66189265,2013-10-22 03:14:53
2301184,7111,7114939,101,shouldn't this be done in the succeed method below? We have not actually suceeded yet.,66189258,2013-10-22 07:19:48
2301184,393209,7116346,101,We do this here to mark it as running. This avoids multiple runs of same batch at the same time.,66189258,2013-10-22 09:35:34
2301184,319889,7131893,44,All these references to fixedBatcher should just be batcher for consistency with the rest of the code. Nothing else in SB makes any sense if the batcher was to be changed (we don't keep semantics as to what a BatchID comes from other than with the code),66189258,2013-10-22 21:36:10
2301184,319889,7131906,22,temp folder?,66189258,2013-10-22 21:36:36
2301184,7111,7135089,101,"The issue is the whole process can crash on mesos, and then you leave behind the claim that it was finished. This actually happens, so it is not failsafe.",66189258,2013-10-22 23:14:33
2301184,393209,7135634,101,"With the change we discussed yesterday, the new run of the same thing would prefer startdate over hdfs checkpoint.",66189258,2013-10-22 23:30:21
2305113,44018,7141023,39,"If this is all good, I can redo these tests to use `BacktypeVersionedStore`'s methods for checking version existence etc.",66234757,2013-10-23 02:20:17
2305113,7111,7141161,73,InclusiveLower[BatchID] ?,66234757,2013-10-23 02:24:10
2305113,7111,7141173,85,ExclusiveUpper[BatchID]?,66234757,2013-10-23 02:24:31
2305113,7111,7141245,91,"`Intersection(startBatch, endBatch).mapNonDecreasing(earliet...)`",66234757,2013-10-23 02:26:42
2305113,7111,7141269,100,alignsExclusive,66234757,2013-10-23 02:27:26
2305113,7111,7141352,111,rename t => b,66234757,2013-10-23 02:29:46
2305113,7111,7141453,111,"Move to batcher, add law. This is just exactly batched or something.",66234757,2013-10-23 02:33:26
2305113,7111,7141502,76,"version to BatchID. call out as a function, test against version(BatchID). Share with VersionStore.",66234757,2013-10-23 02:35:34
2305113,7111,7141555,142,"mark as defensive, to make sure it is clear.",66234757,2013-10-23 02:38:02
2305113,319889,7144657,89,Better error message here,66234761,2013-10-23 04:57:47
2305113,319889,7144658,96,and here,66234761,2013-10-23 04:57:54
2305113,319889,7144815,32,"def tempPath: String = {
val path = ""/tmp/"" + UUID.randomUUID
(new File(path)).deleteOnExit
path
}

And then we can skip all the cleanup code?",66234761,2013-10-23 05:06:22
2305113,7111,7145832,8,"don't take an implicit for a concrete type (Equiv[BatchID]). BatchID has a sane equals, so it is safe, or get one out of the BatchID object.",66214680,2013-10-23 06:16:35
2305113,7111,7146062,81,toExclusiveUpper? Makes it clear.,66214680,2013-10-23 06:43:44
2305113,7111,7146068,75,toInclusiveLower: InclusiveLower[Timestamp]?,66214680,2013-10-23 06:44:10
2305113,7111,7146110,134,this is a race. You need to put the compareAndSet in the if block. It could have been set after you called .get.,66214680,2013-10-23 06:48:03
2305113,7111,7146155,144,"the same as set to false (if true => false, if false it is already false).

If you want to be safe, this is assert(compareAndSwap(...), ""Concurrent modification of running state"")",66214680,2013-10-23 06:52:06
2305113,7111,7146162,156,setStopped (with the assert) before the write. This way any funny business stops us from marking success.,66214680,2013-10-23 06:52:45
2305113,7111,7146223,5,can we put this on Batcher directly? Why redirect through BatchID?,66214680,2013-10-23 06:58:51
2305583,7111,7147444,15,"I don't think this implicit will apply if there are two arguments, will it?",66217485,2013-10-23 09:14:55
2322794,319889,7201439,4,Logger import unused everywhere?,66847106,2013-10-25 02:05:15
2323809,319889,7577179,18,defining a used just once? ,70314437,2013-11-12 06:07:11
2323809,7111,7577244,18,"you know me. Solve the general thing first. :)
Actually, a lot of hadoop options should use this pattern. We don't want to stomp the ones that the user sends by the command line.",70314437,2013-11-12 06:10:12
2323809,319889,7577447,16,Does this come out sanely on hadoop? ,70314437,2013-11-12 06:18:43
2341707,44018,7344659,13,"So, I know it gets the graph walking to compile, but this makes me nervous... Doesn't this stop the `StoreIntermediateData` call into the builder API from type checking? Do we have an example job that still works with the Any everywhere, or proof that you",67776786,2013-10-31 21:21:07
2341707,44018,7344674,4,is this used?,67776786,2013-10-31 21:21:30
2341707,44018,7344734,35,"It'd be nice to have an implicit conversion from a function  -> IKryoRegistrar, OR just create a new arity of withRegistrar that takes the func.",67776786,2013-10-31 21:23:05
2341707,44018,7344780,26,"Should this extend MapLike, and be an actual Map itself?",67776786,2013-10-31 21:24:27
2341707,44018,7344804,65,"If it's immutable, why call this out directly? docstring? Also, should SummingbirdConfig extend at least this trait (if not Scala's map trait)?",67776786,2013-10-31 21:25:04
2341707,44018,7344844,27,"nice, good to wrangle configuration into something that makes more sense.",67776786,2013-10-31 21:26:02
2341707,319889,7346835,13,"This could only ever enforce on one line, specifying the type params on the constructor, and then the sink not matching those. -- though that appears to be how its used internally. Will commit change that brings them back. (Also hadn't realized this was i",67776786,2013-10-31 22:19:34
2341707,319889,7347071,4,"Nope, dropped, it and removed others that weren't being used either",67776786,2013-10-31 22:25:59
2341707,319889,7347407,35,Reworked this with an implicit and a varargs func to make it a bit prettier/more generic,67776786,2013-10-31 22:35:31
2341707,319889,7347472,26,"Oscar didn't want this to be a map, something about a bunch of functionality it doesn't need/shouldn't have. Its not a million miles away from having an immutable map interface though I agree",67776786,2013-10-31 22:36:56
2341707,319889,7347596,65,"This trait is purely for its downstream configs. Type signatures for keys are slightly different. The SummingbirdConfig is what something like the WrappingConfig implements, the wrapping config though needs access to a ReadableMap like object (Wraps an Ha",67776786,2013-10-31 22:40:44
2343800,44018,7300493,33,"nice. If our tests are failing, we can call that new method I exposed in cleanup to clear out the source data.",67738086,2013-10-30 07:16:44
2343800,44018,7300507,39,why namedproducer22?,67738086,2013-10-30 07:17:45
2343800,319889,7317503,39,"with the generated ones they are mostly named XXX22 , 21, 12, 11 -- it indicates the tuple size on the input vs output. So a 22 maintains a keyed tuple, 12 transforms it with an identity keyed producer, etc...",67738086,2013-10-30 22:49:04
2419609,7111,7549590,35,isn't this going to drop versions to keep?,69925589,2013-11-11 01:45:02
2419609,7111,7549591,35,Don't you want filterNot(keepers)? (note set extends function so that is legit.,69925589,2013-11-11 01:45:54
2419609,7111,7549597,39,"don't you mkdirs root, so it must be there right? Perhaps its absence should be a fatal error until we think of a reason why it can ever be absent.",69925589,2013-11-11 01:47:06
2419609,7111,7549609,65,"This is the same as:
```scala
Try(p.getName().dropRight(FINISHED_VERSION_SUFFIX.length()).toLong)
```",69925589,2013-11-11 01:50:38
2419609,319889,7549610,35,"True, good catch  -- Also do we actually need cleanup? I don't see it called.",69925589,2013-11-11 01:50:53
2419609,319889,7549611,39,"True, artifact of the copy, less code = yey",69925589,2013-11-11 01:51:10
2419609,7111,7549619,1,"add a license header (wish we didn't have to junk up with boilerplate, maybe @caniszczyk can explain why a file notice in the root is not enough).",69925589,2013-11-11 01:53:49
2419609,7111,7549627,30,extra space after (?,69925589,2013-11-11 01:56:23
2419609,7111,7549629,40,nice adding plenty of logs!,69925589,2013-11-11 01:56:41
2437754,319889,7612160,31,"Indentations appear odd, increasing indentation because of split in args? args should be further indented but method code the normal amount imo",70527325,2013-11-13 06:41:47
2437754,7111,7612186,31,tell me what you want to type.,70527325,2013-11-13 06:42:31
2437754,319889,7612222,31,"def toStormSource[T](spout: Spout[T],
                                defaultSourcePar: Option[Int] = None)(implicit timeOf: TimeExtractor[T]): StormSource[T] =
   SpoutSource(spout.map(t => (timeOf(t), t)), defaultSourcePar.map(option.SpoutParallelism(",70527325,2013-11-13 06:43:45
2460390,13840,7708337,57,Was your intention for this to block if `queue` is an `ArrayBlockingQueue` with a fixed size? What actually will happen is that a `java.lang.IllegalStateException: Queue full` exception will be thrown instead of it actually blocking (you would need to cal,71242913,2013-11-16 11:52:33
2460390,7111,7708360,57,Nice catch. Fixed.,71242913,2013-11-16 12:06:59
2460390,13840,7708364,57,Looks nice!,71242913,2013-11-16 12:11:22
2460390,319889,7713350,72,"If its an always, why not bake the behavior into these rather than at touch points?",71245772,2013-11-18 00:41:14
2460390,319889,7713364,72,"Could we supply a more scala idiomatic one, return Option[T] and internally do the decrement if not null?",71245772,2013-11-18 00:43:38
2460390,319889,7713373,67,Is this now mostly just an abstract Queue class now? not sure the name matches anymore,71245772,2013-11-18 00:46:08
2460390,319889,7713396,26,"Great work with all the tests, the only one I don't see and am not sure matters is just ordering of put to poll",71245772,2013-11-18 00:54:14
2460390,319889,7713406,39,Is this comment still accurate in the right place? (Also maybe we should put it in a companion object so it can be used during initialization as well as tuple processing time?),71245772,2013-11-18 00:57:32
2460390,319889,7713413,51,"is there a level of error we should re-throw and stop badly processing tuples (i.e. failed connection to store, exception vs error?)",71245772,2013-11-18 00:58:33
2460390,319889,7713419,96,split out to another file maybe?,71245772,2013-11-18 01:00:32
2460390,319889,7713424,114,"Oh cool, you added this! very nice",71245772,2013-11-18 01:01:08
2460390,319889,7713429,121,p? ms?,71245772,2013-11-18 01:03:14
2460390,319889,7713442,130,in these comments include that we block on draining this as part of empty channel.,71245772,2013-11-18 01:06:27
2460390,319889,7713460,60,"Seperate PR for this stuff, it needs to be benchmarked/tested in production independently",71245772,2013-11-18 01:12:30
2460390,319889,7713472,79,"Its awesome that you added this, but i'd disable it for now, lets push out two testing point releases after we test/get your base patch out with this and the localOrShuffle. Thoughts?",71245772,2013-11-18 01:15:09
2460390,319889,7713473,24,typo?,71245772,2013-11-18 01:15:18
2460390,319889,7713480,137,is this still valid?,71245772,2013-11-18 01:17:29
2460390,319889,7713484,145,Should we be pushing these success/exception handler's down to the base bolt and always use them? ,71245772,2013-11-18 01:18:57
2460390,7111,7714712,72,"I am trying to make it easy to get that right, but if we require every subclass to call decrement, some will get it wrong. By contrast, if we do it below, we can audit it and test it once. This method is just for the adapter to existing java classes.

O",71245772,2013-11-18 06:33:19
2460390,7111,7714717,60,you're right.,71245772,2013-11-18 06:34:33
2460390,7111,7714721,79,"I say leave it on for two reasons:

1) if it causes problems, we can change it back with a config change in any job, or all at once really easily.

2) with us now not emitting in any futures, I am concerned we could increase latency a lot without that",71245772,2013-11-18 06:36:13
2460390,7111,7714724,24,french.,71245772,2013-11-18 06:36:23
2460390,7111,7714727,137,don't know. :),71245772,2013-11-18 06:36:33
2460390,7111,7714730,145,"I thought about that, but only SummerBolt has them for now. I'd say yes, this is a todo, but I didn't want to do it here.",71245772,2013-11-18 06:37:09
2460390,7111,7714796,26,Will add.,71245772,2013-11-18 07:00:04
2460390,7111,7714833,39,"If we put it in the companion, we have to do it for each class. The getClass won't automatically work. Tend to think it is okay here.",71245772,2013-11-18 07:05:51
2460390,7111,7714836,51,Good question. I don't know. I assume that reportError and logging error are good for now. Let's see. It is more than we used to do.,71245772,2013-11-18 07:06:34
2460390,7111,7714839,96,good call.,71245772,2013-11-18 07:06:48
2460390,7111,7714911,137,"https://github.com/twitter/summingbird/issues/83

That is the issue. If the cache is small, but maxwaiting is small, you are potentially waiting of futures to complete that can't until they kicked out of the cache. I actually think this is fixed now tha",71245772,2013-11-18 07:20:23
2460390,7111,7714919,67,Sure.,71245772,2013-11-18 07:21:10
2460390,319889,7716537,79,"Ok, i'll accept that argument (I'm not sure its really a thing, if there is enough traffic to spill a SummingQueue to generate the futures there should be enough to flush them too). But its easy to turn on and off as you say",71245772,2013-11-18 11:50:32
2460390,319889,7716545,145,"Yeah that seems like a good plan (also its really API changing, to pushing to bigger release is probably good)",71245772,2013-11-18 11:51:52
2460390,319889,7716548,137,"Yeah, i think in this impl it would have to be a straight up bad bug to have that sort of deadlock with where the flush/blocking can occur. - We can probably replace the issue with adding a test that scenario instead",71245772,2013-11-18 11:52:53
2460390,319889,7716585,72,"So with the the atomic thing, i was thinking it might be more have the downstream api but then final functions which call them and do the decrement/increment. Such that there is only 2 places we need to ensure correctness. Not a big thing, its only a tiny",71245772,2013-11-18 11:56:36
2468641,7111,7732793,19,Can we get types on public methods to make it easier to keep binary compat?,71568200,2013-11-19 01:08:20
2468641,7111,7732831,32,"s/monad/method here.

Also, should the default be identity?",71568200,2013-11-19 01:09:24
2468641,7111,7732863,54,is this needed?,71568200,2013-11-19 01:10:22
2468641,7111,7732940,72,comment on this one? It should only be used if the mapper tasks are doing heavy work and would be faster to force a shuffle immediately after the data is read.,71568200,2013-11-19 01:12:49
2468641,7111,7733157,94,want to go ahead and use slf4j here?,71568200,2013-11-19 01:19:48
2468641,7111,7733161,90,slf4j.info?,71568200,2013-11-19 01:19:57
2474544,7111,7745537,6,maybe do summingbird. ?,71746960,2013-11-19 07:47:57
2519344,319889,7912121,13,With these do we have a preference for a .default in the object vs the Constant style on the line above?,73200767,2013-11-26 08:05:02
2526708,7111,7946103,74,strange indentation.,73440848,2013-11-27 08:33:51
2526708,7111,7946155,41,Can't this fit the StatefulSummer API and then not change any of the other code?,73440848,2013-11-27 08:37:34
2531719,814892,7975073,5,"Instead of partitioning and putting back, will using a version of trimTo that takes in a predicate work better?
That version could trim all elements that satisfy the predicate.

Or am I missing any queue semantics here?",73574026,2013-11-28 08:34:24
2531719,7111,8011824,5,"The issue is that for the items that fail the predicate need to be put back into the queue. This cannot be done better than we have here if we only have poll and add.

The better solution is to atomically swap the tail out with an empty queue, filter th",73574026,2013-12-01 02:44:00
2531719,814892,8032954,5,Got it. Thanks for the explanation.,73574026,2013-12-03 00:40:14
2551850,7111,8110794,42,Seems like a metrics concept.,74178821,2013-12-05 04:27:31
2551850,7111,8110830,66,should we add incr and decrBy for symmetry?,74178821,2013-12-05 04:28:35
2551850,7111,8110869,74,"require(by < 0, ""Invalid fanout: %d, by should be >= 0"".format(by))",74178821,2013-12-05 04:29:25
2551850,7111,8110922,81,"I think this should be in incrBy. It should not allow a faulty transition (or at least, it should be a method on the state, so we don't change states in a fault.",74178821,2013-12-05 04:30:51
2551850,7111,8111461,27,maybe add a comment that oper cannot side effect (or re-running might break things).,74178822,2013-12-05 04:46:13
2551850,7111,8111475,23,I prefer .get to .cur (since Try and Option do that).,74178822,2013-12-05 04:46:31
2551850,7111,8111487,50,def get: Int = data.get,74178822,2013-12-05 04:46:50
2551850,7111,8111571,89,should this be `def ack(fn: (T => U)): Option[U]`? Seems like we might want a return in many cases.,74178822,2013-12-05 04:48:48
2551850,7111,8111624,101,similar: `def fail(fn: T => U): U = {`,74178822,2013-12-05 04:49:58
2551850,7111,8113147,46,line 46 - 52 is duplicated on 58 - 63. Can we make one function and call that in both places?,74178827,2013-12-05 05:27:46
2551850,7111,8113563,110,responses.toSeq might be clearer (there is toSeq) but you would need to change the signature to expect Seq.,74178828,2013-12-05 05:39:43
2551850,7111,8113693,36,"Why is InputState[S] here rather than just S?

Seems like InputState[S] is a black box. Why don't we make it S and above change S to InputState[S]",74178828,2013-12-05 05:43:35
2551850,319889,8113836,36,"I thought about that, but you need to be able to call the expand function in a final flat map, which peeks inside alas. couldn't seem to get around that need in a great way",74178828,2013-12-05 05:48:03
2551850,319889,8113981,110,"the signature is looking for a traversable once, so I think the seq should be fine. Making the change",74178828,2013-12-05 05:52:26
2552237,7111,8117824,63,seems like a magic number. Config? val?,74187132,2013-12-05 08:18:32
2552237,7111,8117834,45,lazy here for serialization?,74187132,2013-12-05 08:18:58
2552237,7111,8117908,28,should this return Future[Unit]?,74187132,2013-12-05 08:22:29
2552237,7111,8141511,70,Shouldn't this use the pool?,74187135,2013-12-06 02:35:08
2552237,7111,8141524,75,.flatMap rather than map.flatten.,74187135,2013-12-06 02:35:23
2552237,319889,8141569,70,I'm not sure how the pool could use the pool to shutdown? it would be recursive right?,74187135,2013-12-06 02:36:47
2552237,7111,8141636,40,monoid is a confusing name. semigroup?,74187135,2013-12-06 02:38:26
2552237,7111,8141810,6,"What about: Runtime.getRuntime().availableProcessors() as the default pool size?

http://stackoverflow.com/questions/4759570/finding-number-of-cores-in-java",74187135,2013-12-06 02:42:35
2552237,7111,8141835,7,can you put Percent or some other unit in the type?,74187135,2013-12-06 02:43:21
2552237,319889,8141884,7,"Add another value class to wrap the value in the value class?  or is there some built in Percentage class I don't know.

(Add the class to enforce the bounds or?)",74187135,2013-12-06 02:44:44
2552237,319889,8141896,6,Sure,74187135,2013-12-06 02:45:04
2552237,7111,8141912,70,"Is it not safe to call shutdown from a thread that is created by the pool? If not, how do we ensure that?

Not a big deal, but if you don't want to tackle, add an issue, a link to it here and a comment explaining the concern about correctness and using ",74187135,2013-12-06 02:45:28
2552237,319889,8141952,70,"You could call shutdown, but this currently waits to ensure its shutdown before returning -- if we drop that part (awaitShutdown). Then we could do it inside the pool?",74187135,2013-12-06 02:46:37
2552237,7111,8141987,7,"I meant add Percent to the name of the class: SoftMemoryFlushPercent, perhaps.

Also, putting a require(0 < x && x <= 1.0, ""must be a percentage."") would be good.",74187135,2013-12-06 02:47:27
2552237,319889,8142337,70,"added an issue 

https://github.com/twitter/summingbird/issues/397",74187135,2013-12-06 02:56:25
2552237,7111,8150506,129,"more comments here. So this branch happens when there IS a value for this key, right? Not there is confusing to me.",74187137,2013-12-06 07:39:29
2552237,7111,8150529,130,"can we name:
val queueIsReplaced = !keyMap.replace(key, oldQueue, oldQueue)

also, how is that different from:
!(keyMap.get(key) == oldQueue)",74187137,2013-12-06 07:41:02
2552237,7111,8150608,25,I don't like these. Can we replace with JavaConverters._ and use the .asJava .asScala syntax. Implicit conversions of this kind bite us.,74187138,2013-12-06 07:45:26
2552237,7111,8150624,150,why the case k?,74187138,2013-12-06 07:45:54
2552237,7111,8150634,43,rename semigroup,74187138,2013-12-06 07:46:21
2552237,7111,8150810,154,"(breakOut) magic is supposedly faster here:

import scala.collection.breakOut
flatMap { k => ... }(breakOut)

http://stackoverflow.com/questions/1715681/scala-2-8-breakout

",74187139,2013-12-06 07:56:07
2554658,7111,8153401,22,why lazy here?,74041206,2013-12-06 11:16:33
2554658,319889,8153548,22,"Just aggressively lazy. No point, removed",74041206,2013-12-06 11:34:34
2562384,7111,8253231,133,"I think it is better to add something like, `.toReadableStore: ReadableStore[K, V2]` here rather than make this one item subclass two things.",74093067,2013-12-11 07:06:58
2562384,7111,8253256,103,"`implicit def batchOrderer = Ordering.by[(BatchID,V)](_._1)`

is the same.",74093067,2013-12-11 07:07:59
2562384,7111,8253350,87,"this is always true, right? flow is not a List, so this will never be true. I think you need to store somewhere the latest batch that has been successfully written.",74093067,2013-12-11 07:12:19
2562384,7111,8253369,26,"this should add % ""provided"" or we should make a separate module. I don't want to bloat the deps for people that are not using hbase.",74093067,2013-12-11 07:12:59
2562384,2523602,8270426,63,you maybe able to use [this](https://github.com/twitter/bijection/blob/develop/bijection-hbase/src/main/scala/com/twitter/bijection/hbase/HBaseBijections.scala#L123) bijection instead of writing a new one,74093067,2013-12-11 22:43:59
2562384,2523602,8270568,76,isnt HBaseByteArrayStore already calling hbaseStore.createTableIfRequired?,74093067,2013-12-11 22:48:02
2562384,3025050,8275467,133,It's unclear to me how to override the get/multiGet methods if I don't subclass/extend ReadableStore. Do you have an example of what you had in mind?,74093067,2013-12-12 01:06:06
2562384,2523602,8321916,126,"I am not sure why this class is needed? Can you just do this?
```
val store:Store[K,V2]=HBaseByteArrayStore(quorum, table, columnFamily, valColumnName, createTable)
.convert[K,V2](K=>Array[Byte])(V2=>Array[Byte])?
```

see [this](https://github.com/",74669480,2013-12-13 08:26:16
2562384,3025050,8339075,126,"This looks awesome! I’ll do that.
",74669480,2013-12-14 00:42:21
2562384,2523602,8353467,120,"I think HBaseStore is already extending ReadableStore, you dont have to do  hbaseStore.asInstanceOf[ReadableStore[K,V2]]",75001483,2013-12-15 06:17:04
2562384,7111,8579632,38,do you need this? Doesn't it come for free with the keyInj + valueInj?,77385061,2013-12-30 02:04:53
2562384,7111,8579638,43,can you comment the assymmetry on the .next? (I'm confused actually).,77385061,2013-12-30 02:05:54
2562384,7111,8579640,55,shouldn't this be K2?,77385061,2013-12-30 02:06:26
2562384,7111,8579643,73,does it need to be a val? Can it be a def?,77385061,2013-12-30 02:07:24
2562384,7111,8579645,73,or perhaps a lazy val (and also transient)?,77385061,2013-12-30 02:07:46
2562384,7111,8579653,82,"this is not quite right, is it? It will always return a Right. What if there is no data on disk? It is not clear that this will not have data loss.",77385061,2013-12-30 02:10:44
2562384,7111,8579654,82,I think you need to store some state somewhere that records the last written batch.,77385061,2013-12-30 02:11:03
2562384,7111,8579656,115,We also need to write some state that notes what we have finished batchID.,77385061,2013-12-30 02:11:34
2562384,3025050,8764330,43,"Sorry for the delay. I'll add the comment here. Just for reference, I borrowed the logic here from https://github.com/twitter/summingbird/blob/develop/summingbird-scalding/src/main/scala/com/twitter/summingbird/scalding/store/VersionedStore.scala. The com",77385061,2014-01-10 00:46:43
2630854,7111,8339291,38,I think we need to look on the file system to see what the last batch is.,74996843,2013-12-14 00:51:19
2630854,7111,8339357,32,"SequenceFile is a bit dicey. That one will use Kryo serialization, and that is not that safe. I think it is better to use WritableSequenceFile and take `Injection[K, Array[Byte]],  Injection[V, Array[Byte]]` to do the serialization. That way, we can be mo",74996843,2013-12-14 00:53:27
2630854,7111,8339377,23,"Let's put this in it's own file, and also, let's think about a better name. DirectoryBatchedStore, maybe?",74996843,2013-12-14 00:54:04
2630854,1825352,8360861,38,So I guess we can record the last batch info using a HDFSMetadata. Is this the new-school way for Producer API?,74996843,2013-12-16 15:36:21
2630854,7111,8376545,38,"Actually there are two concerns: the period of time the whole job ran over, and the batching for the store. There may be many stores remember. Some might have different batchers. So each store needs to track when it was last written to disk.

You'll hav",74996843,2013-12-17 01:42:49
2630854,7111,8448965,101,"I think this needs to be the whole method. modifying candidates will not work because that is not persisted between runs.

Think of it this way: readLast is called BEFORE we ever call writeLast, so the candidates will always be empty I think.",78191172,2013-12-19 03:05:11
2630854,7111,8448985,46,I can't see how this works. I think the var has to go and ONLY the filesystem can hold the state. I don't think you need it in any case. See below?,78191172,2013-12-19 03:05:52
2630854,1825352,8482182,46,"Thanks! Made the change accordingly.


On Wed, Dec 18, 2013 at 12:06 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In
> summingbird-scalding/src/main/scala/com/twitter/summingbird/scalding/DirectoryBatchedStore.scala:
>
> > +import com.",78191172,2013-12-20 03:05:37
2630854,7111,8531935,104,wierd spacing.,78225370,2013-12-24 01:35:00
2630854,7111,8531969,84,we could also filter here that it is < exclusiveUB and avoid having to throw below.,78225370,2013-12-24 01:37:35
2630854,7111,8531978,106,"can't we handle this case? If getLastBatchID took exclusiveUB you could just return the old data. I think we want that feature (in fact, I think the planner assumes it).",78225370,2013-12-24 01:38:06
2630854,7111,8535554,84,exclusiveUB needs to be < not <=.,78994069,2013-12-24 04:57:49
2630854,1825352,8535712,84,"If we filter here using ""<"", BatchID which equals to exclusiveUB will never
be returned. Is this what the planner assumes?



On Mon, Dec 23, 2013 at 1:58 PM, P. Oscar Boykin
<notifications@github.com>wrote:

> In
> summingbird-scalding/src/main/",78994069,2013-12-24 05:11:02
2630854,7111,8536019,84,"take a look at:

https://github.com/twitter/summingbird/blob/develop/summingbird-scalding/src/main/scala/com/twitter/summingbird/scalding/ScaldingStore.scala#L88

If I recall correctly, readLast uses an exclusive upper bound (thus the name), while wri",78994069,2013-12-24 05:31:45
2707448,7111,6074683,11,"That really works for Any, right? Is the type parameter needed?",79607316,2013-08-30 03:06:29
2707448,7111,6074815,5,"how about summingbird.storm.option

I am afraid different systems might collide on option names otherwise.",79607314,2013-08-30 03:12:31
2707448,7111,6074828,17,summingbird.storm.option,79607314,2013-08-30 03:13:04
2707449,44018,6049391,10,needs val default = MonoidIsCommutative(false),79607321,2013-08-29 04:14:56
2707449,44018,6049397,10,"Let's keep this in the builder subpackage for now, so we don't break existing imports",79607321,2013-08-29 04:15:12
2707449,44018,6049415,4,"Storm will need it too, so let's move that to MonoidIsCommutative.default",79607321,2013-08-29 04:16:15
2707452,7111,6046284,58,"should we really be putting EmptyService if someone does online or offline only? That seems wrong. I think we should put None in that case, don't you?  I think the CompondService should have option.",79607327,2013-08-29 01:58:41
2707452,7111,6046309,14,add asiegel author tag to give some props.,79607327,2013-08-29 01:59:18
2707452,7111,6046324,4,sad to see the great Monoid give up to Semigroup. :),79607327,2013-08-29 01:59:51
2707452,7111,6046338,45,"seems like we should be putting None in some case here, right?",79607327,2013-08-29 02:00:32
2707452,44018,6047114,58,"Yeah, I agree, but everyone is currently working with that semantic now. I don't want to change CompoundService to take options at this point.",79607327,2013-08-29 02:28:18
2707452,44018,6047529,14,done!,79607327,2013-08-29 02:45:24
2707452,44018,6047535,14,"Thanks, @asiegel34.",79607327,2013-08-29 02:45:32
2707452,44018,6049123,4,:),79607327,2013-08-29 04:00:17
2707452,44018,6049129,45,took care of it by converting the sink and service classes to use Option.,79607327,2013-08-29 04:00:30
2707453,7111,6046064,19,"should we meatlocker the function, or are we okay?

I guess we are meatlockering in scalding, so for consistency, maybe we should.",79607329,2013-08-29 01:51:23
2707453,7111,6046070,19,"In the bolts, I mean.",79607329,2013-08-29 01:51:42
2707456,44018,5968973,16,uncurry that shit.,79607346,2013-08-25 22:06:34
2707459,44018,5953522,30,"No need to rename the final storm in `StormEnv`, since options pointed at `Storm.SINK_ID` apply to the `SinkBolt`.",79607363,2013-08-23 20:37:22
2707459,44018,5953534,4,This applies the name generated when `SourceBuilder` created the `CompletedBuilder` and applies all sink options to the `sumByKey` phase.,79607363,2013-08-23 20:37:51
2707464,44018,5858398,6,"Can you add a high-level comment to the platform that mentions what we were talking about last week? This memoization is a little weird, in that it's not a performance optimization, but actually required to prevent the side effects from happening twice. I",79607384,2013-08-20 05:41:38
2707464,7111,5859375,6,good call.,79607384,2013-08-20 07:18:06
2707477,44018,5637657,14,boilerplate... not sure how we get rid of it.,79607425,2013-08-07 22:35:19
2707477,44018,5637662,35,better for sure.,79607425,2013-08-07 22:35:35
2707480,7111,5546457,3,this is some jank. Let's grep the code and see if we can easily remove the args from the writeStream trait.,79607433,2013-08-02 09:30:57
2707487,7111,5468253,21,"can't we match the type on the Store and if it is one of the o/d HDFS store, get the path out that way?  Since everyone is using that store now, we could even change the old API to require that kind of store (VersionedBatchStore or whatever it is).

I d",79607467,2013-07-30 09:11:12
2707487,7111,5468259,8,I wonder if this makes as much sense if we are keeping mutable state in the platform (should we be composing this way?),79607467,2013-07-30 09:12:16
2707487,44018,5468270,21,"Okay, that sounds right. I can change that in the AM.",79607467,2013-07-30 09:13:08
2707487,44018,5468278,8,"maybe not, since we keep instantiating. I needed the config to create a state instance, but I think you're right.",79607467,2013-07-30 09:14:09
2707488,44018,5467411,50,Did you mean to ignore this?,79607473,2013-07-30 07:30:37
2707488,7111,5467764,50,No I did not. #106 should fix it.,79607473,2013-07-30 08:13:35
2707490,44018,5416095,25,"whoops, reformat happened when I pulled the method out into its own thing. No code changes here.",79607484,2013-07-26 10:21:56
2707490,44018,5416098,7,Moved out to make it easier to create a `Scalding#Source[T]`.,79607484,2013-07-26 10:22:21
2707490,7111,5416123,65,could we use IdentityKeyedProducer here to skip the cast?,79607484,2013-07-26 10:23:57
2707490,7111,5416159,38,"should we do:
```scala
val (l, r) = apply(producer)
(IdentityKeyedProducer(l), IdentityKeyedProducer(r))
```
to preserve the exact same nodes?",79607484,2013-07-26 10:27:34
2707490,44018,5416160,65,"there's an implicit conversion that wraps this with the IdentityKeyed, but you need the cast for the `(K, V)`. You can't do it with the `ev`, since it's an evidence on a type parameter.",79607484,2013-07-26 10:27:36
2707490,44018,5416167,38,yup,79607484,2013-07-26 10:28:35
2707490,44018,5416171,38,done,79607484,2013-07-26 10:29:07
2707495,7111,5387256,16,really worried about this. I expect it to give null reference errors.  I think our whole idea about this is mistaken. I think the closures are only pulled as needed.,79607493,2013-07-25 04:21:49
2707496,7111,5380905,57,"what is the type of scalding? Looks like Unit to me since it is the result of run, right?",79607500,2013-07-25 00:08:40
2707496,7111,5380996,19,"I don't think this should be a case class because I think opts should be private and the constructor should always start empty, otherwise the casts we do internally could fail.",79607500,2013-07-25 00:11:36
2707496,7111,5381019,19,"So I would have a private constructor with the Map, and the public constuctor is empty.",79607500,2013-07-25 00:12:26
2707496,7111,5381050,17,should this possibly be in a summingbird.options.scalding package?,79607500,2013-07-25 00:13:19
2707496,7111,5381069,17,not really a scalding option. Maybe this should be in core.,79607500,2013-07-25 00:13:46
2707496,7111,5381204,21,issue link.,79607500,2013-07-25 00:18:11
2707496,7111,5381211,61,issue link.,79607500,2013-07-25 00:18:31
2707496,7111,5381223,107,issue link.,79607500,2013-07-25 00:18:50
2707496,44018,5381327,21,This note already existed. I'll do another pass to add these issue links.,79607500,2013-07-25 00:22:57
2707496,44018,5381388,61,"I'll do that in the next pass. Again, this is just a text move.",79607500,2013-07-25 00:24:56
2707496,44018,5381407,107,Next pull req.,79607500,2013-07-25 00:25:21
2707496,44018,5381417,57,"ah, yeah. no bind needed. good call.",79607500,2013-07-25 00:25:43
2707496,44018,5381491,19,done.,79607500,2013-07-25 00:28:19
2707496,44018,5381508,17,Trying to keep the source code changes to a minimum for now. We should do a refactor that adds storm and scalding options packages.,79607500,2013-07-25 00:28:54
2707496,44018,5381602,17,moved.,79607500,2013-07-25 00:32:51
2707498,7111,5277009,66,"I'm confused here. I thought bijection 2.9.3 was there, so why do we need this mapping?",79607509,2013-07-19 00:39:45
2707498,44018,5277775,66,Because this is still bijection 0.4.0.,79607509,2013-07-19 01:08:27
2707498,44018,5277822,66,We can upgrade and remove withCross in a separate pull req.,79607509,2013-07-19 01:10:04
2707506,44018,4987073,61,So good. We'll have to start testing arbitrary graphs soon enough.,79607541,2013-07-02 20:25:27
2707509,44018,4973099,73,remove this?,79607557,2013-07-02 02:46:59
2707513,7111,4925432,15,nice,79607574,2013-06-28 01:09:46
2707513,7111,4925520,49,shouldn't that be Local?,79607574,2013-06-28 01:13:02
2707513,7111,4925533,46,can't this be in Storm?,79607574,2013-06-28 01:13:30
2707513,7111,4925545,6,bijection is a bad name here.,79607574,2013-06-28 01:13:52
2707513,44018,4926063,6,I'll just remove this. No one's using DRPC...,79607574,2013-06-28 01:39:15
2707513,44018,4926100,49,"it's in both, I think.",79607574,2013-06-28 01:40:57
2707513,44018,4926114,46,"the base class does have it, but it's initialized with identity.",79607574,2013-06-28 01:41:24
2707513,44018,4926244,49,"oh, yeah.",79607574,2013-06-28 01:46:36
2707513,7111,4926962,58,Can we call makeUuid to make it clear it is different each time?,79607567,2013-06-28 02:17:13
2707513,7111,4926970,67,makeUuid here?,79607567,2013-06-28 02:17:25
2707516,7111,4879188,4,"should be  `run(completed: Producer[P, _]): Unit = run(plan(completed))`",79607590,2013-06-26 03:04:16
2707516,7111,4879263,47,use buildCatchInvert and you won't need to change your code on the new version.,79607587,2013-06-26 03:07:34
2707517,44018,4871617,4,good addish.,79607593,2013-06-25 22:11:58
2707519,44018,4853188,13,"Ah, nice, didn't know about this trick. Presumably we can override with an implicit val. What a damned big language.",79607600,2013-06-25 02:16:58
2707519,44018,4853205,34,Should this be accept an Interval of BatchID?,79607600,2013-06-25 02:17:32
2707519,7111,4853330,34,"wouldn't be as pretty with the inner recursion. This is a private method, not to be used or changed by instances.",79607600,2013-06-25 02:22:10
2707522,44018,4759086,7,Why the Iterable wrapper? So we can go through the stream multiple times?,79607611,2013-06-19 01:48:28
2707522,7111,4759171,7,Iterators are mutable. Just a bad idea to pass them around. Iterable is basically just a closure over iterator.,79607611,2013-06-19 01:51:28
2707522,7111,4759246,7,"Also, we always wanted it as an Iterable/List any way.",79607611,2013-06-19 01:54:14
2707522,44018,4759263,32,Can you add a note about upper-exclusive?,79607611,2013-06-19 01:54:50
2707522,7111,4759491,32,What do you mean upper inclusive? Interval accepts anything. The Iterable is just all the contained items. I think of inclusive/exclusive as having to do with ranges.,79607611,2013-06-19 02:02:19
2707522,7111,4759526,32,"Put another way, if it were exclusive in the sense that the last item was an upper bound, my existing comment would be incorrect: the list would have something that is not in the interval.",79607611,2013-06-19 02:03:27
2707524,44018,4670559,5,We'll need to publish tormenta before we merge.,79607637,2013-06-13 05:24:45
2707524,44018,4670561,7,Broke these out into their own functions so we don't have to instantiate the graph.,79607637,2013-06-13 05:25:07
2707524,44018,4670564,25,Moved to StormLaws,79607637,2013-06-13 05:25:20
2707524,44018,4670572,5,"This was a bug. ""0"" means don't buffer.",79607637,2013-06-13 05:25:56
2707524,44018,4670574,13,"haha, whoops",79607637,2013-06-13 05:26:02
2707524,7111,4670628,137,"this is a spin lock, Probably should sleep at least a few millis in the loop.",79607634,2013-06-13 05:30:28
2707525,44018,4662887,28,typo,79607640,2013-06-12 23:12:25
2707525,44018,4662923,26,How can this functionality only depend on a batcher?,79607640,2013-06-12 23:13:40
2707525,44018,4662952,76,"Let's just do this in this pullReq, since all you need is a map operation.",79607640,2013-06-12 23:14:41
2707525,44018,4662974,138,"comment ""times""",79607640,2013-06-12 23:15:12
2707525,44018,4662997,142,where is this coming in implicitly? Don't see it in the constructor. (Or are you resolving the global mode?),79607640,2013-06-12 23:16:11
2707525,44018,4663007,144,How can this be better?,79607640,2013-06-12 23:16:28
2707525,44018,4663030,11,since....,79607640,2013-06-12 23:17:21
2707525,44018,4663036,9,"What's the ""key log""?",79607640,2013-06-12 23:17:29
2707525,7111,4663214,26,"Magic of Monads.  Keep in mind PlannerOutput is really a function from (Interval[Time], Mode) => Try[(BatchID, BatchID)], and so when this function is run, the timespan is there

Should we change PlannerOutput to PlannerFunction ?",79607640,2013-06-12 23:23:12
2707525,7111,4663236,138,you mean explain what times is?,79607640,2013-06-12 23:23:55
2707525,7111,4663262,142,"scalding Jobs have implicit modes. This is scoped properly in 0.9.0, but now still global.",79607640,2013-06-12 23:24:39
2707525,7111,4663292,144,"We could compute the earliest time we could possibly run, and then return that to reschedule, for one thing. But we are smart, we can make it much better.",79607640,2013-06-12 23:25:54
2707525,7111,4663307,9,just the event log of when each key was written,79607640,2013-06-12 23:26:29
2707525,44018,4663311,144,Would love that as a comment so we don't forget.,79607640,2013-06-12 23:26:34
2707525,7111,4663689,76,"actually this shouldn't be done. It should be done at the code that makes the Source object.

We really don't need the time extractor in the Source, even though our current scalding and storm platforms use it.  A source is just some ordered output of Ts",79607640,2013-06-12 23:40:54
2707530,44018,4641878,33,"Source doesn't yet have time attached. We can't ignore `timeOf` when planning a `Source` node.

`type Source[T] = PlannerOutput[TypedPipe[T]]`",79608209,2013-06-12 00:17:07
2707534,7111,6408340,13,"we could .recover here to make sure a write doesn't drop the downstream.

Is that the right thing or let it fail, and see the restarts in nimbus?",60754725,2013-09-17 20:36:14
2707534,7111,6408440,42,why is this called mappedSpout and not just spout?,60754725,2013-09-17 20:39:53
2707534,44018,6408523,42,"just some artifact of our old case class copying back in the day, probably.",60754725,2013-09-17 20:41:59
2707534,44018,6408550,13,"I say we rescue. We need to do the same thing after service joins, I think. To do this right, I think we need default handlers all over.",60754725,2013-09-17 20:43:13
2707538,44018,4559715,12,I guess we'll delete this once we move this class to chill?,79607702,2013-06-06 06:07:08
2707538,44018,4559721,8,"Look at my jank, calling get. My bad.",79607702,2013-06-06 06:07:33
2707538,44018,4559814,27,"What is T meant to be, here?",79607702,2013-06-06 06:18:19
2707538,44018,4559818,78,Looks like this comment is out of date.,79607702,2013-06-06 06:18:43
2707538,7111,4559906,12,yes.,79607702,2013-06-06 06:28:55
2707538,7111,4559927,27,anything.... It is the return type of a function.,79607702,2013-06-06 06:30:48
2707538,44018,4559942,27,"Yeah, but when you stick it inside of `BatchProducer`, a return value of anything other than `Batch` is non-intuitive.

Also, `+T`.",79607702,2013-06-06 06:33:01
2707538,44018,4559950,27,"Ah, I see, here's the link:

`type PipeFactory[+T] = BatchProducer[TimedPipe[T]]`",79607702,2013-06-06 06:33:41
2707543,7111,4470398,133,We actually hove no way of knowing that this source will not be reached again in the graph (who says this path is the only way to reach it?),60040453,2013-05-31 05:43:02
2707543,7111,4489671,47,"This seems to work at the repl:
```scala
class Test[T] {
  def fm[U](fn: T => TraversableOnce[U]): Test[U] = sys.error(""TO"")
  def fm[U,O](fn: T => O)(implicit ev: O <:< Option[U]): Test[U] = sys.error(""option"")
 }
```
Then we can optimize filters ",60040498,2013-06-01 22:21:34
2707543,7111,4489699,79,"This may need a groupby/join in hadoop/scalding, which means Ordering[K].  I wonder if we should require an Ordering[K] to be a KeyedProducer.

Alternatively, in scalding, the service could require the Ordering, but if that is the case it is not quite a",60040498,2013-06-01 22:25:27
2707543,7111,4489719,19,"TODO: -K, +V should work here (same variance as ReadableStore)",60040498,2013-06-01 22:28:49
2707543,7111,4489724,20,TODO: -K should work here (same variance as storehaus Store),60040498,2013-06-01 22:29:20
2707543,7111,4489765,67,maybe left and right are better names here.,60040498,2013-06-01 22:38:52
2707543,7111,4489775,28,Should have -Event for better variance.,60040498,2013-06-01 22:43:17
2707543,7111,4489790,25,"Need a better comment here. Something like:
```scala
/**
* This bolt is used for intermediate flatMapping before a grouping.
* It leaves the output Tuple with a Schema of (Long, U), which is  to say size = 2,
* and the 0 position has the BatchID, the",60040498,2013-06-01 22:49:12
2707543,7111,4489810,51,TODO: add a `get[T](kls: Class[T]): Option[T]` for easier java access.,60040498,2013-06-01 22:53:54
2707543,7111,4489833,139,"TODO: If we had a OptionMappedProducer we could at this stage go through `toSchedule` and scoop all those into the spout.

Of course, maybe it is better to push all the flatMapping into the spout. I assume it should help since the spouts pull where as a",60040498,2013-06-01 23:03:31
2707543,7111,4489973,79,Tend to think we should drop Ordering in sumByKey and push that on scalding stores.,60040498,2013-06-02 00:02:41
2707543,568000,4502899,40,"what is the ""P"" type represent here? (a comment would be useful)",60040498,2013-06-03 21:05:50
2707543,568000,4502914,67,yes,60040498,2013-06-03 21:06:20
2707543,568000,4502952,79,+1,60040498,2013-06-03 21:07:43
2707543,568000,4503087,60,can we put this in an actual test before merging?,60040498,2013-06-03 21:16:29
2707543,568000,4503139,28,+1,60040498,2013-06-03 21:19:23
2707543,568000,4503240,28,Not a fan of this name. Can we just call it IntermediateFlatMapBolt?,60040498,2013-06-03 21:24:05
2707543,568000,4503375,14,why does the FlatMapBolt now have longs rather than BatchIDs? seems less clear.,60040498,2013-06-03 21:30:32
2707543,568000,4503418,62,can't this be more clearly written with find or collectFirst?,60040498,2013-06-03 21:32:35
2707543,568000,4503482,31,is this the only dependency back on builder left inside summingbird-storm? why are we keeping it around?,60040498,2013-06-03 21:36:35
2707543,568000,4503500,94,"""T"" needs to be a storm option class, right? is there some trait StormOption?",60040498,2013-06-03 21:37:28
2707543,568000,4503535,110,what is this function doing? pick a better name?,60040498,2013-06-03 21:39:01
2707543,568000,4503573,183,full name,60040498,2013-06-03 21:41:00
2707543,568000,4503624,195,"can you define

type StoreFactory[K, V] = () => ReadableStore[K, V]

up top? it'll make this code much more readable",60040498,2013-06-03 21:44:09
2707543,568000,4503643,259,what is this doing / pick a better name,60040498,2013-06-03 21:45:27
2707543,568000,4503659,259,can we declare a lot of the methods in this object private to make it clearer where the entry points actually are?,60040498,2013-06-03 21:46:25
2707543,568000,4503739,110,what do T and U actually represent here?,60040498,2013-06-03 21:51:09
2707543,568000,4503827,41,"it's probably clearer to think about this here rather than in the Storm one, but is there any way to get the type system to do checking for us rather than casting all over the place?",60040498,2013-06-03 21:55:55
2707543,568000,4503942,40,are we saying that it's a platform?,60040498,2013-06-03 22:01:35
2707543,7111,4504183,47,Done in a diff I have.,60040498,2013-06-03 22:13:12
2707543,7111,4504236,28,+1,60040498,2013-06-03 22:15:31
2707543,7111,4504256,14,"Our thinking was that no one but the implementers need to know that, and we want maximum performance, but it could be premature optimization.",60040498,2013-06-03 22:16:37
2707543,7111,4504310,31,"We actually moved those files into summingbird storm (despite the package name), but we wanted as minimal of a code diff as possible, and this is already gigantic.

I agree that we probably want summingbird.storm.options or something, but I would wait f",60040498,2013-06-03 22:18:52
2707543,568000,4504321,14,yeah i think it's better to just keep it as BatchID,60040498,2013-06-03 22:19:08
2707543,568000,4504352,31,fine by me,60040498,2013-06-03 22:20:32
2707543,7111,4504353,94,"It will actually work for anything as it was written, but I agree we need a StormOption class (next diff?)",60040498,2013-06-03 22:20:35
2707543,7111,4504402,110,"It's actually not a terrible name, it is recursing on the enclosing function: buildTopology and supplying it with default arguments to keep code repetition low, but I agree we need more comments.  Also note it is a private inner function.",60040498,2013-06-03 22:22:28
2707543,7111,4504417,183,Probably move to `FlatMapOperation.identity[T]` right?,60040498,2013-06-03 22:23:18
2707543,7111,4504431,195,Nice,60040498,2013-06-03 22:23:51
2707543,7111,4504445,259,"Good idea.

Only `run` is intended to be called.",60040498,2013-06-03 22:24:34
2707543,7111,4504512,41,"Let's talk in person. We don't think we can avoid the cast, but the casts are always safe unless someone does something strange: i.e. the create a new subclass of Source[Memory, _, _] but don't put an Iterator in the S position.

Basically, it seems tha",60040498,2013-06-03 22:27:32
2707543,44018,4512012,195,Done,60040498,2013-06-04 03:38:06
2707543,44018,4512013,183,Done,60040498,2013-06-04 03:38:10
2707543,44018,4512049,110,Added comments,60040498,2013-06-04 03:40:09
2707543,44018,4512065,79,Done,60040498,2013-06-04 03:41:25
2707543,44018,4512071,19,Done,60040498,2013-06-04 03:41:42
2707543,44018,4512076,20,Done,60040498,2013-06-04 03:41:46
2707543,44018,4512081,67,Done,60040498,2013-06-04 03:41:50
2707543,44018,4512084,28,Done,60040498,2013-06-04 03:41:56
2707543,44018,4512085,25,Done,60040498,2013-06-04 03:41:59
2707543,44018,4512088,51,Done,60040498,2013-06-04 03:42:03
2707543,44018,4512093,40,"Just a P, bro. Just a P.",60040498,2013-06-04 03:42:17
2707543,44018,4512109,60,It's not really a test... more an example. We do need to add some real tests.,60040498,2013-06-04 03:43:21
2707543,44018,4512112,28,Done,60040498,2013-06-04 03:43:25
2707543,44018,4512113,14,Done,60040498,2013-06-04 03:43:29
2707543,44018,4512118,62,Done,60040498,2013-06-04 03:43:33
2707543,44018,4512120,94,Next diff.,60040498,2013-06-04 03:43:43
2707543,44018,4512123,259,Done,60040498,2013-06-04 03:43:51
2813872,319889,8951427,26,Should this not be ExclusiveUpper(latestTimeOf(upper) - 1) ?,83170371,2014-01-17 06:01:57
2813872,568000,8974793,26,-1? should this not be +1?,83170371,2014-01-18 01:22:32
2813872,568000,8974967,29,"similar to on line 166, should this be -1?",83170371,2014-01-18 01:28:03
2813872,568000,8975122,33,can we declare them final? :),83170371,2014-01-18 01:33:56
2813872,568000,8975155,33,add a comment here that the result of ftime is an inclusive upper bound?,83170371,2014-01-18 01:34:48
2813872,568000,8975217,21,"can you put a comment about what ""writeTime"" is? (the inclusive upper bound on the time range being processed)

also a class-level comment that the ""pruning"" you're referring to here is completely removing a key from the dataset would be useful.",83170371,2014-01-18 01:36:36
2813872,568000,8975305,13,"explain what you mean by pruning again. also the pruning is by (K, V) and removes full (K, V)s, so the term ""value"" is somewhat confusing",83170371,2014-01-18 01:39:07
2813872,132245,9169329,21,"Would it make sense to have something like (T, Timestamp) => Option[T]? This way you could flatMap kv pairs out of the previous batch instead of just filtering them.

Say you have a T = (K, Map[A,DecayedValue]) and assuming K hasn't been observed in the",83170371,2014-01-25 08:43:32
2813872,132245,9169343,25,neverPruned to be consistent with neverFrozen? Or vice versa.,83170371,2014-01-25 08:44:28
2813872,132245,9169402,26,"Third and last option: Wouldn't that be captured by the contains method of Interval? 
https://github.com/twitter/algebird/blob/0.3.1/algebird-core/src/main/scala/com/twitter/algebird/Interval.scala#L79",83170371,2014-01-25 08:50:21
2813872,319889,9169438,21,That sounds like something that should be covered in the monoid used to combine the maps imo. Keep this one purely for store housekeeping?,83170371,2014-01-25 08:55:15
2820837,7111,8952951,7,"1 shard might actually be sensible, right? Let's force everything through one mapper/reducer?

Should we use shards < 1

Also?",83370349,2014-01-17 06:53:43
2820837,319889,8952975,7,"Yep, will make that change

Also?",83370349,2014-01-17 06:54:43
2820837,7111,8952992,12,"I think we added groupRandomly and shard in the last rc, so let's use that (also, using unseeded Random should be avoided because replays make bucketing non-deterministic (and different than the last time it was run))",83370349,2014-01-17 06:55:28
2820837,7111,8953013,23,nice.,83370349,2014-01-17 06:56:18
2820837,7111,8953740,7,Also.,83370349,2014-01-17 07:32:16
2820837,7111,8953747,7,":) Actually, I have no idea what I was typing when I got distracted. :/",83370349,2014-01-17 07:32:43
2820837,319889,8994666,12,"Updating this, and the original shard call to use shard in scalding. Yey less code too :) ",83370349,2014-01-20 06:22:52
2820837,319889,8994672,7,"Ha, awesome. Updated :)",83370349,2014-01-20 06:23:17
2826737,7111,8975198,10,"these look like caches, so despite being mutable, it is still safe. Is that correct? Can you add a comment to it.",83545639,2014-01-18 01:35:55
2826737,7111,8975243,32,"looks like .getOrElseUpdate. Can you use that if so, makes it easier to reason about what is happening.",83545639,2014-01-18 01:37:24
2826737,7111,8975259,32,"actually, I guess it is not, because you add two keys.",83545639,2014-01-18 01:37:52
2826737,7111,8975270,32,maybe comment to that effect?,83545639,2014-01-18 01:38:06
2826737,7111,8975304,32,"Take that back, you only add one thing to each map. So, I think getOrElseUpdate will work.",83545639,2014-01-18 01:39:07
2826737,7111,8975324,64,log or remove?,83545639,2014-01-18 01:39:27
2826737,7111,8975377,67,"If you get None here, it is because we don't know about the node, isn't that right? Shouldn't we error if that ever happens?",83545639,2014-01-18 01:40:49
2826737,7111,8975433,69,"I think,
```scala
children.map { c =>
  // build some lines from c
}.mkString("""") // this is faster and clearer.
```
",83545639,2014-01-18 01:42:23
2826737,7111,8975549,5,when is this ever called with rootMerge == false ?,83545639,2014-01-18 01:45:45
2826737,319889,8975631,32,"There are two tables being updated in the else, would it not make it maybe more confusing to have one be as the return value and the other inline to the code?",83545639,2014-01-18 01:47:57
2826737,319889,8975642,10,"Yep, will add comment.",83545639,2014-01-18 01:48:14
2826737,319889,8975659,64,Removing,83545639,2014-01-18 01:48:35
2826737,319889,8975724,67,"Was copied from the older code, but your right that looks like the case. I'll change it to an error",83545639,2014-01-18 01:50:12
2826737,319889,8975837,5,"Its recursively called, so the default parameters will kick in to make it false then",83545639,2014-01-18 01:52:43
2826737,7111,8977148,5,"got it. Lines 129, 130 are the cases with root = false.",83545639,2014-01-18 02:25:58
2826737,7111,8979838,32,sure. That's fine.,83545639,2014-01-18 03:53:15
2852291,7111,9058228,26,where is this dep?,84339427,2014-01-22 05:45:23
2852291,319889,9058284,26,"Have to admit, no idea. Took scalidng deps -- scalding specific. I'll prune properly.",84339427,2014-01-22 05:46:41
2852291,7111,9058287,17,"this looks like a move, but why is it a new file?",84339427,2014-01-22 05:46:48
2852291,7111,9058343,15,why not do this TODO now?,84339427,2014-01-22 05:48:04
2876278,319889,9165798,1,Is this needed if the plugin was working already?,85067904,2014-01-25 05:28:34
2876278,38527,9363252,1,"This makes the command actually work, as far as I could tell.",85067904,2014-02-01 08:00:50
2876278,319889,9363624,1,"Ok, it just seemed odd you didn't add the plugin to the plugins file but it wasn't causing an error. SBT works in mysterious ways I guess :)",85067904,2014-02-01 08:31:45
2931806,7111,9448263,25,can we wrap this line?,86865851,2014-02-05 09:12:34
2931806,7111,9448375,33,"this is actually imprecise. in (the output of the sums) will be batched in many cases. The contract on sumByKey is very weak, so it would be like the service only being updated once per batch in the worst case.

I don't like leaking that out to the serv",86865851,2014-02-05 09:17:14
2931806,7111,9448392,60,why the commented out line?,86865851,2014-02-05 09:18:33
2931806,7111,9448533,21,"since on storm, StormStore is sealed, I don't think anything could actually satisfy this on Storm.

Should we go ahead and unseal Store and use the approach in Service, something like:
```scala
trait StormStore[K, V] {
  def batcher: Batcher
  def m",86865851,2014-02-05 09:26:32
2931806,7111,9448560,21,"This, by the way, could always extend Service (get use the batcher to get the Batch for the Item, and then look it up as MergableStore extends ReadableStore).",86865851,2014-02-05 09:27:45
2931806,7111,9448612,13,Can we make a ProxyBatchedStore that extends this for any BatchedStore? How will users use this?,86865851,2014-02-05 09:29:49
2931806,319889,9448691,33,Thoughts on getting that right? Seems like the API out of the merge doesn't support info on the batch to use it,86865851,2014-02-05 09:33:39
2945186,7111,9517879,32,"This was added to scalding:

https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/typed/TypedPipe.scala#L99

We should remove this when release 0.9.0",86941567,2014-02-07 03:54:48
2945186,7111,9518080,28,.service. right?,86941567,2014-02-07 03:59:36
2945186,7111,9518121,21,"could be an object, I guess, while we are cleaning up.",86941567,2014-02-07 04:00:27
2945186,7111,9518133,21,whoops. nope. Has type parameters.,86941567,2014-02-07 04:00:39
2945186,7111,9518355,7,"do you want to add aliases for the types renamed? Otherwise, internal upgrade is going to be a pain.",86941567,2014-02-07 04:06:05
2945186,319889,9518586,21,Would https://github.com/twitter/summingbird/commit/8158cd71bb904d2ad270da0f79ba195cfcfd6779 work? It compiles but I doubt we test this so not sure if it makes sense?,86941567,2014-02-07 04:11:53
2945186,319889,9518612,7,I've added a bunch of aliases in the other branch just now(caught by builder API). I'll actually audit everything I moved/renamed to make sure we've an alias,86941567,2014-02-07 04:12:34
2945186,7111,9518718,21,"I don't think it is a good idea, since there is no variance on service (and probably could never be on the Key).

I'd just leave it as is.",86941567,2014-02-07 04:15:22
2945186,7111,9519296,7,sweet.,86941567,2014-02-07 04:28:22
2946138,7111,9519026,20,why? These look pretty useful for Tsar or others doing operations with batches?,86979968,2014-02-07 04:22:40
2946138,319889,9519369,20,"I couldn't see any uses outside of the scalding platform for it currently. I'd rather be defensive about whats public and not so we know what's safe to change and not? If spark uses it then it might move again, so we don't need more type aliases?",86979968,2014-02-07 04:29:35
2946138,319889,9519411,20,If you want to keep it public i'll add the type alias in scalding and remove it ?,86979968,2014-02-07 04:30:09
2951730,7111,9525278,5,is this true? How did it build before?,86978249,2014-02-07 07:13:02
2951730,7111,9525388,18,"let's remove new. RichDate is a case class (or at least has an apply). in 2.10, it will extend AnyVal and I'm not sure about the boxing story if you explicitly put a ""new"".",86978249,2014-02-07 07:17:48
2951730,7111,9525402,18,"but also, is this really needed if this adds a dependency? Dependency hygiene is a value.",86978249,2014-02-07 07:18:25
2951730,7111,9525436,24,we could just be explicit here: RichDate(low.milliSinceEpoch),86978249,2014-02-07 07:20:01
2951730,319889,9526514,5,"Yeah crazy one alright, turns out it never actually had anything required from summingbird-core",86978249,2014-02-07 08:02:02
2963584,7111,9566672,4,"If this is removed, we will never validate the taps. That is a scalding thing, not a cascading thing. Without this, I don't think there will be any protection against running with missing data.",87821064,2014-02-09 05:52:27
2963584,319889,9567335,4,"The InvalidSourceException was still being triggered, @anirudhtodi was testing and could still see it being hit. Could you confirm that @anirudhtodi ? ",87821064,2014-02-09 09:11:40
2963584,230144,9570200,4,"@ianoc is correct. When the call to validateTaps was removed, and the full day's data wasn't ready for a daily job, an InvalidSourceException was still being triggered. I can double confirm this",87821064,2014-02-10 02:14:05
2963584,230144,9594270,4,@ianoc @johnynek confirmed! The InvalidSourceException is still triggered despite the call to validateTaps being removed,87821064,2014-02-11 01:03:18
2963584,7111,9695941,4,"I think @ianoc tracked that down to the fact that you guys are running these inside scalding jobs that validate all the tabs in the flow.

If we do something similar in summingbird, that sounds fine, but I think if we merge this, pipeFactoryExact will b",87821064,2014-02-13 09:32:50
2987095,7111,9598487,17,"that is weird. you should not be able to add timestamps.  Timestamp + Int or or + Long makes sense, but what does adding two times mean?",88626401,2014-02-11 02:39:59
2987095,7111,9598577,13,"would:

`toTimestamp[Intr[BatchID] <: Interval[BatchID]](b: Intr[BatchID]): Intr[Timestamp]`

allow you to get rid of the cast inside the method?",88626401,2014-02-11 02:42:05
2987095,2221968,9598619,22,IMO toTimestamp(low) && toTimestamp(high),88626401,2014-02-11 02:43:08
2987095,319889,9598635,13,"Um, didn't you try that before? You spent a while on type bounds when you wrote this?",88626401,2014-02-11 02:43:18
2987095,319889,9598685,17,Thats a good point.... will remove it from here. But will add a todo to remove the methods and find/change other call sites of the operator,88626401,2014-02-11 02:44:09
2987095,2221968,9598724,17,"The larger question aside, shouldn't this be:

ExclusiveUpper(earliestTimeOf(upper)) ?",88626401,2014-02-11 02:45:27
2987095,2221968,9598758,20,ExclusiveLower(latestTimeOf(lower)) ?,88626401,2014-02-11 02:46:03
2987095,319889,9598760,22,Intersection == && ? ,88626401,2014-02-11 02:46:03
2987095,7111,9598941,22,yes. +1 to this. Nice catch Joe.,88626401,2014-02-11 02:50:38
2987095,7111,9598963,13,"yeah. You're right. The case matching looks type safe, but it is really a runtime check in 2.9. I think in 2.10 the matcher is smarter and may be able to see this.",88626401,2014-02-11 02:51:23
2987095,7111,9599384,17,"Agree with Joe.

The exclusive UB on Batch covers time that should also be exclusive. Therefore, the earliest time in that batch is the least upper bound. Right?

I may have made this error originally.",88626401,2014-02-11 03:03:23
2987095,7111,9599395,20,+1,88626401,2014-02-11 03:03:36
2987095,7111,9602271,9,"can we put the type on a public API, Long?",88626402,2014-02-11 04:19:42
2987095,7111,9602343,9,"Fuck….

Actually, let's be pro-style, we know we are going there: how about a `case class Milliseconds(toLong: Long)`? Clearly that is where we are heading here. In 2.10 this can extend AnyVal and it is free.",88626402,2014-02-11 04:21:09
2987095,7111,9602358,6,should this be the `other: Milliseconds`?,88626402,2014-02-11 04:21:30
2987095,319889,9602765,9,Done,88626402,2014-02-11 04:30:17
2987746,7111,9609303,4,"minor, can we call this storm-test?",88502681,2014-02-11 07:29:38
2987796,7111,9610222,5,"can we do the same for ProxyStore? Seems like that will will probably be broken too, right?",88503862,2014-02-11 08:08:29
2987796,38527,9644435,5,will do,88503862,2014-02-12 04:35:39
3019582,7111,9657300,57,"This is repeated in TestSink.scala, right?",88897957,2014-02-12 13:20:26
3090254,7111,9979209,33,this should no longer be needed. This was added to Algebird as the default for tuples.,91440976,2014-02-24 08:14:20
3090254,7111,10062541,32,why is this better than the default Semigroup?,91975881,2014-02-26 06:50:36
3090254,7111,10062712,9,"this is still unclear to me.

So, from the above, it seems that we are using this number to be the max number of keys in a cache on the flatmappers, and then using the fact that Maps can be summed, and then emitted as a single batch.

Can you explain ",91975881,2014-02-26 06:56:38
3090254,7111,10062758,60,"can you comment about the Int here? I think it is a number between 0 and summershardmultiplier, but it is a bit abstract as to what it really means. Also, it looks like we can only use that number of summers, past that an we would get no use, right? I'm a",91975881,2014-02-26 06:58:12
3090254,319889,10062796,9,"So we can't just emit the cache as a list of keys, we need an outer key grouping. Since we are on a key grouped level, we need to have a stable mapping of K -> OuterK. Here we are configuring a setting of how big the space we should map the original K int",91975881,2014-02-26 06:59:39
3090254,319889,10062858,60,"The int is a number between 0 and keyValueShards, or the number of summers configured in the topology * the expansion multiplier.

So for however many summers we should always have ShardMultiplier number of segments that should go there",91975881,2014-02-26 07:01:29
3090254,7111,10071392,5,shouldn't this go in AllOpts and get a comment? I really don't know what this does.,92229038,2014-02-26 15:27:41
3090254,7111,10071499,66,"I think this is a big cost in complexity: you have to set summer parallelism twice: once for storm, once for this modulus to be correct. Also it is undocumented.

I'd like to find a cleaner way to do the batching. Can we query storm to get the paralleli",92229038,2014-02-26 15:33:39
3090254,319889,10089252,5,"Its not there because its not a user set variable, not really sure where it should go. I didn't want to pass around an integer. It contains the size space which to mod the hash of the key into. (calculated in storm platform)",92229038,2014-02-27 00:27:39
3090254,319889,10089420,66,"I'm not sure why we need to set the paralellism twice? we reach into the graph to get the paralellism to be used for the summer node. So its only done the once. The documented/user controlled variable is the Multiplier.

When would we query storm? Would",92229038,2014-02-27 00:31:44
3090254,319889,10089464,66,"on ""
I'm not sure why we need to set the paralellism twice? we reach into the graph to get the paralellism to be used for the summer node. So its only done the once. The documented/user controlled variable is the Multiplier.

""

There might be a bug ",92229038,2014-02-27 00:32:54
3090254,7111,10110498,5,Should it be private in that case?,92229038,2014-02-27 09:49:57
3090254,319889,10110517,5,"Yep, will change",92229038,2014-02-27 09:50:39
3090254,7111,10110535,66,"I didn't understand that there were some settings not from the users. Can you add comments to the ones that are not? Since they are following the pattern we use for user set variables, I was confused.",92229038,2014-02-27 09:51:48
3090254,7111,10110575,66,What about a method on summerShards: `summerIdFor(k: K) => Int` and put that code in there? That encapsulation is nice since the mod and size are kept as a detail there.,92229038,2014-02-27 09:53:56
3090254,7111,10110610,14,"why wrapping S here rather than leave it opaque? Seems like the previous PR did the opposite: move from `(Timestamp, T) => T`, here we are taking (what I think) is an opaque parameter `S` and putting structure we don't use. Why not just instantiante with ",92389113,2014-02-27 09:56:03
3090254,7111,10110673,64,ahh... here is where you use the concrete nature of InputState. This is new right?.,92389113,2014-02-27 09:59:33
3090254,7111,10110691,12,"is this a user variable, or an internal one? If it is internal, can it be private to this package?",92389113,2014-02-27 10:00:25
3090254,319889,10110695,14,I use the InputState portion further down in the Summer class now for fan out. I could put S in the type parameter of Summer to be S <: InputState[_] ? ,92389113,2014-02-27 10:00:39
3090254,319889,10110711,64,"Yep exactly. S <: InputState[_] compiles nicely though, so we could use it?",92389113,2014-02-27 10:01:23
3090254,7111,10110717,12,"Also, why would I set this to any particular value? I don't know what ""the multiplication of the number of summers we want to partition this space into"" really means. Can you give an example in the comment?",92389113,2014-02-27 10:01:37
3090254,319889,10110724,12,"This is a user variable right now, In one sense to drop the number of variables users should/can configure I wouldn't be opposed to making it internal unless we have a compelling need?",92389113,2014-02-27 10:02:01
3090254,319889,10110759,12,"Adding:
  E.g. if you have this value set to 10, and you run 5 summers. The key's will be hashed/partitioned into 50 buckets.
",92389113,2014-02-27 10:04:28
3090254,7111,10110819,64,BTW: This seems super easy to get wrong. `fanOut(size)` seems more intuitive.,92389113,2014-02-27 10:08:14
3090254,7111,10110907,64,"Also, state.fanOut can throw, but that will cause an exception, not return a Future.exception. What about:
```scala
try {
  // code you have above here
}
catch {
  case t: Throwable => Future.exception(t)
}

```",92389113,2014-02-27 10:13:54
3090254,7111,10110967,4,why is 1 not enough here? Can you add a comment.,92389113,2014-02-27 10:17:47
3090254,319889,10110984,4,"This really came from Aaron, i think some sort of notion that incase the space gets lob sided in some manner. I can't really see why it shouldn't be one if everything is well behaved.",92389113,2014-02-27 10:18:43
3090254,7111,10111366,65,"size > 0 or we would not have recieved anything, right? Can we put:

assert(size > 0, ""Input maps must be non-empty"")

else, we are not going to do the acking correctly, right?",92508222,2014-02-27 10:43:33
3102368,7111,9979494,33,"you might want this behavior:
https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/GeneratedAbstractAlgebra.scala#L7

to make sure sumOption optimizations are not lost (which are pretty important on several",91686544,2014-02-24 08:46:11
3102368,319889,9979506,33,"Ah yes, perfect thanks, I'll add it",91686544,2014-02-24 08:47:05
3102368,319889,10002147,33,"I put a small helper function in there to get around the Any type + implicit, so I can use the generated ones.",91686544,2014-02-25 01:15:44
3102368,7111,10005052,58,where is the batch added now?,91854718,2014-02-25 02:18:02
3102368,7111,10005075,19,"I see, this was added to put the batchId in.",91854718,2014-02-25 02:18:38
3102368,7111,10005207,92,is there no proxy for mergeable?,91854718,2014-02-25 02:21:27
3102368,319889,10005356,92,Does a mergeable proxy make sense if we are changing the type? ,91854718,2014-02-25 02:24:52
3102368,7111,10012061,112,"so, this is not the monoid on line 353. You are always taking the new value. The monoid on Time is a + b = b, not a + b = max(a, b)

This might be an acceptable approximation. But why introduce this approximation? What do we win by doing this?",91876908,2014-02-25 04:42:52
3102368,7111,10012113,165,shame to lose the type here. Why do we need to?,91876908,2014-02-25 04:43:48
3102368,319889,10012166,112,"not sure I follow here, I might have a bug -- The store itself doesn't contain the TS value. So though we have it from the inbound KV, so we attach its TS onto the value returned from the store ?",91876908,2014-02-25 04:44:46
3102368,319889,10012742,165,Not sure why...  i think an over-look ahead to do with possibly merging future FM ops into this thing. Anyway those aren't there now. Type fixed up on it,91876908,2014-02-25 04:56:04
3102368,7111,10026505,18,"this is new, right? Adding on a flat map operation directly?",91904569,2014-02-25 14:29:09
3102368,7111,10026536,44,"is this still operative? Can you double check? It looks old, and if it is still a TODO, can we link to an issue?",91904569,2014-02-25 14:31:58
3102368,7111,10026565,60,"Kb was KeyBatch, can we rename if we are removing batch (and while you are at it, join the line above with the previous)?",91904569,2014-02-25 14:34:17
3102368,7111,10026595,62,how does this work? innerKb is of type Key? Will this compile if you say: val k = innerKb._1? I think this might be using match and might fail at runtime if innerKb is not a tuple2 at runtime.,91904569,2014-02-25 14:36:40
3102368,7111,10026633,66,I'm very suspicious of this cast. I see no reason why it should be here. At the very least a comment to clearly explain.,91904569,2014-02-25 14:38:44
3102368,7111,10026753,18,Why do we need this rather than make a combinator on AsyncBase directly? Can't we glue two together?,91904569,2014-02-25 14:45:32
3102368,7111,10026810,23,"can we put the `[T, K, V]` types here to better document? I don't think this method needs to have Any everywhere and can at least be type safe inside, right?",91904569,2014-02-25 14:49:35
3102368,7111,10026834,48,"is the cast needed here and on line 254? Seems like a double cast. I'd rather it only here, and on line 254. we still have the correct types.",91904569,2014-02-25 14:50:58
3102368,7111,10026860,23,"Also, can we move this somewhere as a non-inlined method? Seems very related to the other wrap method below.",91904569,2014-02-25 14:52:18
3102368,7111,10026890,65,"does not seem like the right place for this. Also, can you put T, U as the types here? No need to use Any.",91904569,2014-02-25 14:53:42
3102368,7111,10026922,65,"PS: this is really the same operation as flatMapValues, so I would tend to think it could go in Online only:

```scala
FlatMapOperation[V, U] => FlatMapOperation[(K, V), (K, U)]
```
you could similarly do one for flatMapKeys (or just reuse this with ",91904569,2014-02-25 14:55:41
3102368,7111,10026970,80,can we possibly remove the cast?,91904569,2014-02-25 14:58:04
3102368,7111,10027068,111,"this is not the semigroup here. You are not using the `implicitly[Semigroup[Timestamp]]` Update it to something like:

```scala
val semigroup = {
  implicit val tsSg = new Semigroup[Timestamp] {
    def plus(a: Timestamp, b: Timestamp) = b
    overr",91904569,2014-02-25 15:04:25
3102368,7111,10027095,115,"lets add a comment at least that this timestamp is not accurate if there are out-of-order packets. We assume commutativity elsewhere, but this semigroup is not commutative.",91904569,2014-02-25 15:06:45
3102368,7111,10027133,141,can you put a line break after the =?,91904569,2014-02-25 15:08:58
3102368,7111,10027255,116,"this is problematic, because it is hiding the fact (and was before) that it is only returning the values from the online store. The offline store result is also needed. None in the _1 part of the tuple may be a lie.",91904569,2014-02-25 15:16:49
3102368,7111,10027279,136,"again, throwing away the batchId and pretending that optiVWithTS covers all time is incorrect. We need an issue here. Any downstream consumers of this are incorrect online.",91904569,2014-02-25 15:18:28
3102368,7111,10027382,151,can we line break after each comma in the params?,91904569,2014-02-25 15:22:59
3102368,319889,10048373,44,"Can't find a TODO on any of the definitions around it, killing comment",91904569,2014-02-26 01:19:46
3102368,319889,10048746,60,"If I join the lines it'll be a 122 char line, better split over 2 or thats ok?",91904569,2014-02-26 01:27:04
3102368,319889,10048762,66,Yeah this cast seems bad.... will remove/test,91904569,2014-02-26 01:27:19
3102368,319889,10051526,18,"Combining two async's? the return types of apply/tick in AsyncBase make this quite tricky. Having all our bolts include FM operations seems like it might be handy ? (standard, and we can plan downstream maps/option map's etc.. into the back of a summer?).",91904569,2014-02-26 02:24:57
3102368,319889,10051678,65,"These wrap the inbound and outbound and stitch the two together? the latter half is a map keys but we maintain the state? Are you suggesting wrap up the call thats specific here (with the generic), call it something and put it into flatmap operation direc",91904569,2014-02-26 02:27:53
3102368,319889,10051800,111,"I'm not sure I follow here, why isn't the default Monoid on Timestamp being used here? its to take the max already right?",91904569,2014-02-26 02:30:41
3102368,319889,10051956,116,"True, we do only guarantee its the previous value in the store for this key(which unfortunately in this store means only within this batch). Deciding what this should look like sounds like something for another issue though?",91904569,2014-02-26 02:34:15
3102368,7111,10059511,138,"maybe put the cast here [K, V]?",92141696,2014-02-26 05:28:47
3102368,7111,10059537,142,Semigroup[V] because we should only require a semigroup.,92141696,2014-02-26 05:29:14
3102368,7111,10060407,5,can we mark this Serializable just to reduce chances that we have issues?,92141696,2014-02-26 05:48:12
3102368,319889,10060772,5,Done,92141696,2014-02-26 05:57:35
3102368,7111,10061282,117,can we remove this please?,92141696,2014-02-26 06:11:46
3102368,319889,10061318,117,Done,92141696,2014-02-26 06:12:49
3102368,7111,10061653,66,"this is lazy (iterator). can you comment that is okay because the AsyncBase will always go through the whole list exactly once to put the results on to storm (the emit phase).

But I'm worried here that the success handler is lost if there is no downstr",92191037,2014-02-26 06:22:32
3102368,7111,10061922,189,are these casts needed? I don't think they are. I think your code compiles without them.,92191037,2014-02-26 06:30:09
3102368,319889,10062013,66,"I think this is just a bug, i don't think we can/want to guarantee that its forced to materialize downstream. I've added a toList to force it at the end of the function. (Keeping the toIterator here so we don't materialize the intermediate list)",92191037,2014-02-26 06:33:12
3102368,319889,10062094,189,"[error] Note: (com.twitter.summingbird.batch.Timestamp, T) <: Any, but class BaseBolt is invariant in type I.
[error] You may wish to define I as +I instead. (SLS 4.5)
[error] Note: ((K, com.twitter.summingbird.batch.BatchID), (com.twitter.summingbird.b",92191037,2014-02-26 06:36:05
3102368,7111,10062220,189,ahh. Yes. I forgot about the Timestamp,92191037,2014-02-26 06:39:09
3135343,319889,10131255,34,"This looks like we'd end up with a pretty similar error message, available = x, desired = y. vs no intersection between x and y?",92649487,2014-02-27 23:53:43
3135343,319889,10131282,44,Can you put this back on the line before,92649487,2014-02-27 23:54:11
3135343,319889,10131332,50,indenting looks off here?,92649487,2014-02-27 23:55:07
3135343,319889,10131354,45,looks like tryRange might fit all on one line?,92649487,2014-02-27 23:55:28
3183491,7111,10310686,71,should this be a val?,94092884,2014-03-06 01:10:55
3183491,319889,10310753,71,"Sorry, should really just be undefined for the concrete class to specify it . Going for the notion its a def here, but a val in the concrete class so the clean up will work ok from here.

(If we decide to keep the MultiTriggerCache it can hopefully just",94092884,2014-03-06 01:13:08
3183491,7111,10310856,29,"cute name, but can we think about a more descriptive name? Something that captures something about the approach would be great.",94092884,2014-03-06 01:15:38
3183491,319889,10310899,29,AlternatingSummingCache?,94092884,2014-03-06 01:16:31
3183491,814892,10328615,98,"Trying to understand the CacheSize class..
Wouldn't the two calls to cacheSizeOpt.size.get in this class return different values? Is that okay for this case?",94166432,2014-03-06 08:44:14
3183491,814892,10328854,54,doesn't seem like this method is being used,94166432,2014-03-06 08:54:21
3183491,319889,10490282,98,"Yeah this is just badness, i'm not entirely sure why we have the fudge factor on the CacheSize, but this isn't good. Will change it to the one call.",94166432,2014-03-12 01:08:27
3183491,319889,10490304,54,"Good catch, fell out of use in some refactor. Will update",94166432,2014-03-12 01:08:47
3183491,44018,10490517,98,"yeah, no docs there :) It's because if all the cache sizes are the same, storm will buffer in every bolt for roughly the same period and then EMIT!!! Then the network dies and @singhala commits seppuku.

The fuzz allows buffering, with a good distributi",94166432,2014-03-12 01:12:19
3183491,319889,10490607,98,"Ahhh, thanks for the info. I wonder if we need it anymore with the MaxEmitForExecute options, seems it still didn't like cache flushes... locks up all the queue insertion points :) Doesn't do any harm anyway",94166432,2014-03-12 01:14:03
3183491,164018,11141460,29,typo: Background,95254192,2014-04-01 04:02:18
3183491,164018,11141732,58,"FYI: You can get notified of the reaching a memory threshold after garbage collection using ManagementFactory.getMemoryMXBean()
The downside of using runtime.freeMemory is that it will only decrease once a GC has gone through. So it will underestimate th",95254192,2014-04-01 04:11:22
3183491,164018,11141794,2,2014?,95254192,2014-04-01 04:13:01
3183491,164018,11141801,2,2014?,95254192,2014-04-01 04:13:11
3183491,164018,11141811,33,typo: Background (2x),95254192,2014-04-01 04:13:38
3183491,164018,11141862,8,flaky test fix? Is there a better way?,95254192,2014-04-01 04:15:02
3183491,319889,11142065,8,"Nah, not with the storm local cluster modes as they are alas. We can't have both tick tuples and the storm feature of run test till all acked. It was still flaky with that, but less so. And had less code coverage for us. ",95254192,2014-04-01 04:22:20
3183491,38527,11182817,90,"I'm wondering if this needs to be a concrete implementation at all. I mean, can't this function on any AsyncCache? The only difference between this and any other AsyncCache is the fact that there is a background process shooting off compactions. I guess t",95254192,2014-04-02 02:24:52
3183491,319889,11183240,90,"Well it needs to be a concrete class, if it can be a shared one though. It probably could be, though i'd leave it to future refactoring. Auto-selection on these and some classification of the caches need to be done...",95254192,2014-04-02 02:33:45
3183491,319889,11183432,58,"Good idea, filed https://github.com/twitter/summingbird/issues/492 , this is used in other caches, we probably should fix it globally/make it common",95254192,2014-04-02 02:38:22
3183491,38527,11183538,90,Fair. Fix the typos and whatnot and it lgtm.,95254192,2014-04-02 02:40:36
3191592,319889,10370069,5,what does this collide with?,94310228,2014-03-07 08:22:51
3191592,319889,10370081,6,Do these collide with something?,94310228,2014-03-07 08:23:18
3191592,38527,10370132,6,all of these changes are primarily because the big imports collide with the deprecated types in the package objects,94310228,2014-03-07 08:25:34
3191592,319889,10391245,6,"Right, but then we should be mapping the old deprecated ones away than mapping away the ones you use?",94310228,2014-03-08 00:34:22
3191592,38527,10391488,6,"Is there a way to map away imports in the same package object? Might be me
missing the forest for the trees, I wasn't sure how as that's initially
what I wanted",94310228,2014-03-08 00:40:38
3225410,319889,10485109,18,"Looking at this in more detail, it looks like this Should be a PrunedSpace, and if we want a PrunedSpace apply method that takes the pruning function?

def apply(fn: (K,V), Timestamp) => Boolean) = new PrunedSpace....",95104134,2014-03-11 23:27:23
3275588,319889,10682079,23,"Shouldn't this inherit from https://github.com/twitter/storehaus/blob/develop/storehaus-core/src/main/scala/com/twitter/storehaus/Proxy.scala#L57

And use self rather than proxy? -- Also is this not just a proxy readable store? ",96957330,2014-03-18 04:27:25
3275588,814892,10682476,23,+1 to this,96957330,2014-03-18 04:39:45
3275588,132245,10683034,23,I basically copied the approach for the BatchedStore proxy - https://github.com/twitter/summingbird/blob/develop/summingbird-scalding/src/main/scala/com/twitter/summingbird/scalding/store/ProxyBatchedStore.scala#L28. I could change the ProxyBatchedStore t,96957330,2014-03-18 04:55:40
3275588,319889,10683434,23,"This is storehaus related code so I think we can reasonably say it should be consistent with it.

Do we have a situation where the dependency injection can't be done with a readable store? ClientStore should probably be exposed as just a readable store ",96957330,2014-03-18 05:07:05
3275588,132245,10683962,23,"ClientStore is already a ReadableStore so you could use combinators in any case.

You are right though, proxying a ReadableStore would have been sufficient for my use case - it simply didn't occur to me. Though I am pretty sure that guice would joke due",96957330,2014-03-18 05:24:00
3362484,164018,11050657,6,/** Semigroup is half-standing */,99569330,2014-03-28 05:51:44
3363570,319889,11085111,39,"extra WS, why?",99604851,2014-03-29 02:52:55
3363570,319889,11085133,65,Removed newline at end of file?,99604851,2014-03-29 02:53:22
3363570,622449,11085364,39,"no newline between methods?
I can remove them if you want.",99604851,2014-03-29 02:59:12
3363570,319889,11085415,39,"Yeah, for trivial/noop we normally don't add in all the ws",99604851,2014-03-29 03:00:31
3385015,319889,11182140,4,ORLY?,100011853,2014-04-02 02:10:47
3385015,319889,11182153,26,"Only goto that worker, its an important limitation of this since it can cause hot spots",100011853,2014-04-02 02:11:21
3440311,13840,11352894,51,"Are we okay with `mapValues` being lazy here? (i.e., every time the value is accessed the `_.onFailure { _ => multiMergeTupleFailedMetric.incr() }.unit` will get re-executed.",101823938,2014-04-07 21:45:37
3440311,319889,11352988,51,"I would have thought the coerce to a Map would avoid that, but map like probably appears like a map. best way to stop the repeated lazy evaluation? I could map instead?",101823938,2014-04-07 21:47:28
3440311,13840,11353185,51,"Yeah, I usually just `map` instead unless the laziness is really required/desired. It may not be an issue here though, I'm not too familiar with the details on how it's used.",101823938,2014-04-07 21:52:07
3440311,319889,11353265,51,"Doing it multiple times while probably not dangerous to the results seems
possibly wasteful at least. Will change it, thanks


On Mon, Apr 7, 2014 at 9:52 AM, Ryan LeCompte <notifications@github.com>wrote:

> In
> summingbird-storm/src/main/scala/com/twit",101823938,2014-04-07 21:53:49
3440311,13840,11356336,79,Here too?,101827890,2014-04-07 22:58:22
3440311,13840,11356345,101,And here too?,101827890,2014-04-07 22:58:29
3440311,319889,11358104,101,"Sorry my bad, should have looked for more instances of it.",101827890,2014-04-07 23:30:44
3440311,38527,11443978,5,"This isn't a blocker at all, but this is one of my least favorite things about scala and how it handles long lists of type parameters. Is there a better pattern out there for giving meaning to type parameters? I O S D RC W T F?",101847508,2014-04-09 21:17:17
3440311,38527,11444663,33,"This is exposing my ignorance of storm a bit, but if there are multiple stores, how do we avoid their stats trampling on each other? #askdumbquestions",101847508,2014-04-09 21:31:45
3440311,38527,11445574,26,"Is it overkill to use the Reader here? Would make intent explicit, but it's also fairly isolated.",101847508,2014-04-09 21:54:02
3440311,319889,11448633,33,"Multiple stores cannot exist inside one bolt per our current designs, each one will have its own(i.e. one summer/aggregator per layer)",101847508,2014-04-09 22:53:43
3440311,319889,11448669,26,"Its reasonably isolated, and also would break all the similarly interfaced calls around here",101847508,2014-04-09 22:54:16
3611010,7111,12247767,22,"if you are not doing variance in this API, and you are keeping JProducer invariant, I think it is fine to just T.",106324219,2014-05-03 01:53:18
3611010,7111,12247789,16,"make this invariant, require JProducer<P, T>",106324219,2014-05-03 01:53:34
3611010,7111,12247814,32,"I think ```Sink<P, ?, T>``` and invariant everywhere.",106324219,2014-05-03 01:54:15
3611010,7111,12247885,21,"could add a constructor from `JProducer<P, Tuple2<K, V>>` right?",106324219,2014-05-03 01:55:52
3611010,7111,12248039,30,"move this function to the Java API. It is not type safe, should not be in core.",106324219,2014-05-03 01:59:50
3611010,164018,12252418,30,"I removed my function already.
This is the existing implicit converter used explicitly.
It is probably not type safe anymore because of erasure.",106324219,2014-05-03 04:24:59
3611010,164018,12252461,16,"Yep, I agree.",106324219,2014-05-03 04:27:21
3611010,7111,12258321,30,I still see the toKeyed. I think this should only be a static method in the javaapi package. I am afraid of people using it in scala where it will almost always be an error.,106324219,2014-05-04 02:50:47
3611010,164018,12308178,48,"I'm thinking of removing that 2nd type parameter in Store, Service, Sink, ...
This is the actual type used by the platform, but the Producer API does not care at that point because those types have been erased by the scala compiler and replaced by Object",110773765,2014-05-06 06:22:54
3611010,7111,12310483,48,"This also allows people to write ill-formed jobs, and that will happen frequently. The confusion around why online stores are different from offline stores will be amplified.

This kind of type parameter is called a phantom type, and it is there to ensu",110773765,2014-05-06 09:23:50
3611010,7111,12391933,83,add issue on algebird linking to this that we can move to algebird-java,110773773,2014-05-07 23:00:46
3611010,7111,12392050,5,skeptical here. Why not just use scala.Tuple2?,110773773,2014-05-07 23:02:34
3611010,7111,12392458,49,Does using java.lang.Boolean not work here? Can you add a comment as to why not?,110773773,2014-05-07 23:10:33
3611010,7111,12392741,4,why was this added?,110773773,2014-05-07 23:15:17
3611010,7111,12392860,47,can you exercise your lookup code here?,110773773,2014-05-07 23:17:21
3611010,164018,12401961,5,"oops, I eventually just used Tuple2. This should be deleted.",110773773,2014-05-08 01:53:16
3611010,164018,12402252,49,"I think it does not work because scala erases the references to scala.Boolean (and scala primitive types in general) to Object.
The signature of Producer.filter is as follows:
```public abstract com.twitter.summingbird.Producer<P, T> filter(scala.Functi",110773773,2014-05-08 01:57:44
3611010,164018,12402339,4,"probably inadvertently when I added and then removed toKeyed.
I will remove it.",110773773,2014-05-08 01:59:18
3611010,164018,12402376,47,"that's what I'm doing, right?",110773773,2014-05-08 01:59:53
3611010,164018,12402517,47,"the test uses it there:
https://github.com/julienledem/summingbird/blob/e0650681f061e384211e1b38a591cd47796dc70d/summingbird-core/src/test/java/com/twitter/summingbird/memory/javaapi/TestJMemory.java#L35",110773773,2014-05-08 02:02:06
3611010,164018,12403754,83,https://github.com/twitter/algebird/issues/316,110773773,2014-05-08 02:24:29
3611010,164018,12448432,83,"and pull request:
https://github.com/twitter/algebird/pull/317",110773773,2014-05-09 00:38:23
3611010,38527,12556979,5,where does K and V come into play?,110773774,2014-05-13 03:15:22
3611010,38527,12557062,3,why do we have this as opposed to AbstractFunction2? Is it to be a cleaner override statement? For the multiple inheritance (since it is an interface)?,110773774,2014-05-13 03:17:25
3611010,38527,12557132,16,"we introduce a Filter, but here we use a predicate. Why the proliferation of types?",110773774,2014-05-13 03:19:07
3611010,38527,12558502,32,Option.empty returns this,110773774,2014-05-13 03:54:10
3611010,38527,12558593,3,"we have filter, we have predicate, we have function... we should really consolidate the types around this stuff.",110773774,2014-05-13 03:57:13
3611010,38527,12558635,35,"what happens if they pass null? This may trip up. In scala this shouldn't be possible but from Java it may be. If you call Option.apply, a null will become a None. Or you can throw an exception.",110773774,2014-05-13 03:58:29
3611010,38527,12558702,5,"same as above...what value does K, V have in these cases? we don't use it",110773774,2014-05-13 04:00:15
3611010,38527,12558916,49,"knowing this, couldn't we manage that? Like, we reference java.lang.Boolean and convert to scala.Boolean where necessary, and so on?",110773773,2014-05-13 04:06:12
3611010,38527,12558958,58,is there a compelling reason to use the full class name here?,110773774,2014-05-13 04:07:23
3611010,164018,12559229,49,This is what this method is for. Check where it is used.,110773773,2014-05-13 04:15:56
3611010,38527,12559286,15,It was added to summingbird presumable so that the two alsos will have different method signatures and the jvm won't barf.,110773774,2014-05-13 04:17:44
3611010,164018,12559315,5,"They are the type parameters defined in ```Platform#Buffer[K,V]```
https://github.com/twitter/summingbird/blob/8d16fad346885bfcd75de5459fd74805cba4cc37/summingbird-core/src/main/scala/com/twitter/summingbird/Platform.scala#L32
K is the key we do the joi",110773774,2014-05-13 04:18:27
3611010,164018,12559336,3,"To play nicely with java 8 we need an interface that defines 1 method.
that way we can pass a lambda to map, flatmap etc",110773774,2014-05-13 04:19:18
3611010,164018,12559401,16,"Similarly, we need an interface that defines one method for lambdas. To return a primitive type (boolean) it is easier to define a specific interface here. This is also consistent with the new APIs coming in java 8.",110773774,2014-05-13 04:21:45
3611010,164018,12559417,32,ok,110773774,2014-05-13 04:22:08
3611010,164018,12559472,3,"Oops, Filter should be deleted, it was there before I introduced Predicate (which is more consistent with the java 8 APIs).",110773774,2014-05-13 04:24:17
3611010,164018,12559489,35,I will fix this.,110773774,2014-05-13 04:25:03
3611010,164018,12559507,5,They are used when passed to the Producer methods.,110773774,2014-05-13 04:25:47
3611010,38527,12559511,53,formatting,110773774,2014-05-13 04:25:55
3611010,164018,12559527,58,"I will fix that, it dates from before I made this class JProducer.",110773774,2014-05-13 04:26:20
3611010,164018,12559546,15,So the right thing is to pass null then?,110773774,2014-05-13 04:26:58
3611010,164018,12559551,53,will do,110773774,2014-05-13 04:27:13
3611010,38527,12561195,5,"Right, but I mean, we never use them on our side of the code, right? There's no connection?",110773774,2014-05-13 05:03:21
3611010,38527,12561208,3,Can you add that as a comment somewhere? makes sense.,110773774,2014-05-13 05:03:48
3611010,38527,12561242,15,yep,110773774,2014-05-13 05:04:51
3611010,164018,12601231,5,"It is checked here:
https://github.com/julienledem/summingbird/blob/d88553b193c24b39175bb19e3bab46deb5006997/summingbird-core/src/main/java/com/twitter/summingbird/javaapi/JKeyedProducer.java#L28
The platform will provide the right types. Those paramete",110773774,2014-05-13 23:45:46
3611010,164018,12601344,5,"I can not express that in java but BUFFER is ```SOMETHING<K,V>``` and the Platform provides the right type.
See for example with Store:
https://github.com/julienledem/summingbird/blob/d88553b193c24b39175bb19e3bab46deb5006997/summingbird-core/src/main/ja",110773774,2014-05-13 23:47:20
3657439,38527,12561324,25,"Where do we stand on author tags? They are in some places, aren't in others. seems like git blame would be good enough to me but I dunno. @johnynek @ianoc @sritchie ?",110239198,2014-05-13 05:08:45
3657439,319889,12561351,25,I'm not sure we use them at all in the SB OSS do we?,110239198,2014-05-13 05:09:50
3657439,38527,12561372,25,I didn't think so.,110239198,2014-05-13 05:10:43
3657439,319889,12561387,29,"Comment on this, + what that return type means/does",110239198,2014-05-13 05:11:44
3657439,319889,12561404,29,"Maybe better to define a trait that has that function on it

trait Incrementor {
def incrBy(by: Long): Unit
}

so we aren't dealing with Function1's",110239198,2014-05-13 05:12:26
3657439,319889,12561410,33,Comment as to why we needed to do this,110239198,2014-05-13 05:12:38
3657439,319889,12561435,18,Comment as to why this is a partially applied function,110239198,2014-05-13 05:13:41
3657439,38527,12561452,36,"Can you comment on the reason why this exists?

Also, since you don't need the result, you can optionally do Try { Class.forName(s+""$"") } to cut down on space taken",110239198,2014-05-13 05:14:19
3657439,319889,12561467,12,Should be moved into its own file,110239198,2014-05-13 05:15:02
3657439,319889,12561471,15,Wrong class for logger,110239198,2014-05-13 05:15:12
3657439,319889,12561486,62,Put a better type on JobId,110239198,2014-05-13 05:15:41
3657439,38527,12561996,46,"I'm still reading the code, but is there a case where someone would pass in a PlatformmetricProvider, but then it returns pp.incrementor(_,_,_) returns None?",110239198,2014-05-13 05:37:01
3657439,38527,12562035,54,"may want to wrap in an object, otherwise you could et an npe if it isn't set (per Reference#get())",110239198,2014-05-13 05:38:29
3657439,38527,12562063,66,.isEmpty,110239198,2014-05-13 05:39:25
3657439,38527,12562130,29,"How is Long => Unit a ""platform metric""? I guess that's similar to @ianoc 's comment",110239198,2014-05-13 05:41:45
3657439,38527,12562142,50,imho all public methods that do not override something should have an explicit return type,110239198,2014-05-13 05:42:09
3657439,38527,12562308,18,"imho if you have to do _:type, _: type, _:type it's not worth the gain over the function syntax (which often infers types more intelligently and let's you name variables in cases where the _'s aren't self evident, like this). could be wrong though.",110239198,2014-05-13 05:47:46
3657439,38527,12562340,25,don't need the trailing parens,110239198,2014-05-13 05:48:39
3657439,38527,12562356,24,"more generally: is there a reason it all had to be static? I hate static stuff like this (if avoidable), it can often create headaches in the future...",110239198,2014-05-13 05:49:07
3657439,38527,12562381,43,We should prefer using java.util.concurrent (see warning here: https://github.com/scala/scala/blob/132a0587abf611e6e0b93c95a3b1b118619b849f/src/library/scala/collection/mutable/SynchronizedMap.scala#L27). There is a method to make a concurrent set from an,110239198,2014-05-13 05:50:08
3657439,38527,12562460,22,.toOption.getOrElse(List.empty) is more future proof imo,110239198,2014-05-13 05:53:02
3657439,38527,12562517,73,I don't love the idea of having an implicit String... I'd prefer there to be a value class for JobId's. May be type overload though...,110239198,2014-05-13 05:55:13
3657439,38527,12562553,25,"this is a case where I think metric.incrBy(_:Long) is ok (referencing my above comment). Don't need to change it just sort of clarifying...not a jerk, I swear...",110239198,2014-05-13 05:56:38
3657439,38527,12562562,31,you don't need the extra {}'s,110239198,2014-05-13 05:57:03
3657439,13840,12567397,43,"Something like this:

```scala
  val xs = Collections.newSetFromMap[Long](new ConcurrentHashMap[Long, String])
```",110239198,2014-05-13 10:14:44
3657439,232760,12616476,25,Removed author,110239198,2014-05-14 05:37:04
3657439,232760,12616487,33,Done,110239198,2014-05-14 05:37:36
3657439,232760,12616496,36,Commented. Still need the catch for when this object does not exist (i.e. in storm case),110239198,2014-05-14 05:38:07
3657439,232760,12616506,15,Fixed,110239198,2014-05-14 05:38:22
3657439,232760,12616511,62,Done,110239198,2014-05-14 05:38:30
3657439,232760,12616519,66,Done,110239198,2014-05-14 05:38:50
3657439,232760,12616526,50,Added return type,110239198,2014-05-14 05:39:02
3657439,232760,12616532,43,Thanks! Added this change,110239198,2014-05-14 05:39:22
3657439,232760,12616579,31,Removed extra {}s,110239198,2014-05-14 05:41:43
3657439,232760,12616586,25,Done,110239198,2014-05-14 05:42:09
3657439,232760,12616721,24,"I am basing this implementation on the Scalding stats implementation (https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/Stats.scala). Static objects here make it easy to share global state, i.e. the stats w",110239198,2014-05-14 05:48:13
3657439,232760,12616847,73,Good point. Created a SummingbirdJobID case class to not have jobID be a String.,110239198,2014-05-14 05:54:08
3657439,38527,12621597,32,"how is this cast safe? wouldn't this mean that fn should be of type T => traversableOnce[(K, Int)] ?",113033023,2014-05-14 10:41:11
3657439,38527,12621610,33,typo,113033023,2014-05-14 10:41:49
3657439,38527,12621618,37,outer {}'s not necessary,113033023,2014-05-14 10:42:11
3657439,38527,12621652,36,"I mean scala.util.Try. The apply function will catch the throwable, so you can get rid of the catch.",110239198,2014-05-14 10:43:45
3657439,38527,12621682,26,I think github swallowed the comment...why is this an Option[Long => Unit]? In what case do you have an incrementor that doesn't return a Long => Unit? Also what is the Long that these accept? I feel like it may be worth typing this...will read through ag,113033023,2014-05-14 10:45:43
3657439,38527,12621720,56,"I think the comment here got swallowed, but since it's a weak reference how do you avoid the npe if get returns null?",113033023,2014-05-14 10:48:36
3657439,38527,12621728,60,is there ever a case when they call incrementor and don't error out if they don't get one back?,113033023,2014-05-14 10:49:15
3657439,38527,12621738,78,should this be public?,113033023,2014-05-14 10:49:53
3657439,232760,12646965,26,"If either platform does not find a runtime context (topology context in storm and flowprocess in scalding) that matches this specific jobID (i.e. it was somehow not registered during initialization), it will not return a Long=>Unit. Long is the value to i",113033023,2014-05-14 21:50:43
3657439,232760,12647926,22,Done,110239198,2014-05-14 22:08:55
3657439,232760,12647971,33,Thanks :) Fixed,113033023,2014-05-14 22:09:42
3657439,232760,12649106,56,"Talked offline, it's a Scala WeakReference, it returns an option, so if unsuccessful, nothing happens",113033023,2014-05-14 22:30:24
3657439,232760,12649114,37,Done,113033023,2014-05-14 22:30:34
3657439,232760,12649137,78,"Good point, made private",113033023,2014-05-14 22:31:01
3657439,232760,12649978,32,This was only called from ScaldingLaws test where the collection is a List[Int]. I'll remove the casting and the type-specific filter to keep it general.,113033023,2014-05-14 22:46:38
3657439,232760,12650142,60,"don't think so. For both platform the incrementor returns Option[Long=>Unit], so if the call was unsuccessful it will error out.",113033023,2014-05-14 22:49:19
3657439,232760,12668654,29,Changed from Long=>Unit Funciton1s to a trait extended in both Storm- and ScaldingMetricProviders,110239198,2014-05-15 04:58:47
3657439,232760,12668671,18,"Commented, the _:type, _:type, _:type is no longer needed because I now create a StatsIncrementor object and pass it the parameters.",110239198,2014-05-15 04:59:29
3657439,232760,12668678,36,Got it. Added this change.,110239198,2014-05-15 04:59:41
3657439,232760,12668683,12,"Done, same with ScaldingMetricProvider",110239198,2014-05-15 04:59:55
3657439,232760,12668700,46,"Talked offline, addressed the comment",110239198,2014-05-15 05:00:17
3657439,232760,12668798,54,Addressed offline,110239198,2014-05-15 05:03:15
3657439,232760,12668834,25,Resolved by the StatIncrementor trait,110239198,2014-05-15 05:04:10
3657439,1847115,12776955,39,Minor nit - not a big fan of the name SBRuntimeStats. Would prefer something like SummingbirdRuntimeStats to be more consistent. But your call.,113033028,2014-05-19 04:38:36
3657439,1847115,12776970,85,Some scala docs for what the various metrics/stats objects do?,113033028,2014-05-19 04:42:21
3657439,1847115,12777044,40,"Not ideal that you are referring to summingbird-scalding inside here, right?",113033028,2014-05-19 05:03:48
3657439,1847115,12777091,85,"Isn't this just a Counter? Should we just call it that? 

Some commonly-used nomenclature - http://metrics.codahale.com/manual/core/.",113033028,2014-05-19 05:12:46
3657439,232760,12820417,39,"Thanks, renamed to SummingbirdRuntimeStats",113033028,2014-05-20 03:44:30
3657439,232760,12820433,85,Renamed to Counter. Scaladocs to follow,113033028,2014-05-20 03:44:55
3657439,232760,12820449,40,"Discussed offline, this is a String, not a direct dependency, not ideal but does not introduce a package dependency....",113033028,2014-05-20 03:45:28
3657439,38527,12874504,12,formatting,113033029,2014-05-21 04:32:07
3657439,38527,12874531,17,Is this something that should be publicly visible?,113033029,2014-05-21 04:32:58
3657439,38527,12874638,23,"List[(string, String)] can be replaced with Nil",113033029,2014-05-21 04:36:20
3657439,38527,12874656,18,Should we log.debug if we swallow the exception?,113033029,2014-05-21 04:36:46
3657439,319889,12876144,32,"Long => unit isn't really correct anymore, so i'd just leave that out",113033029,2014-05-21 05:27:35
3657439,319889,12876167,37,should be in summingbird core options,113033029,2014-05-21 05:28:17
3657439,319889,12876316,75,"MMap isn't thread safe?

MHashSet isn't thread safe is it?",113033029,2014-05-21 05:32:15
3657439,319889,12876340,14,Is this WS change correct?,113033029,2014-05-21 05:33:05
3657439,319889,12876356,36,remove,113033029,2014-05-21 05:33:45
3657439,319889,12876395,11,private?,113033029,2014-05-21 05:34:52
3657439,319889,12876400,15,private?,113033029,2014-05-21 05:34:59
3657439,319889,12876405,28,package private?,113033029,2014-05-21 05:35:12
3657439,319889,12876420,4,Wildcard import for what?,113033029,2014-05-21 05:35:41
3657439,319889,12876444,4,"I presume you have some IDE or something doing these changes? Is it setup to some standard? I believe @isnotinvain does this also, will these two collide/disagree? ",113033029,2014-05-21 05:36:44
3657439,319889,12876458,37,Is the Summingbird not redundant in the name?,113033029,2014-05-21 05:37:09
3657439,319889,12876475,5,Only wild card if more than a few imports from it,113033029,2014-05-21 05:37:50
3657439,319889,12876486,17,prefer using private[this],113033029,2014-05-21 05:38:09
3657439,319889,12876503,27,"Commented code, should be removed?",113033029,2014-05-21 05:38:50
3657439,319889,12876509,35,In Bolt?,113033029,2014-05-21 05:39:03
3657439,232760,12877609,14,"I fixed the indentation here, will show up in the next push",113033029,2014-05-21 06:26:33
3657439,232760,12877753,4,"I haven't made these changes, just reordered the imports to be in alphabetical order, so not sure about collision etc.",113033029,2014-05-21 06:33:16
3657439,232760,12877766,27,"Yes, thanks :)",113033029,2014-05-21 06:34:12
3657439,232760,12877771,35,"Debug line that this is happening in a bolt, actually don't need it since it is provided by the logging message already.",113033029,2014-05-21 06:34:41
3657439,232760,12877786,17,"Added private, thanks",113033029,2014-05-21 06:35:35
3657439,232760,12877812,28,"What do you mean here? I made the ScaldingStatProvider private[this], not sure what private package would be",113033029,2014-05-21 06:36:40
3657439,232760,12877814,18,Added logging,113033029,2014-05-21 06:36:50
3657439,232760,12877837,15,"Thanks, made private",113033029,2014-05-21 06:37:39
3657439,232760,12877841,11,"Can't make this private, ScaldingStatProvider refers to it",113033029,2014-05-21 06:37:50
3657439,232760,12877854,36,Done in the next commit,113033029,2014-05-21 06:38:18
3657439,232760,12878230,75,Made both thread-safe using ConcurrentHashMap,113033029,2014-05-21 07:01:25
3657439,232760,12878242,17,made private,113033029,2014-05-21 07:01:51
3657439,232760,12878263,5,"Changed to explicit imports, thanks",113033029,2014-05-21 07:03:23
3657439,232760,12878287,4,Changed to be explicit imports,113033029,2014-05-21 07:04:40
3657439,319889,12931005,31,Package private?,112979067,2014-05-22 05:54:55
3657439,319889,12931008,27,Package private?,112979067,2014-05-22 05:54:59
3657439,319889,12931009,38,Package private?,112979067,2014-05-22 05:55:09
3657439,319889,12931013,72,Private/package private?,112979067,2014-05-22 05:55:20
3657439,319889,12931026,84,This is a public user interacting class so probably deserves a java doc,112979067,2014-05-22 05:55:49
3657439,319889,12931030,52,private?,112979067,2014-05-22 05:56:14
3657439,319889,12931036,89,private[this] final,112979067,2014-05-22 05:56:36
3657439,319889,12931050,36,This is still showing up in the diff?,113033029,2014-05-22 05:57:09
3657439,319889,12931058,11,We can make it package private then?,113033029,2014-05-22 05:57:30
3657439,319889,12931066,35,package private,112979067,2014-05-22 05:57:40
3657439,319889,12931074,11,package private,112979067,2014-05-22 05:58:06
3657439,7111,13028472,25,"it would be really nice if we could count different things, or name groups differently on each platform.

Something like:

```scala
def job[P <: Platform[P]](source: P#Source[T], sink: P#Sink[V], counters: P#Counters): TailProducer[Unit] =
  source.",113033033,2014-05-25 04:09:13
3657473,38527,12499930,51,"Semigroup extends serializable, why does it need to be transient?",110239636,2014-05-10 04:20:22
3657473,38527,12499941,16,implicit SparkContext; reader monad; or the store can provide. seems like it doesn't need to be an argument?,110239636,2014-05-10 04:20:54
3657473,38527,12500417,62,"can we not do case ((highestTs, sumSoFar), (ts, v)) here and get rid of the extra match? otherwise you could also do (_, _) match =>",110239636,2014-05-10 04:47:12
3657473,38527,12500445,78,"case (ts, _) => ts, or even { _._1 } I think are better stylistically (others may disagree?). also, I don't think short things like this need to be on a separate line, it sort of explodes out the size imho.",110239636,2014-05-10 04:48:53
3657473,38527,12500564,102,"this is a long line, even for me",110239636,2014-05-10 04:55:26
3657473,38527,12500593,106,superfluous {},110239636,2014-05-10 04:56:55
3657473,38527,12500855,35,Buffer,110239636,2014-05-10 05:13:07
3657473,38527,12501074,45,"since you return a planstate anyway, we could get rid of the mutable stuff by passing a plan state in, and then they construct a new one with the new plan.",110239636,2014-05-10 05:27:54
3657473,38527,12501113,78,"planState.copy(plan = flatMapped) is the more idiomatic way to change just one field in a case class. Or since you reference planState.plan and planState.visited, can do a val PlanState(plan, visited) = planState at the beginning and use where necessary",110239636,2014-05-10 05:30:07
3657473,622449,12561911,51,Maybe it doesn't need to be in that case. I was just trying to force as much as through the externalize as possible. I wasn't sure which things need this vs which don't. Maybe only closures need this?,110239636,2014-05-13 05:34:00
3657473,622449,12561943,62,"oh, I see. Let me see if that works. ",110239636,2014-05-13 05:35:02
3657473,622449,12561965,106,do you know if the () => is necessary? is there a better shorthand for anonymous no-args functions?,110239636,2014-05-13 05:35:49
3657473,622449,12561989,45,"yes, definitely. ",110239636,2014-05-13 05:36:39
3657473,622449,12563681,78,"I was trying to never use _._1 but I guess I don't need to avoid it for things like sortBy.
Yeah I'll put these on one line as well.",110239636,2014-05-13 06:48:17
3657473,622449,12563898,102,"do you think this is more clear? I can't seem to find a clear way to express this:

```
      val v = (summedDelta, storedValue) match {
        case (Some((_, delta)), Some(sv)) => extSemigroup.get.plus(sv, delta)
        case (Some((_, delta)), Non",110239636,2014-05-13 06:58:41
3657473,622449,12563905,102,"I could also do something more like:
```
      val v = (summedDelta, storedValue) match {
        case (Some((_, delta)), Some(sv)) => extSemigroup.get.plus(sv, delta)
        case _ => summedDelta.map(_._2).getOrElse(storedValue.getOrElse(sys.error(""",110239636,2014-05-13 06:59:05
3657473,622449,12608991,51,going to keep it this way just to be defensive.,110239636,2014-05-14 02:11:58
3657473,622449,12609097,62,done,110239636,2014-05-14 02:14:07
3657473,622449,12609110,78,done,110239636,2014-05-14 02:14:20
3657473,622449,12609526,102,going with the more explicit one,110239636,2014-05-14 02:23:14
3657473,622449,12609777,35,done,110239636,2014-05-14 02:28:14
3657473,622449,12610003,78,done,110239636,2014-05-14 02:32:49
3657473,38527,12873143,21,"what happens if you try to do
```
type Visited = Map[Prod[_], P#Plan[T]]
```
or
```
type Visited[T] = Map[Prod[_], P#Plan[T]]
```
do either work? would clean up the need for casting",112828764,2014-05-21 03:53:05
3657473,38527,12873192,38,I don't love the naming toPlan and toPlan2...why is it toPlan2?,112828764,2014-05-21 03:54:01
3657473,622449,12873480,21,"No, the T in Plan[T] isn't fixed. This is a Map of many different kinds of plans unfortunately.

The Plan is basically an RDD, so if you have an RDD[T] and then you map it to an RDD[U] you now have a Plan[U]",112828764,2014-05-21 04:01:08
3657473,622449,12873718,38,"Yeah, I didn't know what to name this.

toPlan first checks for cycles via the Visited map, and if there's no cycle it delegate to toPlan2 which does the real work.",112828764,2014-05-21 04:07:17
3987741,319889,14160462,159,any reason to prefer sys.error over the new Exception? is there any difference? (just curious),130349669,2014-06-25 03:50:19
3987741,319889,14160512,120,i don't think we could do that right? the map side aggregation would be broken then?,130349669,2014-06-25 03:51:38
3987741,7111,14160634,120,Yes. I noticed that too. We should not pull down to the summers. Should I remove that comment?,130349669,2014-06-25 03:55:01
3987741,7111,14160864,159,"We used sys.error below, and I thought it would be nice to be consistent. If you ask me, I prefer sys.error when you are really signalling a state that can't be handled. I generally like assert, require, and error over throwing the Java exceptions because",130349669,2014-06-25 04:01:17
3987741,319889,14160937,26,is this right? I presume the Set function before was to eliminate dupes?,130366069,2014-06-25 04:03:03
3987741,7111,14161429,26,The Set looks really dangerous and I think I put it there because Set1 is a very (in terms of memory) Iterable. I'm afraid down-stream of this we are going to get strange effects with chaining. Let's be direct and just use Iterator here.,130366069,2014-06-25 04:16:38
3987741,319889,14161469,26,do we need to distinct on the key's at that point though? ,130366069,2014-06-25 04:18:05
3987741,7111,14161696,26,"also, if we want to eliminate dupes, we should say so in the documentation (and the method name). Eliminating dupes is not part of the mapKeys contract. It is just the keys analog to mapValues.",130366069,2014-06-25 04:24:50
3987741,319889,14161734,26,Ok thats fine with me if we don't think its in the contract (mapKey's on a map per say would eliminate dupes as part of the operation since it would return a map also). ,130366069,2014-06-25 04:25:47
4049424,7111,14533717,14,"make this:
`Option[(Tuple) => (Unit)]`

and just return either:
```scala
  case /* TupleImpl */ => Some({ t: Tuple => vf.set(t, null) })
  case /* has reset */ => Some({ t: Tuple => m.invoke(t) })
  case _ => None
```
So we don't need to reflect ",132961767,2014-07-04 00:32:59
4049424,7111,14538391,36,"`= valuesField.foreach(fn => fn(t))`

if we make the change I suggest above.",132961767,2014-07-04 02:17:08
4059929,7111,14542961,7,"please check for overflow here:
```
def next(old: Timestamp) = if (old.millisSinceEpoch != Long.MaxValue) Some(old.next) else None
```
and similarly below. The whole point of the Option here is to be precise.",133416428,2014-07-04 04:44:36
4126913,7111,14778430,65,"I am not crazy about mixin patterns. It fact, we almost never use that in summingbird.",136070291,2014-07-10 21:59:29
4126913,7111,14778490,77,I think this should be private. It looks like an implementation detail.,136070291,2014-07-10 22:00:58
4126913,7111,14779637,135,"I think you want `strictUpper <- high.strictUpperBound` and then not use `.next` below, just use `strictUpper`.",136070291,2014-07-10 22:21:16
4126913,7111,14779735,90,just use `Iterable` no need to prefix.,136070291,2014-07-10 22:23:00
4126913,7111,14779935,54,"This is confusing as to why it is needed, since it looks like CheckPointState is just routing fail to it. Why is this useful? Can you explain the state machine more clearly? Because I don't understand it as well with this model.",136070291,2014-07-10 22:26:35
4126913,7111,14780001,102,seems weird that we always throw. Why isn't that being delegated to checkpointPlanFailure?,136070291,2014-07-10 22:27:43
4126913,7111,14780130,65,can't we just have `def store: CheckpointStore[T]` rather than the mixin.,136070291,2014-07-10 22:29:37
4126913,7111,14780282,90,I don't like this mixin pattern. It feel gratuitous. I don't see why we are getting anything with this separation between CheckpointState and CheckpointStore. Can you explain the win there in the comment to these classes? What is the case against merged t,136070291,2014-07-10 22:31:53
4126913,89478,14781048,90,"I prefer provide the store as a parameter in the checkpointState by using composition instead of mix-ins. I was hoping to try out cake pattern which I just read about recently, as you said, I also don't see much benefit from it and seems a little confusin",136070291,2014-07-10 22:44:13
4126913,89478,14781641,102,"I'm moving this to HDFSState.
So the checkpointPlanFailure method in HDFSState will just throw the err. It was in the there(CheckpointState) because previously we just wanted the job to fail if the planning failed, I guess. Isn't it the case?",136070291,2014-07-10 22:54:08
4126913,89478,14781896,54,So I'm moving the checkPointStore to be a field of CheckpointState. I do not choose to eliminate the asdfa class by merging all the above methods to CheckPointState and making them abstract because I want a clearer separation of responsibilities. The logi,136070291,2014-07-10 22:58:04
4126913,89478,14781936,54,misspell  -> asdfa means CheckpointStore,136070291,2014-07-10 22:58:45
4126913,89478,14782260,135,"fixed, used high.strictUpperBound",136070291,2014-07-10 23:04:38
4126913,7111,14834069,54,Hell of a misspelling. :),136070291,2014-07-11 22:50:42
4126913,7111,14835147,159,"no need for { } on single expression methods (please remove them, sir).",136254925,2014-07-11 23:10:11
4126913,7111,14835158,183,remove { },136254925,2014-07-11 23:10:23
4126913,7111,14835181,199,remove { },136254925,2014-07-11 23:10:44
4126913,319889,14894950,37,"Line too long, split over 2.",137522882,2014-07-14 23:34:54
4126913,319889,14894962,43,"Comment lines too long, use /* for a longer comment block",137522882,2014-07-14 23:35:06
4126913,319889,14895008,74,Implementation on new line tab indented. too long here.,137522882,2014-07-14 23:35:43
4126913,319889,14895023,78,"Impl, tabbed in on new line",137522882,2014-07-14 23:35:56
4126913,319889,14895084,86,tab indenting here all looks a bit off. Can we separate this condition section into its own private helper function with docs for each one?,137522882,2014-07-14 23:36:46
4126913,319889,14895112,105,Use require rather than assert,137522882,2014-07-14 23:37:11
4126913,319889,14895207,130,"continuation of args should be indented another 2 spaces.

No { required, its just one statement",137522882,2014-07-14 23:38:14
4126913,319889,14895240,32,Why is this no longer private? it seems like it should always be such,137522882,2014-07-14 23:38:40
4126913,319889,14895262,40,why collapse to one line?,137522882,2014-07-14 23:38:59
4126913,319889,14895271,54,Why collapse to single longer line?,137522882,2014-07-14 23:39:11
4126913,319889,14895285,45,Why remove new line separating descr of return vs args?,137522882,2014-07-14 23:39:25
4126913,319889,14895381,11,"I believe this sort of code is controlled by scalariform, why is this in the diff then? not a clean merge/build?",137522882,2014-07-14 23:40:50
4126913,89478,14905086,32,fixed: moved the logger to HDFSState class from the companion object,137522882,2014-07-15 02:22:46
4126913,89478,14905879,11,"I ran the sbt compile, but didn't see it being reformatted back to ""{ TimeZone, UUID }""
I used intelliJ to format it, and removed the spaces.
What's our coding convention here? if we need spaces, I can add it back",137522882,2014-07-15 02:36:14
4126913,319889,14906684,11,did you do it with the local sbt runner. I'm just not sure if scalriform is running for you?,137522882,2014-07-15 02:50:40
4126913,319889,15011931,32,Why did this need to move at all maybe i'm just a little unclear on? ,137522882,2014-07-16 21:52:22
4393415,7111,16220040,4,why are we getting rid of these?,148573829,2014-08-14 08:43:58
4393415,319889,16221328,4,"Dead Val's no longer referenced. They are still logged when used, it's in
the buildSummer.scala file

On Wednesday, August 13, 2014, P. Oscar Boykin <notifications@github.com>
wrote:

> In
> summingbird-storm/src/main/scala/com/twitter/summingbird/",148573829,2014-08-14 10:04:16
4404703,319889,16184606,35,Any particular reason for this change? or just since we can?(not sure of any real benefit to having the type be keyed producer here over it),149158877,2014-08-13 20:52:24
4404703,319889,16184686,20,Describe what this is for? ,149158877,2014-08-13 20:53:37
4404703,7111,16219844,35,"Yes. The reason was: 1) all the code just compiled with the change. 2) it made the graph uniform in that all AST nodes are either 0, 1, or 2-ary functions of `Producer[_]` for some value of `_`.",149158877,2014-08-14 08:33:50
4404703,164018,16254124,42,why not a protected constructor to set the initial value of the HMap? That would be more concise in all the places we use this.,149614331,2014-08-14 22:55:05
4404703,164018,16254728,58,"can you define a case class for the return type?
It will be easier to follow once they get names.",149614331,2014-08-14 23:04:48
4404703,164018,16256495,185,I'm assuming the names are kept somewhere for debugging purpose?,149614331,2014-08-14 23:27:01
4404703,164018,16256578,216,keeping track of what has been optimized out is really important for debuging,149614331,2014-08-14 23:27:57
4404703,164018,16256926,218,map and filter are always turned into flatMap?,149614331,2014-08-14 23:32:45
4404703,7111,16268637,185,"My new idea on this is to consider the names to only apply to the ""irreducibles"", which are the literal functions, sources, sinks, services, stores and semigroups. So, step 1: build `Map[Any, List[String]]` which for each irreducible it gives you a `List[",149614331,2014-08-15 02:46:31
4404703,7111,16268871,58,"How about a comment?

:) This is `(HMap[E, N], N[T])` where `E[T] = Expr[T, N]` but there is that type lambda. I don't see a good way to remove the type lambda (that ({type ... }#E) because at the end of the day, N is not fixed and Expr takes two type p",149614331,2014-08-15 02:50:27
4404703,38527,16419691,5,"I am a bit wary of covariance in frameworks with deal heavily in serialization. I know this is common in Scalding etc, but I was just curious your thoughts on it. Giong to keep an eye out later in the review, I'm just worried that especially when paired w",150538747,2014-08-19 19:58:44
4404703,38527,16419892,20,agree with ian. also s/associated/asssociated,149158877,2014-08-19 20:01:18
4404703,38527,16420375,40,"since we reuse this in various places, I think we can just defined
```type E[t] = Expr[t, N]```
in the trait and use E instead of having to recreate the structural type everywhere.",150538747,2014-08-19 20:07:48
4404703,38527,16420554,47,you just reinvented a category :),150538747,2014-08-19 20:10:12
4404703,38527,16420776,58,"See above. I think you can just define the type in Expr, and then project accordingly (ie in this caes the lambda would become expr#E. Won't remove all of them I suppose... but may make some of the code easier to understand?",149614331,2014-08-19 20:13:22
4404703,38527,16420985,40,"I am still going through this review, and kind of just started, but why do we need T[A, B[_]] if A fixes B? We're ensuring that N is a more general container, but that in this case, it is fixed on A? I guess the goal is to be able to keep N, but move arou",150538747,2014-08-19 20:16:07
4404703,38527,16421132,21,s/to/so,150538747,2014-08-19 20:17:56
4404703,38527,16421205,23,"missing paren.

broader point: couldn't we enforce that there is a type parameter? I'm just wondering if we could use type trickery to enforce that k == k2 has the semantics that we want",150538747,2014-08-19 20:18:44
4404703,38527,16421363,33,"if we are going to have an open class hierarchy, may be worth doing the that.canEqual(this) trick to ensure that we are comparing semantically equivalent HMaps. Unless that's not possible?",150538747,2014-08-19 20:20:49
4404703,38527,16421475,41,"does this or + need a type parameter? we are going to lose the type information in the returned HMap.

Generally, is the idea behind all this code, ie dealing in higher kinded types, to ensure that it's always possible to change what the N[_] can point ",150538747,2014-08-19 20:22:19
4404703,38527,16421925,44,"I guess this gets at the crux of the above question. So the idea is that whatever we put in can be retrieved with ANY type constructor? ie if we put in a V[Int], we could get back a V[String] and that is guaranteed to be ok?",150538747,2014-08-19 20:26:34
4404703,7111,16429237,58,"I don't see how to do that. object Expr has no type parameters. So, I can't do something like:
```scala
object Expr {
  type E[t] = Expr[t, ?] // where do a I get the N?
}
```
To make a type of kind `* -> *` I am going to need to curry the N, but I ",149614331,2014-08-19 22:22:31
4404703,7111,16429351,5,"Producer is covariant, and removing it is out of scope for this PR. Without this class being covariant, I had trouble getting scala to see that the case matches were correct.",150538747,2014-08-19 22:24:15
4404703,38527,16429447,58,"I meant in the sealed trait... but yeah, you don't get a win in this piece of the code, only above potentially. Although if you add it to the sealed trait Expr, you might be able to do:

```
private def evaluate[T, N[_]](expr: Expr[T, N], idToExp: HMap",149614331,2014-08-19 22:25:46
4404703,38527,16429507,5,"Oh, yeah, that's fine. Definitely don't need to remove it if it's already there. I wish github let you mark a conversation as ""resolved""...",150538747,2014-08-19 22:26:43
4404703,7111,16429566,40,"Show me how to write that. I only see:
```scala
({type E1[t] = Expr[t, N]#E})#E1
```
which is clearly useless as I could have just written: `({type E[t] = Expr[t, N]})#E`. Maybe there is a cleaner way here, but your description is not clear enough for",150538747,2014-08-19 22:27:28
4404703,7111,16429931,40,"N[_] will be TypedPipe[_] or Producer[P, _]. So, within a Dag, the container type is fixed, but each type of contained value is not.

To your question: could it be simplified so that we don't need fix it on an outer container, it might work. This is str",150538747,2014-08-19 22:33:24
4404703,7111,16430051,23,I don't know how. Can you show me?,150538747,2014-08-19 22:34:56
4404703,38527,16430081,40,"I like the generality of this, I think it is very good stuff. I'm just trying to understand the semantics _very_ clearly as I work on trying to spot bugs, and consider simplifications/etc. You know the drill :) ",150538747,2014-08-19 22:35:11
4404703,7111,16430620,33,I'll just make it sealed. That is not the intent.,150538747,2014-08-19 22:43:18
4404703,7111,16430955,41,"I think - does not need it.

I think + does need a type parameter because we are saying that `K[T]` and `V[T]` share the same type. That said, another question is your question from before: do you need `V[T]` here or would `T` do?. I think it probably c",150538747,2014-08-19 22:48:07
4404703,7111,16431172,44,"No, that would not be okay. Remember the comment above, if k1 == k2, then the types must be equal are you are going to have bugs.

We never violate that in the code we have here, but it is not a guarantee that the type system gives you. We have to guara",150538747,2014-08-19 22:51:28
4404703,38527,16431337,58,"Ok, this applies to both... it's a little gnarly, and I will check out your code in a sec and try it, but there are two ways to eliminate the use of the full lambda. If the first one works I definitely prefer it, but we have to make sure the paths are con",149614331,2014-08-19 22:54:30
4404703,7111,16447519,58,"Okay. I see how you fix N, by linking to the parameter instance. Nice solution.

That said, after your comments, I am going to take a run at removing the extra type constructor, N[_] here, and see if I get stuck with just one type.",149614331,2014-08-20 03:13:06
4404703,7111,16449678,44,"One more comment here: you put the (K[T], V[T]) in. So when you come back with K[T] you get V[T]. You have to be given (or store) the correct K[T] to match your V[T].",150538747,2014-08-20 03:52:18
4404703,38527,16455234,109,what do you mean by only support a single root? (just a tad confused since obviously it's possible to add more than one root :),150538747,2014-08-20 06:48:02
4404703,38527,16455265,91,"since ```Id[_]``` is just a wrapper around int for typing reasons, if we ever do Id[_] can't we eliminate it and just make it an Int? We're not taking advantage of the entire reason for Id ie typing",150538747,2014-08-20 06:49:05
4404703,38527,16455303,119,"you can actually declare this as ```type IdSet[_] = Set[Id[_]]```. In type declarations iirc the ```_``` on the left sort of signals shape, not normal wildcarding. So this just says that the IdSet type takes one argument, but we actually ignore it.",150538747,2014-08-20 06:50:44
4404703,38527,16455503,38,"Actually, give we have the type parameter on + (and could add it back on k if we wanted), we could have another map which could store the Class files. When we add a new one, our equality can also compare the type information.

It's definitely a bit of o",152147878,2014-08-20 06:58:18
4404703,38527,16455540,114,"I think you're doing getOrElse here (which also take a call by name parameter, so it shouldn't invoke v)",152147878,2014-08-20 06:59:45
4404703,38527,16455956,39,is there a reason why we always put the Seq first?,152147878,2014-08-20 07:21:47
4404703,38527,16455973,53,I thought you generally eschewed extending function1?,152147878,2014-08-20 07:23:05
4404703,38527,16492211,70,"given we know the type of first and second, wouldn't we expect flatten not to do anything? I think I'm a bit confused as to the use of IrreducibleContainer, may clarify as I continue",152147878,2014-08-20 22:51:33
4404703,7111,16496554,119,"That is what I intend. This a constant type constructor. Do you think the comment is unclear? It seems like you are reiterating that we are ignoring the t, as the comment also says.",150538747,2014-08-20 23:53:20
4404703,7111,16496736,114,note that I am updating the hmap var in the None case. That is the Update. Right?,152147878,2014-08-20 23:56:01
4404703,7111,16496785,39,No. It was copy paste.,152147878,2014-08-20 23:56:29
4404703,7111,16496809,53,"I wanted to use these in FlatMappedProducers, which require Functions.",152147878,2014-08-20 23:56:52
4404703,7111,16496855,70,"first could be a ComposedOptionMap, right?",152147878,2014-08-20 23:57:27
4404703,38527,16538655,70,"ah, ok, now I'm getting a sense of what is going on I think",152147878,2014-08-21 18:38:03
4404703,38527,16538826,25,"This cast is not guaranteed to succeed, right? Now all Producers are TailProducers.",152147878,2014-08-21 18:40:51
4404703,38527,16538933,55,"If you're going to define this anyway, you could use this in the above declarations to get rid of the constant references to P, esp. since they are all protected ie not external API",152147878,2014-08-21 18:42:30
4404703,38527,16539043,119,"FWIW, while I do have some (decreasingly confused) thoughts on the Set[Id[_]], all I meant here is that in general, if you want to declare a type which ignores it's argument, you can equally do

```type IdSet[_] = Set[Id[_]]```

A wildcard on the left",150538747,2014-08-21 18:44:13
4404703,38527,16539495,72,yeah I've run into this before too..perhaps it's weirdness in the case class unapply implementation? would be curious to get the opinion of a scala guru,152147878,2014-08-21 18:52:12
4404703,38527,16539707,32,"as I dig deeper into the PR and see how you use this, this is very, very neat.",152147878,2014-08-21 18:56:09
4404703,38527,16540969,185,"As we optimize a DAG, how do we think about the options which may have been attached to a given node?",149614331,2014-08-21 19:15:22
4404703,38527,16541262,218,"sb lack of familiarity question: when is being in fanOut determined? CAn it change? It seems like we would want to determine that after optimization and fusion, unless someone specifically knows something about their data that they want to force fanout.",152147878,2014-08-21 19:19:36
4404703,38527,16541445,243,this is so elegant! well done oscar.,152147878,2014-08-21 19:22:32
4404703,38527,16541662,266,"are there any cases where ```case _ => None``` isn't the last line? If it's always there, we could make apply return a partial function, and then just call .lift on it?",152147878,2014-08-21 19:25:44
4404703,38527,16541972,300,isn't this case never used since you have case node?,152147878,2014-08-21 19:30:06
4404703,38527,16542556,355,"hah, ok, my suggestion down there was subsumed here. Is it mainly an issue around the typing of it?",152147878,2014-08-21 19:38:45
4404703,7111,16548713,119,I see. I tend to thing that is a less clear way to write it. I think using a type on the left that does not appear on the right is a clearer expression that it is a constant type.,150538747,2014-08-21 21:07:33
4404703,7111,16548899,25,"no, it is not sound UNLESS you are reconstructing an Also. Not sure what to do about that. If you have a logic error in an optimization rule, this could fail, but otherwise, it should succeed.",152147878,2014-08-21 21:10:19
4404703,7111,16548940,55,Yes. I'll fix that. Good catch.,152147878,2014-08-21 21:10:58
4404703,7111,16549001,72,"Yeah, I mean, I'm not casting anywhere in this first block, so, clearly with hand holding scala can see the types.",152147878,2014-08-21 21:11:43
4404703,7111,16549254,185,"That is a good question. Originally we thought of names applying to nodes. With this patch I realized they should rightly apply to the items contained in the nodes (what I call the irreducibles): functions, stores, services, sources, sinks. So, in the ori",149614331,2014-08-21 21:15:35
4404703,7111,16549350,218,"fanOut is only known when you have the whole dag, and you just have to look how many nodes point at a parent node. It can't change in the immutable dags, but for each modification of the graph, the ExpressionDag keeps track of the fanOut of each node.",152147878,2014-08-21 21:17:06
4404703,7111,16549459,266,Good call. I'll do that.,152147878,2014-08-21 21:18:43
4404703,7111,16549498,300,Yep. Good catch.,152147878,2014-08-21 21:19:09
4404703,38527,16553015,25,"might be a good comment at the top of the trait to say that while the types are generic, there are potentially unsound options and they need to be used with care. It's not public facing so I don't think it needs more than that, but would be good for peopl",152147878,2014-08-21 22:16:24
4404703,38527,16553249,119,"Thinking on it more, I agree with you.",150538747,2014-08-21 22:20:56
4404703,7111,16565753,109,I'll remove that. It supports more than one root anyway. Good catch.,150538747,2014-08-22 01:15:42
4404703,7111,16565900,91,"In many places we do use Id[T] to match the return type. Do you mean for this particular case? Since it was in a private method, I didn't worry about it too much, but I could convert to Set[Int] if you prefer here. Since we are going to look up values wit",150538747,2014-08-22 01:18:11
4404703,7111,16566056,38,"We could put a `Manifest[T]` there as well, but there are some legitimate cases where we don't know the T, but we have the K[_] and we just want the V[_]. Also, I'm quite afraid wiring manifests though will be painful (and I'm not sure we can do it).

C",152147878,2014-08-22 01:20:19
4404703,38527,16566137,91,"Ok, yeah, that's exactly what I meant. On more reflection, keeping it ```Set[Id[_]]``` makes sense in the spirit of using typed-ness where possible (ie not accidentally putting the wrong type in).

I guess my point was mainly this: yes, it is a ```Set[I",150538747,2014-08-22 01:21:39
4404703,7111,16566603,243,"Thanks, man. I really appreciate your thorough code review!",152147878,2014-08-22 01:28:11
4404703,7111,16567853,266,"actually, I spent some time on this. This does not work in a very clean way. Look at the AlsoPullUp rule. We want to leave Alsos alone. Not matching the case does not work, because there is a catch all case below. For that catch-all, we really want all BU",152147878,2014-08-22 01:48:54
4404703,44018,16568592,266,"For that case match, I think you can make an object with a custom 
unapply method, something like

def unapply(item: Any) = {
   item match {
     case AlsoProducer(_) => None
     case x => Some(x)
   }
}

Or something like that. I can't code for shit an",152147878,2014-08-22 02:00:55
4404703,38527,16595468,49,"so, I know you mention this, but Expr and Literal are almost exactly the same type. The only difference is that Expr has a class method in the trait, and explicitly includes memoization.

Now, it might be worth keeping these types separate, but it feels",152947987,2014-08-22 17:46:51
4404703,38527,16595533,85,"to be consistent with roots, shouldn't this be ```Id[_]```?",152947987,2014-08-22 17:48:51
4404703,38527,16596126,155,scala....:|:|:|:|:|:|:|:|:|:|:|,152947987,2014-08-22 18:02:35
4404703,38527,16596445,289,Isn't this type the same as ```Id[t]``` ? Doing it just for safety?,152947987,2014-08-22 18:10:11
4404703,38527,16596638,39,I guess my question is if this is a bug. This assumes that flattening can change the order. Is that ok?,152147878,2014-08-22 18:15:17
4404703,7111,16619112,49,"The dag rewriting is much easier when you have ids associated with each expression. I think it would be cool to only have one, but the conversion between the underlying dags and this representation is much easier when you don't need to worry about the ids",152947987,2014-08-23 01:18:10
4404703,7111,16619192,85,"We don't know the type for the next id to be allocated. Once we know the type, we allocate the Id[T](nextId). If we did it first, we would have to cast. The difference with roots is that in roots we never need the type, so again, it is type safe and there",152947987,2014-08-23 01:19:41
4404703,7111,16619268,289,"That's a good observation. It is semantically separate (Id is basically a variable name for Expressions), but it is structurally equivalent. Would you prefer that we change to Id here?",152947987,2014-08-23 01:21:28
4485938,232760,17884870,66,what would this be used for? Could you add a comment?,159045371,2014-09-23 04:23:02
4492109,7111,16614646,25,should this not be CMap?,153220034,2014-08-22 23:51:18
4492109,7111,16614683,4,Can you add the comment as to why it is here? I am nervous about people forgetting about the mutability and then us having bugs down the line.,153220034,2014-08-22 23:51:50
4492109,7111,16614790,23,let's change these to val.,153220034,2014-08-22 23:53:37
4492109,7111,16615251,34,"Can we add a detailed comment as to the algorithm here: linear increase in rate up to ramp period, etc...",153220034,2014-08-23 00:02:03
4492109,7111,16615302,45,I think a sleep would be better than a busy wait given how long these periods are. We don't want to busy spin for 8 seconds.,153220034,2014-08-23 00:03:12
4492109,232760,16615361,17,Curious - why/how could the hashCode ever be negative?,153220034,2014-08-23 00:04:27
4492109,7111,16615433,60,might be better to keep a val of this so we don't allocate in the loop.,153220034,2014-08-23 00:05:57
4492109,7111,16615501,70,"can we do: `val (buffer, mmap) = ...` and use the names below?",153220034,2014-08-23 00:07:32
4492109,232760,16615980,74,"Is the rate limiter basically making it busy-wait/sleep for a certain period of time, decreasing (linearly?) over time before executing? Do we want this turned on for all jobs?",153220034,2014-08-23 00:18:28
4492109,232760,16616425,7,do we want to enable the user to control the speed of the ramp-up as well (i.e. PERIOD_LENGTH_MS)?,153220034,2014-08-23 00:22:38
4492109,232760,16616446,34,+1,153220034,2014-08-23 00:23:03
4492109,319889,16637936,25,"No, we unpack the CMap on entry to the summer. So they are gone by this point.",153220034,2014-08-25 01:54:53
4492109,319889,16637970,17,its an unsigned int stored as a signed int I presume,153220034,2014-08-25 02:02:08
4492109,319889,16637979,70,Not sure what you mean here?,153220034,2014-08-25 02:04:39
4492109,319889,16637982,74,"Default is a no-op, so it should be fine",153220034,2014-08-25 02:04:59
4492109,319889,16637988,7,"That doesn't control the speed, it controls the size over the period which to sample for the size",153220034,2014-08-25 02:05:43
4492109,7111,16666531,70,"I mean, don't use ._1, ._2. Actually name them using the code I wrote above.",153220034,2014-08-25 22:09:12
4492109,319889,16666956,70,ahh k. can do,153220034,2014-08-25 22:16:16
4503561,319889,16639011,15,Drop the TDsl import,154126764,2014-08-25 04:57:04
4520252,232760,16911012,6,why did you make it just a Mergeable? Aren't we dealing with Stores still?,155592789,2014-08-29 22:48:39
4520252,319889,16911142,6,"I had already done it in storm , so this brings it in line. We don't actually use more of the contract in our code than it being a Mergeable. I.e. we only actually call multiMerge, never get or put. So you can do stuff without providing those functions.",155592789,2014-08-29 22:50:49
4520252,232760,16911330,26,can you add an example in this comment on daisy chaining the mergeable stores?,155592789,2014-08-29 22:54:39
4520252,319889,16911415,26,"Well its Function1 daisy chaining, so see scaladoc on function1? andThen doesn't exist on Function0",155592789,2014-08-29 22:55:59
4520252,232760,16911661,29,"it would be useful to have a comment on the less obvious default values here, for example DEFAULT_SOFT_MEMORY_FLUSH_PERCENT, DEFAULT_SUMMER_BATCH_MULTIPLIER. Also, a description of what all the caches and their parameters are (DEFAULT_VALUE_COMBINER_CACHE",155592789,2014-08-29 23:00:42
4520252,232760,16911857,36,what is does this options specify and is it storm-specific?,155592789,2014-08-29 23:04:31
4520252,232760,16912296,26,"I meant an example of how it's used here, looks like you have an example in: MergeableStoreFactoryAlgebra. wrapOnlineFactory so maybe point to that?",155592789,2014-08-29 23:12:27
4520252,232760,16912372,6,got it,155592789,2014-08-29 23:13:32
4520252,38527,16914922,15,"Interesting, I'm surprised we don't have this in algebird.

Is there a reason we prefer this to the Max semigroup?",155592789,2014-08-29 23:59:56
4520252,38527,16915110,15,why do we need the explicit self reference? Wouldn't this. or just andThen without self. or this. work?,155592789,2014-08-30 00:03:12
4520252,38527,16915219,39,when do you choose to do ```() => T``` or ```T => ()``` vs. Function0 and Function1? It's been a bit inconsistent.,155592789,2014-08-30 00:05:08
4520252,319889,16915596,39,"We've always had a mix of () =>  and => , Ideally i want to get most of the internal functions standardized on the Function1. But creating these is much easier using the => syntax so apply methods for that seem good.",155592789,2014-08-30 00:13:39
4520252,319889,16915677,15,Its just a kind of known quantity. I don't believe the TS really makes that much sense in any case after this other than being within the bounds of some range usually. This is just a move here from elsewhere. The whole usage probably could do with more th,155592789,2014-08-30 00:15:03
4520252,38527,16916427,19,is there a reason math.abs won't work? should shouldn't get bitten by the MIN_VALUE bug because you're doing the mod.,155592789,2014-08-30 00:29:44
4520252,7111,16921852,15,"This is strange to me. Where would we use this over Max, which is the default monoid for Timestamp.",155592789,2014-08-30 02:30:46
4520252,319889,16921883,15,This was your choice Oscar ;),155592789,2014-08-30 02:31:26
4520252,7111,16922085,15,self has goofed up serialization in the past.,155592789,2014-08-30 02:36:36
4520252,7111,16922470,16,why did we lose the runtime context on storeSupplier?,155592789,2014-08-30 02:46:12
4520252,319889,16922553,16,"It was in there for an older hack to do Stats only, with newer stats thats not required. I checked that no one internally uses those API's. So this also kills the old un-used ones.",155592789,2014-08-30 02:48:14
4520252,7111,16922625,36,"prefer local means that if there is another bolt working in the same JVM (and thus, host), send to a random one of those, avoiding serialization and the network.

The downside is that if your spouts have few partitions, this limits parallelism until you",155592789,2014-08-30 02:49:42
4520252,319889,17254304,29,"Those are all old, so i'd rather do stuff like that as another PR. if you could file an issue?",155592789,2014-09-08 22:49:49
4520252,319889,17254517,15,Good points. Killing,155592789,2014-09-08 22:52:47
4520252,319889,17254680,19,no real reason... just put the code in since it was easy at the time. Might aswell put in abs though. ,155592789,2014-09-08 22:55:29
4520252,164018,17274390,26,"What about an implicit conversion of Function0 that defines andThen?
Having to define Function1[Unit, ...] is not intuitive.",155592789,2014-09-09 04:34:40
4520252,164018,17274408,56,curly on previous line?,154707411,2014-09-09 04:35:15
4520252,319889,17274437,26,"Its not exposed in our API's, so i'm not sure we gain anything? users can still use their => syntax. ",155592789,2014-09-09 04:36:07
4520252,164018,17274442,20,I find the () => T notation more readable. Any reason for using the Function1[... instead?,154707411,2014-09-09 04:36:17
4520252,164018,17274478,27,I understand the daisy chain facilitation but now we have to define extra parameters we don't use?,154707411,2014-09-09 04:37:14
4520252,164018,17274565,14,would it be possible to make this storePromise.setValue(storeBox.get) ?,154707411,2014-09-09 04:39:30
4520252,164018,17274674,18,:/,154707411,2014-09-09 04:42:35
4520252,7111,18296856,15,Right. I remember the situation now. We should probably comment it better. The reason we did this is because we don't want to give a stronger contract to the semigroup than the store actually respects.,155592789,2014-10-01 23:11:09
4520252,7111,18296998,6,can we do `r => Iterator(r)` here because I am afraid of creating an in-memory representation needlessly by forcing this to Seq.,161767917,2014-10-01 23:12:55
4520252,7111,18297640,20,"can we simplify this a bit:

`def create: ReadableStore[K, V]`

Then in the case class implement create by calling apply on the Fn0.",161767917,2014-10-01 23:20:36
4520252,7111,18298442,5,should we use one of our factory types here?,161767917,2014-10-01 23:32:46
4520252,7111,18298463,9,can we not import here? Name is a bit long.,161767917,2014-10-01 23:33:07
4520252,7111,18298756,20,Should we double check these traits (especially new ones) that they are java serializable.,161767917,2014-10-01 23:37:10
4520252,7111,18298942,6,serializable while we are at in?,161767917,2014-10-01 23:39:51
4520252,319889,18301026,6,"Sure, but then as a map its output should be just 1 element I believe?",161767917,2014-10-02 00:12:38
4542818,7111,17187729,13,"actually, can't we just remove this method call completely and just directly call sumByLocalKeys?",155408340,2014-09-05 23:06:34
4542818,7111,17187990,5,"WritableSequenceFile should be a TypedSource[(K, V)]:
https://github.com/twitter/scalding/blob/develop/scalding-core/src/main/scala/com/twitter/scalding/WritableSequenceFile.scala#L46

So, we should be able to write:
```scala
val src = WriteableSeque",155408340,2014-09-05 23:11:00
4542818,319889,17198112,13,"Can do, will do.",155408340,2014-09-06 02:03:39
4542818,319889,17198221,5,Actually seemingly no... well not without an API change which we can do but WritableSequenceFile requires the manifest for K and V which we won't have,155408340,2014-09-06 02:05:34
4542818,7111,17202925,5,"I'm confused as to how this can possibly work then. I bet the manifest being inferred is Nothing, and so this thing is going to break at runtime, but no one is using it.",155408340,2014-09-06 04:00:15
4542818,7111,17203082,5,Added this issue: https://github.com/twitter/summingbird/issues/546,155408340,2014-09-06 04:06:21
4542818,319889,17203222,5,Yeah that makes sense... we should scan for usage and kill if we can't find any?,155408340,2014-09-06 04:12:16
4542818,7111,17209629,5,"I don't want to delete the code, as it may be useful. But clearly we need
tests.

We can ignore it for now.

Merge when green.


On Fri, Sep 5, 2014 at 1:12 PM, ianoc <notifications@github.com> wrote:

> In
> summingbird-scalding/src/main/scala",155408340,2014-09-06 21:23:55
4648339,7111,17949539,49,"maybe this should not extend, but instead keep a private val to a ClientStore. I don't like that one is `[K, V]` but the other is `[(K, BatchID), V]`",157002851,2014-09-24 06:13:46
4648339,7111,18432386,97,this should just get the batch which is the key called b here.,168571162,2014-10-05 04:19:09
4648339,319889,18745721,57,"Kind of surprised we don't have some built in SG for this sort of thing elsewhere. Not an issue, though seems like having a future SG would be useful.",168571162,2014-10-12 09:38:23
4648339,319889,18745733,71,"This looks like we are partitioning a map of is the output type of this group by not Map[K1, Map[K1, V]]. Can the inner map ever be anything other than size 1?

If i'm getting the logic right here i think it should be .groupBy { case ( (k, _ ), _) => k ",168571162,2014-10-12 09:44:00
4648339,319889,18745771,66,"I'd try make this a little more accessible:
We start by finding the min BatchId for each K, and merge those ((K, BatchID), V) into the store first as they make up the basis of any (K, BatchID') where BatchID' > BatchID.  ",168571162,2014-10-12 10:03:15
4648339,319889,18748458,51,how much of these println's are for debugging vs test content? should they be asserts?,168571162,2014-10-12 21:31:00
4648339,319889,18748479,70,"Would be good to add a simple check where we attempt to merge  ((k, BatchID(1)), v1) ((k, BatchID(2)), v2) at the same time since we have code for this to ensure its ok.

Also a test confirming if we put something with BatchID(0) into the offline store ",168571162,2014-10-12 21:35:04
4648339,7111,51219210,71,good catch! Why tests didn't is a question...,168571162,2016-01-29 10:27:56
4677978,7111,17986298,22,should this be added to Platform? what is the contract here? When is it expected to be accurate?,157347732,2014-09-24 22:27:43
4677978,7111,17986355,35,seems weird to catch exceptions here. What are your thoughts? I am concerned this will hide real errors down the line.,157347732,2014-09-24 22:28:49
4677978,7111,17986391,28,let's go ahead and make this an AtomicLong.,157347732,2014-09-24 22:29:29
4677978,7111,17986538,14,can you copy this approach for the ConcurrentMemory platform? Seems like most of this will carry over.,157347732,2014-09-24 22:31:35
4677978,232760,17986686,14,"yep, can do. I'll make another PR when that is merged?",157347732,2014-09-24 22:33:28
4677978,13840,17986785,88,Do we want to use `putIfAbsent` here to handle a potential race?,157347732,2014-09-24 22:34:53
4677978,232760,17987063,35,"an exception here would result in an empty list so we'd just skip the counter registration code, so seems ok? We can add a log message noting that no counters were found. What are other possible errors this could hide?",157347732,2014-09-24 22:38:59
4677978,232760,17987132,28,will do,157347732,2014-09-24 22:40:15
4677978,232760,17987329,88,"yea, good point. I'll add that, thanks!",157347732,2014-09-24 22:43:16
4677978,319889,18046355,35,What are the exceptions we are looking to catch here?,157347732,2014-09-25 22:28:34
4677978,232760,18050922,22,"hm, I think this can work in scalding, but I am not sure about storm. The contract here is that the users create Counter objects, increment them in their job and then look at the final value after the job is done. With scalding, we can query the hadoop co",157347732,2014-09-25 23:41:03
4677978,232760,18051145,35,"If jobId is null, the registeredCountersForJob will throw a NPE (http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentHashMap.html#get(java.lang.Object))",157347732,2014-09-25 23:44:18
4677978,319889,18051483,35,Should we make that value private and make an api that returns Option[blah] instead of the exception? That way we can handle it at the call site of what we want to do and avoids needing exception handling code.,157347732,2014-09-25 23:48:51
4677978,232760,18051617,35,"Yea, that is a good idea. I'll add this change, thanks!",157347732,2014-09-25 23:50:27
4677978,7111,18069029,29,this should be a private val now.,158652705,2014-09-26 05:36:58
4677978,7111,18069061,49,why is this needed? Why not just make MemoryCounter extend CounterIncrementor?,158652705,2014-09-26 05:38:05
4677978,7111,18069076,63,does not need { },158652705,2014-09-26 05:38:27
4677978,7111,18069082,74,does not need { },158652705,2014-09-26 05:38:42
4677978,7111,18069334,95,"What if the jobId is present, but the values don't match? Looks like this is a silent failure in that case.

I think we need something like:
```scala
def registerCounters(jobID: JobId, counters: List[(String, String)]): Unit = {
  val memoryCounters ",158652705,2014-09-26 05:47:18
4677978,7111,18069460,95,"Wait, that loop would fail due to the putIfAbsent. Here is a fix:

```scala
def registerCounters(jobID: JobId, counters: List[(String, String)]): Unit = {
  val memoryCounters == // same as it is now.
  @annotation.tailrec
  def put(m: Map[String, M",158652705,2014-09-26 05:51:20
4677978,7111,18069613,35,"If the jobID is null, we *WANT* an exception. We don't want to catch that.

On Thu, Sep 25, 2014 at 11:44 AM, Ekaterina Gonina <notifications@github.com
> wrote:

> In
> summingbird-core/src/main/scala/com/twitter/summingbird/memory/Memory.scala:
>",157347732,2014-09-26 05:57:15
4677978,232760,18102260,49,I was following the set of abstractions on the other platforms (where the counter and incrementor are separate objects) to keep things consistent.,158652705,2014-09-26 22:30:38
4677978,38527,18102560,18,Is this going to be the new only/best way to set the jobId? Could make it final if that is the case. Same for platform.,158652705,2014-09-26 22:36:04
4677978,38527,18102753,26,What's the type of platformStatProviders? If it's a scala collection you can do .nonEmpty,158652705,2014-09-26 22:39:11
4677978,232760,18103065,95,"yes, good catch.",158652705,2014-09-26 22:43:39
4677978,38527,18103184,38,"Is there any reason it needs to return a list instead of a Seq? Also, might be worth typing group and name, (String, String) seems ripe for errors...",158652705,2014-09-26 22:45:41
4677978,38527,18103381,36,why do you bother with the val c allocation?,158652705,2014-09-26 22:49:05
4677978,38527,18103483,64,"countersForJob.get(jobId) should return exactly the type you want, no?",158652705,2014-09-26 22:50:48
4677978,38527,18103641,76,"I'm confused... how could this ever happen? You check if it contains passedJobId right before this, so if we hit the getOrElse it's clearly a bug, as it has to exist?",158652705,2014-09-26 22:53:58
4677978,232760,18104663,26,It's a wrapper class around a mutable set (MutableSetSynchronizedWrapper) which has the isEmpty method. I can use the nonEmpty there on the mutable.Set collection though. ,158652705,2014-09-26 23:13:29
4677978,232760,18104763,36,addAndGet returns a long but I need to return Unit in this function. Is there a nicer way to do this?,158652705,2014-09-26 23:15:25
4677978,232760,18104837,64,"countersForJob is a java ConcurrentHashMap, .get returns either the value or null, so we need to wrap it in an option",158652705,2014-09-26 23:16:54
4677978,232760,18105078,76,"if the jobID matches, the getOrElse tries to find the group + ""/"" + name string in the counter map for that job, so if that name is not there, the error is thrown.",158652705,2014-09-26 23:21:39
4677978,38527,18105389,64,Option(countersForJob.get(jobId)),158652705,2014-09-26 23:27:33
4677978,38527,18105446,76,"Ah, I see. Option(countersForJob.get(passedJobId)).map { _.getOrElse etc }",158652705,2014-09-26 23:28:34
4677978,232760,18114719,38,"it can be a Seq, no real need to have it as an explicit List type. I'll add the group/name types too to be safer.",158652705,2014-09-27 02:23:56
4677978,232760,18114917,64,:thumbsup:,158652705,2014-09-27 02:26:58
4677978,232760,18117844,18,"yea, the JMemory creates a scala Memory platform which needs an implicit jobId, in java it needs to be explicitly passed. This is only an issue for Memory platform since the Storm/Scalding platforms get it from a config. I'll make it final. We can make a ",158652705,2014-09-27 03:38:08
4904244,232760,18749782,35,can you do a .filter here and pass the gate function?,172096098,2014-10-13 01:11:46
4904244,232760,18749813,25,why is this needed now and wasn't before?,172096098,2014-10-13 01:16:37
4904244,232760,18750028,36,"here, you mean the left producer does not depend on store, not the service itself, right? can we rename this to something like ""left does not depend on store""?",172096098,2014-10-13 01:47:36
4904244,232760,18750064,93,could you put a more detailed comment about what this maxAvailable and limitTimes calls do?,172096098,2014-10-13 01:51:46
4904244,232760,18751057,1,"I'm confused by the comment about the second entry being None. Does it happen when there is a value in Option[JoinedV] but (K, V) shows up later in time?",172096098,2014-10-13 04:23:17
4904244,7111,18797375,35,"no, because the gate function takes a function1, but gate is function2, but this gives me some ideas to use more case matching and clean it up.",172096098,2014-10-14 02:51:03
4904244,7111,18797400,25,before we were inlining this rule (see below) and we were copying code.,172096098,2014-10-14 02:51:26
4904244,232760,18868666,138,remove storeLog,172420194,2014-10-15 05:20:06
4904244,232760,18869973,75,Option[Producer..],172420194,2014-10-15 06:00:16
5204735,7111,20344581,30,don't you want to use your sum on line 44 here?,184165036,2014-11-14 13:17:39
5204735,7111,20344771,12,"this is a big change. Why is it needed? What if the semigroup in the Summer Producer node is not the same as this?

Why can't we look up the correct Semigroup from the Dag?",184165036,2014-11-14 13:26:51
5204735,7111,20344798,22,"notice now you are ignoring the semigroup passed in (sg) in favor of semigroup. I fear hard to understand bugs here. Our goal should be that the API is impossible to misuse and still compile (not really possible, but our goal nonetheless). This API is eas",184165036,2014-11-14 13:28:40
5204735,7111,20344814,14,Don't think this should require a semigroup.,184165036,2014-11-14 13:29:37
5204735,7111,20344818,14,shouldn't require the semigroup.,184165036,2014-11-14 13:29:53
5204735,7111,20344864,23,should not need to thread Semigroup through everywhere.,184165036,2014-11-14 13:32:10
5204735,232760,20373618,12,"Yes, this is definitely non-ideal and I was going to ask you if there is a better way to do this. I need to have a Semigroup for V here: https://github.com/twitter/summingbird/pull/557/files#diff-85d7df9a5f994d907f8d33f2d2635e55R380. How can I get this se",184165036,2014-11-15 00:43:22
5204735,232760,20374603,30,"ah, yes, thanks :)",184165036,2014-11-15 01:00:15
5204735,7111,20621614,12,why is this here?,184402151,2014-11-20 08:14:51
5204735,7111,20621868,139,"can we add another case where it is a leftJoin but not a valid loop join and give a better error? Right now it will be a match error.

So:
```scala
case ljp @ LeftJoinedProducer(left, StoreService(store)) =>
  sys.error(""Unsupported Join against stor",184402151,2014-11-20 08:20:42
5204735,7111,20622022,53,"```scala
dag.nodes.exists { n =>

}
```
is more direct than map + contains.",184402151,2014-11-20 08:24:17
5204735,7111,20622051,76,no need for { } here.,184402151,2014-11-20 08:25:00
5204735,7111,20622067,93,why is this here?,184402151,2014-11-20 08:25:24
5204735,7111,20622101,98,no { } and use contains.,184402151,2014-11-20 08:26:00
5204735,7111,20622139,111,"```scala
dag.node.collectFirst { 
  case ...
}
```
you reimplemented it.",184402151,2014-11-20 08:26:53
5204735,7111,20622185,128,why do have explicitly and implicitly Semigroup[V]?,184402151,2014-11-20 08:27:48
5204735,7111,20622269,150,we don't need to use this. Just get the input to the summer using the Summer case class accessor.,184402151,2014-11-20 08:29:34
5204735,7111,20622324,158,isn't this always `Any => TraversableOnce[Any]`?,184402151,2014-11-20 08:31:05
5204735,7111,20622346,159,I think you want `Option[(Any) => TraversableOnce[Any]]`,184402151,2014-11-20 08:31:56
5204735,7111,20622382,175,"this is an error, right? If it is valid, we have to see the above.",184402151,2014-11-20 08:32:46
5204735,7111,20622449,180,I think you want to pass None.,184402151,2014-11-20 08:34:25
5204735,232760,20751197,12,leftover from debugging.. thanks,184402151,2014-11-22 07:16:39
5204735,232760,20751202,139,"yes, I will add this",184402151,2014-11-22 07:16:54
5204735,232760,20751228,93,"Talked offline, needed to fail when we saw an invalid dag. This is the wrong place to put it, will put it in the case match on the Producer nodes.",184402151,2014-11-22 07:17:40
5204735,232760,20751245,158,"Yes, we can make the type more constrained",184402151,2014-11-22 07:18:12
5204735,232760,20751256,159,"Thanks, I will use Options :)",184402151,2014-11-22 07:18:32
5204735,232760,20751685,128,We have to pass it explicitly from here: https://github.com/twitter/summingbird/pull/557/files#diff-85d7df9a5f994d907f8d33f2d2635e55R392. Will get rid of the implicit,184402151,2014-11-22 07:33:26
5204735,232760,20751758,175,"Yea, this shouldn't ever be the case since we call isValidLoopJoin before",184402151,2014-11-22 07:35:58
5204735,232760,20752796,111,nice :) good to know,184402151,2014-11-22 08:21:22
5204735,232760,20753027,150,"nice, thanks",184402151,2014-11-22 08:31:17
5204735,319889,20813336,16,needs an issue? or ?,184402171,2014-11-25 02:06:03
5204735,319889,20813542,30,"Lets stick a bigger comment above this, what is it aiming to do and such",184402171,2014-11-25 02:09:04
5204735,7111,20890577,54,"I thought we ditched using KeyedProducer in the input position. Can we change this to `Producer[P, (K, V)]` and get everything to compile.",184402183,2014-11-26 03:03:40
5204735,7111,20892537,6,"for the future, this could be: `assert(valid, ""Cannod cread valid source with the provided DateRange"")`",184402183,2014-11-26 03:25:21
5204735,7111,20892635,17,"better style: `val valid = dateRangeOpt.get.contains(dr)` avoid if(bool) true else false, just do bool.",184402183,2014-11-26 03:27:06
5204735,7111,20892712,5,"this removes testing of the unit batcher, which is sometimes used in online only. What's the reasoning here?",184402183,2014-11-26 03:28:08
5204735,7111,20895496,95,"minor, but let's clean this up:
```scala
dag.nodes.exists {
  case LeftJoinedProducer(l, StoreService(s)) => s == store
  case _ => false
}
```
no need for match on the only input.",184402183,2014-11-26 04:05:25
5204735,7111,20895537,106,"like above, no need for match on the only input (or the { } in the method definition as this is a single expression).",184402183,2014-11-26 04:06:05
5204735,7111,20895685,125,fancy.,184402183,2014-11-26 04:08:04
5204735,7111,20896835,151,"let's case match here:
```scala
cummulativeFn match {
  case Some(cfn) => ...
  case None =>
}
```
rather than isDefined + get. The latter pattern I only use for super high performance code where we have some evidence that case matching is slower, ",184402183,2014-11-26 04:23:56
5204735,7111,20896876,168,looks like a .map on fn here. Let's do that rather than reimplement it.,184402183,2014-11-26 04:24:33
5204735,7111,20896987,192,"notice this isDefined/get is in the hot path of our aggregation, not at the planning stage.",184402183,2014-11-26 04:26:09
5204735,232760,20964818,6,"Ok, I'll add this change",184402183,2014-11-27 04:23:43
5204735,232760,20964863,5,"The unit batcher doesn't really make sense in offline mode, the scalding tests all fail with a unit batcher. We can add a flag to not use a unit batcher from scalding tests?",184402183,2014-11-27 04:24:41
5204735,232760,20964875,168,"right, thanks",184402183,2014-11-27 04:25:01
5204735,232760,20964905,192,is this going to be an issue?,184402183,2014-11-27 04:25:37
5204735,7111,20965961,192,I think this is fine to leave as is. I was using it as an example of code that is in the hot path of execution (and in my view an acceptable place to avoid case matching in the hopes of speeding the code up).,184402183,2014-11-27 04:45:53
5204735,232760,20966420,192,"Ok, yes, this makes sense. ",184402183,2014-11-27 04:56:33
5284040,319889,21213719,31,is this a sane constructor to have? left join would always come back None?,184691282,2014-12-03 12:49:56
5284040,319889,21213746,5,"I'd put the type on this, i suspect each reference your doing here to store is actually a different store which isn't what we want.

(Is store a readable store or a () => Readable store? ) --> Possibly just putting storeSupplier.serviceStore() here inst",184691282,2014-12-03 12:51:05
5284040,232760,21250349,31,"hm, yea, we should only have the constructor with both stores defined",184691282,2014-12-04 00:55:36
5284040,232760,21250625,5,"it's a ()=>ReadableStore, yes, we need the () at the end, thanks",184691282,2014-12-04 00:58:53
5284040,7111,21258649,5,"can you write a return type on this. It is ambiguous (are we applying the function or no?).

Also, all public methods should have types.",185777311,2014-12-04 02:42:35
5284040,7111,21258816,5,return type please.,185777311,2014-12-04 02:44:06
5284040,7111,21259135,27,"I think we want `ReadableStore[(K, BatchID), V]` which lets you read the value at a certain BatchID.  And then if you have a MergableStore, which is both Mergeable and ReadableStore. Also, when we do the lookup, we should look at the time for the data, an",185777311,2014-12-04 02:47:54
5284040,7111,21259488,27,"Also, you could use a lazy parameter here and make the function below. This can be easier for users than writing the functions:
```scala
def apply[K, V](mStore: => Mergable[(K, BatchID), V], b: Batcher, sStore: => ReadableStore[K, V]) = ...
```",185777311,2014-12-04 02:52:27
5284040,232760,21264356,27,I have serviceStore function in Storm platform that takes the lazy parameters and turns them into functions https://github.com/twitter/summingbird/pull/563/files#diff-36ff64139544fb94baad353028959a1eR83. I was assuming users to be using that function like,185777311,2014-12-04 03:58:06
5284040,7111,21473413,3,"I think this can just be:

```scala
case class ReadableServiceFactory[-K, +V](override val serviceStore: () => ReadableStore[K, V]) extends OnlineServiceFactory[K, V]
```",185777312,2014-12-09 01:37:03
5284040,7111,21474210,27,"I don't think we want the latest key, we want the latest that is before the timestamp of tuple coming in. Consider the fact that the queues get delayed, and the fact that we have batch boundaries. You don't want some part of the topology (some queue for i",185777311,2014-12-09 01:47:32
5284040,7111,21474456,11,"why aren't we doing this trick on the other store factories? Is it because this is possibly called twice, once with toFn the other with serviceStore?

Can we add a comment here while we are working on updating this set of items?",185777312,2014-12-09 01:51:03
5284040,232760,21479066,27,"Well, if we constrain the lookup to use the BatchID then we would be limiting the error on the value to be up to that BatchID since we don't have the actual timestamp in the store? So it's more correct but still not exactly correct. Unless we use very sma",185777311,2014-12-09 02:45:29
5284040,232760,21480245,11,I'm not sure on the rationale behind having this lazy construct here and not in other places. AFAICT StormBuffer is not used anywhere either?,185777312,2014-12-09 03:00:26
5284040,7111,21693931,27,"Good point that we don't have the batcher at the service lookup. This inconsistency bothers me, but I guess fixing it is bigger than this. Added: https://github.com/twitter/summingbird/issues/568",185777311,2014-12-12 00:51:20
5284040,7111,21694315,4,"how do you use this? What do you put in for sStore?

Don't we need the ClientMergeable for this? If so, shouldn't we just take either that or the inputs in needs (like the offline store)? ",185777312,2014-12-12 00:56:27
5284040,7111,21694384,11,I guess it was just defensive. :/ Let's leave it for the time being.,185777312,2014-12-12 00:57:24
5284040,232760,21703847,4,"Right now, I have it setup with ClientStore like so:
```
val mergeableStore: MergeableStore[(Long, BatchID), Long] = Memcache.getMemcacheStore[(Long, BatchID), Long](Config.online)
val clientStore: ClientStore[Long, Long] = ClientStore(mergeableStore, ",185777312,2014-12-12 02:48:59
5284040,7111,21855887,4,"1. ClientMergeable could use composeKeyMapping to drop the batch and get a ReadableStore. But I think the ClientMergeable is really only needed when sumByKey output is consumed, not for the joining on store case.

2. Can you add that function you have t",185777312,2014-12-16 03:55:21
5284040,7111,21856477,4,"actually, that would make clientstore depend on summingbird-storm. Can we put that function in the `object Storm`?",185777312,2014-12-16 04:03:43
5284040,232760,21856949,4,"Are you talking about the function:
```
 def storeService[K, V](mStore: => Mergeable[(K, BatchID), V], sStore: => ReadableStore[K, V])(implicit batcher: Batcher): CombinedServiceStoreFactory[K, V]
```
? It is already in [object Storm](https://github.c",185777312,2014-12-16 04:10:14
5284040,7111,21857028,27,"I guess here is where I want it to be easier to use. Can't we add a method that deals with the clientstore business here? That is confusing as to how to wire up, and I'd rather see it documented in code that works for most cases, than a wiki doc that expl",185777311,2014-12-16 04:11:19
5284040,7111,21857097,3,no love for my simplification. :) ?,185777312,2014-12-16 04:12:28
5284040,232760,21867269,27,"Yea, good point. I will try to wire the ClientStore in here to simplify it for the users",185777311,2014-12-16 06:37:51
5284040,232760,21867284,3,didn't see this note :) will add the simplification,185777312,2014-12-16 06:38:06
5284040,232760,21868096,27,"We still need to distinguish between a service that uses online-only results (ClientStore(online)) and the one that combines online and offline (ClientStore(online, offline)). So, in user code, this would be:

```
val mergeableStore: MergeableStore[(Lo",185777311,2014-12-16 06:53:29
5287400,7111,21260916,26,"actually just below, you evaluate default more than once.

Might be better to do:

```scala
if (v == null) {
  val vToPut = default
  map.putIfAbsent(k, vToPut) match {
    case null => vToPut
    case vExists => vExists
  }
}
```
In this cas",184711182,2014-12-04 03:10:56
5310489,232760,21551297,18,"""Unsupported scala version error"" here?",184434761,2014-12-10 01:52:04
5310489,232760,21552009,108,aren't we still on 0.5.* version?,184434761,2014-12-10 01:54:28
5310489,7111,24049892,18,why not also pass the scalaVersion in the exception?,184434761,2015-02-04 06:15:11
5310489,7111,24050073,4,we can't do 2.11 until finagle get's their stuff out?,213783304,2015-02-04 06:17:12
5310489,622449,24139500,108,think this signals that the next release is incompatible already.,184434761,2015-02-05 09:34:40
5545077,319889,23256128,37,"Looks good, though i think a comment for each of these to describe them would be good. What does memory mean here?",197093820,2015-01-21 04:10:47
5593968,7111,22018367,7,"this does not look correct to me. There is a method that does this in Batcher.batchesCoveredBy does something related.

This code is not returning the timespan covered by the batcher in this minTime, maxTime range. It is extending the range of the botto",196258183,2014-12-18 08:13:46
5593968,7111,22018394,26,why delete this comment?,196258183,2014-12-18 08:14:54
5593968,7111,22018413,29,why not the name delta here? This is to distinguish the deltas from the previous results.,196258183,2014-12-18 08:15:23
5593968,7111,22018458,34,"while you are at it, can you replace this with a `s""${firstDeltaBatch}""` style?",196258183,2014-12-18 08:16:27
5593968,7111,22018551,5,can you add a comment as to what the resulting `Interval[Timestamp]` is?,196258183,2014-12-18 08:18:23
5593968,7111,22018891,34,"Can you add:
```scala
package object scalding {
// bunch of stuff:
def failure(msg: String): Try[Nothing] = Left(List(msg))
def success[T](t: T): Try[T] = Right(t) 
}
```
where `Try` here is our `Either[List[String], T]` type that we used before c",196258183,2014-12-18 08:27:01
5593968,7111,22019200,1,is this comment still active? This stuff is really easy to get wrong.,196258183,2014-12-18 08:35:39
5593968,7111,22019388,5,I guess the `Interval[Timestamp]` is the maximum range covered by the `FlowToPipe[T]` while the `Interval[BatchID]` is a strict subset of that time range. So we can provide more than the Batched range. Is that right?,196258183,2014-12-18 08:41:52
5593968,7111,22019458,5,"Wait, no it is the opposite of what I said due to the intersection.",196258183,2014-12-18 08:44:13
5593968,7111,22019708,63,"I guess I think this should not do the intersection at all here. You should basically be computing a `ExclusiveUpper[BatchID]` the snapshot at that point, and then the range of time from the moment after the last snapshot up to the upper bound that was re",196258183,2014-12-18 08:52:12
5593968,7111,22019769,82,"I would argue that the filtering should go in mergeBatched before we write, but otherwise we should produce the full available range (in case of downstream consumers that want as much as possible).",196258183,2014-12-18 08:53:57
5593968,232760,22022353,63,"@johnynek, this code refactors what was in master, it is based on what you had in the original PR #551. The logic is the same as what is in master, AFAICT, except this refactors readBatched to be used to now produce the delta stream for leftJoin. I moved ",196258183,2014-12-18 10:45:49
5593968,232760,22022502,7,This  change came up to repro of #567 and internally as well. This is used in the tests. Why do we shift the input to the next batch for the tests? It does not seem to correspond to what we do in actual summingbird-scalding jobs based on debugging. We use,196258183,2014-12-18 10:53:56
5593968,7111,22135556,10,outer { } are in short supply. Conserve them carefully and not waste them here.,197245321,2014-12-20 06:25:41
5593968,7111,22135619,12,"I think you want batchesCoveredBy, since those are the only batches eligible to be written right?",197245321,2014-12-20 06:27:45
5593968,7111,22135681,22,"I think we need to limit times on the merged, not before. If we do it before, we might remove deltas that need to be added in mergeAll.",197245321,2014-12-20 06:29:46
5593968,232760,22135832,12,"yes, you're right, we want the batches that are fully covered by the readTimespan",197245321,2014-12-20 06:34:00
5593968,232760,22136009,22,"Right, thanks for catching that",197245321,2014-12-20 06:40:16
5593968,7111,22136237,54,"while you are at it, can you put `(lastBatch, lastSnapshot) = bidFp` here?",197245321,2014-12-20 06:47:18
5593968,7111,22137970,86,"do we need this? Can't we just read from the firstDeltaTimstamp, to timeSpan.upper? I don't see why we need the batching except to avoid doing the interval math. But that would just be a method like:

```scala
def setLower(lb: InclusiveLower[Timestamp]",197583937,2014-12-20 07:57:12
5593968,7111,22138022,125,"don't we need to readjust the timespan down to include actualLast, or can you comment that we don't?",197583937,2014-12-20 08:00:00
5593968,7111,22138252,121,let's add a comment that the returned Interval[Timestamp] does NOT include the snapshot data point (which occurs exactly 1 millisecond before the start of the Interval).,197583937,2014-12-20 08:11:34
5593968,7111,22182059,26,should we add a comment that maxTime is exclusive?,197773611,2014-12-23 01:37:52
5593968,7111,22183359,46,"can we change the name to this method:
`readAfterLastBatch` or something? It is reading from input all the data AFTER the most recent batch on disk, right?",197773611,2014-12-23 02:01:51
5848081,232760,22951410,5,"Here's the stack trace from the test if we don't wrap in IdentityKeyedProducer:
```
[error] ! StormPlatform matches Scala for left join with flatMapValues jobs
[error]   ClassCastException: com.twitter.summingbird.FlatMappedProducer cannot be cast to c",204768259,2015-01-15 00:05:49
5848081,7111,22969907,5,Okay. This code was actually the predecessor of the Dag optimizer code. I bet we could remove it now and replace the remove name nodes dag rule. I feel like that might be a cleaner solution since this code is actually making a false assumption (the strip ,204768259,2015-01-15 04:07:35
5848081,7111,22915224,5,is line 283 above going to have the same issue?,204768259,2015-01-14 10:45:19
5848081,7111,22915248,5,I'm still not understanding why this is an error. Can you post a gist to a stack trace that hit the issue?,204768259,2015-01-14 10:46:02
6230131,622449,24478275,6,"was this deleted on develop on purpose, or added in master and we want to keep it?",216646733,2015-02-11 14:44:04
6230131,622449,24478265,4,"Everything in this file is easy to fix, so no worries here",216646733,2015-02-11 14:43:41
6230131,622449,24478290,4,Assuming we just want the HEAD block here? (head is the release branch),216646733,2015-02-11 14:44:44
6230131,622449,24478299,29,assuming HEAD is more up to date here too?,216646733,2015-02-11 14:45:27
6230131,7111,24478399,6,"It was added, if I'm not mistaken.",216646733,2015-02-11 14:49:43
6230131,7111,24478414,6,"Wait, actually, I don't know.",216646733,2015-02-11 14:50:10
6230131,7111,24517490,6,@egonina should comment here. I guess we are going to want it.,216646733,2015-02-12 01:08:25
6230131,232760,24517754,29,"Yes, HEAD is the latest",216646733,2015-02-12 01:11:19
6230131,232760,24517766,4,Yes,216646733,2015-02-12 01:11:26
6230131,232760,24518051,6,"No, we fixed it with [this](https://github.com/twitter/summingbird/blob/develop/summingbird-core-java/src/main/java/com/twitter/summingbird/memory/javaapi/JMemory.java#L33) in the later version. We can take the HEAD version here. ",216646733,2015-02-12 01:14:28
6269169,319889,24683037,1,"This is missing new line at end of file, package statement at the top and the apache header",217666389,2015-02-14 01:02:51
6269169,319889,24683058,47,"The package location of these hasn't changed, so the imports shouldn't need to either?",217666389,2015-02-14 01:03:03
6475508,7111,25631487,6,"please use the Algebird implementation of this since we already depend on Algebird.

com.twitter.algebird.monad.Reader and the code may just compile.",224473123,2015-03-03 02:51:15
6741132,89478,26797365,42,log should replace readDeltaTimestamps with firstDeltaBatchInterval,233902827,2015-03-20 03:03:16
6756627,7111,26993710,70,".zip or .join with `Arbitrary.arbitrary[Map[Int, Int]]`",235441641,2015-03-24 06:08:19
6756627,7111,26993759,70,"don't have two maps back to back, just do one.

Also, maybe for comprehension here.",235441641,2015-03-24 06:09:07
6756627,7111,26994034,149,"```scala
mergeResult match {
  case Left(l) => l.mkStrintg(...).label(...)
  case Right(_) => Prop.failed? false.label(...)?
}
```",235441641,2015-03-24 06:14:25
6756627,7111,26994057,2,"revert this file, I think.",235441641,2015-03-24 06:14:52
6756627,7111,26994085,15,no commented code. Maybe debug?,235441641,2015-03-24 06:15:18
6756627,7111,26994115,65,no outer { },235441641,2015-03-24 06:15:42
6756627,7111,26994298,92,"This should be:
```scala
case Right(((Itersection(InclusiveLower(lower), ExclusiveUpper(_)), _), ) =>
  lower == batcher.earliestTimeOf(testStore.initBatch.next)
```",235441641,2015-03-24 06:19:03
6756627,7111,26994412,92,Can we also test the upper bound? What is the property there? Same as interval upper bound? <= that?,235441641,2015-03-24 06:21:12
6756627,7111,27054659,57,why do you have the fake data here? Why not use `PipeFactory[Nothing]` which is a subclass of all PipeFactories? TypedPipe.empty gives you a `TypedPipe[Nothing]`,235466786,2015-03-24 23:53:23
6756627,7111,27054920,128,let's make an Arbitrary Commutativity and test for both Commutative and NonCommutative,235466786,2015-03-24 23:55:34
6756627,89478,27056375,57,"It's because for merging, if it returns a TypedPipe[Nothing], then I need to define a semigroup of Nothing",235466786,2015-03-25 00:08:37
6756627,7111,27056534,179,let's remove println,235466786,2015-03-25 00:10:08
8320639,7111,37003476,60,I don't think we need the `.toPipe` anymore. That bug was fixed.,279277222,2015-08-13 22:49:25
8320639,7111,37003897,60,"Also, the `import Dsl._` above I think will be unneeded at that point.",279277222,2015-08-13 22:52:48
8320639,7111,37004840,149,incomplete comment.,279277222,2015-08-13 23:00:21
8320639,7111,37014476,70,"this constraint is probably a pain point. So I think the real bug comes from crashed that happen after writing the store output, but before we commit to the WaitingState that we have processed a block of time.",279277219,2015-08-14 00:20:39
8320639,319889,37016240,70,That period should be small? And your WS needs to be unreliable for this to be a thing right? It should be the small thing at the end. The only other alternative I think is to probably delete the stores when we start -- but they could be already consumed ,279277219,2015-08-14 00:37:26
8320639,7111,37017221,70,"How will it recover? Imagine we write the store but crash before we write to statebird. Statebird keeps telling you to run yesterday's block, but the job keeps failing because it has already written and there is only one store.",279277219,2015-08-14 00:47:53
9943833,7111,42421804,36,does this need to be a lazy val? Maybe just val and not have the thread sync costs? hashCode of a Long must be really fast.,333348969,2015-10-20 01:30:40
9943833,7111,42421865,4,maybe just val here?,333348969,2015-10-20 01:31:13
9943833,7111,42421893,4,good catch.,333348969,2015-10-20 01:31:27
9943833,7111,42421944,6,can you comment on the intent here?,333348969,2015-10-20 01:31:57
9943833,7111,42422064,24,"this is weird. You have a protected method returning a private[batch] type. So, doesn't that effectively make this method `private[batch]` which may not be what we want, but maybe?",333348969,2015-10-20 01:32:55
9943833,7111,42422213,32,"this is going to make it so that each key, batch pair is unique in the map, so the values will never be reduced, right? Why not just skip mapside aggregation entirely?",333348969,2015-10-20 01:34:19
9943833,7111,42422308,32,"This is super confusing. It seems like you are using a type to disable sumByBatches doing anything, but why not just not call it?",333348969,2015-10-20 01:35:06
9943833,319889,42422342,4,"Far, habbit. Indeed 1234L.hashCode == 1234L on the jvm",333348969,2015-10-20 01:35:20
9943833,319889,42422433,6,"Sure, any concerns about doing it. Needs a comment tho

In general should we add a set of these Tuples to algebird/bijection at some point maybe? ",333348969,2015-10-20 01:36:09
9943833,319889,42422556,24,"Your right, it doesn't make any sense, the type leaks out. I could make the tuple type public itself maybe. Any changes to this will break the public api alas, though not in a way almost anyone would ever use, but still possible.",333348969,2015-10-20 01:37:14
9943833,319889,42422776,32,Can we not have multiple matching ones here? we have a monoid on Timestamp for max and a semigroup on the users V. Does this not do our normal mapside agg rather than aiming for uniqueness? ,333348969,2015-10-20 01:39:19
9943833,319889,42423408,32,"I'm not sure what you mean here? are you talking about old behavior or new? This code change shouldn't have changed the behavior of this code, just replaced the built in tuple2 with the lazy hash code version",333348969,2015-10-20 01:44:31
9943833,7111,42424215,32,I was confused. I thought you were using `System.identityHashCode`. I didn't read carefully enough. The comment helps. Never mind.,333348969,2015-10-20 01:51:52
9943833,7111,42424343,13,looks like we are always going to hit the hashCode here. Maybe drop lazy and just directly val it?,333379991,2015-10-20 01:52:59
9943833,319889,42424993,4,Xprof reading pass time pays off :),333348969,2015-10-20 01:58:24
9943833,319889,42425098,13,Sure yeah makes sense,333379991,2015-10-20 01:59:20
9967295,7111,42555417,120,I don't think this is needed anymore (I think scalding already puts in the scalding.flow.submitted.timestamp).,333895821,2015-10-21 02:14:51
9967295,7111,42555074,5,maybe import Config here? Looks a little strange.,333895821,2015-10-21 02:12:06
9967295,319889,42563329,120,Should we keep the SB one? or just drop both?,333895821,2015-10-21 03:28:29
9967295,7111,42657584,98,can we use the `.serSerialization(Right(...))` case if passedRegistrars.isEmpty?,333895819,2015-10-21 22:49:26
9967295,7111,42657890,23,this does not seem correct to me. You shouldn't just pass a millis to a `BatchID`. That's what Batchers do. Why is this change here?,333895819,2015-10-21 22:51:42
9967295,319889,42658870,23,"Thats what I thought too, but actually this is what we were doing here before too. 

BatchID's constructor that I removed as part of this (had to for AnyVal erasure reasons):
 def apply(ts: Timestamp) = new BatchID(ts.milliSinceEpoch)

So this prior ",333895819,2015-10-21 22:58:35
9967295,7111,42661862,23,"Looks like @reconditesea wrote this code. It seems like it should be `batcher.batchOf(input._2)` and while we are at it, I'd rewrite this as:

```scala
.filter { case (isGood, timestamp, _) => isGood && (batcher.batchOf(timestamp) < exclusiveUB) }
```",333895819,2015-10-21 23:19:57
9967295,7111,42661968,23,"by the way, that `apply(ts: Timestamp)` just seems like a broken method. How did that stick around so long? ",333895819,2015-10-21 23:20:49
9967295,319889,42663080,23,"Thats a good question, i guess we don't look at this stuff that often",333895819,2015-10-21 23:28:33
10462682,814892,44819967,79,Just curious how this hold true given LTuple2 and Tuple2 don't have any type hierarchy between them. This will break if the ScalaRunTime implementation changes in the future?,345918436,2015-11-14 02:00:50
10462682,319889,44820225,79,"Both LTuple2 and Tuple2 are case classes, and both use the case class hash code method. So they should be synchronized across any upgrades. If something happens and that doesn't hold then its probably good we look at this for this test failing",345918436,2015-11-14 02:02:57
10471856,319889,45080044,5,should add to the comment that we are returning the name we found with the option,347578339,2015-11-17 23:16:05
10629063,319889,45569915,10,if you do the also a second time will it do anything funky? ,349717048,2015-11-23 09:37:50
10629063,7111,45570136,10,"I tried a bunch of stuff (which is why it is not trivial example up there). I started with `comp.also(comp)` and expanded out. I just ran it with an extra `.also(comp)` and that passed for me as well.

I think there is a chance he had a service backed b",349717048,2015-11-23 09:52:36
10992543,7111,47307919,17,here is the bug that hits `ConcurrentMemory`.,358576467,2015-12-11 08:31:45
10992543,7111,47308385,32,"here is the bug in Memory producer. You should make the `lforcedEmpty` lazy or be sure to plan the right before you evaluate it. Here I do both since it seemed more correct to plan as much as possible before causing side effects, but also that we don't wa",358576467,2015-12-11 08:37:56
10992543,319889,47389377,17,The bug here is that the dependantsOf(p) != r in this case? ,358576467,2015-12-12 02:49:20
10992543,7111,47390246,17,"yes, I was looking up the graph, then dependantsOf brought me back down, causing an infinite loop. Wrong direction.",358576467,2015-12-12 02:57:07
10992543,319889,47394185,8,s/all dependencies/all dependants ?,358576467,2015-12-12 03:28:39
10992543,7111,47394454,8,"no, I think that is right. It is saying if you look up (towards dependencies) for all the returned nodes, they will either be Merged, Also or inp. I could add a test to verify that. In fact I should (but the test I added was related).",358576467,2015-12-12 03:30:36
10992543,319889,47397437,8,"Yeah, seems right",358576467,2015-12-12 03:53:10
15280209,7111,67081745,40,can we use `.ensure(numPendingOutstandingFutures.decrementAndGet())`?,459442404,2016-06-15 07:28:34
15280209,7111,67081762,39,can we use `numPendingOutstandingFutures.incrementAndGet()`,459442404,2016-06-15 07:28:48
15280209,7111,67081933,21,should this be a tunable option with a default of 2?,459442404,2016-06-15 07:31:04
15280209,7111,67082267,21,maybe not for now. We can revisit if this does not fix the issue. Less knobs are better.,459442404,2016-06-15 07:34:49
15280209,550921,67098638,40,Good idea.,459442404,2016-06-15 11:38:17
15280209,550921,67099519,21,"I agree, making this a knob seemed overkill to me as well.",459442404,2016-06-15 11:54:04
15616105,7111,68678673,38,how does this help if we are just calling `.get`? Are you sure this is needed? Would marking it `@transient` also work instead (and be simpler)?,470378152,2016-06-28 07:10:06
15616105,7111,68678696,5,we usually don't use `{ }` in case blocks.,470378152,2016-06-28 07:10:24
15616105,2221968,68679851,38,"The openHook param is passed by name, so get is actually called on the other side (where the spout is opened).

I'm not sure about how to make this @transient (AFAIK that applies to class members, while this is function-local).

TBH I'm not sure why t",470378152,2016-06-28 07:25:13
15616105,7111,68692448,38,"okay, if it is call-by-name, I guess this is fine.",470378152,2016-06-28 10:21:55
15616105,2221968,68999151,38,"Was looking around this today; it's possible this doesn't cause an issue right now because the default `Spout` implementation for openHook is to ignore it:

https://github.com/twitter/tormenta/blob/v0.11.1/tormenta-core/src/main/scala/com/twitter/tormen",470378152,2016-06-30 01:14:56
15617088,7111,68809457,39,"can we use `fs.foreach` here?

",470419581,2016-06-29 01:01:07
15617088,7111,68809569,32,we could just return `Future.Unit` when `n <= 0` similar to how `drop(n)` is identity when `n <= 0`.,470419581,2016-06-29 01:01:44
15617088,7111,68809765,40,can we use `f.ensure`? I prefer that we use `.` since without it sometimes you hit weird `;` inference problems which confuse newcomers.,470419581,2016-06-29 01:02:37
15617088,7111,68810844,42,"can we add a comment here, something like:
```
Note, since we are only decrementing, we can only cross the value 0 one time (unless we decrement > 2^(32) times).
```",470419581,2016-06-29 01:08:30
15617088,7111,68811046,39,this will consume all the items from the Queue. Is that the intent? Can we add that comment to the method call?,470419581,2016-06-29 01:09:31
15617088,7111,68811235,31,"maybe it is better to take `Iterable[Future[A]]` and use `Queue.toSeq` to mutate and take from the queue. Otherwise, it might not be clear we are mutating the Queue.",470419581,2016-06-29 01:10:27
15617088,7111,68811573,62,"I'm worried that this is emptying the queue, and even if we don't wait for all of them, and I'm worried we could have OOM issues with futures building up that are never satisfied.",470419581,2016-06-29 01:12:11
15617088,7111,68813582,62,we could call `outstandingFutures.toSeq` then wait on `toClear` then requeue all the futures that are not defined.,470419581,2016-06-29 01:22:47
15617088,7111,68813740,66,"can we use scala interpolation strings: `s""forceExtra failed on $toClear Futures""`",470419581,2016-06-29 01:23:30
15617088,550921,68835625,39,"I didn't realize that foreach on queue is removing dequing items from the queue. Removing items from the queue is expensive, I want to avoid doing that. Let me rethink this.",470419581,2016-06-29 03:23:50
15617088,550921,68836240,62,"My bad, didn't realize the foreach on queue was dequeing. I don't actually want to dequeue elements, it's expensive. I just want to iterate over them. Is that problematic on the queue?",470419581,2016-06-29 03:27:08
15617088,7111,68844243,62,"I'm not sure dequeueing is much more expensive than iterating. Iterating over a mutable collection is problematic. I think dequeue + requeue is clearer semantic.

With your previous check that we only do this when the number of finished futures is high,",470419581,2016-06-29 04:11:11
15617088,7111,68866191,30,"you want `outstandingFutures.putAll(dequeuedFutures.filterNot(_.isDefined))` right? You don't want to requeue if the future is complete, do you?",470893359,2016-06-29 07:10:34
15617088,7111,68866294,27,"you are not using this, are you?",470893359,2016-06-29 07:11:58
15617088,7111,68866437,56,we might need a lot more time than this on travis. It is very slow and often timeouts like this become flakey.,470893359,2016-06-29 07:13:37
15617088,550921,68895951,56,Increased timeout.,470893359,2016-06-29 14:15:20
15617088,550921,68895965,27,Removed.,470893359,2016-06-29 14:15:34
15617088,550921,68895980,30,You're right. Fixed and added test.,470893359,2016-06-29 14:15:43
15617088,7111,69001669,16,no need for the spaces. One big sorted block is fine.,471028985,2016-06-30 01:28:13
15617088,7111,69002090,80,"one feature of the old algorithm is that it went in order, so one future could not wait too long. The new approach will allow a future to wait forever. Maybe that is okay, but it is a difference.",471028985,2016-06-30 01:30:34
15617088,550921,69019024,80,"Could you explain a bit more on ""one future could not wait too long"".  The wait would have timed out with MaxFutureWaitTime, are you referring to that. In the new algo it can stay in the queue forever but that should be rare, futures would almost always h",471028985,2016-06-30 03:17:10
15617088,550921,69020248,16,I was about to remove the spaces but then I saw that the whole project (summingbird-online) uses this format with spaces. Should I still remove spaces?,471028985,2016-06-30 03:24:46
15617088,7111,69021632,80,"Yes, it would have timed out with MaxFutureWaitTime. Now, that is not true, so the users need to force timeouts on their futures, otherwise they could last quite long.

I think that will be okay, but I bet some folks will see weird corner cases. Be prep",471028985,2016-06-30 03:32:21
15617088,7111,69026237,16,yes. Old style.,471028985,2016-06-30 03:57:05
15617088,7111,69214630,79,"maybe rather than `dequeueAll` we want to do:
```scala
val (finished, pending) = outstandingFutures.toSeq.partition(_.isDefined)
val toClear = pending.size - maxWaitingFuturesCount
if (toClear > 0) {
  // wait on N, put the ones still not defined at ",471929895,2016-07-01 04:33:36
15617088,550921,69216353,79,I also noticed another issue which earlier implementation was accidentally avoiding. Since we'll now unblock immediately when we are below the limit we'll likely hit the limit pretty soon and then the high cost of iterating over all futures will come into,471929895,2016-07-01 04:46:30
15617088,7111,69224314,79,"that may work well. It is hard to guess often. Is there a real job you can test with to see how it performs or a benchmark suite?

We could add a `dropWhile` method to queue and on every call do `dropWhile(_.isDefined)` to very cheaply prune. When a fut",471929895,2016-07-01 05:56:37
15617088,550921,69226733,79,"We might keep hitting the limit in terms of pending futures too. We get events in the bolt at a great rate, immediately after we clear the futures to get down to the limit we'll get another event and check again, by that time, or a few events later, we mi",471929895,2016-07-01 06:22:53
15617088,550921,70758572,79,"I wrote a benchmark for a case with high store latency. I found that this change clearly increases throughput. Also the watermarks didn't make any difference. I've removed the watermark logic.

Here are the benchmark numbers before and after this change",471929895,2016-07-14 14:17:38
15617088,7111,70812782,89,"I'm worried that is the `TimeoutException` happens, then we never put any futures back. I think in that case we should put them all back? What do you think about?

```scala
try {
   Await.ready(AsyncBase.waitN(pending, toClear), maxWaitingTime.get)
}",476692691,2016-07-14 21:17:26
15617088,550921,70858693,89,Makes sense. Updated.,476692691,2016-07-15 01:30:54
15617088,550921,70859888,13,Running tests automatically restores the old formatting. Any tips on how to go about disabling that?,477006057,2016-07-15 01:38:00
15617088,7111,70862897,13,"we use scalariform to fix the formatting. The goal is not to fight it.

:)

Maybe we should move to scalafmt:
https://github.com/olafurpg/scalafmt",477006057,2016-07-15 01:54:46
15639091,2221968,69001943,65,Let's assert both settings?,471335569,2016-06-30 01:29:42
15639091,550921,69021382,65,"Do you mean:
    assert(bolts(""Tail"").get_common.get_parallelism_hint != 10)
    assert(bolts(""Tail"").get_common.get_parallelism_hint == 20)
",471335569,2016-06-30 03:30:41
15639091,550921,69358182,65,"I'm trying to write the unit test for scalding platform. I'm trying to use the Reducers option for this. For the online platform tests we could inspect the created topology to check the number of summer nodes created, how do I do the corresponding thing f",471335569,2016-07-02 04:33:34
15639091,7111,69664467,77,what is T?,472749356,2016-07-06 08:28:56
16221767,2221968,74854673,24,"If we're going to correct the style here, it should be:
```scala
srcNodes.keySet.foreach { x =>
  assert(...)
  assert(...)
}
```",494112558,2016-08-16 06:34:12
16221767,2221968,74855166,42,Let's drop this,494112558,2016-08-16 06:38:52
16221767,2221968,74855791,58,"I think it makes sense to create a helper method that combines the `openHook` and `getSpout` calls.  Something like:
```scala
// Tormenta bug where openHook might get lost if it doesn't happen right before getSpout
def getStormSpout[T](spout: Spout[T],",494112558,2016-08-16 06:45:01
16221767,2221968,74855886,31,"This is messy, since builder will have type `Any` (`BuildSummer` or `Unit`)",494112558,2016-08-16 06:45:57
16221767,2221968,74856228,30,Is this used?,494112558,2016-08-16 06:49:11
16221767,7111,74856737,31,"why not move this below where you do:
```scala
summerOpt match {
  case Some(s) =>
    // now make the builder:
   val builder = BuildSummer(this, stormDag, node, jobID)
```",494112558,2016-08-16 06:54:07
16221767,7111,74856842,64,"can you put a return type so we can see what the `K, V` relate to?",494112558,2016-08-16 06:55:12
16221767,2221968,74856889,64,"This should not be a one-line.

`List[Int]()` can be just `Nil` or `List.empty[Int]`",494112558,2016-08-16 06:55:42
16221767,7111,74856979,30,if we must have a `var` please make it private. I don't know if we must.,494112558,2016-08-16 06:56:54
16221767,7111,74857367,64,"1. please do not do the `Integer` to `Int` cast. This can sometimes work, but it is confusing as to when.
2. `returns.flatMap(toScalaList(_))` is better and write a private function.
",494112558,2016-08-16 07:00:53
16221767,7111,74857477,75,does this storm type really expect an `Option[Any]`? Can you add a comment as to why that works?,494112558,2016-08-16 07:02:13
16221767,7111,74857687,111,you don't need `scala.` just `AnyRef` will do.,494112558,2016-08-16 07:04:51
16221767,7111,74857941,57,"why did you convert `toList` rather than just operating on the `Traversable`? Also, we generally use `TraversableOnce`, why `Traversable` here?",494112558,2016-08-16 07:07:29
16221767,7111,74858152,76,can this be private? does not look safe.,494112558,2016-08-16 07:09:55
16221767,550921,74858286,24,"Also, may want to take out storm.get.dependantsOfM.asJava.get(x) out into a temporary variable to increase readability.",494112558,2016-08-16 07:11:21
16221767,7111,74858284,78,why are we using a mutable list here? Where did it come from? Why do we thing `msgId` will be an `Option`?,494112558,2016-08-16 07:11:20
16221767,550921,74858596,30,"Line too long, split.",494112558,2016-08-16 07:14:42
16221767,550921,74861089,31,"+1

I think we need to refactor all this logic so that there is a simple code path for when a special spout is not needed. All the variables needed for creating the special spouts should move close to the creation of that spout and not pollute the code ",494112558,2016-08-16 07:45:08
16221767,550921,74861892,28,private?,494112558,2016-08-16 07:54:29
16221767,550921,74861973,33,"private?

You should only expose methods and properties that you want to be public. Make everything else private.",494112558,2016-08-16 07:55:17
16221767,550921,75178157,63,"doc style comments, as elsewhere in the repo.",494820747,2016-08-18 01:22:07
16221767,2221968,75197647,65,"The `counters` we're passing is actually a `Seq`:

https://github.com/twitter/summingbird/blob/v0.11.0-RC1/summingbird-core/src/main/scala/com/twitter/summingbird/Stats.scala#L96

Lets make it a `Seq` here and avoid the `toSeq` call below.",494820747,2016-08-18 03:14:30
16221767,550921,75225281,41,Can we call it summer instead of s? While the context for the block is small the surrounding context is pretty big so little verbosity seems useful here.,494820747,2016-08-18 06:18:58
16221767,550921,75225770,33,can we move this and the following if block to a separate function? That's the only place where it's needed.,494820747,2016-08-18 06:24:00
16221767,550921,75225963,46,Don't think we need curly braces here and for the Some case above.,494820747,2016-08-18 06:25:46
16221767,550921,75226834,93,"Can we move this out to a separate file, like FlatMapBoltProvider?",494820747,2016-08-18 06:34:11
16221767,550921,75227537,2,This is not intentional I suppose. We should make sure to revert this before merging.,494820747,2016-08-18 06:41:42
16221767,550921,75227740,60,"Doc comments, same everywhere else in this file.",494820747,2016-08-18 06:43:54
16221767,550921,75228296,20,Remove blank line.,494820747,2016-08-18 06:49:33
16221767,550921,75228454,27,"We can shorten it to ""summers for streams"" without loss of meaning.",494820747,2016-08-18 06:51:14
16221767,550921,75228499,30,has a stream level tracking -> has stream level tracking.,494820747,2016-08-18 06:51:51
16221767,550921,75228615,35,This is called from.,494820747,2016-08-18 06:52:57
16221767,550921,75228671,36,It is triggered...,494820747,2016-08-18 06:53:32
16221767,550921,75228914,53,Can we add a comment here to explain why Await is ok here.,494820747,2016-08-18 06:55:56
16221767,550921,75232043,31,"What is the Int in MMap[String, MMap[Int, MList[Object]]](), may be a good idea to explain in comment.",494820747,2016-08-18 07:30:15
16221767,550921,75232518,102,Why do we need to keep track of message ids by summer id?,494820747,2016-08-18 07:36:14
16221767,550921,75238233,28,Rename to cachesByStreamId or something similarly descriptive. Spout doesn't add any meaning.,494820747,2016-08-18 08:57:29
16221767,550921,75238651,89,Can we add return types for all the methods? It's not strictly required for private methods but in this case seems needed.,494820747,2016-08-18 09:03:50
16221767,550921,75239090,68,May be call out here the fact that we are using a list of message ids as the message id provided to output collector.,494820747,2016-08-18 09:10:26
16221767,550921,75239338,68,This collector is too tied to the spout. Spout needs to know that the message id is actually a list. This class should be private to KeyValueSpout or in some other way not accessible to any other code.,494820747,2016-08-18 09:14:41
16221767,550921,75239825,22,Remove blank line.,494820747,2016-08-18 09:23:02
16221767,550921,75240045,107,How do we know that list can't have more than one element?,494820747,2016-08-18 09:26:21
16221767,550921,75240438,108,How do we know that this will be of type K? Same for value below. Is this part of the contract? If so how and where is the contract defined?,494820747,2016-08-18 09:32:20
16221767,550921,75238433,91,"It's not obvious what cac stands for, can we use something descriptive?",494820747,2016-08-18 09:00:33
16221767,550921,75240990,53,"The way AsyncSummer behaves is that it will return empty result most of the time and non-empty results only when it flushes. We should short circuit for empty result to avoid processing below in those cases, e.g. creation of ArrayList. Also blocking on fu",494820747,2016-08-18 09:41:32
16221767,550921,75248240,53,Another issue is with use of AsyncSummers that are actually async. They perform operations in the background. Waiting on the resulting future will defeat that and actually degrade performance because they pay a penalty to push processing to background.,494820747,2016-08-18 11:45:11
16221767,550921,75248520,19,separated -> separate,494820747,2016-08-18 11:49:51
16221767,550921,75248729,24,We need unit tests for this class. Also would be good to test it along with AggragatorOutputCollector.,494820747,2016-08-18 11:53:53
16221767,550921,75249125,52,"Would be good to have a metric for time spent in this function, since we're doing extra processing here than what the spout would have done otherwise. When this was happening in a separate bolt we would have got execution time and process time metrics fro",494820747,2016-08-18 12:01:57
16221767,7111,75349652,15,"why the inner `{` here, and why the `.asJava`? Why not just call the method we want on the scala collection?",494820747,2016-08-19 00:17:47
16221767,7111,75349716,46,+1,494820747,2016-08-19 00:18:12
16221767,7111,75350949,21,I still think this method should not Await. Can the caller await or can it return a `Future[JList[Integer]]`?,494820747,2016-08-19 00:25:37
16221767,7111,75355134,70,`.getOrElseUpdate` here and you won't have to put it back in at the end on line 103 (which will save work).,494820747,2016-08-19 00:49:01
16221767,7111,75355626,47,can you explain how calling a java API (.emit) below will know how to deal with these scala types (`Option[TraversableOnce[AnyRef]]`). It is very hard to read this code and see how it is safe.,494820747,2016-08-19 00:51:45
16221767,7111,75356459,34,"maybe it would be better to just do:
```scala
val list = new java.util.ArrayList[AnyRef](2)
list.add(k.asInstanceOf[AnyRef])
list.add(v.asInstanceOf[AnyRef])
```",494820747,2016-08-19 00:56:14
16221767,7111,75358170,8,"This method has a lot of ways to fail at runtime. Can we make it private and rework?
```scala
private def castToTraverableOnce(shouldBeOptionTO: AnyRef): TraversableOnce[AnyRef] =
  shouldBeOptionTO match {
    case Some(s: TraversableOnce[_]) => s.as",494820747,2016-08-19 01:04:52
16221767,7111,75358800,106,this seems to be reverting the batching code (which I am not sure is really needed on heron or even modern storm). Why this change?,494820747,2016-08-19 01:08:29
16221767,7111,75359137,112,"you should not have `k: K, v: V` here. It will create a warning at compilation time anyway. It is better to be more explicit with our casts. In this case you really need a `Spout[(Timestamp, (K, V))]` it looks like. We should require that and move the cas",494820747,2016-08-19 01:10:14
16221767,7111,75359666,31,"Can you add a big comment on how this is used? Maybe worth factoring this into a separate class. There is a ton of mutation and casting going on here.

Also, please use `AnyRef` in scala code over `Object`. They mean the same, but `AnyRef` is standard s",494820747,2016-08-19 01:12:57
16221767,7111,75359723,33,please have a return type on all public methods. Does this need to be public?,494820747,2016-08-19 01:13:15
16221767,7111,75360217,26,"should this not be configurable? Seems a sane default, but I can imagine cases where I would want much lower latency (but still deal with super hot keys, which ""crush-down"" helps with).",494820747,2016-08-19 01:15:49
16221767,7111,75360282,28,"can this be private? I don't think it should be mutated outside this class, should it be?",494820747,2016-08-19 01:16:10
16221767,7111,75360356,58,`msgId: AnyRef`,494820747,2016-08-19 01:16:36
16221767,319889,75360792,54,Is there a pr that should be linked to with the fix in tormenta?,494820747,2016-08-19 01:19:01
16221767,7111,75361639,54,https://github.com/twitter/tormenta/pull/69,494820747,2016-08-19 01:23:27
16221767,9800529,75433392,53,This change is intended to run the emits on a single thread. We are using AsyncSummer so as to get the crushDown of tuples,494820747,2016-08-19 13:35:17
16221767,9800529,75433777,102,"We aggregate the tuples based on key's summer shard. So we aggregate the messageIds on the summer shards, so that we can emit the aggregated tuple along with the aggregate messageIds.",494820747,2016-08-19 13:38:51
16221767,9800529,75433966,107,Value object is sent as a JList during emit. I am just unwrapping the Value object so as to get the list of key and value,494820747,2016-08-19 13:41:12
16221767,9800529,75434433,21,This is the method where we call the actual emit. We intend to call the emit in a single thread. ,494820747,2016-08-19 13:45:59
16221767,9800529,75434594,47,".emit sends an object as the messageId. It is acked back by passing the same object, which should be handled on the spout.",494820747,2016-08-19 13:47:54
16221767,9800529,75434788,33,The timerFlush is being called from the spout at regular intervals.,494820747,2016-08-19 13:50:19
16221767,9800529,75530144,112,Refactored it accordingly.,494820747,2016-08-20 01:28:52
16221767,9800529,75530198,106,We are moving this logic and aggregation into the AggregateSpoutOutputCollector.,494820747,2016-08-20 01:29:16
16221767,9800529,75542372,68,"Yes, the spout is tied to the AggregateOutputCollector. The AggregateOutputCollector ties all the messageIds and sends back to the KeyValueSpout. Only KeyValueSpout can under stand that the recieve ack is a list as it tried to typecast. 
",494820747,2016-08-20 02:55:43
16221767,9800529,75542768,108,"The emit is called on by passing a tuple. Before calling the emit in the KeyValueSpout we format the tuple into a Tuple2 format. But on the parent call we have a [Any,Any]  for [K,V] just like in the FlatMapBoltProvider.",494820747,2016-08-20 02:58:24
16221767,2221968,75543977,112,"I think we can drop using the `kvinj` here.  We anyway unwrap it ourselves in `extractAndProcessElements`.  Let's just keep it as a pair, and that logic looks more like:
```scala
val kv = list.get(0).asInstanceOf[(K, V)]
```
Note that we don't really ",494820747,2016-08-20 03:07:04
16221767,7111,75568005,104,"this is:
```scala
def addToCache(tuple: (K, V), streamid: String): Future[Map[K, V]] =
  spoutCaches.getOrElseUpdate(streamid, summerBuilder.getSummer[K, V](implicitly[Semigroup[V]])
    .add(tuple)
```",496753755,2016-08-20 07:22:46
16221767,7111,75568037,121,if you use `.getOrElseUpdate` you don't need to reinsert at the end. Can we do that?,496753755,2016-08-20 07:23:44
16221767,7111,75568160,23,I can't see where we are using `storm`.,496753755,2016-08-20 07:27:21
16221767,7111,75568194,27,why is this a var?,496753755,2016-08-20 07:28:22
16221767,7111,75568272,32,"can we just have this method return `(Int, Spout[(Timestamp, Any)])` so we don't have to have the side effect of mutating the var?",496753755,2016-08-20 07:30:47
16221767,7111,75568293,94,can we wrap after the `=`?,496753755,2016-08-20 07:31:19
16221767,7111,75568349,104,"let's have apply return `(Int, Spout...)` so we don't need the mutable var.",496753755,2016-08-20 07:32:29
16221767,7111,75568503,36,"we should probably use `LongMap` for the inner map and avoid the boxing that comes with using generics. There is no `IntMap` in scala, but `LongMap` should be fine for our purporses, I think.",496753755,2016-08-20 07:35:39
16221767,7111,75568554,122,"this does not need to be a var. You are calling the `+=` method on a mutable type, the reference itself never changes.",496753755,2016-08-20 07:37:05
16221767,2221968,75768441,71,Move this closer to getSpout,498337113,2016-08-23 05:07:53
16221767,2221968,75768448,26,"The parallelism (`Int`) and `Spout` aren't really entangled and shouldn't be constructed by a single method.  We can have:
```scala
def spoutParallelism: Int =...
def tormentaSpout: Spout[(Timestamp, Any)] = ...
```
(I'm not sure `computerSpout` is a",498337113,2016-08-23 05:07:59
16221767,9800529,75771498,36,There is no mutable version of the LongMap in scala 2.10.5,496753755,2016-08-23 05:32:05
16221767,9800529,75917597,71,"Yes, have moved it nearer to the caller.",498337113,2016-08-24 00:52:36
16221767,7111,75931656,33,"you don't need `{ }` on single expression functions. If you really want to add it, the `{` should start on the previous line and the `}` should end on a line by itself.",498403342,2016-08-24 02:10:41
16221767,7111,75931704,39,`{ }` not needed.,498403342,2016-08-24 02:10:53
16221767,7111,75931862,38,`fn()` is used for functions with side effects. This should just be: `def extractSourceAttributes: (..` ,498403342,2016-08-24 02:12:02
16221767,7111,75931954,46,why is this cast needed? Does not look like it is.,498403342,2016-08-24 02:12:39
16221767,7111,75932151,119,"let's remove `(k: K, v: V)` and use `(k, v)`. In a case statement, `:K` means match on type, which is not possible when `K` is generic, so can lead to warnings.",498403342,2016-08-24 02:13:56
16221767,7111,75932336,131,"```scala
private def getStormSpout[T](spout: Spout[T], register: Externalizer[(TopologyContext) => Unit]): IRichSpout =
  spout.openHook(register.get).getSpout
```
would be a bit cleaner",498403342,2016-08-24 02:15:06
16221767,7111,75932509,43,can we maybe call this `computeSpout`? `computerSpout` seems weird.,498403342,2016-08-24 02:16:14
16221767,7111,75932849,43,"I *think* `def computeSpout[T](spout: Spout[(Timestamp, T)]): Spout[(Timestamp, T)]` will work here. Can we try that?",498403342,2016-08-24 02:18:32
16221767,7111,75933427,188,"can we move the cast here:
```scala
case Some(summerNode) =>
  // since we know that the the next node is a summer, this implies the type of the spout must be `(K, V)` for some `K, V`
  val kvSpout = tormentaSpout.asInstanceOf[Spout[(Timestamp, (Any, ",498403342,2016-08-24 02:22:10
16221767,7111,75933765,15,can we call this `def get`?,498403342,2016-08-24 02:24:20
16221767,7111,75933808,8,what is this used for? Seems like a local only counter. What is the use case?,498403342,2016-08-24 02:24:41
16221767,7111,75933842,15,please put a return type on all public methods.,498403342,2016-08-24 02:24:55
16221767,7111,75933888,8,"I see, this is a test class. No problem.",498403342,2016-08-24 02:25:13
16221767,550921,75940799,22,Specifying return type here seems important. I would suggest erring on the side of verbosity and specify return type for all methods.,498403342,2016-08-24 03:08:07
16221767,550921,75941011,27,Specify type of metrics.,498403342,2016-08-24 03:09:24
16221767,550921,75942197,32,"The function name should be a verb, ",498403342,2016-08-24 03:16:27
16221767,550921,75942646,55,may be call it validateParallelisms? Not too strong about this.,498403342,2016-08-24 03:18:55
16221767,550921,75943273,86,"otherwise -> _
""case _"" is meant for exactly this.",498403342,2016-08-24 03:22:29
16221767,550921,75944022,11,"Can we name ""expected"" more descriptively? We can put whatever this MSet represents into the name, it's not obvious from the types that it represents.",498403342,2016-08-24 03:26:54
16221767,550921,75944158,15,It doesn't look like this function is checking anything. ,498403342,2016-08-24 03:27:39
16221767,550921,75944422,41,Returning null is not a good practice. We should return an empty list.,498403342,2016-08-24 03:29:11
16221767,7111,75944768,86,we are capturing `otherwise` to print it.,498403342,2016-08-24 03:31:26
16221767,550921,75945857,69,"TraversableSpout will be a bit simpler:
https://github.com/twitter/tormenta/blob/develop/tormenta-core/src/main/scala/com/twitter/tormenta/spout/TraversableSpout.scala#L29",498403342,2016-08-24 03:37:58
16221767,550921,75946743,32,Rename flushFrequency to specify units since type doesn't have that info.,498403342,2016-08-24 03:43:29
16221767,550921,75947652,133,"This may be flaky, flush frequency is 1 second and you're waiting for exactly that amount of time. You would want to sleep more than flushFrequency. Best would be to avoid sleeping altogether by controlling time, but if that takes too long to implement or",498403342,2016-08-24 03:48:39
16221767,550921,75947818,139,Can we name this better?,498403342,2016-08-24 03:49:28
16221767,9800529,75960123,32,I have made it to accept a Duration. I am passing the duration in the caller now.,498403342,2016-08-24 05:02:58
16221767,9800529,75960263,133,I have made the flushFrequency as 1000 millis and waiting for 1200 millis. This should work.,498403342,2016-08-24 05:03:49
16221767,9800529,75960368,69,"I just wanted the simplicity in calling the nextTuple. Also I was testing on TraversableSpout, so I wanted to try BaseSpout.",498403342,2016-08-24 05:04:42
16221767,9800529,75960485,11,These are the expectedTuplesToBeSent if everything works fine. This expected is to validate the tuples being sent. I will change the name to make it more descriptive.,498403342,2016-08-24 05:05:26
16221767,9800529,75960536,32,It was a spelling mistake.. thanks for pointing it out.,498403342,2016-08-24 05:05:49
16221767,9800529,75960669,15,"Yes, this is a test class. I took it from the tormenta repo.",498403342,2016-08-24 05:06:54
16221767,9800529,75961911,46,"When you apply some .map or .flatMap which typecasts from Any to something else. I think it is to make sure it is typecasted back to Any. 
I have not changed this function. It was in scheduleSpout.",498403342,2016-08-24 05:15:50
16221767,550921,76167194,69,I'm not too strong about this but could you say more about why you feel TraversableSpout will be less simple.,498403342,2016-08-25 08:17:22
16221767,550921,76167227,86,"Ah... can we rename it to ""unexpectedType""",498403342,2016-08-25 08:17:50
16221767,550921,76167414,22,"long line, split.",499033447,2016-08-25 08:20:38
16221767,550921,76167448,29,unnecessary braces.,499033447,2016-08-25 08:21:03
16221767,550921,76167658,60,"long line, split.",499033447,2016-08-25 08:24:00
16221767,550921,76167761,85,"nit: move getStormSpout(formattedSummerSpout, fn) to a separate temporary variable to reduce line length.",499033447,2016-08-25 08:25:27
16221767,550921,76168006,90,specify return type.,499033447,2016-08-25 08:28:47
16221767,550921,76168042,91,"Why do we need to do ""with Incrementor"" here. Also, extra braces. ",499033447,2016-08-25 08:29:25
16221767,550921,76168366,91,"nvm, this is a different Counter class than the one you defined. So you're mixing functionality here. This is ok.",499033447,2016-08-25 08:34:27
16221767,550921,76168715,40,remove extra line.,499033447,2016-08-25 08:39:21
16221767,550921,76169038,62,nit: Can be moved to line above.,499033447,2016-08-25 08:44:13
16221767,550921,76169044,57,The use of word cache is overloaded in this class. Elsewhere it's used for AsyncSummer. Can we rename this?,499033447,2016-08-25 08:44:18
16221767,550921,76272094,59,"I see that Await.result is still here. Wouldn't this mean that AsyncSummer implementations that are actually async won't work, since we always wait immediately on all the futures they return.

I think we need to keep a queue of futures and regularly cle",499033447,2016-08-25 22:59:02
16221767,2221968,76307311,59,"The `BaseBolt` approach is a possible improvement.  It would involve periodically (etc.) checking a `Future` queue, removing any which are complete, and emitting those results onto the next `SpoutOutputCollector`.

But I don't see why the `AsyncSummer` ",499033447,2016-08-26 02:16:23
16221767,550921,76308142,59,"It's not the programmatic contract, but the expected way in which it should be used. Similar to the contract that one should not block finagle threads. In this case it would continue to work but with degraded performance. The sync implementations of Async",499033447,2016-08-26 02:21:46
16221767,550921,76309085,59,One temporary workaround could be to fix the AsyncSummer implementation to SyncSummingQueue and not allow that to be customized.,499033447,2016-08-26 02:28:11
16221767,2221968,76310696,59,"The performance might be sub-optimal but I wouldn't say it's a blocker for now.

I'm not sure why joining with a service would (also?) not work, but it doesn't seem related.",499033447,2016-08-26 02:38:45
16221767,550921,76311841,59,"I think it's ok for now if we fix the AsyncSummer implementation that's used. Options flow backward in summingbird topologies, if someone specified an async AsyncSummer for a flatMap and not explicitly supplied a sync one for the spout then they'll end up",499033447,2016-08-26 02:46:04
16221767,2221968,76319240,59,I'd rather not release a version where we don't let the user configure the spout summer; I think the minor cost incurred by waiting inline is worth having a consistent story here.  I'm in favor of merging this part as-is.,499033447,2016-08-26 03:33:30
16221767,550921,76322526,59,"I haven't seen users configure AsyncSummer implementation much at all. I've seen only one job so far that specifies AsyncSummer implementation explicitly. The other case is Async flag in tsar, which would work bad in this case. There are very few sync imp",499033447,2016-08-26 03:54:25
16221767,2221968,76328812,22,"Here and elsewhere, methods are taking `Dag[Storm]` and `StormNode` parameters that will never be anything other than just `stormDag` and `node`.  Let's just use those directly instead of taking the arguments?",499033447,2016-08-26 04:32:06
16221767,2221968,77037289,68,"This shouldn't be called `node` since you already have a `node` in scope.  Actually this already caused me to have you introduce a subtle bug by removing the `StormNode` param in `getOrElse`.

I would:

1. change this to `summerNode`
1. change this t",503018402,2016-09-01 00:50:00
16221767,2221968,77040118,117,IMO just retrieve this from `getCountersForJob` directly,503018402,2016-09-01 01:03:07
16221767,2221968,77040240,94,IMO just get `register` directly from `createRegistrationFunction`,503018402,2016-09-01 01:03:45
16221767,2221968,77040783,13,Is this an IDE change?  Leave this just as _,503018402,2016-09-01 01:06:47
16221767,2221968,77041127,4,"With the `SpoutProvider` refactoring, you can probably clean up the imports here quite a bit.  At the very least, drop any of the changes which aren't actually needed.",503018402,2016-09-01 01:08:24
16221767,2221968,77042632,79,"This should be like:
```scala
(messageIds, stream.isEmpty) match {
  case (None, true) => in.emit(list)
  case (None, false) => in.emit(stream, list)
  case (Some(ids), true) => in.emit(list, ids)
  case (Some(ids), false) => in.emit(stream, list, i",503018402,2016-09-01 01:16:10
16221767,9800529,77048908,68,"When you ask for a SummerParallelism, though the node is a flatMapNode .. it gets the parallelism from the nearest summer via named Options stack.",503018402,2016-09-01 01:47:44
16221767,2221968,77051877,68,Doesn't it prefer a SummerParallelism if it's set on the FlatMapProducer?,503018402,2016-09-01 02:03:04
16221767,9800529,77060915,68,"Yes, it would. If you believe that the users set summerParallelism for flatMapNode, then it is better to include the node while getting the options.",503018402,2016-09-01 02:55:05
16221767,9800529,77075065,59,We have tried SyncSummingQueue and AsyncListSum in the SourceNode. We have observed that the throughput with AsyncListSum is more than the throughput with SyncSummingQueue. So we are proceeding with the taking the summer mentioned on the named options rat,499033447,2016-09-01 04:16:05
16221767,9800529,75961631,43,"Option map/ FlatMap may change the type 'T' to anything else. We have to cast it to Spout[(Timestamp, Any)] on foldLeft to make sure no typecasting happens on the .map or .flatMap
I have not changed this function. ",498403342,2016-08-24 05:13:55
16343505,2221968,75223291,11,"It's probably worth calling out that Dag objects aren't (typically) constructed directly, but rather through the companion object helpers, which also generate (long) names for each Node.",494937622,2016-08-18 06:01:10
16343505,550921,75224844,11,"Good idea, added that.",494937622,2016-08-18 06:14:34
16343505,9800529,75254111,24,"Can you clarify the ""Names flow backwards, from source to tail"" - Actually I think that a Source inherits the name from the Tail",495606064,2016-08-18 13:25:57
16343505,9800529,75254508,35,"Instead of ""whats"" you can give declarative descriptions like - ""Its a mapping of a node to its immediate dependents""",495606064,2016-08-18 13:31:07
16343505,9800529,75254855,31,"Can you remove ""this is that mapping"" and reframe it",495606064,2016-08-18 13:35:31
16343505,550921,75342690,24,"You're right I got it reversed, fixed.",495606064,2016-08-18 23:35:21
16343505,550921,75342760,35,"Sure, done.",495606064,2016-08-18 23:35:42
16343505,550921,75342796,31,Done,495606064,2016-08-18 23:35:54
16343505,9800529,75344052,6,Can you also call out that the nearest name takes the priority.,496035083,2016-08-18 23:43:43
16343505,9800529,75344127,12,All nodes of the DAG,496035083,2016-08-18 23:44:09
16343505,9800529,75344266,15,"""This is that mapping"" - can you remove it and rephrase.",496035083,2016-08-18 23:45:01
16343505,550921,75344597,6,"Good idea, done.",496035083,2016-08-18 23:46:58
16343505,550921,75344698,15,Done,496035083,2016-08-18 23:47:28
16343505,9800529,75344927,21,"""Nodes this node immediately depends on"" - rephrase",496035083,2016-08-18 23:48:57
16746842,7111,77718339,63,can we comment the type parameters?,505391046,2016-09-07 04:02:12
16746842,7111,77718544,69,can this just be a regular `private`?,505391046,2016-09-07 04:03:28
16746842,7111,77719568,77,"what about using `fut.transform { t => reponses.put((state, t)); Future.const(t) }` instead of `onSuccess` and `onFailure`?",505391046,2016-09-07 04:08:56
16746842,7111,77720006,74,"what about:
```scala
val addedSize = iter.map { case (state, fut) =>
  val responded = ...
  if (addOutstandingFuture(responded)) 1 else 0
}.sum 
```",505391046,2016-09-07 04:11:22
16746842,7111,77720212,74,"or, if we care about perf:
```scala
var addedSize = 0
iter.foreach { case (state, fut) =>
  ...
  if ( ) addedSize += 1
}
```",505391046,2016-09-07 04:12:39
16746842,7111,77720438,100,can we use `transform` here as well. Not so crazy about the `.onSuccess` `onFailure` while we are making changes.,505391046,2016-09-07 04:13:49
16746842,7111,77722256,73,"I'm not sure we should have this method. Why not:
```scala
def add(s: S, v: Future[T]): Boolean =
```
then when we need to call `addAll` instead do: `val addedSize = iter.count { case (s, fut) => add(s, fut) }` and optionally log there?",505391046,2016-09-07 04:30:50
16746842,550921,77723011,63,Can you also add a doc comment describing what the semantics are?,505391046,2016-09-07 04:35:34
16746842,2221968,77724422,69,"Tests are currently inspecting this.  It might make sense to modify/eliminate that test (I've broken it for now anyway, I think).  Otherwise it can be private.",505391046,2016-09-07 04:44:11
16746842,2221968,77724592,77,"I can use `Future#respond`, but it won't be quite as clean as that because we're also converting between Twitter & Scala `Try`.",505391046,2016-09-07 04:45:21
16746842,550921,77729035,99,"Can you document the state contract here? Looks like ""state"" is only used for putting into failure response. Looking at FutureQueue as a standalone abstraction what is the reasoning behind such a design. ",505391046,2016-09-07 05:16:18
16746842,7111,77931863,42,"I've seen this written like 100 times. I finally got it into util, but we might not want to upgrade the dependency just to get it (we are having some GC regressions in some of the latest finagles).",505391046,2016-09-08 08:03:28
16746842,2221968,78268313,42,Looks like we already pick up bijection-util so I can just use what we have in `UtilBijections`.,505391046,2016-09-10 08:30:22
16746842,7111,78285163,131,"just a question, can't this be `Iterable[(S, Try[T])]`? `.take` returns something iterable, right? This seems to limit the caller to only go through it once, but in fact, we materialize it into memory already.",510040422,2016-09-11 05:50:34
16746842,7111,78285192,165,can we make this `forceExtraFutures(): Unit = {` I think that is the preferred scala style now.,510040422,2016-09-11 05:52:34
16746842,7111,78285201,196,"can we return `Iterable[(S, Try[T])]` here?",510040422,2016-09-11 05:53:02
16746842,7111,78285262,200,"can we not take `maxEmitPerExec` as a class param and instead take it as a method arg here:

```scala
def dequeue(max: Int): Iterable[(S, Try[T])] = ...
```
This simplifies the state of the class and allows the caller to have better control (no need ",510040422,2016-09-11 05:58:26
16746842,7111,78285311,86,can we remove this param and pass it to `dequeue`?,510040422,2016-09-11 06:00:59
16746842,7111,78285379,147,"this seems like a really weird method. I think in the original, with `S = Seq[S1]` then what you actually have is `state` is the union of all states, where each part is separate in `TraversableOnce`.

So, really, I think you have something like, there i",510040422,2016-09-11 06:06:40
16746842,7111,78285394,73,"actually, it looks like `Seq[S]` is really an Option, is that right? Can we simplify this?",510040422,2016-09-11 06:07:50
16746842,7111,78285471,73,"actually, only the first `Seq[S]` is an option, so that breaks the uniformity of the typing in FutureQueue.

I wonder if `addAllFuture` is so specialized, it should stay in this class. I don't see how any user can use it generally without a big coincide",510040422,2016-09-11 06:18:40
16746842,550921,78308154,103,The meaning of false return value seems confusing. Why would caller of add care whether that future counts towards maxWaitingFutures limit or not; because of asynchronous execution user doesn't have control over how futures finish and thus can't do anythi,510040422,2016-09-12 08:46:04
16746842,2221968,78412578,131,Yeah I guess `Queue` is set to return `Seq`; seems reasonable to do the same here.,510040422,2016-09-13 00:07:39
16746842,2221968,78412806,73,"Sure, I like that approach too.",510040422,2016-09-13 00:09:12
16746842,2221968,78413127,103,"Fair point.  I was anyway a little worried that folks would confuse this with ""item was queued or not"" semantics.  Making this a `Unit` method simplifies that; I'll make this a private internal method and making a public wrapper for it.",510040422,2016-09-13 00:11:05
16746842,2221968,78421495,73,"On review, the main thing we lose is the presence of the outer `Future` on the queue (as something counting against the max that we can wait on, etc.).  Maybe this is a reasonable tradeoff though.",510040422,2016-09-13 00:55:26
16887919,2221968,77930408,22,Inconsistency between `_` and `()`,508698594,2016-09-08 07:45:24
16887919,7111,77930750,22,what do you mean? There mean different things. `_: Semigroup[V]` is being ignored here.,508698594,2016-09-08 07:49:42
16887919,2221968,77930836,22,"Ah, of course",508698594,2016-09-08 07:50:53
16887919,2221968,77931278,32,`fromOnlineOnlyWithSemigroup(_ => store)` ?,508698594,2016-09-08 07:56:13
16887919,7111,77931447,32,good call.,508698594,2016-09-08 07:58:25
16887919,550921,77940678,42,At this point it seems like this method should be named like a function and not a property. Earlier it was in the spirit of  lazily created mergeable store so the name was ok. Should we call it createMergeableStore?,508707093,2016-09-08 10:22:20
16887919,7111,78047590,42,"Well, I'm a little nervous about that because it lead to a lot of serialization problems before (which is why we did this). Calling a method is still lazy, so `def mergeableStore = store` would have been lazy, but still we got burned enough to add this ex",508707093,2016-09-09 00:05:36
16887919,550921,78095980,42,"I didn't mean to suggest we change the structure, just the name. MergeableStoreFactory.mergeableStore reads like a property which would provide a mergeable store but it is a function that takes an input to provide a mergeable store. 

e.g. when I read f",508707093,2016-09-09 04:51:03
17724059,7111,82918507,49,what about `.iterator.map` so we don't rebuild the `Map` after `groupBy` and `map` but only go through it once in the end?,528743676,2016-10-12 07:44:42
17724059,7111,82917614,135,"for performance:
```scala
val buffer = messageId match {
  case Some(id) => List(id)
  case None => Nil
}
```
is better than allocating the closures needed to do `.map` and `.getOrElse` if we are in a tight loop.",528743676,2016-10-12 07:35:11
17724059,7111,82916645,50,"`case f: Foo` is a pattern match on type. Can we remove the types to be clear we are not doing that? If you want to annotate, you can do in the next line, or do:
```scala
.map { tup: (AggKey, Map[...]) =>
  val (index, m) = tup
```
",528743676,2016-10-12 07:24:56
17724059,7111,82917758,137,"Seq semigroup may not be that great. Without using `sumOption` it is `O(N^2)` to aggregate.

Have you looked at `Batched`: https://github.com/twitter/algebird/blob/develop/algebird-core/src/main/scala/com/twitter/algebird/Batched.scala that deals with t",528743676,2016-10-12 07:36:42
17724059,7111,84185874,56,still think this should be `.iterator.map` to avoid an extra in-memory generation.,537675033,2016-10-20 06:02:50
17724059,2221968,84190891,56,"Ah, sure.  It seems I missed your earlier comment about type labels so I've changed that as well.",537675033,2016-10-20 06:49:14
17932710,7111,83527093,10,Let's avoid deprecated procedure syntax and below.,534795549,2016-10-15 13:53:52
17932710,7111,83527087,32,Can we avoid procedure syntax here? `(): Unit = lockedOp.get.close` will do.,534795549,2016-10-15 13:53:22
17932710,134219,83527278,10,Done,534795549,2016-10-15 14:10:49
18731841,7111,87526669,32,please use `AnyRef` not `scala.Any` in this case. `AnyRef` is the correct corresponding type to `java.lang.Object`.,553930846,2016-11-11 10:12:23
18731841,7111,87526754,65,oh no! Why do we still need to sleep?,553930846,2016-11-11 10:13:35
18731841,7111,87526715,49,so awesome to remove these. Can you confirm there are no more `.sleep`?,553930846,2016-11-11 10:13:07
19647220,7111,91880538,73,Good gracious.,574443574,2016-12-12 12:02:20
19821887,7111,93387203,15,why not `doCompat` rather than unwrapping and re-wrapping? Same below?,580057141,2016-12-21 15:31:38
19821887,550921,93387936,15,AsyncListSum takes Compact as parameter. AsyncListSum is defined in Algebird so can't change it's signature here.,580057141,2016-12-21 15:38:54
19821887,7111,93675910,15,"I see, I overlooked that they are different types.",580057141,2016-12-23 02:44:17
19821887,7111,93676750,4,"you can't add vals to a trait without breaking binary compatibility. This trips MIMA.

Can you move this to the style of:
```
case class CompactValues(toBoolean: Boolean)
object CompactValues {
  def default: CompactValues(false)
}
```

to avoid",580057141,2016-12-23 02:48:56
19821887,550921,93678044,4,Sure. Done.,580057141,2016-12-23 02:57:21
19925378,7111,94516989,27,shouldn't we move this line to 158 (only materialize the `List` if we have dependants and we anchor?,589847954,2017-01-04 09:19:56
19925378,550921,94518774,27,"My reasoning was that we need to iterate through the chain anyway to get the size for the log statement at the end of function but I agree, materialization of list should be avoided as well in those cases. Proposed a fix.",589847954,2017-01-04 09:41:50
19925378,7111,94518938,11,"list `.size` is `O(N)` not `O(1)`. So if we are going to do this, why use the var and not just use use `inputs.iterator.size`.",590467792,2017-01-04 09:43:57
19925378,7111,94518993,10,"don't we want this above the foreach? We don't want to recompute `tuples` for each result. We just want it once and then reuse for all results, no?",590467792,2017-01-04 09:44:47
19925378,550921,94519353,11,Good point. We should be able to calculate the size and list in one pass though. Let me try.,590467792,2017-01-04 09:49:59
19925378,550921,94519452,10,"Yeah, good idea. I believe this was how it was in original code too so I didn't notice. Let me try to fix this.",590467792,2017-01-04 09:51:27
20381217,6636815,95924648,11,"timeV1alueSemigroup, rename to timeV1Semigroup? ",596462050,2017-01-13 09:49:14
20381217,550921,95944128,11,"timeValueSemigroup seems ok, the 1 got introduced by search replace I suspect.",596462050,2017-01-13 14:34:02
21450514,7111,101639552,24,can we put a type on the result here? `Interval[Timestamp]`,619538004,2017-02-17 06:09:59
21450514,6636815,101641315,24,sure,619538004,2017-02-17 06:19:02
21450514,134219,101642511,8,nit: I think it should be with spaces (I think it's where your IDEA style settings going against our scalafmt setup).,619547699,2017-02-17 06:24:54
21450514,6636815,101643766,8,yeah seems like the Twitter defaults are set to not include the space :-). ,619547699,2017-02-17 06:30:55
21981324,134219,104279729,49,"Can we keep old way to iterate, maybe with additional check on the `end == Long.MAX_VALUE`? I think it makes code simpler.",637047171,2017-03-04 13:08:22
21981324,134219,104279874,5,"Does this defense make sense? I think it makes code a little bit more noisy, while don't add value in most cases (if duration != 1ms).",637047171,2017-03-04 13:17:58
21981324,550921,104282315,49,"+1. How about:

    if (end < start) Nil
    else {
      new Iterable[BatchID] {
        def iterator = iterate(start)(_.next).takeWhile(_ < end) ++ Iterator.single(end)
      }
    }
",637047171,2017-03-04 15:35:49
21981324,7111,104528061,49,"I'll do @pankajroark 's approach.

I like keeping this knowledge in the Successible instance which is designed to exactly handle this task.

I don't like that `.next` may wrap around and think that API may have been a mistake at this point, and Succes",637047171,2017-03-07 05:31:59
21981324,7111,104529480,5,"So, the code is actually wrong if we don't do it. `b.next` will not be bigger than `b` if `b.id == Long.MaxValue`. And I don't want to have it be silently wrong.

If you prefer we can throw an error, I guess, which I don't like either.

Honestly, `ear",637047171,2017-03-07 05:38:14
21981324,134219,104726587,5,"Can we use `batchIdSuccessible.next(b)` then?
If `earliestTimeOf` will return an `Option` it would be possible to `map` `next` with `earliestTimeOf` to make this function correct.",637047171,2017-03-08 01:24:29
21981324,7111,104740346,5,"I'm not exactly sure what you are proposing here. We could write this code with a match:
```scala
batchIdSuccessible.next(b) match {
  case Some(bnext) => // can do left closed right open
  case None => // can't call next, so can only do inclusive
}",637047171,2017-03-08 02:22:47
21981324,134219,104740817,5,"Yes, I meant usage of `flatMap` in future, for now I'm ok with `match` and inclusive/exclusive intervals return.  ",637047171,2017-03-08 02:24:46
22124876,7111,104984868,5,would be nice to remove `{ }`.,640449909,2017-03-09 02:18:49
24379484,7111,116045293,35,this is an old scala. `2.11.11`.,690458503,2017-05-12 00:01:10
24883293,7111,118805388,22,shouldn't this be empty if we have an exclusive range?,701046114,2017-05-27 06:37:16
24883293,7111,118805394,12,why this change?,701046114,2017-05-27 06:37:21
24883293,134219,118806807,12,`input` became an empty sequence in process of debugging. I'm not sure what caused this but looks like it was because something was traversable only once. I've changed this signatures and it helped. I can revert that if you want.,701046114,2017-05-27 06:59:08
24883293,134219,118806997,22,"I also don't like this change. Issue is - if `input` contains zero elements we pass `minTime ==  maxTime == 0` here, have empty interval as a result, which fails after. Alternative fixes are either pass `Math.max(maxTime, 1)` (require change of all callsi",701046114,2017-05-27 07:02:10
24883293,134219,119160447,22,Changed to `coveringTimeInterval` with more clear contract.,701046114,2017-05-31 00:14:24
24883293,134219,119160507,12,Reverted to `TraversableOnce`.,701046114,2017-05-31 00:14:39
24883293,7111,119176118,10,this is nicer.,703513624,2017-05-31 01:17:48
24883293,7111,119679316,5,"code *may* be assuming this interval is left closed right open.

Maybe it is better to check if `max ==BatchID(Long.MaxValue)` and only in that case do the InclusiveUpper?",704775533,2017-06-02 00:30:34
24883293,134219,119695620,5,"Looks like some other tests started to fail with this fix, which mean we have code which *assumes* interval is left closed right open. Fix you proposed seems reasonable for me (especially for real world).",704775533,2017-06-02 01:36:46
25087245,6636815,126755072,55,should we delete these commented lines?,734233799,2017-07-12 00:25:16
25087245,7111,127100814,28,can we roll back to `0.17.0` here or wait for `0.17.2` due to the recently discovered semver issue with `0.17.1` cc @piyushnarang ,735740879,2017-07-13 06:55:09
25087245,7111,127100926,55,"no, we need to uncomment after each version bump. Deleting seems like a good way to keep making mima mistakes like the scalding one.",734233799,2017-07-13 06:56:05
25087245,134219,127102650,28,`0.17.0` breaks SB tests so we can't roll back. I'm going to publish `0.17.2` today.,735740879,2017-07-13 07:11:07
25087245,134219,128850041,28,Done,735740879,2017-07-22 03:03:46
25136788,550921,120665415,107,"Can we create a helper method to simplify this code for readability:
testStormEqualToMemory(new ProducerCreator { def apply = fn })
to
testStormEqualToMemory(fn)",706661476,2017-06-07 22:48:19
25136788,550921,120663312,80,"Can you make this comment more clear, I'm not sure what it means in this context.",706661476,2017-06-07 22:41:23
25136788,550921,120664365,442,When do we plan to remove these commented blocks.,706661476,2017-06-07 22:44:57
25136788,550921,120663820,155,Comment that this is not thread safe.,706661476,2017-06-07 22:43:07
25136788,550921,120662616,40,remove,706661476,2017-06-07 22:38:59
25136788,7111,120715225,442,"I think we should make issues about this and see if they should be gone, or if we can find a way to make them pass. I haven't looked at them much. They may be assuming a stronger contract than actually exists.",706661476,2017-06-08 01:55:41
25136788,134219,120716942,442,"I've mentioned issue in code above (https://github.com/twitter/summingbird/issues/725), and it would be fixed soon when I'll land all my PRs. ",706661476,2017-06-08 02:03:01
25136788,134219,120717153,107,"I don't know how to do this because this method has type parameter. I changed impl thou, so now it looks even better.",706661476,2017-06-08 02:04:07
25136788,134219,120717169,80,Done,706661476,2017-06-08 02:04:14
25136788,134219,120717789,40,Done,706661476,2017-06-08 02:06:57
25136788,134219,120717807,155,Done,706661476,2017-06-08 02:07:04
25136788,550921,120769418,442,"In that case, IMO, we can just leave a note with the commented code for now.",706661476,2017-06-08 06:27:52
25136788,550921,120769019,23,"Can you comment here why ordering is needed for the Test Platform? As I understand it is because one of the other platforms requires it and without this we won't be able to transform. It's not very obvious though, so a comment would be useful.",709634900,2017-06-08 06:24:41
25136788,134219,120773797,23,Removed `Ordering`. You are right - it's needed because concurrent platforms break ordering of elements. Add a comment where we check sinks content. ,709634900,2017-06-08 07:04:48
25136788,550921,120774596,5,nit: This is also -> This also,709794784,2017-06-08 07:12:05
25136788,134219,120775041,5,"Ha, fixed",709794784,2017-06-08 07:16:14
25167000,550921,120147545,30,"Add docs for all the params, I know existing code doesn't have any, but it's a good time to add them. What does the string represent. Why are there multiple incoming edges but only one outgoing edge?",707518781,2017-06-05 23:22:33
25167000,550921,120148062,75,Doc comment.,707518781,2017-06-05 23:25:01
25167000,550921,120144396,13,Doc comments for trait and every public field and method.,707518781,2017-06-05 23:09:07
25167000,7111,120184407,21,"can we put this in a separate file: `EdgeGrouping.scala`?

And can we use the style to put inner classes to not clutter the name space:
```scala
object EdgeGrouping {
  case object Shuffle extends EdgeGrouping
  case object LocalOrShuffle extends Ed",707518781,2017-06-06 02:03:05
25167000,7111,120185599,53,just `forItem[T]: Injection...` no `()`,707518781,2017-06-06 02:08:03
25167000,7111,120184600,35,"similarly, can we put instances of `Edge` in the object:
```scala
object Edge {
  case class Item[T]...
  case class AggregatedKeyValues[K, V]...
}
```",707518781,2017-06-06 02:04:00
25167000,7111,120185264,85,"scala style is to use unary methods `foo():` when there is a side effect. These don't have that so you should do:
```scala
def inputEdges[Input]: Map[String, Edge[Input]] =
```",707518781,2017-06-06 02:06:57
25167000,7111,120185517,65,"just `def forKeyValue[K, V]: Injection...`",707518781,2017-06-06 02:07:46
25167000,134219,120206301,21,"Done, looks way better!",707518781,2017-06-06 03:50:56
25167000,134219,120206331,53,Done,707518781,2017-06-06 03:51:03
25167000,134219,120206317,35,Done,707518781,2017-06-06 03:51:00
25167000,134219,120206358,65,Done,707518781,2017-06-06 03:51:09
25167000,134219,120206372,85,Done,707518781,2017-06-06 03:51:14
25167000,134219,120249592,13,Done,707518781,2017-06-06 08:48:08
25167000,134219,120249587,30,Done,707518781,2017-06-06 08:48:05
25167000,134219,120249584,75,Done,707518781,2017-06-06 08:48:03
25167000,7111,120261819,75,"can you comment why it odes not matter what the output grouping is?
",708162016,2017-06-06 11:10:20
25167000,7111,120261939,85,"seems like this should be passed in on construction from the nodes it depends on. Is that something we will get to? A win, seems to me, would be we share the same `Edge` instances between the output at one level and then input at the next, and it could re",708162016,2017-06-06 11:11:56
25167000,7111,120261999,82,can you comment why?,708162016,2017-06-06 11:12:38
25167000,134219,120264496,75,"It explained in declaration site, but what is more important - I expect that to change in subsequent review.",708162016,2017-06-06 11:47:38
25167000,134219,120264503,82,Same as above.,708162016,2017-06-06 11:47:44
25167000,134219,120264643,85,"Yes, I want to make this logic in a way you said - use same `Edge` instances for input and output with double check on edges compatibility at topology construction time (that's why I left `shardsCount` for example in grouping declaration).",708162016,2017-06-06 11:49:40
25167000,550921,120670339,73,nit: Why key expanded and not value? Better to be consistent.,708162016,2017-06-07 23:05:13
25167000,550921,120668577,35,"Can we add: ""Used for rate limiting.""",708162016,2017-06-07 22:58:45
25167000,550921,120668893,37,We should document this design somewhere. The package object is a common place for documenting the desing.,708162016,2017-06-07 22:59:52
25167000,550921,120671052,10,Can you comment what this does? Like what do the implementors of this trait need to do to confirm with the protocol.,708162016,2017-06-07 23:08:07
25167000,550921,120669083,30,"Thanks, the comment looks very useful.",707518781,2017-06-07 23:00:34
25167000,134219,120726841,35,Done,708162016,2017-06-08 02:47:58
25167000,134219,120726979,37,"Let's keep it until subsequent refactoring, there will be clearer place for this later.",708162016,2017-06-08 02:48:40
25167000,134219,120744187,10,Added,708162016,2017-06-08 04:03:53
25285200,550921,120933345,55,remove extra line,709921165,2017-06-08 23:16:39
25285200,550921,120932676,18,Doc comment.,709921165,2017-06-08 23:13:42
25285200,550921,120933752,83,I think we use opt as the prefix everywhere else so may be use that here as val. i.e optVWithTS and optV.,709921165,2017-06-08 23:18:31
25285200,134219,120959393,18,Done,709921165,2017-06-09 01:08:42
25285200,134219,120960746,55,Done,709921165,2017-06-09 01:14:37
25285200,134219,120960754,83,Done,709921165,2017-06-09 01:14:39
25316203,550921,121032438,123,Doc comments here and throughout.,710638324,2017-06-09 08:19:30
25316203,550921,121030984,17,sgtm,710638324,2017-06-09 08:01:25
25316203,550921,121031739,55,outcoming -> outgoing,710638324,2017-06-09 08:10:34
25316203,550921,121031413,39,"may be refactor ""anotherEdge.source == edge.source && anotherEdge.dest == edge.dest"" into a function.",710638324,2017-06-09 08:06:42
25316203,550921,121031570,42,"I thought about edge :: edges but performance doesn't matter here and keeping the order may be a good idea, so lgtm.",710638324,2017-06-09 08:08:38
25316203,401065,121011081,8,How about `SMap` instead of `CMap`. Or even `ScalaMap`,710563450,2017-06-09 05:10:23
25316203,401065,121035690,50,Where does this `T` come from? Do we need to lose it when creating the `Topology`?,710563450,2017-06-09 08:59:10
25316203,401065,121013868,106,"Add comments to the types in here. You are probably expecting someone to know how these things should fit together by looking at an existing platform, but I think it'd be nice to make your assumptions as clear as possible.",710563450,2017-06-09 05:29:11
25316203,401065,121013403,17,Mark as TODO or get rid of this,710563450,2017-06-09 05:26:16
25316203,134219,121059008,17,Done,710638324,2017-06-09 13:50:27
25316203,134219,121059081,39,I don't think it worth it.,710638324,2017-06-09 13:50:59
25316203,134219,121059166,42,"Yes, I think it's better to leave it as is, I changed to :+ thou.",710638324,2017-06-09 13:51:50
25316203,134219,121060294,55,Done,710638324,2017-06-09 14:00:53
25316203,134219,121060555,123,"I shrinked access for all new classes - to `private[summingbird]` for things which used outside and to `private[builder]` for all other things.

I added comments to most places in `Topology.scala` but not for everything, do you think we should add exten",710638324,2017-06-09 14:02:56
25316203,134219,121060630,8,"We use `CMap` in other places in SB. I don't know why and I like `ScalaMap` more, but I guess it makes sense to leave it as is for now. ",710563450,2017-06-09 14:03:38
25316203,134219,121060656,17,Done,710563450,2017-06-09 14:03:46
25316203,134219,121060790,50,I'm not sure I understand the question. If you ask should we use `ClassTag`s then I think we should but it's not simple because we don't keep this information for now in `Producer`.,710563450,2017-06-09 14:04:54
25316203,134219,121061037,106,"Added some comments, but I think person who will look at this code should know about `Storm` and know at least basic terminology from it.

I appreciate any points to things which confuse you at the first time seeing this code.",710563450,2017-06-09 14:07:03
25316203,550921,121166821,51,Storm's `Fields` that this bolt is going to emit.,710813236,2017-06-09 23:20:50
25316203,550921,121162262,8,I believe CMap stands for collection.Map to disambiguate against the default collection.immutable.Map. So SMap or ScalaMap is not applicable IMO.,710563450,2017-06-09 22:59:58
25316203,550921,121171085,39,"This could be a good utility method on Edge though, called sameEndPoints, which reads nicely: !edge.sameEndPoints(anotherEdge)",710638324,2017-06-09 23:40:45
25316203,550921,121033556,37,may be rename to registerNodes? I'm not sure schedule is meaningful here.,710638324,2017-06-09 08:32:38
25316203,550921,121033597,49,maybe rename to registerEdges?,710638324,2017-06-09 08:33:01
25316203,550921,121168969,54,May be rename to ItemToFields? Same below.,710813236,2017-06-09 23:31:21
25316203,550921,121169878,61,"Assumption is there are outputEdges, which is true now but not be in future if we support Spout only topologies. May be add an assert for the assumption.",710813236,2017-06-09 23:35:27
25316203,550921,121164137,39,"Can we avoid the complicated syntax ""node@(summerNode: SummerNode[Storm])"". Can't we just use summerNode, why do we need node@?",710813236,2017-06-09 23:08:33
25316203,550921,121163386,27,"I feel build is a more intuitive name here, it's a very standard method name on builders to build what they are supposed to build.",710813236,2017-06-09 23:04:58
25316203,550921,121168304,7,Curios why you've built this wrapper by moving code out of BaseBolt. Is the intention to remove knowledge of Topology and EdgeTypes from BaseBolt? If so then may be add a comment to BaseBolt to state this design goal.,710813236,2017-06-09 23:28:08
25316203,550921,121165133,55,May be refactor portion until like 48 to separate method called flatMapEdgeType?,710813236,2017-06-09 23:13:10
25316203,550921,121166586,37,"remove ""is an"": jobId id of ...
same below.",710813236,2017-06-09 23:19:55
25316203,550921,121177651,54,Fields is redundant actually since that's almost implied because of it being on EdgeType. I think we can just remove For and call it Item.,710813236,2017-06-10 00:13:43
25316203,134219,121205039,27,Done,710813236,2017-06-10 02:27:05
25316203,134219,121205424,37,Agree,710638324,2017-06-10 02:29:00
25316203,134219,121205690,39,Done,710813236,2017-06-10 02:30:30
25316203,134219,121205707,49,Done,710638324,2017-06-10 02:30:35
25316203,134219,121206010,55,Done,710813236,2017-06-10 02:32:17
25316203,134219,121206377,37,Done,710813236,2017-06-10 02:34:19
25316203,134219,121206576,51,Done,710813236,2017-06-10 02:35:39
25316203,134219,121208153,7,"Reasonable, removed `BoltBuilder`.",710813236,2017-06-10 02:44:22
25316203,134219,121208386,54,Done,710813236,2017-06-10 02:45:47
25316203,134219,121208470,61,"Not for `KeyValueSpout` I guess, we create it only in case there is summer after",710813236,2017-06-10 02:46:18
25316203,7111,121206371,23,"what are the `T, K, V` types here? I don't see why we need to pass type params that don't appear in the input or output, can we put them on the output?",711271220,2017-06-10 02:34:17
25316203,7111,121209232,77,"can't we put a type here? `Topology.Spout[(K, V)]`?",711271220,2017-06-10 02:50:31
25316203,7111,121207004,33,looks like we know the type to return?,711271220,2017-06-10 02:37:59
25316203,7111,121205945,8,+1 to @pankajroark ,710563450,2017-06-10 02:31:53
25316203,7111,121208483,50,can't we put a return type?,711271220,2017-06-10 02:46:22
25316203,7111,121206052,18,why does this go away?,711271220,2017-06-10 02:32:28
25316203,134219,121221903,18,It's here now https://github.com/twitter/summingbird/pull/731/files#diff-ada7a53f54309669e9f2c41907787a5cR48,711271220,2017-06-10 04:01:04
25316203,134219,121222582,23,"It's too big, so I decided to skip it. Added them back.",711271220,2017-06-10 04:04:40
25316203,134219,121222599,33,Yep,711271220,2017-06-10 04:04:45
25316203,134219,121222659,50,Done,711271220,2017-06-10 04:05:07
25316203,134219,121222814,77,Done,711271220,2017-06-10 04:06:13
25316203,550921,121230914,88,newline between methods,711338378,2017-06-10 05:00:53
25316203,550921,121231663,16,rename to build.,711338378,2017-06-10 05:06:58
25316203,550921,121230429,57,throw here,711338378,2017-06-10 04:57:13
25316203,550921,121229753,104,"Can we extract this out of this method? Very big nested methods are very cumbersome to read.

Also, may be we shouldn't call it sinkBolt unless there is a good reason to. Since we use summer terminology everywhere it will be good to be consistent.",711338378,2017-06-10 04:52:24
25316203,550921,121231149,50,"keyValueShards is unused above, remove.",711338378,2017-06-10 05:02:52
25316203,550921,121229208,112,"shouldEmit above is unused now, may be remove that.",711338378,2017-06-10 04:48:37
25316203,134219,121233054,57,"I can check there is no incoming edges here, but actually it's impossible because of types. So I believe ignore is what we need.",711338378,2017-06-10 05:18:18
25316203,134219,121233434,88,I did more or less on purpose %) But I think it's ok to be consistent here as well,711338378,2017-06-10 05:21:25
25316203,134219,121233581,112,Done,711338378,2017-06-10 05:22:36
25316203,134219,121234057,50,Done,711338378,2017-06-10 05:26:42
25316203,134219,121234175,16,Done,711338378,2017-06-10 05:27:45
25316203,550921,121234334,57,What's the harm in throwing if we don't expect this case to ever be hit?,711338378,2017-06-10 05:29:03
25316203,134219,121240748,57,"Because we will hit it on each `SourceNode`, but there is nothing to do on them, because they don't have incoming edges.",711338378,2017-06-10 06:36:01
25316203,550921,121731655,18,"AggregatedValue -> AggregateValue, to confirm with AggregateKey",713554700,2017-06-13 23:38:12
25316203,550921,121732419,19,"PartialAggregate?
Similar convention below.",713554700,2017-06-13 23:41:11
25316203,550921,121731547,17,"AggregatedKey -> AggregateKey
iiuc we want to indicate key of an aggregate, rather than key that has been aggregated.",713554700,2017-06-13 23:37:45
25316203,134219,121737578,18,Agree,713554700,2017-06-14 00:01:27
25316203,134219,121737552,17,Agree,713554700,2017-06-14 00:01:20
25316203,134219,121737901,19,"This case is kinda different. For key and value we want to highlight this is a type we want to aggregate over. For `PartiallyAggregated` this is a type of aggregated result, so I prefer to keep it to be `PartiallyAggregated`",713554700,2017-06-14 00:02:53
25316203,550921,121741428,19,"gotcha, sgtm.",713554700,2017-06-14 00:17:42
25316203,7111,121779233,147,"why do we have `T` here, but not in the return type?",713908441,2017-06-14 02:49:45
25316203,134219,121781091,147,"This `[T]` represents type of events we emit from chain of producers we put on this `Spout`. 
For return value it can be both `ItemSpout[T]` and `AggregatedSpout[K, V]` if `T = (K, V)` (common type for them is just `Spout[_]`). 

I kept this parameter ",713908441,2017-06-14 02:58:14
25316203,7111,121780183,99,the `orNull` is concerning here. Why do we have that?,713908441,2017-06-14 02:54:23
25316203,7111,121781298,114,can we make this a `def id: String` to avoid the risk of val init order.,713908441,2017-06-14 02:59:10
25316203,7111,121781553,149,can we use `def` here? note we can override `def` with `val`.,713908441,2017-06-14 03:00:19
25316203,7111,121781190,108,"can we use `val empty: Topology = ...` here rather than `EMPTY` (which is a java style, not really scala style).",713908441,2017-06-14 02:58:39
25316203,134219,121786236,108,Done,713908441,2017-06-14 03:21:47
25316203,134219,121786748,114,Done,713908441,2017-06-14 03:23:52
25316203,134219,121786778,149,Done,713908441,2017-06-14 03:24:00
25316203,134219,121786882,149,"I didn't marked val with `override` now, is it ok?",713908441,2017-06-14 03:24:29
25316203,134219,121790025,99,"It was for a case with empty output edges, which was handled later. I change type to `Option[Injection[[]]`.",713908441,2017-06-14 03:37:23
25549208,7111,122514393,97,can you add a comment what the type means?,715857305,2017-06-17 02:15:38
25549208,7111,122514816,50,no need for `scala.`,715857305,2017-06-17 02:18:04
25549208,7111,122514523,106,can we add `sealed` here? It must be sealed since Component is.,715857305,2017-06-17 02:16:22
25549208,7111,122515237,31,"why can't we call `bolt[Any, Any, O]` here directly?",715857305,2017-06-17 02:20:30
25549208,7111,122513850,13,can this be `final`?,715857305,2017-06-17 02:12:30
25549208,7111,122515336,30,if we had this type on the `SummerNode` we might not need the cast.,715857305,2017-06-17 02:21:01
25549208,7111,122513749,44,don't need `scala.` here.,715857305,2017-06-17 02:11:50
25549208,7111,122513631,26,seems weird that `decode` uses `scheme` but we never call `scheme.deserialize`?,715857305,2017-06-17 02:11:15
25549208,7111,122514033,20,"what about:
```scala
outgoingEdges.headOption.map { head =>
 
}
```",715857305,2017-06-17 02:13:30
25549208,7111,122513024,21,"this seems backwards to me. `shuffle(true)` does not look like LocalOrShuffle to me.

I also don't like Boolean flags. If we are going to keep this, can we call it `def withLocal(local: Boolean)` or someling.",715857305,2017-06-17 02:07:57
25549208,7111,122363712,23,Let's not use traversable. TraversableOnce or Iterable.,715857305,2017-06-16 11:53:33
25549208,7111,122514087,18,Traversable is not a great scala type. Can we use `TraversableOnce` or `Iterable`?,715857305,2017-06-17 02:13:46
25549208,7111,122515910,30,this method is untested.,715857305,2017-06-17 02:24:41
25549208,7111,122515971,83,this branch is untested.,715857305,2017-06-17 02:24:50
25549208,134219,122525516,26,Because purpose of this class to actually override deserialize (which `storm`s method) to support `Format`.,715857305,2017-06-17 03:18:13
25549208,134219,122527130,23,Done,715857305,2017-06-17 03:27:43
25549208,134219,122527187,21,Removed this method in favor of inlining. I guess now it looks better.,715857305,2017-06-17 03:28:04
25549208,134219,122527204,44,Done,715857305,2017-06-17 03:28:11
25549208,134219,122527213,50,Done,715857305,2017-06-17 03:28:15
25549208,134219,122527225,13,Done,715857305,2017-06-17 03:28:19
25549208,134219,122527242,18,Done,715857305,2017-06-17 03:28:24
25549208,134219,122527256,20,Looks good! Done.,715857305,2017-06-17 03:28:31
25549208,134219,122527267,97,Done,715857305,2017-06-17 03:28:35
25549208,134219,122527295,106,Done,715857305,2017-06-17 03:28:47
25549208,134219,122527313,31,Done,715857305,2017-06-17 03:28:54
25549208,134219,122528536,30,This was untested because we don't use `KeyValue` type for now (will be used by `leftJoin`). I removed from this change from the PR.,715857305,2017-06-17 03:36:19
25549208,134219,122528553,83,Same as above.,715857305,2017-06-17 03:36:25
25549208,134219,122528948,30,"I had a version before where I had two separate methods `createSingle` (for `Producer[T]` basically) and `createKeyValue` for (`KeyedProducer[K, V]`). And Summer wasn't implementing first one for example. But I removed it because of complexity. I think th",715857305,2017-06-17 03:38:29
25549208,550921,122481482,26,What do backticks signify? They're distracting to read. If you want to link to code then enclosing in double square brackets is the convention e.g [[com.twitter.Foo]],715857305,2017-06-16 23:27:51
25549208,550921,122483052,13,"Are we changing the way data flows to Summer? Instead of getting (Int, CMap[Key, Value]) now it gets Traversable[(Key, Value)]. ",715857305,2017-06-16 23:36:25
25549208,550921,122481609,33,corresponds -> correspond,715857305,2017-06-16 23:28:34
25549208,550921,122545203,161,This asInstanceOf hanging on second line is a bit weird. Can we move this with what it's acting on? If needed we can add a temporary variable.,716526315,2017-06-17 05:28:56
25549208,550921,122482394,9,This comment is not clear to me. What is Producer's chain?,715857305,2017-06-16 23:33:14
25549208,134219,122556369,13,"Yes, now it accepts `Iterable[(Key, Value)]`, because sometime it's aggregated and sometime it's not.",715857305,2017-06-17 07:49:41
25549208,134219,122556413,9,Added an example,715857305,2017-06-17 07:50:59
25549208,134219,122556440,161,Splitted into lines.,716526315,2017-06-17 07:51:43
25549208,134219,122556456,33,Done,715857305,2017-06-17 07:52:06
25549208,134219,122556697,26,"They used to quote a code (class names or variables). It came from Markdown I guess.

Maybe I use it a little bit too much/wrongly. Do you think we should change them to [[]] everywhere? I'm not fan of using FQNs thou, I think it decreases readability.",715857305,2017-06-17 07:58:21
25549208,550921,122555539,15,This comment is also not clear. There is an example that is great but can we describe first what an implementor of ComponentProvider is supposed to implement in createSingle.,716526315,2017-06-17 07:32:06
25549208,550921,122556427,199,"nit: Expression is too complex, may be:
      val groupedAggregatedEdge = Edges.groupedAggregatedToSummer[K, V](
        sourceId,
        getSummerBoltId[K, V](downstreamNode)
      )
      currentTopology.withEdge(groupedAggregatedEdge)",716526315,2017-06-17 07:51:18
25549208,550921,122549414,32,"too terse, may be use explicit variable names for readability.",716526315,2017-06-17 06:10:53
25549208,550921,122549553,44,"hard to read, instead of _3 etc deconstruct the args giving meaningful names.",716526315,2017-06-17 06:12:23
25549208,550921,122554504,25,"Doc comments for all public methods here. We should make clear the terminology around Aggregated, Sharded and Item, perhaps by pointing to the right place to learn this use.",716526315,2017-06-17 07:14:19
25549208,550921,122548969,64,Upper case first letter for constant.,716526315,2017-06-17 06:05:17
25549208,550921,122555152,252,"How about groupedJoin, we need to emit key values in that case as well right? Currently that will be a FlatMapNode.",716526315,2017-06-17 07:25:26
25549208,550921,122554824,28,"I think it will be instructive to put an ascii diagram here e.g.:

Component ----Edge---> Component",716526315,2017-06-17 07:19:32
25549208,550921,122555659,9,It's not clear why ComponentProvider needs to implement two methods below and what each out is required for at the conceptual level.,715857305,2017-06-17 07:33:49
25549208,550921,122556569,57,Can we add comments for all types here for what they represent.,716526315,2017-06-17 07:55:29
25549208,550921,122549074,79,"Doc comments for params, e.g. what does onReceiveTransform mean?",716526315,2017-06-17 06:06:31
25549208,550921,122548832,205,nit: may be change it to IllegalStateException. ,716526315,2017-06-17 06:03:33
25549208,550921,122556882,71,"nit: may be rename to itemToSharded, wrap doesn't clarify the intent for me, it took me a while to understand what wrap was referring to.",716526315,2017-06-17 08:02:35
25549208,550921,122556499,166,When can this happen? May be add a comment here for that.,716526315,2017-06-17 07:53:39
25549208,550921,122549205,83,Why is this needed? I'm concerned that we are making the edge more complex.,716526315,2017-06-17 06:08:15
25549208,550921,122556797,74,"Can we destructure tuple to improve readability:
  ): (Item[(K, V)] => Sharded[K, V]) = { case(ts, (k, v)) =>
    val wrappedKey = (k, batcher.batchOf(ts))
    val wrappedValue = (ts, v)
    val shardId = shards.summerIdFor(wrappedKey)
    (shardId, ",716526315,2017-06-17 08:01:10
25549208,134219,122853926,71,Done,716526315,2017-06-20 07:04:21
25549208,134219,122854881,74,Done,716526315,2017-06-20 07:12:51
25549208,134219,122854915,32,Done,716526315,2017-06-20 07:13:12
25549208,134219,122854920,44,Done,716526315,2017-06-20 07:13:15
25549208,134219,122855401,205,Done,716526315,2017-06-20 07:17:50
25549208,134219,122855469,252,"Yes, in future the other case for `groupedJoin` will be added here, for this review - only for summers.",716526315,2017-06-20 07:18:19
25549208,134219,122855574,64,Done,716526315,2017-06-20 07:19:10
25549208,134219,122856020,199,I'm not sure I understand about which expression exactly you are saying. IMO `edge` variable extraction doesn't improve readability and add a little bit of noise here. If separate variable here makes understanding of code here much easier - I'll change it,716526315,2017-06-20 07:23:02
25549208,550921,122879976,40,May be add a comment here as to why edge.source.id is unique so we don't end up overriding.,718529132,2017-06-20 11:44:05
25549208,550921,122868061,26,"I think [[]] is better, even without FQNs, just for consistency.",715857305,2017-06-20 09:28:10
25549208,550921,122879306,199,"It's very minor, ok to ignore, just wanted to offer a suggestion in case you also felt the same.",716526315,2017-06-20 11:35:52
25549208,550921,122880141,16,Should we call this method register?,718529132,2017-06-20 11:45:28
25549208,550921,122878740,138,"very minor, may be handle the positive case first i.e. if (shouldEmitKeyValues(node)), negation is slightly harder to read. Again, very minor.",718529132,2017-06-20 11:30:02
25549208,550921,122866653,20,move to previous line,718529132,2017-06-20 09:13:09
25549208,550921,122880514,83,We discussed this offline and seems ok to me.,716526315,2017-06-20 11:50:19
25549208,550921,122880282,13,"Line too long, spread out.",718529132,2017-06-20 11:47:18
25549208,550921,122879493,28,now -> know,718529132,2017-06-20 11:38:08
25549208,134219,123073721,26,"I changed to [[]], but tbh I dislike it =( I think backticks much lighter and easier to read. But I don't mind to use [[]].",715857305,2017-06-21 02:33:59
25549208,134219,123074086,28,I'm not sure which diagram here to add exactly? Can you suggest something?,716526315,2017-06-21 02:35:35
25549208,134219,123074558,166,Done,716526315,2017-06-21 02:37:46
25549208,134219,123074868,25,I will describe them in `StormTopologyBuilder` where they are declared.,716526315,2017-06-21 02:39:14
25549208,134219,123074919,79,Done,716526315,2017-06-21 02:39:26
25549208,134219,123075224,20,I like this way more. Do we have any concrete style guides on this?,718529132,2017-06-21 02:40:54
25549208,134219,123075290,138,I wanted to keep more general case first.,718529132,2017-06-21 02:41:09
25549208,134219,123075328,138,"Actually even not general, but simpler case.",718529132,2017-06-21 02:41:19
25549208,134219,123075424,28,Done,718529132,2017-06-21 02:41:47
25549208,134219,123075811,16,Done,718529132,2017-06-21 02:43:40
25549208,134219,123075905,13,Done,718529132,2017-06-21 02:44:06
25549208,134219,123076440,40,Done,718529132,2017-06-21 02:46:21
25549208,134219,123087814,57,Done,716526315,2017-06-21 03:34:36
25549208,134219,123088066,25,About methods itself - I think they are selfdescriptive. Also note - all of them located in package private objects (as almost everything else I added).,716526315,2017-06-21 03:35:44
25549208,134219,123088895,15,"Any suggestions on how to describe this?

Basically this two methods correspond to non aggregated and aggregated use cases for `flatMap` and `spout`. I guess abstraction here is a little bit foggy unfortunately, but I didn't come up with better way to a",716526315,2017-06-21 03:39:11
25549208,550921,123119200,138,sg,718529132,2017-06-21 06:10:04
25549208,550921,123119114,25,"Yeah, I'm fine with just pointing it e.g. ""@see [[com.twitter.summingbird.storm.StormTopologyBuilder]] for definition of groupedAggregated""",716526315,2017-06-21 06:09:19
25549208,550921,123118383,15,"Something on the lines of:
Create a component that emits events with single type i.e. events that don't have to have a key-value structure. e.g. ...",716526315,2017-06-21 06:04:10
25549208,550921,123119341,40,on -> one,718529132,2017-06-21 06:10:53
25549208,550921,123116690,20,Actually it looks like we are not consistent in this in summingbird repository. So I'm fine with this.,718529132,2017-06-21 05:53:02
25876019,550921,124097873,27,We should add unit tests for StormTopologyBuilder to cover this feature.,722982381,2017-06-27 02:25:25
25876019,550921,124092542,28,"Hard to read, may be use deconstruction. map { case (k, v) => ...",722982381,2017-06-27 02:01:49
25876019,550921,124094276,28,Can you create a jira ticket and link here?,722982381,2017-06-27 02:08:51
25876019,550921,124095336,43,"nit: I just noticed this method is becoming hard to read due to nested deconstructors, perhaps refactor ""case Some(props) if props.allSummers =>"" part into a separate method.",722982381,2017-06-27 02:13:29
25876019,550921,124097324,110,This doesn't need to be a method on this class. Should perhaps be a method on the companion and unit tested.,722982381,2017-06-27 02:23:01
25876019,550921,124093941,75,"May be create temporary variables for readability and then
(ts, (k, v))
which is much more readable.",722982381,2017-06-27 02:07:40
25876019,550921,124092132,15,Parens around the first Int look redundant.,722982381,2017-06-27 02:00:03
25876019,550921,124094170,20,"Nice, this reads simpler.",722982381,2017-06-27 02:08:25
25876019,550921,124093630,68,Destructure for readability.,722982381,2017-06-27 02:06:14
25876019,134219,124107190,15,Done,722982381,2017-06-27 03:07:37
25876019,134219,124107465,28,Done,722982381,2017-06-27 03:08:46
25876019,134219,124107443,68,Done,722982381,2017-06-27 03:08:41
25876019,134219,124107918,75,Done,722982381,2017-06-27 03:10:55
25876019,134219,124111275,28,"Actually this is not needed anymore, removed this code and added test for `mapValues` into `StormLaws`. Thanks!",722982381,2017-06-27 03:25:43
25876019,134219,124111471,27,"I added test to `TopologyTests`, but I think separate `StormTopologyBuilderTests` would be nicer.",722982381,2017-06-27 03:26:38
25876019,134219,124112183,27,Done,722982381,2017-06-27 03:29:27
25876019,134219,124112813,110,Unfortunately in this method we access `Options` which makes both extraction and testing much harder. I'm agree this is not the best place for this method but IMO it's best place now. ,722982381,2017-06-27 03:31:52
25876019,134219,124113213,43,"This method represents high level strategy how to deal with key value components, all further logic extracted into `registerAggregatedEdges`, `registerShardedKeyValue` and `registerKeyValue`. I can extract `aggregated` part further but I prefer to keep it",722982381,2017-06-27 03:33:34
25876019,7111,124122319,55,"can you write this with `.mapValues { case (value, _) => value }`, which has the potential for optimization in scalding at least, so people can see examples where `mapValues/collectValues/flatMapValues` is preferred?",723579612,2017-06-27 04:06:41
25876019,7111,124119457,9,"this was already done? We have support for ValueFlatMapped now? If so, can we combine `leftJoin.mapValues.sumByKey` into a single node if `leftJoin` is grouped?",723579612,2017-06-27 03:57:19
25876019,7111,124121769,111,"I'm suspect of the `.last` here. This means we can't add a `mapValues` or `flatMapValues` on the end.

Why don't we want `node.members.exists { case _: LeftJoinedProducer[_, _, _, _] => true; case _ => false } && `?",723579612,2017-06-27 04:04:20
25876019,550921,124124415,76,"I'm not sure scalac will optimize this out, so there could be performance penalty. May be just split to multiple lines. 
val timestamp = input.get(0).asInstanceOf[Timestamp]
...",723579612,2017-06-27 04:16:44
25876019,550921,124124562,43,sg,722982381,2017-06-27 04:17:30
25876019,550921,124126210,111,It would also be good to add tests with mapValues and flatMapValues to capture this.,723579612,2017-06-27 04:24:56
25876019,550921,124124708,110,"sg, since extraction is harder it's ok.",722982381,2017-06-27 04:18:12
25876019,134219,124134541,9,We have support on the level we can build `flatMap` operation over it (https://github.com/twitter/summingbird/commit/44fb5c9#diff-1d4313fb460f1921fc349a8eb2ee902fR85). But it's not fully supported in a way to affect `OnlinePlan`. I would like to do this i,723579612,2017-06-27 05:08:34
25876019,134219,124134852,111,"@johnynek `.last` is here refers to first element in producers chain unfortunately (I added a comment on `.members` in previous PR).

I don't think we need tests on this edge cases because we don't support this edge cases yet.",723579612,2017-06-27 05:10:28
25876019,134219,124135069,55,"Sure. Looks better now, thanks!",723579612,2017-06-27 05:11:47
25876019,134219,124135299,76,I thought about this but decided it should be optimized by compiler =) changed to your way.,723579612,2017-06-27 05:13:11
25876019,134219,124135788,111,Added a comment in test that number of bolts can be `-1` in case of support of `mapValues`.,723579612,2017-06-27 05:16:04
25876019,134219,124137014,111,"Also I added `firstProducer` method on `Dag`s `Node`, to make it look better.",723579612,2017-06-27 05:23:27
25876019,550921,124154294,9,"I agree, better to go incrementally. We can do that optimization in separate review.",723579612,2017-06-27 07:33:26
25876019,7111,124154481,14,"any reason not to do:
```scala
node.firstProducer.flatMap { producer =>
  Options.getFirst[T](options, stormDag.producerToPriorityNames(producer))
}
```
here?",723652492,2017-06-27 07:35:15
25876019,7111,124154602,33,this function is untested. Any way to get some test coverage of it?,723652492,2017-06-27 07:36:25
25876019,7111,124154776,9,"wait, I'm confused why you removed this code then.

Can you link to where in the storm platform we handle `flatMapValues`? The link you have above points to the optimizer rule you are removing here.",723579612,2017-06-27 07:38:16
25876019,134219,124156798,9,"@johnynek because I pointed to the wrong code, sorry %) Here is a right link https://github.com/twitter/summingbird/commit/44fb5c9#diff-81c566a323153de58aa7f47b84ee941aR54.",723579612,2017-06-27 07:57:31
25876019,134219,124157143,14,Changed to `.flatMap` way.,723652492,2017-06-27 08:01:47
25876019,134219,124158044,33,"Sure, done!",723652492,2017-06-27 08:11:15
25913693,550921,124325286,19,"Why is it called SummerConstructorSpec, there's no SummerConstructor in definition.",723893626,2017-06-27 23:23:45
25913693,550921,124326185,20,"tbh, I think we should just change the definition of SummerBuilder to take the counterBuilder as argument and default to a no-op counterBuilder. SummerBuilder is used very rarely and I think it's ok to break it. There are only a couple places that we'll n",723893626,2017-06-27 23:27:21
25913693,134219,124391120,19,After offline discussion renamed it to `SummerWithCountersBuilder`.,723893626,2017-06-28 03:46:38
25913693,134219,124391338,20,I did this change in backward compatible manner - it's still possible to create `SummerWithCountersBuilder` out of plain `SummerBuilder`.,723893626,2017-06-28 03:47:30
25913693,550921,124373317,144,"too long, move each param to separate line.",723893626,2017-06-28 02:32:01
25913693,7111,124618709,19,you probably want this to `extend Serializable` or we may have some corner case issues.,724509767,2017-06-29 01:24:53
25913693,7111,124618588,20,"I am not crazy about `with` what about `Name => (Counter, Incrementor)` do they have to be bound together?",724509767,2017-06-29 01:24:23
25913693,7111,124619474,34,can we indent here?,724509767,2017-06-29 01:27:46
25913693,134219,124700009,34,Sure,724509767,2017-06-29 09:28:38
25913693,134219,124700102,20,"I prefer to keep it this way (or maybe change to just `Incrementor`). It should be the same object, not both of them.",724509767,2017-06-29 09:29:35
25913693,134219,124700178,19,"Actually I prefer to keep it non serializable, this code (creating actual `SummerBuilder` with `Counter`s) should happen only on submitter node, and `SummerBuilder` is an object which should be serializable (and it is). ",724509767,2017-06-29 09:30:33
25913693,134219,124700443,19,Commented in code,724509767,2017-06-29 09:33:21
25913693,134219,124701462,20,Changed to just `Incrementor`.,724509767,2017-06-29 09:44:31
26070377,550921,125151442,17,Can we comment here why this is required?,727207738,2017-07-01 08:26:08
26070377,134219,125152405,17,I changed a way I fixed an issue. Turned out way with ignoring `IdentityKeyedProducer`s caused more bugs than fixed.,727207738,2017-07-01 09:15:00
26242328,7111,126036920,10,you might put `Try(f(data))` here just to catch any issues with the `f` that could exist since we have try anyway.,731413513,2017-07-07 05:59:05
26242328,7111,126036809,30,I'm pretty skeptical we are comparing apples to apples when we compare this to non `OperationContainers`.,731413513,2017-07-07 05:58:14
26242328,134219,126039250,30,"I'm skeptical as well, but I wanted to see at least some number for non `OperationContainer` execution. In the end I don't think it should be anyhow actionable. ",731413513,2017-07-07 06:15:03
26242328,134219,126040159,10,Done,731413513,2017-07-07 06:22:36
26242328,280540,126238688,30,`Thread.sleep` adds noise to the result. The blackhole provides a method to simulate CPU usage. I think it's `consumeCpu`,731413513,2017-07-08 03:30:56
26242328,280540,126240478,12,"I suggest adding these options:

`-prof gc` to enable the GC profiler
`-gc` to force a GC between runs. Without it, 10 warmup and actual iterations might not be enough to exclude GC noise
`-foe true` to fail the benchmark if the code fails. I've seen ",731577622,2017-07-08 03:40:28
26242328,280540,126241099,57,The function allocation here (`composed.apply(_)`) introduces some noise. Maybe it's worth extracting it to a constant,731577622,2017-07-08 03:43:42
26242328,280540,126243536,30,"Sorry, I've just noticed that this is actually to check when it's completed. Maybe you could use a `CountDownLatch` for it?",731413513,2017-07-08 03:55:22
26242328,280540,126243986,18,Do you have a sense of how expensive `container.execute` is? I ask because `testOperationContainer` introduces some noise so its overhead could dominate the final result.,731577622,2017-07-08 03:57:42
27748447,6636815,134354861,19,remove?,765230302,2017-08-22 06:34:33
27748447,6636815,134555346,119,maybe nice to add a comment above on the details of the past failure? might be hard for folks reading the code to know?,765230302,2017-08-23 00:53:21
27748447,7111,134569886,119,"I don't know what to say. This was a hand minimized example (it took me about an hour) from a failure case found by scalacheck. Since the failures were quite rare, it took a long time to even find a failure with scalacheck, so once I found it, I wanted to",765230302,2017-08-23 01:49:34
27748447,6636815,134582827,119,Yeah I guess reading the title it doesn't give you a sense of what the issue is and what it's testing. Would it make sense to add a tldr of your understanding of why it failed? ,765230302,2017-08-23 02:45:24
34650592,134219,167180062,4,I think generic `memoize(StateWithError)` is simpler to understand.,907634840,2018-02-09 17:41:44
34650592,134219,167174800,33,Can we put `PipeFactor[T]` back here? ,907634840,2018-02-09 17:18:40
34650592,134219,167180546,4,This function doesn't memoize failures?,907634840,2018-02-09 17:43:43
34650592,134219,167181508,62,Can be removed,907634840,2018-02-09 17:47:46
34650592,134219,167181425,35,Is `memoizePlan(pf).map { ... as before ... }` has different semantic with this code?,907634840,2018-02-09 17:47:27
34650592,7111,167302306,33,It was needlessly constraining the type. This works for any T. `PipeFactory[T] == PlannerOutput[FlowProducer[TimedPipe[T]]]` so I didn't want to limit it.,907634840,2018-02-10 02:04:38
34650592,7111,167302437,4,it does not memoize failures.,907634840,2018-02-10 02:05:11
34650592,7111,167302782,35,"Previously, we didn't memoize the state computation, just the reader inside. The semantics are the same, but this removes an exponential blowup on graphs that merge back into themselves repeatedly (similar to the problem with a naive implementation of fib",907634840,2018-02-10 02:06:44
34650592,134219,167305172,33,"Makes sense, looks better this way.",907634840,2018-02-10 02:16:32
34650592,134219,167305817,35,"Oh, I see. Basically you do `memoizeReader(Reader[I, O]) -> Reader[I, O]`. Then I prefer to have it extracted and then what you want is `memoizeState(pf).map(memoizeReader)`.",907634840,2018-02-10 02:19:11
35628311,280540,171381399,24,Curiosity: why create a new class instead of isolating captured values using local `val`s?,930523918,2018-03-01 04:51:55
35628311,280540,171382126,33,is this just a refactoring or does it fix serialization issues as well?,930523918,2018-03-01 04:54:54
35628311,7111,171382213,24,"just to be 100% clear about what is captured. a side benefit is that is has a good equality, but I doubt that will come into play.

I was surprised to see what was captured here because you have 3 nested layers of closure.",930523918,2018-03-01 04:55:15
35628311,7111,171382730,33,"it does! see how tricky it is! without this change, you serialize the whole store to get flatOpt, when really we don't need to grab that function for two simple use cases. Not even sure there is no flatten on Option still in scala, but in any case, flatte",930523918,2018-03-01 04:57:08
35628311,280540,171382870,24,???? thanks for the clarification. I think we could do better regarding capturing. We could do something at runtime like Spark does or even try to inspect the function using a macro to detect captured values that aren't serializable.,930523918,2018-03-01 04:57:42
35628311,7111,171383365,24,"given that lightbend are trying to remove macros, or at least drastically narrow the scope, I'm a little worried about being too macro reliant. Note that scalacenter's spores are not even available on 2.12 due to issues with macro interaction with a new v",930523918,2018-03-01 04:59:47
2343866,258789,7267218,72,Comment seems superfluous,67584467,2013-10-29 05:33:38
2343866,258789,7267272,106,What's going on here - should this be main? Maybe a comment explaining why it shouldn't be?,67584467,2013-10-29 05:36:48
2343866,258789,7267295,8,rm -rf here will let you safely omit the true,67584467,2013-10-29 05:38:00
2343866,258789,7267332,6,"nit, downcase this and below var names",67584467,2013-10-29 05:39:33
2343866,258789,7267361,9,"Superfluous braces can be dropped, but parameter expansion should be quoted.

`unzip ""$dist_dir/aurora-scheduler.zip"" -d ""$dist_dir""`

",67584467,2013-10-29 05:41:00
2343866,258789,7267379,10,"nits: drop superfluous braces, quote parameter expansion, downcase parameter name

`jvm_opts=""${jvm_flags[@]}"" ""$aurora_dir/bin/aurora-scheduler"" ""${aurora_flags[@]}""`",67584467,2013-10-29 05:42:36
2343866,258789,7267432,31,I don't see this reproduced anywhere in the .gradle file - does the build still work with an empty artifact cache? ,67584467,2013-10-29 05:45:36
2343866,258789,7267699,31,Nevermind - see it now,67584467,2013-10-29 05:59:33
2343866,530795,7267703,72,Done.,67584467,2013-10-29 05:59:50
2343866,530795,7267758,106,"src/resources is automatically added to the dist jar, but needs to be added if you want it on the test classpath.",67584467,2013-10-29 06:02:08
2343866,530795,7267778,6,Done.,67584467,2013-10-29 06:03:12
2343866,530795,7267784,8,Done.,67584467,2013-10-29 06:03:29
2343866,530795,7267791,9,Done.,67584467,2013-10-29 06:03:58
2343866,530795,7267799,10,Done.,67584467,2013-10-29 06:04:37
2343866,530795,7267812,31,It's in the repository section of build.gradle.,67584467,2013-10-29 06:05:12
2754225,51152,8777969,5,"`getBytes` will force UTF-8 encoding of the data, and then throw away the result. You should try to avoid double-encoding by (re)using the encoded content from somewhere else.",80649119,2014-01-10 08:24:05
2754225,126071,8778073,5,"Should I be doing this instead?
```scala
val jsonString = jsonMapper.writeValueAsString(j).getBytes(""utf-8"")
resp.headers.set(""Content-Length"", jsonString.length)
resp.setContent(copiedBuffer(jsonString))
```",80649119,2014-01-10 08:29:43
2754225,51152,8778135,5,"Yea, that works. Although the naming would be:
val jsonBytes = ...getBytes(""utf-8"")",80649119,2014-01-10 08:32:53
2792162,117128,8819121,1,Move this file to `script/finatra/share/.bowerrc`,82510077,2014-01-13 15:33:55
2792162,117128,8819125,1,Move this file to script/finatra/share/bower.json,82510077,2014-01-13 15:34:12
2792162,117128,8819129,22,update to use `share` directory,82510077,2014-01-13 15:34:35
2792162,117128,8819131,23,update to use `share` directory,82510077,2014-01-13 15:34:41
2792162,117128,8819148,5,"There's a test that still expects ""hello world"": https://travis-ci.org/twitter/finatra/jobs/16852864

Update it here: https://github.com/twitter/finatra/blob/master/src/test/scala/com/twitter/finatra/ExampleSpec.scala#L268",82510077,2014-01-13 15:36:18
2792162,117128,8819166,2,Change name to `###PROJECT_NAME###` so it gets replaced,82510077,2014-01-13 15:37:52
2792162,117128,8819172,3,Change version to `###VERSION###` so it gets replaced,82510077,2014-01-13 15:38:13
2792162,117128,8819366,3,Make this `0.0.1`,82510077,2014-01-13 15:53:13
3306229,387163,11196217,10,I think DefaultJacksonSerializer should be an object in this patch vs a class otherwise we do not get the reuse of ObjectMapper across separate render calls,100356154,2014-04-02 13:26:54
3306229,387163,11196256,15,make this an object?,100356154,2014-04-02 13:28:08
3306229,117128,11324097,28,Why not pass in a default serializer like `serializer: JsonSerializer = new DefaultJacksonJsonSerializer`? That way you don't have to pass it in everywhere and it doesn't break compatibility.,100356154,2014-04-06 06:58:00
3306229,387163,11326241,28,"Yep I like that idea too, also if DefaultJacksonJsonSerializer is an object this means we get reuse of the object mapper between responses",100356154,2014-04-06 18:50:46
3846061,242962,13741437,17,"May be just for test reasons it's fine, but in general this is wrong. This could return """" as a response. you should use flatMap for example to build response",125748573,2014-06-13 13:04:09
4194702,117128,18875659,7,"The match with a regex seems like overkill here, perhaps just have a simple if condition with `request.contentType.contains(""multipart/form-data"")`",139850863,2014-10-15 10:50:09
4321099,130567,15732848,5,Not good: this would bypass any user-defined `notFoundHandler`,144781809,2014-08-03 08:49:38
7153274,146404,28706750,9,"This is redundant since you've provided your own script (which will be run literally, which means the `scalaVersion` value in your `build.sbt` will be used). It might be worth running tests for both 2.10 and 2.11, which would require adding a `2.10.5` lin",246184721,2015-04-20 21:56:10
7153274,146404,28706851,12,Might be worth considering adding `oraclejdk8` here—I know for Finagle proper we definitely have a number of adopters on Java 8.,246184721,2015-04-20 21:57:17
7153274,146404,28707077,15,"This isn't running the provided `sbt` script, but rather Travis CI's. That might be fine, but if using `./sbt` is going to be the recommendation in the docs, etc., it's probably best to use it here as well.",246184721,2015-04-20 21:59:56
8221271,7875,34152707,17,Something we're in the middle of cleaning up -- there's a bit of an inconsistent effort right now of switching from the raw netty types to finagle-http types. Thanks!,277628362,2015-07-08 19:23:32
8221271,7875,34111796,17,Can you keep this as HttpMethod.PATCH?,277628362,2015-07-08 07:36:11
8221271,1710905,34122200,17,Updated the PR. Any idea why `http(Post|Put|Delete)` are inconsistent here?,277628362,2015-07-08 12:34:38
8637792,5101696,36774115,67,Is JsonParser needed?,284769087,2015-08-11 22:39:02
8637792,5101696,36780218,36,"findAnnotation[JsonDeserialize](annotations) map { jsonDeserializer =>
  ClassUtil...
}",284769087,2015-08-11 23:26:09
8637792,5101696,36780241,26,Move up a line,284769087,2015-08-11 23:26:18
8637792,5101696,36781431,52,Can we omit the bound and just use JsonDeserializer[Object]?,284769087,2015-08-11 23:35:52
8637792,5101696,36802934,29,Can you also add an optional field (e.g. optMyBigDecimal)? ,284769087,2015-08-12 02:42:20
9318760,1524412,39930031,5,"[Route](https://github.com/twitter/finatra/blob/master/http/src/main/scala/com/twitter/finatra/http/internal/routing/Route.scala) is in an internal package, implying it wasn't meant be exposed in a public api. Either move it to a public package, or expose",309250736,2015-09-20 18:43:33
9318760,50391,39937405,5,"Hi Syamantak ,
thanks for the response. I've noticed this. I've been kind of busy these days. I was thinking about exposing it with an easier way to build it. Probably extracting some behavior from HttpRouter to make the integration easier for anyone who",309250736,2015-09-21 05:57:31
9384132,1524412,39944387,16,"[Fields](https://github.com/twitter/finagle/blob/develop/finagle-httpx/src/main/scala/com/twitter/finagle/httpx/Fields.scala) contains most of the standard headers, maybe use that ?",315285893,2015-09-21 11:50:24
9384132,8330451,39944666,16,"Thanks!

Changed ;)",315285893,2015-09-21 11:58:55
9384132,1524412,39952959,31,and in here too :),315292251,2015-09-21 14:24:57
9384132,8330451,40063555,31,Thanks! Done ;),315292251,2015-09-22 13:42:03
9384132,5101696,40287278,3,"Can we keep one apply method with default argument values? e.g. 
```
def apply[T](toBuf: T => Buf, status: Status = Ok, headers: Map[String, String] = Map())(stream: => AsyncStream[T]) = {
...
}
```",315285885,2015-09-24 10:40:55
9384132,5101696,40287339,25,"Avoid the Option to simplify client usage:
```
headers: Map[String, String] = Map()
```",315285885,2015-09-24 10:42:52
9384132,5101696,40287382,33,Thanks for catching this! ,315285885,2015-09-24 10:44:08
9384132,5101696,40288576,45,"```scala
for ((k, v) <- headers) {
  response.headerMap.add(k, v)
}
```",315285885,2015-09-24 11:18:19
9384132,8330451,40371781,3,"If I do this I get a compiling error:
```
Error:(9, 8) in object StreamingResponse, multiple overloaded alternatives of method apply define default arguments.
object StreamingResponse {

```",315285885,2015-09-25 01:54:02
9384132,8330451,40372129,25,Thanks I'll do that.,315285885,2015-09-25 01:57:08
9384132,8330451,40372146,45,Thanks!,315285885,2015-09-25 01:57:19
9970151,7875,42638625,4,"Style nit: space between ""{"" and ""user"", e.g., 

```scala
post(""/createUser"") { user: CreateUserRequest =>
```",333907751,2015-10-21 20:25:26
9970151,1524412,42680027,4,done,333907751,2015-10-22 01:47:12
9970151,5101696,42792727,12,"Thanks so much for the pull request! I just realized that I forgot to update the issue to include the other ""attributes"" we support: @QueryParam, @RouteParam, @FormParam, @Header. Could you extract a method, and support the additional attribute types? Tha",334460898,2015-10-23 00:12:26
9970151,1524412,42806091,12,"Sure, but I'm not sure if `@RouteParam` can be validated this way. At the moment the service returns 404(which I believe is the correct behaviour), because of a regex match failure I assume. I'm not sure if 400 would be the correct response in case of a m",334460898,2015-10-23 02:05:28
9970151,1524412,42806613,12,covered the others in https://github.com/syamantm/finatra/commit/1f5d6db70008216e4ff3336ef5ec3c8690b07ac4 btw,334460898,2015-10-23 02:10:20
9970151,5101696,42808319,12,"Yep, disregard @RouteParam :-)",334460898,2015-10-23 02:25:03
10568065,1925,45273506,4,"Note, this changed from httpx => http after the migration was completed.",348407631,2015-11-19 05:51:40
10568065,41259,45326064,4,Is the latest Finatra version already using this version of Finagle?,348407631,2015-11-19 17:54:14
10568065,1925,45904386,4,"Yes, looks like it is.",348407631,2015-11-26 02:46:26
10568065,41259,45918121,4,":+1: @taylorleese, I've just ammended my commit and updated this PR!",348407631,2015-11-26 04:57:06
10980109,35556,47268836,4,Please sort the imports alphabetically.,358219780,2015-12-11 03:03:53
10980109,7875,47270703,5,Can you add *additional* test cases instead of changing the existing tests? Thanks!,358219780,2015-12-11 03:16:48
11118124,1925,48698713,3,@simplyianm If you look at @scosenza's commit message in https://github.com/simplyianm/finatra/commit/72067401d50e62a442ee2eb836b0baff95dbf1c2 you'll notice he also suggests setting ```disableAdminHttpServer = true``` to prevent the admin http server from,361398398,2016-01-04 07:20:20
11118124,7875,49084187,3,@simplyianm the example **requires** that you set the setting `disableAdminHttpServer = true` as Taylor has mentioned. Starting a Finatra server requires an admin port to be configured and **not** passing one here will instead use the hardcoded default wh,361398398,2016-01-07 23:29:04
13234244,132262,57181694,21,"can you move .withZone(GMT) to the next line too, so that the with-methods are formatted consistently?  I think it makes builders easier to read.",411296398,2016-03-23 22:38:58
13234244,35556,65928066,4,Please alpha-sort imports,413260057,2016-06-07 00:04:31
13234244,35556,65928204,23,"Please format as

val dateFormat =
  DateTimeFormat
    .forPattern(RFC7231DateFormat)
    .withZone(GMT)
    .withLocale(Locale.US)",413260057,2016-06-07 00:05:23
13234244,35556,65928265,3,Please alpha-sort imports,413260057,2016-06-07 00:05:43
13234244,35556,65928688,19,"There was a question internally as to whether this should be ""reset"" instead.

[setDefault](https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#setDefault(java.util.Locale))
> Sets the default locale for this instance of the Java Virtual Ma",413260057,2016-06-07 00:08:27
13234244,35556,65929235,23,"Also, according to [DateTimeFormat](http://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html): 

> DateTimeFormat is thread-safe and immutable, and the formatters it returns are as well.

So 'dateFormat' can be moved outside of t",413260057,2016-06-07 00:12:02
13234244,1925,66162351,23,@ryanoneill Couldn't you leave ```zzz``` as the zone if we're going to use ```.withZone(...)```?,413260057,2016-06-08 05:11:25
13234244,26194,66187377,23,"@taylorleese  
It doesn't work with an old version joda-time.
In joda-time-2.8.2 which elasticsearch-2.3.3 is dependent on in my project, the date could be formated as we expected `Wed, 08 Jun 2016 03:03:06 GMT`.
But under joda-time-2.7 or joda-time-2.",413260057,2016-06-08 10:20:07
13234244,7875,66495820,20,"We can't change the locale like this.

The purpose of the change is to ensure that the header is written out as per the spec (which assumes a US Locale). Without changing locale in the test like this it should be sufficient to send a request and simply ",460082424,2016-06-10 01:27:58
13234244,7875,66495862,39,Remove as per above comment.,460082424,2016-06-10 01:28:13
13234244,26194,66716149,20,"@cacoco it's been removed. Changing the locale is just against the original code's header, to reproduce the problem in non-ascii language locale. Indeed, it is useless for the purpose of this test.",460082424,2016-06-12 12:03:13
14012295,7875,60308739,4,please move into it's own file,429841552,2016-04-20 03:51:21
14012295,132560,60309211,4,Done :),429841552,2016-04-20 03:54:08
15720027,7875,70851246,5,"Why an unrelated type, U? This should probably be type bounded to T. For your use-cases I think this would be a sub-class of T? E.g., you are trying to parse a sub-class of the more generic T that the reader is typed to.",475091145,2016-07-15 00:51:32
15802231,7875,71252201,3,"Please leave the imports sorted in alphabetical order (e.g., don't separate the java imports from the scala ones, just alpha-sort all).",478253230,2016-07-19 06:54:11
15802231,55317,71263915,3,@cacoco fixed the imports order,478253230,2016-07-19 09:24:43
15802231,55317,71263330,3,"It's from Intellij optimise imports ???? 

Going to fix it by hand.",478253230,2016-07-19 09:17:16
17729006,7875,82535521,4,I think it's fine to just use `scoped` (or `scope`) instead of the more verbose `addScoped`.,526564136,2016-10-10 07:03:05
17729006,7875,82535496,9,"formatting: Spaces between ""{}""

```
{ def prefix = """" }
```",526564136,2016-10-10 07:02:00
17729006,7875,82535376,18,`scope` should probably come before `route`.,526564136,2016-10-10 06:57:34
17729006,7875,82535673,16,"argument list order of `filter, scope, controller` probably makes more sense.",526564136,2016-10-10 07:10:23
17729006,7875,82535407,15,"Not convinced by the name, ""scope"".",526564136,2016-10-10 06:58:44
17934845,1818673,83538186,12,"I think is enough to add the following method in ResponseBuilder to avoid changing FileResolver(by the way, I'm not proud of what I wrote there):

```
    def hasFile(file: String): Boolean = {
      val fileWithSlash = if (file.startsWith(""/"")) file ",534774246,2016-10-16 02:10:16
17934845,7875,83771550,12,"Can you update your patch to do this? Also we should have tests. 

Take a look at these tests -- you may be able to add a test case there or you may have to create a completely new test file: 
https://github.com/twitter/finatra/blob/develop/http/src/te",534774246,2016-10-18 09:21:49
18370328,272094,86669813,12,"I fixed a bug that `suppress` will be the default value on the recursive call :)

What would be the best thing to add a test to singleton class?
",545400051,2016-11-06 00:32:21
18370328,7875,85802930,12,"I believe you need to pass it through to the recursive call as well, otherwise on the next call it will be the default, e.g. false.

Which points out that you should probably add a test.

Thanks!
",545400051,2016-11-01 01:29:38
19280593,7875,90751517,5,"probably better to handle the IllegalArgumentException, no?",567398394,2016-12-03 13:42:46
19280593,1818673,92934969,5,"it is, thanks.",567398394,2016-12-18 14:47:57
19656852,3451456,91841351,19,I would appreciate some guidance on how upstream would like this exposed to library client.,575522032,2016-12-11 04:08:55
19656852,1350674,92265887,57,Could we use the `FuturePool.immediatePool` here? This will only be used to do the conversion so I don't see a need to fork it over to a different thread pool.,575522044,2016-12-14 05:05:41
19656852,1350674,92266811,28,We should be able to make this much more concise using the bijections: a bijection exists for ScalaFuture <-> TwitterFuture.,575522044,2016-12-14 05:10:30
19656852,3451456,92329905,57,"@bryce-anderson Aw man, that's what i get for working late; completely failed to commit the Future portion of the bijection use.  Fixed!

Also, great idea on the `immediatePool`, since that basically undoes the need for an external `ExecutionContext` in",575522044,2016-12-14 14:39:42
19946953,1925,93974475,38,"This is a nit, but would prefer we make this ```Seq``` a val and reuse it so future version bumps are simpler.",585538248,2016-12-28 05:59:03
19946953,9161194,94163908,38,???? ,585538248,2016-12-30 02:14:25
21262016,7875,100853549,9,"@virusdave Would prefer if we don't leave the `TODO(username)` here. If you're OK with that, I can just remove it when merging this internally.",614405319,2017-02-14 01:49:23
21262016,3451456,100881616,9,"Sure thing, remove it!  Meanwhile i'm pursuing that, but as expected i'm making less rapid progress there.  :(",614405319,2017-02-14 03:50:56
21456738,7875,101628852,12,"just:

```
case Some(tlc) if !clazzIsInObject =>
  tlc
```

e.g., no curly braces needed?",619521672,2017-02-17 05:18:41
21456738,7875,101629033,16,same -- though I know the {} were already here.,619521672,2017-02-17 05:19:31
22208374,7875,105410975,97,I would prefer that this is has a tighter visibility in that it's only used in the RouteDSL as we don't want to expose it for general use. And anything not locked down will be used making it harder to refactor later.,642139573,2017-03-10 22:51:19
22208374,7875,105411016,100,same as above.,642139573,2017-03-10 22:51:25
22208374,7875,105410400,11,"can you name the params here? e.g.,

```
... = RouteContext(
  prefix = """",
  buildFilter = (_) => Filter.identity
```",642139573,2017-03-10 22:48:38
22208374,88942,105429222,97,Totally. Will fix. Is `private[http]` ok? ,642139573,2017-03-11 00:11:28
22208374,7875,105442850,97,"That should work but if we don't need to leak it to the package, e.g. `private` or `private[this]` that would be even more preferable (same with the other usages of `private[http]` throughout).",642139573,2017-03-11 01:14:09
22208374,88942,105445922,97,"I think `private[http]` is the tightest we can use here, since these methods are overridden by `PrefixedDSL` and `FilteredDSL`",642139573,2017-03-11 01:28:41
22208374,88942,105447967,100,"???? same with `private[http]` here. This method is referenced in the subclasses, so I think package private is the tightest we can get. ",642139573,2017-03-11 01:37:48
22208374,439420,105450945,103,seems like you can drop this `val`,642139573,2017-03-11 01:52:12
22208374,439420,105450553,4,This diff seems un-necessary.,642139573,2017-03-11 01:50:23
22208374,7875,106047288,11,"there's no prefix call here, is that intentional? Seems like this was meant to test filter and prefix together?",643040986,2017-03-15 05:48:27
22208374,88942,106292200,11,"Yes, this was intentional. A side effect of reworking how contexts work meant the DSL now permits this syntax (which I think has its own use cases and gives users some more flexibility). Included the test here as an example / get coverage.",643040986,2017-03-16 04:52:41
22208374,7875,106295334,11,"@chrisbenincasa I'm not sure I understand. Users could always call `filter.filter.get` before and the route says it's ""appendMultiplePrefixed"" but there's no prefix call? So, at a minimum maybe the route needs to be changed as it's confusing?",643040986,2017-03-16 05:08:32
22208374,88942,106314401,11,"@cacoco apologies, I may have misunderstood your question. This _is_ within a prefix block. See [here](https://github.com/twitter/finatra/pull/393/files/d662153cf678cac709526ca0b388961ae9fddd04#diff-3ed2e8ed4110fe9e36488404995d1498R57). I stuck this along",643040986,2017-03-16 07:21:03
22208374,7875,106337538,11,"@chrisbenincasa Ah! I see. It's way above, got it. Thanks for the clarification.",643040986,2017-03-16 11:34:52
22208374,7875,107035320,34,Also private[http] and please add tests?,643040986,2017-03-21 05:44:22
22208374,7875,107035157,13,ffti: Function.const(Filter.identity),643040986,2017-03-21 05:43:17
22208374,7875,107035272,19,Also private[http] and please add tests?,643040986,2017-03-21 05:44:03
22208374,7875,107035220,16,"An explanation for why this is lazy would be good, considering the value stored in it is updatable.",643040986,2017-03-21 05:43:39
22208374,7875,107035133,8,Can you comment this class? It would really help.,643040986,2017-03-21 05:43:08
22208374,88942,107199990,16,"Absolutely. I made this lazy to protect against initialization order issues.

For instance, if we remove `lazy` from `contextRef`, Controller initialization will fail with a NPE. This is because we are evaluating the bottom of the ""hierarchy"" first. 
",643040986,2017-03-21 23:12:44
22208374,88942,107200175,8,Definitely. ,643040986,2017-03-21 23:13:26
22208374,88942,107200234,19,Will do. ,643040986,2017-03-21 23:13:37
22208374,7875,107220036,16,"@chrisbenincasa yes, please.",643040986,2017-03-22 00:24:28
22427550,1350674,106511871,13,"This looks right in the common case, but we need to add a few things to properly handle failures as perscribed by RFC 6902. For example, I think this is illegal:
```
{""op"": ""add"", ""path"": ""/list_of_bears/first_bear"", ""value"": ""brown""} // JSON Patch
{""l",646809159,2017-03-17 02:35:07
22427550,7605529,107741365,55,"Oh, it is a bug before, thank you so much for catch this!",650308047,2017-03-24 01:00:40
22427550,7605529,107742209,105,"feel free to ignore: since the helper function take operation names as a parameter, maybe we can integrate this one as well?  ",650308569,2017-03-24 01:03:44
22427550,649808,107866370,13,"The issues you raised should now be corrected.

See changes to the DoEverythingServerFeatureTest to see these cases explicitly tested.",646809159,2017-03-24 16:49:55
22427550,7605529,107531314,55,Can you give an example of which case will trigger this?,650308047,2017-03-23 04:02:07
22427550,7605529,107531881,14,How about link the RFC6901 as the reference here?,650308047,2017-03-23 04:04:35
22427550,7605529,107534665,31,"If it is possible, use a helper function like `checkIndexes` to do this job and just throws the exception if it fails will be great.  (same for the other methods)",650308047,2017-03-23 04:14:15
22427550,649808,107578744,14,"Good idea, is this what you meant?
https://github.com/twitter/finatra/pull/396/commits/98bec1732a0a60cad05b8991ef86ee4fbf4b9d1f",650308047,2017-03-23 09:53:08
22427550,649808,107578787,31,"I refactored the two common patterns into two functions, see
https://github.com/twitter/finatra/pull/396/commits/f84585e15c9ec6ad32c8f8c585ef32e97bf7a2bd",650308047,2017-03-23 09:53:40
22427550,649808,107579030,55,"I added a test case for this behaviour: https://github.com/twitter/finatra/pull/396/commits/25132724bff2ad99c2990e58f4f051baeeeaca58

In the test case `target = null` because `/animal_families` does not exist.

This does not have to do with arrays, if",650308047,2017-03-23 09:56:29
23246740,2240470,110516631,6,This sentence is basically from https://github.com/twitter/finatra/commit/807d22f5783b057341d4149,665476953,2017-04-08 18:32:38
24772025,132262,117814188,13,I think instead of trying to support both mockito1 and mockito2 we should instead only support one version and everyone else can use tools that don't mention mocking at all.,698807082,2017-05-23 01:28:31
24772025,132262,117812271,7,"overriding lazy vals makes me very, very nervous.  if we can avoid it, let's please avoid it.",698807082,2017-05-23 01:20:15
26208877,132262,125820390,4,"this isn't an API for setting, so this comment doesn't make that much sense.  maybe instead it's better to describe how `hostname` will be used?",730752267,2017-07-06 13:31:20
26208877,132262,125820322,5,do you mind adding this as an `@param` note to the scaladocs so that people can see it when they look at the api docs?,730752267,2017-07-06 13:30:47
26208877,132262,126539703,9,I don't think you need to explain what a Service is–maybe it would be more useful to explain that this should be the underlying finagle http client?,732233775,2017-07-11 04:18:20
26208877,132262,126540276,8,"how about instead of telling the client when to set it, it will be clearer to explain what happens when it's set or not?  as in,

""@param hostname the hostname that will be used for the Host header.  leave as default or set as """" to not set a Host heade",732233775,2017-07-11 04:21:03
26208877,132262,126540693,5,how about we remove this line?  I don't think overriding it is an expect API.  doesn't setting the parameter in `HttpClient` work for normal cases?,732233775,2017-07-11 04:22:53
26208877,205850,126542333,5,"Overriding this is how the parameter in `HttpClient` is set.

In (this example)[https://github.com/twitter/finatra/blob/develop/examples/twitter-clone/src/main/scala/finatra/quickstart/modules/FirebaseHttpClientModule.scala] `retryPolicy` is overridden ",732233775,2017-07-11 04:30:21
26208877,205850,126542686,8,"But the purpose of the PR is to warn people that if they don't set it, it might not work.",732233775,2017-07-11 04:32:18
26208877,132262,126551895,8,how about adding an `@note` message that mentions that some servers won't handle requests properly if they don't set the `hostname` correctly?,732233775,2017-07-11 05:21:22
26208877,132262,126552021,5,"ah, got it.",732233775,2017-07-11 05:22:13
38823997,1925,186300758,38,Add return type.,998864562,2018-05-07 02:40:24
38823997,1925,186301101,22,Should these vars be ```private[this]```?,998864562,2018-05-07 02:52:21
38823997,1925,186300987,41,Why do we need both retryPolicy and policy here? Policy could also be null here which could give you a Some(null).,998864562,2018-05-07 02:48:49
38823997,1925,186301066,83,This policy is masking the ```var policy``` instance variable.,998864562,2018-05-07 02:51:30
38823997,1925,186301229,94,Add newline.,998864562,2018-05-07 02:54:33
4483695,392373,16565323,28,"nit, put this ahead of the content headers",152903251,2014-08-22 01:09:40
4585503,238014,17684090,14,-1 as a sentinel for error fits in better with Apple's stream processing conventions.,157122268,2014-09-17 23:36:12
4585503,4374309,17703539,14,"Ok, fixed.",157122268,2014-09-18 05:48:29
5113214,244770,19682157,32,SPDYLogLevelWarning ?,179536169,2014-10-31 23:52:04
5113214,4374309,19687961,32,"I don't trust that it isn't over-utilized at the moment. Error level is what we had before non-DEBUG builds, so this keeps it consistent. Also, the app can now change it at runtime, so it matters less what value goes here.",179536169,2014-11-01 01:20:19
5287975,1236607,21268789,12,how did I miss this yesterday? Sorry about that,184347359,2014-12-04 04:59:49
5571087,1236607,21995944,31,strong is the default anyway,196104015,2014-12-18 02:15:19
5571087,1236607,21996546,176,prefix on the variable name?,196104015,2014-12-18 02:23:44
5571087,1236607,21996814,177,nit: might be better to name this bridged proxies or something else . NSProxy is actually a very different thing.,196104015,2014-12-18 02:27:04
5571087,1236607,22017756,55,"weird possibly unrelated question, why do all of these objects use public iVars instead of properties? Is this an optimization to avoid objc_message_send?",196104015,2014-12-18 07:59:22
5571087,4374309,22017987,55,"That's a question for @goaway but I'd guess yes, that's the reason. I'm just going for consistency here.",196104015,2014-12-18 08:04:54
5571087,4374309,22021297,177,"I agree, the names of these 2 intermediate vars are lacking, but I ran out of ideas and they have very small scope.",196104015,2014-12-18 09:51:53
5571087,1236607,22061333,177,"fair enough, I don't really feel that strongly about it",196104015,2014-12-19 01:43:14
5571087,238014,22070586,121,These are constants; it doesn't seem like an case insensitive compare should be necessary.,196104015,2014-12-19 03:57:32
5571087,238014,22071963,159,Is any other 2xx status other than specifically 200 a valid indication of a successful proxy connection?,196104015,2014-12-19 04:18:06
5571087,4374309,22072345,121,Fixed.,196104015,2014-12-19 04:23:05
5571087,4374309,22072646,159,"From https://www.ietf.org/rfc/rfc2817.txt:
   Any successful (2xx) response to a CONNECT request indicates that the
   proxy has established a connection to the requested host and port,
   and has switched to tunneling the current connection to that se",196104015,2014-12-19 04:27:07
5571087,4374309,22073204,204,"The ""Host:"" header should include the port as well, per examples at https://www.ietf.org/rfc/rfc2817.txt (and RFC2616) for a CONNECT message.",196104015,2014-12-19 04:35:08
5610280,1236607,22083208,19,"Sorry if this has been discussed previously, but why do we store strings for these values?",197114482,2014-12-19 07:42:41
5610280,4374309,22083500,19,"They used to be exposed via HTTP response headers, thus they had to be strings. We've kept them as such for consistency. It also makes the interface to the app a little bit easier to say ""all values are strings"" rather than documenting in a loose way the ",197114482,2014-12-19 07:48:52
6274723,238014,24928278,15,"Is this the right file for this enum? It seems like it might make more sense in SPDYMetadata.h

I'd also be fine with a restructuring/renaming of constant-related header files in general.",217788325,2015-02-19 01:49:09
6274723,4374309,24929491,15,"Agree all around, but this needs to be exposed externally so consumers of metadata can know what the number means. SPDYMetadata.h is not exposed externally. For this change, I could also put it in SPDYProtocol.h along with the metadata keys. I don't care ",217788325,2015-02-19 02:00:13
6274723,238014,24929945,76,"Looks like we don't use the returned value of this method anywhere. Also, given the places it's called I'd suggest a more generic name, e.g.:

- (void)_handleError:(NSError *)error",217788325,2015-02-19 02:04:46
6274723,238014,24945212,290,Is this only for testability? It's a bit funky having a private instance method that takes as an argument a private instance variable (especially given that that's the only correct possible value for the argument).,217788325,2015-02-19 05:00:29
6274723,238014,24945415,6,"return _statusCode == 407 && [_version hasPrefix:@""HTTP/1""];",217788325,2015-02-19 05:02:56
6274723,238014,24945783,14,For consistency let's continue to use the bool type internally and only use BOOL for public interfaces.,217788325,2015-02-19 05:07:30
6274723,4374309,24950152,290,"It was, yes, but it turns out not to be needed. Will revert.",217788325,2015-02-19 06:03:21
6274723,238014,24952287,4,"What happens if there's a connect timeout while waiting on a PAC response? Could that cause the delegate to fail to be notified and the socket/session to enter a ""zombie"" state?",217788325,2015-02-19 06:32:07
6274723,4374309,24960172,4,"Great catch. The timeout would fail to notify the delegate, but the PAC response would still complete. This would trigger a connect, effectively voiding the timeout. I've fixed this now and added some unit tests for this case. Thanks.",217788325,2015-02-19 08:43:35
7224790,1236607,28921688,53,what are you doing here with this? ,248254639,2015-04-23 03:37:39
7224790,4374309,28924531,53,"It's a bit over-exuberant, but the point of the test is: create a request with all reference config properties set, copy it, release the original request, then verify all the references in the copy are still valid and still point to the original objects. ",248254639,2015-04-23 04:25:59
7224790,1236607,28928057,53,"I was specifically referring to the autoreleasepool, it doesn't seem like the complier would general any autorelease calls simply because you set these variables to nil.",248254639,2015-04-23 05:36:48
7224790,4374309,28938057,53,You're right. Good catch. I have no excuse; at least the brain fart was in test code. I'll fix it to do what I intended.,248254639,2015-04-23 10:58:36
7224790,1236607,28980031,53,it certainly doesn't hurt anything :),248254639,2015-04-23 21:42:06
7224790,1236607,28981171,89,you still need to call objc_setAssociatedObject with the nil object in this condition as well. Otherwise the runtime will continue to hold onto the previous object until a new non-nil object is set for this key.,248254639,2015-04-23 21:55:21
7224790,1236607,28981645,92,Are you sure retain is the right association here?,248254639,2015-04-23 22:00:39
7224790,1236607,28981847,89,"I take it back, I see what you're doing here",248254639,2015-04-23 22:03:11
7224790,1236607,28981992,89,I guess a better question is why are you indirectly storing this?,248254639,2015-04-23 22:04:58
7224790,4374309,28993070,89,"If you store any non-serializable object -- e.g. a reference -- then try to store the NSURLRequest in the NSURLCache, the system spews a runtime warning about ""unable to serialize object"" (sorry, don't have the exact wording handy). We're trying to avoid ",248254639,2015-04-24 00:05:19
7224790,2011749,28993788,14,"Based on talking with Kevin, I'm think we need this to be a weak reference",248254639,2015-04-24 00:13:20
7224790,2011749,28994002,92,"Yes.
Session owns the Task
Task owns the Request
Request owns the Session

On task complete:
Session will release the Task
Which (if it deallocs) will release the Request
Which (if it deallocs) will release the Session

So the key is the task, n",248254639,2015-04-24 00:15:38
7224790,1236607,28994508,89,Fair enough +1,248254639,2015-04-24 00:21:37
7224790,4374309,29017510,14,Agreed.,248254639,2015-04-24 06:09:42
7224790,4374309,29017503,92,"After consideration, I agree. Will make that reference weak.",248254639,2015-04-24 06:09:34
7224790,4374309,29017697,32,"I'm still pondering the implications of exposing an instance of SPDYProtocol to the app. I'm wondering if we shouldn't make a new object to return, like SPDYRequest or SPDYInstance or something, that strictly contains only what the app needs. SPDYProtocol",248254639,2015-04-24 06:15:01
7224790,2011749,29021894,32,"Honestly, I've been considering this too.  I think we'd be better providing a separate object via a protocol.

```
- (void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didStartLoadingRequest:(NSURLRequest *)request withSPDYProtocolC",248254639,2015-04-24 08:37:46
7731703,2011749,31194489,7,"Generally, with linked lists...you want a weak ref to the previous node and a strong ref to the next node.  That way when the head node is released it will cascade down.  Otherwise, you need some additional container for maintaining references.",263502542,2015-05-28 05:33:44
7731703,2011749,31194575,7,"I guess it looks like you do maintain a separate dictionary (actually 2 dictionaries) for holding onto the nodes.  That's fine, but you've coupled your Node's to requiring that and just holding onto head is not enough to keep a chain alive...I still think",263502542,2015-05-28 05:35:51
7731703,4374309,31195912,7,Your suggestion seems like a good pattern even though it isn't strictly necessary for this data structure.,263502542,2015-05-28 06:07:35
8296956,2011749,36369284,23,"if you use MAX and MIN, the macro will base the comparison on the types of the values (aka, as doubles), but being explicit with fmax/fmin is fine too",278929165,2015-08-06 04:59:28
8296956,2011749,36369406,35,Can you give me some color one what this change does?,278929165,2015-08-06 05:00:57
8296956,2011749,36369489,82,"did you mean ""no session was ever healthy""?",278929165,2015-08-06 05:02:00
8296956,4374309,36369599,35,"This was a major bug I discussed in this commit's message. I'll just paste it here. :) Basically, if we hit that ""continue"" line (204) just below, we could get into a near infinite loop since the pool size was never increasing.

    There was a major bu",278929165,2015-08-06 05:03:52
8296956,4374309,36369696,23,"Good to know. My experience with the MIN and MAX macros in a past life is that they'll double evaluate, which is often very bad (though not here), so I just avoid them in general.",278929165,2015-08-06 05:06:00
8296956,2011749,36369697,131,wait... there will always be an error now?,278929165,2015-08-06 05:06:03
8296956,4374309,36369802,82,"yes. :) will fix later, github pull requests are too cumbersome for just that.",278929165,2015-08-06 05:08:03
8296956,4374309,36370080,131,"yup. as there should be. all callers of streamError are expecting an actual error to get returned, and in some cases even end up asserting so (_handleError to _closeWithError).",278929165,2015-08-06 05:11:59
9619328,2011749,41177773,13,Don't need this anymore?,318284603,2015-10-05 23:15:52
9619328,2011749,41177988,6,"no longer aligned on "":""",318284603,2015-10-05 23:17:42
9619328,2011749,41178022,6,no longer aligned,318284603,2015-10-05 23:18:02
9619328,2011749,41178008,6,no longer aligned,318284603,2015-10-05 23:17:54
9710786,2011749,41294508,47,"how do you know the header field will be lower case?  In my experience Apple has a set of fields that it automatically coerces to be camel case (which could change over time).

I think it might be better to enumerate the fields at the top in one loop an",322502828,2015-10-06 22:24:04
9710786,2011749,41294602,59,ditto for request,322502828,2015-10-06 22:24:36
11014802,3214,47448987,57,Do we need this init override?,359105114,2015-12-14 03:39:45
11014802,3214,47449380,27,"`strptime(3)` doesn't initialize `struct tm`, should be clear before using it, or, some of value may be undefined.
`strptime(3)` using current system locale, which is unknown. must be `strptime_l(3)` ?",359105114,2015-12-14 04:06:57
11014802,3214,47449471,51,"This is not right parsing. by RFC definition, `Cache-Control` is defined like

>    Cache-Control   = 1#cache-directive
>    cache-directive = token [ ""="" ( token / quoted-string ) ]

and `quoted-string` can contains `=`. We must like concatenating `",359105114,2015-12-14 04:13:11
11014802,3214,47449543,191,Add a new line?,359105114,2015-12-14 04:18:41
11014802,4374309,47580160,57,Nope. :) Leftover.,359105114,2015-12-15 08:15:10
11014802,4374309,47581600,27,Done.,359105114,2015-12-15 08:32:41
17826074,2011749,82916437,18,"so, we have to have created the runloop source first it looks like... OK",531262247,2016-10-12 07:22:41
17826074,2011749,82916459,36,this both removes and clears the source... OK,531262247,2016-10-12 07:22:54
17826074,2011749,82916364,32,which is the one that won't fire when user is applying touch events?  I think that is DefaultMode...  Which means you should be good.,531262247,2016-10-12 07:21:49
7260955,3636823,29085967,82,I wonder if this will get optimized away?  Perhaps we should do something in here...`BlackHole` or something?,249207152,2015-04-25 02:07:27
7260955,3664876,29086263,82,Done.,249207152,2015-04-25 02:11:42
7260955,6174876,29266602,67,@nmittler nit: it should be enough to consume just one i.e. the boolean?,250377061,2015-04-28 22:29:38
7260955,6174876,29267090,57,@nmittler nit: return the `outputStream` to make sure that computations can't be deleted by the compiler?,250377061,2015-04-28 22:34:21
7260955,3664876,29268968,67,done.,250377061,2015-04-28 22:53:14
7260955,3664876,29269052,57,done.,250377061,2015-04-28 22:53:55
7260955,3636823,29276454,116,Initialize size to `HeadersSize.values()`?,250695980,2015-04-28 23:59:43
7260955,3636823,29276820,63,"Maybe have 2 loops based upon this condition?  We don't need the conditional overhead in each loop iteration to be part of the `benchmark`, and `duplicates` shouldn't be changing in the benchmark.",250695980,2015-04-29 00:03:14
7260955,3664876,29277843,116,done.,250695980,2015-04-29 00:13:21
7260955,3664876,29279470,63,done.,250695980,2015-04-29 00:30:51
7260955,3664876,29284441,16,"@jpinner oof, good catch! I've replaced `com.twitter.hpack.microbench` with `com/twitter/hpack/microbench`.",250707306,2015-04-29 01:26:35
7260955,392373,29284754,16,"does it also need to be moved under src/test like in netty?

On Tue, Apr 28, 2015 at 1:26 PM, Nathan Mittler <notifications@github.com>
wrote:

> In
> microbench/main/java/com.twitter.hpack.microbench/AbstractMicrobenchmarkBase.java
> <https://github.com/",250707306,2015-04-29 01:29:10
7260955,3664876,29285752,16,"Actually, Netty has it under `src/main`: https://github.com/netty/netty/tree/master/microbench/src",250707306,2015-04-29 01:38:07
7260955,392373,29286050,16,"so we need to move it under ""src"" still?

On Tue, Apr 28, 2015 at 1:38 PM, Nathan Mittler <notifications@github.com>
wrote:

> In
> microbench/main/java/com.twitter.hpack.microbench/AbstractMicrobenchmarkBase.java
> <https://github.com/twitter/hpack/pull/",250707306,2015-04-29 01:40:51
7260955,3664876,29286899,16,Ah missed that ... done.,250707306,2015-04-29 01:49:04
7260955,392373,29283113,16,"is there a reason these files don't follow the maven directory hierarchy?

the netty version uses the src/test/java/pacakge-name.../microbench directory structure",250707306,2015-04-29 01:12:39
7260955,3636823,29295744,60,"@nmittler - Is this number significant, or is it just `1 << 20` which is assumed to be big enough?  Maybe add a comment?",250731631,2015-04-29 03:36:47
7260955,3636823,29295822,73,"This looks like the same number from https://github.com/twitter/hpack/pull/24/files#r29295744.  Any relationship, worth adding a comment or a shared `static final`?",250731631,2015-04-29 03:38:04
7260955,3664876,29342456,73,Added construction of the output stream to the size enum.,250731631,2015-04-29 19:45:36
7260955,3664876,29342476,60,See previous reply.,250731631,2015-04-29 19:45:46
7260955,392373,29364370,7,let's update this to 0.11.0-SNAPSHOT,251257731,2015-04-29 23:19:07
7260955,392373,29364383,7,same,251257731,2015-04-29 23:19:19
7260955,392373,29364506,29,nit: java first (I'll try to get checkstyle running on this repo at some point),251257731,2015-04-29 23:20:32
7260955,392373,29364603,6,0.11.0-SNAPSHOT,251257731,2015-04-29 23:21:28
7260955,392373,29364655,51,while you're here: 2.3.1,251257731,2015-04-29 23:21:58
7260955,392373,29364669,57,while you're here: 4.12,251257731,2015-04-29 23:22:06
7260955,3636823,29364973,24,Enum is private but all methods are package protected.  Should we just make class package protected and methods public?,251257731,2015-04-29 23:24:56
7260955,392373,29364574,18,nit: no globs,251257731,2015-04-29 23:21:10
7260955,392373,29364584,2,2015,251257731,2015-04-29 23:21:18
7260955,3636823,29365039,29,Should these be private?,251257731,2015-04-29 23:25:28
7260955,3664876,29384715,7,done.,251257731,2015-04-30 02:47:56
7260955,3664876,29384735,7,done.,251257731,2015-04-30 02:48:02
7260955,3664876,29384838,18,done.,251257731,2015-04-30 02:48:43
7260955,3664876,29385049,29,done.,251257731,2015-04-30 02:51:01
7260955,3664876,29385041,24,It has to be public for use with JMH.  I can make the methods public for consistency.,251257731,2015-04-30 02:50:56
7260955,3664876,29385091,6,done.,251257731,2015-04-30 02:51:34
7260955,3664876,29385079,2,done.,251257731,2015-04-30 02:51:24
7260955,3664876,29385141,57,done.,251257731,2015-04-30 02:52:12
7260955,3664876,29385137,51,done.,251257731,2015-04-30 02:52:09
7260955,3664876,29385276,29,done.,251257731,2015-04-30 02:53:37
7260955,3636823,29386082,24,I see. Yah just make the methods public too I guess.,251257731,2015-04-30 03:03:34
10111231,392373,43213843,20,value annotation here would be null,337492111,2015-10-28 08:50:28
10111231,392373,43213855,34,same,337492111,2015-10-28 08:50:39
10111231,392373,43213909,28,would prefer to allow the callee to set cacheable representations for both name and value,337492111,2015-10-28 08:52:04
10111231,392373,43213929,67,would prefer not to hardcode this here and instead allow caller to pass a cached representation from addHeader(),337492111,2015-10-28 08:52:36
10111231,392373,43214056,24,would prefer to have called context initialize cached values dynamically during addHeader(),337492111,2015-10-28 08:55:53
10111231,6773014,43295160,20,Will tidy these up. Any objection to using factory methods on HeaderField to make the construction use-cases clearer?,337492111,2015-10-29 00:08:39
10111231,6773014,43295478,28,"That would have a broader impact on the listener interface pattern as the receiver would either

a) Return some kind of structured pair
b) Receive a slot that they could set values into 

preferences?",337492111,2015-10-29 00:10:59
10111231,6773014,43295606,67,Seems reasonable. See note above about listener interface adjustment.  ,337492111,2015-10-29 00:11:47
10111231,6773014,43295680,28,I'll implement some form of (b) to see how it feels. For entries in the static table I assume we should still use Strings as the bound type for name,337492111,2015-10-29 00:12:28
10111231,6773014,43295743,24,Even for things in the static table?,337492111,2015-10-29 00:13:01
10111231,6773014,43315167,34,done,337492111,2015-10-29 02:45:21
10111231,392373,43319502,28,"Yeah, i think the best thing to do is something like:
```
public void addHeader(byte[] name,byte[] value, boolean sensitive,
                      AtomicReference<Object> nameAnnotation, AtomicReference<Object> valueAnnotation)
```",337492111,2015-10-29 03:17:55
10111231,392373,43535165,27,"let's just change the API for ""HeaderListener"" instead of adding this complexity.

bump the version in the README.md example pom dependency to 1.1.0 and modify the example to include the annotations array with some commented out code about caching a par",338022480,2015-10-31 00:17:36
10111231,392373,43535834,84,probably need to always create a new array whenever we pass it to the consumer -- otherwise they could store the value and later mutate multiple header entries,338022480,2015-10-31 00:23:00
10111231,17050,78618939,84,"Opinion from typical user of this lib (hope that's useful): We're looking into re-using this Decoder in Akka, we'd love to keep the decoder allocation-free (so have it re-use arrays) as we can guarantee we won't modify the arrays. ",338022480,2016-09-14 01:39:14
4215929,8931,15678579,4,I’m not happy about hardcoding this.,144155904,2014-08-01 05:53:20
4215929,8931,15678921,28,Wut?,144155904,2014-08-01 06:05:36
3678186,6258,12723488,110,"btw, what is the `declaration.name` guarding against?
",110954926,2014-05-16 07:52:00
3678186,162476,12762425,110,Almost positive `declaration.name` can be removed.,110954926,2014-05-17 03:36:00
8291752,3273730,36338303,6,"nit: the first sentence is in imperative mood; the second is in indicative.  Should be ""Update""",278887649,2015-08-05 23:41:49
8291752,3273730,36338382,14,"nit: style for this repo is"" spaces around operators",278887649,2015-08-05 23:42:21
8291752,3273730,36338655,92,nit: four spaces,278887649,2015-08-05 23:44:27
8291752,3273730,36339571,21,"We need to make a copy of timeout here:
""On Linux, select() modifies timeout to reflect the amount of time not slept; most other implementations do not do this.  (POSIX.1-2001 permits either behavior.)""",278887649,2015-08-05 23:51:36
8291752,3273730,36339721,130,"this value for select means ""return immediately"", rather than ""block indefinitely"" (a NULL timeout).  Is that what you mean?",278887649,2015-08-05 23:52:44
8291752,1393975,36340356,130,Yeah that would preserve previous behavior.,278887649,2015-08-05 23:58:25
8291752,3273730,36340531,130,Seems like previous behavior is pretty broken?,278887649,2015-08-05 23:59:53
8291752,1393975,36343207,6,Sorry I don't follow.  Are you saying swap the two sentences?,278887649,2015-08-06 00:24:02
8291752,3273730,36343527,6,"No, I'm saying ""s/Updates/Update/"".  (or s/Call/Calls/)",278887649,2015-08-06 00:26:27
13679711,3273730,58942933,1,comment here explaining what bser is with a link,420816481,2016-04-08 03:52:41
13679711,3273730,58943151,15,document here that string is *not* duplicated and that it is permitted to contain \0s.,420816481,2016-04-08 03:53:58
13679711,3273730,58943401,82,This does not actually do what the name says it will do; it will free the array's elements but not the array itself.  ,420816481,2016-04-08 03:55:20
13679711,3273730,58943452,88,ditto (see note on bser_free_array),420816481,2016-04-08 03:55:39
13679711,3273730,58943611,104,This should probably allow embedded \0s (use malloc/memcpy instead of strndup).,420816481,2016-04-08 03:56:39
13679711,3273730,58943712,107,it's less obvious what this one should do about embedded 0s.,420816481,2016-04-08 03:57:17
13679711,3273730,58943908,111,remove - '\0'.,420816481,2016-04-08 03:58:29
13679711,3273730,58945299,111,"and actually, if chars are signed (which, on my machine, they are) and match[bser->value.string.length] < 0 (that is >127), this will return a negative number instead of a positive one.  So you probably need some casting.",420816481,2016-04-08 04:07:28
13679711,3273730,58945396,8,style nit: the { goes on the next line for fn declarations. ,420816481,2016-04-08 04:08:04
13679711,3273730,58945582,115,maybe some of these funcs should have asserts that bser has the correct tags?,420816481,2016-04-08 04:09:07
13679711,3273730,58945776,119,maybe only parse this value if the key matches?,420816481,2016-04-08 04:10:28
13679711,3273730,58946071,136,s/passed/parsed/,420816481,2016-04-08 04:12:27
13679711,3273730,58947999,94,(ditto),420816481,2016-04-08 04:25:50
13679711,3273730,58948217,23,don't put these in the header -- the compiler should be smart enough to inline them even if they're in the c file.,420816481,2016-04-08 04:27:26
13679711,3273730,58948444,32,prefer sizeof(*fields) to explicitly listing the type in sizeof.,420816481,2016-04-08 04:29:10
13679711,3273730,58949863,1,nit: remove blank line,420816481,2016-04-08 04:39:34
13679711,3273730,58950346,44,no need to cast the result of malloc -- it's a void* which can be assigned to anything.,420816481,2016-04-08 04:43:11
13679711,3273730,58950728,51,a little confused about how bser_parse returns the result of bser_new_unparsed -- is that really right?,420816481,2016-04-08 04:45:58
13679711,3273730,58953555,114,some notes somewhere on the lazy parsing scheme would be useful,420816481,2016-04-08 05:08:19
13679711,3273730,58953652,179,\>= ?,420816481,2016-04-08 05:09:05
13679711,3273730,58955279,44,also you have bser_alloc() for these,420816481,2016-04-08 05:22:50
13679711,3273730,58955344,66,bser_alloc(void),420816481,2016-04-08 05:23:24
13679711,3273730,58956307,12,"why is this not const void *buffer or const char *buffer?

void* would avoid casting",420816481,2016-04-08 05:31:47
13679711,3273730,58957670,1,"overall, I really like these tests.  Quite thorough.",420816481,2016-04-08 05:45:11
13679711,3273730,58957576,1,"wait, a double should be able to go out to 3.141592653589793 -- are we losing precision here?",420816481,2016-04-08 05:44:16
13679711,3273730,58958131,17,Let's keep git-specific stuff out of here -- change these var names to LIBWATCHMAN_ (even though that's a bit annoying).,420816481,2016-04-08 05:49:23
13679711,3273730,58958349,117,so bser just leaks?,420816481,2016-04-08 05:50:43
13679711,3273730,58958463,407,would it be possible to do two commits: one to virtualize json_-> proto_ and a second to add bser?  I think that might make this easier to read.,420816481,2016-04-08 05:52:03
13679711,3273730,58955061,300,you can move this (and the corresponding free()) inside the if.,420816481,2016-04-08 05:21:06
13679711,3273730,58956241,316,... but streams don't support reads?,420816481,2016-04-08 05:31:02
13809682,1832918,59463481,8,indent,424276976,2016-04-13 05:13:32
13809682,3273730,59464419,8,"fixed, thanks",424276976,2016-04-13 05:21:35
13970782,3273730,60296560,39,__attribute__((warn_unused_result)) ?,429345998,2016-04-20 02:37:08
13970782,3273730,60296657,56,+ more instances below,429345998,2016-04-20 02:37:50
13970782,3273730,60297791,74,nit: indentation,429710377,2016-04-20 02:45:17
13970782,3273730,60296518,56,should be return new_error?,429345998,2016-04-20 02:36:51
13970782,1832918,60340393,56,"Yes, that should have been a return new_error().  But instead I changed it to a void method (the return value was unused in the only place it was called).  new_error() fills in the passed struct, so the other uses are correct.",429345998,2016-04-20 08:48:15
13970782,1832918,60340619,39,"Nah, in many cases it's perfectly fine to use new_error (or new_unparsed) only for its side-effect of filling in the 'fill' struct, but ignoring the return value.",429345998,2016-04-20 08:51:59
13970782,1832918,60454938,56,"I updated the commit, but it seems to still displaying the old content here.  Take a look at this function (new_compact_object) here: https://github.com/twitter/libwatchman/pull/16/commits/0671f0ff8b568fede7733299fea0ff2439da6263",429345998,2016-04-21 00:46:13
13970782,1832918,60455088,56,"Oh, nevermind, I see what you were saying now.  I'll fix this.",429345998,2016-04-21 00:47:02
13970782,3273730,60461083,120,should be int64_t not uint64_t.,430588688,2016-04-21 01:20:36
13970782,3273730,60461253,88,Should be int64_t? ,430588688,2016-04-21 01:21:32
13970782,1832918,60462915,88,"Yes, and I added a clause to check for a non-positive size, too.",430588688,2016-04-21 01:31:22
13970782,1832918,60462852,120,"Yes, will fix.",430588688,2016-04-21 01:30:54
13970782,3273730,60468121,16,?,430588982,2016-04-21 02:01:21
13970782,3273730,60468425,141,"Is it really safe to free here?  That is, do we only ever have one reference to an object? It's probably worth at least calling this out in a comment.",430588982,2016-04-21 02:03:08
13970782,3273730,60470034,251,"wait, what if match is shorter than bser->value.string.length?",430588982,2016-04-21 02:13:58
13970782,3273730,60470169,279,assert index < bser->value.array.length ?,430588982,2016-04-21 02:14:54
13970782,3273730,60473044,336,nit: newline before {,430588982,2016-04-21 02:33:29
13970782,3273730,60474899,1,"""signed"" is a funny name for this value.  I mean, yes, it has some sign, but...",430588982,2016-04-21 02:46:35
13970782,3273730,60452259,56,But you still need to return here because otherwise you're going to write to a NULL pointer.,429345998,2016-04-21 00:30:11
13970782,1832918,60588874,141,"I'll change the name to 'proto_free()' and add a note that the json is only decref'd.  In all the places we use this in watchman.c, there's only one ref to the object.",430588982,2016-04-21 21:23:21
13970782,1832918,60593746,251,"Well, memcmp will return the right value, as there will be a \0 in position match[strlen(match)].  However, memcmp() may read beyond the end of the string.  I'll address this.",430588982,2016-04-21 21:49:23
13970782,1832918,60597287,279,Yep.,430588982,2016-04-21 22:06:51
13970782,1832918,60600918,1,"I'll change it to int_small_signbit, as it's an edge case test on bit 0x80.",430588982,2016-04-21 22:24:09
14190161,1832918,61012338,39,"Can't tell which on this, but one of these lines is mis-indented by one space.",433637378,2016-04-26 07:18:51
14190161,1832918,61012549,75,nit: indent,433637378,2016-04-26 07:21:27
14190161,1832918,61012694,55,size_t instead of int?,433637378,2016-04-26 07:23:07
14190161,1832918,61012857,133,"remove newline
",433637378,2016-04-26 07:25:16
14190161,1832918,61013203,11,"Other than a the few nits pointed out, this looks fine to me. Ship it!",433637378,2016-04-26 07:29:56
4189132,75290,15139021,23,"see sparse checkouts? http://jasonkarns.com/blog/subdirectory-checkouts-with-git-sparse-checkout/

maybe a TODO",139345499,2014-07-19 04:25:30
4189132,75290,15139047,34,"we almost certainly only want the public protos, ie the ones in include/",139345499,2014-07-19 04:26:30
4189132,926635,15141614,23,This looks like that the support would have to be on the asf git repo.,139345499,2014-07-19 08:03:12
4189132,926635,15141626,34,"Unfortunately, messages.proto is not within include/...

Once the asf repo is fixed up to publish public .proto files in a common location, a lot of this could be cleaned up.",139345499,2014-07-19 08:05:32
4203765,75290,15184394,29,it seems unwise to pull these out when they're already defined in the protos. i'd rather not have to deal with a second mapping that could get out of date.,139823963,2014-07-21 22:59:05
4203765,75290,15184487,70,why do we need something that locks here? why not just use channels to pass tasks?,139823963,2014-07-21 23:00:33
4203765,75290,15184507,158,*user?,139823963,2014-07-21 23:00:52
4203765,75290,15184533,180,for testing only?,139823963,2014-07-21 23:01:17
4203765,75290,15184592,49,what's the benefit of having multiple masters if we always send to the first one?,139823963,2014-07-21 23:02:37
4203765,75290,15184655,13,i'm not sure i understand the benefit of making this call asynchronous.,139823963,2014-07-21 23:03:42
4203765,75290,15184919,20,"using a waitgroup here will be fine, rather than having a health endpoint that may change in the future.",139823963,2014-07-21 23:07:31
4203765,75290,15184976,34,"nit: s/Unexpected/unexpected.

also, maybe add that we're in 'waiting for registration' state when we get the unexpected event.",139823963,2014-07-21 23:08:35
4203765,926635,15206171,49,TODO(weingart): Add code to handle disconnects and master discovery.,139823963,2014-07-22 05:57:56
4203765,926635,15206190,13,"As there is a goroutine handling all interaction with the MesosMaster instance, communicating via channel means no mutex/etc.",139823963,2014-07-22 05:58:59
4203765,926635,15206206,20,Why change?  This endpoint is just for the interaction from the master to this framework.,139823963,2014-07-22 05:59:38
4203765,926635,15206245,180,"For right now, yes.  gozerctl needs to be written, to do a ""gozerctl launch /bin/true"" :)",139823963,2014-07-22 06:01:13
4203765,926635,15206291,158,"Whoops, fixed.",139823963,2014-07-22 06:02:23
4203765,926635,15206330,70,"I was implementing a stupid simple task store framework side (IE: ""within gozer"").  In the real world, either a DB, or some replicated state/storage would take the place of this.  I'm basically protecting against the web/http side doing things at the same",139823963,2014-07-22 06:04:26
4203765,926635,15206367,29,"Hmm... true, except that I'm not sure how to capture the concept of ""WAITING TO GET A KICK AT THE CAT"" for a process that has not been birthed yet within the mesos side of the framework.",139823963,2014-07-22 06:05:47
4203765,75290,15244262,56,"this shouldn't be exposed. the Task here is supposed to be the externally facing task description. As such, having Id, State and MesosTask doesn't work. There should be a separate struct (internal) that manages the rest of the metadata.",140331643,2014-07-22 22:56:26
4203765,75290,15244274,29,i don't know what that means or why you need to care.,139823963,2014-07-22 22:56:36
4203765,75290,15244317,70,"ok - this is fine for now then, but maybe abstract it out into a task_store.go file?",139823963,2014-07-22 22:57:06
4203765,75290,15244350,159,can we delay the slice until the driver side supports multiple masters? right now it's adding complexity with no benefit.,140331643,2014-07-22 22:57:36
4203765,75290,15244499,180,"curl -X POST -d '{ Command: ""/bin/true"" }' -H ""Content-Type: application/json"" localhost:<api_port> 

no need for this code .. please remove it for cleanliness.",139823963,2014-07-22 22:59:17
4203765,75290,15244559,203,"see my patch for how i handle this. essentially, i set up two go routines( one for offers one for updates, though this could be a multiselect) and call driver run synchronously instead of as a goroutine.",140331643,2014-07-22 23:00:09
4203765,75290,15244634,13,why does this take the MesosMaster when you can just use 'm' from outside scope?,139823963,2014-07-22 23:01:21
4203765,75290,15244680,28,always push the offer for now - let the framework send the ack. see my pull request.,140331643,2014-07-22 23:02:01
4203765,75290,15244742,27,maybe delay the health endpoint stuff for another pull request - it's adding complexity for no reason.,140331643,2014-07-22 23:02:52
4203765,75290,15244773,185,add Updates,140331643,2014-07-22 23:03:15
4203765,75290,15250329,13,what's the point of this state transition? what will heartbeat do in future that it doesn't do now?,140331643,2014-07-23 00:31:45
4203765,75290,15250377,40,s/Registered/registered,140331643,2014-07-23 00:32:48
4203765,926635,15266867,29,"How does gozer (as a framework/scheduler) identify the time during which a user says ""launch this task for me"", and the time it has received an offer from the mesos master?",139823963,2014-07-23 06:11:18
4203765,926635,15266875,70,Sounds good.,139823963,2014-07-23 06:11:41
4203765,926635,15270320,180,Done.,139823963,2014-07-23 09:07:02
4203765,75290,15369700,13,"maybe specify ""API HTTP endpoint"" as opposed to the framework's endpoint?",140804885,2014-07-25 01:15:41
4203765,75290,15369751,29,i don't think gozer needs to. other frameworks might but i want to keep gozer as simple as possible as an example.,139823963,2014-07-25 01:16:23
4203765,75290,15369799,21,"per go style, all errors should start with lower case.",140804885,2014-07-25 01:17:03
4203765,75290,15369908,54,nit: consider setting capacity to len(t.Tasks),140804885,2014-07-25 01:18:36
4203765,75290,15369993,40,maybe MesosMaster.send can fill in the FrameworkInfo to minimise the work that each of these call wrappers needs to do?,140804885,2014-07-25 01:19:49
4203765,75290,15370122,15,private uuid please,140804885,2014-07-25 01:21:32
4203765,75290,15370137,28,nit: remove blank line,140804885,2014-07-25 01:21:52
4203765,75290,15370202,8,s/Location/Address?,140804885,2014-07-25 01:23:06
4203765,926635,15381636,21,You have a pointer to this?,140804885,2014-07-25 05:47:23
4208172,926635,15156951,35,"AFAICT, this is still racey.",140012091,2014-07-21 12:19:15
4208172,926635,15156972,38,"Basically, you're racing the waitgroup and the registration with the master.  While this race is very small, it is still there.

I solved this by introducing a state machine for the mesos subsystem, where the subsystem is not ready until this endpoint i",140012091,2014-07-21 12:21:03
4208172,926635,15384166,5,These should likely be pointer receiver.,140968867,2014-07-25 07:34:54
4208172,926635,15384170,44,Ditto,140968867,2014-07-25 07:35:07
4274599,926635,15505152,34,Does it make sense to use TaskState_INIT.String() and company here?,142848754,2014-07-29 09:11:52
4274599,926635,15505200,58,"Sorry, I meant here.  Does it make sense to use a map[string]TaskState and map by using the String() of the mesos.TaskState to map the driver's task state?",142848754,2014-07-29 09:14:46
4274599,75290,15532953,58,What do you expect the benefit to be? Will it avoid the mesos_pb import?,142848754,2014-07-29 21:03:37
4281981,926635,15562469,4,"Add this to driver ""naked""?",143159262,2014-07-30 06:07:22
4281981,926635,15562531,18,"This is raceable.  I think not having this function, but be able to pass in the loggers with a config for ""NewDriver()"", and having a sensible default set of loggers (using the default logger if they're all nil) might be less raceable.",143159262,2014-07-30 06:09:47
4315548,926635,16023982,45,I really dislike the change in pointer vs. non pointer.  Let's stick to one (ptr please) and use visibility to gate the ability to change things or not.,144524980,2014-08-09 08:12:02
4345122,926635,15853291,6,"Instead of marshaling to a string/byte, create a new marshaler, and marshal directly to the iowriter.",145789321,2014-08-06 07:19:10
4395066,926635,16154083,7,unnecessary comment,148669869,2014-08-13 06:51:38
4395066,926635,16154096,20,Ditto.,148669869,2014-08-13 06:52:00
4395066,926635,16154143,5,I think this should be in stateStop(),148669869,2014-08-13 06:53:37
4395066,926635,16154147,5,This should not be here.,148669869,2014-08-13 06:53:52
4395066,926635,16154169,8,"This is the state that should close channels/etc.  Then it returns nil, which will end that state machine, which will then exit the go routine.",148669869,2014-08-13 06:54:49
4395066,75290,16189356,5,there might be other states that return nil (maybe error could directly for instance) so i put it at the end of the state loop in Run instead.,148669869,2014-08-13 22:05:59
4395066,926635,16216158,5,"Nothing else should return nil.  As in that is reserved for the stateStop() to signal finish and exit of go routine.  Error should do whatever mitigation it can, and if it can't continue, then it shoudl return stateStop().",148669869,2014-08-14 05:43:01
4395066,926635,16216884,5,These really do belong a few lines further down.  :),149410921,2014-08-14 06:09:36
4395066,926635,16217057,19,"This should likely go to stateRegister.  There is currently nothing that closes the event channel (or I'm blind?), possibly send() can close the events channel on error to indicate that a re-registration should be triggered?",149410921,2014-08-14 06:15:49
4395066,75290,16323526,5,that assumes that every halting state goes through stateStop. That's a reasonable assumption but can easily be broken accidentally. Having the close here retains the contract that the channels will close when the driver is done.,149410921,2014-08-16 11:58:37
4395066,75290,16323531,19,the event channel is closed by the state machine exiting only. I added this here so that if we want to do things like reregister we can do it using the closed channels while in state ready as you suggest. i'd rather add that in a followup.,149410921,2014-08-16 11:59:59
4395066,926635,16331201,19,"In that case, add another state, other than stop.  We use states to open/enable/etc channels, I think we should use them to tear things down, and keep the state machine driver as clean/lean as possible.

Easy enough to re-factor in the next step.  #ship",149410921,2014-08-17 23:35:51
4395066,926635,16331210,5,Hmm... different way of looking at it.  I do worry about the state driver getting more and more complicated though.  Time will tell.,149410921,2014-08-17 23:37:06
4539240,926635,20406570,16,"Should this be written without a newline at the start?
       rootHTML = `<!DOCTYPE html>
<html>
...
",155320615,2014-11-16 08:51:49
4778107,146404,19848119,12,Not a big deal but it'd be nice to avoid the feature warning the postfix operator here will cause.,167438372,2014-11-05 07:38:06
4838932,164018,19480990,90,how is the return type of the macro declared used compared to the actual type of the expression generated by the macro?,161706270,2014-10-28 22:00:35
4838932,164018,19481100,5,"is there a way to put those in the pattern itself? I could not figure it out and resorted to use the ""if"" clause.",161706270,2014-10-28 22:01:50
4838932,164018,19481162,35,in which case does ArrowAssoc apply?,161706270,2014-10-28 22:02:41
4838932,164018,19481437,13,does this compile with 2.10?,161706270,2014-10-28 22:06:26
4838932,146404,19481772,35,"This is a 2.10 vs. 2.11 issue—`ArrowAssoc` is now an implicit class, so `any2ArrowAssoc` is no longer necessary (and doesn't exist).",161706270,2014-10-28 22:10:20
4838932,146404,19482324,5,"I don't think it's possible using the `Select` extractor, etc., but it could probably be cleaned up with quasiquotes—I'd have to take a closer look.",161706270,2014-10-28 22:18:19
4838932,146404,19482510,13,"Yes, thanks to the `scala.compat` trick (since the universe doesn't have a `compat`, you get the one under `scala`).",161706270,2014-10-28 22:20:50
4838932,146404,19482536,13,"(Doesn't have a `compat` in 2.10, that is.)",161706270,2014-10-28 22:21:16
4838932,146404,19482970,90,"For blackbox macros the signature on the macro method is what you'll get, but for whitebox macros it's just a bound—you may get something more specific. These are all whitebox macros.",161706270,2014-10-28 22:27:02
4838932,32869,19523117,13,Haha that's a nice one!,161706270,2014-10-29 13:42:18
4838932,32869,19523149,90,"I'll expand this a bit. The ""what you'll get"" part of how blackbox macros operate is strictly enforced by the compiler - blackbox expansions are literally wrapped in a type ascription that prevents more precise types from leaking out.",161706270,2014-10-29 13:44:02
4838932,32869,19523197,5,"I don't think it's possible with `Select` either. With quasiquotes, the exact equivalent of the code you've written should be `case q""scala.symbol.apply(${key: String})""`.",161706270,2014-10-29 13:46:21
4838932,32869,19523299,5,"However what I'd advise to do is to match against `case Apply(fn, List(Literal(...))) if fn.symbol == symbolOf[scala.Symbol.type].info.member(TermName(""apply""))`. This way you're not bound to a particular shape that an application can take and also you do",161706270,2014-10-29 13:49:15
4838932,32869,19523327,131,You might really want to use symbols to be more hygienic (i.e. safer).,161706270,2014-10-29 13:50:54
4838932,164018,20048947,5,this type is not really necessary. We can remove it for now if it causes issues.,181903617,2014-11-08 09:21:59
4838932,146404,20157700,5,"If it's really not needed, removing it would clean up the code a lot. It seems pretty useful, though, no?",181903617,2014-11-11 22:43:51
4875650,7111,18468618,6,all caps is non-standard scala style.,164929995,2014-10-06 21:50:02
4875650,7111,18468640,25,extends AnyVal,164929995,2014-10-06 21:50:20
4875650,7111,18468738,14,Can this not have a return type? Is in NTupleType[T]?,164929995,2014-10-06 21:51:50
4875650,7111,18468824,14,this is confusing. The `T` here is not the same as in the trait. Can you instead put `R` or something?,164929995,2014-10-06 21:53:18
4875650,7111,18468939,5,these names are not great. Is this meant to be public? Can it be private?,164929995,2014-10-06 21:54:53
4875650,7111,18468990,7,"1) public methods should have return types.

2) `def ntuple(i: Int)(f: (Int) => String): String` put trailing function args in their own parameter group.",164929995,2014-10-06 21:55:48
4875650,7111,18469185,8,this is strange. You are ignoring the input here here. What do you intend to test?,164929995,2014-10-06 21:58:51
4875650,7111,18469209,13,{ } not needed for single expressions (and preferred to be removed).,164929995,2014-10-06 21:59:22
4875650,7111,18469217,5,no commented code.,164929995,2014-10-06 21:59:30
4875650,164018,19448854,5,"this is declared inside the main method.
This is intended to generate the code bellow.",164929995,2014-10-28 07:22:27
4875650,164018,19448875,14,Will change and add doc,164929995,2014-10-28 07:23:02
4875650,164018,19448878,25,Ok,164929995,2014-10-28 07:23:09
4875650,164018,19448893,6,changed,164929995,2014-10-28 07:23:18
4875650,164018,19448998,7,1) those are defined in the scope of main and are not public.,164929995,2014-10-28 07:25:29
4875650,164018,19449082,8,"that's a bug. 
The main test is that it compiles: t1 can be passed to f which takes a ttype.Type",164929995,2014-10-28 07:27:44
4875650,164018,19449159,5,fixed,164929995,2014-10-28 07:30:23
4875650,146404,19847623,10,Why not just check the size?,177727537,2014-11-05 07:26:48
4875650,146404,19847823,19,"This is unpleasant but will be hugely nicer with quasiquotes, so I think we can wait.",177727537,2014-11-05 07:31:19
4875650,164018,19850250,10,This way I don't need to no the max size. Either way.,177727537,2014-11-05 08:34:22
4875650,164018,19850305,19,I'd like to improve some of those pattern matching statements.,177727537,2014-11-05 08:36:34
4880532,48823,18486133,35,Looks like we should call `cpu_affinity` with an argument: https://github.com/giampaolo/psutil/blob/86668f711584df7d6c54689883f15786a4c2d07f/psutil/__init__.py#L673,165339171,2014-10-07 02:15:08
4880532,48823,18486179,36,Could you instead catch OSError and ValueError here instead?https://github.com/giampaolo/psutil/blob/86668f711584df7d6c54689883f15786a4c2d07f/psutil/_pslinux.py#L1081,165339171,2014-10-07 02:15:51
4880532,48823,18494247,37,"except (OSError, ValueError) as e:",165435128,2014-10-07 05:16:27
4880532,48823,18494290,18,Maybe `Process helpers used to improve zktraffic's operation.` or something?,165435128,2014-10-07 05:17:18
4880532,48823,18494861,32,"Not that you should fix this in this round, but I think we [should use mock](http://mock.readthedocs.org/en/latest/) to enable tests on travis. We (the zktraffic-community) can also have a test suite that can be run when not on travis as well, but let's g",165435128,2014-10-07 05:35:48
4880532,48823,18494864,33,"Any chance you can add docstrings? This is [based off sphinx-y formatting](https://pythonhosted.org/an_example_pypi_project/sphinx.html#function-definitions)

(I'm only ~35% sure about this, please correct me where I'm off :)

``` python
""""""Set the C",165435128,2014-10-07 05:35:53
4880532,64846,18496962,32,Good idea. Then we could mock() out these calls when executed on Travis.,165435128,2014-10-07 06:54:50
4880532,64846,18496974,33,Good call. Will update soon.,165435128,2014-10-07 06:55:16
5743959,652782,22545712,16,"Ditch the ""also"" in ""also the mechanism""",202780719,2015-01-07 02:37:07
5743959,652782,22545792,24,"I generally separate the two sorts of import statements out, but whatever works for you",202780719,2015-01-07 02:37:58
5743959,652782,22545894,28,"Consider making this an option, rather than a env variable? I just don't like relative things in paths",202780719,2015-01-07 02:39:19
5743959,652782,22546075,56,"Collapse this into:

try:
  self._print(self._queue.popleft())
except IndexError:
  time.sleep(0.1)

...?",202780719,2015-01-07 02:41:49
5743959,652782,22546220,20,"I prefer doing multiple imports this way:

from foo.bar import {
  baz,
  biz
}

At least I think it works that way. Makes diffs really easy to read.",202780719,2015-01-07 02:43:42
5743959,652782,22546320,71,SO MANY MAGIC NUMBERS,202780719,2015-01-07 02:44:46
5743959,81379,22549178,28,"an option would mean doing imports further down in the file. this is ugly but convenient for running/testing from source so we'll live with it, alas",202780719,2015-01-07 03:21:55
5743959,81379,22549294,20,"--diff-word works too! i generally agree, but since it's < 100 cols, leaving it that way for now",202780719,2015-01-07 03:23:27
6497004,48823,25647012,49,Why this time.sleep? In practice (mainly code in Aurora) I've found anything actually doing a sleep to be pretty flaky.,225135924,2015-03-03 05:51:10
6497004,48823,25647053,17,Does this need a `reset` which sets `_tick = False` ?,225135924,2015-03-03 05:51:50
6497004,81379,25648037,49,"ah, left over from debugging! good catch",225135924,2015-03-03 06:05:25
6497004,81379,25648097,17,"not, because that's basically ignored. only tick() and a subsequent call to after() can affect it - makes sense?",225135924,2015-03-03 06:06:20
6497004,48823,25648689,17,"Aha. Correct me if I'm off: `reset` sets it up then prepares it for the next run, overriding `tick` just speeds up the process for testing.",225135924,2015-03-03 06:15:55
6497004,81379,25649963,17,correct,225135924,2015-03-03 06:34:24
6529193,48823,25826297,10,delete debugging print,225839075,2015-03-05 06:36:27
6529193,652782,25826352,10,2nded,225839075,2015-03-05 06:37:23
6529193,81379,25826384,10,oops!,225839075,2015-03-05 06:37:53
6609766,48823,26153574,16,do not want- mind explicitly catching the exceptions you care about here?,228559904,2015-03-11 00:54:12
10750179,48823,46508885,4,0.1.8?,351723331,2015-12-03 11:22:56
10750179,81379,46594070,4,it's 0.1.7 - it refers to the unreleased version (hence the -XX) ,351723331,2015-12-04 02:56:22
20079539,48823,94461670,13,"I think it's only intended to be verbose if the config is set to dump out ""bad packets"" so mind deleting this?",589915984,2017-01-04 02:59:55
20079539,10507679,94515871,13,"@Yasumoto sorry for that, forgot to remove the debug message. fix it already.",589915984,2017-01-04 09:06:33
5391431,1443419,22737810,34,I suggest to make it info,161419855,2015-01-10 02:39:31
5458611,622449,30666328,45,"should this mix in structFields.hashCode() too? This is still correct, but will have more hash collisions in the case of comparing things with the same descriptor but different structFields (idk if that's common or not)",185897033,2015-05-20 07:02:23
5458611,622449,30666366,57,"does this return a new builder, or a new record? .build() was being called previously.",185897033,2015-05-20 07:03:19
5458611,622449,30666414,66,"oh, I see, is the contract that data here will be the result of create()? 
(using Object for return types does not lead to an easily understood API :p)",185897033,2015-05-20 07:04:28
5458611,360025,30739110,98,"since this fix uses only the builder, do you ever expect Message?",185897033,2015-05-21 00:23:50
5537703,622449,14631352,45,"tiny nitpick:
maybe just: `return writable.get() ? 1L : 0L;`",133849460,2014-07-08 05:33:22
5537703,622449,14631399,78,what if value isn't 1 or 0? Should that be an exception?,133849460,2014-07-08 05:35:08
5537703,51126,29406225,100,Fixed the issue mentioned.,136941768,2015-04-30 11:28:19
5537703,51126,30386331,100,"Dear Andy, would you mind taking some time to merge it to master?",136941768,2015-05-15 10:44:31
5537703,187046,22569175,66,"why not support string `""true""` and `""false""` conversion?",136941768,2015-01-07 10:15:18
5537703,187046,22569195,66,"Ah, I see chararray up top, though looks like it's stringifying the integer zero / one?",136941768,2015-01-07 10:16:06
5537703,187046,22569561,61,"`DataType.BOOLEAN` should likely be in here:

https://github.com/apache/pig/blob/trunk/src/org/apache/pig/data/DataType.java",136941768,2015-01-07 10:34:15
5537703,187046,22569580,100,"Missing an override for `toWritable(Boolean value)`:

https://github.com/twitter/elephant-bird/blob/master/pig/src/main/java/com/twitter/elephantbird/pig/util/WritableStoreCaster.java#L103
",136941768,2015-01-07 10:35:22
6486277,360025,25642826,37,"can you change this to '<'? 'minSizeToIndex' sounds like we will have an index file if the files size is >= minSize. Also, we can set this to 0 to make sure an index is always created. ",224846805,2015-03-03 04:59:39
6486277,360025,25642914,5,may be just 'index.minsize'?,224846805,2015-03-03 05:00:39
6486277,1443419,25645899,5,"I considered this but it sounded like ""the minimum size of the index"" to me. ",224846805,2015-03-03 05:36:30
6486277,1443419,25647102,37,"I am keeping it backwards-compatible with the previous 
""stat.getLen() <= stat.getBlockSize()"". We have an index if fileSize > minSizeToIndex, which was previously fileSize > blockSize. 

Since an empty lzo file is 42-byte:
```bash
$ cat /dev/null | ",224846805,2015-03-03 05:52:35
6486277,360025,25649616,5,right...,224846805,2015-03-03 06:29:29
6978903,360025,29783030,127,minor: should be in previous line. ,241309243,2015-05-06 22:46:44
6978903,360025,29783065,141,are these intentional indents? ,241309243,2015-05-06 22:47:04
6978903,1443419,29909679,127,fixed,241309243,2015-05-08 05:43:25
6978903,1443419,29909725,141,"EB does not seem to care about 80-column-limit as Hadoop,  but I did it out of habit.",241309243,2015-05-08 05:44:30
7069673,319889,28257912,9,"Can we safely advance here? The interface suggests that setKeyValue will always be called before nextKeyValue, so calling nextKeyValue here could cause us to skip a record?",243839174,2015-04-13 22:17:26
7069673,7735285,28369806,9,"You are right, the interface offers a possibility of skipping over a record. Re-reading the code then, it might work to have setKeyValue simply set this.key and this.value when currentRecordReader is null; the next call to nextKeyValue will then invoke re",243839174,2015-04-15 01:57:45
7069673,319889,28374296,9,"I think from my reading that should work, this stuff is unfortunately hard to parse :/",243839174,2015-04-15 02:48:35
7206602,360025,28831796,42,Is this just a renaming of LzoBinaryBlockRecordReader to LzoBlockRecordReader?,247745756,2015-04-22 04:13:35
7206602,814892,28832153,42,"Yes, most of the common code has been moved to this class with `nextKeyValue()` left to the implementing classes.",247745756,2015-04-22 04:20:21
7206602,360025,28893303,42,"I see, who else extends LzoBlockRecordReader?",247745756,2015-04-22 22:06:48
7206602,319889,28893447,42,LzoGenericBlockRecordReader extends it also,247745756,2015-04-22 22:08:26
7206602,814892,28893474,42,The new LzoGenericBlockRecordReader does.,247745756,2015-04-22 22:08:44
7206602,7111,28905135,154,"why are we only checking for -1 on the first call to read?

Is this even needed? The -1 | (-1 << 8) | (-1 << 16) | (-1 << 24) == -1. So, everything is fine if you don't do anything, assuming negative values are not allowed.",247745756,2015-04-23 00:15:26
7206602,7111,28905221,95,"shame this does not use a varint encoding. After compression it won't matter, but before compression we are probably loosing a few percent for records in the 100 byte scale.",247745756,2015-04-23 00:16:34
7206602,814892,28913956,154,"The only reason I can think of is we don't want the subsequent read() calls with how the block markers are set up.

If the first byte is -1, return. Else sum up the next 3 bytes to get the block size. -1 perhaps denotes an empty block and not eof?",247745756,2015-04-23 01:56:44
7206602,319889,28914286,154,"_in is an input stream, so i believe the contract is that it must mean EOF. @johnynek i figure some presumption that you avoid the extra read calls once you already know its EOF. But given EOF is not on the hot path, and calling read 3 times can't be very",247745756,2015-04-23 02:00:11
7206602,360025,28917065,28,Overall this replicates a lot of logic from LzoBinaryBlockReader. lets see we can merge these two.,247745756,2015-04-23 02:32:47
7206602,360025,29161762,11,should be getConverter()?,249996923,2015-04-27 21:14:23
7206602,360025,29162418,72,"I think updatePosition does no depend on decoded, should be outside.",249996923,2015-04-27 21:21:43
7206602,360025,29162744,42,we are not taking any advantage of ByteString here (as opposed to using byte[]). the intention might have been to avoid an array copy. lets see if that can still happen.,249996923,2015-04-27 21:24:58
7206602,360025,29163434,18,"assign it to byte[1] here itself
It could be renamed. 'lastBlock' kind of implies it retains state perhaps used next block read. But it doesn't may be 'blockBuffer' is better. It used just to read the bytes in.",249996923,2015-04-27 21:32:08
7206602,360025,29163955,104,"Actually if we use ```in_``` SerializedBlock.parseFrom(in_), then we could remove both byteArray and lastBlock.",249996923,2015-04-27 21:37:18
7206602,360025,29164025,28,Lets add parseFrom(InputStream in) instead.,249996923,2015-04-27 21:38:10
7206602,814892,29168852,104,We'll lose the ability to cache the allocated byte array in the reader here. This optimization was added in this change so we can possibly drop it @ianoc ?,249996923,2015-04-27 22:26:10
7206602,319889,29171173,104,I think @rangadi is suggesting we should be able to parse right out of the input stream  -- that would avoid the allocation entirely,249996923,2015-04-27 22:48:04
7206602,360025,29198405,12,"""Records Skipped"" (this could be for any reason, e.g. dropped by a push down filter). Or you could say ""Records Skipped by Converter""",250365767,2015-04-28 03:29:47
7206602,360025,29198665,115,"BoundedInutStream() is not strictly required, but good.",250365767,2015-04-28 03:33:12
7206602,360025,29198710,5,java doc needs an update. ,250365767,2015-04-28 03:33:55
7206602,360025,29198778,14,what changed?,250365767,2015-04-28 03:34:53
7206602,360025,29199534,44,"Can you add a TODO : all the three instances of ```switch (fileFormat)``` can be combined into one. We just need to set the right writable and converter for each of the cases (for thrift, protobuf, generic, 'binary' etc). 

",250365767,2015-04-28 03:46:19
7206602,360025,29199848,70,It does not look like this change is necessary. Leaving readNextProtoBytes() as it was is better until we gain from working on ByteString directly. ,250365767,2015-04-28 03:51:07
7206602,360025,29199984,18,we can remove this exception logging since the exception is percolated up. ,250365767,2015-04-28 03:52:53
7206602,360025,29200045,27,"It would read the entire inputstream only in case of corrupt data, right?",250365767,2015-04-28 03:53:44
7206602,814892,29201382,27,"This throws if I send the unbounded stream actually. This seems to suggest it always reads the entire stream:
https://developers.google.com/protocol-buffers/docs/reference/java/com/google/protobuf/Message.Builder#mergeFrom%28java.io.InputStream%29

```",250365767,2015-04-28 04:13:04
7206602,360025,29288517,27,I see. sounds good.,250365767,2015-04-29 02:05:07
7206602,319889,29289025,30,kill,250406379,2015-04-29 02:10:41
7206602,319889,29289008,16,"Don't think this adds anything anymode, the typeRef will just be the convertors creator. I'd just kill the log line",250406379,2015-04-29 02:10:29
7206602,2224697,29289463,5,Exception is super generic and is usually an anti-pattern. Any reason for this change?,250406379,2015-04-29 02:14:58
7206602,2224697,29289496,17,UnsupportedOperationException is probably a better fit,250406379,2015-04-29 02:15:24
7206602,2224697,29289634,18,Same comment regarding catching Exception,250406379,2015-04-29 02:16:52
7206602,2224697,29289601,7,catching Exception looks an antipattern. It would catch OutOfMemoryException and any other RuntimeException and the job might continue but in such a bad state that it would probably be a waste of resources,250406379,2015-04-29 02:16:34
7206602,2224697,29289972,58,"not new code, but it means it would catch any RuntimeException like OOM",250406379,2015-04-29 02:20:53
7206602,814892,29290165,5,TException does not extend IOException so there wasn't a more specific parent class to set here for both the thrift and profobuf codepaths. A new Exception class could be created to wrap the different ones I guess. Will fix.,250406379,2015-04-29 02:22:59
7206602,2224697,29290669,5,sounds safest. Thanks,250406379,2015-04-29 02:28:28
7206602,2224697,29289789,35,"if this class is generic and works with thrift, references to protobuf should be changed in argument and method names",250406379,2015-04-29 02:18:35
7206602,360025,29292018,35,"Yeah, it has always been that way. proto could be interpreted as generic protocol of how a message is serialized (protobuf, thrift, etc)",250406379,2015-04-29 02:45:35
7206602,360025,29292127,7,other alternative is to require throwing a new exception like 'DecodeException' in the converter interface. ,250406379,2015-04-29 02:46:59
7206602,360025,29292414,58,"We have to assume we have corrupt bytes that we are trying to deserialize. Thrift can throw any exception.. we try to avoid OOM with our own wrapper, but there is no guarantee. Given the requirement that we should be able to ignore the corrupt records, wh",250406379,2015-04-29 02:50:44
7206602,814892,29295384,35,Leaving this unchanged. Let me know if you feel strongly about the rename though.,250406379,2015-04-29 03:31:20
7206602,814892,29298653,58,Seems like we should change `Throwable` to `Exception` at least? Doesn't fix the case Laurent pointed out but slightly better.,250406379,2015-04-29 04:22:22
7206602,360025,29384077,27,"This is not enough comment from deleted code :

// normally a TException. but some corrupt records can cause
// other runtime exceptions (e.g. IndexOutOfBoundsException).",250790941,2015-04-30 02:41:12
7206602,360025,29384394,8,"This is added here, but not used on the read side (Lzo*RecordReader). Not sure if this gives us much. But I am ok if you want to keep it.",250790941,2015-04-30 02:44:43
7206602,814892,29385969,8,The record readers already declare IOException which is why it works without adding there I think. I can make it explicit though.,250790941,2015-04-30 03:02:01
7361401,2224697,29543261,22,shouldn't we use the JobContext output value class instead? http://archive.cloudera.com/cdh/3/hadoop-0.20.2-cdh3u6/api/org/apache/hadoop/mapreduce/JobContext.html#getOutputValueClass(),252157715,2015-05-02 05:54:32
7361401,2224697,29543305,47,"you can use ReflectionUtils.newInstance() (so that if encoderClazz is configurable, it will be called after instantiation)",252157715,2015-05-02 05:57:42
7361401,319889,29606963,22,"This is the class that does the encoding, not the actual output class I think. So don't think it applies",252157715,2015-05-04 23:00:55
7361401,319889,29607054,14,Do you need this to become public? looks like you have a new public one below?,252157715,2015-05-04 23:01:54
7361401,2224697,29607515,22,I thought GENERIC_ENCODER_KEY was representing the encoding class. My understanding of the code is that CLASS_CONF_KEY represents M which is the output value class.,252157715,2015-05-04 23:06:46
7361401,319889,29712912,22,"Your right, sorry. Though this would be inconsistent with how the others are done in elephant bird. They all set it as a custom option in the hadoop conf. Is there any restriction when when setting that value(how do you set it?) that its a writable? ",252157715,2015-05-06 02:05:45
7361401,360025,29772976,39,"'typeRef' is a specific type class to keep track of type parameter. could you rename it to 'valueClass'?. BinaryBlockWriter only needs a class name. We don't even need to get the class instance... At runtime this class would be available, but is not used ",253715670,2015-05-06 21:03:07
7517599,319889,30248463,9,should we not still do this? put the readFully below?,256230067,2015-05-13 21:22:06
7517599,319889,30248715,13,still have the import for BoundedInputStream above i presume?,256230067,2015-05-13 21:24:40
7517599,319889,30249846,10,"So i suspect all this was doing internally was wrapping our InputStream in a coded input stream, if we just have this function take our size too, then we can do the coded input stream ourselves in this function + set the limit on it. ",256230067,2015-05-13 21:38:03
7517599,360025,30252185,10,"yeah, that is even better. CodecInputStream seems public. ",256230067,2015-05-13 22:06:33
7596508,319889,30546715,24,Is there any tests for the rest of this? would be great to get a test on this new code if we can,231106648,2015-05-19 01:57:52
7596508,1325832,34529392,24,"There aren't really tests for this - mostly just E2E tests for proto<->thrift conversion. It's a bit tough to add a test in this case since this requires a newer thrift compiler (0.9+).

There's only one other compatibility issue with 0.9+ and that's TB",231106648,2015-07-14 06:06:35
7712090,622449,31088157,27,is RuntimeException enough? ,263008239,2015-05-27 03:53:58
7712090,814892,31088713,27,"Yes, changed to RuntimeException.",263008239,2015-05-27 04:02:12
9096529,814892,38461486,50,Updated to use easymock.,306840567,2015-09-02 00:35:33
9096529,622449,38383930,50,would it make sense to use a mocking library like easymock here? ,306840567,2015-09-01 09:01:00
9096529,622449,38580386,119,"once you're done with the mock, call verify(mock) on it as well",306840565,2015-09-03 01:31:10
10069641,319889,48907400,1,package should be cascading3 here?,336612194,2016-01-06 06:48:21
10069641,319889,48907609,5,Why change this to be provided? ,336612194,2016-01-06 06:50:50
10069641,319889,48907635,1,All of these package names seem to be incorrect,336612194,2016-01-06 06:51:08
10069641,7111,48981052,17,has this changed at all? I wonder if we can somehow have a shared directory with the build here that allows us not to copy these.,336612194,2016-01-07 01:03:32
10069641,7111,48981087,15,"same, looks like it does not really depend on cascading, so maybe this could be in a shared location.",336612194,2016-01-07 01:03:55
10069641,7111,48981132,8,seems like we could actually share this too.,336612194,2016-01-07 01:04:11
10069641,7111,48981255,21,I wonder if we should even port a deprecated scheme like this.,336612194,2016-01-07 01:05:23
10069641,7111,48981289,21,Should we migrate this?,336612194,2016-01-07 01:05:41
10069641,7111,48981459,24,the insanity of combinatorial explosion constructors.... ,336612194,2016-01-07 01:07:07
10069641,319889,49033163,24,"For this PR, how about we just include the scheme's scalding directly refer's to as a means to limiting this. People can add them back in later. I suspect most of these are legacy, unused, and untested things now a days that it probably doesn't make sense",336612194,2016-01-07 09:29:41
10069641,1202170,49077059,1,"indeed, thanks for spotting this.",336612194,2016-01-07 22:23:39
10069641,1202170,49077351,1,Yes,336612194,2016-01-07 22:26:46
10069641,1202170,49077326,5,"If you pull a hard dependency to cascading-hadoop, you can't (easily) switch to another backend afterwards; and you can't load two different backends in the same ClassLoader

This affects scalding as of https://github.com/twitter/scalding/commit/55f03f7",336612194,2016-01-07 22:26:32
10307219,319889,44600225,1,can you change it so these are independent travis builds? it will keep the travis speeds up and isolate failures from one side to the other. ,342099212,2015-11-12 06:02:45
10307219,319889,44600420,8,any reason this can't be public anymore?,342099212,2015-11-12 06:04:26
10307219,319889,44600478,23,"maybe rename this something like resetAndInitialize

len to newBufferBytesLength",342099212,2015-11-12 06:05:06
10307219,319889,44600615,26,This is changing the old behavior and removing a check. Can we add the check back in? is there any method in the 0.7 one we can call to just trigger its check length? or add an abstract method and override for 0.7 and 0.9 differently herE?,342099212,2015-11-12 06:06:16
10307219,319889,44600655,26,"Never mind this, i see you override it below",342099212,2015-11-12 06:06:47
10307219,1478170,44601423,1,you mean by using travis matrix builds? will have a look,342099212,2015-11-12 06:15:55
10307219,1478170,44601797,8,I made it package visible to limit situations where someone would directly instantiate a ThriftBinaryDeser. instead of using [ThriftCompat.createBinaryDeserializer](https://github.com/twitter/elephant-bird/pull/455/files#diff-3439b3a6836820e48c9601bf170df,342099212,2015-11-12 06:19:47
10307219,319889,44601877,8,"Fair enough, how about a comment on this class to indicate what someone should use. If its not compatible for someone in future then they will see that and know what to do.",342099212,2015-11-12 06:20:34
10307219,1478170,44601893,23,maybe just newLength?,342099212,2015-11-12 06:20:49
10307219,319889,44602081,23,"sure that adds a bit, and with the changed method name i think would cover it. ",342099212,2015-11-12 06:22:32
10307219,1478170,44602104,8,"Good point, this would be useful to people coding against the api but also to those who want to add new features that might be incompatible. That way the know where all this is handled.",342099212,2015-11-12 06:22:42
10307219,319889,44601809,1,Exactly. We use them in things like scalding/summingbird to try avoid single large builds,342099212,2015-11-12 06:19:52
10307219,1478170,44609777,42,"Mhhh I think that the build against hadoop X and test against hadoop Y never worked. Running mvn test includes mvn compile. So can I just drop this?
The matrix would include following scenarios: hadoop 1 and thrift 0.7, hadoop 1 and thrift 0.9, hadoop 2 ",345011449,2015-11-12 07:59:17
10307219,1478170,44609885,18,"Should this be included in the matrix too or do matrix builds only have an effect on the ""script"" and not the other steps?",345011449,2015-11-12 08:00:52
10307219,1478170,44612080,18,never mind I have the answer to my question =),345011449,2015-11-12 08:33:19
10307219,360025,47873649,46,Does this mean you are not setting the limits in Thrift 0.9? Is it not useful there?,360413330,2015-12-17 14:30:33
10307219,360025,47874205,1,What does this do? We can avoid having to publish multiple versions of packages for thrift-0.7 & thrift-0.9. This is how we handle multiple hadoop versions (there the incompatibility is much greater). This is how it could work : the build could be either ,360413330,2015-12-17 14:42:00
10307219,1478170,47943669,46,"If you are talking about setReadLength, then yeah it has been removed from thrift 9.",360413330,2015-12-18 02:43:50
10571489,2224697,45290105,30,is this that useful to wrap and throw again since the stack trace provides this information anyway?,348494983,2015-11-19 08:47:26
10571489,2224697,45290164,32,is this that useful to wrap and throw again since the stack trace provides this information anyway?,348494983,2015-11-19 08:48:08
10571489,1443419,45290360,30,"The useful part is the path is added to the exception. It will be passed to the AM and will appear in the job diagnostic info even on the submitter (and webUI). But I would not distinguish, just have a catch-all Exception.",348494983,2015-11-19 08:50:28
10571489,4859990,45293137,7,Will splits.toString() give us what we want to see here? It's an ArrayList<InputSplit>.,348494983,2015-11-19 09:33:31
10571489,1443419,45380752,7,"+1 @gsteelman , some Arrays.toString(splits.toArray()). Though it might temporarily triple the mem footprint: orig. backing array, toArray copy, and toString",348494983,2015-11-20 01:35:49
10571489,1443419,45382931,30,"- FileSplit already has a decent toString.
- We don't really need to distinguish exceptions, and always convert to IOException

Can we do the following with the original code:
```
LOG.info(""Creating a record reader for: "" + split);
Exception createR",348494983,2015-11-20 01:51:38
10571489,622449,45392887,32,"It does not, the stack trace comes from a stream reader, which is unaware of the file it is operating on",348494983,2015-11-20 03:03:39
10571489,622449,45392825,30,"Not sure I follow -- the whole point of this PR is that previously, we got a stack trace telling us ""invalid LZO header"" but not which file that came from. Now, we catch such IOExceptions and add more information that we know (which file was being read at",348494983,2015-11-20 03:03:09
10571489,622449,45393259,7,"java arrays have a bad toString, they print the memory address / hash code essentially. But lists have good toString:

```
scala> val x = new ArrayList[String]
x: java.util.ArrayList[String] = []

scala> x.add(""one"")
res2: Boolean = true

scala> ",348494983,2015-11-20 03:06:52
10571489,1443419,45395108,7,"@isnotinvain  ahh, looks like toString has been implemented in AbstractCollection forever. Good to know.",348494983,2015-11-20 03:22:18
10571489,1443419,45396518,30,"So I suggest to catch any exception without changes and store in createReaderException. This exception is added as the cause to  IOException(""Could not determine reader for ... "" + split + ...) , which already contains the file info.  

I specifically d",348494983,2015-11-20 03:34:40
10571489,622449,45409640,30,"Well, that's sort of the assumption I didn't want to make, as we start using these libraries in multithreaded / long lived services, we should stop assuming we can store things in static buffers and that failures will shut down the jvm and so on (so, avoi",348494983,2015-11-20 05:19:49
10571489,1443419,45414267,30,"My goal would be a minimum change covering as much as possible reusing the current exception code, no casts, etc for a small issue of adding logging. createReaderException is a local variable in a single-threaded method, no threading concerns. This change",348494983,2015-11-20 06:01:07
11480291,319889,49257453,10,0.7?,370342550,2016-01-09 09:31:40
11480291,2224697,49257804,10,"yes, typo...",370346074,2016-01-09 09:43:51
21900135,1443419,104826293,20,"Overall, LGTM. Using the same name for static and instance methods is unfortunate though.",635383605,2017-03-08 09:38:51
21900135,622449,105045722,20,that's a good point. Maybe we can follow up with new names.,635383605,2017-03-09 06:51:56
25640383,1443419,123110753,12,"I think what you want is to skip reading the index file if the split is an entire file or close to that instead of a binary switch that would behave poorly in one situation or the other.

",718168368,2017-06-21 05:17:15
25640383,1443419,123112625,12,we can compare file length to https://github.com/apache/hadoop/blob/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/lib/input/FileInputFormat.java#L388,718168368,2017-06-21 05:27:11
25640383,1003459,123114003,12,"Cool, that makes sense, then users can just crank up the min split size to get the same speedup.",718168368,2017-06-21 05:35:16
25640383,1443419,136194182,12,@steveniemitz I feel your pain on my team as well. Are you going to work on this soon? We could use the same parameter as for the read path: https://github.com/twitter/elephant-bird/blob/fb2fa515e3f91e1dceab47eb05fe5eecd75bacd9/core/src/main/java/com/twit,718168368,2017-08-31 04:26:09
25640383,1003459,136352884,12,"Yeah!  Sorry for letting this flounder, I got caught up in some other things, and we have a workaround locally that made this less pressing.  But I'd really like to get this fixed up soon.",718168368,2017-08-31 21:35:48
32938382,115552,159015622,5,"folks, this is not an apache license compatible package. 
EB needs to clean up these dependencies, adding more of them makes the problem worse.

Making this class explicitly aware of one specific type of file extension seems pretty brute-force. This wh",875516025,2017-12-29 08:56:11
37059057,622449,177918952,17,not re-using these could have a performance impact -- is it not possible to keep reusing them? ,959552852,2018-03-29 06:29:54
37059057,4417759,177920366,17,"So AFAIK, for every incoming payload we create new ThriftBinaryDeserializer object (from core/src/main/java/com/twitter/elephantbird/mapreduce/io/ThriftConverter.java).
Hence I thought it would be okay to initialize these objects here.

Also, we need t",959552852,2018-03-29 06:40:08
37059057,622449,177921528,17,"sounds good to me, thanks",959552852,2018-03-29 06:48:45
37059057,622449,177922329,17,"Actually, that doesn't seem to be true. It caches the instance and doesn't create a new one each time fromBytes is called.
I think we should be aware of the cost of this change. Another option is to just set a hard (fixed) limit instead of using bytes.le",959552852,2018-03-29 06:54:42
37059057,622449,177925164,17,"we just spoke offline, seems like either of:

1) Set a hard limit (configurable via hadoop config)
or
2) Start with a reasonable limit, cache the TBinaryProtocol instance, only instantiate a new one when `bytes.length` is larger than this limit (you c",959552852,2018-03-29 07:17:02
37059057,550921,177932930,28,upconvert len to long before comparing to be clear here.,959677865,2018-03-29 08:23:24
37059057,4417759,177955360,28,"int will be upcasted to long. So we are good here.

I've changed the adjustment factor. It is now incoming len + 10% (incoming len). That way we are not blindly doubling it.",959677865,2018-03-29 12:17:35
5188281,179888,20041257,6,I would leave this at 1.6 unless you really need 1.7,184003417,2014-11-08 05:15:57
5188281,179888,20041442,4,Is this intentional?,184003417,2014-11-08 05:19:50
5188281,5955549,20047745,4,"Yes, this is unreachable and unnecessary.",184003417,2014-11-08 08:03:01
5188281,5955549,20047753,6,"CharArraySet uses <>. So, we need to bump up. ",184003417,2014-11-08 08:03:24
5188281,5955549,20049246,1,"@caniszczyk, please advise us if this is an acceptable practice. ",184003417,2014-11-08 09:46:00
5188281,12202,20052568,1,"this is fine, but usually you put the copyright before the package statement (as a style nitpick)",184003417,2014-11-08 23:35:37
9793992,9846471,41700291,5,빠르게 반영해주셔서 감사합니다! ([관련 이슈](https://github.com/twitter/twitter-korean-text/issues/74)),329273669,2015-10-10 23:56:54
9833719,5955549,41926169,5,"PR 감사드립니다. 이렇게 def를 쓰면 Sentence.sentenceString을 호출할때마다 새로운 스트링 오브젝트가 생성됩니다. text, start, end의 변수 이름 자체를 text, startPos, endPos로 바꾸면 어떻까요? Sentence.text로 사용되기 때문에 sentenceString이라고 이름을 줄 필요는 없을 것 같습니다. ",330332343,2015-10-14 02:13:21
9833719,2015744,41927399,5,아 애초에 .text로 호출하면 바로 구할수 있었군요. 제가 실수했습니다. ^^; 삭제하겠습니다.,330332343,2015-10-14 02:22:36
17640028,33455030,102818018,12,hi,525260145,2017-02-24 05:08:02
26603825,29055,127919397,29,"I'm not so confident using `namespaceURI` against a static `http://www.w3.org/2000/svg` is bullet proof.
IIRC there are more complex scenarios than just that so probably we want to do this instead?
```js
else if (nodeType === 1 && !('ownerSVGElement' i",739344713,2017-07-18 16:00:46
26603825,29055,127919941,55,"do we really need this? since there are no side effects whatsoever closing an `<img/>` even in jurassic `HTML`, what is the actual benefit of introducing a boolean flag when the library can already be smart enough and do that regardless?",739344713,2017-07-18 16:03:24
26603825,29055,127919648,30,"just for the sake of updating, I'd rather go with `.toLowerCase()` and change the RegExp accordingly (or write the RegExp lower-case and use `i` flag)",739344713,2017-07-18 16:02:04
26603825,2255601,128131943,55,"I agree.  I've gotten strong push-back from other project maintainers when suggesting trivial application/xhtml+xml changes, so wanted to err on the side of caution and make it optional.  I'll kill this flag.",739344713,2017-07-19 07:59:54
26603825,29055,128390824,7,"one last thing please, `^(?:iframe|.......|textarea)$` to avoid capturing on `.test`, thank you!",740742218,2017-07-20 06:10:19
26603825,29055,128391026,7,I should've been more explicit: please add `?:` at the beginning of the group so it won't bother leaking the match on the `RegExp`,740742218,2017-07-20 06:11:57
6162387,892499,24205508,12,"imho, move the comment to the top of the file and change it to say:
// Auto-generated by conformance/Rakefile",214671892,2015-02-06 05:21:38
6162387,179888,24205710,12,:+1: ,214671892,2015-02-06 05:23:58
6258273,892499,24934187,13,JOINDER!,219151431,2015-02-19 02:49:27
6904970,28815,26322647,5,Should actually remove the semicolon since they are optional in JavaScript,238789658,2015-03-12 23:11:51
6904970,1418,26336456,5,"@outoftime 

- [Google style guide](https://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml): ""Always use semicolons""
- [Stack Overflow](http://stackoverflow.com/questions/444080/do-you-recommend-using-semicolons-after-every-statement-in",238789658,2015-03-13 01:34:58
8324092,3214,37117329,52,Why increased 3 characters?,279320010,2015-08-15 01:42:44
8324092,2221968,37117937,5,Why change the link text here?,279320010,2015-08-15 01:49:28
8324092,2221968,37118031,52,"There are 3 links (https://test.com, https://test.com, test.com).  They all get 1 character longer",279320010,2015-08-15 01:50:34
8324092,892499,37119708,5,@jnievelt I felt since we check http is length 23 elsewhere it doesn't need to be checked here also. I don't have a strong opinion either way.,279320010,2015-08-15 02:09:53
8324092,2221968,37120748,5,"Without a good reason to change it, I'd be in favor of not changing it ",279320010,2015-08-15 02:22:42
8324092,892499,37121196,5,@jnievelt Sounds good to me.,279320010,2015-08-15 02:27:29
8324092,3214,37118187,52,"Oh I missed last one, true!",279320010,2015-08-15 01:52:13
10026001,892499,43807887,7,"The test's message 'full url with hyphen' seems to not match the tweet content 'sample tweet'. Once this is fixed I'll merge; extra tests that clarify behavior are always appreciated, thanks!",334877790,2015-11-04 04:15:46
10026001,4283282,45096416,8,Is that correct? Shouldn't http link be 22 and https 23 characters long?,334877790,2015-11-18 01:14:25
11865433,578236,50926003,13,"s/overalapping/overlapping/

Sorry, was my mistake",379521193,2016-01-27 08:39:46
11865433,14327,51155740,13,Updated!,379521193,2016-01-29 01:31:30
12841882,3884568,55301006,95,Does this likewise represent the character class \p{Nd} (decimal numbers)? I just want to make sure it's not \p{N} which would allow more characters here than the regexes elsewhere.,402174976,2016-03-08 08:57:11
12841882,2088037,67923862,167,are these directional change characters getting lost in the refactor of INVALID_CHARS and INVALID_CHARACTERS ?,411153221,2016-06-22 01:22:50
18061879,576686,85195929,5,do we need all those `{1}` ?,537723696,2016-10-27 02:01:46
18061879,2088037,85220357,5,"1. Removed those. Thanks! 
2. we're using /i at the end of each regex for case insensitivity in js/rb/java. option NSRegularExpressionCaseInsensitive in objc. ",537723696,2016-10-27 04:05:50
18061879,2088037,85220959,5,"      > We also have some tests that check case: 
      ""Example cashtags: $TEST $Stock   $symbol""
       expected: [""TEST"", ""Stock"", ""symbol""]",537723696,2016-10-27 04:08:47
25785472,179888,123797812,5,"how about including `\u201D`, `\u275C`, `\u275E`",721095457,2017-06-24 00:02:05
25785472,2088037,124068021,5,that's a good question. We can evaluate those next.,721095457,2017-06-27 00:19:29
30941872,1441556,149652818,6,Should be `false`. (And this means some logic should be changed.),830978528,2017-11-08 20:21:48
31256508,5117111,151855550,5,"Hi @montogeek. I wasn't able reproduce this problem. 

'twitter-text' seems to be the correct npm module name. ",837788123,2017-11-19 14:02:22
33478850,43531,161353681,4,Thanks for this -- I am thinking I might want to make this the designated initializer (and also make a few other tweaks). I'll merge this (so you get credit!) but will be making some other minor updates soon as well.,886793545,2018-01-13 08:17:33
33997400,5117111,164030168,5,I think we want to check for the prefix only at the beginning of the string. I think substring works fine for this use case. Any other concerns?,897440294,2018-01-26 11:55:41
33997400,185779,164110979,5,@kaushlakers substring works fine here too. I see you pushed a stand-alone version for 2.0.3. I'll give that a try and let you know.,897440294,2018-01-26 21:29:15
33997400,185779,164125011,5,@kaushlakers 2.0.3 of the library does not exist in the tag 2.0.3,897440294,2018-01-26 22:31:13
9085644,937233,38231851,4,"Looks good to me.  No obvious unit tests covering this, but tested in place.

If the fix was this simple, I'm curious why it wasn't enabled before?",306729058,2015-08-28 23:51:52
9813103,949370,42939995,13,Doesn't all of this come for free when we use super(true)?,335369119,2015-10-25 06:39:50
9813103,937233,42940038,13,"No it rejects ':' in the key names

On Saturday, October 24, 2015, Madhu Palani <notifications@github.com>
wrote:

> In src/main/java/com/twitter/http2/DefaultHttp2Headers.java
> <https://github.com/twitter/netty-http2/pull/9#discussion_r42939995>:
>
> > ",335369119,2015-10-25 06:44:55
9813103,949370,42940083,13,"Ah ok I missed the "":"" so this is different then from the DefaultHttp2Headers in the main netty project where they don't check all of this? Do we know why?",335369119,2015-10-25 06:56:25
9813103,949370,42940087,32,Perhaps drop the : in the Exception message?,335369119,2015-10-25 06:56:53
9813103,937233,43020209,32,"Good catch, the exception in netty 4.1 lists it twice

    codec-http/src/main/java/io/netty/handler/codec/http/DefaultHttpHeaders.java 
    ""a header name cannot contain the following prohibited characters: =,;: \\t\\r\\n\\v\\f: "" +",335369119,2015-10-26 22:56:04
9813103,937233,43020534,32,"Actually, it is a : separating the explanation from the bad character.  Not sure if I should remove e.g. just below

        if (character > 127) {
          throw new IllegalArgumentException(""a header name cannot contain non-ASCII character: "" +
   ",335369119,2015-10-26 22:58:13
15294804,892906,65944326,4,"not just most users, all users.",459772641,2016-06-07 01:37:50
15294804,132262,65948145,4,#NotAllUsers,459772641,2016-06-07 01:59:31
7411699,27697,29699680,11,"should only need the twitter.checkstyle dep, see https://github.com/pantsbuild/pex/blob/master/tox.ini#L72",253687082,2015-05-05 23:46:17
7411699,66496,29701174,11,"When I didn't have them tox told me these dependencies were required but not installed...
However the PEX example runs fine on my machine.

One possibility is that in the PEX tox.ini the Twitter dependencies were specified as "">=0.3.1,<0.4.0"", which I ",253687082,2015-05-06 00:01:45
7411756,27697,29700057,7,sounds like this should be called testenv:integration and not testenv:pex,253688471,2015-05-05 23:49:55
7411756,27697,29700094,9,this should be 'pex==0.9.0' or 'pex<1'.  pex 1.0 is going to be published soon and the CLI arguments will change.,253688471,2015-05-05 23:50:24
7411756,27697,29700153,15,what are you trying to accomplish here?  shouldn't tox be doing the pip install?,253688471,2015-05-05 23:51:00
7411756,66496,29701284,7,:+1: ,253688471,2015-05-06 00:02:59
7411756,66496,29702341,15,"I am trying not to require `mesos.native` in the main package so people don't need to download/build one just to run tests or otherwise get started. 

Instead I am listing `mesos.native` [as an extra](https://github.com/twitter/mysos/blob/jyx/pex/setup.",253688471,2015-05-06 00:13:00
7411756,66496,29702569,9,:ok_hand: ,253688471,2015-05-06 00:15:01
7474386,66496,30274745,5,Thanks! We should have been quoting them! :smile: ,255129091,2015-05-14 01:52:42
7474386,66496,30275051,21,`s/){/) }/` looks better.,255129091,2015-05-14 01:55:50
7513023,224507,30260746,8,why is the default 'none' here instead of the default in the flag?,256638495,2015-05-13 23:29:48
7513023,66496,30274518,8,there's no flag for this but just constant defaults - we can add flags for the defaults later when we add T-shirt sizing for #14. The logic that handles 'None' is in scheduler.py because I want to consolidate the validation code there and keep http.py sim,256638495,2015-05-14 01:50:14
7564591,224507,30549398,38,"why can't this be just ""task_id"" ?",258772510,2015-05-19 02:29:29
7564591,66496,30553264,38,"This is akin to Aurora's executor name: `aurora.task` but yeah I guess it can simply be the task_id, which looks like `mysos-cluster123-0`.
Our internal monitoring tooling needs to use look at the executor name to distinguish it from tasks from other fra",258772510,2015-05-19 03:21:40
7564591,66496,30553631,38,"Hmm, I think I prefer a static name than a variable one and it's (slightly) simpler to tell the monitoring tooling (folks who write the monitoring tooling) to watch for a full string than a prefix. `task_id` is already exposed through the API s/endpoints ",258772510,2015-05-19 03:27:30
7564591,224507,30857407,38,"sg. 

s/mysos.task/msysos.executor/

task seems weird.",258772510,2015-05-22 04:11:38
7564591,66496,30858807,38,alright.,258772510,2015-05-22 04:36:34
7762360,224507,31481086,225,instead of tasks can we call them updates instead to more accurately capture what is happening here?,265617569,2015-06-02 04:23:44
7762360,66496,31482116,225,"You mean 

`updates_lost`, `updates_finished`, etc.? 

Read a bit strange though. These are indeed updates about tasks. 

I think the past tense captured what they are.

They are *tasks that have failed* which indicates a monotonically increasing ",265617569,2015-06-02 04:40:55
7762360,66496,31578174,225,"And since these are terminal states that cannot transition into one another, these counters really have 1:1 relationship with tasks. Will leave them in in this PR but I am open to suggestions for improvement.",265617569,2015-06-03 03:30:45
7872294,224507,31936181,19,print the minimum sizes required?,267522020,2015-06-08 22:05:35
7872294,66496,32045081,19,:ok_hand: ,267522020,2015-06-09 23:15:28
12380265,184275,53523637,11,"Just setting the `linkClickListener` member variable will not have the desired effect in all cases. The listener for `ClickableLinkSpan` is set when the Tweet is rendered. However, it is possible the listener is assigned after the text is rendered. Ideall",391315142,2016-02-20 05:52:26
13228030,184275,57015279,4,Can we remove changes to the Sample application? The goal is to just demonstrate the usages of TwitterKit.,411173295,2016-03-22 23:08:55
13228030,184275,57015823,4,"Note keys can also be added to fabric.properties so that they do not appear in public repo.

```
apiKey=0000000000000000000
apiSecret=00000000000000000000000000000000000000
twitterConsumerKey=0000000000000000000
twitterConsumerSecret=000000000000000",411173295,2016-03-22 23:11:46
13228030,184275,57017190,49,Do we need to persist the video position? Is there a chance the Activity will get destroyed when the lock screen is activated?,411173295,2016-03-22 23:18:53
13228030,2802235,57104093,49,I think it's necessary to ensure the VideoView resumes playing at the position it was at when the activity was paused. ,411173295,2016-03-23 09:59:33
13228030,184275,57195353,49,True. I guess currently if the Activity is destroy then recreated the Video will start from the beginning.,411173295,2016-03-23 23:53:32
13286494,8335,57354580,5,:+1: ,412365445,2016-03-25 00:28:26
13286494,184275,57356312,5,"Hi @gervasiocaj, Thank you for the PR. I will run this thru the translation team at Twitter. Once accepted it will be merged into our internal repo and then published to the community after our next release.

Thanks for review @arturadib.",412365445,2016-03-25 00:38:12
7989794,3136,32384517,4,"typo, Tough to Though",270776605,2015-06-15 02:29:05
7989794,238014,32386498,4,thanks man :),270776605,2015-06-15 05:21:46
8321530,949370,37043870,5,I changed this to public since I required it for creating dummy responses. Ideally we would need a ResponseBuilder,279284273,2015-08-14 06:41:06
8360527,4374309,34383764,6,"Is this ""super.end()"" call necessary? I'm not sure why this class both has an Inflator and extends Inflator. I don't see any other super calls (besides finalize), so it seems like no functionality from super is used.",279284272,2015-07-10 23:42:52
8360527,949370,34391876,6,the Inflater.java from roboelectric has a closeGuard. This crashes the TwitterAndroid app when each instantiation does not have a corresponding end call before finalize. I agree that this class indeed is weird in that it both extends and has an inflater. ,279284272,2015-07-11 01:12:51
9615046,937233,40856535,6,janky formatting,318236116,2015-10-01 02:45:19
9615046,949370,40857765,6,Ugh vi!!!!,318236116,2015-10-01 02:57:06
10736779,937233,46432898,4,shouldn't this default to Integer.MAX_VALUE until the server gives us a value?,351143645,2015-12-03 00:02:46
10736779,937233,46433488,14,"Does the client work for non-push scenarios with the default of 0 in Builder.maxPushStreams?

src/main/java/com/twitter/whiskey/net/SpdySession.java:        localMaxConcurrentStreams = configuration.getMaxPushStreams();",351143645,2015-12-03 00:06:46
10736779,77640,46434365,4,"yes, definitely - SPDY 3.1 spec says there is no maximum by default so we can just saturate the data type.",351143645,2015-12-03 00:12:07
10736779,77640,46436461,14,"yes, just verified that a simple get with no pushes works if the default is zero.",351143645,2015-12-03 00:25:07
9111633,7875,38691149,5,Why not leave this comment as it was?,306971338,2015-09-04 01:15:06
9111633,7875,38691251,10,This also had the pom.xml which might make sense to also have in the hellow-world-heroku example so it's visible in multiple places.,306971338,2015-09-04 01:16:02
9111633,5101696,38692991,5,"I removed because master is currently not the latest published version and
I didn't know if you'd have time to update the examples before our release.

On Thursday, September 3, 2015, Christopher Coco <notifications@github.com>
wrote:

> In README.md
> <h",306971338,2015-09-04 01:31:26
13317288,2219171,60093344,5,This should be https.port instead of httpsPort in order to be consistent with the readme and how other ports are named.,412993926,2016-04-18 23:53:07
13317288,2219171,60094005,5,"Rather than add a new flag, let's use the existing ""proxy.port"" flag. The ""protocol"" flag can be set to ""https"" and should be sufficient to create a SimpleHttpsDifferenceProxy and bind it to the ""proxy.port"".",412993926,2016-04-18 23:57:00
13317288,2219171,60094075,16,revert,412993926,2016-04-18 23:57:22
13317288,2219171,60094208,13,unindent to match style of surrounding code.,412993926,2016-04-18 23:58:10
13317288,2219171,60095934,26,"newline after ""(""",412993926,2016-04-19 00:09:24
13317288,2219171,60096002,28,"newline after last "")""",412993926,2016-04-19 00:09:47
13317288,201953,64271651,5,"So, what is under https is not the Diffy server, but the services that I am comparing.
I strongly believe proxy.port is a property of the server. And httpsPort is a property for the services.
So can we keep this new flag here?",412993926,2016-05-24 02:13:03
13317288,201953,64271768,16,"I don't think it need be reverted, the answer is in the previous question.",412993926,2016-05-24 02:13:46
14931364,2219171,64992179,6,"This generic provides a common protocol-agnostic abstraction to multicast something to an arbitrary number of destinations. The concern of having target specific headers belongs to the HttpDifferenceProxy implementation and should live there.

Further, ",451519124,2016-05-29 01:14:19
15723602,895426,70338242,10,Good idea.,475176333,2016-07-12 04:13:27
15723602,895426,70338763,50,Will do.,475176333,2016-07-12 04:16:48
15723602,895426,70340250,39,"My reflections - Since the header set is mutable, we should apply all the changes in a single operation.
this makes sense.  It's counter to splitting the filters, unless we just compose aggregates of headerEffects.",475176333,2016-07-12 04:25:54
15723602,895426,70341378,28,"I see the desire to partition the logic.  I'd prefer not to perform multiple runs through the http header set.

Let's see if we can have one filter, but aggregate the header effects.",475176333,2016-07-12 04:33:10
15723602,2219171,70137915,39,"You can ignore this but I am leaving it in to share my thought process through the review.
Consider making this slightly procedural and reducing the total lines of code:
```scala
incomingHeaders foreach { name =>
  val shouldExclude = exclusion exists",475176333,2016-07-09 03:43:32
15723602,2219171,70140610,17,you don't really need headers as an arg since it's closured,475176333,2016-07-09 04:04:00
15723602,2219171,70142459,10,These constants should be maintained in DifferenceProxy.scala to ensure that the labels always match. The current implementation requires these labels to be maintained in two places.,475176333,2016-07-09 04:20:13
15723602,2219171,70143883,50,"The expected behavior is that ""inclusions"" should always be equal to ""Seq(label)"". You can simplify this code by using that observation and defining ""exclusions"" as ""knownLabels filter { !_.equalsIgnoreCase(label) }"" and eliminating inclusions by directly",475176333,2016-07-09 04:29:47
15723602,2219171,70144530,28,"Taking a step back, RefineHttpHeadersByLabel might be better written as two separate filters:

RewriteHeadersForLabel(label)
RemoveHeadersForLabels(labels)

and then composing them as:

```scala
CloneHttpRequestFilter.apply.
  andThen RewriteHttp",475176333,2016-07-09 04:35:09
18290906,2219171,85363965,4,Sorting is meant to prevent false positives caused by inconsistent orders in which the same Set can be rendered as a Json array. Since Json does not have any notion of Set we have to sort just in case the collection may have originally been a Set. The dow,543568685,2016-10-27 22:34:39
18290906,1388225,85749416,4,Sorting in our case creates a lot of PrimitiveDifferences (30% - 50%) instead of OrderingDifferences.,543568685,2016-10-31 21:30:59
18290906,2219171,86089908,4,"That's weird. Can you share a bit more about what the differences look like. By definition, if all you have are ordering differences then there should be no differences left after sorting. This might be a bug that requires a different fix.",543568685,2016-11-02 15:17:03
37430907,2219171,179991354,8,"Rather than create an XmlLifter here and adding a dependency on org.json4s, please use the existing jsoup dependency and use HtmlLifter to also lift xml.",967448919,2018-04-09 12:40:19
37431544,2219171,179992060,23,These requirements are independent of SSL and are generally useful. Please use these settings in a shared trait between Http and Https. Bonus points for adding this support at a lower finagle layer so that it may be directly configured in DifferenceProxy ,967496199,2018-04-09 12:47:35
10338112,22916,44218704,13,"Typically not a great idea to include a package here, as it will get serialized when serializing the object to disk for instance. Autograd is pure Lua now so it's ok, but if it had C functions it would fail. ",342876257,2015-11-08 06:39:24
10338112,3535183,44218785,13,Done.,342876257,2015-11-08 06:47:44
10338112,235257,44218867,1,"needs a 

```lua
require 'nn'
```

Is it also good practice to put the nn.AutoCriterion module under the nn namespace? Maybe it is better to put it under the autograd namespace itself? like: autograd.Criterion",342892316,2015-11-08 07:00:36
10338112,235257,44218868,1,Same comments as above,342892316,2015-11-08 07:00:51
10338112,22916,44218901,1,"So the issue is that it would require `autograd` to be a global package, because of the funky design of `torch.class`. I'd rather keep it local.",342892316,2015-11-08 07:06:40
10338112,235257,44218912,1,"Hmmm, fair point, I suppose for now there's no good out of the box solution for that. @andresy introduced this recently FYI: https://github.com/torch/torch7/tree/master/lib/luaT#const-char-luat_newlocalmetatablelua_state-l-const-char-tname-const-char-pare",342892316,2015-11-08 07:08:46
10338112,22916,44218947,1,"Cool, hadn't seen this, thanks for the pointer.",342892316,2015-11-08 07:13:21
10338112,3535183,44226658,1,"Done for maintainability, though require 'nn' is implicitely required in autograd.nnwrapper above.",342892316,2015-11-08 23:21:06
10338112,3535183,44226661,1,See above.,342892316,2015-11-08 23:21:14
11749070,3711904,50480627,17,"I think you need to be more careful with that, there is at least one module in nn which has bias but no weight, see https://github.com/torch/nn/blob/master/Add.lua#L9",376662512,2016-01-22 07:17:28
11749070,11206,50537089,17,"For the PR, a test that tests the full set of combos ((weight, bias),
(weight), (bias), ()) would be best.

On Thu, Jan 21, 2016 at 6:17 PM, Francisco Massa <notifications@github.com>
wrote:

> In src/auto/AutoModule.lua
> <https://github.com/twitter/torc",376662512,2016-01-22 21:41:03
11749070,2213717,51024642,17,"Without this even creating a simple transfer AutoModule fails, so I'd rather merge this and add tests in another PR. Will take a look when I have time, just started using autograd.",376662512,2016-01-28 02:14:59
14364777,7687616,61804061,23,"""a multiplication""",437177870,2016-05-03 04:04:02
14364777,7687616,61804063,14,"""subtraction""",437177870,2016-05-03 04:04:04
15856300,11206,72560951,7,Why do you remove the `layers or {}` line? I think some folks might depend on this (although I do not) -- I believe it lets folks concatenate the output of the recurrent net built in this file to a passed-in set of layers.,483508470,2016-07-28 10:33:29
15856300,2628073,72562031,7,This line was something I added in the original PR since I didn't really understand how the other models used layers yet. Since the LSTM is implemented in autograd it can't be concatenated with a sequence of nn modules so passing in preceding layers doesn,483508470,2016-07-28 10:51:58
13272166,969908,57234801,5,"Thanks for adding the check, but a helper function like this should be quite abstract and does not get too involved with how will be used. To be specific, this functor should be useful for other value not just nodeHeight or event limited to Number. This c",412262882,2016-03-24 03:51:29
19082869,936708,89228487,61,"A very big caveat of `sharedtable` that should be highlighted is that, when you de-serialize, you're actually creating an unnamed variable in the thread's state. This causes some confusion, as in:
```lua
local t1 = {'key': {'subkey': 1}}
local t2 = {'k",561741235,2016-11-23 06:56:10
19082869,936708,89227405,4,"It should be `ipc.sharedtable([tbl [,move]])`, where `move` is an argument that specify that we should move stuff out of the original table to the new one. This is useful in case the table is very big and we don't want to have 2 copies of the full data in",561741235,2016-11-23 06:48:45
19082869,936708,89227153,28,"Add a note saying `threadId` starts at 1. I know it's the default in lua, but always a good reminder when dealing with low-level stuff.",561741235,2016-11-23 06:46:59
19337046,936708,90514066,23,Maybe use `memcpy` instead of copying individual fields? This highlights that everything is the same and avoids issue is we expand it.,568576211,2016-12-02 03:04:44
19337046,936708,90514475,3,Maybe add a test that provides the sizes too? Just to make sure it doesn't crash.,568576211,2016-12-02 03:06:43
20275534,235257,95287528,5,"general fix to work across lua versions:
```
local unpack = unpack or table.unpack
local status = c:write(unpack(data))
```",594294645,2017-01-10 09:56:36
20275534,7687616,95426608,40,"Do you want to actually keep this? I'm not sure Zak ever tested this extensively, no reason to propagate it to another file.",594294645,2017-01-11 02:29:17
20275534,7687616,95428583,11,"Suggestion: Expose the status strings as fields on channel, to allow something like: status == ipc.channel.OPEN, instead of hardcoding these strings everywhere. ",594294645,2017-01-11 02:39:30
20275534,7687616,95428917,107,"See the comment below about how to manage these strings in the user code, but here I would suggest you do something like:

#define STATUS_CLOSED "":closed""",594294645,2017-01-11 02:41:08
20275534,11059,95499653,40,"Good to hear it's not needed. I was being conservative, but now I will remove it.",594294645,2017-01-11 10:05:07
20275534,11059,95499783,5,"cool, will fix",594294645,2017-01-11 10:06:11
20275534,11059,95499818,107,makes sense,594294645,2017-01-11 10:06:26
20275534,11059,95501083,11,"I was thinking about this, but I'm not sure it would work because of the following reasons.

1. If you can write and read nils into a channel, then you can't return nil from read or write to signify failure to read/write a value.
2. For non-blocking re",594294645,2017-01-11 10:16:31
20275534,7687616,95638157,11,"""instead of status == "":open"" it would be status == ipc.channel.OPEN. I'm not sure if that is what you were suggesting in the first place.""

Yes, just an enum.",594294645,2017-01-12 02:17:56
22441637,936708,113762601,56,Same here.,674298615,2017-04-28 00:59:03
22441637,936708,113761704,36,Can you provide better names here? I just noticed that the original code has also 5 arguments with 1 letter each. We have to change that or the code becomes much harder to understand.,674298615,2017-04-28 00:55:12
12436522,6625053,53493193,42,"Remove TODO and open an issue to track an enhancement. I do agree this section can be improved, but this TODO is not descriptive.",392577594,2016-02-20 01:51:44
12436522,1350674,53497142,42,"Woops... Sorry, the `TODO` was a bookmark as I started last night and finished this morning! Will remove.",392577594,2016-02-20 02:23:34
13529484,1350674,58286777,35,These could be cleaned up by using the `WriteBytesExt` trait in the `byteorder` package: http://burntsushi.net/rustdoc/byteorder/trait.WriteBytesExt.html#method.write_u16,417736692,2016-04-02 09:11:53
13529484,1350674,58286828,65,"I know this isn't a part of this commit, but this could take a `&str`, and `String` references automatically convert to type `&str`. That would allow quite a few of these types of methods to use use a reference. I'm not sure of the payoff since I suspect ",417736692,2016-04-02 09:15:52
13529484,1350674,58286951,160,"If you want to avoid the `.clone()` here you can match each case like so:
```rust
&Value::Stop =>
...
&Value::List(ref ttype, length) =>
```
etc.",417736692,2016-04-02 09:26:06
13529484,1350674,58299635,43,"This feels like it should be nested and not need delimiting with the ""stop"" type as the need for a ""stop"" is a protocol detail not a structural detail. This would also suggest a recursive `Type` and `ThriftType` models which might also be easier to think ",417736692,2016-04-03 03:47:48
13529484,6625053,58303961,35,+1,417736692,2016-04-03 10:34:34
13529484,6625053,58303940,43,Agree. I'll open a tracking issue for this once merged. I need to give further consideration to the details around this. ,417736692,2016-04-03 10:32:52
13551697,1350674,58301725,25,Woops... Looks like I left a commented out line. Sorry.,418244289,2016-04-03 06:29:10
13574802,6625053,58396203,314,nit: w2 is the third workload,419059878,2016-04-04 22:35:13
13574802,6625053,58396316,319,same as line 261,419059878,2016-04-04 22:35:51
13574802,6625053,58397212,268,"I wonder if we should ```Some(other) => return Err(...)``` for this case. Matches existing behavior, so up to you.",419059878,2016-04-04 22:40:39
13574802,1350674,58398167,314,Can do: I left the numbers in 0 indexed form but I'm happy to change them to counting numbers.,419059878,2016-04-04 22:46:36
13574802,1350674,58398374,268,I'm happy to change the behavior to result in a failure: I think an error is more correct in this situation.,419059878,2016-04-04 22:48:09
13574802,6625053,58399083,314,"Zero indexed is fine. It's just that this config is ping, add, subtract - if ping (w0) is first, subtract (w2) is third (not second). The comment led me to think you were talking about the second workload in the config, not the third. ",419059878,2016-04-04 22:52:18
13574802,1350674,58399139,314,"Woops... I misinterpreted your comment: it was for the comment, not the name.",419059878,2016-04-04 22:52:40
13636111,6625053,58741005,215,Should we `panic!()` here? It's probably worse to send malformed data. ,420370727,2016-04-06 23:50:42
13636111,6625053,58741336,17,?,420370727,2016-04-06 23:52:53
13636111,1350674,58741610,215,Agreed. The only type that isn't handled is `None` but a panic still seems appropriate.,420370727,2016-04-06 23:54:39
13636111,1350674,58741756,17,This is an leftover from some confusion I had with the `extern crate` and module system. It should go.,420370727,2016-04-06 23:55:43
13636111,6625053,58745856,83,"nit: include a space following the comma, rustfmt should fix this",420373177,2016-04-07 00:20:57
13636111,1350674,58746327,83,Done. :smile: ,420373177,2016-04-07 00:24:17
13775099,6625053,59284505,38,"Yeah, some of the new functions can get moved out of `main.rs`. Feel free to move stuff around. I'm going to focus on #73 and benchmarks",423436324,2016-04-12 04:25:52
13775099,1350674,59283637,38,"I've been thinking that all the config code should be moved to the config module. In fact, I was going to work on that this evening until I saw this string of PR's. :smile: ",423436324,2016-04-12 04:20:00
13827633,6625053,59652049,30,What's the plan to support setting with TTL here?,424954754,2016-04-14 08:13:07
13827633,6625053,59652147,32,What's the reasoning behind having this in the protocol specific lib?,424954754,2016-04-14 08:14:41
13827633,6625053,59652196,3,note to self: we'll probably want to start at 0.1.0?,424954754,2016-04-14 08:15:33
13827633,1350674,59707402,32,"Its a member of `BenchmarkConfig` and `BenchmarkConfig` is passed to the memcached configuration loader, so I believe it needs to be in this common types module.",424954754,2016-04-14 19:24:50
13827633,1350674,59707664,30,I noticed that in master they were hard coded. TTL specification can simply be added as parameters to the `enum` variants. For now I'm just mirroring the behavior of master and later improvements should be relatively simple and confined to their individua,424954754,2016-04-14 19:26:56
13827633,1350674,59714892,32,I think this deserves a little more discussion. I pass the `BenchmarkConfig` to the constructors because I would like to let each protocol override or at least inspect the values of the benchmark. This is not strictly necessary for the case of only wantin,424954754,2016-04-14 20:21:20
13827633,6625053,59743651,32,"Actually. I think I misread the diff. :smile: Ignore this comment.

I think starting at 'more control' in the early stage is a reasonable strategy.",424954754,2016-04-14 23:01:28
13827633,6625053,60094813,2,Another way to do this is to use a `.gitignore` in each subcrate. That was the approach I was taking previously. See `lib/request/.gitignore`. This would also keep a convention if we want to use `cargo new` to create new protocol subcrates. ,427757534,2016-04-19 00:01:52
13827633,6625053,60095145,1,"I'd prefer to use rust for this, but I'll take that up later.",427757534,2016-04-19 00:04:22
13827633,6625053,60095305,5,I think we should start our versions at 0.1.0 for new crates in the project.,427757534,2016-04-19 00:05:19
13827633,6625053,60095608,31,I'm not sure how I feel about `gen` as the name here.,427757534,2016-04-19 00:07:21
13827633,6625053,60095891,79,s/prepatory/preparatory/,427757534,2016-04-19 00:09:07
13827633,6625053,60096383,94,"Again, we have generate, regenerate, gen, and regen. I'm sure this was a problem before too. But I think I'd lean towards the full spellings.",427757534,2016-04-19 00:11:58
13827633,6625053,60097831,4,Why get rid of the doc test?,427757534,2016-04-19 00:20:20
13827633,6625053,60098992,38,"Not sure about leaving an `assert!` here. If we want to check, let's return a `ParsedResponse::Unknown`? ",427757534,2016-04-19 00:27:28
13827633,6625053,60104173,134,Is this intended to be here?,427757534,2016-04-19 00:57:32
13827633,6625053,60106824,1,"One thing though, this should be in a `benches` folder. Let's rename the folder and update the `.travis.yml`",427757534,2016-04-19 01:12:49
13827633,1350674,60108425,134,"It was for me to 'guide the eye'. I can/should be removed. Better yet, a doc commend for `load_config`.",427757534,2016-04-19 01:20:55
13827633,6625053,60110273,134,:thumbsup: Let's aim for a doc comment instead. ,427757534,2016-04-19 01:31:29
13827633,1350674,60155464,5,I'm going to operate on the assumption that this doesn't apply to the `request` package since it isn't new. Let me know if thats incorrect.,427757534,2016-04-19 07:05:45
18477099,6625053,86207099,4,I don't believe this should be a command line option. None of the other command line options are protocol specific. Can this be moved to the TOML config instead?,547644556,2016-11-03 01:09:00
18477099,6625053,86210354,4,"Yeah. It would need to be in the global section of the config, as opposed to the workload sections. But perhaps it's a bit cleaner? 

I've used templated configs before when I've needed to alter specific parameters across a bunch of runs, so maybe you c",547644556,2016-11-03 01:23:34
18477099,6625053,86466650,5,Is this the appropriate type? Can database numbers be negative? Is 64bit supported?,548557131,2016-11-04 06:43:13
18477099,6625053,86466620,5,Same as above,548557131,2016-11-04 06:42:54
18477099,121310,86208414,4,I see your point about it being protocol specific - the reason I didn't want to put it in the TOML was that it's really connection information: like host or port. I'm running tests against a combination of `$server $port $database` and didn't want to prep,547644556,2016-11-03 01:14:58
42901340,47822,204867808,13,"oh, i see the rest is formatted this way. idk i think that's a little goofy looking, but whatever, just follow the convention and ignore me :)",1079583284,2018-07-25 01:39:43
42901340,47822,204867379,13,"I'd cut down each method call here and fold the map_or into one line like:

```rust
parameter
    .get(""num"")
    .and_then(|k| k.as_integer())
    .map_or(0, |i| i as u64)
```",1079583284,2018-07-25 01:38:20
42901340,47822,204869833,22,"I found this a little confusing. Perhaps we could hint to the user what they should do to fix it? 

```rust
let fmtlen = format!(""{}"", num - 1).len();
if  fmtlen > size {
    format!(""To contain {} strings, you need to specify a size >= {}"", num, fmt",1079583284,2018-07-25 01:45:53
42901340,47822,204870836,32,"Since this method returns `Result<T>`, we can use the new `?` macro instead of `try!` (which is deprecated now, afaict).

```rust
let mut value = T::parse(seed, size, num, parameter)?;
```",1079583284,2018-07-25 01:48:19
42901340,6625053,204877114,32,To be addressed in #155,1079583284,2018-07-25 02:08:35
42901340,47822,204877514,32,"I WILL NOT BE SILENCcooh that's fine, thanks!",1079583284,2018-07-25 02:09:52
42901340,6625053,204878009,22,#156 for this one,1079583284,2018-07-25 02:11:22
43380887,2630136,207044143,42,wonder if it would make more sense to express these as a max # of times we double the timeout,1088381797,2018-08-02 04:52:02
43380887,6625053,207047160,42,"I felt like it might be more natural to think about it in terms of milliseconds still. This also allows us to pick a max timeout that isn't a 2^n multiple of the base timeout. Eg: with 200ms base, you can cap at 500ms timeout. Otherwise it's either 400ms ",1088381797,2018-08-02 05:03:46
43380887,125662,208042735,14,"Given the new functions, `request_timeout`, `connect_timeout` in Connection class, I feel renaming the options bearing the same name in config would keep things clearer, i.e. `config.request_timeout` -> `config.base_request_timeout`, `config.connect_timeo",1088396978,2018-08-07 05:01:10
14535979,7875,67106609,14,Use the .withXXXX API instead.,440876259,2016-06-15 13:33:35
14535979,934414,67311849,14,Amended ,440876259,2016-06-16 16:12:27
14535979,7875,67458977,14,"I meant,

```
ThriftMux.client
  .withTracer(NullTracer)
  .withStatsReceiver(NullStatsReceiver)
  .newIface[PingService.FutureIface](""localhost:9999"")
```",440876259,2016-06-17 11:17:30
14535979,7875,67459051,19,"formatting

```
client.ping().onSuccess { response =>
  println(s""response: $response)
}",440876259,2016-06-17 11:18:52
14535979,934414,67461832,19,Noted,440876259,2016-06-17 12:21:08
14535979,934414,67462463,14,"Yeah , this is the old diff , fixed up over here https://github.com/twitter/finatra-activator-thrift-seed/pull/2/commits/98f38ce2e7a45fdca767f9d483873ed8517f8bda , will update that anonymous function as recommended though.",440876259,2016-06-17 12:35:23
26932100,252777,130896717,5,"Instead of only building for 2.12, let's cross-build for both 2.11 and 2.12. As a reference, we do that in Finatra here: https://github.com/twitter/finatra/blob/develop/build.sbt",746503651,2017-08-02 21:42:44
13639105,6625053,58745425,4,s/thinkingfish/twitter/g ?,420068338,2016-04-07 00:18:29
13639105,125662,58748940,4,"Certainly. This is just for me to see the effect of the icon on my own README.md, since the twitter repo doesn't have travis enabled yet. I will need admin privilege to add that (and I haven't got that approved by OSS yet)",420068338,2016-04-07 00:39:40
13639105,125662,59103925,54,Yes I probably can. But I wonder what is bad about sudo on an image?,420068338,2016-04-09 06:52:37
13639105,11239,58975885,54,it'd be nice if you can avoid sudo... can you just `make` libcheck and use the directory path instead?,420068338,2016-04-08 10:15:51
13639105,11239,59105575,54,"There's nothing wrong about it, but travis prefers and works faster when you don't https://docs.travis-ci.com/user/workers/container-based-infrastructure/",420068338,2016-04-09 07:24:37
13639105,11239,59114633,32,:fire: ,422370304,2016-04-09 19:36:11
13639105,125662,59124946,54,Ah interesting. I'll modify the check installation.,420068338,2016-04-10 08:17:45
13639105,125662,59126120,54,"I cannot seem to make this work on travis even though it works just fine locally:
```bash
-- Found CHECK: /Users/travis/.local/lib/libcheck.dylib  
-- Found components for CHECK
-- CHECK_ROOT_DIR  = /Users/travis/.local
-- CHECK_INCLUDES  = /Users/tr",420068338,2016-04-10 10:18:55
13639105,11239,59126464,87,"you should create a ticket to follow up with a cache for this file

https://docs.travis-ci.com/user/caching/",422888030,2016-04-10 11:05:28
13639105,125662,59126481,87,"> The features described here are currently only available for private repositories on travis-ci.com and our new container-based infrastructure.

So I guess not available for free-tier services? I added a note to the follow-up ticket and check if the st",422888030,2016-04-10 11:08:30
13639105,11239,59130529,87,"I've seen people using it, and according to this blog post[1], ""The best news for open source projects is that our build caching is now available for them too"", but yes, it'd required to drop sudo.

[1] https://blog.travis-ci.com/2014-12-17-faster-build",422888030,2016-04-10 16:27:28
13639105,11239,59135112,95,apparently we have 4 tests that run on `make check` and 17 on `make test`... is that expected?,422888030,2016-04-10 21:38:00
13639105,125662,59293690,95,"`make check` invokes two targets, the first one for `ccommon` which has [13 tests](https://travis-ci.org/twitter/pelikan/jobs/122031238#L1397), the second for `pelikan` which has 4 tests.

`make test` is a target created by CTest, it combines all the te",422888030,2016-04-12 05:36:08
13983248,125662,60198023,5,"All these are fairly ugly.
You can drop the leading `../../../` and it would still work. In this case it will just fall back to search in the paths specified by `-I`, and we have added the top-level `src/` to the include directories.",427963000,2016-04-19 16:21:15
14279206,2630136,61403647,11,Do we want pingserver to be installable? ,435360238,2016-04-28 17:12:19
14279206,125662,61404691,11,"That's my take – I assume all executable should be installed unless there's a reason not to, including (in the future) echoserver.

Thoughts? Concerns?

",435360238,2016-04-28 17:21:52
14512048,11239,62408990,15,"I assume you needed the `--insecure`, but it doesn't sound like a great solution. ???? ",440387510,2016-05-07 08:35:57
14512048,11239,62409016,15,"Ah, you are doing the sha comparison, I'm ok with this then",440387510,2016-05-07 08:37:12
20629770,11239,97524384,67,missing a `return;`?,601271438,2017-01-24 19:18:51
20629770,11239,97526689,62,once again,601271438,2017-01-24 19:33:42
20629770,11239,97528261,174,`ASSERT(queue_size);`?,601271438,2017-01-24 19:41:49
20629770,11239,97525691,47,missing `return;`?,601271438,2017-01-24 19:27:00
20629770,11239,97528480,66,"5, 6 and 7?",601271438,2017-01-24 19:43:17
20629770,11239,97526947,145,here too,601271438,2017-01-24 19:35:16
20629770,11239,97527871,43,"Use two keys with different length. Also, since the char* is actually 5 bytes as it has a NULL termination, use 5 instead of 4 in this case, as it may help catch off-by-one errors.",601271438,2017-01-24 19:39:28
20629770,125662,97486996,16,klen might be a better name?,601271438,2017-01-24 15:25:23
20629770,125662,97487876,12,"Wonder if it makes more sense to use a percentage, so we don't always have to tune HOTKEY_NSAMPLE & HOTKEY_THRESHOLD at the same time. E.g.
```
HOTKEY_THRESHOLD_PCT 0.01
HOTKEY_THRESHOLD (unsigned)(HOTKEY_NSAMPLE * HOTKEY_THREHOLD_PCT)
```",601271438,2017-01-24 15:33:59
20629770,125662,97487294,1,"Sorry for the possible bike-shedding on naming. But counter_table doesn't seem the most intuitive to me. May I propose ""key-count map"" or ""kc_map"" as an alternative?",601271438,2017-01-24 15:28:15
20629770,125662,97487914,10,"More on naming, ```WINDOW_SIZE```?",601271438,2017-01-24 15:34:24
20629770,125662,97487478,185,use ```struct bstring``` to pass around ```key```?,601271438,2017-01-24 15:30:11
20629770,125662,97489094,18,"One thought- most of the storage used here are for storing keys, and we are storing it (at most) twice, once in the queue/window, once in the key-counter map. However, one property of the data structures is that every key in the map will be in the queue a",601271438,2017-01-24 15:44:36
20629770,125662,97488474,1,"queue a bit too generic given we have a cc_queue in ccommon

Can we call it something more context-aware such as key_window or something (not thinking very hard here right now)",601271438,2017-01-24 15:40:03
20629770,125662,97488133,32,"macro probably an overkill here. We are unlikely to call it more than once per request, so that's not too bad. Different story elsewhere we used this tactic (logging, metrics)",601271438,2017-01-24 15:36:34
20629770,2630136,101842989,18,"I will do this in a separate pull request. This is a larger change than it seems, as in order to do this we need to make the queue aware of the counting map",601271438,2017-02-18 04:41:18
20629770,2630136,101843202,43,"I made the sizes the length of the strings without null termination, because we don't use null terminated keys in cache.",601271438,2017-02-18 04:42:45
20629770,125662,101932566,70,"use macros to define key1/2/3, as we did in other unit tests? (see protocol/data/memcache)

Also, you can use str2bstr to convert a C string to a struct bstring. https://github.com/twitter/ccommon/blob/master/include/cc_bstring.h#L38",625037451,2017-02-20 07:35:23
20629770,125662,101931611,6,"Given that we don't really update the size of key window, does it make things easier to use ring array to implement this data structure?",625037451,2017-02-20 07:01:23
20629770,2630136,102576490,6,"I think the benefits of using ring_array do not significantly outweigh the drawbacks. Although it would provide a clean push/pop, using STAILQ is also a one liner in this aspect and is not significantly harder to understand. ring_array also lacks a foreac",625037451,2017-02-23 05:24:22
20629770,125662,102604541,6,"Good point on the lack of foreach in ring array.
The tradeoff makes sense for now.",625037451,2017-02-23 07:43:48
20629770,125662,102605052,6,"If we can preallocate the entire window when initialize, can we just do that, treat the whole thing as a big array, use offset to traverse the structure and forget about the link list?",625037451,2017-02-23 07:47:15
20724823,11239,98042951,316,isn't this test exactly the same as the one above?,604498148,2017-01-27 01:14:54
20724823,11239,98040518,87,add an assertion on the first part of the item_data to make sure it was not modified?,604498148,2017-01-27 01:03:28
20724823,11239,98044040,27,"I feel there should be a gauge for the items that are backfilling, reserved and not linked... maybe `alloc`-`link` already provides that?",604498148,2017-01-27 01:19:50
20724823,11239,98043555,35,"I don't think this description is clear, it makes me thing that each slab reserves and not that it is itself reserved",604498148,2017-01-27 01:17:44
20724823,11239,98044822,129,"`it` is linked, should not use `item_release` according to comment above",604498148,2017-01-27 01:23:26
20724823,11239,98047503,161,"I don't fully understand these changes of `return`ing instead of `goto`... `_cleanup` is no longer called, that seems to be on purpose, but I don't understand why",604498148,2017-01-27 01:36:25
20724823,11239,98048176,53,missing space after `=`,604498148,2017-01-27 01:40:06
20724823,11239,98048203,44,missing space after `=`,604498148,2017-01-27 01:40:15
20724823,11239,98048007,79,missing space after `=`,604498148,2017-01-27 01:39:06
20724823,11239,98047988,69,missing space after `=`,604498148,2017-01-27 01:39:01
20724823,11239,98050571,4,"having a `rstate` that may be `REQ_PARTIAL` this sees either redundant, or at least confusing... looking at the change I can see partial being set to `false` only when `rstate` going from `REQ_PARTIAL` to `REQ_PARSED` and set to `true` only when rstate is",604498148,2017-01-27 01:51:50
20724823,125662,99930871,60,"Good point, I'll update it in the next commit.",604498148,2017-02-08 05:15:37
20724823,125662,99937807,35,"updated in the next commit, please see if it's better

"" # items that can't be evicted""",604498148,2017-02-08 05:46:52
20724823,125662,99938255,27,"Yea it does. I wonder if this is a metric that's gonna be useful under normal operations. I feel people may care about it only when they receive a OOM (due to failure in eviction), which should be rare.",604498148,2017-02-08 05:48:48
20724823,125662,99939472,316,"This test changes the slab config so the second reserve should fail, instead of succeed, (ITEM_ENOMEM expected). And another reserve is attempted after ```item_insert```, which should succeed now that we can evict.",604498148,2017-02-08 05:54:20
20724823,11239,100203334,204,^^,612974524,2017-02-09 08:08:45
20724823,11239,100202754,124,"if `item_reserve` failed in `_put`, `req->reserved` will be null, and all this code will fail; check for `status != PUT_ERROR` earlier",612974524,2017-02-09 08:03:59
20724823,11239,100203868,245,check for status before inserting?,612974524,2017-02-09 08:13:09
20724823,11239,100203001,166,same here ^^,612974524,2017-02-09 08:06:06
20724823,11239,100193530,18,"since `rsize` and `nbyte` do not change before checking the value of `complete`, can you move this branch below, get rid of `complete` and use an `else` instead of `if (complete)` ?",612974524,2017-02-09 07:00:43
20724823,11239,100195469,83,"I'm not sure, but I think we're missing a `break;` here? otherwise it will enter the next `if` (as `status` is not `PARSE_OK`) and it will set the `rstate` to `REQ_PARSED`.",612974524,2017-02-09 07:12:52
20724823,11239,100193652,18,"I don't know if I made myself clear, something like this:
```
diff --git a/src/protocol/data/memcache/parse.c b/src/protocol/data/memcache/parse.c
index cf3c06b..66cff18 100644
--- a/src/protocol/data/memcache/parse.c
+++ b/src/protocol/data/memcache",612974524,2017-02-09 07:01:33
20724823,125662,100440277,18,Got it. Yes! This is better :),612974524,2017-02-10 07:34:27
20724823,125662,100462756,83,You are right. I created a new test to capture this condition (and without the break it failed). Thanks for catching this!,612974524,2017-02-10 10:49:50
20724823,125662,100463476,124,will fix.,612974524,2017-02-10 10:57:58
20724823,125662,100463488,166,will fix.,612974524,2017-02-10 10:58:05
20724823,125662,100466169,245,will fix.,612974524,2017-02-10 11:36:13
20724823,125662,100463497,204,will fix.,612974524,2017-02-10 10:58:10
20724823,11239,100553908,40,"why are you deleting the existing item if `set` fails? If I understand this correctly, failing to set `key` to `value2` will delete existing `value1`, is that so?",614234346,2017-02-10 23:13:42
20724823,11239,100552810,56,`cas_ex`?,614234346,2017-02-10 23:08:33
20724823,125662,100638040,40,"Correct. The reason has much to do with cache invalidation:

For cache, it's generally considered worse to have stale/incorrect data than no data at all. In other words, proactive cache invalidation is desirable for correctness, as long as that doesn't ",614234346,2017-02-11 06:32:08
20724823,125662,100681758,40,"@seppo0010 I thought about it some more, and can see the appeal of not deleting upon exceptions. Basically it means a command that resulted in error has no side effects. (and client can retry).

The current behavior is inherited from [Twemcache](https:/",614234346,2017-02-12 10:23:19
20724823,125662,100681831,56,"oops, copy paste error",614234346,2017-02-12 10:28:10
20724823,11239,100691611,105,"`EXPIRY`, `FLAG`, `VAL` and `KEY` were not defined, remove `undef`",616375949,2017-02-12 21:10:06
20724823,11239,100691560,16,I prefer if `VAL1` and `VAL2` were not the same length as it can hide some arithmetic bug like subtracting remaining number of bytes instead of received bytes,616375949,2017-02-12 21:07:49
20724823,125662,100728945,16,fixed,616375949,2017-02-13 14:08:33
20724823,125662,100728949,105,fixed,616375949,2017-02-13 14:08:37
20724823,11239,98035671,4,"uhm, probably not meant to be commited",604498148,2017-01-27 00:43:48
20724823,11239,98037979,77,I don't think `item_data(it)` is null terminated,604498148,2017-01-27 00:52:28
20724823,11239,98039117,60,"I feel the test would be better if `val.len` was not exactly the half of `vlen` as it will make both sides to be the same length coincidentally, and an error may be missed because of it.",604498148,2017-01-27 00:57:18
21577547,125662,102119048,22,"I'm not sure if we want this logic in the unit test:
1. for initial local use, assuming the default ports are available and throw an error when not seems OK;
2. if running in Twitter's container environment, the port range is specified by the container ",626931289,2017-02-21 09:56:12
21577547,125662,102117878,20,Can you split out the socket related logic into its own class and module/file? This will allow multiple test files to share the same logic instead of having all tests in a giant file.,626931289,2017-02-21 09:42:49
21577547,125662,102118014,65,localhost instead of 127.0.0.1?,626931289,2017-02-21 09:43:57
21577547,125662,102258620,33,maybe use a simple command such as version on the admin port? But this is also fine for now.,628138057,2017-02-22 00:53:18
21577547,11239,102270219,33,The problem using a socket is that it fails to connect if you do it immediately and the server is not listening yet... reading from stdout is a lot more convenient!,628138057,2017-02-22 01:41:33
21811954,11239,103317921,104,remove,633590784,2017-02-28 05:35:06
21811954,11239,103312575,8,I believe python's community prefers `.client` in this situation (and `client` will fail with python3) to prevent cases where names are ambiguous with top level modules.,633590784,2017-02-28 05:09:35
21811954,11239,103313594,75,"why not just
`self.assertEqual(rsp, expected)`?",633590784,2017-02-28 05:14:46
21811954,11239,103319626,5,"why not just have a test_pelikan.py that searches for all sequences for twemcache, slimcache, etc.?",633590784,2017-02-28 05:42:47
21811954,11239,103312848,1,"This looks out of place... why are you changing this file now, here, in this branch?",633590784,2017-02-28 05:10:59
21811954,11239,103314044,81,"This could use a third parameter (an error message) including `k`, otherwise getting `3 is not equal to 2` is hard to understand, specially since many parameters may be checked in the same stacktrace.",633590784,2017-02-28 05:17:08
21811954,11239,103316880,38,"this structure is a bit more complicated than I expected... why don't you just make an array seq with three types of values, either request, response or stats and read it line by line? No need to aggregate them in a single sequence of all three... this is",633590784,2017-02-28 05:30:30
21811954,11239,103315410,30,Empty line between title and body of the documentation text,633590784,2017-02-28 05:23:29
21811954,11239,103317755,86,"```python
for r in req:
    self.send(req + DataClient.DELIM)
```

less data copy, and looks less error prone",633590784,2017-02-28 05:34:23
21811954,11239,103317413,81,remove `__init__`,633590784,2017-02-28 05:32:48
21811954,125662,103364921,8,"Ah I didn't know that- should have researched why . was prefixed.

Shall we request python3 in the script?",633590784,2017-02-28 10:38:28
21811954,125662,103365005,75,"Because I'm not very good at Python or other modern high level language?

Will fix.",633590784,2017-02-28 10:39:22
21811954,125662,103365080,1,It was throwing a compilation warning at me when I was running the test. I could exclude this and put it on a separate PR.,633590784,2017-02-28 10:40:18
21811954,125662,103365214,5,"Because test discovery right now is broken (due to how I wrote runTest method), so I need to fix it before use that style again.",633590784,2017-02-28 10:41:40
21811954,125662,103365597,38,"My goal was to enforce the test cases to be based on request-response pairs, so I actually would like to enforce the use of blank line between tests later, and enforce the ordering of request-response-stats. Line-by-line is simpler to write/load, but IMO ",633590784,2017-02-28 10:45:20
21811954,125662,103365665,81,Certainly. Will fix.,633590784,2017-02-28 10:45:58
21811954,125662,103377228,30,added,633590784,2017-02-28 12:59:11
21811954,125662,103377350,86,True. Probably also good for testing partial requests.,633590784,2017-02-28 13:00:29
21811954,125662,103377874,81,"removed, as well as in the adminclient",633590784,2017-02-28 13:06:39
21811954,125662,103378206,38,"You have a valid point about observing stats change mid-request though, which is something that we may want to do, and my assumption would force such sequence to be carried out by pretending we are sending two separate requests, which is not quite right.",633590784,2017-02-28 13:10:12
21811954,11239,103390161,1,"It's fine, I just wanted to make sure it wasn't accidental",633590784,2017-02-28 15:23:02
21811954,11239,103837094,38,It's unclear to me if you will make this change or keep it as is based on your comments.,633590784,2017-03-02 10:06:32
21811954,11239,103837002,8,did you change it?,633590784,2017-03-02 10:05:39
21811954,11239,103836881,3,remove,633881136,2017-03-02 10:04:29
21811954,125662,104148044,38,"I tried the .client, and realized it needs to work with python3 as-is. I suggest we keep it as-is for now and create a new issue to investigate the best practice for this (maybe alongside unittest discovery)",633590784,2017-03-03 20:58:57
21811954,125662,104148352,3,fixed,633881136,2017-03-03 21:01:25
21974468,125662,107812203,33,Created issue #149 ,650346310,2017-03-24 07:05:59
21974468,11239,107829118,276,overestimating for bulk as well,650361449,2017-03-24 10:27:26
21974468,11239,107830416,313,"```c
    ck_assert_int_eq(req->type, REQ_PING);

```",650361449,2017-03-24 10:45:34
21974468,11239,107830572,122,test oversize?,650361449,2017-03-24 10:48:24
21974468,11239,107830770,353,add test for incomplete bulk and another one for multi bulk (maybe even one case for each element type if you feel like it) and check that it returns EUNFIN and resets rpos,650361449,2017-03-24 10:51:25
21974468,11239,107829938,75,(this comment also applies for many tests below),650361449,2017-03-24 10:39:40
21974468,11239,107828559,157,address TODO?,650361449,2017-03-24 10:19:47
21974468,11239,107829522,58,"how about this?
```c
#define STR ""foobar""
#define SERIALIZED ""+"" STR ""\r\n""
```",650361449,2017-03-24 10:34:25
21974468,11239,107829933,58,(this comment also applies for many tests below),650361449,2017-03-24 10:39:37
21974468,11239,107829841,75,reusing `el` from the compose section makes this test less reliable as the production code may be not setting a property that is set by the previous portion of the test; break it up into two tests? use a second `el`-like variable instead? destroy its valu,650361449,2017-03-24 10:38:20
21974468,11239,107826499,126,`buf->rpos = old_rpos;`?,650361449,2017-03-24 09:52:17
21974468,11239,107827754,44,free rsp,650361449,2017-03-24 10:08:56
21974468,11239,107824796,54,"I believe this could be simplified a little further... since we decrement `d` when `n < 0`, we could not do that and just return `d`? now that I see it, it makes sense, as `d` is the original calculation for the number of bytes needed ???? ",650361449,2017-03-24 09:30:18
21974468,11239,107827249,49,unused?,650361449,2017-03-24 10:02:32
21974468,11239,107827449,58,`cc_free(req);`? do we care?,650361449,2017-03-24 10:05:25
21974468,11239,107824915,28,remove?,650361449,2017-03-24 09:32:04
21974468,2630136,107992412,9,protocol::redis::response,650361449,2017-03-25 03:25:29
21974468,125662,108261513,54,"d is the number of bytes printed, so we need to return the _original_ d not the decremented value (which is then used to print the unsigned). But it is true it can be made a little simpler. I have posted the changes to ccommon.

https://github.com/twitt",650361449,2017-03-28 02:44:09
21974468,125662,108262340,28,"Intend to add another parser function interpreting the CLI-friendly format, which is space delimitered, so this line makes sense as an exampleonce we have that.",650361449,2017-03-28 02:47:55
21974468,125662,108262541,126,fixed.,650361449,2017-03-28 02:48:57
21974468,125662,108263048,49,"This is intended for the functions processing actual commands, such as ```hmget KEY1 KEY2```. The processing logic should call this function to make sure the keys are valid.

Redis commands are structured such that it is hard to fully validate requests ",650361449,2017-03-28 02:51:08
21974468,125662,108263341,58,we do. Thanks for catching this.,650361449,2017-03-28 02:52:22
21974468,125662,108263359,44,fixed,650361449,2017-03-28 02:52:28
21974468,125662,108264597,276,updated/clarified,650361449,2017-03-28 02:58:12
21974468,125662,108264237,157,done.,650361449,2017-03-28 02:56:36
21974468,125662,108264950,58,"I thought about it before, it is less error-prone if we change test cases, on the other hand it is less readable by themselves. You are probably still right though it end up a little better.",650361449,2017-03-28 02:59:36
21974468,125662,108265737,75,Yea we should use two variables that are separately reset at the beginning.,650361449,2017-03-28 03:03:00
21974468,125662,108284668,58,Updated to use concatenation,650361449,2017-03-28 04:29:36
21974468,125662,109296708,58,tests updated to adopt the style you recommended,650361449,2017-04-02 06:37:28
21974468,125662,109296715,122,added,650361449,2017-04-02 06:37:41
21974468,125662,109296718,75,separate variables used now,650361449,2017-04-02 06:37:54
21974468,125662,109296726,9,fixed,650361449,2017-04-02 06:38:40
21974468,125662,109298653,353,"Good call, I caught two bugs!",650361449,2017-04-02 09:33:21
21974468,11239,109302092,130,"`#define INVALID_2 "":\r\n""`",660409258,2017-04-02 14:02:10
21974468,11239,109302030,311,"I believe C does not guarantee the functions will be called left to write. http://stackoverflow.com/a/4737379

Break these down into two statements:
```
n = buf_write(b, ""+"", 1);
n += _write_bstr(b, &el->bstr);
```",660409258,2017-04-02 13:57:51
21974468,11239,109301891,302,`s/CC_OK/COMPOSE_OK/`,660409258,2017-04-02 13:52:13
21974468,11239,109301766,102,if `len` is 0 shouldn't this return `EINVALID`? e.g.: `$\r\n`,660409258,2017-04-02 13:43:34
21974468,11239,109302123,165,"missing `ck_assert(el_p.type == ELEM_INT);`

these three could use a local macro to avoid duplication?

```c
#define TEST_SERIALIZE(serialized, value)\
    buf_reset(buf);\
    el_c.num = value;\
    ret = compose_element(&buf, &el_c);\
    ck_as",660409258,2017-04-02 14:05:09
21974468,125662,109317596,102,"Yea it should. OK I think read_int needs to a bit further tuning, current logic flow is error-prone.",660409258,2017-04-03 02:32:05
21974468,125662,109317632,311,Interesting.,660409258,2017-04-03 02:33:17
21974468,125662,109317654,165,"Well I think using an array is probably better, similar to test_unfin.",660409258,2017-04-03 02:33:48
21974468,125662,109317676,302,fixed.,660409258,2017-04-03 02:34:50
21974468,125662,109318070,130,added,660409258,2017-04-03 02:48:07
21974468,125662,109318075,165,rewritten with array + loop,660409258,2017-04-03 02:48:19
21974468,125662,109318098,311,all statements split.,660409258,2017-04-03 02:49:26
21974468,125662,109318354,313,fixed.,650361449,2017-04-03 02:57:44
21974468,2630136,107551831,33,"According to the coding style guidelines, this should be compose_rstatus_i",650346310,2017-03-23 05:45:31
21974468,2630136,107552753,31,COMPOSE_OK,650346310,2017-03-23 05:52:18
21974468,2630136,107554796,123,what if len == 0?,650346310,2017-03-23 06:07:09
21974468,2630136,107556365,213,simple,650346310,2017-03-23 06:19:29
21974468,2630136,107556595,258,COMPOSE_OK,650346310,2017-03-23 06:20:50
21974468,125662,107570930,33,"Yea you are right, and I noticed that too; let me create an issue to change this for all protocols.",650346310,2017-03-23 08:26:44
21974468,125662,107571181,31,fixed.,650346310,2017-03-23 08:29:12
21974468,125662,107571365,123,"apparently that means an empty string, not a null/nil string. I should add a test.
So I think the following should be legal:
""$0\r\n\r\n"" ",650346310,2017-03-23 08:31:13
21974468,125662,107571849,123,test added,650346310,2017-03-23 08:36:13
21974468,125662,107571863,213,fixed,650346310,2017-03-23 08:36:22
21974468,125662,107571924,258,fixed,650346310,2017-03-23 08:37:01
22435698,125662,106716430,19,"One thought: to decouple hotkey detection and (judiciously) breaking backward compatibility, can we first enable hotkey detection and log such occurrence to debug log ( or a separate log if you will), before trying to send the signal back to the client? S",646949224,2017-03-18 01:25:39
22435698,2630136,108002008,19,done.,646949224,2017-03-25 04:21:56
22986718,11239,109286430,48,why not receive a prefix here as well?,659955197,2017-04-01 21:43:59
22986718,125662,109709640,48,"Because after I implemented the ""dump"" command they realized having a ""count"" is sufficient :smi",659955197,2017-04-04 23:19:09
22986718,2630136,217878019,66,would we also want to check for expiry?,659955197,2018-09-15 13:54:15
22986718,125662,228699309,66,"I guess there're reasons to do either/both.

The only case I can think of where someone wants expired keys to be dumped, is to investigate how much space in cache is occupied by already expired keys. But that is a legitimate question that we have been a",659955197,2018-10-27 10:03:08
22986718,125662,228699425,48,"Alright, now I'm resuming this PR for actual merge, I'll take your suggestion and bring them to feature parity.",659955197,2018-10-27 10:09:30
23633622,11239,112673032,6,why not `strncasecmp`?,674153397,2017-04-21 19:06:38
23633622,125662,112792861,6,"Uhh, because I didn't do my home work. Good call.",674153397,2017-04-22 06:25:44
23633622,125662,112793401,6,Updated & tested again. Thanks!,674153397,2017-04-22 06:33:16
26145918,11239,125541339,104,missing `cc_free(t->idx);`,729322581,2017-07-05 08:26:17
26145918,11239,125541020,76,what would happen if `s` was not on the list? `prev`'d be the last element and it'll segfault or something? should there be an `ASSERT(l != NULL)`?,729322581,2017-07-05 08:21:27
26145918,11239,125537499,75,`c->state = CHANNEL_TERM` to be consistent with the one above,729322581,2017-07-05 07:01:07
26145918,11239,125542813,8,I thought that a listener may be subscribed to 0 channels (after unsubscribe it is not deleted)?,729322581,2017-07-05 08:49:33
26145918,11239,125542420,40,`cc_free(buf);`?,729322581,2017-07-05 08:43:07
26145918,11239,125539740,128,these errors should probably write an error message to the client instead of failing silently?,729322581,2017-07-05 07:55:53
26145918,11239,125541522,9,is there any reason to call it topic instead of channel? do we refer to something else as channel? you could add the reason to the comment here,729322581,2017-07-05 08:29:45
26145918,11239,125539241,45,I believe this would be more readable without this temporary variable and just using `el_r.num`,729322581,2017-07-05 07:45:35
26145918,125662,125715509,8,"The connection is still around, but no longer a listener. This is explained on redis.io in the [pubsub section](https://redis.io/topics/pubsub):

> unsubscribe: means that we successfully unsubscribed from the channel given as second element in the repl",729322581,2017-07-06 01:01:17
26145918,125662,125715903,9,"Oh yea I should explain. mostly ccommon (which Pelikan depends on and includes) already have the concept of a ""channel"" to mean some kind of connection (tcp, uds, pipe...)",729322581,2017-07-06 01:02:51
26145918,125662,126595935,75,done,729322581,2017-07-11 12:04:05
26145918,125662,126596118,45,"you are right, I changed it.",729322581,2017-07-11 12:06:16
26145918,125662,126596241,128,Let me keep you comment in mind for the moment- I need to handle errors in a number of other places as well but it's not immediately clear what Redis does/should do in this case. I'll research more and come back to this.,729322581,2017-07-11 12:07:45
26145918,125662,126596788,76,"You are right, the way I'm using it now assumes `l != NULL`, but I might as well allow passing in an invalid listener to simplify the deletion logic.

Eventually I want to add pooling to listener (and topic) to avoid calling malloc & free all the time, ",729322581,2017-07-11 12:13:54
26145918,125662,126597288,104,fixed,729322581,2017-07-11 12:19:00
26145918,125662,126597389,40,fixed,729322581,2017-07-11 12:20:16
26145918,2630136,201859239,5,"why are we renaming this? I think this name can cause some confusion, since it creates threads for both worker and server threads.",975487942,2018-07-12 05:27:21
26145918,2630136,201864193,5,maybe rename these to core_worker_run and core_pubsub_run,975487942,2018-07-12 05:53:57
38820268,11239,185943265,5,"It makes more sense to return `parse_rstatus_t` here since both callers are validating the size of the read buffer...

how about something like this?

```c
parse_rstatus_t
token_is_array(struct buf *buf)
{
    ASSERT(buf != NULL)
    if (buf_rsiz",998795696,2018-05-04 04:35:35
38820268,125662,186196059,5,"I don't think using parse_rstatus_t as the return type really makes sense for this function. 

And exactly because both callers are validating the size of the read buffer, they wouldn't proceed assuming they have a primitive element at hand when this fu",998795696,2018-05-05 02:41:25
38820268,125662,186196782,5,This is one of those functions that would be declared as a protected member if we were using an OO language. The only module that should use this one directly is the parser.,998795696,2018-05-05 02:45:08
39520881,2630136,189385767,42,"Do you think we can find an alternative value to indicate remove all? I think having 0 be this value can be quite misleading, and somebody who has not read this comment may just assume a call to remove with count == 0 will just be a no op. ",1013843388,2018-05-19 03:31:35
39520881,2630136,189387041,42,"it should work without needing to process count at all with int64 max and min, maybe we can define some macros to indicate these values",1013843388,2018-05-19 03:37:32
39520881,125662,189405021,42,"the `count == 0` behavior is borrowed from `LREM` syntax of Redis (https://redis.io/commands/lrem), I don't feel strongly about this either way but am happy to look for alternatives.

For example, we can perform the same check as in remove where count =",1013843388,2018-05-19 05:17:40
39520881,2630136,189415454,42,"I see, I'm fine either way as well, especially if ziplist is only going to be used for redis protocol for the foreseeable future. I'll defer to your judgment here. ",1013843388,2018-05-19 06:49:31
41733665,47822,199314434,89,herp derp,1056743188,2018-06-30 13:18:29
41733665,47822,199327083,17,"I wasn't sure how the path to the cdb file should be specified, i.e. config file or command-line arg",1056743188,2018-06-30 23:58:37
41733665,47822,199327133,5,I wasn't sure how to make this visible in rust. I guess having a function rust can call to get the value would be one way.,1056743188,2018-07-01 00:00:37
41733665,47822,199327216,86,This is where the newly added `rsp->vbuf` gets hooked up for use on the rust side.,1056743188,2018-07-01 00:03:35
41733665,47822,199327239,94,I was operating under the assumption that `rsp->flag` and `rsp-vcas` were ok to leave at 0 here for a read-only backing store,1056743188,2018-07-01 00:04:21
41733665,47822,199327568,37,"TODO: remove, cruft",1056743188,2018-07-01 00:16:27
41733665,47822,199327592,7,"This block, cargo-culted from the bindgen user guide, pulls all of the generated types in to the 'bindings' mod",1056743188,2018-07-01 00:17:58
41733665,47822,199531105,5,in a follow-up branch i've implemented this as a param that gets passed through to the cdb handle creation method.,1056743188,2018-07-02 22:14:30
41733665,125662,199946312,133,For RO backend this would be of no use. Delete?,1060166910,2018-07-04 03:51:37
41733665,125662,199945935,94,"yep, totally fine.",1056743188,2018-07-04 03:49:52
41733665,125662,199946542,277,I think you may save some space by collapsing these cases and apply something like `_process_unsupported()` to all of them.,1060166910,2018-07-04 03:52:34
41733665,125662,200215971,13,"RSP_VAL_BUF_SIZE is relatively large. If we allocate one such buffer per response (which I've been assigning/caching one per connection), you may end up using a lot of memory when the connection count is high. E.g. my current ""high connection count"" test ",1061170836,2018-07-05 08:28:01
41733665,125662,200215523,49,remove this one?,1061170836,2018-07-05 08:20:35
41733665,125662,200215561,69,merge the default function into this one,1061170836,2018-07-05 08:21:04
41733665,125662,200216273,20,CDB should have no use of the flush option,1061170836,2018-07-05 08:32:15
41733665,125662,200216447,185,"I think this can also be moved to the invalid section, `gets` is used for  subsequent`cas`",1061170836,2018-07-05 08:34:22
41843466,125662,199639418,5,default OFF,1056729400,2018-07-03 05:33:14
41843466,125662,199641314,52,can be deleted,1056729400,2018-07-03 05:44:27
41843466,125662,199639448,35,Nice.,1056729400,2018-07-03 05:33:23
41843466,125662,199641412,35,most of these can be deleted? I think the generic client error is sufficient.,1056729400,2018-07-03 05:45:09
41843466,125662,199641238,13,I think in a stable version this needs to be a server decision. So the capacity of the buffer will be announced to the storage module and storage can return the size of the data while copying things into this buffer. The treatment of return value in `snpr,1056729400,2018-07-03 05:43:57
41843466,125662,199639945,2,"Ideally I think it'd be nice to turn on cdb compiling if Rust is detected on the host, otherwise the target is skipped. Similar how test target is treated depending on whether check can be found or not.",1056729400,2018-07-03 05:35:56
41908086,2630136,199992541,30,"I'm not seeing this check in `tcp_reject()`. Do we want to retry accepting the connection in that function as well? If so, I think we can de-duplicate some of the code in this function and in `tcp_reject()`.",1060393057,2018-07-04 09:07:59
41908086,2630136,199994253,185,"shall we also make `hdl->reject` in admin thread also use `tcp_reject_all`? if so, i think we can get rid of `tcp_reject`.",1060393057,2018-07-04 09:25:03
41908086,125662,200214940,30,"That is because `tcp_reject()` calls `_tcp_accept()` which has this logic. For actual accept we have to process one socket at a time (hence the `break` at the end of the `for` loop in `_tcp_accept()`, but if we are rejecting connections we don't need to w",1060393057,2018-07-05 08:09:02
41908086,125662,200215231,185,Ah you called out something important here- admin thread can interfere with server thread still! So I will replace all the `*_borrow()` with `*_create()` and similarly on the return side so admin thread is not messing with resource pooling. This way we sh,1060393057,2018-07-05 08:15:00
41908086,125662,200218923,185,I'm not too worried about having too many incoming connections on the admin port and resulting in a multitude of stream objects being created. For the current use (mostly stats) that has negligible effect on the overall RSS.,1060393057,2018-07-05 09:06:16
41908086,2630136,200430280,14,"I think it would be good to document in a comment that buf_sock pool ""belongs"" to the server thread, for the sake of posterity",1061385718,2018-07-06 00:28:22
41908086,125662,200463059,14,Good idea. adding.,1061385718,2018-07-06 02:22:56
42046331,125662,200681733,5,add a new line?,1062951196,2018-07-06 22:04:51
42046331,125662,200684183,155,"At some point we need to consider the choice of logger for debug information, hopefully it'd be possible to stay consistent with the C portion of pelikan.",1062951196,2018-07-06 22:13:00
42046331,125662,200682922,16,Does Rust have style guide on the ordering of imports?,1062951196,2018-07-06 22:08:51
42046331,47822,200709199,16,"well, intellij's plugin does them strict alphabetical both linewise and inside the curlies.

Here's the style guide entry: https://github.com/rust-lang-nursery/fmt-rfcs/blob/master/guide/items.md",1062951196,2018-07-06 23:44:25
42046331,47822,200709679,155,It may be possible to hook the log crate into the existing pelikan log machinery by writing our own backend for it. I'll look into it.,1062951196,2018-07-06 23:46:12
42046331,47822,200710104,5,I believe this is cruft. I'll remove it,1062951196,2018-07-06 23:47:57
42046331,2630136,200726089,8,nit: indentation here looks off,1062951196,2018-07-07 00:49:29
42172254,125662,201139855,174,Can you move and preserve the comment quoting the memcached protocol's treatment of expiry around here?,1065738262,2018-07-10 03:40:35
42172254,125662,201195133,177,"Here we can call it `time_memcache2process_sec()`

For all the above, if the name seems way too long, we can use something else, or shorten them to be `time_u2p_*`, `time_d2p_*` and `time_m2p_sec()` (no need for finer-grain timestamp for memcache)",1065897592,2018-07-10 08:34:43
42172254,125662,201193001,95,"Do you think we can rename these primitives to make it more obvious when the clock started?
e.g., we can have:
`process_time_sec()`, `process_time_ms()` .... that were started when the process started.",1065897592,2018-07-10 08:16:05
42172254,125662,201194789,37,"I think the original typedef wasn't necessarily the best choice of name. Is this relative because the process itself is started at arbitrary time measured by Unix time, or is this relative because we are comparing against the process's clock? I would like",1065897592,2018-07-10 08:31:39
42172254,125662,201194939,165,"Here we maybe able to name it as `time_delta2process_sec()`, etc",1065897592,2018-07-10 08:32:58
42172254,125662,201194398,147,"I'm generally in favor of command line option (over compile switch), because then we can use the same binary for different settings without recompiling.

Also, the naming here is backward-compatible but may be challenged given the expansion to include f",1065897592,2018-07-10 08:28:22
42172254,125662,201195949,124,This function probably could be called `time_unix_sec()` and become more apparent.,1065897592,2018-07-10 08:41:37
42172254,125662,201196431,4,Was there an error without this line?,1065897592,2018-07-10 08:45:25
42172254,2630136,201435976,4,"`struct duration` can't be declared in pelikan without these definitions, since the definition of them in ccommon relies on these definitions being there. Without this, `struct duration` in cc_timer.h is just a forward declaration.",1065897592,2018-07-11 00:49:38
42172254,125662,201453526,147,"Actually, the real problem with compile-time option is that if Redis wants one style of timestamp but twemcache wants another it would be really hard to compile them at once.",1065897592,2018-07-11 01:44:47
42172254,125662,201553337,5,these can be removed I think?,1067115277,2018-07-11 10:06:10
42172254,125662,201553615,15,"Not your change- but I wonder if it's better to just set it to INT32_MAX, but maybe it's not that important...",1067115277,2018-07-11 10:08:15
42172254,2630136,201581868,5,"thanks for catching that, removed it.",1067115277,2018-07-11 13:57:43
42172254,2630136,201583326,15,filed #189 to look into this.,1067115277,2018-07-11 14:04:15
42966133,125662,205427812,11,"if `ttl = 0` gets translated to `INT32_MAX`, we can assume that any expiry less than that is an actual expiry instead of an approximation for ""never expire"". Since we start by ""selecting"" the first offset, in the case where no item has a shorter TTL, we w",1080700830,2018-07-26 18:55:09
42966133,125662,205424216,5,For consistency should we use `INT64_MAX` instead of `INT64_MAX - 1` in the finer grain timestamps?,1080700830,2018-07-26 18:40:02
42966133,2630136,205548547,11,"hm, I think you are correct. we don't need to make an exception for unbounded timestamp, i think i was thrown off by the ""legal timestamp"" comment. cool, i'll change this back to the original behavior.",1080700830,2018-07-27 00:56:26
42966133,2630136,205590198,5,"yes, thanks for reminding me. done.",1080700830,2018-07-27 03:22:13
42999728,2630136,205213309,43,ditto,1081291970,2018-07-26 01:18:32
42999728,2630136,205212454,29,should this be set to NULL after being destroyed?,1081291970,2018-07-26 01:15:57
42999728,2630136,205212591,14,nit: space before `*`,1081291970,2018-07-26 01:16:23
42999728,2630136,205213463,20,ditto,1081291970,2018-07-26 01:19:02
42999728,47822,205230167,29,good catch!,1081291970,2018-07-26 02:12:38
42999728,2630136,205284321,26,have you tested this? i think `bstring_set_text` only works for string literals,1081480256,2018-07-26 05:43:59
42999728,2630136,205284348,30,"adding these comments here, because github doesn't support inline comments outside of the diff:

line 78: we can just use bstring_init to reset value_buf
like 104: nit: i think you can just say `rsp->vstr = *vstr;`",1081480256,2018-07-26 05:44:06
42999728,47822,205303543,26,i think `bstring_set_raw` is for string literals. I've started up the server with this code and it answers queries.,1081480256,2018-07-26 07:51:20
42999728,47822,205303944,30,"ah, good call!

I wasn't 100% sure about the semantics for doing that assignment on 104 so i just did the safe thing :)",1081480256,2018-07-26 07:54:12
42999728,47822,205304003,29,"ok, i fixed that in the latest revision and added a test",1081291970,2018-07-26 07:54:43
42999728,2630136,205304021,26,"whoops, you are right. i misread.",1081480256,2018-07-26 07:54:50
42999728,47822,205304230,26,i had to try both :),1081480256,2018-07-26 07:56:44
42999728,125662,205486682,32,how arbitrary is the number 2048?,1081614174,2018-07-26 21:49:05
42999728,125662,205442882,13,Your git expertise is showing in this file ???? ,1081614174,2018-07-26 19:51:47
42999728,125662,205458598,4,nitpick: ending paren not strictly aligned.,1081614174,2018-07-26 20:37:09
42999728,125662,205498246,8,leaking Twitter-specific concept such as packer and service role here,1081614174,2018-07-26 22:19:50
42999728,125662,205444155,17,bash style Q: is it more common to have spaces around the pipe `|`?,1081614174,2018-07-26 19:55:58
42999728,47822,205502052,32,"non-arbitrary, that's how big the initial (primary) index size is. I'll use the constant I defined elsewhere, I just got lazy.",1081614174,2018-07-26 22:30:16
42999728,47822,205503512,8,"I mean, i'm open to suggestions. Seems like kind of a hassle to have this stored separately.

One thing we could do to keep this out of master would be to put it in an orphan branch (like `gh-pages`). That way it's still ""in the repo"" but it's not part ",1081614174,2018-07-26 22:34:06
42999728,47822,205506032,17,"[putting prosthetic neckbeard on top of actual neckbeard]

Most shell I've seen does _not_ put spaces around pipes, and I never do. It's not wrong to put spaces around the pipe (and I think some prefer that convention) but I always thought it's kinda am",1081614174,2018-07-26 22:41:25
42999728,47822,205510157,26,"some suggestions:

`bstring_set_raw` might be better named `bstring_set_literal`
`bstring_set_text` might be better named `bstring_set_char_p` or `bstring_from_char_ptr`",1081480256,2018-07-26 22:52:49
42999728,2630136,205603119,26,"I like `bstring_set_literal`. I think `bstring_set_cstr` is a clear name to me, not sure how you guys feel about it though. ",1081480256,2018-07-27 04:08:40
42999728,47822,205634233,26,"`bstring_set_cstr` is good. +1

Rust has `CStr`/`CString` to refer to a null-terminated string, so it follows that naming convention well. ",1081480256,2018-07-27 06:48:46
42999728,47822,205645719,8,Ok I figured out what to do: we can put the specific stuff in source. I don't know why i didn't think of that before.,1081614174,2018-07-27 08:23:28
42999728,125662,206086179,26,Created https://github.com/twitter/ccommon/issues/175 to update APIs as suggested,1081480256,2018-07-30 17:36:52
42999728,125662,206086822,5,"So this assumes python directs to python2. Probably fine for now, just want to point out.",1083502457,2018-07-30 17:39:52
42999728,125662,205457118,26,"Saw my old comment ` /* TODO(yao): rename this */` in `cc_bstring.h`, I'm happy to rename either or both if you both think the name is confusing.",1081480256,2018-07-26 20:34:04
42999728,125662,205498732,47,ditto,1081614174,2018-07-26 22:21:11
42999728,47822,206318905,5,"ugh, ok you're right. i'll fix it",1083502457,2018-07-31 03:57:43
42999728,47822,206330750,5,fixed in #199,1083502457,2018-07-31 04:38:15
43457934,125662,208430734,7,"I think it's cheap if we:
- inline this function;
- make (slab) profile visible (so we can define an inline function in the header);
- implement as `return (profile[it->id] <= item_size(it) + len);`

Mostly this is cheaper because `item_slabid` does ",1089781693,2018-08-08 08:14:07
43457934,125662,208430861,7,"Also, maybe changing `len` something like `delta` or `increment` will make the purpose of the function even more obvious?",1089781693,2018-08-08 08:15:15
43457934,125662,208432692,14,"What do you think the relationship between `ziplist_remove` and `ziplist_trim` should be? I admit I haven't thought about this very carefully, but do you think trim will either enable or simplify implementation of commands that remove doesn't support well",1089781693,2018-08-08 08:31:04
43457934,2630136,208745711,14,"I probably haven't thought about this carefully enough either. The most obvious benefit of `ziplist_trim` as currently implemented right now is it saves on one remove call if we are trimming in the middle of the list. But for other cases, it is essentiall",1089781693,2018-08-09 04:42:42
43457934,125662,208774261,72,"Good catch guarding against empty pointer. Shall we use an internal variable and assign that to `*removed` at the end, to avoid extra jump instructions?",1089781693,2018-08-09 07:17:10
43457934,125662,208774097,69,"I feel this is probably me not explaining what I was thinking when implementing this function- I was leaning toward leaving the translation (""0 -> all"") to the upper layer, similar to how we handled TTL timestamps in the protocol/storage, to keep the lowe",1089781693,2018-08-09 07:15:56
43457934,2630136,208777444,69,"yea, i actually like the original behavior better too. the reason i changes this is that count == 0 for lrem in redis means remove all. i will revert this; perhaps we can move this logic out to protocol if we want to support the redis behavior. ",1089781693,2018-08-09 07:41:20
43457934,2630136,208778245,69,"however, returning error also seems wrong to me. intuitively, it seems like this case should just be a no op",1089781693,2018-08-09 07:47:21
43457934,125662,209037651,69,"Agree that noop is the better behavior.

This file is part of ""data_structure"", we can still put the translation in Redis' lrem implementation, e.g. in `src/server/redis/data/cmd_list.c` or somewhere like that.",1089781693,2018-08-10 01:40:27
14651157,11239,63021903,16,"unnecessary check, `free(NULL)` is safe",442785360,2016-05-12 20:44:28
14651157,11239,63034534,13,"Since `p` and `pr` do not overlap, you may use `memcpy` which is faster.",442785360,2016-05-12 21:54:06
14651157,125662,63255937,5,"Is it better to put the macro & alternative implementation inside _cc_realloc? There seems to be some duplicate in terms of logging, etc.",444505942,2016-05-14 04:48:33
14651157,125662,63256791,9,"Style wise, I prefer breaking down a compound expression like this, and add some comments about what we are trying to achieve.
```C
pr = realloc(ptr, size); / * use the native realloc to make sure we copy the right amount of data to the location pointed",444505942,2016-05-14 04:57:03
14651157,125662,63257174,9,I guess the current impl does save you one `free(p)` when allocation fails. So feel free to leave the above rewrite and just add the comment somewhere. ,444505942,2016-05-14 05:00:55
14651157,2630136,63261356,5,"I'm not so sure this would be cleaner. The log messages and the return statement are the only duplicated lines, and using macros within the function body is messier than having them outside. ",444505942,2016-05-14 05:47:45
14651157,125662,63263133,5,I think you are right on this one.,444505942,2016-05-14 06:13:49
14651157,125662,63263225,5,"Not a huge fan of the function name, which does not describe the *nature* of the difference, how about `_cc_realloc_move`?",444505942,2016-05-14 06:15:11
14651157,125662,63263348,35,"Use a leading `*` per-line for block comments
```C
/*
 *
 */
```",444691836,2016-05-14 06:16:49
14651157,125662,63435048,8,"The return value is not `NULL` when size is 0, which is probably not the behavior we want.
I wrote the following test program:
```C
#include <stdio.h>
#include <stdlib.h>

int main()
{
    char *p = NULL;
    p = malloc(0);
    printf(""%p\n"", p)",445616478,2016-05-17 05:10:34
14651157,2630136,63445827,8,"That was actually intentional; according to the [C99 Standard](http://cs.nyu.edu/courses/spring13/CSCI-GA.2110-001/downloads/C99.pdf):
""The  order  and  contiguity  of  storage  allocated  by  successive  calls  to  the calloc, malloc, and realloc functi",445616478,2016-05-17 06:52:26
14651157,125662,63448468,8,"From ccommon's perspective, I think we should remove such ambiguity (e.g. implementation-defined behavior), and always return a `NULL` pointer (since the address is never meant to be accessed by the caller). Hence having the check and return value set at ",445616478,2016-05-17 07:22:09
14766546,125662,63440917,4,"can you add a comment on this line for the purpose of the noop?

otherwise ???? ",447063117,2016-05-17 06:04:01
22024980,11239,104332623,7,"apparently `llabs` returns an `int64_t` and if `n` is `INT64_MIN` the behaviour is undefined... do we want to support that case? http://www.gnu.org/software/libc/manual/html_node/Absolute-Value.html

Some thing happens in the non-unsafe function.",638358154,2017-03-06 09:38:56
22024980,11239,104332778,37,"micro optimization
```c
  if (n < 0) {
    *buf++ = '-';
    d--;
  }

  _print_uint64(buf, d, n);
// ...
```",638358154,2017-03-06 09:42:32
22024980,125662,105730883,7,Good catch. I'll use a different way getting the absolute.,638358154,2017-03-14 01:05:07
39097569,2630136,47394741,5,"Feel like this can be named better, this is sacrificing too much readability for the sake of reducing verbosity. Maybe FREEPOOL_PREALLOC_ARG?
",1004637389,2015-12-12 03:32:33
39097569,2630136,47394875,13,"The return type for a function definition should be on a line of its own.
",1004637389,2015-12-12 03:33:30
39097569,11239,47421272,13,"We are not doing that on the functions above... don't `static inline` function get a pass?
",1004637389,2015-12-12 08:20:43
39097569,2630136,47465360,13,"Is that so? I think we at least do that in the .c files, even for static inline functions. We should establish a rule for this. In my opinion, we should be consistent about this, regardless of if it's in a source file or a header file.
",1004637389,2015-12-14 14:46:39
39097569,11239,47524012,13,"Apparently these were the exception. I fixed them. :grinning: 
",1004637389,2015-12-15 00:59:57
39097584,125662,48902261,6,"This does look neater, but it doesn't fit the `channel_recv_fn` signature any more.
I do acknowledge that it is nice to call receive or send with the maximum capacity of the buffer without having to calculate the exact number of bytes in those buffers. Th",1004637610,2016-01-06 06:00:17
39097584,11239,48922376,6,"@thinkingfish I didn't realize I was breaking the `channel_recv_fn` signature. However, `nbyte` was practically unused (only used for logging) before this patch, so I can add it back doing nothing and it doesn't break the existing behavior. However it see",1004637610,2016-01-06 10:36:37
42172968,125662,201141770,23,do you want to prepend instead of append?,1065749324,2018-07-10 03:47:26
42172968,125662,201149656,14,`()`->`(void)`,1065749324,2018-07-10 04:16:00
42172968,125662,201149222,327,I lean toward either naming the rs-C APIs `rs_*` (e.g. `rs_log_setup()`) or `*_rs`(`log_setup_rs()`) even just for the sake of simpler regex for search.,1065749324,2018-07-10 04:14:21
42172968,125662,201143142,128,???? ,1065749324,2018-07-10 03:52:15
42172968,125662,201142012,2,"at some point we need to fix the year line across the repo, but not today",1065749324,2018-07-10 03:48:19
42295955,47822,203816259,85,"[observation] It seems a little odd to me that all of these are `__ATOMIC_RELAXED`. I would have expected at least some to be `__ATOMIC_SEQ_CST` or `__ATOMIC_ACQ_REL` (basically enforcing _some_ form of barrier).

I don't have any experience with these ",1068155152,2018-07-20 00:49:59
42295955,47822,203817214,108,"should probably check for NULL pointer here

```
if ((arr == NULL) || (*arr == NULL)) {
    log_error(""ring_array_destroy passed NULL pointer"");
    return;
```

(or if we want to be especially bold make it an assertion)
",1068155152,2018-07-20 00:53:18
42295955,2630136,203818274,85,"basically, with the producer/consumer model that the ring_array is intended for (which is used in pelikan for server/worker thread connection handoff, where server is the producer and worker is the consumer), we use a ""pessimistic"" view for rpos and wpos ",1068155152,2018-07-20 00:56:55
42295955,47822,203819168,85,"Wow, ok, thank you for the explanation, that makes sense ???? ",1068155152,2018-07-20 00:59:39
42295955,2630136,203819387,108,"good call, thanks! ",1068155152,2018-07-20 01:00:23
42587714,2630136,203203320,12,nit: prevailing style in this repo is to have a space between `for` and `(`,1073705267,2018-07-18 05:36:31
42587714,2630136,203204750,17,"nit: prefer `sizeof(*rv)` in this case. it probably doesn't make much of a difference here, but by using `sizeof()` this way, if the type of `rv` changes, we can avoid making this change in multiple places.",1073705267,2018-07-18 05:44:22
42587714,2630136,203204369,23,"why not just start by allocating struct bstring to the pointer and initializing/allocating the underlying buffer there, instead of copying from this bstring on the stack?",1073705267,2018-07-18 05:42:32
42587714,2630136,203204864,16,nit: prevailing style in this repo is to use /* */ style comments only,1073705267,2018-07-18 05:45:00
42587714,2630136,203211812,19,This should be cc_free,1073757768,2018-07-18 06:25:21
42587714,47822,203210797,23,"So my thought was that if the `cc_alloc` fails, I don't have to clean anything up, I can just return NULL and don't have to worry about freeing the pointer. I can change it if this isn't idiomatic.",1073705267,2018-07-18 06:18:50
42587714,47822,203210952,17,ah! good to know!,1073705267,2018-07-18 06:19:43
42587714,2630136,203258125,8,We need to check if the cc_alloc succeeded here. Also echoing what I said earlier re: sizeof().,1073872311,2018-07-18 12:53:06
42587714,2630136,203211819,23,"I think allocating the pointer and initializing that directly results in the same number of failure clean ups. Like this:
```
struct bstring *bs = cc_alloc(sizeof(*bs));
if (bs == NULL) {
    return NULL;
}

bs.len = size;
bs.data = cc_alloc(size)",1073705267,2018-07-18 06:25:23
42788795,47822,204218504,26,"need to fix this path, should be: `ccommon/rust/ccommon_rs/src/log/mod.rs`",1077371119,2018-07-22 01:49:01
42788795,125662,204296098,21,This leaks Twitter-specific environment variables. What's the binary dependencies on these folders and can we replace them by something already set in environment?,1077371119,2018-07-23 13:50:52
42788795,47822,204382411,21,"unnecessary, i'll remove it",1077371119,2018-07-23 19:29:56
43086080,125662,206116190,74,remove this line?,1082905579,2018-07-30 19:35:56
43086080,125662,206114659,6,"here the capacity is only used for logging, and after the code change the description no longer matches the function called. Maybe rewrite as `log_verb(""destroy buf %p size %""PRIu32, *buf, buf_size(*buf));`?",1082905579,2018-07-30 19:30:10
43086080,2630136,206244817,74,"actually, i think this assumption i made is incorrect, and `realloc` doesn't guarantee success while trimming, and it depends on the implementation. so I guess the best thing would be to return a status here, but the original buffer will still be valid.",1082905579,2018-07-30 23:50:44
43086080,2630136,206245342,6,"the capacity/size here is also used for the stats calculation below, and using `buf_capacity` was giving us incorrect stats. but yes, I will change the log message.",1082905579,2018-07-30 23:52:30
43237367,11239,58050438,16,"how does 16 and 4 relate to the value 8?
",420681694,2016-03-31 20:13:26
43237367,2630136,58113834,16,"16 KiB \* 2^8 = 4 MiB
",420681694,2016-04-01 02:31:47
43237367,8208489,58117418,20,"I guess the way it was before is due to the 2*4 space second line indent rule that we were following in some places, and not following in a few other places. 
It might be better to clarify the indent rule some more in the coding style guide. 
Should args ",420681694,2016-04-01 02:56:10
43237367,125662,58126502,20,"My opinion is to always use the 8-character indentation for arguments, second line and beyond. Aligning arguments  after the opening parenthesis creates all kinds of odd indentations that are not editor friendly, even they can be more visually pleasing. E",420681694,2016-04-01 03:58:08
43237367,2630136,58130275,20,"Does vi not indent that way? Emacs automatically indents to the open parenthesis, but I can configure it to behave the way you described.
",420681694,2016-04-01 04:24:57
43237367,125662,58133706,20,"vi's default behavior is to used a fixed size, which can be specified per language (specified by shiftwidth or something like that).

Both CLion and sublime text have a toggle for this: e.g. http://www.sublimetext.com/docs/2/indentation.html

The current ",420681694,2016-04-01 04:49:02
43237367,125662,58142956,20,"So the practical concern here is- unless people have their editors lined up to do align-to-bracket, we will probably just have slight inconsistencies or back-and-forth tweaks depending on who was editing and what setting was used.

I think fixed-indentati",420681694,2016-04-01 06:14:01
43237367,125662,58143332,9,"Please don't remove these spaces, the fields are all `K*ind + 1` aligned, `ind` being 4, which is the indentation width (== 4 in our case). This is to tab between the fields easily
",420681694,2016-04-01 06:18:26
43237367,125662,58143528,16,"ditto
",420681694,2016-04-01 06:20:18
43237367,125662,58143547,9,"ditto
",420681694,2016-04-01 06:20:27
43237367,125662,58143567,20,"ditto
",420681694,2016-04-01 06:20:34
43237367,8208489,58148855,20,"+1 for 8-char indent.
I believe 2*indent-size for the second and subsequent continuation lines seems to be the default style across languages at Twitter (at least in the few code-bases that I worked on).
For example: https://docbird.twitter.biz/java_style",420681694,2016-04-01 07:32:54
14580261,269478,62720584,6,keep 'strong consistency'? ,442004387,2016-05-11 00:57:10
14670299,186547,63067135,4,"I realize adding a new dependency could be an issue, at least it's under the test scope.",443073498,2016-05-13 00:59:17
14670299,269478,63125264,4,we love jmock. +1,443073498,2016-05-13 09:14:28
14712789,3718281,63273271,5,"FileAppender `ROLLINGFILE` does not exist in default log4j.properties, it's `R` instead.",445748012,2016-05-14 15:51:13
14712789,3718281,63273349,29,"@sijie as the offline discussion, a wrapper is preferred to `c.t.dl.service.DistributedLogServerApp` directly, I find this already exists.",445748012,2016-05-14 15:58:44
14740494,186547,63300469,15,s/is/are/,446484602,2016-05-16 06:48:38
14740494,186547,63300473,17,s/purpose/purposes/,446484602,2016-05-16 06:48:54
14740494,186547,63300482,19,s/persist/persists/,446484602,2016-05-16 06:49:13
14740494,186547,63300544,20,s/are/is/,446484602,2016-05-16 06:51:47
14740494,186547,63300563,30,Maybe move this sentence above the previous one.,446484602,2016-05-16 06:52:46
14740494,186547,63300567,36,s/need/needs/,446484602,2016-05-16 06:53:01
14740494,186547,63300583,5,We've found that the following settings have given us the best performance,446484602,2016-05-16 06:54:10
14740494,6370257,65082277,14,":). Maybe ""mvn package -DskipTests"" is more simple here.",446484602,2016-05-30 21:56:39
14966488,186547,64854251,42,you can get rid of the i index and replace the array with an ArrayList appending as you go. ImmutableList.copyOf can take a Collection,451551525,2016-05-27 10:47:25
14966488,186547,64854361,29,"Guava already exists and has a HostAndPort.fromString(""..."").withDefaultPort(2181)",451551525,2016-05-27 10:48:39
14966488,186547,64855013,55,"```
final StatsProvider statsProvider = getOptionalStringArg(cmdline, ""pd"")
  .transform(new Function<String, StatsProvider>() {
    @override 
    public StatsProvider apply(String name) {
      return ReflectionUtils.newInstance(name.get(), StatsPr",451551525,2016-05-27 10:59:14
14966488,186547,64927780,42,"Even better, build an ImmutableList using the Builder and eliminate the copy.",451551525,2016-05-27 23:02:53
14966488,269478,65108944,55,cool,451551525,2016-05-31 05:31:59
14966488,269478,65108407,42,yup. that's a good suggestion.,451551525,2016-05-31 05:14:55
14966488,269478,65108523,29,that's a very helpful util,451551525,2016-05-31 05:19:14
15214606,40917,66001457,5,is there a reason to use the snapshot instead of the release ?,457653153,2016-06-07 09:26:27
15214606,40917,66001508,20,we try to follow Google's shell style. You should use `$(which javac)` instead of backticks here.,457653153,2016-06-07 09:27:16
15214606,40917,66001657,22,use `apt-get install -y --no-install-recommends` to avoid installing too many things,457653153,2016-06-07 09:29:33
15214606,40917,66001729,34,for i in $(seq 1 $NUM_SK); do,457653153,2016-06-07 09:30:38
15214606,8636144,66008216,5,This is to make sure that it takes this particular change: https://github.com/twitter/bookkeeper/pull/2 into account. But this works without this change too. Will update the pull request with all the comments taken care of.,457653153,2016-06-07 11:22:07
15214606,8636144,66009365,5,"Sorry, I realized that this works only with the said change request being pulled into BK. So we should get that in first.",457653153,2016-06-07 11:44:02
15214606,269478,66194820,5,@arvindkandhare I merged your bookkeeper pull request. will try to produce a version tomorrow,457653153,2016-06-08 12:35:24
15214606,269478,67596941,5,@arvindkandhare I pushed a version '4.3.5-TWTTR-OSS'. Could you update the version?,457653153,2016-06-18 13:49:32
15214606,8636144,67603310,5,Sure. Updated the pull request with the latest version.,457653153,2016-06-18 23:49:14
15380984,40917,68517301,3,replace () with <>,469061392,2016-06-27 09:39:44
15010078,11442576,64519525,60,"component configuration can be overridden by using heron-cli. I suggestion we separate the ""System Configuration"" and ""Component Configuration"".

For System Configuration:
Heron system configuration is used by the whole cluster. It is discouraged to mo",452456784,2016-05-25 13:05:41
15010078,2183863,64521044,60,"In heron-internals.yaml, configs are separated in two parts: generic for any component, and component-specific.

Any configurations in heron-internals.yaml currently can not be overriden by heron-cli, for instance, the configurations for heron-instance;",452456784,2016-05-25 13:26:10
15010078,11442576,64527552,60,"LGTM. 

One more place to improve: not pasting the http link directly. 

Change 
```
whose docs are located under deployment section: https://github.com/twitter/heron/blob/master/website/content/docs/operators/deployment/configuration.md
```
to
`",452456784,2016-05-25 14:37:14
15010078,73683,64577702,13,s/Currently it is static/These settings are fixed,452456784,2016-05-25 21:03:04
15010078,73683,64578048,57,Heron configurations apply globally to a cluster. It is discouraged...,452456784,2016-05-25 21:04:42
15010078,73683,64578274,59,It is not possible to to override heron configurations for a...,452456784,2016-05-25 21:05:52
15010700,64790,64630334,7,"What do you mean by ""internal"" here? Make sure to clarify because there are a lot of moving pieces at work in Heron.",452474795,2016-05-26 01:47:38
15010700,2183863,64633557,7,"For ""internal"", I mean it is config applies to the whole cluster, and is transparent to topology developers (it is impossible for them to override it)",452474795,2016-05-26 02:05:33
15010700,2183863,64656861,7,sounds good. updated.,452474795,2016-05-26 04:29:40
15010700,64790,64648395,7,"I'm not sure how others feel about this, but it might be better to call this doc ""Intro to Heron Cluster Configuration."" ""Internal"" is just a bit too vague for my tastes. Then, the first few sentences could be something like this:

""Heron clusters can b",452474795,2016-05-26 03:36:01
15015666,2183863,65442183,51,Can u make it into two classes: IncomingPacket & OutgoingPacket with similar interfaces in c++/java IncomingPacket & OutgoingPacket?,452612099,2016-06-02 04:03:39
15015666,3201045,65646314,51,@saileshmittal - can you incorporate this?,452612099,2016-06-03 08:37:43
15018508,73683,64685454,38,why do we need 2 copies of the javadocs in multiple folders?,452628264,2016-05-26 09:53:06
15018508,64790,64685749,38,"This is related to #798. It's a proposed (and hopefully temporary) solution
that will enable us to use Javadocs locally and on the live site without
issue.
On Wed, May 25, 2016 at 7:53 PM Bill Graham <notifications@github.com>
wrote:

> In website/scripts",452628264,2016-05-26 09:56:06
15018508,73683,64685817,38,Just saw the same change in #798 and commented on it. Let's discuss there.,452628264,2016-05-26 09:57:08
15020115,6849672,65659723,356,"Here was the issue.  s/\\""\""/gc and the heron-executor ran.
",456945884,2016-06-03 12:57:59
15020115,6849672,65659760,394,This is why it was double escaped.,456945884,2016-06-03 12:58:33
15022497,2183863,64695432,20,"The doc is a little outdated: IConfigLoader or IRuntimeManager is no longer there. You don't need to update them in this PR, but can u add an issue so we can trace and correct Scheduler-related docs?",452714908,2016-05-26 13:06:09
15022497,13159450,64695958,20,"done, see #809 ",452714908,2016-05-26 13:14:29
15048192,3201045,64969974,8,@lucperkins - why the heron version is hard coded. It might be hard to maintain this.,453287041,2016-05-28 04:40:00
15070144,143033,64939683,46,"Seems its not easy to customize the output format. If you can make it work with the `RawDescriptionHelpFormatter`, then this would not be needed. Otherwise, its okay to have it.",453787505,2016-05-28 00:26:31
15070144,143033,64940115,14,+1 for refactoring. Should we call it `cli_helper` or just `helper`?,453787505,2016-05-28 00:29:41
15078403,73683,65228143,2,Please provide some human-speak comment that gives an overview of what this script does.,453967376,2016-06-01 00:37:00
15078403,64790,65233506,2,@billonahill Done,453967376,2016-06-01 01:06:40
15143734,64790,65243297,27,"A few things:

* s/zookeeper/ZooKeeper
* s/readonly/read-only
* without creating a `/topologies` node (instead of just ""without creating `/topologies` node)
* s/rootpath/root path",455792717,2016-06-01 02:01:43
15143734,64790,65228146,27,"A few things:
- s/Not/Note
- s/zookeeper/ZooKeeper
- s/readonly/read-only
- ""without creating a `/topologies` node"" instead ""without creating `/topologies` node""
- s/rootpath/root path",455791049,2016-06-01 00:37:01
15149193,2183863,65282587,4,"This leads to the issue that storm-compatibility, (or anything with simulator), contains the whole heron-instance dependencies, which is not expected since it complicates the storm-compatibility's dependencies a lot.",455898642,2016-06-01 06:49:48
15149193,11442576,65289773,4,"As a discussion result, we deferred this issue later. Will close the pr.",455898642,2016-06-01 08:20:56
15186206,143033,65623088,212,4 spaces.,456482120,2016-06-03 04:36:36
15186206,2067843,65625346,212,fixed with latest commit,456482120,2016-06-03 04:51:39
15186206,143033,65627269,5,"Put it in alphabetical order.

In other places, we used globs so that we don't need to add every file manually.

```
srcs = glob(
        [""**/*.py""],
        exclude = [""main.py""],
    ),
```

I won't mind doing that here either.",457622508,2016-06-03 05:05:25
15186206,11442576,67785188,82,`cli_helper.run.run_helper` should be `cli_helper.run`,465954987,2016-06-21 06:26:48
15186206,11442576,67790394,5,should be `cli_helper.run`,467190079,2016-06-21 07:23:30
15186206,2067843,67792545,5,@nlu90: fixed and merge latest from master,467190079,2016-06-21 07:51:25
15186206,11442576,67793651,5,@alanngai I'm looking at the commit 7eb8cdf. Seems the typo is not fixed yet,467190079,2016-06-21 08:05:38
15186206,11442576,67797261,6,"On line 151 of file handlers/api/topology.py, `diameter = common.graph.TopologyDAG(lplan).diameter()`, `graph` is also used as member of the common module. We need to add one line here to include it in the common module `from heron.ui.src.python.handlers.",467214758,2016-06-21 08:55:36
15186206,2067843,67903202,5,"oops, i was looking at the redundant run.run_helper.  Apologies",467190079,2016-06-21 23:28:54
15186206,13159450,70294595,1,why reverting this file can make style checker work?,475154554,2016-07-11 23:52:51
15186206,7235147,70198161,1,I reverted this file and got it to work. For this patch can we revert this file and then try to improve it in another patch?,475154554,2016-07-11 10:28:59
15244946,3201045,65797905,24,space required between $getting_started_url and 'for',458406338,2016-06-04 12:49:27
15281801,3201045,66917022,1,"Thanks for the fix. In order for the travis ci to compile correctly, you need to download bazel 0.2.3 in the .travis.yml 
https://github.com/twitter/heron/blob/master/.travis.yml

Can you make the changes and update the PR?",459982921,2016-06-14 13:54:02
15281801,74460,66947700,1,"Hi @kramasamy I have fixed this bug. 

The Travis CI still not pass yet, I will  get into the root of the matter to find out why.",459982921,2016-06-14 17:48:01
15281801,73683,67537183,5,Please update to use `{{% bazelVersion %}}` here and below.,465547000,2016-06-17 23:22:01
15281801,73683,67537245,18,"Please update to use `{{% bazelVersion %}}` here, above and below.",465547000,2016-06-17 23:22:27
15281801,73683,67537273,7,Please update to use `{{% bazelVersion %}}`.,465547000,2016-06-17 23:22:40
15281801,3201045,67638108,7,@caofangkun - can you include @billonahill feedback on the docs?,465547000,2016-06-20 12:36:31
15281801,74460,67641411,7,"@kramasamy OK, I will do it .",465547000,2016-06-20 13:34:59
15281801,5458092,67793876,11,s/linux/darwin/,466847260,2016-06-21 08:08:48
15281801,74460,67799727,11,fixed.,466847260,2016-06-21 09:33:11
15297496,2183863,64171739,16,"The config is removed, no longer used/needed.",464767365,2016-05-23 12:53:10
15297496,2183863,64171822,2,"I don't think LocalFileSystemStateManager will work in distributed environment,",464767365,2016-05-23 12:54:35
15297496,2183863,64171851,11,Here you may need to specify the JAVA_HOME in target slave hos running heron.,464767365,2016-05-23 12:55:17
15297496,2183863,64171962,117,"Will getFreePort() work in distributed environment? Need we request the ports ahead beofre deployment and then use the reserved ports provided? Otherwise, how could we guarantee and isolate the resource?",464767365,2016-05-23 12:57:40
15297496,2183863,64172225,33,"https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/ShellUtils.java#L202
,
https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/ShellUtils.java#L180
or,
https://github.co",464767365,2016-05-23 13:02:39
15297496,2183863,64172230,46,"https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/ShellUtils.java#L202
,
https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/ShellUtils.java#L180
or,
https://github.co",464767365,2016-05-23 13:02:42
15297496,2183863,64172325,51,"Though we do a check for ""null"", according to the design/comments of this method, it should return empty list when there are no job pages associated.",464767365,2016-05-23 13:04:39
15297496,6377806,64266572,16,"Fixed it by copying the conf file from aurora directory. 
@maosongfu I think this model can be improved. Currently a conf change needs to be duplicated for all the schedulers. I think the default configs should be put in the core directory. Schedulers co",464767365,2016-05-24 01:41:12
15297496,6377806,64267048,2,@maosongfu  This is correct. This config is for local mode yarn integration only. It is expected that user will update this conf file and provide ZK details. The reason I was avoided ZK is that it will always be incomplete as ZK config is not known till h,464767365,2016-05-24 01:44:01
15297496,6377806,64267219,11,Not needed for REEF as scheduler is invoked as a library by a running java process.,464767365,2016-05-24 01:45:03
15297496,6377806,64267790,117,"For YARN resource manager, PORT is not a resource. As a result ports cannot be reserved in advance. To the best of my knowledge, YARN applications grab a free port at run time. I think in cases where port cannot be reserved, the heron components started b",464767365,2016-05-24 01:48:16
15297496,6377806,64272262,33,Fixed. Used `ShellUtils.extractPackage`. Thanks,464767365,2016-05-24 02:17:10
15297496,6377806,64272324,46,Fixed. Used `ShellUtils.extractPackage`. Thanks,464767365,2016-05-24 02:17:38
15297496,6377806,64272647,51,Fixed.,464767365,2016-05-24 02:19:52
15297496,6377806,64287575,2,"BTW, the default for Aurora Scheduler is Local FS too: https://github.com/twitter/heron/blob/master/heron/config/src/yaml/conf/aurora/statemgr.yaml",464767365,2016-05-24 03:57:24
15297496,2183863,64292462,117,Fair.,464767365,2016-05-24 04:28:41
15297496,2183863,64292535,2,sounds good.,464767365,2016-05-24 04:29:09
15297496,2183863,64292724,11,"Then could remove this config, or provide a stub value for it with comments?",464767365,2016-05-24 04:30:17
15299086,13159450,65971647,33,"maybe refactor to 

""If it's not convenient to check the output and logs in intellij console, you can save them to a local file by choosing `Run -> Edit Configurations....` as shown in the following image:""",459856994,2016-06-07 04:22:06
15299086,11442576,65974325,33,"I remember there's a discussion about not using ""you"" in the doc. I'll change other 'you's occurred in this doc to 'one'",459856994,2016-06-07 04:39:27
15299086,64790,65981108,33,"The result of that discussion was that ""you"" is okay in tutorial-style docs but not quite as welcome in things like REST API docs or Javadoc. In this case, I think it's appropriate.",459856994,2016-06-07 05:27:13
15299086,11442576,65994865,33,"Thanks for the clarification @lucperkins.

Do you think I need to revert the 'you' changes? Or we can just merge this PR here?",459856994,2016-06-07 07:51:07
15299086,73683,66167394,31,"Lowercase 'right click'.

Also here and elsewhere best to line break these at 80 or 100 to make it easier to provide comments and read in an IDE.",459867688,2016-06-08 05:56:38
15299086,73683,66167704,33,"As refactored, I think this reads well when just desribing how to tools work without saying what ""you need to do"". For the @objmagic suggestion to be consistent you could remove ""you can"" from the sentence and it reads well.

Also capitalize intellij as",459856994,2016-06-08 05:59:41
15299086,73683,66167793,14,"""an IDE""",459867688,2016-06-08 06:00:31
15299086,73683,66167845,6,s/better/easily,459867688,2016-06-08 06:01:09
15299086,73683,66168157,8,"""... in a single JVM process, which is useful ...""",459867688,2016-06-08 06:04:01
15299086,11442576,66169612,8,Thanks for reviewing this doc. I updated all the comments.,459867688,2016-06-08 06:18:45
15299086,73683,66689976,37,"""Other interfaces for simulator mode are:"" should be "" Other lifecycle methods to use with simulator mode are:""",460485087,2016-06-11 05:32:12
15299086,73683,66690080,40,"...the main thread.

What do you mean by ""All those interfaces""? It's not clear what you're referring to here? Do you mean to say ""The `Simulator` class is thread safe.""?",460485087,2016-06-11 05:33:41
15299086,73683,66690146,41,"again, what are ""these interfaces""? I see methods on a Simulator class discussed above, not interfaces.",460485087,2016-06-11 05:34:30
15299086,73683,66691857,49,"""...than the main thread.""",462720908,2016-06-11 05:55:47
15303162,73683,66110264,5,s/followings/the following,459936721,2016-06-07 23:59:09
15303162,73683,66110537,85,s/Those interfaces/The interfaces listed above,459936721,2016-06-08 00:00:38
15303162,2183863,66123474,93,sounds good; updated.,459936721,2016-06-08 01:11:41
15303162,2183863,66123465,85,sounds good; updated.,459936721,2016-06-08 01:11:37
15303162,73683,66110715,93,s/implementation of all/the implementations of the,459936721,2016-06-08 00:01:39
15303162,2183863,66123459,5,sounds good; updated.,459936721,2016-06-08 01:11:35
15320671,73683,66149593,1,I think you want to not include this in your PR,460335189,2016-06-08 03:47:38
15320671,73683,66149745,19,It's convenient to make these hrefs like [http://localhost:8888](http://localhost:8888). Same for below.,460335189,2016-06-08 03:48:24
15320671,13583258,66183823,19,Thanks. Resolved in new commit.,460335189,2016-06-08 09:18:22
15320671,13583258,66184074,1,I did a hacky thing now this should be resolved.,460335189,2016-06-08 09:22:28
15320671,73683,66292708,7,By `# etc` are you indicating there's other output not being shown? In that case we typically use `...`,460545590,2016-06-08 23:44:57
15320671,73683,66293205,16,"Instead of saying that it would be helpful to know it, let's note that the working dir is logged which can be useful for troubleshooting.",460545590,2016-06-08 23:47:56
15320671,73683,66293642,63,s/would/will,460545590,2016-06-08 23:50:33
15320671,73683,66293852,59,Should we call this section `Troubleshooting`? (cc/ @maosongfu ) Seems like this could grow into it's own page at some point...,460545590,2016-06-08 23:51:41
15320671,73683,66294154,71,"s/your/the

also please link to other steps 3 and 4",460545590,2016-06-08 23:53:22
15320671,73683,66294058,68,"Link to 'question 3'.

Also pls limit line lengths to 100 to make it easier to comment and read in an editor.",460545590,2016-06-08 23:52:54
15320671,73683,66294434,61,"s/my/a

here and in the section names below. Best to speak generally about topologies and systems without 'my' and 'your' ownership.",460545590,2016-06-08 23:54:52
15320671,73683,66294912,75,"compiling.md states minimum versions. let's refer to that to be specific about required gcc and glibc versions.

For libunwind, can we include that in a section that shows what goes wrong without it? Including it in the text here as is makes it hard for",460545590,2016-06-08 23:57:33
15320671,73683,66295042,80,omit 'we hope',460545590,2016-06-08 23:58:18
15320671,73683,66295240,93,pls insert line breaks to make this error log more readable when shown on the webpage.,460545590,2016-06-08 23:59:25
15320671,73683,66295403,82,I think we can omit 'An issue is encountered:' since above you say your showing how to investigate a failure.,460545590,2016-06-09 00:00:19
15320671,73683,66295498,100,omit: 'So',460545590,2016-06-09 00:00:51
15320671,73683,66295523,102,combine with previous paragraph,460545590,2016-06-09 00:01:04
15320671,2183863,66515797,59,"Agree. Another question is: should we keep one single troubleshooting page for the whole heron, or keep two: one for topology developers while another for heron developers (or operators).",460545590,2016-06-10 03:30:01
15320671,73683,66518822,60,image path should just be /img/heron-ui.png,461502204,2016-06-10 03:48:10
15320671,73683,66559287,71,should replace /Users/${USERNAME} with $HOME,462191552,2016-06-10 11:03:19
15320671,73683,66559395,5,s/setting up Heron/deploying topologies,462191552,2016-06-10 11:06:17
15320671,73683,66559440,2,Can we give this doc a more specific title? We have another called 'Topology Troubleshooting Guide' for example. We should give this one a name that distinguishes it from other troubleshooting guides and makes it's scope clear.,462191552,2016-06-10 11:07:16
15320671,73683,66559543,62,"This sentence is a bit fragmented. How about:

If a component (e.g., TMaster or Stream Manager) has failed during runtime, visit the component's logs in `~/.herondata/topologies/{cluster}/{role}/{TopologyName}/log-files/`.",462191552,2016-06-10 11:09:30
15320671,13583258,66562328,2,"The other one is actually also just Troubleshooting Guide. It's a good idea to distinguish the two. As I remember from our team meeting two weeks ago, you @billonahill are the expert on naming things! Suggestions?",462191552,2016-06-10 12:08:45
15320671,73683,66651915,2,"Expert might be a bit strong a word. :)

The other one is called Troubleshooting Guide in the left nav, but 'Topology Troubleshooting Guide' on the page.
http://twitter.github.io/heron/docs/developers/troubleshooting/

This one also seems like a Topo",462191552,2016-06-11 00:35:59
15320671,64790,66654613,9,Enable the `--verbose` flag,462191552,2016-06-11 00:54:03
15320671,64790,66654669,11,This needs to be wrapped in a ```bash ...``` block like the other shell commands below it,462191552,2016-06-11 00:54:22
15320671,64790,66654695,13,s/launches/launch,462191552,2016-06-11 00:54:33
15321671,2183863,66131482,1,"We should have only one heron version. And api, spi, cli or others should use that version number too. It makes all sub-components in heron with consistent version.",460361501,2016-06-08 01:56:01
15321671,2183863,66131562,6,heron-spi,460361501,2016-06-08 01:56:29
15321671,2183863,66131544,16,heron-spi,460361501,2016-06-08 01:56:22
15321671,2183863,66131647,4,"We should have only one heron version. And api, spi, cli or others should use that version number too. It makes all sub-components in heron with consistent version.",460361501,2016-06-08 01:56:59
15324167,73683,66150034,5,s/followings/following,460406533,2016-06-08 03:50:21
15324167,73683,66150417,67,no space before '.',460406533,2016-06-08 03:52:29
15324167,73683,66150481,68,s/config/configurations,460406533,2016-06-08 03:52:47
15324167,2183863,66156150,68,done,460406533,2016-06-08 04:26:57
15324167,2183863,66156141,67,done,460406533,2016-06-08 04:26:54
15324167,2183863,66156133,5,done.,460406533,2016-06-08 04:26:50
15324167,73683,66158143,83,s/interface/interfaces,460436261,2016-06-08 04:40:56
15334055,73683,66291345,26,"Seems like Level.FINE logging should only be done when a verbose flag is passed. If there's general info logs that we want to show, could we instead change those to Level.INFO, instead of logging all of Level.FINE?",460601871,2016-06-08 23:36:19
15334055,2183863,66320515,26,"We determine whether the logging level is Level.FINE or Level.INFO, basing whether a verbose flag is passed. 

By design, we don't want to show the stdout of a spawned process unless a verbose flag is passed, since:
1. We should provide more meaningful",460601871,2016-06-09 02:14:04
15362793,73683,66493637,15,"We should also refer users to the published artifacts in maven and include a pom.xml snippet for referencing artifacts that way:
https://search.maven.org/#search|ga|1|heron

See related maven tickets:
https://github.com/twitter/heron/issues?utf8=%E2%9",461153312,2016-06-10 01:16:39
15362793,73683,66507076,19,"We should recommend that they just add the dep to their pom file. Something like this:

Alternatively you can add a dependency on `heron-storm.jar` to your projects `pom.xml` file:
```
dependency>
    <groupId>com.twitter.heron</groupId>
    <artifa",462050183,2016-06-10 02:35:35
15362793,64790,66652627,26,Indent should be two spaces here,462160209,2016-06-11 00:40:51
15362793,64790,66652726,21,s/to/in,462160209,2016-06-11 00:41:35
15362793,64790,66652766,6,the Heron API,462160209,2016-06-11 00:41:52
15362793,64790,66652788,7,s/to/into,462160209,2016-06-11 00:42:00
15362793,64790,66652895,9,"""releases page"" should be a hyperlink to https://github.com/twitter/heron/releases",462160209,2016-06-11 00:42:40
15362793,64790,66652955,11,"Remove ""named"" here (since the sentence starts with ""The name of...""",462160209,2016-06-11 00:43:05
15362793,64790,66652979,13,Once you've downloaded the script,462160209,2016-06-11 00:43:16
15362793,64790,66653050,15,s/to/into,461153312,2016-06-11 00:43:44
15362793,64790,66653073,16,the Heron APIs,462160209,2016-06-11 00:43:56
15362793,64790,66653107,21,"Remove ""just""",462160209,2016-06-11 00:44:07
15362793,73683,66654509,9,"@lucperkins can we reference https://github.com/twitter/heron via params.github.home?
https://github.com/twitter/heron/blob/master/website/config.yaml#L40",462160209,2016-06-11 00:53:25
15384282,2183863,66516948,5,"Can we also print out the content of ""parts""?",462031616,2016-06-10 03:36:30
15418472,73683,66694273,4,s/your computer/the host,462728532,2016-06-11 06:30:34
15418472,73683,66694303,5,s/on your/in a,462728532,2016-06-11 06:30:57
15418472,73683,66694377,25,Open the `/etc/hosts` file...,462728532,2016-06-11 06:32:08
15418472,73683,66694419,39,Is rebooting really required for changing `/etc/hosts`? I typically haven't found that to be the case.,462728532,2016-06-11 06:33:00
15451827,13159450,66891883,29,"``({{< ref ""#stream-manager"" >}})`` fails to work now",463887141,2016-06-14 07:23:32
15451869,73683,61952108,5,Could we check the uname for ubuntu or darwin explicitly and handle each and throw an error if we find something else?,465601572,2016-05-04 03:40:40
15451869,73683,61952214,4,"ugh, my bad. I've got `--config=darwin` in my `.bazelrc`.",465601572,2016-05-04 03:41:18
15451869,3201045,61982079,7,"we are thinking about adding 
--genrule_strategy=standalone 
--spawn_strategy=standalone
--sandbox_debug

into tools/bazel.rc - if that is the case, you probably don't need these options here?
",465601572,2016-05-04 08:32:57
15451869,3201045,62137360,7,@supunkamburugamuve - we have added those options in tools/bazel.rc - hence you probably don't need it in the scripts.,465601572,2016-05-05 07:40:04
15452651,73683,66910057,25,darwin,463915377,2016-06-14 12:20:47
15452651,73683,66910064,40,darwin,463915377,2016-06-14 12:20:54
15452651,73683,66910095,5,"on a Mac OS X

Same for two other locations below.",463915377,2016-06-14 12:21:27
15452651,73683,66910155,4,"We should test that the required build artifacts exist. If they don't, let's log output explaining what bazel targets need to be run and exit 1.",463915377,2016-06-14 12:22:34
15452651,73683,67046112,8,"We should define these as constants and reuse here and below, which guarantees that what we check for and what we use stay in sync. e.g.,
```
HTTP_SERVER=""./bazel-bin/integration-test/src/python/http_server/http-server""
```",464299111,2016-06-15 03:06:39
15452651,73683,67046222,13,Required file $file does not exist.,464299111,2016-06-15 03:07:16
15452651,73683,67062097,31,"where is HERON_DIST set and instead can the tar be located relatively, like we do with server and runner?",464362632,2016-06-15 04:36:41
15452651,5458092,67067121,31,"@billonahill It seems that ${HERON_DIST} is resolved internally at runtime, so no need to set this environment variable --- 'file://${HERON_DIST}/heron-core.tar.gz' is provided to `heron submit` command as a configuration argument ""heron.package.core.uri""",464362632,2016-06-15 05:10:21
15452651,73683,67078981,31,"Ideally, the runs a bazel build command, which produces `heron-core.tar.gz` somewhere and then runs this script, which knows how to find it at the that location, without requiring the user to know that location and set it as HERON_DIST.

Could we set it",464362632,2016-06-15 06:56:07
15452651,73683,67079040,28,This file is also generated by the build and should be included in `required_files`.,464362632,2016-06-15 06:56:37
15452651,5458092,67087191,31,"@billonahill I don't know if that's really necessary --- despite this format, HERON_DIST doesn't seem to be a shell environment variable (I didn't find any code that sets this env var, and also `${HERON_DIST}` needs to be surrounded by a single quote in t",464362632,2016-06-15 08:36:18
15452651,73683,67194241,31,"I've got two concerns:
1. It's not clear who/what sets HERON_DIST and as you point out, you haven't found any code that does, so it's not clear to me why we use it in this script.
2. This test is misleading, because the user is instructed to run bazel t",464362632,2016-06-15 23:15:19
15452651,73683,67240232,27,"does this work as a single command?
```
+bazel build --config=${PLATFORM} {heron/...,scripts/packages:tarpkgs,integration-test/src/...}
```",464803595,2016-06-16 03:34:02
15452651,73683,67240487,5,we probably want to also do `set -e` to fail fast upon internal bash errors,464803595,2016-06-16 03:35:37
15452651,73683,67249043,5,This is not longer true right?,464856574,2016-06-16 04:28:14
15467095,73683,67201718,1,"I'm not that familiar with how this test framework works, but if we emit the following from the spouts:
```
new CustomObject(""A"", 10)
new CustomObject(""B"", 20)
```
and then do an increment bolt, why would we expect to get just [10]?",464400524,2016-06-15 23:58:48
15467095,73683,67201863,27,if we're testing serialization are there other types besides String and Integer that we should verify?,464400524,2016-06-15 23:59:41
15467095,5458092,67229723,1,@billonahill This is because spouts used for integration tests (com.twitter.heron.integration_test.core.IntegrationTestSpout) executes 10 times as default.,464400524,2016-06-16 02:30:42
15467095,5458092,67229949,27,"@billonahill Yes, I will add other types, also make sure serialization/deserialization works fine in the intermediate bolts too.",464400524,2016-06-16 02:31:41
15467095,73683,67241474,1,"So [10] is the number of records we expect? Seems we'd also want to assert the data itself if possible.

How is IntegrationTestSpout used here, I only see CustomSpout in use?",464400524,2016-06-16 03:41:21
15467095,5458092,67248694,1,"@billonahill I just pushed a commit that asserts the data itself in bolts.
Also, CustomSpout is wrapped by IntegrationTestSpout when TestTopologyBuilder creates a topology.",464400524,2016-06-16 04:26:03
15467095,73683,67254162,37,s/Got/Received input tuple/,464857051,2016-06-16 05:00:58
15467419,73683,67202885,1,"can we commit this generically as heron-api.pom.template without placeholder tokens for version and include a bash script to generate the pom given a version? That way we don't need to edit, rename and recommit every time we release. Same for the other po",464411401,2016-06-16 00:05:45
15467419,73683,67203335,2,"Can we make this a broader-scoped doc `release-process.md` that covers this but also:
- how to update version
- how to tag
- test process
- build process
- maven process

Some of those sections can be placeholders.",464411401,2016-06-16 00:08:08
15467419,73683,67203608,4,"I question whether we need to publish this as a site doc. Maybe this could just be a markdown file under release/, since it's really only for our internal audience for now. We could move it to the site later.",464411401,2016-06-16 00:09:35
15467419,73683,67260516,20,"The steps should instead describe how to create the maven artifacts using bazel, as opposed to downloading the artifacts from elsewhere.",464411401,2016-06-16 05:51:35
15467419,73683,67372855,22,@kramasamy do we want/need to have your name and email in these poms?,465324649,2016-06-16 23:01:03
15467419,3201045,67449610,22,@lewiskan - can you remove the email address? Instead can we point to the google groups?,465324649,2016-06-17 08:14:58
15467419,73683,67537741,25,"instead of showing full urls, let's link the text here and elsewhere. So 'example' will be a link to the sonatype uri, instead of showing the uri.",465847125,2016-06-17 23:26:02
15467419,73683,67560891,18,let's echo this and exit 1 if $1 isn't passed,465896842,2016-06-18 02:11:00
15467419,73683,67560934,1,dirname here can be just 'maven',465896842,2016-06-18 02:11:23
15467419,73683,67561144,51,"code format for these:

```{artifact-version}.jar```",465896842,2016-06-18 02:13:18
15467419,73683,67561172,57,code format for jars,465896842,2016-06-18 02:13:32
15467419,73683,67561187,59,code format for jar,465896842,2016-06-18 02:13:37
15467419,73683,67561230,108,"link to uri, not uri",465896842,2016-06-18 02:13:59
15467419,73683,67561263,36,"link to releases, not uri",465896842,2016-06-18 02:14:23
15467419,73683,67561373,20,"What is meant by ""Following sonatype.org""? Please reword to be more clear.",465896842,2016-06-18 02:15:13
15467419,64790,67562024,84,"For code snippets in normal text you only need one backtick, not three",465896842,2016-06-18 02:20:23
15467419,64790,67562191,46,There should be an empty line after headers like this. That improves readability dramatically.,465896842,2016-06-18 02:21:38
15467419,64790,67562262,76,Mac OS X,465896842,2016-06-18 02:22:03
15467419,64790,67562332,112,"Names of buttons should be in bold face, like this:

```
Click the **Upload Bundle** button...
```",465896842,2016-06-18 02:22:36
15467419,64790,67563351,112,"Also, these items should be a list:

```markdown
For each artifact...:

1. From the...
2. Then click...
```",465896842,2016-06-18 02:31:03
15467419,64790,67564368,122,"""Check to ensure that the local version of the Heron topology compiles by deleting your local `~/.heronapi`, updating the project `pom.xml` file, and pulling from Maven Central""",465896842,2016-06-18 02:39:22
15467419,64790,67564410,120,"In general, some of these steps don't feel like proper sentences. This one should be something more like this:

```
Go to Maven's [search page](http://search.maven.org/), search for ""com.twitter.heron"", and verify that the proper version exists
```",465896842,2016-06-18 02:39:44
15467419,4182518,67565831,51,"@billonahill example of format?  i'm not sure how to proceed on this one, these are artifact jars generated by the Bazel release, thanks.",465896842,2016-06-18 02:50:59
15467419,64790,67566323,51,"That should look something like this:

```
1. `{artifact-version}.jar`
# etc.
```

In general, any time something is a file name, directory name, etc., it should be in backticks.",465896842,2016-06-18 02:55:18
15467419,4182518,67608736,18,@billonahill check and exit added to .sh,465896842,2016-06-19 08:04:41
15467419,4182518,67608742,1,"'maven-central' changed to 'maven', including .sh script and release-process.md docs",465896842,2016-06-19 08:05:26
15467419,4182518,67608748,51,backticks added throughout.,465896842,2016-06-19 08:06:14
15467419,4182518,67608751,108,link to uri updated.,465896842,2016-06-19 08:06:39
15467419,4182518,67608753,84,modified three backticks to one throughout.,465896842,2016-06-19 08:06:57
15467419,4182518,67608755,46,Empty line after headers added.,465896842,2016-06-19 08:07:12
15467419,4182518,67608757,76,done.,465896842,2016-06-19 08:07:23
15467419,4182518,67608760,112,Button syntax and list format added.,465896842,2016-06-19 08:07:42
15467419,4182518,67608764,122,Re-wrote this per comments to be more thorough and added individual steps.,465896842,2016-06-19 08:08:18
15467419,4182518,67608766,120,Revised with more descriptive directions to improve readability.,465896842,2016-06-19 08:08:49
15467419,64790,67719034,77,You now have two step 3s and you need an empty line below this header,466358788,2016-06-20 23:18:23
15467419,4182518,67720160,77,"@lucperkins updated step #s and trailing header line, thanks for the catch.",466358788,2016-06-20 23:24:51
15467419,64790,67791203,46,This needs to have a period at the end. There are some other sentences here that also don't end in periods.,467023176,2016-06-21 07:33:21
15467419,4182518,67819140,46,"@lucperkins @kramasamy periods added for consistency.  problem sentence modified to ""After running the above install script with `--user` flag, the `heron-api` artifacts are installed into the `~/.heronapi` directory.""",467023176,2016-06-21 14:22:58
15467419,73683,68668283,54,These all should all include artifact-name like `{artifact-name}-{artifact-version}.jar`,467303517,2016-06-28 05:29:01
15467419,4182518,69061704,54,"@billonahill thanks, maven format syntax modified to `{artifact-name}-{artifact-version}`",467303517,2016-06-30 09:44:29
15467419,73683,69162815,24,parens around (see example) and no leading '-'.,471515087,2016-06-30 23:13:01
15467419,73683,69162838,26,parens around (see example),471515087,2016-06-30 23:13:10
15467419,73683,69162966,27,"parens around (see example)

period before 'note leading...'

remove trailing paren after keys",471515087,2016-06-30 23:14:01
15467419,4182518,69187358,24,@billonahill done,471515087,2016-07-01 01:40:56
15467419,4182518,69187384,26,done,471515087,2016-07-01 01:41:06
15467419,4182518,69187422,27,done,471515087,2016-07-01 01:41:18
15498931,73683,67538549,6,"instead of requiring the user to pass this, could we instead try to auto-detect it using `uname`?",465585274,2016-06-17 23:32:34
15498931,3201045,67561259,6,"OSTYPE is a predefined environment variable. For mac

```
echo $OSTYPE
darwin14
```

for Centos
```
echo $OSTYPE
linux-gnu
```",465585274,2016-06-18 02:14:19
15498931,3201045,67561383,11,how could you distinguish between different flavors of linux? We support both centos and ubuntu.,465585274,2016-06-18 02:15:18
15498931,3201045,67561934,6,One issue with $OSTYPE might be the return value 'linux-gnu' for both Centos and Ubuntu and we cannot distinguish between the two.,465585274,2016-06-18 02:19:40
15498931,73683,67562854,11,"```
$ docker run -i -t heron-ubuntu14.04 /bin/bash
root@45c2337fdea9:/# ls -l /etc/*-release
-rw-r--r-- 1 root root 105 Feb 16 16:29 /etc/lsb-release
-rw-r--r-- 1 root root 249 Feb 16 16:43 /etc/os-release
root@45c2337fdea9:/# cat /etc/os-release
NA",465585274,2016-06-18 02:26:51
15498931,3201045,67595775,11,+1 - we should make this as a generic script. @caofangkun - would appreciate if you could detect the OS and include it in get_all_heron_paths(),465585274,2016-06-18 12:08:31
15498931,74460,67596651,13,@kramasamy If file ```/etc/redhat-release``` exits then It should be CentOS .,465585274,2016-06-18 13:19:58
15498931,3201045,68110574,7,@caofangkun - recommend using $PLATFORM rather than $PLAT_FORM - easier to read?,468110962,2016-06-23 01:39:41
15498931,74460,68163982,7,fixed.,468110962,2016-06-23 08:33:20
15499307,3201045,67464623,7,Can we use the {{% bazelVersion %}} for these and several others as well?,465605531,2016-06-17 13:16:30
15499307,4182518,67465074,7,"I recall having a problem when I first used {{% bazelVersion %}} that doesn't parse within the ```bash``` syntax.  Trying again just now it fails, parses as {@{@HUGOSHORTCODE-2@}@}.  I'll look into it further, but for tomorrow's update this hopefully suff",465605531,2016-06-17 13:24:16
15499307,3201045,67466513,7,Sounds fair.,465605531,2016-06-17 13:47:49
15499833,73683,67540027,4,Looks like CI is still failing.,465854144,2016-06-17 23:43:35
15499833,13159450,67540142,4,yes. let me check again...,465854144,2016-06-17 23:44:14
15499833,73683,67540560,18,Let's add comments here explaining why we need two copies of the javadocs and what each should be used for.,465854144,2016-06-17 23:47:22
15499833,13159450,67541777,4,I'm thinking maybe it's because we should first build and then ``make site``? see [ci.sh](https://github.com/twitter/heron/blob/master/scripts/travis/ci.sh),465854144,2016-06-17 23:56:04
15499833,73683,67543283,4,There's someone going on with the way that docs generation script is trying to build with bazel here that is making the protobuf gen fail. I suspect we need to change the bazel command that we execute somehow.,465854144,2016-06-18 00:06:43
15499833,13159450,67630600,18,"ah, I forgot this. Let me add comment and submit a new PR.",465854144,2016-06-20 09:31:08
15510279,3201045,67446244,18,why is this help needed?,465506445,2016-06-17 07:23:37
15535559,73683,67577687,80,please keep deps alphabetized in this file,465954282,2016-06-18 04:24:28
15535559,6377806,67580475,80,Fixed. Thanks !,465954282,2016-06-18 04:50:54
15538790,198508,67983630,7,Would the word `batch` in here help clarify at all? `heron.instance.set.data.tuple.batch.size.bytes` for instance?,467732201,2016-06-22 08:50:31
15538790,198508,67983950,23,If this value does not exist in heron_internal.yaml for example if someone has bundled an older version of heron_internals.yaml with their topology for overriding purposes what happens?,467732201,2016-06-22 08:54:12
15538790,198508,67984399,33,Should this be `>=`,467732201,2016-06-22 08:58:40
15538790,198508,67984557,9,Wont these always get overwritten with the config values in the constructor? Why set them here to such a large value?,467732201,2016-06-22 09:00:56
15538790,2183863,67991965,7,```data tuple set``` inherently means it is a batch since it is defined in proto as a batch of tuples with meta data.,467732201,2016-06-22 11:10:07
15538790,2183863,67991985,23,Yes it throws a NPE. Will add a default value for it.,467732201,2016-06-22 11:10:38
15538790,2183863,67992030,33,LOL. Good catch. Will change it.,467732201,2016-06-22 11:11:42
15538790,2183863,67992082,9,Yes they are always get overwritten in the constructor. Will uniform the initialization in construct in the new commit.,467732201,2016-06-22 11:12:57
15538790,198508,68046501,7,"awesome, thanks for the clarification!",467732201,2016-06-22 19:50:41
15538790,198508,68046564,23,Sounds awesome!,467732201,2016-06-22 19:51:08
15542142,11442576,68108966,18,please sort imports,467754577,2016-06-23 01:31:22
15542142,11442576,68110744,38,"`print ""%s writing to: %s"" % (cmd, file)` is better",467754577,2016-06-23 01:40:34
15542142,11442576,68111525,22,"Can we call the ""tail"" shell cmd in python to do the task?",467754577,2016-06-23 01:44:45
15542142,11442576,68112145,39,"`with open(file, ""w"") as out:`",467754577,2016-06-23 01:47:58
15542142,11442576,68112714,46,should we use `start` here as `nextPrint = start + timedelta(seconds=1)`?,467754577,2016-06-23 01:50:58
15542142,11442576,68113764,62,"this is a nitpick: diff is timedelta and diff.seconds only returns the seconds difference, it ignores higher granularity difference",467754577,2016-06-23 01:56:54
15542142,11442576,68114146,64,"`print ""\n %s finished with errcode: %d"" % (cmd, errcode)`",467754577,2016-06-23 01:58:44
15542142,11442576,68114326,68,why not print the lines directly?,467754577,2016-06-23 01:59:45
15542142,74460,68168963,18,fixed,467754577,2016-06-23 09:53:51
15542142,74460,68168976,38,fixed,467754577,2016-06-23 09:53:59
15542142,74460,68169148,22,"Yes ,we can call ""tail"" shell. but I do not think that make any difference.

Code Sample:
```
#!/usr/bin/python
# -*- coding: utf-8 -*-

import subprocess 
filename = '/tmp/result.log'  
command='tail -1000f '+filename
popen=subprocess.Popen(com",467754577,2016-06-23 09:56:43
15542142,74460,68169155,39,fixed,467754577,2016-06-23 09:56:52
15542142,74460,68169163,46,fixed,467754577,2016-06-23 09:57:00
15542142,74460,68169339,62," seconds difference is enough here
```
===> Starting heron build at 2016-06-22 03:11:50
['bazel', '--bazelrc=tools/travis-ci/bazel.rc', 'build', 'heron/...'] writing to heron_build.txt
1472 seconds 5946 log lines
```",467754577,2016-06-23 09:59:11
15542142,74460,68169382,64,fixed,467754577,2016-06-23 09:59:35
15542142,74460,68170041,68,"```lines``` is ```List```  , print it line by line will be much readable.

eg: 
* ```print lines ```  will be 
```
[""INFO: Reading 'startup' options from /home/ablecao/workspace/twitter-heron/tools/travis-ci/bazel.rc: --host_jvm_args=-Xmx2500m --host",467754577,2016-06-23 10:10:17
15542142,3201045,68343000,68,@caofangkun - any thoughts about this feedback?,467754577,2016-06-24 08:37:10
15542142,74460,68343403,68,"@kramasamy ```print '\n'.join(lines)``` is better, I have fixed this as request. :)",467754577,2016-06-24 08:42:44
15545724,64790,67925399,5,`curl`,467504050,2016-06-22 01:30:52
15545724,64790,67925649,7,"hdfs should be in backticks, i.e. `hdfs`",467504050,2016-06-22 01:32:06
15545724,64790,67925763,25,the `uploader.yaml` config file,467504050,2016-06-22 01:32:38
15545724,64790,67925788,26,capitalize Aurora,467504050,2016-06-22 01:32:45
15545724,64790,67925977,27,"""documentations"" isn't a widely used term. Instead, say ""can be found in the documentation for the [HDFS](...) and [S3](...) uploaders""",467504050,2016-06-22 01:33:49
15545724,64790,67926007,30,the `heron.aurora` config file,467504050,2016-06-22 01:33:58
15551279,2183863,67991469,4,Move this to packing_deps_files below?,467707434,2016-06-22 10:59:19
15551279,2183863,67991645,4,"Let us not directly depend on utils-spi-java; it contains too many deep dependencies. 
Two options can be considered:
1. Add more specific building target in spi/src/java:BUILD
2. Re-org classes in utils, for instance, put SchedulerUtils into spi/src/j",467707434,2016-06-22 11:03:03
15551279,2183863,67991652,4,"Let us not directly depend on utils-spi-java; it contains too many deep dependencies. 
Two options can be considered:
1. Add more specific building target in spi/src/java:BUILD
2. Re-org classes in utils, for instance, put SchedulerUtils into spi/src/j",467707434,2016-06-22 11:03:13
15551279,2183863,67991661,4,"Let us not directly depend on utils-spi-java; it contains too many deep dependencies. 
Two options can be considered:
1. Add more specific building target in spi/src/java:BUILD
2. Re-org classes in utils, for instance, put SchedulerUtils into spi/src/j",467707434,2016-06-22 11:03:20
15551279,11442576,68115553,4,The rule `scheduler-spi-java` depends on the PackingPlan.java class and the scheduler_deps_files is used to indicate the dependency for this rule.,467707434,2016-06-23 02:07:04
15552654,11442576,67944707,14,call `platform.node()` instead,467092663,2016-06-22 03:25:18
15552654,11442576,67944758,23,call `platform.machine()` instead,467092663,2016-06-22 03:25:32
15552654,11442576,67944788,30,call `platform.system()` instead,467092663,2016-06-22 03:25:44
15552654,11442576,67944888,37,call `platform.release()` instead,467092663,2016-06-22 03:26:14
15552654,3201045,67957055,14,+1 - makes it more readable,467092663,2016-06-22 04:39:20
15552654,3201045,67957077,23,+1 - makes it more readable,467092663,2016-06-22 04:39:30
15552654,3201045,67957094,30,+1,467092663,2016-06-22 04:39:37
15552654,3201045,67957111,37,+1,467092663,2016-06-22 04:39:42
15552654,3980863,67958512,37,you're really doing +1 on all the notes from @nlu90? :D,467092663,2016-06-22 04:48:25
15552654,3980863,67958757,37,"However good point, I'm replacing the calls as @nlu90 suggests",467092663,2016-06-22 04:50:04
15562553,198508,68676977,6,"Do you mind sorting these alphabetically, it helps avoid accidentally adding a dependency twice. 

https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/",468118243,2016-06-28 06:51:17
15562553,198508,68680498,21,Extra space intentional? ,470390495,2016-06-28 07:32:04
15562553,198508,68680516,46,Extra space intentional?,470390495,2016-06-28 07:32:15
15562553,2542453,68680695,21,"Yes, I was trying to make this consistent-ish with the other scripts there. If there is a more specific script style I can adjust it.",470390495,2016-06-28 07:34:45
15562553,198508,68681073,21,"No thats fine, if thats how it is in other scripts then lets keep it consistent.",470390495,2016-06-28 07:39:17
15562553,198508,68684323,19,If you cd into the docker directory then this command will not work should be `./start-docker` in your example,470390495,2016-06-28 08:21:33
15562553,198508,68684731,12,As a heads up [chef-zero](https://github.com/chef/chef-zero#valid-options) also runs on this port by default and may cause conflicts. ,470390495,2016-06-28 08:26:39
15562553,198508,68685141,10,This ip address will likely not work for anyone else. Is there a better way to link these two containers together without specifying a static ip address?,470390495,2016-06-28 08:31:12
15580571,3201045,68484404,15,@caofangkun - Wondering why you need the 'go' lang package?,468784293,2016-06-25 12:24:20
15580571,3201045,68484424,27,"@caofangkun - if you install python-pygments above, why we are uninstalling and installing again?",468784293,2016-06-25 12:25:40
15580571,74460,68515516,15,"@kramasamy 
need ```go ``` to install ```hugo``` on Ubuntu.
```go get -u -v github.com/spf13/hugo```",468784293,2016-06-27 08:47:30
15580571,74460,68516302,27,"@kramasamy 
Yes , it's not necessary install ```python-pygments``` here.
fixed.",468784293,2016-06-27 09:09:54
15580571,73683,68615403,5,will this work when run from both the repo root dir (i.e. `scripts/get_all_heron_paths.sh`) and from within `scripts/.`?,469924118,2016-06-28 00:04:40
15580571,74460,68688395,5,"Hi @billonahill 
relative path of ```detect_os_type.sh``` here is not indeed. 
I have fixed it. Thank you for pointing out :)",469924118,2016-06-28 09:17:58
15580589,2183863,68355782,6,"1.
https://github.com/facebookarchive/scribe/blob/master/if/scribe.thrift is using "","" rather than "";"".

2. Good to keep consistent for all: enum ResultCode above is still using "",""
",468785164,2016-06-24 12:43:41
15658158,11442576,69345512,50,"assertTrue(true) is alwasy true, what's the meaning of this assertion?",472117073,2016-07-02 02:25:37
15658158,2183863,69351244,50,Just in order to indicate this is a test case. Test Tool can take it into account when generating the test report.,472117073,2016-07-02 03:22:03
15658158,11442576,69355359,50,Can you add some comments to clarify its purpose here?,472117073,2016-07-02 04:01:49
15658158,2183863,69358569,50,Sure. Comments added.,472117073,2016-07-02 04:37:23
15659765,2183863,69367853,14,"We have already logged the location of working directory when a topology is submitted successfully via LocalScheduler: https://github.com/twitter/heron/blob/master/heron/schedulers/src/java/com/twitter/heron/scheduler/local/LocalLauncher.java#L83

Also,",472193707,2016-07-02 06:58:31
15659765,8109379,69371781,14,"@maosongfu Actually, this log is for people who use YARN scheduler, quickly and easily to locate the working directory. For now, only the yarn working directory is too difficult to find in executor machine. So I think this code can move to another class `",472193707,2016-07-02 10:20:09
15659765,2183863,69374050,14,"@ashvina can provide better ideas when this logging should be.

Is there a way to easily adjust the log level.
People could submit topology with verbose flag, and then expect the logging level be Level.ALL (https://github.com/twitter/heron/blob/master/",472193707,2016-07-02 14:04:31
15659765,3201045,69675884,14,@ashvina - Do you have any comments on this?,472193707,2016-07-06 12:07:38
15685131,73683,69674941,16,how come you removed the localhost link here but keep it below.. it's convenient to be able to click that when getting started. ,473010191,2016-07-06 11:46:52
15685131,13159450,69675443,16,"yes, but link checker will complain it is invalid.",473010191,2016-07-06 11:57:22
15685131,3201045,69675533,16,"Adding API docs - along side 'Get Started' is not a good idea. Instead, it might be better if you could add it at the top next to 'Docs'. Instead of calling it Docs, call it just an 'API'
",473010191,2016-07-06 11:59:38
15685131,13159450,69675645,16,ok. this is better.,473010191,2016-07-06 12:02:14
15685131,73683,69675912,16,can we instead patch linkchecker to ignore localhost URIs?,473010191,2016-07-06 12:07:59
15685131,13159450,69678196,16,also I need to figure out why link checker did not complain ``http://localhost:8888`` during CI.,473010191,2016-07-06 12:49:13
15685131,13159450,69676129,16,I'll try.,473010191,2016-07-06 12:11:49
15685131,73683,69780732,26,this seems like it would filter valid links to pages we want to check. Don't we want to filter out links to the tracker and heron ui on localhost?,473374018,2016-07-07 01:03:48
15685131,13159450,69781086,26,"sorry, my word usage is wrong! The code below has the right logic.",473374018,2016-07-07 01:05:42
15685131,13159450,69781602,26,fixed in https://github.com/twitter/heron/pull/1029/commits/464d811fe90fe26878e024a44ce9bac26a8ad68a!,473374018,2016-07-07 01:08:31
15704617,11442576,68860128,5,You should create a new pex_library rule for these code moved from heron-ui and depend on that new rule only.,472966042,2016-06-29 06:07:25
15704617,11442576,68861451,36,"```python
params = dict(cluster = cluster, environ = environ, topology = topology)
if role is not None:
  params['role'] = role
resuest_url = tornado.httputil.url_concat(create_url(EXECUTION_STATE_URL_FMT), params)
```

And same for the following s",472966042,2016-06-29 06:20:52
15704617,11442576,68861739,12,"why other parameters have very specific method but not this one?

is there any method like `self.get_argumemt_role()`?",472966042,2016-06-29 06:23:42
15704617,11442576,68861841,26,"not limited to person, sometimes people may use their service account to submit a topology.

`role used to submit the topology (optional)` is good enough",472966042,2016-06-29 06:24:56
15704617,13159450,68861843,12,understood. I can add ``self.get_argumemt_role()`` and use it,472966042,2016-06-29 06:24:56
15704617,11442576,68861882,34,same question as before,472966042,2016-06-29 06:25:21
15704617,11442576,68861914,4,same suggestion as before,472966042,2016-06-29 06:25:36
15704617,11442576,68861928,12,ditto,472966042,2016-06-29 06:25:45
15704617,11442576,68861938,4,ditto,472966042,2016-06-29 06:25:50
15704617,11442576,68862070,4,"plese follow the comment format here.

`- parameter_name (required) explainations`",472966042,2016-06-29 06:27:09
15704617,13159450,68862305,36,This was the first way of refactoring I tried. I believe this breaks consistency because these pieces of code use ``url_concat`` on optional parameters: https://github.com/twitter/heron/blob/master/heron/ui/src/python/handlers/access/heron.py#L324,472966042,2016-06-29 06:29:38
15704617,7235147,69607809,36,We should not be afraid to break consistency if we think it makes the code better and we can refactor that file going forward. I like Neng's suggestion and your first thought when you did the refactor.,472966042,2016-07-06 00:52:53
15704617,7235147,69608948,2,"do we need a way to get topologies by cluster and environment too? Should we have an internal method that each of the public ones call?

_get_topologies(cluster, role = None, env = None)



",472966042,2016-07-06 00:59:47
15704617,7235147,69609227,5,Out of curiosity why are we changing the module naming.,472966042,2016-07-06 01:01:18
15704617,13159450,69623273,2,I think this is indeed a better design. I'll make the change.,472966042,2016-07-06 02:29:31
15704617,13159450,69623330,36,agree. I'll make the change.,472966042,2016-07-06 02:29:52
15704617,13159450,69623792,5,"It is because not only `heron/ui` depends on `handler`, `heron/explorer` will also depend on `handler`. We think it would be better if we move `handler` to `heron/common`. It might be confusing that `heron/explorer` depends on part of the code in `heron/u",472966042,2016-07-06 02:33:27
15704617,13159450,69633643,12,this is solved. see https://github.com/twitter/heron/pull/979/commits/022410fdc5f05e0f7f66a4604cfdac48aad676ab,472966042,2016-07-06 03:38:32
15704617,13159450,69639716,26,fixed via https://github.com/twitter/heron/pull/979/commits/757878ab582d3ed57eff02fa850939f006cbad81,472966042,2016-07-06 04:17:13
15704617,13159450,69641835,4,solved.,472966042,2016-07-06 04:31:25
15704617,13159450,69641854,4,solved.,472966042,2016-07-06 04:31:33
15704617,11442576,69784414,9,"Instead of creating a new BUILD file, please add a new rule in the existing common/src/python/BUILD file.

Please refer the BUILD file for spi: https://github.com/twitter/heron/blob/master/heron/spi/src/java/BUILD#L163",473449654,2016-07-07 01:23:55
15704617,11442576,69786408,178,"`if role` and `if role is not None` are different, can you check and see which one is better here?",473449655,2016-07-07 01:35:29
15704617,13159450,69789263,178,thanks for the suggestion. fixed in https://github.com/twitter/heron/pull/979/commits/882ac3fbfe21c1f4e2dcc2b32ccd6dd4c7460543,473449655,2016-07-07 01:49:55
15704617,13159450,69789361,5,thanks. fix via https://github.com/twitter/heron/pull/979/commits/fe75a271eac45a53195045663c9161319c264295,472966042,2016-07-07 01:50:24
15719798,13159450,70678834,2,please remove duplicate Bash shebang...,475330142,2016-07-14 01:12:40
15720402,3201045,70026223,5,"@caofangkun - you need to just do 

```
test --test_output=errors
```
only once.",475113252,2016-07-08 12:18:13
15720402,74460,70027163,5,"Hi @kramasamy 
You are right.
 Fixed.",475113252,2016-07-08 12:37:48
15720402,3201045,70027692,5,our convention is put each option in a separate line to improve readability. please put the test option in a separate line.,475113252,2016-07-08 12:48:52
15720471,3201045,70565252,60,"this line and the following should be 

```
scl enable devtoolset-2 bash ""gcc --version""
````
otherwise, it does not work.",475351068,2016-07-13 12:14:07
15728453,3201045,70564873,5,I would suggest to keep these - multiple lists.,475240456,2016-07-13 12:06:53
15728453,3201045,70564926,57,"instead use heron_java_proto_files() + spi_deps_files + local_statemgr_deps_files + ... 

it is modular and we know what dependencies are there.",475240456,2016-07-13 12:08:09
15728453,3201045,70564955,9,keep these as I said before.,475240456,2016-07-13 12:08:28
15728453,3201045,70564987,25,instead use common_deps_files + spi_deps_files + locafs_deps_files + ... ,475240456,2016-07-13 12:09:05
15728453,3201045,70565042,123,instead use heron_java_proto_files() + common_deps_files + spi_deps_files + ...,475240456,2016-07-13 12:10:02
15728453,3201045,70750186,123,"@windie - if you could take care of this, we can merge this PR.",475240456,2016-07-14 12:26:16
15728453,3201045,70750322,155,"same as above - keep the common_deps_files, spi_deps_files, etc and include the appropriate deps - otherwise it is a long list.",475240456,2016-07-14 12:28:41
15728453,3201045,70750344,8,same as above.,475240456,2016-07-14 12:29:00
15728453,3201045,70750368,6,same as above.,475240456,2016-07-14 12:29:27
15747263,11442576,70551807,52,get the scheduler working directory?,475658706,2016-07-13 08:19:50
15747263,11442576,70552803,89,"If an empty list is returned, user is not able to go to the job page through heron ui.

In the Aurora scheduler, we constructed this job link on the fly.",475658706,2016-07-13 08:33:00
15747263,11442576,70553120,55,should we put the unit into variable name? like diskInMB?,475658706,2016-07-13 08:37:29
15747263,11442576,70554264,118,"%s is for string, cpu, mem and disk are doubles",475658706,2016-07-13 08:54:34
15747263,2183863,70565120,52,Fixed.,475658706,2016-07-13 12:11:29
15747263,2183863,70565206,118,Fixed.,475658706,2016-07-13 12:13:13
15747263,2183863,70565213,55,Fixed,475658706,2016-07-13 12:13:18
15747263,2183863,70567330,89,Added the job link.,475658706,2016-07-13 12:50:48
15747263,11442576,70684035,62,"upon close, do we need to kill all the running jobs and close the mesosFrameWork also?",476407713,2016-07-14 01:40:12
15747263,2183863,70697819,62,No. Close() can be invoked when the jvm process SchedulerMain exits. There can be cases people restart SchedulerMain process to pick up earlier running topology (for fault tolerance). So the close of MesosScheduler should be independent with the killing o,476407713,2016-07-14 03:02:50
15747263,2183863,70719011,62,"Comments added in the source code: The lifecycle of Topology is independent from Scheduler, for instance, Scheduler may crash, restart and pick up already running topology (for fault tolerance).",476407713,2016-07-14 05:16:00
15747263,11442576,70728929,136,Why we start the driver inside onSchedule() instead of inside initialize()? Put it in initialize seems more reasonable  and all the information needed is also available in initialize(),476495251,2016-07-14 06:54:51
15747263,11442576,70729853,223,"If a task to be launched fails, what should we do with the resource offers? Should we decline the offer explicitly or we retry until the task is launched successfully?",476495251,2016-07-14 07:05:14
15747263,11442576,70730471,391,"If a slave is lost, that means the tasks on that slave are also lost. Do we need some kind of recovering mechanism? Otherwise, the topology is not working correctly.",476495251,2016-07-14 07:12:05
15747263,11442576,70733702,449,dangling comment?,476495251,2016-07-14 07:47:36
15747263,11442576,70733941,470,"The ""else"" case means the current resource offer cannot meet the request. But we can try remaining resource offers  using iterator instead of returning it directly.",476495251,2016-07-14 07:51:25
15747263,11442576,70734118,441,"The resource assignment strategy here is ""first-fit"", which may not be a very good strategy in practise. Should we abstract this assignment logic here out and refine it further?",476495251,2016-07-14 07:53:46
15747263,2183863,70745581,136,sounds good.,476495251,2016-07-14 11:00:10
15747263,2183863,70745632,223,The mesos master will reclaim the offer back if we fail to launch a task with given offer.,476495251,2016-07-14 11:00:56
15747263,2183863,70745796,391,True the topology will not work normally if a slave lost. The recovering mechanism is complicated and reconcile() is needed. Prefer not to handle this in this iteration consider this scheduler implementation does not aim for production.,476495251,2016-07-14 11:04:11
15747263,2183863,70745805,449,Fixed.,476495251,2016-07-14 11:04:18
15747263,2183863,70745812,470,Fixed.,476495251,2016-07-14 11:04:29
15747263,2183863,70745904,441,First-fit is a reasonable strategy in practice. Method generateLaunchableTasks(..) is already separated to allow people customize their own assigning strategy. We could evolve it later if any practical concerns raised.,476495251,2016-07-14 11:06:21
15747263,3201045,70746391,391,"Can you open an issue to track this?

Sent from my iPhone

> On Jul 13, 2016, at 9:04 PM, Maosong Fu <notifications@github.com> wrote:
> 
> In heron/schedulers/src/java/com/twitter/heron/scheduler/mesos/framework/MesosFramework.java:
> 
> > +             ",476495251,2016-07-14 11:15:30
15747263,2183863,70748069,391,https://github.com/twitter/heron/issues/1077,476495251,2016-07-14 11:48:05
15747263,6377806,70883584,131,Can the topology package name be picked up from config? For e.g. `Context.topologyPackageFile(config)`,476634089,2016-07-15 04:04:21
15747263,6377806,70885007,215,"Instead of assuming that all packing plans will always return homogeneous containers, this method could find max container size (one time computation) and use it?",476634089,2016-07-15 04:13:03
15747263,6377806,70887466,117,There could be a race condition here. A task might get scheduler by `scheduleNewTask` after this for loop completes? ,476634089,2016-07-15 04:27:27
15747263,6377806,70893805,516,Test if the topology is killed/terminated before submitting any new tasks?,476634089,2016-07-15 05:13:37
15747263,6377806,70894953,524,"Is any other status ok? Also in method `generateLaunchableTasks`, taskId is removed from `toScheduleTasks` if it has a matching offer. However if the status is not running, does that still mean that task is running. Otherwise the task should not be remove",476634089,2016-07-15 05:23:39
15747263,6377806,70895038,428,taskId can still be null. Check for null?,476634089,2016-07-15 05:24:29
15747263,6377806,70896011,247,return to ignore the message?,476634089,2016-07-15 05:34:10
15747263,6377806,70896550,255,Is it better to kill the task instead of ignoring the message? Should such conditions be logged at WARNING level?,476634089,2016-07-15 05:39:08
15747263,2183863,70929846,215,Sounds good. Updated.,476634089,2016-07-15 14:02:40
15747263,2183863,70929915,117,"Good catch. Added synchronized block: 
```
synchronized (toScheduleTasks) {}
```
in critical blocks inside some public methods to avoid concurrent issues.",476634089,2016-07-15 14:03:45
15747263,2183863,70929990,516,"Added synchronized block: 
```
synchronized (toScheduleTasks) {}
```
outside to guarantee toScheduleTasks will not be changed.",476634089,2016-07-15 14:04:47
15747263,2183863,70930023,524,Sounds good. Addressed by invoking handlesMesosFailure(TaskId),476634089,2016-07-15 14:05:17
15747263,2183863,70930045,428,"Added synchronized block: 
```
synchronized (toScheduleTasks) {}
```
outside to guarantee toScheduleTasks will not be changed in other threads. So taskId will not be null now.",476634089,2016-07-15 14:05:41
15747263,2183863,70930054,247,Fixed.,476634089,2016-07-15 14:05:48
15747263,2183863,70930213,255,"Updated to log at WARNING level. 
Added a comment in the source code:
```
// TODO(mfu): Don't know what should be done here. Simply ignore this status update for now.
```
I am hesitate to kill the task here since it is also possible to kill tasks bel",476634089,2016-07-15 14:07:48
15747263,6377806,71010117,120,I think `isTerminated` should be outside the critical section. Setting `isTerminated` or killJob need not wait for any other operation to complete.,478186532,2016-07-16 00:31:16
15747263,6377806,71011027,388,taskId is not protected if `handleMesosFailure` and `killJob` are concurrently executed?,478186532,2016-07-16 00:36:34
15747263,6377806,71011470,61,TaskId may need a special data structure for thread safety. I am thinking of a hashMap in which new tasks cannot be added once killjob is initiated. ,478186532,2016-07-16 00:39:40
15747263,2183863,71021269,120,`isTerminated` needs to be within the synchronized block; otherwise the check of isTerminated and the update of Terminated could lead to concurrent bugs. It may be a little confusing to `synchronized (toScheduleTasks)`; changed it to `synchronized (this)`,478186532,2016-07-16 01:38:29
15747263,2183863,71021680,388,"handleMesosFailure is a protected method invoked in a public method, which is within the synchronized block; so `handleMesosFailure` and `killJob` will not concurrently executed.
It may not be a good idea to add synchronized block in an internal method, ",478186532,2016-07-16 01:40:55
15747263,2183863,71022595,61,Not sure how necessary to do that; this can be controlled by higher level logic. Currently the critical parts are within synchronized block and can not execute concurrently; we also have `isTerminated` checking at the start of those critical parts. So log,478186532,2016-07-16 01:46:41
15747263,6377806,71047199,120,"Ok. In most methods, the entire method body is now protected by synchronized(this). Wondering if it is better to make the methods synchronized instead.",478186532,2016-07-16 05:03:25
15747263,2183863,71051114,120,"I would prefer using synchronized blocks over synchronized methods, since:
1. It clearly shows what object is used as lock
2. It could provide more flexibility because it is kind of an internal implementation people can use other object as lock or narro",478186532,2016-07-16 05:52:29
15808126,3201045,71273258,32,"it should ""slightly bigger than""",478402904,2016-07-19 12:07:03
15808126,3201045,71273372,8,Can you describe a few scenarios when this packing is useful?,478402904,2016-07-19 12:08:36
15808126,73683,71375962,8,also at a high level how the algo works.,478402904,2016-07-19 23:40:01
15808126,73683,71376120,19,In #3 and #4 Container is capitalized but other occurrences in the doc are now. We should be consistent.,478402904,2016-07-19 23:40:48
15808126,73683,71376571,32,"should clarify if the padding is done automatically by the system or if the user controls this with settings.

also please line break at 100 chars to make commenting and IDE reading easier.",478402904,2016-07-19 23:43:18
15808126,73683,71377214,37,omit: also,478402904,2016-07-19 23:46:47
15808126,73683,71377280,32,"just a nit, but please line break at 100 chars to make commenting and reading in an IDE easier.",478402904,2016-07-19 23:47:14
15808126,73683,71377619,42,We should also link to the FirstFitDecreasingPacking javadocs for a detailed explanation of the settings and methods.,478402904,2016-07-19 23:49:16
15836946,3201045,71646056,5,this will print the exception stack.,480257000,2016-07-21 11:39:16
15836946,3201045,71646251,22,same as before.,480257000,2016-07-21 11:43:26
15836946,3201045,71646238,14,same as before.,480257000,2016-07-21 11:43:12
15836946,3201045,71646255,31,same as before.,480257000,2016-07-21 11:43:38
15836946,3201045,71646267,41,same as before.,480257000,2016-07-21 11:43:49
15836946,13159450,71648542,5,"For a Python program ``test.py``:
````
def a():
  return 1 / 0

def b():
  return a()

def c():
  return b()

try:
  c()
except Exception as ex:
  print(str(ex))
  pass
````

``python test.py`` will only print out ""division by zero""

A",480257000,2016-07-21 12:23:21
15836946,13159450,71648625,5,"If you print out exception using ``print(ex)``, you will see stack trace.",480257000,2016-07-21 12:24:26
15868302,73683,72007319,67,let's explain in a comment why this is being done.,481734066,2016-07-25 11:15:57
15868302,73683,72007410,69,Was this print just for testing or do you want to ship this? If the latter it should be do_print and the print line should provide more context around what's being being printed.,481734066,2016-07-25 11:18:15
15874302,2183863,72012876,7,"Change from ""install heron"" to ""Get heron with Mesos Scheduler implementation"" or someting like it. Otherwise this seems like a little duplicated with section ""Compile Heron"" below.

Or we maybe move this section to ""Compile heron"" and merge them togeth",482058881,2016-07-25 13:15:21
15874302,2183863,72012956,28,"When submitting a topology, people can also specify the customized config path. The getting-started webpage provides an example.",482058881,2016-07-25 13:16:29
15874302,2183863,72013078,50,"Can u also run the heron-tracker and heron-ui, then put their running screenshot into this doc?",482058881,2016-07-25 13:18:15
15874302,2183863,72013218,45,"Can u add more doc here? For instance, where is the scheduler-working-directory, how does it look like, how can people use it to debug. Where's the log of a running heron-instance, what's the sample log content?",482058881,2016-07-25 13:20:32
15874302,2183863,72013365,15,I remember you came across some issues when tyring to run the mesos cluster. Could u also share them here as potential trouble shooting?,482058881,2016-07-25 13:22:42
15874302,3590405,72381623,15,"I didn't actually launch the mesos cluster :), which I don't think it's worth mentioning.",482058881,2016-07-27 12:13:33
15874302,3201045,72382259,8,Do we need 'At the time this article is written....'?  Please remove - we will forget when we make a release.,483173950,2016-07-27 12:24:59
15874302,3201045,72382309,12,To confirm Mesos cluster ```is``` ready.,483173950,2016-07-27 12:25:46
15874302,3201045,72382391,19,instead of 'to make it use' change it to 'to use',483173950,2016-07-27 12:26:51
15874302,73683,72521440,10,Setting up an Apache Mesos Cluster Locally,483173950,2016-07-28 03:54:13
15874302,73683,72521365,5,on a Mesos cluster,483173950,2016-07-28 03:53:45
15874302,73683,72523746,8,"This whole paragraph can be omitted. Assume the docs ship with the version that has support and that people have that version checked out. You can just start the next paragraph with ""After compiling, ...""",483173950,2016-07-28 04:06:26
15874302,73683,72528705,24,"""Mesos only offers a C++ interface, which is not portable across platforms.""

The next sentence is redundant with the first of this section stating that heron needs to know the path, so we can omit. Also best to not talk about what Heron asks for, but t",483173950,2016-07-28 04:36:07
15874302,73683,72528801,28,... to build and install the Heron client.,483173950,2016-07-28 04:36:43
15874302,73683,72529562,38,"omit: let's
s/, Run:/./g",483173950,2016-07-28 04:41:29
15874302,73683,72529413,33,"Instead of speaking about the future, speak as if it's already here and assume that these docs won't go live until after the code release.",483173950,2016-07-28 04:40:36
15874302,73683,72529674,33,please keep line lengths < 100 to make commenting and reading in an ide easier.,483173950,2016-07-28 04:42:12
15874302,73683,72529829,59,s/You can look at the log file to see/The log file will show/g,483173950,2016-07-28 04:43:14
15874302,73683,72530299,66,"s/you will see the error message/an error message will be included/g

s/E.g. if the Heron can't find Mesos library in the given path, it will complain:/For example, if the Mesos library isn't found in the configured location, the following exception wil",483173950,2016-07-28 04:46:21
15874302,73683,72530527,78,"In general we want to speak more objectively without reference to 'you' and 'your'.

Another way to check that the topology is running is to look at the Mesos management console. If it was launched successfully, two containers will be running.
",483173950,2016-07-28 04:47:59
15874302,73683,72530870,86,The `log-files` directory includes the application and GC log of the processes running in this container.,483173950,2016-07-28 04:50:23
15874302,73683,72531005,90,The bolt log of the ExclamationTopology is `container_1_exclaim1_1.log.0`.,483173950,2016-07-28 04:51:08
15874302,73683,72530788,82,"omit: They are containers of topology master and heron container.

To view the process logs, click the `sandbox` on the right side. The sandbox of the heron container is shown below.",483173950,2016-07-28 04:49:48
15874302,73683,72531559,96,"Install Heron tools to monitor the topology with the heron-ui, which required the heron-tracker. Configure ... before starting tracker. This configuration sets the location of the state manager root path.

",483173950,2016-07-28 04:54:48
15874302,73683,72531610,112,Go to the UI to see the topology.,483173950,2016-07-28 04:55:08
15874302,73683,72531675,116,"To see the metrics, click on the topology.",483173950,2016-07-28 04:55:30
15874302,73683,72531743,120,"To enter the Mesos Management Console page, click the job button.",483173950,2016-07-28 04:55:56
15874302,73683,72651318,12,"s/to have Mesos installed and running/to install and run Mesos/

s/make sure you can access/access the/

Also please limit line lenghts here and elsewhere to 100 chars to make commenting and reading in an IDE easier.",483575236,2016-07-28 23:04:51
15874302,73683,72651380,19,"s/You can modify/Modify/

omit: please",483575236,2016-07-28 23:05:15
15874302,73683,72651914,22,s/your Mesos/the Meso install/,483575236,2016-07-28 23:08:36
15874302,73683,72652110,24,"Mesos only offers a C++ interface,",483575236,2016-07-28 23:09:49
15874302,73683,72652372,29,"s/to test if everything works right/using the following command/

s/, add/. Add/",483575236,2016-07-28 23:11:14
15874302,73683,72652509,35,The following will be displayed upon a successful submit.,483575236,2016-07-28 23:12:12
15874302,73683,72652971,87,Start tracker and the UI,483575236,2016-07-28 23:15:05
15874302,73683,72653050,101,Go to the UI at http:...,483575236,2016-07-28 23:15:35
15874302,73683,72652733,44,"s/it's/the topology/

s/, to check that go the/. To verify check the",483575236,2016-07-28 23:13:38
15876157,73683,72096903,19,"I don't think we need a bash script just to effectively do this:
```
bazel build --config=[config] heron/spi/src/java:heron-spi
```

The `experimental_action_listener` is registered for each platform so it should always run whenever building a java t",482154615,2016-07-25 23:28:30
15876157,73683,75698528,24,"Can this not be set by the script somehow, maybe in the project file. IntelliJ supports something like that.
",497933775,2016-08-22 22:24:55
15883282,2183863,72134165,5,"Could we change ""jave_class_name"" and ""jave_object"" to a more generic name, rather than adding a new filed ""python_class_name"", which is not extensible.",482439365,2016-07-26 03:04:58
15883282,73683,72134983,8,"Could we use a Union type here with the enum discriminator? That would clarify which one is set.
https://developers.google.com/protocol-buffers/docs/techniques#union",482439365,2016-07-26 03:10:10
15883282,2183863,72135070,8,+1,482439365,2016-07-26 03:10:41
15883282,73683,72135243,8,"Or what I just saw that @maosongfu suggested, but either way we should have decent typing for what kind of object we're specifying via an enum or other means.",482439365,2016-07-26 03:11:42
15883282,5458092,72164646,8,"@maosongfu @billonahill Ok, will do that.",482439365,2016-07-26 06:34:08
15883282,73683,72172453,20,Just paired on this. Will change Language to ComponentObjectSpec.,482550760,2016-07-26 07:58:15
15883282,73683,72295661,16,"let's clarify this comment to describe how what's set below, and it's meaning can be determined by the value of spec.",482925008,2016-07-27 00:19:46
15884711,3201045,72160994,95,"Can you add a huge separator comment between big groups of configuration? For example, before instance specific configuration - can you add a huge comment so that when we read the file we can get to specific group quickly?",482486665,2016-07-26 06:02:40
15884711,3201045,72161029,185,same as before?,482486665,2016-07-26 06:03:08
15887590,3201045,72183672,16,Can you add a file level comment so that we know what is it used for?,482601273,2016-07-26 10:39:51
15899030,3201045,71981740,27,There were a bunch of other heron instance options. Wondering if they are not needed?,482498990,2016-07-24 11:36:52
15899030,73683,72098434,23,could you add a description of what the EventLooper is and how it should be used? Same for GatewayLooper.,482498990,2016-07-25 23:37:31
15899030,73683,72099035,28,"This code isn't thread safe. Is it not intended to be invoked by multiple threads? If not it should be documented as such. If so, these objects should be accesses in a thread safe manner.",482498990,2016-07-25 23:40:44
15899030,5458092,72145083,27,"I opened another PR (#1150) for just constants.py, which have all of the constants for default heron options (system config and topology config)",482498990,2016-07-26 04:08:13
15899030,5458092,72145511,28,"@billonahill Yes, this code is not intended to be thread safe, as it is not for Wakeable Looper. I will add documentation for that.",482498990,2016-07-26 04:10:31
15899030,73683,72296622,26,should clarify that it's a class for scheduling recurring tasks.,482498978,2016-07-27 00:25:00
15899030,73683,72297140,61,should this be private if only loop should call it?,482498978,2016-07-27 00:27:33
15899030,73683,72297210,122,should this method and the ones below be private?,482498978,2016-07-27 00:27:59
15899030,73683,72297558,51,Could this be done in the constructor? How come a separate method to set the map? ,482498978,2016-07-27 00:29:31
15899030,73683,72297745,76,better to use descriptive member names than single letters.,482498978,2016-07-27 00:30:25
15902214,3201045,72393659,13,When you log.debug - it prints only when the verbose option is enabled?,483209128,2016-07-27 14:40:37
15902214,13159450,72475619,13,Correct. See: [main.py#L204](https://github.com/twitter/heron/blob/master/heron/tracker/src/python/main.py#L204),483209128,2016-07-27 23:40:56
15902214,3201045,72880584,45,"What is the difference here? In case raise Exception and terminate - where as in the Log.error case, it will print the error and continue with the execution?",483209128,2016-07-30 09:41:46
15902214,13159450,72880754,45,"In Tornado application, if an exception is raised, it's just raised (stack trace could be printed out) but program will not terminate. If we do `Log.error`, the program continue execution and [return an empty `ret` value without metrics information](https",483209128,2016-07-30 09:56:23
15940291,3201045,72907746,94,signal handler is appearing two times?,485222624,2016-08-01 00:38:21
15940291,3201045,72907752,21,why use pylint and disable?,485222624,2016-08-01 00:38:37
15940291,13159450,72908264,21,we are not really using arguments ``signum`` and ``frame``.,485222624,2016-08-01 01:18:13
15940291,13159450,72908289,94,"do you mean `signal_handler` appears both here and a file below? It is because `heron-tracker` needs to additionally stop `filestatemanager` and `zkstatemanager`, but `heron-ui` does not need to.",485222624,2016-08-01 01:20:25
15940291,13159450,72908299,94,"`signal_handler` in `heron-tracker` has to perform `application.stop()`, but `heron-ui` does not have to.",485222624,2016-08-01 01:21:01
15940291,3201045,72909084,94,can we refactor this code?,485222624,2016-08-01 02:09:20
15962608,3201045,73093622,5,why we are still calling TOPOLOGY_JAR_FILE? probably TOPOLOGY_BINARY_FILE,486104101,2016-08-02 11:41:55
15962608,3201045,73093661,5,Also - what is PYHERON_INSTANCE_BINARY?,486104101,2016-08-02 11:42:43
15962608,3201045,73093913,191,"This profiling is available only if we use local scheduler, correct? If that is the case do we need it?",486104101,2016-08-02 11:48:19
15962608,3201045,73093961,12,"Let us keep the line length to a fixed value - whatever it is today. otherwise, people will write longer lines.",486104101,2016-08-02 11:49:03
15962608,3201045,73094167,13,why call pyheron_st_instance? simply calling heron-python - will make it easier to remember and also  sticks to the convention?,486104101,2016-08-02 11:53:43
15962608,3201045,73094224,4,"probably call 

SANDBOX_PYTHON_HERON_INSTANCE_BINARY and

heron.binaries.sandbox.python.heron.instance
",486104101,2016-08-02 11:54:58
15962608,3201045,73094247,4,please rename to Context.heronPythonInstanceSandboxBinary(),486104101,2016-08-02 11:55:33
15962608,3201045,73094266,5,same as before - name change.,486104101,2016-08-02 11:55:54
15962608,5458092,73094729,5,"@kramasamy yes, it will be packaged into heron core package (refer to https://github.com/twitter/heron/pull/1201/files#diff-3e725585fbf57518c1e7209b1b18e401R13), but we still need a parameter (we can just call it by HERON_PYTHON_INSTANCE_BINARY) for heron",486104101,2016-08-02 12:05:40
15962608,3201045,73095119,5,cool - please ignore this.,486104101,2016-08-02 12:12:40
15962608,3201045,73095370,5,"Instead of SANDBOX_PYHERON_INSTANCE_BINARY please call it 

SANDBOX_PYTHON_INSTANCE_BINARY?

Heron name is redundant since the entire code is Heron.",486104101,2016-08-02 12:17:21
15962608,13159450,73281428,12,"Should we use logging for all the `do_print` and `print`? Do we need to add functionalities in `log.py`? Maybe we can improve #1204 and merge #1204 first, and finally use `log.py` in this PR?",486632297,2016-08-03 12:07:56
15962608,13159450,73281499,122,please use formatter,486632297,2016-08-03 12:09:07
15962608,13159450,73281570,154,"maybe ""Invalid"" instead of ""Unrecognized""? I'm quite not sure on this.",486632297,2016-08-03 12:10:23
15962608,3201045,73288082,12,I think it is a good idea to use logging uniformly - what is rationale for using do print?,486632297,2016-08-03 13:46:22
15962608,5458092,73382297,12,I agree with using logging uniformly -- I'll fix then,486632297,2016-08-04 00:39:39
15962608,3201045,73385286,154,I think unrecognized is fine.,486632297,2016-08-04 00:55:04
15962608,13159450,73385576,154,OK.,486632297,2016-08-04 00:56:35
15962608,3201045,73385704,94,Is there a way not to hard code this path?,486632297,2016-08-04 00:57:15
15962608,13159450,73388619,94,Agree. Maybe you can refer to [how I did this in explorer](https://github.com/twitter/heron/blob/master/heron/explorer/tests/python/explorer_unittest.py#L30)?,486632297,2016-08-04 01:12:02
15962822,13159450,74149458,99,Please use ``@abstractmethod`` decorator.,488371045,2016-08-10 04:37:42
15963361,5458092,73082398,12,"FYI, refer to [here](https://github.com/twitter/heron/pull/1196/files#diff-dc442ebcdfefd78eefd38117ee7c81dcR246)",486128390,2016-08-02 08:40:31
15963361,5458092,73082462,13,"FYI, ``write()`` is defined [here](https://github.com/twitter/heron/pull/1196/files#diff-dc442ebcdfefd78eefd38117ee7c81dcR232)",486128390,2016-08-02 08:41:30
15964462,73683,72686423,164,The leading _ syntax is one I have not seen. Why do we need it?,486187037,2016-07-29 02:28:19
15964462,73683,72686801,41,"This method has side-effects in that it modifies the config passed to it, which is not great. I understand the convenience of doing it, but I think it would be better either have the caller do it, or maybe just document this side effect in the javadocs.",486187037,2016-07-29 02:30:25
15964462,73683,72687188,35,can you add unit tests for this class please.,486187037,2016-07-29 02:32:34
15964462,73683,72687341,181,This is a side effect hidden to the caller. Could you document this effect in the relevant public javadocs.,486187037,2016-07-29 02:33:31
15964462,73683,72687534,20,What's the rationale for moving onScheduleAsLibrary from SchedulerUtils to LauncherUtils?,486187037,2016-07-29 02:34:41
15964462,6377806,72694605,20,"`onSchedulerAsLibrary` is a method to launch the scheduler. A launcher performs this function. So I think this method belongs to `LauncherUtils`. Moreover most other methods in `SchedulerUtils` are used by a scheduler once launched, for e.g. set location ",486187037,2016-07-29 03:19:27
15964462,6377806,72694848,35,I am on it now. Thanks for the note!,486187037,2016-07-29 03:20:36
15964462,6377806,72695562,41,"Good point. I am inclining towards explaining the impact in java docs. As I mentioned, there are multiple paths where config is modified. However the config modification is not consistent. The intent is to enforce consistent behavior and not really conven",486187037,2016-07-29 03:24:44
15964462,6377806,72696509,164,"The util classes provides static methods. However, static methods are hard to test, mock or inject. So the class has these internal methods used by static methods. The user should be using static methods and not the internal ones. I thought `_` could be a",486187037,2016-07-29 03:30:07
15964462,73683,72712825,41,sounds good.,486187037,2016-07-29 05:13:05
15964462,73683,72714113,164,"I'm generally not a fan of static methods for these reasons, as well as difficulty overriding. I would recommend using non-static methods and if they need to be visible for unit testing, making them package private and annotating with `@VisibleForTesting`",486187037,2016-07-29 05:22:56
15964462,73683,72714182,20,Makes sense.,486187037,2016-07-29 05:23:29
15964462,6377806,72746453,41,"Fixed
I have split the method into two, one for creating the config and the other for using the new config.",486187037,2016-07-29 13:25:06
15964462,6377806,72746469,35,Fixed,486187037,2016-07-29 13:25:18
15964462,6377806,72746666,181,"I am not sure if I understand the side effect here. The packing ""resource"" is created in this method and closed. The packing resource is not needed once the output, a packing plan, is generated.",486187037,2016-07-29 13:27:55
15964462,73683,72815347,139,"Why create an inner static class inside another one instead of just making createPackingPlan non-static in the parent class? That would seem more straight forward, and would allow subclassing.",484627293,2016-07-29 22:53:38
15964462,73683,72815633,181,"Yes, I see that now. Sorry, I misread the first time. Please disregard.",486187037,2016-07-29 22:55:07
15964462,6377806,72816773,139,I agree. I wasn't sure. I was trying to make this utils look like other util classes. Will revert this. Thanks!,484627293,2016-07-29 23:02:01
15964462,6377806,73014571,164,Fixed,486187037,2016-08-02 00:06:10
15964462,73683,73014598,44,"This is marked as `@VisibleForTesting` but used by `LaunchRunner`. Instead of a public static instance, could you change this to a static factory method without the annotation?",485895071,2016-08-02 00:06:16
15964462,73683,73015772,50,Instead of setting a static mock object here could you instead set the mock object as an instance object in the class that needs this?,485895071,2016-08-02 00:13:41
15964462,6377806,73019176,44,Ahh. Good catch. Will remove it. The `instance` is used to avoid sprinkling the constructor all over in the code.,485895071,2016-08-02 00:34:43
15964462,6377806,73020194,44,"Fixed
",485895071,2016-08-02 00:40:54
15964462,73683,73021052,43,"Can we remove this public static instance entirely and just have classes create an object with the default constructor? That seems better than sharing static instances. And for the unit tests, you could just set a mock instance on the class that needs a L",485956634,2016-08-02 00:46:44
15964462,6377806,73021550,50,Ok. Will fix it. In some cases the utils user object is not visible. So it may not be feasible to set the mock in those objects. As of now the launchers do not have this issue. ,485895071,2016-08-02 00:49:48
15964462,6377806,73035584,43,"Fixed

1. I have removed `setInstance` and `public static instance`. It has been replaced with `getInstance` which can be `spy`ed to return a mocked util instance. 
1. I am not sure how a mock can be injected if default constructor is used. Unless anot",485956634,2016-08-02 02:13:34
15972131,3201045,73212843,21,this does not seem to be correct. if the --verbose option is provided by the user then only we add the --verbose option to the java programs.,486512368,2016-08-03 01:40:55
15972131,3201045,73213393,43,"this is not the correct logic - only if the --verbose is provided, then enable the debug level option.",486512368,2016-08-03 01:43:18
15972131,13159450,73213707,43,Please see [`set_verbose` implementation] (https://github.com/twitter/heron/pull/1204/files/47421526742c3418cdc1b62b7b6216ce808c7f57#diff-d7d30dde4ab9b43859ead4b233f151a7R85). I agree this name is confusing. I can change to `set_logging_level`.,486512368,2016-08-03 01:44:56
15972131,3201045,73215314,21,this should be ok.,486512368,2016-08-03 01:53:21
15972131,13159450,73215977,21,"Right. We compare to see if the logger object `Log` has the `DEBUG` level set. If it is set, we add ``--verbose`` flag to invoke Java program.",486512368,2016-08-03 01:56:54
15972131,13159450,73216279,21,this is basically about propagating logging level from Python executor down to Java scheduler.,486512368,2016-08-03 01:58:35
15972131,3201045,73217464,5,can you import as Log rather than log?,486520346,2016-08-03 02:05:15
15972131,13159450,73218015,5,"Good suggestion but log module has the logger object called `Log`. There will be name clashing.

> On Aug 2, 2016, at 12:05, Karthik Ramasamy <notifications@github.com> wrote:
> 
> In heron/explorer/src/python/main.py:
> 
> > @@ -28,7 +28,7 @@
> >  import",486520346,2016-08-03 02:08:57
15972131,13159450,73249388,5,`log` module has a logger object `Log` and a function `configure`. I first get the logger object out (see: https://github.com/twitter/heron/pull/1204/files#diff-762d509cb715b724772c61e8aae7f089R33) and then call `log.configure` under ``main`` function.,486520346,2016-08-03 05:21:54
15972131,3201045,73252207,46,this should be Log.debug.,486602363,2016-08-03 05:44:41
15972131,3201045,73252218,47,same here as well.,486602363,2016-08-03 05:44:49
15972131,13159450,73252802,47,thanks. will fix.,486602363,2016-08-03 05:49:55
15972131,13159450,73252796,46,thanks. will fix.,486602363,2016-08-03 05:49:52
15972131,3201045,73252861,4,why give false here? should we pass the verbose value that was passed?,486602363,2016-08-03 05:50:21
15972131,13159450,73253979,4,"because in this class, no verbose value has been set. I just put `false` here. cc @ashvina do you have any suggestion?",486602363,2016-08-03 05:59:38
15972131,13159450,73256015,4,"if it's hard to propagate verbose flag to YARN scheduler, I'm not sure what to do. Maybe just put `false` here?",486602363,2016-08-03 06:17:53
15972131,6377806,73262763,4,Could you please elaborate what is the difficulty for YARN? A number of configurations are passed to the YARN scheduler. I think it is feasible to pass verbose flag too. ,486602363,2016-08-03 07:25:41
15972131,13159450,73263023,4,There is no verbose option in [HeronExecutorTask's field](https://github.com/objmagic/heron/blob/6543f5f531d86521f341753f821dc89dc1fe69ff/heron/schedulers/src/java/com/twitter/heron/scheduler/yarn/HeronExecutorTask.java#L85-L94).,486602363,2016-08-03 07:29:04
15972131,13159450,73263154,4,no verbose option in [HeronTaskConfiguration](https://github.com/twitter/heron/blob/e68943d422ea35f54c46fc8944c1c83ef6440d78/heron/schedulers/src/java/com/twitter/heron/scheduler/yarn/HeronTaskConfiguration.java),486602363,2016-08-03 07:30:37
15972131,13159450,73264142,4,I'll appreciate if you can add a verbose option in YARN scheduler.,486602363,2016-08-03 07:42:32
15972131,6377806,73281316,4,Ok,486602363,2016-08-03 12:05:49
15972131,6377806,73285165,4,@objmagic Done #1208 ,486602363,2016-08-03 13:06:44
15972131,13159450,73285332,4,@ashvina Fantastic! We can merge #1208 first and make change on this PR accordingly.,486602363,2016-08-03 13:09:09
15990441,3201045,73459085,149,can you open a PR for this?,484542243,2016-08-04 10:53:54
15990441,150482,73585169,61,What is the expectation here for logging this message? It becomes very difficult to know if there was a real issue with a stream which cannot be closed or failed on housekeeping tasks to cleanup resources. Preferably we should just use something like `IOU,487205387,2016-08-05 02:15:24
15990441,150482,73585343,99,We need some defensive coding here before assuming that the connection is a HTTPURLConnection,487205387,2016-08-05 02:16:34
15990441,150482,73585710,149,"@nlu90 if you refactor the methods it would be good to keep the connection creation (preferably using a connection pool) within the class which is doing all the additional work of setting Request-type, etc. That might also mean not having the flexibility ",484542243,2016-08-05 02:19:02
15990441,6377806,73613615,221,This method duplicate most of the code from `SchedulerUtils.executorCommandArgs`. Can we reuse the original method? It may need some refactoring though. ,487205387,2016-08-05 05:25:37
15990441,6377806,73614733,133,Should disconnect be put in a finally block?,487205387,2016-08-05 05:35:06
15990441,6377806,73615175,52,connection.disconnect?,487205387,2016-08-05 05:38:50
15990441,6377806,73615225,58,"I think a finally block is needed for disconnect?
",487205387,2016-08-05 05:39:17
15990441,6377806,73620599,75,Should the return value be false to let the user know that `restartAll` failed?,487205387,2016-08-05 06:27:41
15990441,11442576,73621311,221,"Yeah, I can refactor the method to be reused",487205387,2016-08-05 06:35:21
15990441,11442576,73621455,61,"Sounds good, we can make the close() be quiet.",487205387,2016-08-05 06:36:59
15990441,11442576,73621879,58,"Do you mean, instead of do disconnect after each failure case, just `try {} finally {conn.disconnect()}`?

One concern is, all the methods called here don't throw any exception. In this case, should we still use `try` ?",487205387,2016-08-05 06:41:26
15990441,6377806,73621845,43,I am not an expert. So wanted to clarify one doubt. Can Marathon service be SSL enabled? If so do we need to provide support for https?,487205387,2016-08-05 06:41:03
15990441,11442576,73622108,149,"@kramasamy @osgigeek the refactor is done in this PR. For each request type, we have different util methods taking care of all the additional works

 ",484542243,2016-08-05 06:43:54
15990441,6377806,73622589,58,"I was thinking more like the first one; one try finally for each method. 

You are correct, handling IOException captures most of the error cases. A try-finally is a generally accepted pattern whenever resources are concerned. I would suggest try-finall",487205387,2016-08-05 06:50:25
15990441,6377806,73620332,23,"I am not sure I understand why this class called a `Controller`. It seems more like a ""util"" class to me. Moreover the http calls and related code could actually be moved to the `MarathonScheduler`. Also there is sole level of code duplication between the",487205387,2016-08-05 06:25:09
15990441,11442576,73623846,58,"sounds good, I'll update to use the try-finally pattern",487205387,2016-08-05 07:03:31
15990441,11442576,73624344,75,"The problem with returning false here is the RuntimeManagerMain would throw exceptions claiming the operation failed. If throwing exception instead of show some log message is acceptable, we can return true",487205387,2016-08-05 07:09:12
15990441,11442576,73745882,43,I'm also not very sure. @mhausenblas could you explain the SSL a little bit?,487205387,2016-08-06 02:18:07
15990441,11442576,73751526,23,The `Controller` is the one do the actual action. The reason I moved the logic out is to make the code more modularized and understandable.,487205387,2016-08-06 03:05:01
15990441,2183863,72356414,97,Can we simply kill the whole group and resubmit the whole group in this case?,484542243,2016-07-27 06:24:47
15990441,2183863,72356905,9,So only RAM is taken into account? Should we rename it to avoid confusion?,484542243,2016-07-27 06:29:30
15990441,2183863,72357152,149,Why not use or refactor the utils method already exists?,484542243,2016-07-27 06:31:48
15990441,2183863,72357269,13,It is better to put this change into a separate pull request.,484542243,2016-07-27 06:32:59
15990441,11442576,72518849,97,"I left this unimplemented because I could not find a marathon api to restart a complete group and wondering if we can get some instructions from the Marathon people.

Yes, we can kill the group and then resubmit it. The only thing is we need to fetch th",484542243,2016-07-28 03:40:00
15990441,11442576,72519107,9,"This method is moved from AuroraScheduler, maybe we should put this refactor into a separate PR.",484542243,2016-07-28 03:41:13
15990441,11442576,72519544,149,"Those utils methods need to be refactored for usage. And to reduce the development time, I choose to write my own method for the initial commit. 

I'll refactor and use them in the following update.",484542243,2016-07-28 03:43:22
15990441,20392,72595858,97,"Yes, see https://mesosphere.github.io/marathon/docs/generated/api.html#v2_groups_delete",484542243,2016-07-28 17:02:10
15990441,11442576,72728863,97,"@mhausenblas, Is there any marathon api to get the application group JSON file when the group is sbumitted?

I tried `GET /v2/groups/{groupId}`, but the returned result is not the original JSON file, it modifies the ""id"" fields, adds some extra informat",484542243,2016-07-29 07:59:41
15991096,3201045,73463031,6,do we need this with the new change?,487129389,2016-08-04 12:09:35
15991096,73683,73463195,6,"Access isn't needed outside of this class and won't be when I add a serde test, since I was going to add it to this class as well.",487129389,2016-08-04 12:12:58
15991096,3201045,73463256,6,"I was not clear - I meant the variable ""resource""",487129389,2016-08-04 12:14:08
15991096,73683,73467118,6,"Yes, it's still used in the ContainerPlan and the PackingPlan objects below. I just changed to a resource for each instance that was unique, so I could assert on that.",487129389,2016-08-04 13:15:22
15992916,13159450,73623258,192,`Log.debug`,487228911,2016-08-05 06:56:02
15992916,13159450,73623340,29,"at least in this file, you can do `from import heron.common.src.python.utils.log import Log` since `log` module is not used elsewhere.",487228911,2016-08-05 06:57:12
15992916,13159450,73623278,175,Log.error,487228911,2016-08-05 06:56:16
15992916,13159450,73623434,129,"If RC file does not exist, we should silently fall back to normal argument parser. That said, should we use `Log.debug` here?",487228911,2016-08-05 06:58:31
15992916,13159450,73625018,1,"I am not sure if you can call it `argparser.py` since it only contains `HeronRCArgumentParser`. Should we rename it to, for example, `rcargparser.py`? ",487228911,2016-08-05 07:17:13
15992916,6173033,73709367,129,"@objmagic  - HeronRCArgumentParser extends Argparser, and hence the behavior will be defaulting to normal argparser behavior without the file. is that what you mean? it will be transparent to the clients",487228911,2016-08-05 22:18:40
15992916,6173033,73709619,1,"I am wondering if we should also name the class to be more generic , say HeronArgumentParser instead of making it specific to HeronRC. this also provides the fallback behavior in case the RC file is not found. ",487228911,2016-08-05 22:20:05
15992916,13159450,73712933,1,"That's a good point. Please do it.


> On Aug 5, 2016, at 08:20, Prabhu Inbarajan <notifications@github.com> wrote:
> 
> In heron/comon/src/python/argparser.py:
> 
> > @@ -0,0 +1,196 @@
> > +# Copyright 2016 Twitter. All rights reserved.
> I am w",487228911,2016-08-05 22:38:19
15992916,13159450,73717930,129,"right. I think ``Log.error(""File %s does not exist"", effective_rc)`` is better.",487228911,2016-08-05 23:08:17
15992916,6173033,73781139,175,this is not a fatal condition. this means a misconfiguration in heronrc file and hence the warning. ,487228911,2016-08-06 12:17:31
15992916,6173033,73781128,192,this is the main stub. meant to print it to stdout. info seems okay to me. let me know if you feel strongly,487228911,2016-08-06 12:16:16
15992916,6173033,73781148,1,"done, changed argparser.py to heronparser.py , 
changed HeronRCArgumentParser to HeronArgumentParser
",487228911,2016-08-06 12:18:46
15992916,6173033,73781147,29,done,487228911,2016-08-06 12:18:35
15992916,3201045,73791206,15,"this should not be allowed IMO since positional arguments are always required.
",487358443,2016-08-07 03:00:02
15992916,3201045,71596108,1,It will be great if you could rename this file to be heronrc.sample or SAMPLE .heronrc.sample will be hidden in the code and people might not see it.,483433815,2016-07-21 03:02:18
15992916,13159450,72308170,143,`main` does not return anything. Please add `return 0` at the end of control flow in `main`.,483433815,2016-07-27 01:24:38
15992916,13159450,72308285,4,Should this be `argparser` instead of `argparse`?,483433815,2016-07-27 01:25:11
15992916,13159450,72308463,4,Maybe `hrc_parse` is a better module name?,483433815,2016-07-27 01:26:00
15992916,13159450,72308879,125,remove commented out code,483433815,2016-07-27 01:28:02
15992916,13159450,72308992,94,remove commented-out `print`,483433815,2016-07-27 01:28:24
15992916,13159450,72309039,86,line too long,483433815,2016-07-27 01:28:41
15992916,13159450,72309127,78,"``value, command, env = '', '', ''``",483433815,2016-07-27 01:29:10
15992916,13159450,72309656,12,please sort import order. ,483433815,2016-07-27 01:31:57
15992916,13159450,72309851,24,are the above three variables even used?,483433815,2016-07-27 01:32:56
15992916,13159450,72310103,79,`if m is not None:`,483433815,2016-07-27 01:34:09
15992916,13159450,72310149,71,remove unnecessary blank line,483433815,2016-07-27 01:34:28
15992916,13159450,72310387,46,see my suggestion: https://github.com/twitter/heron/pull/1119#issuecomment-235355454 ,483433815,2016-07-27 01:35:50
15992916,13159450,72310982,143,"why `argparser` module can be invoked as a Python program? If this is for test purpose, please do not run test manually and add test under `heron/cli/tests` to test this module.",483433815,2016-07-27 01:39:14
15992916,13159450,72311257,1,I see no need to run this module as a separate Python program. Please remove this shebang. ,483433815,2016-07-27 01:40:30
15992916,13159450,72311550,6,remove unnecessary import,483433815,2016-07-27 01:41:49
15992916,13159450,72311572,12,remove unnecessary import,483433815,2016-07-27 01:41:54
15992916,13159450,72312109,33,Please use ` to surround the above two commands so that they are formatted properly,483433815,2016-07-27 01:44:38
15992916,13159450,72312830,99,indent comment properly,483433815,2016-07-27 01:48:06
15992916,13159450,72312927,105,unnecessary parenthesis,483433815,2016-07-27 01:48:30
15992916,13159450,72314153,96,"please use Log module under `heron/common` by adding `from heron.common.src.python.color import Log`, then you can use `Log.warn(...)`",483433815,2016-07-27 01:56:20
15992916,13159450,72314409,128,No space surrounding assignment operator is required. Please write `prog='heron'` like `formatter_class=SubcommandHelpFormatter` below.,483433815,2016-07-27 01:57:43
15992916,6173033,72495107,24,"Yes, these are the HERON_RC defaults",483433815,2016-07-28 01:25:25
15992916,13159450,72495484,24,"`p`, `filters`, `expressions` are not used.",483433815,2016-07-28 01:27:19
15992916,13159450,72683664,131,"""WARN"" is not necessary here. `Log.warn` will add a `Warn` at the beginning.",484417974,2016-07-29 02:10:56
15992916,13159450,72683715,88,clean up commented out code,484417974,2016-07-29 02:11:17
15992916,13159450,72683773,38,clean up this print,484417974,2016-07-29 02:11:35
15992916,13159450,72684076,176,maybe use `Log.debug(traceback.format_exc())`?,484417974,2016-07-29 02:13:25
15992916,13159450,72684115,178,remove this comment,484417974,2016-07-29 02:13:41
15992916,6173033,73002152,131,complete,484417974,2016-08-01 22:50:13
15992916,6173033,73002179,88,complete,484417974,2016-08-01 22:50:21
15992916,6173033,73002198,38,complete,484417974,2016-08-01 22:50:28
15992916,6173033,73002235,176,complete and added a warning message as well,484417974,2016-08-01 22:50:41
15992916,6173033,73002253,178,complete,484417974,2016-08-01 22:50:48
15992916,13159450,73097213,1,please rename to `heronrc.sample`. we don't want to see this file gets hidden.,486113940,2016-08-02 12:45:23
15992916,13159450,73189899,49,please remove whitespace surrounding assignment operator,486113940,2016-08-02 23:30:44
15992916,13159450,73189924,70,same as above,486113940,2016-08-02 23:30:54
15992916,13159450,73190090,174,can you do `dict_ns = dict(namespace)` first? so you don't have to write `__dict__` everywhere.,486113940,2016-08-02 23:32:03
15992916,13159450,73190253,116,equivalent to `if not command:`,486113940,2016-08-02 23:33:06
15992916,13159450,73190275,119,equivalent to `if not app:`,486113940,2016-08-02 23:33:13
15992916,13159450,73190292,120,equivalent to `if not env:`,486113940,2016-08-02 23:33:22
15992916,6173033,73198284,49,"pylint is complaining that it needs one space around assignment. Please advise.
I think you are referring to lines 43 - 49 which is addressed.

pylint --rcfile=tools/python/checkstyle.ini heron/cli/tests/python/argparser_unittest.py
",486113940,2016-08-03 00:20:39
15992916,13159450,73198444,49,you're right. I didn't look carefully.,486113940,2016-08-03 00:21:37
15992916,6173033,73207073,1,"changed to heronrc.sample
the argparser_unittest.py also changed to heronrc.test. ",486113940,2016-08-03 01:10:45
15992916,6173033,73207196,70,line 63 - 70 addressed,486113940,2016-08-03 01:11:28
15992916,6173033,73207378,174,"  addressed as dict_ns = namespace.__dict__

p.s = dict(namespace) is not working as namespace is not iterable. only namespace.__dict__ is",486113940,2016-08-03 01:12:24
15992916,6173033,73207542,116,"addressed as 
`
if not  command or not app or not env:
            Log.warn(""heronrc config entry %s does not have key parameters (command:app:env) "",
                     line)
            continue
`",486113940,2016-08-03 01:13:24
15992916,6173033,73207594,119,"addressed as 
`
if not  command or not app or not env:
            Log.warn(""heronrc config entry %s does not have key parameters (command:app:env) "",
                     line)
            continue
`",486113940,2016-08-03 01:13:36
15992916,6173033,73207613,120,"addressed as 
`
if not  command or not app or not env:
            Log.warn(""heronrc config entry %s does not have key parameters (command:app:env) "",
                     line)
            continue
`",486113940,2016-08-03 01:13:41
15992916,13159450,73207904,174,thanks. I misremembered. It should be `vars` (https://github.com/twitter/heron/blob/master/heron/explorer/src/python/main.py#L172),486113940,2016-08-03 01:15:10
15992916,13159450,73260594,96,this should be `Log.debug`,486501721,2016-08-03 07:02:26
15992916,13159450,73262284,30,@kramasamy Do you think it's fine to hardcode this file location? I'm OK with this and just want to know your opinion.,486501721,2016-08-03 07:20:14
15992916,3201045,73290441,30,"@objmagic - it is ok since it is always looking in the user's home directory. 

@prabhuinbarajan - it might be good to change it to 

```os.path.join(os.path.expanduser('~'), '.heronrc')```

",486501721,2016-08-03 14:13:04
15992916,6173033,73388926,30,"good point, i will combine : HERON_RC_FILE = ""~/.heronrc""
HERON_RC = os.path.expanduser(HERON_RC_FILE)

In addition, you may want to note a couple of things:
1. there was supposed to be a system level heron rc (under /etc/)
2. Karthik mentioned that ",486501721,2016-08-04 01:13:28
15992916,6173033,73389350,96,done,486501721,2016-08-04 01:15:46
15992916,13159450,73392098,30,"Do you mean user can specify which rc file to be used on command-line? If so, please add a test for this.",486501721,2016-08-04 01:27:24
15992916,13159450,74668021,192,what's the point of doing this? Can you explain why?,488116048,2016-08-13 05:11:55
15993262,3201045,73644370,4,A bunch of the files seems to be instance related. Why we are putting these in heron/common?,487243649,2016-08-05 12:44:52
15993262,5458092,73649813,4,@kramasamy The only reason why they are here is because equivalent ones in Java are under ``heron/common``. ,487243649,2016-08-05 14:00:01
15993262,13159450,73723754,4,Agree. This keeps consistency and should be fine.,487243649,2016-08-05 23:50:18
15993262,3201045,72907819,110,can we add a unit test for task hook?,485327675,2016-08-01 00:41:52
15993262,5458092,73084313,110,@kramasamy I will add them.,485327675,2016-08-02 09:11:03
15999408,1989169,74727864,26,"I'm not sure if this is the correct way. Right now Heron doesn't have the Grouping class, so I created the method to get all source streams. It's used by WindowedBoltExecutor.",493700546,2016-08-15 14:31:32
15999408,73683,84957627,34,"Instead of suppressing this here and elsewhere, can you add a serialVersionId?",541945948,2016-10-26 00:35:05
15999408,73683,84957960,34,"please add a utility class constructor instead of suppressing, here and elsewhere.",541945948,2016-10-26 00:36:37
16016960,6377806,73766130,17,"This API would need additional information for heterogeneous schedulers. the YARN scheduler for eg, needs to know what resources to request for the new container. This information will come from the updated packing plan. Could it be replaced by `addContai",487316946,2016-08-06 05:04:46
16016960,6377806,73766697,18,It is assumed that the containers with the highest id will be removed?,487316946,2016-08-06 05:10:30
16016960,73683,73769946,18,"That's the current impl, but we might need to rethink this. For aurora if we remove a container that's not at the end, I'm not sure what the container ids would do and there are places where a continuous set of ids is expected so it feels safer to remove ",487316946,2016-08-06 05:47:47
16016960,73683,73770069,17,"Yes, this seems reasonable. Aurora would need to ignore the Container info though which is unfortunate, since it can only clone.",487316946,2016-08-06 05:49:46
16016960,6377806,73909255,17,"@billonahill I have created a patch with this change:  https://github.com/ashvina/heron/commit/4f38c29f2c7f58a38aa33a35696285af5df64e0d
Could you please review and merge this. Thanks !",487316946,2016-08-08 23:41:30
16016960,6377806,73912089,104,There are 4 state manager interactions above. Failure in any one can result in state corruption and existing topology fail. In my opinion update operation must not negatively impact existing deployment. So I think state update (both packingPlan and topolo,487316928,2016-08-08 23:58:20
16016960,6377806,73937960,50,"This is related to #1222 

Currently method `createAuroraProperties` provides instance distribution to containers. On topology update the instance distribution for existing containers, e.g. `C`, can change. However the aurora property map for container ",487316928,2016-08-09 02:26:52
16016960,73683,74369612,50,"Yes. See the changes to the ```heron_executor.py``` in this branch. On startup instead of doing:
```
self.update_instance_distribution(self.parse_instance_distribution(args[5]))
```
we do:
```
executor.register_packing_plan_watcher(executor)
```
w",487316928,2016-08-11 12:20:18
16016960,73683,74368981,17,@ashvina could you make a PR against my branch?,487316946,2016-08-11 12:04:35
16016960,73683,74369349,104,"I agree that we should strive towards atomicity. The change described will we a considerable refactorting effecting much of the non-scaling functionality (i.e., distribution/update of physical plan, topology, etc during submit) so I'm inclined to ship an ",487316928,2016-08-11 12:13:46
16016960,13159450,74794388,57,better to add a line `Log.error('Unknown subcommand: %s' % command)`,487316928,2016-08-16 00:02:04
16016960,13159450,74796702,48,"`do_print` is changed to `Log`. See: https://github.com/twitter/heron/pull/1252/files

Rebasing against master should fix this.",487316928,2016-08-16 00:17:49
16016960,73683,74802099,57,"Good call, will update. This code path will only happen if someone adds a new command to the parser, but doesn't register a runner, so it should get caught in testing, but with the logging it will help pinpoint where the change was missed.

An even bett",487316928,2016-08-16 00:49:12
16016960,13159450,74804027,57,"maybe passing `runners` to `create_parser`? For example, do `kill.create_parser(subparsers, self.runners)` and inside `kill` module associates string `kill` with a lambda function like the following:

````Python
runners['kill'] = lambda *args: run(*arg",487316928,2016-08-16 01:00:22
16016960,73683,74807960,57,"Yeah, that makes our invocation a bit more fancy, but we still need to maintain both the commands in the parser and the runners dict. I don't think that's a huge deal, but maybe a yak-shave for another day...",487316928,2016-08-16 01:23:12
16016960,13159450,74808120,57,agree...,487316928,2016-08-16 01:24:02
16030189,3201045,75068294,30,Is this the overall resource requirement for the entire plan?,494557280,2016-08-17 13:27:55
16030189,3201045,75068333,24,I am assuming this is the resource requirement for the entire container?,494557280,2016-08-17 13:28:29
16030189,3201045,75068622,16,Just wondering if this is a request send by Topology Master to Executor or something else?,494557280,2016-08-17 13:32:29
16030189,3201045,75068726,16,"If this is indeed a request - do we need a response? In general, for control messages, it will always good to send a response back.",494557280,2016-08-17 13:33:25
16030189,3201045,75069684,21,Instead of two classes - one for serialization and the other deserialization - can we have all of them in a single class? It will be easy to read and any modification will be localized - makes it easy to read and review code - in case one is changed but n,494557280,2016-08-17 13:44:00
16030189,73683,75159472,30,Yes. This class is basically a protobuf version of [c.t.h.spi.packing.PackingPlan](https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/packing/PackingPlan.java#L20).,494557280,2016-08-17 23:40:42
16030189,73683,75159556,24,Yes. See [c.t.h.spi.packing.ContainerPlan](https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/packing/PackingPlan.java#L119).,494557280,2016-08-17 23:41:17
16030189,73683,75161432,16,This is send from the [RuntimeManagerRunner](https://github.com/twitter/heron/pull/1218/files#diff-175aa5efeb9ca85f99dfb52dead01fa7R175) to the [Scheduler](https://github.com/twitter/heron/compare/master...billonahill:billg/scaling_proto#diff-4a29bbb233b3,494557280,2016-08-17 23:51:18
16030189,73683,75161857,21,"I've gone back and forth on this in the past. In other projects I've implemented both in one class before finding that most clients rely on one and not the other, and sometimes each has different deps. Hence I implemented them separately, which also keeps",494557280,2016-08-17 23:53:45
16030189,3201045,75188037,16,thanks for the clarification.,494557280,2016-08-18 02:17:07
16030189,3201045,75188155,21,sounds good.,494557280,2016-08-18 02:17:50
16033743,64790,73906329,5,"Should be either just ""Heron"" or ""a Heron cluster,"" not ""a Heron""",487446110,2016-08-08 23:22:43
16033743,64790,73906363,19,on your machine,487446110,2016-08-08 23:22:59
16033743,13159450,73908043,5,fixed via https://github.com/twitter/heron/pull/1226/commits/c0b26aa8e841acce182ac804cb07f1cb5b237e74,487446110,2016-08-08 23:33:26
16033743,13159450,73908053,19,fixed via https://github.com/twitter/heron/pull/1226/commits/c0b26aa8e841acce182ac804cb07f1cb5b237e74,487446110,2016-08-08 23:33:29
16040363,73683,67200494,25,"This block above seems to be the same as that in gperftools/BUILD. Any way we can share this and not duplicate logic?
",464564872,2016-06-15 23:51:25
16040363,3201045,67449139,25,"since it is across packages - not sure how to share it in bazel.
",464564872,2016-06-17 08:07:02
16120794,13159450,74167181,53,"1. is used to log...
2. It accepts an optional argument which specifies logging level
",488168214,2016-08-10 07:11:30
16120794,13159450,74167214,54,"start a new line before ""Warning""",488168214,2016-08-10 07:11:48
16120794,13159450,74167257,54,maybe use **NOT** rather than NOT?,488168214,2016-08-10 07:12:15
16120794,13159450,74167345,59,does not exist,488168214,2016-08-10 07:13:08
16120794,13159450,74167600,55,is used to,488168214,2016-08-10 07:15:56
16120794,13159450,74167647,59,same as https://github.com/twitter/heron/pull/1231/files#r74167181,488168214,2016-08-10 07:16:29
16120794,13159450,74167733,5,"just ""Currently, ... is still experimental"" should be fine...",488168214,2016-08-10 07:17:26
16120794,13159450,74167829,6,"Why use ""Moreover"" here?",488168214,2016-08-10 07:18:49
16120794,13159450,74168722,18,"can you use ordered or unordered list instead of ""either ... or ..."" here?",488168214,2016-08-10 07:29:34
16120794,13159450,74168937,102,"not really important, but to be consistent, 'S' should be in lower case",488168214,2016-08-10 07:32:34
16120794,13159450,74168953,127,"same, lower case (forgive my being picky...)",488168214,2016-08-10 07:32:51
16134817,3201045,74134137,29,"use Log.debug(""Topology deployment status %s"" % (opt.get_config(...))

so that it is displayed even in the case of active vs paused.",488298341,2016-08-10 03:06:30
16141490,3201045,74156431,5,Why change to IHeronSerializer?,488361795,2016-08-10 05:27:20
16141490,13159450,74156637,5,also wondering... we don't have to even follow the naming convention from Factory method of Java,488361795,2016-08-10 05:29:26
16141490,5458092,74165674,5,I thought it might be better to indicate in the name that this is an interface.,488361795,2016-08-10 06:55:30
16141504,3201045,74156719,37,do you want to use Log.debug(traceback.print_exc()),488362672,2016-08-10 05:30:18
16141504,13159450,74169224,21,joining a list of one element?,488513803,2016-08-10 07:36:32
16141504,13159450,74169282,21,"also, better rename it to `cmd`. `args` does not make sense to me.",488513803,2016-08-10 07:37:18
16141504,13159450,74170409,27,"Not necessary because `main` execution failed. Not really being a troll, but a user can mistakenly submit a PEX even without `if __name__ = ""__main__""`. It's also possible that this PEX has some module importing problem. In this case, user still will see ",488513803,2016-08-10 07:50:27
16141504,13159450,74170447,37,should be `traceback.format_exc())`. Fix all the same errors if you think there are more.,488513803,2016-08-10 07:51:01
16141504,13159450,74170542,8,"how about `Log.error(""Error when loading a topology: %s"", str(ex))`",488513803,2016-08-10 07:52:07
16182937,13159450,74790579,5,em.. why switching order here?,492371504,2016-08-15 23:36:43
16182937,3201045,74793299,5,"This is because the user defined class path should come earlier than the system or heron class path.

cheers
/karthik

> On Aug 15, 2016, at 9:36 AM, Mark Li <notifications@github.com> wrote:
> 
> In heron/cli/src/python/execute.py <https://github.com/twi",492371504,2016-08-15 23:54:57
16182937,6377806,76495795,33,The classpath entry can be a directory also. For e.g. dir of hadoop config xml files. This check fails for a directory.,500977355,2016-08-27 05:11:44
16222015,5458092,74660866,8,"Waiting 30 secs for retry is too long, as most retry happens because posting result was slightly later than trying to fetch the result.",491396584,2016-08-13 04:10:31
16222015,5458092,74676910,30,"Travis machine uses Python 2.7.3, in which asyncore module doesn't have `connecting` attribute.",491820902,2016-08-13 07:23:41
16222015,13159450,74677299,30,looks fine to me. ???? ,491820902,2016-08-13 07:32:29
16222015,3201045,74522644,8,leave a space between JAVA and PYTHON,492330453,2016-08-12 06:33:18
16224880,3201045,74674376,22,"instead of this - can we do the following - 
```
address = socker.gethostbyname(socket.gethostname()) if not command_line_args['address'] else command_line_args['address']
```",491681745,2016-08-13 06:34:56
16224880,3201045,74674535,22,"or instead of the long line - 

```
address = socket.gethostbyname(socket.gethostname())
if command_line_args['address']:
   address = command_line_args['address']
```
easy to read as well, thoughts? ",491681745,2016-08-13 06:37:25
16224880,13159450,74676739,22,:+1 this is easier to read. ,491681745,2016-08-13 07:20:24
16224880,401111,74677868,22,"@kramasamy @objmagic 
In the multiple NICs env socket.gethostbyname(socket.gethostname()) would return virtual NIC address such as vpn, virualbox, docker...
Therefore, I added '0.0.0.0' as Tornado default bind for IPv4, and It's not a good solution too.",491681745,2016-08-13 07:51:45
16224880,3201045,74677906,22,"@lukess - if the user knows that there are multiple NICs, you address port combination will help.",491681745,2016-08-13 07:53:19
16224880,3201045,74677981,22,"Also, you might want to make the same changes to heron-tracker as well?",491681745,2016-08-13 07:55:52
16224880,401111,74678361,22,"@kramasamy you are right 0.0.0.0 is not a good log. Make it clearer,
$ heron-ui, currently it prints Listening at http://{ip address from one of the interfaces}:8889, but it actually LISTEN 0.0.0.0/:::8889",491681745,2016-08-13 08:09:16
16224880,3201045,74678419,22,"@lukess - that is bad. It does this in the case of multiple NICs using socket.gethostbyname(), is that correct?",491681745,2016-08-13 08:11:02
16224880,3201045,74678436,22,"in my case it does the following
```
Listening at http://127.0.0.1:8889
```",491681745,2016-08-13 08:11:31
16224880,3201045,74678732,22,@lukess - can you check how does your /etc/hosts file looks like?,491681745,2016-08-13 08:23:39
16224880,401111,74678837,22,"@kramasamy sure,
127.0.0.1      	    localhost
255.255.255.255	broadcasthost
::1             localhost

May I know LISTEN when you run heron-ui too?
$ lsof -i -P | grep LISTEN",491681745,2016-08-13 08:27:14
16224880,3201045,74678943,22,it is listening in IPv6 and IPv4 in port *.8889,491681745,2016-08-13 08:31:11
16224880,401111,74678640,22,@kramasamy honestly I don't know right now. I will test it later. My assumption is from https://github.com/tornadoweb/tornado/blob/7ec71d46a83eade88f6d588f8f568f9759676c89/tornado/netutil.py#L111.,491681745,2016-08-13 08:20:27
16224880,401111,74679048,22,"ok~ it did listen to 0.0.0.0 and ::
I think the problem right now is if want to force address to socket.gethostbyname(socket.gethostname()) by default which always send Address into Tornado bind.",491681745,2016-08-13 08:36:54
16224880,401111,74679100,22,"or add a warning log, and print 0.0.0.0 as well.",491681745,2016-08-13 08:39:09
16224880,3201045,74681851,45,should it address=address?,492482065,2016-08-13 12:07:40
16224880,3201045,74681842,30,you should use DEFAULT_ADDRESS,492482065,2016-08-13 12:06:29
16224880,401111,74682537,45,my bad! I did not read create_parsers() carefully. The default arguments have been set up. Should I add tracker address in this pull request?,492482065,2016-08-13 13:07:35
16224880,3201045,74730748,45,@lukess - please consider a seperate PR for the tracker address. ,492482065,2016-08-15 15:07:33
16227768,3201045,74681042,6,please change the name to ```common_py```,492162693,2016-08-13 10:54:47
16227768,3201045,74681248,17,it should be heron-examples-python?,492162693,2016-08-13 11:10:41
16227768,3201045,74681271,19,please change it heronstreaming@gmail.com,492162693,2016-08-13 11:13:21
16227768,3201045,74681333,14,"Pyheron package allows a developer to write python topology in Heron. Pyheron is backward compatible with the popular python API called streamparse. It can be run in various clusters including Mesos/Aurora, Mesos/Marathon, YARN, etc.",492162693,2016-08-13 11:18:48
16227768,13159450,74851850,39,"we should specify license somewhere? Is this related to #1259 ?
![image](https://cloud.githubusercontent.com/assets/3656079/17682706/42e56a7a-6302-11e6-989c-2c3e114e531b.png)
",493986547,2016-08-16 06:07:01
16276371,13159450,74809324,38,`keys()` is not necessary here. Feel free to ignore since this is trivial...,493990703,2016-08-16 01:30:29
16276371,73683,74818300,38,I had no idea...,493990703,2016-08-16 02:24:03
16342993,3201045,75251903,39,Nice cleanup!,495586563,2016-08-18 12:56:21
16342993,3201045,75252046,21,Instead of do_print - can we use our logging API - for consistency?,495586563,2016-08-18 12:58:25
16342993,3201045,75251842,62,Since this is a nice tool - it might be good to separate this out in a separate file - so that it works for any state manager. We can make it work for any state manager?,495586563,2016-08-18 12:55:29
16342993,73683,75347802,62,"Are you referring to the `doMain` functionality? That is integrated into both the local and zookeeper subclasses of `FileSystemStateManager`, so it is available in all of our state managers.",495586563,2016-08-19 00:07:04
16342993,3201045,75348185,62,+1 cool - nice.,495586563,2016-08-19 00:09:27
16342993,73683,75349035,21,Good catch. That methods actually not used. Removing it.,495586563,2016-08-19 00:14:13
16342993,3201045,75380140,39,"Instead of having the main there - could we separate this into tool called - 

```
heron-zk 
```
that can be used to show the contents of state managers -  this tool can take the name of the cluster and use the appropriate config file for state manag",496123088,2016-08-19 03:12:10
16342993,73683,75390360,39,"What we have here is only intended for developers while troubleshooting, not end users per se, so I don't see a need at this point to create a distributable tool. End users would have a higher level abstraction in the heron-explorer. 

The command to ru",496123088,2016-08-19 04:13:38
16342993,3201045,75390869,39,ok sounds good!,496123088,2016-08-19 04:17:00
16349500,5458092,75251114,29,"btw, why do we need this? Isn't this the same with `get_heron_dir()`?",495544790,2016-08-18 12:42:44
16405048,73683,75564989,4,typo: debs,496868179,2016-08-20 06:29:20
16405048,73683,75565150,80,There are more changes in this class than required for a new initialize signature. Is that because you're refactoring to make things easier when implementing `IRepacking` or are these functional changes?,496868179,2016-08-20 06:31:43
16405048,73683,75565374,12,`return Integer.toString(index);` is more idiomatic.,496868179,2016-08-20 06:35:32
16405048,16405288,75565919,80,This is refactoring,496868179,2016-08-20 06:44:02
16492459,11442576,75960934,3,we can increase the RETRY_COUNT to allow the test has more chance while decreasing the RETRY_INTERVAL.,499010512,2016-08-24 05:08:58
16492459,11442576,75961268,136,the splitcmd is logged twice.,499010512,2016-08-24 05:11:11
16492459,11442576,75961304,154,the splitcmd is logged twice.,499010512,2016-08-24 05:11:31
16492459,11442576,75961343,185,the splitcmd is logged twice.,499010512,2016-08-24 05:11:49
16492459,73683,75962819,3,IMO if a test is failing more than 5 times it's either a bad test or our test framework is too brittle. The fact that we have to retry at all is suspect.,499010512,2016-08-24 05:22:55
16492459,73683,75963005,136,Where do you see the other occurrence? I'm not seeing it. Below we log topologyName.,499010512,2016-08-24 05:24:27
16492459,73683,75963027,154,where?,499010512,2016-08-24 05:24:36
16492459,13159450,75963141,154,"`logging.info(""Killing topology: %s"", splitcmd)`

and again down below

`logging.info(splitcmd)`",499010512,2016-08-24 05:25:23
16495795,13159450,76007080,16,"umm, to keep uniformity, should we surround assignment operator using whitespace?",498738949,2016-08-24 14:33:57
16495795,11442576,76125718,16,good find,498738949,2016-08-25 02:47:43
16524447,3201045,76319018,100,From a terminology perspective what does HeronWorker mean?,499836931,2016-08-26 03:32:08
16524447,6377806,76329038,100,A HeronWorker represents a YARN container for heron instances. Scheduler and TMaster containers are managed differently.,499836931,2016-08-26 04:33:40
16524447,73683,76651368,231,It appears like you're returning null here and above to mask an exceptional condition. Could you instead throw an exception?,499836931,2016-08-30 00:43:23
16524447,73683,76651457,255,this seems to be an exceptional case. can we throw an exception instead of returning null?,499836931,2016-08-30 00:43:56
16524447,73683,76652011,145,"Are you using the boolean as a substitute for an exception here? If so, we should throw an exception if things that are expected to execute fail to do so.",499836931,2016-08-30 00:46:50
16524447,73683,76652153,368,Is this an exceptional condition?,499836931,2016-08-30 00:47:38
16524447,6377806,76664789,145,"IMO this is inline with the restart method definition: https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/scheduler/IScheduler.java#L85. If the restart operation fails, the core `runtime` logic expects a boolean: https:/",499836931,2016-08-30 01:52:46
16524447,6377806,76678738,255,"Ok, will throw the exception.",499836931,2016-08-30 03:17:07
16524447,6377806,76694761,231,"While I agree with your observation, I think returning null is the right thing to do in this case. This method allocates a new container. Either it works or there is an exception. The exceptions seems to be independent of the context and currently have a ",499836931,2016-08-30 04:51:52
16524447,6377806,76695668,368,"This would not happen normally. This could happen if two events happen concurrently. For e.g. user invokes restartContainer and reef invokes containerFailure event. If it happens, lookup will fail and the calling method can decide the action. As of now I ",499836931,2016-08-30 04:58:07
16524447,73683,76698270,145,"Ugh. Ah yes, the code is riddled with these unfortunate booleans where each callers in the stack checks for false and logs an error and returns false. It's really a poor man's exception throw IMO.

My thought on this is to not propagate this pattern mor",499836931,2016-08-30 05:16:26
16524447,73683,76698848,231,"My dislike of nulls (one of them) is that they're so ambiguous in meaning. It's much more expressive to throw something like a a ContainerAllocationException, which could be extended with stats codes, reasons, response messages, call stacks, etc. Returnin",499836931,2016-08-30 05:20:37
16524447,73683,76699408,368,"If this is a condition that should not ever happen, that's more of a reason IMO to throw an verbose exception than to log and return null and make all other callers above have to check for null. The cleanest implementation in my opinion is to annotate met",499836931,2016-08-30 05:24:20
16524447,6377806,76700460,368,"Given the distributed and asynchronous nature of this system, this condition can happen. This `hashmap` would not know why a particular key is missing and if it is an error situation. So I think an exception should not be thrown in this case.",499836931,2016-08-30 05:32:50
16524447,6377806,76701962,231,I see your point. I will recheck this case. ,499836931,2016-08-30 05:44:26
16524447,73683,76702552,368,"If this value might not be found under normal circumstances, could we use Optional instead?
http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html",499836931,2016-08-30 05:48:58
16524447,6377806,76702824,145,Agree with improper use of `null` or `boolean`. I will fix update this instance as it may make the code more readable.,499836931,2016-08-30 05:51:14
16524447,6377806,76709041,368,Optional would be used once Heron's own implementation is available as we cannot depend on java-8 for now.,499836931,2016-08-30 06:49:48
16524447,73683,76710314,368,"We can use guava's, which I've already introduced here:
https://github.com/twitter/heron/pull/1218/files#diff-c7b1c2644302d7242028db94c6ea727cR45",499836931,2016-08-30 07:03:58
16524447,6377806,76726243,368,"I modified the code to use Optional. To me use of Optional looked like a force fit. In absence of other java-8 features replacing null check with Optional.isPresent does not add any value. While I like the concept in general, I would like to skip its usag",499836931,2016-08-30 10:40:14
16524447,73683,76835847,368,"I tend to think that map like lookup functionality is an ideal place to return an Optional (guava's), regardless of whether we're using other Java 8 features or not.",499836931,2016-08-30 23:58:50
16524447,6377806,76884195,368,Updated to replace null with Optional.,499836931,2016-08-31 04:37:29
16524447,73683,77021484,368,The caller of this code always seems to log when isPresent is false so let's not double log here. Instead this method could just return `Optional.fromNullable(workerMap.get(workerId))` inside the sync block.,499836931,2016-08-31 23:27:06
16524447,73683,77021653,394,can we also use Optional in lookupByEvaluatorId(..)?,502997657,2016-08-31 23:27:55
16524447,6377806,77024620,394,Updated.,502997657,2016-08-31 23:43:24
16524447,6377806,77024654,368,Fixed instances where missing container was logged twice.,499836931,2016-08-31 23:43:40
16554603,73683,76312842,16,"The meaning of the return Boolean in ambiguous. Please define it in the javadocs.

Also most of the javadocs within this method are previously copy/pasted and invalid and could even be removed. I'd say we remove them all since they don't seem helpful.",500272977,2016-08-26 02:51:59
16554603,73683,76313021,50,how come we return false for execution state and topology but not the others?,500272977,2016-08-26 02:53:02
16554603,73683,76313107,53,"What is meant by ""Set topology def at last"" here?",500272977,2016-08-26 02:53:32
16554603,73683,76313518,13,"Let's include more context here. Like ""deleteNode called on <path> but...""",500272977,2016-08-26 02:55:55
16554603,73683,76313657,23,We also now have PackgingPlan in the state manager so please clean that up too.,500272977,2016-08-26 02:56:45
16554603,73683,76321138,5,I think this is fine for KILL. It should be a blunt tool that cleans out any possible state it finds of the topology. It shouldn't fail when one part is missing and then leave behind another.,500272977,2016-08-26 03:45:54
16554603,198508,76321376,50,"This might have been a poor merge conflict resolution, good catch.",500272977,2016-08-26 03:47:25
16554603,198508,76321573,5,I agree. This will actually still fail if the scheduler state is missing which isn't great but that seemed to be a bit more to unravel but I can see if theres a way to succeed in that case as well. ,500272977,2016-08-26 03:48:34
16554603,198508,76324847,23,It is deleted a few lines below this (https://github.com/twitter/heron/pull/1128/files#diff-6564229e92c7d6359355807e020d0972R237),500272977,2016-08-26 04:07:53
16554603,73683,76329539,23,"We can eliminate a lot of dup lines of with a method like this:
```
private void logDeleteStatus(Boolean success, String name) {
  if (result == null || !result) {
      LOG.warning(""Failed to clear "" + name);
  }
}
...
logDeleteStatus(deleteTMast",500320852,2016-08-26 04:36:41
16554603,73683,76888212,9,We want to guard against new locations being added that are not included in this block. Now that we have the enum [FileSystemStateManager.StateLocation](https://github.com/twitter/heron/blob/f0472c3932f839657fd98e6d3f85c7e87f7b0982/heron/statemgrs/src/jav,502934595,2016-08-31 05:01:52
16554603,73683,76889094,9,"Actually, we could add delete to the enum so it really won't get missed:
```
    public void delete(IStateManager stateManager, String topology) {
      switch(this) {
        case TMASTER_LOCATION: stateManager.deleteTMasterLocation(topology);
     ",502934595,2016-08-31 05:08:04
16554603,198508,76899985,9,"I like that. I didn't see that new data structure, let me refactor this based on your suggestions. ",502934595,2016-08-31 06:38:26
16554603,73683,77220219,53,"This will be reached if someone adds a new Enum without updating the case statement. Please throw an `IllegalArguementException` (?) here. Bonus points for a way to catch such a condition at compile time, which I can't think of atm.",504239059,2016-09-02 00:44:45
16554603,73683,77220653,12,My suggestion was to also move the loop into the enum in a `deleteAll()` method that then delegates to `delete()`.,504239059,2016-09-02 00:47:05
16554603,198508,77281735,53,It *might* also be easier if there was a `deleteState` interface on `IStateManager` that took this enum. All of the state lives in a single location so there really isnt a huge need to define all of the different delete methods for the different locations,504239059,2016-09-02 08:27:38
16554603,73683,77379174,53,"If we have delete state that takes an enum then each implementer will need a switch on the enum, and will need to updated when a new location is introduced. By putting the switch inside the enum as a helper, than only that enum needs to be changes when th",504239059,2016-09-03 00:03:12
16554603,198508,77382527,53,"My thought was that we could remove the need for the switch by just
deleting based on the 'dir' property on enum. Let's just table that idea
for now.

-- 
Andrew Jorgensen
@ajorgensen
",504239059,2016-09-03 00:26:14
16554603,73683,71800064,15,"if execution state doesn't exist we return true, which doesn't seem like what we want here no?",480768515,2016-07-22 05:36:15
16554603,73683,71800102,32,typo,480768515,2016-07-22 05:36:36
16554603,73683,71800607,88,please remove this and the 2 other (previously) copy/pasted comments that are erroneous.,480768515,2016-07-22 05:40:56
16554603,73683,71801143,17,"open question, but do we need 'does'? in these methods (e.g., `boolean schedulerLocationExists(..)`).",480768515,2016-07-22 05:45:45
16554603,198508,71886306,15,"I think it is, if the execution state doesn't exist we cant properly validate the runtime so my proposal is that we default to true. If we return false the command will fail and we'd be in the same situation where the command will fail to run (see: https:",480768515,2016-07-22 21:22:41
16554603,198508,71886420,17,"No I think you're right, `schedulerLocationExists` reads better. I'll change all of these to be that form.",480768515,2016-07-22 21:23:23
16554603,73683,71909825,15,Looking closer at the code I think this method would be better named ` validatePrecommandState` or something along those lines. It's basically asserting that the command is ok to be executed based on alignment of client state with zookeeper. If executionS,480768515,2016-07-22 23:51:39
16554603,198508,71914685,15,"I see what you're saying now. So the idea would be that if for some reason the execution state was gone then some commands (restart, active, deactivate) would just simply fail and would require the topology to be killed and then submitted it order to use ",480768515,2016-07-23 00:26:29
16554603,73683,71915352,15,"+1 to your first paragraph. We could limit this change to say that unless the command is a `kill` we should require valid system state. Kill should hard-kill everything and clean out all state.

I don't think the 2nd paragraph suggestion would work, sin",480768515,2016-07-23 00:30:54
16554603,198508,71917794,15,Yeah. It doesn't feel great to tell people they have to restart their topology in order to do some commands. In the end its probably not the end of the world but feels like there might be a different change to automatically recover from this scenario. The,480768515,2016-07-23 00:48:18
16554603,2183863,71977208,73,"Not sure whether to put `cleanState(...)` here or in the Utils class since it is more like an utils method, providing an aggregation of primitive methods.",481088124,2016-07-24 02:40:09
16554603,2183863,71977218,6,Need to clean all state? Or only explicitly clean execution_state and topology to make it more specific and clear?,481088124,2016-07-24 02:41:44
16554603,2183863,71977266,7,"This style of implementation could lead to one more remote call. Could we figure out a more-efficient way?
Similar to below.",481088124,2016-07-24 02:45:46
16554603,73683,72007187,73,"I'm not a fan of util methods for things that do statefull operations on the system. IMO utils should be simple static helpers, like string or date helpers.

It's also good IMO to keep this as an instance method here to keep the logic together. If a new",481088124,2016-07-25 11:12:33
16554603,2183863,72014542,73,sounds reasonable.,481088124,2016-07-25 13:37:33
16554603,198508,72098964,6,It's all state.,481088124,2016-07-25 23:40:29
16554603,198508,72099217,7,"The other way I could do this is surround these all with try/catch blocks and specifically catch exceptions. I dont know if there is a ""safe"" version of the zookeeper interaction where if the node does not exist it doesn't throw an exception but I can loo",481088124,2016-07-25 23:41:46
16554603,73683,72146435,13,"I think LOG.warn would be justified, since code shouldn't be calling delete on something that they don't expect to be set.",482387823,2016-07-26 04:15:57
16558115,13159450,76362908,200,should these be `Log.debug`?,500335146,2016-08-26 11:27:32
16558115,13159450,76366349,200,oh I forgot `heron-executor` logs to a file. Then I think it's ok to do `Log.info` here.,500335146,2016-08-26 12:36:25
16558115,73683,76366920,200,"Yeah, I think this are ok as info. They happen rarely and we typically want to know what's going on with this process restarting part.",500335146,2016-08-26 12:45:44
16560273,13159450,76680727,34,"Why mention ""Hadoop projects"" here?",502363557,2016-08-30 03:28:41
16625643,5458092,76696638,32,maybe change the variable name to `half_ack_bolt`?,502033983,2016-08-30 05:04:32
16625643,5458092,76696719,16,We should change the default logging level back to `INFO`,502033983,2016-08-30 05:05:05
16669792,73683,76886621,21,Please append the topologyName to the log message.,502933826,2016-08-31 04:51:47
16669792,73683,76887072,79,"FWIW, I just added a helper for making test PackingPlans, which I plan to put up for review soon.
https://github.com/twitter/heron/pull/1218/commits/9a83804befd982160b0712e12eeec0f44b57d283#diff-e7d399afac5f08437a091d2116ddadf1R31",502933826,2016-08-31 04:54:42
16669792,6377806,77016263,21,"I can do that. When do you think topology name should be added to log messages? Do we need a ""Best Practices"" guide to help contributors and reviewers?",502933826,2016-08-31 23:00:07
16669792,6377806,77016449,79,Makes sense. Should I wait for the review to complete or create an issue to handle this later?,502933826,2016-08-31 23:01:10
16669792,73683,77018996,79,"I've included the change in #1321, which I suspect could merge today or tomorrow. It's up to you, you could either wait and refactor this PR or do it as a followup.",502933826,2016-08-31 23:14:31
16669792,73683,77019647,21,"I think a best practices doc could be good. We're already starting with some of those in #1311. Generally I think it's good to include identifying info in the log messages, in case this is logged in a shared env or from a suite of unit or integration test",502933826,2016-08-31 23:17:59
16669792,6377806,77032279,21,Updated.,502933826,2016-09-01 00:24:35
16669792,6377806,77032376,79,Refactored the code.,502933826,2016-09-01 00:25:01
16673662,6334077,77280634,4,"i was wondering do we need to modify README.md to mention users that current release only support `core api`,`Trident api` is not included.",505121702,2016-09-02 08:12:09
16679350,6377806,77025922,34,"Can it be assumed that the two sets, set for add and remove, will always be disjoint? If so I think it should be clearly documented in javadoc.",502999370,2016-08-31 23:50:45
16679350,6377806,77029641,82,Annotation required: @VisibleForTesting?,502999370,2016-09-01 00:10:44
16679350,6377806,77029678,76,Annotation required: @VisibleForTesting?,502999370,2016-09-01 00:10:54
16679350,73683,77033235,34,"Not really, since nothing disallows someone from adding a bunch of containers and then removing them. I did add a javadoc though to removeContainers to clarify that containersToRemove must be a subset of existing.

Added @VisibleForTesting.",502999370,2016-09-01 00:29:14
16679350,2183863,77116504,34,"I am wondering:
1. Can we use only one method: void removeContainers(Set<PackingPlan.ContainerPlan> existingContainers, Set<PackingPlan.ContainerPlan> containersToRemove);

2. Why the arguments for addContainers & removeContainers are not similar, i.e.",502999370,2016-09-01 12:38:13
16679350,2183863,77117462,20,"The name of ""ScalableScheduler"" indicates it is a scheduler interface. However, it is for ""Scalable"" features only. It could be better to remove Scheduler to make it ""Scalable"" or ""IScalable"".  Then actual scheduler can : 
class XScheduler implements ISc",503601861,2016-09-01 12:55:09
16679350,73683,77117885,34,"I was also mulling over that inconsistency. We first implemented as this:
```
void removeContainers(int existingContainerCount, int numContainersToRemove);
```
and for the Aurora impl we could do the math to determine the ids last of the containers to",502999370,2016-09-01 13:01:29
16679350,73683,77119103,20,"The intent was to say that this is a Scheduler that's scalable, but I see your point. It seems like we could do one of these two options:

1. `IScalable` with the add/remove methods
2. `IScalableScheduler` that extends `IScheduler` and includes the add",503601861,2016-09-01 13:19:57
16679350,6377806,77207558,34,"I agree, it would be better to remove `existingContainers`. The scheduler will be orchestrating the update operation. In which case it will already have access to existing containers. 

However, we may ask if update operation needs to be executed as a t",502999370,2016-09-01 23:27:32
16679350,6377806,77210102,20,"On a high level, the plan is to add a method `onUpdate` to `IScheduler`. This method will be invoked by `RuntimeManager`. The implementation `onUpdate` method will invoke itself to add and remove containers after necessary computations. Given this context",503601861,2016-09-01 23:42:55
16679350,73683,77213248,34,Sounds good. I'll remove `existingContainers` from the signature. And we can look into packing plans ids as a means for transactions.,502999370,2016-09-02 00:01:27
16679350,73683,77214030,20,"Not all schedulers might support the ability to add/remove containers dynamically, which is why I created an interface for those that do. The 'onUpdate' method delegates to the `UpdateTopologyManager` with an `Optional<ScalableScheduler>`. If it is not pr",503601861,2016-09-02 00:06:43
16679350,2183863,77235443,20,+1 for `IScalable`. And it also allows the flexbility to have one more interface  `IScalableScheduler` that extends `IScheduler` and `IScalable` in future if needed.,503601861,2016-09-02 02:10:51
16679350,73683,77239837,20,Sounds good to me. Updated.,503601861,2016-09-02 02:40:12
16696239,6377806,77075585,20,"As mentioned in #1324, this map could be a immutable map?",503219780,2016-09-01 04:19:38
16696239,73683,77082376,20,"That map is initialized in the constructor and never exposed outside the class so making it immutable isn't really necessary. If there was a getter to return it, I would agree.",503219780,2016-09-01 05:05:03
16696239,6377806,77083060,20,Agree. Perhaps I was looking at this method `getContainers()` which returns the set of containers. The `Set` returned by this method should be immutable?,503219780,2016-09-01 05:10:21
16696239,73683,77090438,20,"Yeah, I was thinking about that. Updated to copy into an ImmutableSet during initialization.",503219780,2016-09-01 06:12:25
16771224,6377806,77762643,108,"In the past we discussed about issues when multiple components were updating a `PackingPlan` (`Launcher` while submitting a topology and `Scheduler` while updating the topology). In this case, `PhysicalPlan` is also getting updated my multiple components;",508108816,2016-09-07 12:43:53
16771224,73683,77859571,108,"Typically the launcher (or the `TMaster` in the case of physical plan) initially writes object and `RuntimeManager` deletes them on kill. That pattern is somewhat standard.

Where we're deviating is with the `Scheduler` updating `PackingPlan` and `Topol",508108816,2016-09-07 23:40:28
16771224,6377806,77862752,129,"Just curious, in what cases will the two packing plans differ? And if that happens what is the user expected to do?",508108816,2016-09-07 23:57:05
16771224,6377806,77864239,184,`updateComponent` can return false. Should merge operation fail if that happens? `false` case should not happen so I think the case could be treated as an exception?,508108816,2016-09-08 00:04:41
16771224,73683,77875165,129,"They will differ if they somehow get our of sync, like during a race when multiple agents are trying to update packing at the same time. This is a poor version of checking though. I'd like to keep this in place for now, but follow up with real transnation",508108816,2016-09-08 01:09:40
16771224,73683,77875900,184,"updateComponent will return false under normal circumstances (see the updateComponent javadocs). Because in the protobuf world Bolt and Spout are both Components, but without inheritance, we have to try to update each to see if we have a match. We use tru",508108816,2016-09-08 01:13:48
16771224,16405288,77878728,157,"I'm a little confused here. Do we remove a container if its instances do not exactly match the previous ones? What happens if the current container contains instances 1,2,3 and the proposed container contains 1,2,4? Do we remove this container and re-allo",508108816,2016-09-08 01:30:56
16771224,6377806,77882069,157,"I agree with @avflor. 
My impression is that scheduler will allocate new containers for executorIds not present in the current plan and remove container's for executorIds not present in new packing plan. Moreover this logic can result in adding an existi",508108816,2016-09-08 01:51:11
16771224,6377806,77882486,184,I see the point. This looks fine now. Just wondering if there is a way to simplify the logic here? For e.g. by deserializing the topology protobuf object and then updating it?,508108816,2016-09-08 01:53:26
16771224,73683,77884178,184,"Updating the protobug Topology object is indeed clunky, due to the protobuf api, but I thing it's safer and easier (and more efficient) than going through a deserialization/serialization process, and the risk of ending up with a different Topology object ",508108816,2016-09-08 02:04:24
16771224,73683,77884763,157,Great catch. Updating now to use container ids.,508108816,2016-09-08 02:08:14
16771224,73683,77899913,157,Fixed.,508108816,2016-09-08 03:43:35
16771224,6377806,77904995,129,"By multiple agents, do you mean concurrent update requests? 
In my opinion this check should be removed. Jut in case scheduler plan is not in sync with persisted plan, scheduler would be able to persist the new desired plan. This check enforces topology ",508108816,2016-09-08 04:13:36
16771224,73683,77906134,129,"Yes. My thought was that if they're not in sync, something is happening that we're unable to reason so unexpected results could occur if we continue. I could be convinced to remove it though, just sharing my thinking when implementing.",508108816,2016-09-08 04:20:19
16771224,73683,77925637,129,I've removed the check and filed #1353.,508108816,2016-09-08 06:51:38
16771446,3201045,77743100,3,Why a new configuration variable? Will there be any issues when mixing packing algorithms?,505895333,2016-09-07 07:28:09
16771446,73683,77755524,3,There are separate interfaces for each (`IPacking` and `IRepacking`) so implementors can implement one or the other. An `IRepacking` impl should not assume anything about what `IPacking` impl was used at submit.,505895333,2016-09-07 10:30:43
16771446,6377806,77762963,155,"I think the packing plan is set by `Launcher` or `UpdateManager`. If so the log message needs to be fixed.

Coincidentally, I saw this issue today (#1347) and created a PR #1348. I am ok if it is marked a duplicate of this and closed. ",508110344,2016-09-07 12:49:32
16771446,6377806,77763292,221,The input request Map is modified by this method. I think it would be better to create a new structure with the delta to avoid any confusion.,508110344,2016-09-07 12:54:18
16771446,16405288,77764719,221,I think we need to add a check that delta should not be negative. For now we do not support scaling down. We can remove it once I implement this case in repack.,508110344,2016-09-07 13:14:00
16771446,73683,77865882,221,Both good catches. Fixed.,508110344,2016-09-08 00:14:53
16771446,73683,77866034,155,Fixed. Let's go with this change and cancel #1348 to keep the relevant updates together.,508110344,2016-09-08 00:15:49
16771446,6377806,77898456,155,The log message is still incorrect?,508110344,2016-09-08 03:35:11
16771446,6377806,77898529,162,The log message is incorrect?,508499693,2016-09-08 03:35:42
16771446,73683,77901320,155,"my bad, fixed.",508110344,2016-09-08 03:51:21
16771446,73683,77901381,162,fixed,508499693,2016-09-08 03:51:41
16772198,73683,77674878,5,"Log.warn seems fine here, but I typically like to prepend some text to make it clear that this message is from the metrics manager. ""Received the following response from the metrics manager: ...""

Same for metricstimeline.py below.",505910698,2016-09-06 23:56:21
16772198,73683,77674983,33,_are_ not available,505910698,2016-09-06 23:56:58
16772198,13159450,77677729,5,fixed via: https://github.com/twitter/heron/pull/1336/commits/18b6dd1011f8d5234686afe4814b837378595afd#diff-409c349551fd1e7ad3611d8544571cffR148,505910698,2016-09-07 00:12:03
16772198,13159450,77677868,33,"Thanks!!!

fixed via https://github.com/twitter/heron/pull/1336/commits/18b6dd1011f8d5234686afe4814b837378595afd#diff-b5454de1597b4cda2547ba9c6ca12541R125",505910698,2016-09-07 00:12:50
16772198,114449,77696964,32,I think you can break this loop and skip the following loop once find it.,505910287,2016-09-07 01:55:44
16772198,13159450,77703156,32,right. will do.,505910287,2016-09-07 02:35:19
16772198,13159450,77703880,32,update via https://github.com/twitter/heron/pull/1336/commits/8ddd534675296dfe2032edd6bbf7b0d2c5650bc8. Can you have a look?,505910287,2016-09-07 02:39:51
16801706,3201045,77465017,5,"I think just contrib should work in a general fashion. As we add more spouts and bolts into contrib area, you might not want to change this file again and again",506782592,2016-09-05 09:26:07
16852101,3201045,77742979,86,Is this for testing - when you mentioned 'local'?,507961613,2016-09-07 07:26:50
16852101,13159450,77754514,73,can we use `Log` here?,507961613,2016-09-07 10:14:14
16852101,73683,77755381,73,"This was for debugging, removed.",507961613,2016-09-07 10:28:00
16852101,73683,77755422,86,"Yes, this was just for an easy way to manually check a file besides those in the unit tests.",507961613,2016-09-07 10:28:34
16854136,3201045,77880131,13,should it be jvm_metrics or pyvm_metrics?,508083720,2016-09-08 01:39:48
16854136,13159450,77890118,13,oops. `py_metrics`,508083720,2016-09-08 02:42:56
16879364,6377806,77897166,137,`resource` is not needed anymore,508546398,2016-09-08 03:27:53
16879364,73683,77900494,137,"Resource is still used in the ContainerPlan, but no longer in the PackingPlan.",508546398,2016-09-08 03:46:57
16918331,13159450,78104848,92,maybe use `Log.debug(traceback.format_exc(ex))`?,509343406,2016-09-09 06:02:34
16918331,73683,78106632,92,"good catch, fixed.",509343406,2016-09-09 06:19:39
16919239,73683,78202279,83,"If I understand correctly, `placeInstances` adds new containers beyond `numContainers`. Is that correct? If so can we make the signature and javadocs for `placeInstances` reflect that, because currently the method description and `numContainers` field imp",509359463,2016-09-09 22:43:19
16919239,73683,78202576,55,We should add a comment to clarify that this merge approach only works because the `ffdAllocation` generated above is done by appending new instances into new containers so there is no container intersection in the merge.,509359463,2016-09-09 22:45:16
16919239,73683,78203239,63,"For a large topology this could be a lot of output on the user console. We could keep it for now, but could you sort the container plans by container id? In #1360 I've added a comparator for unit tests, which we might want to pull into `src`. (Or we imple",509359463,2016-09-09 22:49:20
16919239,73683,78203815,94,"should we also be asserting an expected container size (ram), here and above?",509359463,2016-09-09 22:52:57
16919239,16405288,78231604,63,Thanks for catching this. I agree it shouldn't be here. I used this code only for debugging purposes and forgot to delete it afterwards.,509359463,2016-09-10 01:57:57
16951769,13159450,78282503,177,still camel case,510010215,2016-09-11 02:18:13
16951769,73683,78298328,177,"good catch, fixed.",510010215,2016-09-11 23:46:22
16988881,3201045,78319639,32,heron tools is repeated twice.,511028425,2016-09-12 13:23:01
16988881,3201045,78319655,1,what does this file do?,511028425,2016-09-12 13:23:16
16988881,414148,78322544,32,It's copied from `Dockerfile.dist.ubuntu14.04`. I'll remove the last line and build again to see whether it works or not,511028425,2016-09-12 14:01:58
16988881,414148,78324105,1,"`/build-artifacts.sh` use `Docker.ubuntu16.04` to compile and output artifacts.
`/build-docker.sh` use `Docker.dist.ubuntu16.04` and `build-artifacts.sh`'s output (artifacts) to build docker heron images.",511028425,2016-09-12 14:19:58
16988881,414148,78324654,32,Duplicated one is deleted,511028425,2016-09-12 14:25:21
17001835,198508,78408709,5,Purely nit picky organization thing but can you keep `HERON_UPLOADER_S3_ACCESS_KEY` and `HERON_UPLOADER_S3_SECRET_KEY` grouped together instead of putting keys between then?,511334955,2016-09-12 23:44:38
17001835,198508,78409072,51,(nit): Extra newline here is not needed.,511334955,2016-09-12 23:46:46
17017010,73683,78494041,5,"What if it has the attribute but the value is None? Should we be doing this?
```
if hasattr(self, 'tunnel') and self.tunnel:
```
or is that redundant? Not sure if `hasattr` also covers `self.tunnel not None`",511695524,2016-09-13 11:09:33
17017010,13159450,78494520,5,"Good question. Since `self.tunnel` is only set at [this line](https://github.com/twitter/heron/blob/e26c37a0fa04d6e39ff639753463db7ffbf638ce/heron/statemgrs/src/python/statemanager.py#L120) and I tried a meaningless command to open a subprocess, the `Pope",511695524,2016-09-13 11:17:54
17017010,13159450,78494567,5,"```python
import subprocess
p = subprocess.Popen(['ssh', 'twitter.com']) # should fail
```

`p` is still an object instead of a None.",511695524,2016-09-13 11:19:00
17017010,13159450,78494580,5,but I think we can add this check just to be safe...,511695524,2016-09-13 11:19:18
17019484,6377806,78600068,19,"the instance Id used to container container index also `String.format(""%d:%s:%d:%d"", containerIdx, componentName, instanceIdx, componentIdx)`. Is it not needed any more?",512059564,2016-09-13 23:55:22
17019484,73683,78601565,19,"No, it's actually no longer needed. It was only used to be parsed by the packing classes and the executor. Now that it's contents are part of InstanceId, it's no longer needed. There is still a convenient task identifier generated and used by the executor",512059564,2016-09-14 00:02:51
17108645,73683,79214257,15,Best to work with `ContainerPlan[]` here instead of `Object[]`.,513662676,2016-09-17 00:27:23
17108645,73683,79216186,79,Please use Optional instead of null. See https://github.com/twitter/heron/issues/1311,513662676,2016-09-17 00:38:14
17108645,73683,79223732,269,Please use Optional instead of null. Or make this method return void if the caller doesn't care either way. See #1311,513662676,2016-09-17 01:18:57
17108645,73683,79223930,79,`removeEmpyContainers(..)`?,513662676,2016-09-17 01:20:04
17108645,73683,79225578,80,"Instead of iterating over entries it's more idiomatic (and reads easier IMO since it's always obvious what the key and value represents by their naming) to iterate over keys:
```
Iterator<Integer> containerIds = allocation.keySet().iterator();
while (c",513662676,2016-09-17 01:28:52
17108645,73683,79214136,13,Cleaner to use `PackingTestUtils.testContainerPlan(..)` repeatedly to construct an `Array<ContainerPlan>`.,513662676,2016-09-17 00:26:45
17108645,73683,79218699,86,"why does this test remove the first container? is it because container 1 has the 4 spouts being removed and if so, how did we make that the case? We should clarify since it's not clear why that's the case by reading the code.",513662676,2016-09-17 00:51:42
17108645,73683,79222832,281,Can we use Pair instead? https://github.com/twitter/heron/blob/master/heron/common/src/java/com/twitter/heron/common/basics/Pair.java#L24,513662676,2016-09-17 01:14:22
17108645,73683,79217539,49,"Do we need to return null to imply something. If this component should always exist we could throw an exception if it doesn't. If instead the component might not, let's return void. Callers that need to know if the component exists can call another method",513662676,2016-09-17 00:45:23
17108645,73683,79213539,23,"If we choose to implement `Comparable` we must assure that if `thisContainer.compareTo(thatContainer) == 0` then `thisContainer.equals(thatContainer)`, which isn't currently the case. It implies implementing `Comparable` for all child objects and includin",513662676,2016-09-17 00:23:20
17108645,73683,79218137,41,since this is a different condition it should be in another test. You could make a shared doTest method that just takes a map of component changes and each test method calls it with a different map.,513662676,2016-09-17 00:48:38
17108645,73683,79216713,73,"A given container can have more than one of a given component. Also could we change the method name to something with find or get in it. Something like:
```
public Set<InstanceId> findComponentInstances(String component) {
```",513662676,2016-09-17 00:41:02
17108645,73683,79222364,174,"I feel like we're stretching our use of Lists and Maps in the signature here, by passing a mutable list of containers and a map of containers to instance lists. Instead can we use an object that encapsulated all of that? Like a PackingPlan object or a var",513662676,2016-09-17 01:11:41
17108645,73683,79217104,65,Please don't return nulls to imply multiple scenarios. See #1311,513662676,2016-09-17 00:43:06
17108645,73683,79217904,36,Shouldn't this throw the exception and never let you proceed?,513662676,2016-09-17 00:47:23
17108645,73683,79219313,142,"For this test and others we should also assert the correct expected bolt and spout sizes before we scale, to make sure we're starting with the correct assumptions.",513662676,2016-09-17 00:54:51
17108645,73683,79215295,19,"The output of the assertion classes on failure expect the param ordering to be `[expectedValue, foundValue]`.",513662676,2016-09-17 00:33:19
17108645,16405288,79235473,73,"Yes, but this method returns only one of them. I don't care about returning all of them. ANy one would work. How about public InstanceId getAnInstanceOfComponent(String component)?",513662676,2016-09-17 02:26:27
17108645,73683,79434460,34,"An instance id with resources is an InstancePlan. Could we instead take an InstancePlan here and keep a Set of those? That way we don't need to separately track the sum of all resources for each add/remove.

If we do that we also don't need to pass a di",514310149,2016-09-19 23:44:15
17108645,73683,79435654,30,"Instead of string concatenation, better to use `String.format(""%s %d %d"", ...)` ",514310149,2016-09-19 23:50:12
17108645,73683,79435120,56,"When accessing class member variables, best to use `self.usedRam` here and elsewhere.",514310149,2016-09-19 23:47:30
17108645,73683,79437117,143,"The first 7 lines here are duplicated in 5 tests. Could you pull those out into an `initScalingTests()` method or maybe something like this, followed by assertions on the returned plan:
```
PackingPlan doScalingTest(Map<String, Integer> componentChanges",514310149,2016-09-19 23:56:29
17108645,73683,79440365,19,Could you add back the `PackingPlanTest.testContainerSorting` from the earlier review as `PackingUtilsTest.testContainerSorting`?,514310149,2016-09-20 00:12:05
17108645,73683,79510069,56,"Feel free to disregard this comment, as we don't follow this standard in many places.",514310149,2016-09-20 06:20:48
17108645,73683,79688071,104,Instead of creating a new Optional you could return the same one removed: `instancePlan`.,515909640,2016-09-21 02:04:19
17108645,73683,79688707,27,"to make it clean what this resource is, can we call it something like `capacity`?",515909640,2016-09-21 02:07:30
17108645,73683,79688804,23,"Instead of storing each part of the resource passed, can we just store the resource itself?",515909640,2016-09-21 02:08:02
17108645,73683,79689712,81,This is an indirect way to test container sorting. Could we instead write this test without a dep on FirstFitDecreasingPacking and just pass a Set of containers to sortOnContainerId and assert the returned ordering? That way we can directly test the utili,515909640,2016-09-21 02:13:02
17108645,73683,79689831,4,`TopologyAPI.Topology topology`,515909640,2016-09-21 02:13:38
17108645,16405288,79701741,4,@billonahill This gives me a checkstyle error that that the topology hides a field because the class contains a topology member. This is the reason I used t.,515909640,2016-09-21 03:16:24
17108645,73683,79702928,4,You could make the method static and pass `totalInstances` in as `totalExpectedInstances`,515909640,2016-09-21 03:22:15
17108645,73683,79717796,18,"Instead of using both capacity and maxResource, how about just capacity?",516546136,2016-09-21 04:33:35
17108693,73683,79083880,32,We could use container id 3 here instead of 2 to assert that it's ok to not be consecutive.,513648123,2016-09-16 06:31:34
17108693,73683,79084122,122,"If we're not already doing so, we should assert proper container ids as well as total container count.",513648123,2016-09-16 06:33:15
17108693,6377806,79084733,32,Good point. Non-consecutive ids is getting verified in `testAddContainer#L123`. ,513648123,2016-09-16 06:39:18
17108693,6377806,79085058,122,Ok. The containerIds are indirectly verified in L185. ,513648123,2016-09-16 06:42:34
17108693,6377806,79104918,32,Fixed,513648123,2016-09-16 11:26:43
17108693,6377806,79104930,122,Fixed,513648123,2016-09-16 11:26:52
17138058,3201045,79438474,17,"again use ""auto""",515244203,2016-09-20 00:02:56
17138058,3201045,79438364,15,Instead of explicitly declaring an iterator - you can use auto?,515244203,2016-09-20 00:02:22
17138058,3201045,79438596,47,"probably ""auto"" again.",515244203,2016-09-20 00:03:29
17138058,3201045,79943491,60,Please change this to be !instance_name.empty(),515687231,2016-09-22 05:05:21
17148706,73683,79444149,55,"Could you pass a stateManager instead of a runtime here? Better to not bury the stateManager initialization code.

Actually, if PackingPlan is updateable in ZK why is this method needed? Couldn't we just need to do thisL:
```
stateManager.setPackingPl",515372737,2016-09-20 00:29:18
17148706,73683,79444240,24,Please add a unit test for this method.,515372737,2016-09-20 00:29:40
17148706,6377806,79505631,24,"I have already created a unit test for this method, see SchedulerUtilsTest.updatesPackingPlanWithUniformSizedContainers#L180",515372737,2016-09-20 05:44:37
17148706,6377806,79506154,55,"I will remove the runtime from `persistUpdatedPackingPlan` method.

Regarding the `setPackingPlan`, I may have borrowed it from `UpdateTopologyManager.updateTopology #L-96`. I am not sure if you would know why it was implemented like that in the UpdateT",515372737,2016-09-20 05:48:35
17148706,73683,79640284,50,"Can we name this after the method it's testing, like testHomogenizedContainerPlan?",515372737,2016-09-20 22:32:29
17148706,73683,79640489,59,"I'm confused, shouldn't each of these be the same size (i.e. homogeneous)?",515372737,2016-09-20 22:33:28
17148706,73683,79640647,24,I see it now. I was searching for the method string and missed it.,515372737,2016-09-20 22:34:05
17148706,73683,79643729,55,Good eye. I suspect it was implemented like that in UTM initially because setPackingPlan was setting overwrite to false initially in LocalFileSystemStateManager. I don't think it should be doing a delete there as well.,515372737,2016-09-20 22:46:39
17148706,6377806,79654279,59,"The tests submits two different sized containers. Here `largeContainer` and `smallContainer` refers to the original size of the container before they are homogenized, see `SchedulerUtilsTests L#220`.",515372737,2016-09-20 23:31:55
17148706,6377806,79672870,50,"Ok. A public method can have more than one test method to test different control paths. So I plan to follow the following rules:

1. Include some test information in the name. That way if the test fails, a hint will be available to the developer. 
1. T",515372737,2016-09-21 00:56:09
17148706,6377806,79679645,55,"This is what I have understood, the implementations of `setPackingPlan` method will take care of updating the packing plan if it exists, or will create a node/file if it is not present. Is this correct?",515372737,2016-09-21 01:26:00
17148706,73683,79685535,55,"Correct, we shouldn't need to delete first.",515372737,2016-09-21 01:52:02
17148706,73683,79685935,50,"+1

Having some notion of the test method in the name (when possible) helps to clarify the scope of what the test if intended to verify. I find this useful for tests of limited scope, which I guess most should be ideally.",515372737,2016-09-21 01:53:38
17148706,73683,79686703,59,"Right, but large and smallContainer here are taken from containerArray which is taken form newPlan, which is supposed to be homogeneous right? So I'd expect newPlan to have same size containers, not large and small. Am I misunderstanding the expected beha",515372737,2016-09-21 01:57:28
17148706,6377806,79690240,59,I see the source of confusion. The resources estimated by packing plan are in contained in `requiredResource`. This object will not be modified by `getHomogenizedContainerPlan`. The max resource value will be updated in `scheduledResources` object. This i,515372737,2016-09-21 02:15:50
17148706,73683,79691798,59,"I see now, thanks for walking me though it. What would you think about renaming `getHomogenizedContainerPlan` to something like `withHomogenousScheduledResources`?",515372737,2016-09-21 02:24:13
17148706,73683,79692689,41,"This seems like a useful method to add directly to `ContainerPlan`:
```
public PackingPlan.ContainerPlan cloneWithScheduledResource(Resource resource);
```
We did something similar with `Resource.cloneWithRam`. Then the new constructor on ContainerPla",515372737,2016-09-21 02:29:22
17148706,6377806,79703286,59,I like your suggestion. Will update the method name.,515372737,2016-09-21 03:24:01
17148706,6377806,79704080,41,Good suggestion. Will add it.,515372737,2016-09-21 03:27:23
17148706,6377806,79705198,59,"On second thoughts, I am planning to add `PackingPlan.cloneWithHomogeneousScheduledResources`. Thoughts?",515372737,2016-09-21 03:32:55
17148706,73683,79717390,47,This could be private,516540104,2016-09-21 04:31:26
17148706,6377806,79719710,47,`clone` methods are public. Could you please help me understand why this should be private?,516540104,2016-09-21 04:44:06
17148706,73683,79722739,47,"Just because nobody else currently needs it besides the class itself. I typically keep things as restrictive as necessary and increase visibility when necessary, or when ready to provide a public, stable API.",516540104,2016-09-21 05:01:55
17148706,6377806,79724515,47,Done,516540104,2016-09-21 05:13:06
17190302,6377806,79442321,58,Should we replace `What you ... exists` with `The submit operation will fail if any path is invalid or if any file is missing.`,515625334,2016-09-20 00:20:59
17190302,6334077,79452710,58,Thank you so much for your reviewing. I will change it.,515625334,2016-09-20 01:06:34
17190302,3201045,79765469,23,@mycFelix - should we need this since we have released 0.14.3 already and 0.14.4 is going to be released this week or early next week?,515719351,2016-09-21 13:09:40
17190302,3201045,79765504,53,Is 0.14.2 version necessary?,515719351,2016-09-21 13:10:09
17263305,3201045,79954337,7,"Is this config used in scheduler.yaml? If that is the case it is needed in keys.yaml and you need an accessor function in one of the Context/Config to access this config. If there are some default values to be supplied for this argument, you need to add t",517250370,2016-09-22 06:24:55
17263305,73683,79958864,7,"No, `scheduler.yaml` doesn't use this. The current intent is that it can be set in one of two ways:

1. in the topology main code by calling `setUpdateDeactivateWaitDuration(Map<String, Object> conf, int seconds)` on `Config`.
2. By passing it as a com",517250370,2016-09-22 07:06:26
17263305,6377806,80567249,103,How are users expected to use this configuration? Is it based on size of the topology?,517250370,2016-09-27 03:38:04
17263305,6377806,80567863,94,"If wait time is a topology configuration, user can set it only once. If it were update operation specific configuration, then auto-scaling could use a different value based on need. Should this config be adaptive?",517250370,2016-09-27 03:41:19
17263305,6377806,80568612,28,These operations should be Mockito.verified?,517250370,2016-09-27 03:45:12
17263305,73683,80584837,94,"That is the intent yes, which is that the setting can be configured at topology submission time in the main method, or overridden at update time from the command line.",517250370,2016-09-27 05:10:14
17263305,73683,80585209,103,Some typologies flush internal state to external systems every N seconds. In that case they would set this value to something lager than N. This assures that the topology deactivated (pausing new tuple consumption from spouts) and state is flushed before ,517250370,2016-09-27 05:12:32
17263305,3201045,80608708,7,"@billonahill - should we just keep only --config-property? IMO - it might not be a good idea to provide API since our goal long term is to remove them from being hard coded.
- ",517250370,2016-09-27 08:52:29
17263305,73683,80617255,28,"Yes, good catch. Updated.",517250370,2016-09-27 11:10:26
17263305,73683,80618549,7,"@kramasamy Tsar has a use case to set this when topologies are created based on the cache settings so I think it's ok to keep the API. The values wouldn't be hard-coded, they'd be set during topology creation based on the setting from the higher level fra",517250370,2016-09-27 11:30:01
17263305,6377806,80712755,7,@billonahill The activate and deactivate wait durations are used to ensure runtime states are flushed/recovered as you explained below. It may not be always feasible to predict the time in all use cases. Moreover it would be mess up the api if we add one ,517250370,2016-09-27 21:58:08
17263305,73683,80743240,7,@ashvina implementing callbacks would be great but that's a much more involved feature that we'd need to think through and ideally have a solid use case for before building it. Currently we don't support any network callbacks to other systems so to do so ,517250370,2016-09-28 00:06:25
17263305,6377806,80749426,7,@billonahill I am not thinking of a network callback. Say a new interface `UpdateCallback` is added. A new `scheduler` config could be added using which the callback handler could be configured. The default implementation could be no op handler. User coul,517250370,2016-09-28 00:32:51
17263305,73683,80773233,7,@ashvina and I spoke offline and agreed to move forward with this approach and consider an event listener approach once we have a concrete use case for it.,517250370,2016-09-28 02:19:58
17263305,6377806,81254068,64,Should this be shutdownNow as any pending reactivate commands should be terminated?,521364479,2016-09-30 06:14:04
17263305,73683,81254942,64,"Cood catch, fixed. I changed to `shutdown()` when I was trying to get the CLI to not shutdown and kill the scheduler work before the reactivation finished. Instead I just waited on the future with `future.get(timeout)`.",521364479,2016-09-30 06:22:08
17263305,73683,79949106,7,@kramasamy is this change required topology configs? I see many entries in this file that are not referenced in the codebase so wondering what it's primary function is.,517250370,2016-09-22 05:43:10
17315752,3201045,80301611,35,"if the user does not provide a role in the command line - we supply the role as ""default"" and the environment as ""default""",518484555,2016-09-24 01:34:41
17315752,3201045,80302200,64,the base image should be a heron core image - that already contains the core image of heron?,518484555,2016-09-24 01:37:35
17315752,6847233,80302510,35,Is there a way to check if the user didn't supply the role? I don't like the idea of checking for default.,518484555,2016-09-24 01:39:21
17315752,6847233,80302981,64,"That's how we're using it but it's not necessary, a scheduler could do that work, or configure the scheduled task to download the core. I can change the documentation to call out that way of leveraging the base image if you think it's worthwhile.",518484555,2016-09-24 01:41:59
17315752,3201045,80303268,35,"It is at the CLI level - by the time it invokes the submitter which in turn calls the uploader, it might be too late.",518484555,2016-09-24 01:43:34
17315752,3201045,80303910,64,you mean scheduler will download the docker image for heron core and the docker image for topology? or the heron core is a tar image (like we have it today) and the docker image for the topology will know where to download the core when docker image is st,518484555,2016-09-24 01:46:22
17315752,3201045,80305742,64,got it from the detailed explanation.,518484555,2016-09-24 01:56:21
17315752,3201045,80326681,1,"Similar to this file, can you add a sample for heron.aurora - if somebody wants to use docker uploader. You could add this under the directory heron/config/src/yaml/aurora - with the file name heron.aurora.docker.",518569646,2016-09-24 04:03:22
17315752,3201045,80326824,1,can you write a page documentation similar to other uploaders so that we have information about how to use this?,518569646,2016-09-24 04:04:13
17315752,3201045,80392862,14,"@chris-pardy - how does this work? If the docker image is supposed to contain both the core image as well as topology image, we need to just use docker pull to get the image, is it correct?",519289738,2016-09-26 04:52:03
17315752,6847233,80477283,14,"This assumes that the docker image only contains the topology, so we fetch core from a remote url first. The container = ... bit tells Aurora to use the Docker image that the uploader built for the service code. If you wanted to also include the core file",519289738,2016-09-26 20:44:22
17315752,198508,82187399,47,"You are missing a `,` at the end of this line.",525310101,2016-10-06 20:27:29
17315752,198508,82187758,48,~~I believe this is supposed to just be `container = Docker(image = '{{heron_topology_image_uri}}')` according to the docs here: http://aurora.apache.org/documentation/latest/features/containers/~~,525310101,2016-10-06 20:29:08
17315752,198508,82189637,48,"Sorry  it looks like the docs differ in a few places on this one. I tried this: http://livewyer.com/blog/2015/04/13/deploying-docker-containers-using-apache-aurora and it seemed to parse correctly.

I think you do need to interpolate the `{{heron_topolo",525310101,2016-10-06 20:38:01
17315752,6847233,82190756,48,The containder = Docker is only supported in newer versions of Aurora. The heron_topology_image_uri is a python variable that's defined through the binding interpolation near the top of the file so just using it raw here is fine. We're using a patched ver,525310101,2016-10-06 20:42:53
17315752,198508,82191723,48,Ok. Coincidentally we dont have docker turned on in our aurora cluster and the aurora vagrant setup seems to not be working for me so im trying to figure out a way i can test this change out. With the missing comma I got up to the point where aurora is te,525310101,2016-10-06 20:47:34
17315752,198508,82284258,5,The base here actually has to be one with python installed in it. Aurora does some crazy stuff to get a aurora executor running inside the docker container so it can monitor its process and do health checking and things. The default ubuntu container does ,525343843,2016-10-07 04:01:31
17315752,198508,82290512,5,"The container attempted to run yes but overall it did not work. I still need to do a bit more tweaking I think to get it to get the heron binaries into the running container but working on it. 

How are you transporting the heron binaries into the conta",525343843,2016-10-07 04:34:19
17315752,6847233,82291549,5,"I'm personally using a Docker base image with the binaries, but writing them into the sandbox should be fine. I'm going to verify this tonight.",525343843,2016-10-07 04:40:15
17315752,198508,82291794,5,Do you mean the sandbox in aurora? AFAIK you dont have a mount point inside the docker container into the aurora sandbox and any command you setup in aurora will be run into the docker container itself which means that you need to be able to get to the bi,525343843,2016-10-07 04:42:00
17315752,3201045,82292577,5,"If you need the heron binaries in a container, we can build it as a part of the release process and ship it. Let me know if this will simplify it.",525343843,2016-10-07 04:46:07
17315752,198508,82292982,5,"yeah I think building out the full docker support wouldn't be too much more work from where this PR is now and would actually simplify how all this works. 

@chris-pardy if you dont have time to pick that up I can see if i can find some extra time to do",525343843,2016-10-07 04:48:50
17315752,3201045,82293465,5,"great! if you and @chris-pardy can let us what will be needed, we can get this done.",525343843,2016-10-07 04:50:51
17315752,6847233,82327343,5,@ajorgensen when you do go down that route you'll find that the heron executor tries to run chmod +x on a number of the base files. That won't work if they're not owned by the user who's running the executor. That's definitely not going to be the case for,525343843,2016-10-07 11:28:18
17315752,6847233,82288861,5,"Did it work when you changed the package to python:2.7?
",525343843,2016-10-07 04:25:54
17323775,3201045,80328686,21,"Instead of using environment variable, a better approach would be to check if these new configs are present, if these are present, use those - otherwise, default to what it is used to be. Alternatively, we can make this config mandatory - with the default",518567658,2016-09-24 04:17:08
17323775,73683,80329549,34,We should always join the configured path with the file name for consistency.,518567658,2016-09-24 04:23:28
17323775,73683,80329342,32,Instead of mixing both Heron configs and environment variables can we just use configs? Splitting the logic between configs and env variables makes for an inconsistent experience with hidden features. If we use a config param you can still pass it at the ,518567658,2016-09-24 04:21:58
17323775,6847233,80332019,32,"@billonahill I didn't know the --config-property was a thing, thanks. I'll drop the environment config, I actually much prefer the commandline option.",518567658,2016-09-24 04:41:23
17323775,3201045,80334769,32,"+1 please use --config-property, that is a better approach.",518567658,2016-09-24 05:01:33
17323775,3201045,80353553,12,"By default, this is not installed in /etc/heron. It is installed in where the cluster config resides. Location of where the config resides is provided as configPath in SubmitterMain - you need to use this configPath. Probably, a better approach would be i",518718140,2016-09-24 12:35:07
17323775,6847233,80380922,12,"I wanted to put something in this file to indicate that it could be set to a different, fixed directory. The Aurora Context file already does the fall back if the tag is not defined. I thought that having it here but commented out made sense since it woul",518718140,2016-09-25 19:20:35
17323775,3201045,80392683,12,"sounds good. perhaps, we can make the comment little more verbose 

- in the sense that these two parameters are optional
- Any situations it is used as well
",518718140,2016-09-26 04:40:17
17323775,3201045,80392780,25,"@chris-pardy - in the case of both the config being absent, how does this work? Is the JOB_TEMPLATE_DIR set to default somewhere?",518718140,2016-09-26 04:45:01
17323775,6847233,80478112,25,"The second parameter to the config.getStringValue method is the default value, I'm using the same values here that used to be in AuroraScheduler.",518718140,2016-09-26 20:48:06
17326665,3201045,80342136,33,What is this TODO? Can you comment on this?,518614945,2016-09-24 06:10:57
17326665,2183863,80346168,33,Removed.,518614945,2016-09-24 07:04:07
17326665,3201045,80346743,5,SendMessage might be deleting memory underneath - we need to be careful here.,518639453,2016-09-24 07:13:51
17326665,3201045,80347517,5,ignore this.,518639453,2016-09-24 07:28:00
17326665,3201045,80349677,59,Please remove the TODO - since there is no comment what needs to be done.,518639453,2016-09-24 08:18:46
17326665,114449,80352635,59,Removed.,518639453,2016-09-24 11:18:25
17326665,3201045,80349715,25,TODO without comment,518639453,2016-09-24 08:19:56
17326665,114449,80568261,48,Should be removed.,518709986,2016-09-27 03:43:17
17326665,114449,80567968,60,"This should be named as ""out_tasks_"".",518709986,2016-09-27 03:41:45
17326665,114449,80567784,13,This needs to be removed.,518709986,2016-09-27 03:40:54
17326665,114449,80568082,25,"No need 'inline' explicitly, inline is default here.",518709986,2016-09-27 03:42:22
17326665,114449,80568294,51,No 'inline',518709986,2016-09-27 03:43:29
17347045,5458092,80397702,45,"It seems that the name of the egg file should follow the original naming convention (`pyheron-{version number}-py2.7.egg` instead of just `pyheron.egg`), so that it can be recognized as a valid package.",519576593,2016-09-26 08:16:31
17347045,13159450,84331005,65,the subdir is not `streamparse` now.,527249662,2016-10-21 00:08:22
17347045,13159450,84333409,65,"I see lots of occurrences of `streamparse`. Is this PR up-to-date?
",527249662,2016-10-21 00:21:05
17348223,73683,80525705,16,"Great catch! Instead of maintaining another Set could you just check `processToContainer.values().containsKey(container.getId())`? That guarantees that we're always in sync with what `startExecutor` has started, since it updates `processToContainer`.

A",519554443,2016-09-27 00:20:49
17348223,1989169,80527266,16,"@billonahill The time complexity of my current approach is just `O(# existing containers) + O(# the added containers)`. But if using `processToContainer.values().contains(container.getId())`, the time complexity will become `O(# existing containers) * O(#",519554443,2016-09-27 00:28:15
17348223,73683,80537361,16,"That's a great observation @windie. If we were running production topologies with this class that added many containers I'd agree that this is a concern. In this case though, this is a local scheduler used for local development which we wouldn't expect to",519554443,2016-09-27 01:12:42
17348223,1989169,80624863,16,@billonahill Updated.,519554443,2016-09-27 13:05:16
17348223,73683,81650807,16,"@windie circling back on this since I realized that `HashMap.values()` returns the same view into the hashmap when called repeatedly, so the optimization question is moot. Calling remove on the map removes the entry and updates the backing values set.",519554443,2016-10-04 05:09:37
17348223,1989169,82116993,16,@billonahill `values` is not a set. Did you mean `keySet`?,519554443,2016-10-06 11:49:54
17348223,73683,82242365,16,"Sorry, values is a `Collection` which is what I was in fact referring to. Calling `map.values().contains(foo)` repeatedly as we add containers will not have `O(# existing containers) * O(# the added containers)` complexity, because `map.values()` does not",519554443,2016-10-07 00:37:10
17348223,1989169,82324317,16,Sorry that I was not clear. I meant the `contains` method is `O(# existing containers)`.,519554443,2016-10-07 10:29:45
17366687,6377806,80533338,4,Would it be useful to update the default value in the `yarn/scheduler.yaml` too. When needed users could find it in the config file and avoid searching for it. Also could you please add this config in the document.,519898107,2016-09-27 00:55:16
17366687,6334077,80615532,5,Planning to move this method to the YarnContext. I'll change it~,520243738,2016-09-27 10:40:10
17368175,73683,80526773,5,"Thanks for the patch!

Please change `ERR` to `ERROR` and remove the exclamation point.

Also please accept the CLA, see http://twitter.github.io/heron/docs/contributors/community/",519738248,2016-09-27 00:26:00
17382314,73683,82017750,62,"As a follow-up, we should move `ContainerAllocationException` into spi and make make `IScalable` throw it. Same thing for `ContainerRemovalException`. ",525257043,2016-10-05 23:47:23
17383874,6377806,80553819,5,What do you think about reusing this method in `UpdateTopologyManager.updateTopology Line#96`? Or even adding a new `updatePacking` method to `SchedulerStateManagerAdaptor` to avoid confusion?,520073695,2016-09-27 02:32:10
17383874,6377806,80553010,5,"There is a test for this util method, `persistUpdatedPackingPlanWillUpdatesStateManager`. Is verification of the delete operation needed?",520073695,2016-09-27 02:28:19
17383874,73683,80559505,5,"This operation works fine in the local filesystem state manager, which is used in the tests, but not the ZK state manager unfortunately.",520073695,2016-09-27 03:01:15
17383874,73683,80559914,5,"Yeah, I also considered that. Let me give that a shot.",520073695,2016-09-27 03:03:24
17383874,73683,80583290,5,I've added update commands to the state manager adaptor. Also changes `AuroraScheduler` to not update state manager as a side effect of calling `createAuroraProperties`.,520073695,2016-09-27 05:00:03
17385979,73683,80583779,4,Can we keep `JavadocStyle` in place so if there are javadocs we verify they are valid.,520115354,2016-09-27 05:03:09
17395920,73683,80618714,4,"Since Step 3 is to start Heron Tracker before Step 4 to start the UI, I don't think this comment is needed. It's assumed that the reader is not skipping steps.",520287243,2016-09-27 11:32:44
17395920,2863245,80619609,4,"After Step 3, as ``heron-tracker`` is still running in the command line, the user might kill it by ``control + c``, so as to type the command to launch Heron Ui as suggested in Step 4. In such case, the ``heron-ui`` will not work properly and the users wi",520287243,2016-09-27 11:45:52
17395920,73683,80620497,4,The first sentence section of this section is `Heron UI is a user interface that uses Heron Tracker`. The text is very clear IMO that the tracker needs to be running.,520287243,2016-09-27 11:59:49
17411267,3201045,80710520,55,"If you are unable to connect, can you please print a log message for the host/port that you are unable to connect. I know it is not there previously - but it will be nice to have.",520604366,2016-09-27 21:50:05
17411267,3201045,80711591,1,"you might want to change the example configuration files or given a commented example in

 heron/tools/config/src/yaml/tracker/heron_tracker.yaml",520604366,2016-09-27 21:54:04
17411267,73683,80763132,95,Does this assure that `self.tunnel != None`?,520750359,2016-09-28 01:31:27
17411267,73683,80763581,30,space after comma,520750359,2016-09-28 01:33:39
17411267,73683,80763974,23,"This took me a little while to figure out the NoseFlute naming, I'm a little slow. :) Can we call this MockKazoo or something more boring, but more informative?",520750359,2016-09-28 01:35:34
17411267,73683,80763305,14,"python vars should be snake_case, not camelCase.",520750359,2016-09-28 01:32:18
17429853,73683,80962548,11,"Can we remove this, or should it not be commented out?",520950984,2016-09-28 23:42:35
17429853,73683,80964319,21,best to calculate the pad only once and use that in both the criteria and the logging. Same for below.,520950984,2016-09-28 23:51:04
17429853,73683,80966880,4,IMO the code is less verbose and easier to read when using these static imports and not the fully qualified param below.,520950984,2016-09-29 00:01:48
17429853,73683,80967260,97,"better to set all class member values during initialization, instead of as a side effect from a logic method.",520950984,2016-09-29 00:03:48
17429853,73683,80967620,35,"No need for this variable, same below.
```
return new Pair<PackingPlan, Resource>(newPackingPlan, packingPlan.getMaxContainerResources())
```",520950984,2016-09-29 00:05:41
17429853,73683,80968389,17,"please clarify in a javadoc what `Resource` represents.

Actually do we need to return this? It seems like the test should always asserts that the new containers are < the initial maxContainerResource, so could that assertion always be done within doSca",520950984,2016-09-29 00:09:06
17429853,73683,80965440,9,"Assertions in a loop can be tricky to diagnose when they fail. Best to add a failure comment as a first arg that includes the container id, to help upon failure.",520950984,2016-09-28 23:55:58
17429853,73683,81186063,16,PackingUtils.increaseBy,521277876,2016-09-30 00:09:00
17429853,73683,81186083,28,PackingUtils.increaseBy,521277876,2016-09-30 00:09:09
17429853,73683,81186454,9,prefer String.format over concatenation.,521277876,2016-09-30 00:11:12
17429853,73683,81186137,40,PackingUtils.increaseBy,521277876,2016-09-30 00:09:28
17429853,73683,81187533,63,"Yes, these methods are trivial but we should have a simple unit test.",521277876,2016-09-30 00:16:36
17429853,73683,81187440,67,"Seems like we always round doubles. If so, maybe we should just do that as part of the method?",521277876,2016-09-30 00:16:09
17429853,16405288,81199089,9,@billonahill Why is that important? Is there a performance difference? My understanding is that this message will be printed only when a failure happens.,521277876,2016-09-30 01:07:25
17429853,16405288,81199296,67,@billonahill I would prefer it to keep it outside in the algorithm logic and not in the utils. Other algos could implement ceiling or sth else for cpu. ,521277876,2016-09-30 01:08:26
17429853,73683,81217357,9,"IMO it improves readability and is generally less typo-prone to have the text template, followed by the dynamic args that follow. It also makes it easier to update text without have so many `"" + foo + "" `s to work with. But this is subjective I suppose. ",521277876,2016-09-30 02:36:29
17429853,73683,80963753,45,"This calc gets redone in many places. Can we create utility methods for padding in `PackingUtils`? Something like this maybe?
```
public static long increaseBy(long value, long percent);
```",520950984,2016-09-28 23:48:22
17429853,73683,81217493,67,Fair enough.,521277876,2016-09-30 02:37:07
17444193,73683,81024476,19,"Looks like there are a couple more instances of `heron/tracker`, as well as `heron/cli` and `heron/ui` in the docs. Would you mind please fixes those as well?",521181851,2016-09-29 04:45:07
17444193,2183863,81024757,19,Definitely.,521181851,2016-09-29 04:46:37
17457955,73683,81189009,20,"this could be for another PR, but it would be great to have a unit test that loads things up and verifies the default configs, then another one that loads things up with overrides and verifies that too. Such a test would verify that this `.set` call wasn'",521280320,2016-09-30 00:23:57
17457955,6377806,81196020,20,Good point. I have some ideas to test the yarnconfigs. Will create an issue to track it separately. Thanks.,521280320,2016-09-30 00:54:21
17460290,2183863,81217962,27,Add a new line at the end?,521296561,2016-09-30 02:39:54
17460290,2183863,81218036,23,Add a new line at the end?,521296561,2016-09-30 02:40:20
17460290,2183863,81218770,55,Should we make it separate class or a nested class?,521296561,2016-09-30 02:44:24
17460290,73683,81225691,55,"I could go either way on this. I made it an inner class since it's tightly couple to, and only intended for, `NetworkUtils` but if we think it should stand on it's own I'm ok with it.",521296561,2016-09-30 03:21:59
17495940,73683,81279641,31,can we iterate over the keySet() here instead? The naming helps it tend to be more descriptive than using entry.getKey() and entry.getValue().,521592969,2016-09-30 12:19:34
17499218,6334077,91672356,65,"Hi, @billonahill . I'm reading this part of code. I was wondering if we could use `Preconditions.checkArgument` or `Preconditions.checkState` provided by Google guava instead of assertTrue method?  ",525702419,2016-12-09 15:59:59
17514173,73683,81398241,68,please rename 's' to something like configKey or something descriprive,522157866,2016-10-01 01:57:19
17514173,73683,81612169,93,"If either of these assertions fails, the reason won't be clear to the reader of the logs. Would you please add a string reason for the failure (e.g., an unexpected config found) and output the map/set.",523876205,2016-10-04 01:36:49
17514173,73683,81612413,64,Can these key values be static strings referenced from somewhere?,523876205,2016-10-04 01:37:59
17514173,73683,81612541,74,please use a more descriptive field name than `s`.,523876205,2016-10-04 01:38:39
17514173,73683,81613106,86,"There are enough Map, Set, Config, Builder objects all referring to different expected/found/reef values that reading the test can get tricky to a reader without details of the config code implementation. Would you please add a few comments along the way ",523876205,2016-10-04 01:41:24
17514173,6377806,81642418,68,Fixed,522157866,2016-10-04 04:19:33
17514173,6377806,81642457,93,Fixed,523876205,2016-10-04 04:19:45
17514173,6377806,81642508,86,Fixed,523876205,2016-10-04 04:20:05
17514173,6377806,81642466,64,Fixed,523876205,2016-10-04 04:19:52
17514173,6377806,81642481,74,Fixed,523876205,2016-10-04 04:19:57
17588757,13159450,81605804,5,why change 6 to 7 here?,525128276,2016-10-04 01:04:40
17588757,73683,81606627,5,"This tests the state managers `initTree` method, which creates all `StateLocation`s and we've added a new one with `/locks`.

https://github.com/twitter/heron/blob/master/heron/statemgrs/src/java/com/twitter/heron/statemgr/FileSystemStateManager.java#L4",525128276,2016-10-04 01:08:59
17588757,3201045,81689006,33,"for local file system, there is a file system call that you can use open system call with OCREAT - that automatically creates if a local file does not exist or fails if the file exists. It might be better solution, I think",525128276,2016-10-04 12:22:24
17588757,73683,81689592,33,"The main use case for locking is the distributed one, where multiple users are trying to make concurrent changes. Since the local file system is only used for compatibility during development by an individual user, do you think it's worth it to invest in ",525128276,2016-10-04 12:30:34
17588757,73683,81836003,33,"I've updated the file creation to be atomic. The `Files` API supports this:
http://docs.oracle.com/javase/8/docs/api/java/nio/file/StandardOpenOption.html#CREATE_NEW",525128276,2016-10-05 02:36:42
17603540,6377806,81866279,3,"The YARN scheduler does not need to upload heron core, A use case for a `no-op` uploader. Replacing it with this uploader will result in unnecessary copies of the binaries. Will it be ok to let the `NullUploader` exist?",525216992,2016-10-05 05:18:17
17603540,73683,81868477,3,"I changed this because all other uploaders use the local fs uploader, which just moves it to another directory, so I thought that made sense for yarn as well. Is the yarn workflow different than all the others with respect to it's uploader needs?
```
$ ",525216992,2016-10-05 05:33:23
17603540,3201045,81901971,3,"which means it will copy to another directory - which incurs overhead and also a configuration of directory where the file needs to be moved as well. Probably, it might be a good idea to have NullUploader.",525216992,2016-10-05 12:18:51
17603540,6377806,82009969,3,"@billonahill Yes, the YARN scheduler skips the uploader step. The heron binaries are added to **classpath** by the launcher in this case.",525216992,2016-10-05 23:08:32
17603540,73683,82014671,3,"I've changed back to `NullUploader` for now, but the proper fix is really to change the yarn impl (or the shared classes it relies on) to not invoke an uploader at all. This is a cleaner approach than calling a class written to do nothing.",525216992,2016-10-05 23:32:06
17612627,73683,82072932,55,"sinceThreadName? it's not the thread id, it's the name.",525272920,2016-10-06 04:18:32
17612627,73683,82072791,51,"Instead of logging the exception separately above, can we have an if/then with a different log message in each. That way it's clear what's causing what.",525272920,2016-10-06 04:17:45
17612627,2183863,82095290,55,"In current implementation, we enforce the thread-name the same as sink-id. Do you think we need to add an extra map to record it?",525272920,2016-10-06 06:55:00
17612627,2183863,82098577,51,Sorry but I don't understand. This implementation logs exception at the start once; and then followings are handling logic with a different if/then ... Those are not causes but handling logics?,525272920,2016-10-06 07:29:01
17612627,73683,82247858,51,"My suggestion was instead of doing this:
```
- log all the details of the exception
if it's the main thread
  - log that we have to die (due to the previously logged exception)
```

to the log reader it will be more clear if we consolidate those tw",525272920,2016-10-07 01:02:22
17612627,2183863,82248723,51,Sounds good. Will do that.,525272920,2016-10-07 01:06:41
17612627,73683,82248637,55,"I wasn't suggesting an extra map, just consistency in variable naming. Above we assign `getId()` to a variable named `mainThreadId`:
```
mainThreadId = Thread.currentThread().getId();
```
bit here we assign `getName()` to a variable named `sinkId` (in",525272920,2016-10-07 01:06:16
17612627,2183863,82295427,55,"Added comments in the source code to avoid confusion. sinkId is more representative, since it is defined inside the metrics_sink.yaml",525272920,2016-10-07 05:02:34
17622807,73683,82300793,23,pls remove.,525349259,2016-10-07 05:41:51
17622807,73683,82302455,80,"let's camelCase consistently with elsewhere (e.g., `getScaleUpResource`) by using `scaleUpResource` and `scaleUpResource` here and elsewhere in this patch.",525349259,2016-10-07 05:55:58
17622807,73683,82302707,83,"better to use `Math.max(0, cpuDifference)` here and elsewhere",525349259,2016-10-07 05:57:56
17622807,73683,82303593,97,"This could also be a method on `Resource`:
```
Resource divideBy(Resource other);
```",525349259,2016-10-07 06:05:38
17622807,73683,82304303,110,"Typically we want to iterate directly on the keySet here, which is an `Iterable<Integer>`. There first 3 lines can be replaced with:
```
for (Integer containerId : allocation.keySet()) {
```",525349259,2016-10-07 06:11:25
17622807,73683,82305701,102,What does `this.containerId` represent and why is it 1 when starting a repack?,525349259,2016-10-07 06:23:37
17622807,73683,82306321,113,"can you explain in comments what's happening here? it seems like we just keep calling `getResourceCompliantRRAllocation` until it returns something, but nothing changes in the values we pass to it so it's unclear why we should expect a different result ea",525349259,2016-10-07 06:28:48
17622807,73683,82308926,54,"There's a lot of duplicate logic in `getScale[Up|Down]Resource` and `getComponentsToScale[Up|Down]` that could be replaced by refactoring into generic methods that take an enum that represents whether we're scaling up or down:
```
  enum ScalingDirectio",525349259,2016-10-07 06:53:19
17622807,73683,82309476,281,better to represent PolicyType as an enum with a method that encapsulated this logic.,525349259,2016-10-07 06:58:06
17622807,73683,82312085,55,"can we `switch` on componentName and have an explicit case for ""bolt"" and ""spout"" and fail on default?",525349259,2016-10-07 07:26:12
17622807,73683,82303262,76,"Seems like this could be a method on Resource itself?

```
Resource subtract(Resource other);
```",525349259,2016-10-07 06:02:43
17622807,73683,82306101,105,instead manually resetting values and then calling `increaseNumContainers(newValue)` could we just call a `resetNumContainers(newValue)` method?,525349259,2016-10-07 06:26:37
17622807,16405288,82657518,76,@billonahill This is not a proper subtract. It nevers returns a negative value. It is optimized for the packing algo context and should not be used in other settings,525349259,2016-10-11 01:25:01
17622807,16405288,82657556,97,@billonahill same as before,525349259,2016-10-11 01:25:13
17622807,73683,82699113,76,We could change the name to imply the operation (e.g. `subtractAbsolute`?) or just document that subtract will never go negative. Since it's a mathematical operation between two `Resource` items it seems fitting to have this as a method on `Resource` IMO.,525349259,2016-10-11 06:05:37
17622807,73683,82699231,97,@avflor see my other comment re mathematical operations on the object that does them and OO vs helpers.,525349259,2016-10-11 06:06:40
17622807,73683,82700098,105,"`increaseNumContainers` takes a delta to increase by not an absolute, so I was proposing two methods:
```
increaseNumContainers(delta)
resetNumContainers(absolute)
```
it's just about being consistent with our use of encapsulation. When we want to ad",525349259,2016-10-11 06:14:40
17622807,73683,82700780,110,"```
for (Integer containerId : allocation.keySet()) {
  if (allocation.get(containerId).isEmpty()) {
    allocation.remove(containerId);
  }
}
```",525349259,2016-10-11 06:20:48
17622807,16405288,82706863,105,"@billonahill In the algo I only need the increaseNumContainers method. There is no place in the code that does a reset. Even if I had to use reset, I would still compute the additionalContainers and then add them to the current containers size and then in",525349259,2016-10-11 07:27:38
17622807,73683,82728423,110,"Ugh, that's right, we need to use the iterator.",525349259,2016-10-11 12:58:50
17622807,73683,82729000,105,"Sorry, I missed that `increaseNumContainers` doesn't change `numAdjustments` and `containerId`, only `numContainers` so I was confusing things by lumping that method in with the reset I was suggesting. I'm suggesting a method that resets the following, wh",525349259,2016-10-11 13:06:31
17622807,73683,82888614,442,"For consistency please use capital snakcase for enum values: `STRICT, FLEXIBLE`",531072005,2016-10-12 04:04:35
17622807,16405288,82657672,110,@billonahill Not sure how I can delete an entry of the map without an iterator. Can you please explain?,525349259,2016-10-11 01:25:44
17622807,16405288,82657807,105,@billonahill I'm not sure I understand. Both reset and increase take the newValue as input. What is the difference?,525349259,2016-10-11 01:26:30
17622807,16405288,82706328,110,"@billonahill This gives a concurrentModificationException:
at java.util.HashMap$HashIterator.nextNode(HashMap.java:1429)
	at java.util.HashMap$KeyIterator.next(HashMap.java:1453)
	at com.twitter.heron.packing.PackingUtils.removeEmptyContainers(PackingU",525349259,2016-10-11 07:21:47
17673605,73683,82246176,16,please Log.SEVERE instead of printing to stdout.,525720610,2016-10-07 00:54:56
17673605,73683,82437983,16,"since we're logging this and moving on without throwing, we should change this to Level.WARN actually.",525720611,2016-10-08 00:53:00
17673605,1989169,82492556,16,"> since we're logging this and moving on without throwing, we should change this to Level.WARN actually.

Fixed.",525720611,2016-10-08 08:44:19
17701736,73683,82434260,20,"This pattern is repeated in this class. Could we create a methods like this in this class to simplify this:
```
public static int getValue(Map<String, Object> config, String key, Integer default);
```
might be better to do in another pr.",525962802,2016-10-08 00:33:02
17701736,73683,82435609,7,This name on it's own doesn't clearly convey it's meaning. Can we change it to convey that it's the max exceptions in a protobuf? Something like `heron.metrics.max.exceptions.per.message.count` or something else more clear.,525962802,2016-10-08 00:40:29
17701736,73683,82436083,45,"What's the scope of this counter? Does this mean that no more exceptions will ever be published, or just for this payload? Same for `droppedExceptionsCount`. Is that count per message payload, count since the jvm started, or what?",525962802,2016-10-08 00:42:50
17701736,2183863,82467611,45,"Both this counter and `droppedExceptionsCount ` are per message payload. 

Every time we collect the metrics, we would invoke IMetric.getAndReset(), send the message out and these two counter will reset to 0.",525962802,2016-10-08 03:51:04
17701736,2183863,82468606,20,will do it in another pr,525962802,2016-10-08 03:58:00
17701736,2183863,82467634,7,sounds good. Will do it.,525962802,2016-10-08 03:51:14
17702891,73683,82438776,13,Ideally try blocks should be as small as possible and this one is pretty large. Could you move the logic inside the block into a private method and just delegate to that inside the try?,525973641,2016-10-08 00:57:48
17702891,2183863,82463125,13,sounds good. Will do it.,525973641,2016-10-08 03:20:04
17922776,73683,83495099,173,"stat seems like a good approach, provided it works on all distros.

There's no need to do all chmods in one concatenated command, so better to break it up to make the code more readable. No need to build up arrays and concated strings, we can just do th",534167046,2016-10-15 03:26:38
17922776,1215813,83495322,173,"Works for me, I'll make that change. Stat appears to work on everything major, but I'll do some additional digging and testing on some VMs to be sure.",534167046,2016-10-15 03:27:46
17922776,73683,83495824,124,elsewhere inthe code we use `--shard` instead. What's the difference in usage when using `shard`?,534167046,2016-10-15 03:30:48
17922776,73683,83497008,68,can args.component_rammap do this and just return a map?,534167046,2016-10-15 03:38:31
17922776,73683,83703846,160,Log.error,536234851,2016-10-18 01:26:14
17922776,13159450,83705612,68,I don't understand this comment. Can you explain?,534167046,2016-10-18 01:35:09
17922776,73683,83706660,68,"I was wondering if this logic could be encapsulated into the argparse logic via custom actions. I'm not certain it could, and maybe it's not worth the effort, so feel free to disregard.",534167046,2016-10-18 01:40:28
17922776,13159450,83707030,160,"since we didn't write any help message for any argument, it doesn't really matter if we'll print help message here...",536240363,2016-10-18 01:42:28
17922776,1215813,83707433,160,"In that case argparse is supposed to dump the list of required arguments: https://docs.python.org/3/library/argparse.html#usage

It's probably not the best possible help message and we should likely take some time at some point to document the individua",536240363,2016-10-18 01:44:31
17922776,13159450,83707636,160,Thanks for pointing out. Agreed.,536240363,2016-10-18 01:45:32
17922776,73683,83495997,42,let's make this an int type in argparse and remove the cast,534167046,2016-10-15 03:31:54
17922776,13159450,83687387,156,"Since you removed [this part](https://github.com/twitter/heron/pull/1493/files#diff-2a669e084143b86b5766a49245f8e357L650), can you use `parse_known_args` as in [heron/tools/explorer/src/python/main.py#L172](https://github.com/twitter/heron/blob/12425366a9",536234851,2016-10-17 23:58:28
17922776,13159450,83707957,68,"Agree. If @dmarchand thinks it's worth the effort, feel free to refer to https://docs.python.org/dev/library/argparse.html#action",534167046,2016-10-18 01:46:59
17931951,5113813,83748564,5,Fixed in PR [#1498](https://github.com/twitter/heron/pull/1498),534691292,2016-10-18 05:31:30
17997233,73683,83754428,6,let's remove the newline from the exception message. This complicates log parsing when grepping or using loglens.,536461051,2016-10-18 06:14:06
18015813,3201045,84003127,24,it should be Received a terminal or Received terminals,537871780,2016-10-19 13:18:10
18015813,3201045,84003393,5,why the change from 15 to 25?,537871780,2016-10-19 13:21:23
18015813,73683,84004335,5,"When there are legit failures retrying 25 times is excessive and it takes over 4 minutes of results checking per test. Even 15 times seems high. If we have to retry anything this many times for simple, small test topologies, something is wrong.

That sa",537871780,2016-10-19 13:31:52
18015813,3201045,84004466,5,"Most of the times the integration tests not flaky, I believe.",537871780,2016-10-19 13:33:28
18015813,73683,84006783,5,That's what I thought. Let's reduce it and see if it causes problems.,537871780,2016-10-19 13:57:20
18104957,13159450,84542303,22,complicated to explain but in short --- because it is built with [`zip_safe=False`](https://github.com/twitter/heron/blob/master/heron/tools/ui/src/python/BUILD#L32),539030112,2016-10-22 03:51:40
18104957,13159450,84545901,22,"I am thinking any tool in the future that uses `zip_safe=False` can reuse this method, and naming this method in this way then makes sense.",539030112,2016-10-22 04:15:24
18104957,13159450,84546282,37,"actually, i realized `heron-explorer` was moved to the same directory as `heron`. This means this method is no longer needed.",539030112,2016-10-22 04:17:55
18104957,73683,84552582,22,"If the method is in fact general purpose and could be used by anyone that uses zip_save=False, then we don't need to say ""Specifically designed for heron-ui"" and ""return: root location for heron-ui."" How heron-ui sets zip_save doesn't need to influence ho",539030112,2016-10-22 05:07:58
18104957,13159450,84552673,22,right. will remove it,539030112,2016-10-22 05:08:46
18104957,73683,84552727,49,"if we still need go_above_dirs in this method and/or in get_heron_dir, we should document the value.",539789260,2016-10-22 05:09:14
18104957,13159450,84553165,49,I briefly mentioned it [here](https://github.com/twitter/heron/pull/1507/files/e72fe571568deba0aed16582d8367e10a48b4e2e#diff-c8ec498d0b564ed129baec8a64dceb09R159) and I am not sure how to have a better wording here.,539789260,2016-10-22 05:13:10
18104957,13159450,84553233,22,removed via https://github.com/twitter/heron/pull/1507/commits/e72fe571568deba0aed16582d8367e10a48b4e2e,539030112,2016-10-22 05:13:44
18104957,73683,84524371,22,"if this is only intended for heron-ui could the method live in heron-ui somewhere instead of in a shared util? Or if it needs to live here, we should put something related to heron-ui in the method name to be explicit. Actually, why is this method only to",539030112,2016-10-22 01:29:47
18104957,73683,84524448,37,wherever we specify go_above_dirs could you add a comment showing the dirs that we need to back out of?,539030112,2016-10-22 01:30:29
18193152,3201045,84812391,4,@billonahill - this might not work since there is no target defined in this file?,541698562,2016-10-25 07:39:06
18193152,3201045,84813029,27,Instead of calling it UpdatableComponent should we call it IUpdatable to keep interface names consistent.,541698562,2016-10-25 07:46:03
18193152,3201045,84813336,16,Wondering if there is more code to be added here?,541698562,2016-10-25 07:49:11
18193152,73683,84817155,4,This target is defined in this file.,541698562,2016-10-25 08:35:23
18193152,3201045,84817308,16,ok,541698562,2016-10-25 08:37:21
18193152,73683,84817480,27,Renamed.,541698562,2016-10-25 08:39:23
18193152,3201045,84817396,4,my bad - i did not realize it is at end,541698562,2016-10-25 08:38:16
18193152,6377806,84825520,14,We invoke user code here which could fail/block. What is the expectation in such cases? I think the `executor` will log the error and launch a new instance if an error occurs? ,541737734,2016-10-25 10:27:09
18193152,3201045,84825803,14,Good point - this needs to be addressed. If the function execution exceeds beyond a certain time - some action needs to be taken.,541737734,2016-10-25 10:31:35
18193152,73683,84835012,14,"This is something we should look into separately. The same is true for all other calls to `bolt` in this class (e.g.,  `bolt.prepare(..)`,  `bolt.cleanup(..)`,  `bolt.execute(..)`). None have exception handling or timeouts.",541737734,2016-10-25 12:55:10
18193152,73683,84817215,16,"Yes, there is. See my comment above on this ticket. The code I need to call will exist once #1516 is merged.",541698562,2016-10-25 08:36:07
18208073,1989169,84844901,12,"This old test actually didn't test the behavior. `sleep 1 && echo ...` will be split to `sleep`, `1`, `&&`, `echo`, `...`, and the code will launch the process `sleep` with the other strings as its argument. Then `sleep` will fail at once. Since `redirect",541883886,2016-10-25 14:36:22
18280959,16405288,85451772,41,It's a bit confusing that both the builder and the individual algorithms track the number of containers. Would it be easier to use it in one place only?,543357889,2016-10-28 06:57:49
18280959,16405288,85453531,172,"If get resource compliant allocation fails with an exception, then the packingbuilder will still have the updaed number of containers? Shouldn't we bring it back to the old value in the catch clause? It might not make a difference eventually since we upda",543357889,2016-10-28 07:15:44
18280959,16405288,85454810,78,I think it looks better if we allocate/deallocate  containers when the user invokes the updateNumContainers command and not leave it to addInstance which invokes init. ,543357889,2016-10-28 07:31:26
18280959,73683,85566830,78,"I haven't yet documented this, but the design intent (which we can enforce) is that the builder is used as follows:

1. Call the setters to set required settings (e.g., resource settings)
2. Set the container size
3. Add/remove instances
  3a. If mor",543357889,2016-10-28 23:41:28
18280959,73683,85567890,172,I think you're describing a scenario where a container is added and we then catch a `ResourceExceedException` and nothing has been added so we have an empty container. [We dont't have a check for that case and we should but] What currently happens is that,543357889,2016-10-28 23:47:48
18280959,16405288,85592753,78,"I'm a little confused here. The command to add a container is the following: PackingUtils.allocateNewContainer(containers, containers.get(0).getCapacity(), this.requestedContainerPadding) when someone adds a new container. Why can't we do this in the upda",543357889,2016-10-29 02:09:48
18280959,16405288,85593032,172,Ok makes sense.,543357889,2016-10-29 02:11:46
18280959,73683,85623223,78,We can't allocate containers in the `updateNumContainers` because `setRequestedContainerPadding` might not have been called yet and we need the container padding. Hence we call 'initContainers' before each add/remove and we get our internal data structure,543357889,2016-10-29 06:01:40
18280959,73683,85565148,41,The design philosophy is that the algorithm author decides the total number of containers and places the instances into the containers of it's choosing. The builder managers the data structures and the resource allocation checks. As a result the algo need,543357889,2016-10-28 23:30:45
18313892,6377806,86203771,371,"Yes, it could be inside. Just to be sure, did you observe any functional issues with it other than code readability?",544025949,2016-11-03 00:53:49
18313892,3201045,85614756,108,Does this assume that all the containers are homogeneous?,544025949,2016-10-29 04:38:44
18313892,6334077,85654084,371,"I was wondering if the declare statement of `result` variable could be in the `synchronized  block`, or it might be 
```
Optional<HeronWorker>  result = findLargestFittingWorker(evaluator, workersAwaitingAllocation, true);
``` ",544025949,2016-10-30 13:50:07
18313892,6377806,86383196,108,"No, the YARN scheduler continues to work with heterogeneous container sizes. YARN does not have a notion of request id in the allocated container. This method ensures that the allocated container is utilized properly by finding the biggest heron Container",544025949,2016-11-03 23:20:13
18342822,13159450,86607462,136,"Can we return `False` and `True`, instead of strings...?",548615811,2016-11-05 01:33:48
18342822,13159450,86656823,136,ok,548615811,2016-11-05 09:59:08
18342822,73683,86648814,136,"Yeah, it's painful that these strings are being returned here and we should fix that. I'd like to contain the scope of changes in this PR though, and change all the true/falses in a PR of it's own.",548615811,2016-11-05 06:25:50
18449528,3201045,86040829,5,Would be nice if you could add some comments?,547061639,2016-11-02 05:40:15
18449528,73683,86041661,5,I'd make the argument that checking for null before closing a resource if fairly common practice and not in need of an explanation.,547061639,2016-11-02 05:46:32
18449528,3201045,86041952,5,Fine with me. I was thinking since it was exposing some corner conditions - it might be worthwhile. Leave it to you.,547061639,2016-11-02 05:48:39
18663262,114449,87107781,27,Use ::pipe().,552364786,2016-11-09 07:29:34
18663262,114449,87107892,36,"No need to check the value, we only have one reader and one writer.",552364786,2016-11-09 07:30:27
18663262,13159450,87108445,27,resolved via https://github.com/twitter/heron/pull/1541/commits/0238865309396146ecb897aac5eec9260b7015d8,552364786,2016-11-09 07:34:52
18663262,13159450,87108594,36,resolved via https://github.com/twitter/heron/pull/1541/commits/593f35ad033a133938057f381844285804be373a,552364786,2016-11-09 07:36:09
18663262,114449,87110202,13,'sent' is no longer needed either.,552374267,2016-11-09 07:48:29
18663262,13159450,87111383,13,resolved via https://github.com/twitter/heron/pull/1541/commits/dc185672ac8d8b9bd773ecf9246c4a32ef6a3bc0,552374267,2016-11-09 07:58:14
18692365,13159450,87326105,61,duplicate ``except ... as e``?,553161054,2016-11-10 12:10:18
18692365,13159450,87326255,65,how about using ``try .. except .. finally`` clause? https://docs.python.org/2.7/tutorial/errors.html#defining-clean-up-actions,553161054,2016-11-10 12:12:24
18692365,73683,87434120,61,That's ok since `e` is scoped within each except clause so only 1 will be defined without collision.,553161054,2016-11-11 00:42:26
18692365,73683,87434386,65,"Yes, good call.",553161054,2016-11-11 00:43:37
18721953,73683,87473678,58,"So you can run a single test like this:
```
./bazel-bin/integration-test/src/python/local_test_runner/local-test-runner \
  test_template.TestTemplate
```
instead of like this:
```
./bazel-bin/integration-test/src/python/local_test_runner/local-tes",553738307,2016-11-11 03:58:46
18721953,13159450,87471701,58,"""for convenience"" of what? i don't quite follow here...",553738307,2016-11-11 03:48:09
18721953,13159450,87478417,58,???? ,553738307,2016-11-11 04:25:45
18857370,73683,88076218,1,Could we link to the site at httpp://heronstreaming.io/docs/contributors/community/ or  http://twitter.github.io/heron/docs/contributors/community/ or would that not work?,556821017,2016-11-16 02:04:35
18857370,13159450,88078069,1,I created a symlink called `CONTRIBUTING.md` at root directory pointing to [website/content/docs/contributors/community.md](https://github.com/twitter/heron/blob/master/website/content/docs/contributors/community.md). I don't know why GitHub diff displays,556821017,2016-11-16 02:13:52
18857370,13159450,88078227,1,we cannot link to site. We have to put a `CONTRIBUTING.md` (symlink fine) under root.,556821017,2016-11-16 02:14:39
18943590,73683,88948026,55,Can we make submitTopology return void and let this exception be thrown higher?,559065069,2016-11-22 01:41:37
18943590,73683,88948729,54,"We no longer raise an exception when the status code != 0, but do we still need to be concerned with python code below execute.heron_class raising an exception due to any other a bug/error condition? Or maybe we just don't need to explicitly catch and han",559065069,2016-11-22 01:45:24
18943590,73683,88948274,74,"We should include the topology name in the message as well:

Topology foo already exists.",559065069,2016-11-22 01:42:56
18943590,73683,88949112,6,instead of escaping single quotes it's more readable to use double quotes for the python string so you don't need to escape.,559065069,2016-11-22 01:47:21
18943590,13159450,89007132,53,Agree. Will do!,560967262,2016-11-22 06:48:11
18943590,73683,89007782,16,"This pattern of logging to stdout and then throwing RuntimeException looks odd to the reader so best to clarify why we do both in a comment.

I suspect we'll want to do similar in other places, like RuntimeManagerMain, so at some point we'll want this l",560967262,2016-11-22 06:51:59
18943590,13159450,89020851,16,"what do you mean by ""this logic""? And I agree we can have a super-class of those exceptions.",560967262,2016-11-22 08:31:11
18943590,13159450,89021755,54,just let exception be thrown out since it won't be part of the expected workflow.,559065069,2016-11-22 08:39:03
18943590,73683,89024961,16,"If at the highest level we always want to log errors to stdout and throw a runtime exception, we should make a helper that does both of those. I know it's only two lines, but this will centralize the expected handling into a single place which will make r",560967262,2016-11-22 09:08:01
18943590,13159450,90488522,25,forgot this! will do,568538473,2016-12-02 00:51:34
18943590,73683,90488627,92,"please include the packageURI in the exception message.

also in a follow up PR we should create UploaderException instead of returning null.",568538473,2016-12-02 00:52:05
18943590,13159450,90488916,92,forgot to refactor this part. UploaderException is already created.,568538473,2016-12-02 00:53:33
18943590,73683,90488957,109,can we eliminate isSuccessful and just do this in the catch block?,568538473,2016-12-02 00:53:48
18943590,73683,90489290,92,"Actually looks like you already throw UploaderException below, so we should be able to remove the null handling.",568538473,2016-12-02 00:55:25
18943590,73683,90490095,76,This test is odd. We mock the object to throw an exception and then assert that the exception is thrown. Why? It seems to not be testing the actual exception throwing logic of the class.,568538473,2016-12-02 00:59:10
18943590,73683,90490854,7,why suppress the connection string? Could it have a password in it?,568538473,2016-12-02 01:02:41
18943590,73683,90491359,6,best to not include line breaks in log messages,568538473,2016-12-02 01:05:07
18943590,73683,90491717,17,can you also include this stderr if the response code  != 0.,568538473,2016-12-02 01:06:57
18943590,13159450,90491846,7,No. And I checked this part of the code. Whether we can connect to the tunnel is independent from `connectionString`.  We will [use `connectionString`](https://github.com/twitter/heron/pull/1571/files/c43c5c613fe450874a130944a3509233e67f1ca3#diff-485c69d3,568538473,2016-12-02 01:07:39
18943590,73683,90491936,43,above you refactored out the '$> ' log syntax for something more descriptive. we should do the same here too.,568538473,2016-12-02 01:08:05
18943590,73683,90492404,20,"instead of logging error messages and returning the return code, could we return some sort of response object that includes he return code and the message?",568538473,2016-12-02 01:10:45
18943590,13159450,90493135,20,"a tuple of format `(return_code, stdout, stderr)` is fine. But I feel `execute` is the module that actually executes the Java command, and get the return code, stdout, and stderr from it. It makes more sense to *also* dumps out the message and stop there.",568538473,2016-12-02 01:14:40
18943590,73683,90493530,19,"more context here:

""Expected topology package file to be uploaded %s does not exist""",568538473,2016-12-02 01:16:31
18943590,73683,90493739,29,"more context for the user here (i.e., why are we trying to create this directory?)",568538473,2016-12-02 01:17:34
18943590,73683,90494004,45,"Maybe in a follow-up, but copyFromLocalFile should throw an exception with meaningful info about why the upload failed which we can wrap with this exception.",568538473,2016-12-02 01:18:54
18943590,73683,90494483,41,"Don't cast the caught exception down to a string, wrap it with UploaderException. Also include the dest location:
```
throw new UploaderException(
  String.format(""Unable to copy file %s to %s"", source.toString(), filePath),
  ex);
```",568538473,2016-12-02 01:21:24
18943590,73683,90494691,24,include AmazonClientException in UploaderException,568538473,2016-12-02 01:22:28
18943590,73683,90488098,53,"always better to attach the actual exception than to include it's message in the string.
```
throw new TopologySubmissionException(""some message"", e);
```
that gives the catcher more control to decide how to render it.",568538473,2016-12-02 00:49:45
18943590,73683,90488312,25,"it looks odd to catch Excetption, log only the message to standard our, and than throw a RuntimeException. Please add comments explaining why we're doing this.",568538473,2016-12-02 00:50:38
18943590,73683,90496204,7,"For all of these exception messages, assume they get caught at the highest level, up in the python main and rendered to the user without any of the surrounding context that we have when reading the code.

Do they contain enough context to help the user ",568538473,2016-12-02 01:30:28
18943590,73683,90496551,20,"Why not send all of this back to main.py and let it render stdout/err based on the response code?

Either way, we shouldn't have to do this pattern in execute.py AND in all the command impls. It should be done in one place ideally.",568538473,2016-12-02 01:32:18
18943590,13159450,90493569,71,"1. `main.py` will not output any extra thing after the module it calls finishes executing. This makes sure the message other modules print out will be the last message. 

2. As for ""logging consistency"", can you explain a bit more? ",568538473,2016-12-02 01:16:42
18943590,73683,90506972,71,"2. Current design requires each command do this at the end:
```
if retcode != 0:
   Log.error('Failed to update topology \'%s\'', topology_name)
   return False
```

So we only have a consistent solution if every command implement cargo-cults just ",568538473,2016-12-02 02:27:27
18943590,73683,90699431,76,"Regarding ""I am testing if the exception will be thrown out,"" the exception will always be throw because you added this to your unit test:
```
doThrow(new TopologySubmissionException(
        String.format(""Topology %s already exist"", topology.getName(",568538473,2016-12-03 02:59:01
18943590,13159450,90699869,76,oh I see...,568538473,2016-12-03 03:01:13
18943590,13159450,90709077,20,"I'm not sure how to send all this **all the way back** to `main.py`. Looking at [`run` in `submit.py`](https://github.com/twitter/heron/blob/master/heron/tools/cli/src/python/submit.py#L271), we expect this `run` function to return a boolean value.",568538473,2016-12-03 03:55:51
18943590,13159450,90709993,20,"I see. Seems related to https://github.com/twitter/heron/pull/1571#discussion_r90493084. I'll think about how to design ""a response object"".",568538473,2016-12-03 04:01:17
18943590,13159450,90713202,17,discussed internally and will only include stderr if ``retcode != 0 && retcode < 100``,568538473,2016-12-03 04:21:49
18943590,13159450,90694248,76,"I am testing if the exception will be thrown out. If no exception is thrown out, the control flow reaches `fail`, which will fail the test.

And this `SubmitterMainTest` shows the problem I mentioned days ago. Inside the function `testSubmitTopology`, w",568538473,2016-12-03 02:30:25
18943590,13159450,90807088,45,agree. and this is important for https://github.com/twitter/heron/issues/1462#issuecomment-258550269,568538473,2016-12-05 13:53:09
18943590,73683,91193233,81,can we return void?,571890381,2016-12-07 07:05:33
18943590,73683,91194400,14,"Typically Exceptions are part of the API/model objects, not utils. Best to put this in c.t.h.spi.scheduler.",571890381,2016-12-07 07:13:31
18943590,13159450,91194796,81,that means we need to change to `Callable<Void>` [here](https://github.com/twitter/heron/pull/1571/files/39d58c0e1423bd86d4cd29f968f2804412f75e3f#diff-bc651b82b5edf290148aedd84d4b8633R37). And we have to return a `null` at the very end.,571890381,2016-12-07 07:16:05
18943590,73683,91194961,34,"We should also log.fine the entire exception, so we get the stack trace",571890381,2016-12-07 07:17:12
18943590,73683,91195313,36,"We might want to prefix the message with something like this, incase you're catching an error that doesn't have a nice message.
```
""Topology {0} submitted successfully"", topology.getName()
```",571890381,2016-12-07 07:19:31
18943590,73683,91195786,74,"e.getMessage() is included in the exception chain when you chain the message, so you would typically not re-included it in a custom message here. Better to replace e.getMessage() with uploaderClass actually.",571890381,2016-12-07 07:22:22
18943590,73683,91196153,18,fix javadocs,571890381,2016-12-07 07:24:37
18943590,73683,91196044,129,this catch and throw could be removed,571890381,2016-12-07 07:23:48
18943590,73683,91197019,24,pls include packingClass in the message,571890381,2016-12-07 07:30:35
18943590,73683,91197580,80,better to return the ex and not stringify it. Leave that to the caller to decide.,571890381,2016-12-07 07:34:36
18943590,73683,91196930,19,No. Let's leave specific metadata out of this exception until we identify a valid need,568538473,2016-12-07 07:30:01
18943590,73683,91197337,57,Better to encapsulate this into a response class than to return tuples. It would take an int response code and an optional error message and error object.,571890381,2016-12-07 07:32:57
18943590,73683,91198539,48,"NonUserError and UserError feels a bit misleading. Could we call it something like HeronError for errors in the heron classes, or maybe JavaMainError? For < 100 that could be InvokationError maybe?",571890381,2016-12-07 07:41:51
18943590,73683,91198024,26,"Could we simplify this to be:
```
__init__(self, status, message=None, detailed_message=None):
```",571890381,2016-12-07 07:37:41
18943590,13159450,91198724,48,"Yes, I am not satisfied with these two names. `HeronError` and `InvokationError` are fine (note that we have Python topology so `JavaMainError` is not a good name...)",571890381,2016-12-07 07:43:24
18943590,73683,91198990,26,We should include the directory in the message,571890381,2016-12-07 07:45:42
18943590,13159450,91198851,55,it subclasses `Response` to have `defn_file` in its constructor,571890381,2016-12-07 07:44:35
18943590,73683,91199068,29,should include the dir name,571890381,2016-12-07 07:46:23
18943590,73683,91198664,55,Why do we need these subtypes? Would Response not suffice on it's own?,571890381,2016-12-07 07:42:53
18943590,73683,91199159,63,toString not necessary,571890381,2016-12-07 07:46:58
18943590,13159450,91013838,41,resolved in #1593,568538473,2016-12-06 13:22:17
18943590,13159450,91013806,45,still TODO.,568538473,2016-12-06 13:21:48
18943590,13159450,91014576,71,"This was not addressed in https://github.com/twitter/heron/pull/1593. Here is the [`submit.py`](https://github.com/twitter/heron/blob/5b53ffc97afee4b6efca0598d37b2f280d01615b/heron/tools/cli/src/python/submit.py#L256) in #1593. Basically, `main.py` calls ",568538473,2016-12-06 13:32:23
18943590,13159450,91014767,25,resolved in #1593,568538473,2016-12-06 13:35:33
18943590,13159450,91014774,92,resolved in #1593,568538473,2016-12-06 13:35:39
18943590,13159450,91015047,158,"This is fixed. I refactored down to [`LaunchRunner.java`](https://github.com/twitter/heron/pull/1593/files#diff-bc651b82b5edf290148aedd84d4b8633) in #1593. However, notice that I did not not go even deeper down to `setPackingPlan`, `setExecutionState`, et",568538473,2016-12-06 13:39:32
18943590,13159450,91015136,76,these tests are fixed in #1593. See: [`SubmitterMainTest.java`](https://github.com/twitter/heron/pull/1593/files#diff-9d7c5b93dadaa33d2766bdfdad746d08),568538473,2016-12-06 13:40:47
18943590,13159450,91015544,7,"> For all of these exception messages, assume they get caught at the highest level, up in the python main and rendered to the user without any of the surrounding context that we have when reading the code.

very good suggestion! I followed this suggesti",568538473,2016-12-06 13:46:59
18943590,13159450,91015403,19,"I did not and put URI info inside of the exception message (For example, see [`Hdfsuploader.java`](https://github.com/twitter/heron/pull/1593/files#diff-16dc2d858f9b42f2253a00e91a84bff0R96)). Any argument why catcher needs to access name?",568538473,2016-12-06 13:44:49
18943590,13159450,91015787,20,resolved in #1593. See [`response.py`](https://github.com/twitter/heron/pull/1593/files#diff-a90956032bc120bbfaad04664668a46a),568538473,2016-12-06 13:50:40
18943590,13159450,91015562,6,resolved in #1593 ,568538473,2016-12-06 13:47:12
18943590,13159450,91015590,19,resolved in #1593. See [`response.py`](https://github.com/twitter/heron/pull/1593/files#diff-a90956032bc120bbfaad04664668a46aR30) and [`SubmitterMain.java`](https://github.com/twitter/heron/pull/1593/files#diff-1043de1ec8f8e4c0194d4e6035e654cfR332),568538473,2016-12-06 13:47:45
18943590,13159450,91015733,17,"the code that renders response based on status code has been improved a lot in [`response.py`](https://github.com/twitter/heron/pull/1593/files#diff-a90956032bc120bbfaad04664668a46a) in #1593, which I am sure it needs more comments...",568538473,2016-12-06 13:50:01
18943590,13159450,91015870,19,resolved in #1593. See [`HdfsUploader.java`](https://github.com/twitter/heron/pull/1593/files#diff-16dc2d858f9b42f2253a00e91a84bff0R72),568538473,2016-12-06 13:51:44
18943590,13159450,91015741,43,resolved in #1593 ,568538473,2016-12-06 13:50:08
18943590,13159450,91015930,29,resolved in #1593. See [`Hdfsuploader.java`](https://github.com/twitter/heron/pull/1593/files#diff-16dc2d858f9b42f2253a00e91a84bff0R82).,568538473,2016-12-06 13:52:38
18943590,73683,91196782,127,"should explain in comments why you only call undo for certain exceptions. Or better yet, could we always call undo and have that method be written in a way where it's a noop if there is nothing for it to do?",571890381,2016-12-07 07:29:10
18943590,13159450,91431971,36,fixed via https://github.com/twitter/heron/pull/1571/commits/8964cfc28fb18001c6c856eaa6125dc809d41393,572605620,2016-12-08 10:32:30
18943590,13159450,91431975,26,fixed via https://github.com/twitter/heron/pull/1571/commits/8964cfc28fb18001c6c856eaa6125dc809d41393,571890381,2016-12-08 10:32:33
18943590,13159450,91208250,81,"as discussed, will address in another PR.",571890381,2016-12-07 09:07:17
18943590,13159450,91440050,74,"not necessarily `uploaderClass`. Instantiation of `statemgrClass` and `launcherClass` could also fail.

I'll just remove exception from `TopologySubmissionException` constructor here.",571890381,2016-12-08 12:10:41
18943590,13159450,91440353,74,or we can use three `try...catch` clause here...,571890381,2016-12-08 12:12:23
18943590,13159450,91440385,53,dup of https://github.com/twitter/heron/pull/1571#discussion_r91195786,568538473,2016-12-08 12:12:48
18943590,13159450,91374047,26,resolved,571890381,2016-12-08 03:57:04
18943590,13159450,91374091,29,resolved,571890381,2016-12-08 03:57:20
18943590,13159450,91374223,129,resolved,571890381,2016-12-08 03:57:54
18943590,13159450,91374171,24,resolved,571890381,2016-12-08 03:57:41
18943590,13159450,91374187,127,resolved,571890381,2016-12-08 03:57:45
18943590,13159450,91374077,63,resolved,571890381,2016-12-08 03:57:15
18943590,13159450,91374937,14,resolved,571890381,2016-12-08 04:01:13
18943590,13159450,91375285,81,refactored so that `LaunchRunner` does not implement `Callable`. opened an issue related to https://github.com/twitter/heron/issues/1596. ,571890381,2016-12-08 04:03:06
18943590,13159450,91374894,34,fixed at https://github.com/twitter/heron/pull/1571/commits/25444541d998af57e00a4de6d02a9abc80a5a35f#diff-1043de1ec8f8e4c0194d4e6035e654cfR331,571890381,2016-12-08 04:01:02
18943590,13159450,91628558,99,resolved,572851657,2016-12-09 07:10:38
18943590,13159450,91628575,33,resolved,572851657,2016-12-09 07:10:44
18943590,13159450,91628567,95,resolved,572851657,2016-12-09 07:10:42
18943590,13159450,91631794,94,resolved via https://github.com/twitter/heron/pull/1571/commits/e15d3cb03b7d7edba71c2aec133bdbf212ec5abb,572860875,2016-12-09 07:33:20
18943590,13159450,91631787,92,resolved via https://github.com/twitter/heron/pull/1571/commits/e15d3cb03b7d7edba71c2aec133bdbf212ec5abb,572860875,2016-12-09 07:33:17
18943590,13159450,91636275,88,resolved,572851657,2016-12-09 08:11:47
18943590,13159450,91640750,34,"I'll move to use `LOG.log(Level.FINE, ..., e)`",571890381,2016-12-09 08:54:03
18943590,73683,91417281,36,omit: happens,572605620,2016-12-08 08:10:32
18943590,73683,91417411,26,"hmm, I don't see it. I'm referring to the Log.info above. The creating it now message.",571890381,2016-12-08 08:11:32
18943590,73683,91575319,34,As implemented the user will always see the stack trace. If the output messaging is sufficient we could only show the stack trace with --verbose (i.e. log.fine). Thoughts?,571890381,2016-12-09 02:29:50
18943590,73683,91576676,73,"Best to now assume this is InvokatonError and check for it. Then have a final else that alerts that we have an unexpected response code found. That should never be the case, but it future proofs against people adding an enum value and no updating this met",572851657,2016-12-09 02:35:09
18943590,73683,91577118,72,"Why log debug HeronError detailed_msg, but log error for detailed_msg for Invokation error? If there's valid reason please include a comment in the code",572851657,2016-12-09 02:36:32
18943590,73683,91578164,99,This is where it would be better to use a Status.HeronError from Response instead of requiring the caller to know the int value.,572851657,2016-12-09 02:40:34
18943590,13159450,91578868,99,"Yes. How about we assign `0` to `Ok`, `1` to `InvocationError`, and `100` for `HeronError` at https://github.com/twitter/heron/pull/1571/files/dfae5d760fc355bf5a562dad9e12be57f383fbf6#diff-a90956032bc120bbfaad04664668a46aR20",572851657,2016-12-09 02:42:27
18943590,13159450,91579613,95,"I feel `UploaderException` means unexpected error that happens during uploading package, but I think it is fine to extend the meaning...",572851657,2016-12-09 02:45:57
18943590,13159450,91579207,88,still some refactor left: push response object back to `main.py` so we can combine some logic.,572851657,2016-12-09 02:44:06
18943590,13159450,91580434,33,sure,572851657,2016-12-09 02:49:55
18943590,73683,91580305,33,could you also check that :-1 is in fact a newline?,572851657,2016-12-09 02:49:18
18943590,13159450,91582854,72,will add documentation ,572851657,2016-12-09 03:01:12
18943590,13159450,91582875,73,"good suggestion. will do.

not rendering `msg` here because `InvocationError` implies there should be no information in stdout. will add documentation.",572851657,2016-12-09 03:01:17
18943590,73683,91598137,99,"Yes for 0 and 100 but invocation error should be defined by the process that returns it, and we should just assert that it's > 0 and < 100 to avoid collisions.",572851657,2016-12-09 04:17:47
18943590,13159450,91606074,99,"i don't understand the assert part. Where and how should I assert this? Sometimes shelled-out program exits with `> 0 && < 100`, sometimes it could exit with `>=100`. ",572851657,2016-12-09 05:03:41
18943590,13159450,91606575,95,how about instantiation of state manager and launcher class? should we also create exception for them?,572851657,2016-12-09 05:06:48
18943590,73683,91607236,99,"You're right, we can't really assert becuase we any value can be returned and set from the shell command so disregard that part.",572851657,2016-12-09 05:10:48
18943590,13159450,91443695,74,"used three `try...catch` clause: https://github.com/twitter/heron/pull/1571/commits/12a41b1836f0b799a30387f7f8602d2e35ca9a30 

mark this one as resolved unless there is more question",571890381,2016-12-08 12:47:24
18943590,13159450,91819338,18,oh shit. done via https://github.com/twitter/heron/pull/1571/commits/dc8ec7697539ecd27a854d6491ba9bd21198403c,571890381,2016-12-10 08:08:54
18973893,2863245,89064079,12,"Is a reverse scorer for instance removal better? IMO, inserting and removing instances among the containers in reverse direct will result in better resource utilization.",559254674,2016-11-22 16:37:30
18973893,2863245,89062374,17,a typo: starte -> start,559254674,2016-11-22 16:24:43
18973893,16405288,89186472,83,"In the RCRR implementation, during scale down we do not always start from the first container. For example if we need to scale down 2 components by 1 instance from containers [1...5] and the first component is removed from instance 2 then the removal for ",559254674,2016-11-23 03:01:57
18973893,16405288,89190062,83,"@billonahill I'm not sure if that is the same. In the previous example if we pass as input to the constructor container id 3 and containrId 5 then the search will stop at 5, right? Wehat we ideally want is to start from 3 and use this sequence: 4,5,1,2. I",559254674,2016-11-23 03:18:32
19245989,16405288,90290972,49,I think you lose opportunities for removing containers with this scoring function. Let's take a container BBCD and ABC and you want to remove 1 B. It is better to remove it from ABC than BBCD because you maximize the probability to remove this container b,566474034,2016-12-01 02:04:18
19245989,73683,90294593,49,"As implemented we're trying to achieve balance while also removing containers where we can (despite how I named this PR). So I would argue that we would want to go from [BBCD, ABC] to [BCD, ABC] which is a more balanced state. To expand on this example, i",566474034,2016-12-01 02:22:48
19245989,16405288,90300629,49,"I think there is a confusion here. The imbalance metric you have will differentiate correctly between homogeneous and heterogeneous containers (e.g., [BBCD, BBB]). But it will not work well in a set of mixed containers. The reason is that usually the imba",566474034,2016-12-01 02:52:34
19245989,6377806,90303391,49,"@billonahill - If a user requests to remove an instance of A from [AB, AABCD], this score will return [.5, .4], and it will result in [B, AABCD]. Container 2 in this case is imbalanced, but the instance is removed from container 1.",566474034,2016-12-01 03:04:27
19245989,73683,91582154,32,"Good catch. That's a bug in my comment, we are doing most homogeneous first. Updated.",571684283,2016-12-09 02:57:47
19245989,16405288,91225407,32,Should we do most homogeneous here?,571684283,2016-12-07 12:27:58
19247925,73683,90064679,48,"Yes, that needs to be fixed. It should divide and round. Will update that.",566529977,2016-11-30 01:48:11
19247925,13159450,90036047,48,"Divide two `long`s could yield 0, which I guess is not what we want to see...?",566529977,2016-11-29 23:45:24
19247925,73683,90383357,68,"I haven't yet found that computation done in the code, but if I do, I'll add it. Otherwise I say we leave it out until it's needed.",568116097,2016-12-01 12:55:36
19247925,13159450,90387097,68,ok ???? ,568116097,2016-12-01 13:53:06
19247925,13159450,90363831,53,what's the usage of this function since the one below looks perfect?,568116105,2016-12-01 08:57:06
19247925,73683,90366755,53,"Great point, removed.",568116105,2016-12-01 09:24:44
19247925,13159450,90367143,68,"should be the last comment so bear with me...

Do we also need a `decreaseBy`, maybe it's useful when we scale down?",568116097,2016-12-01 09:28:10
19247925,6377806,90934571,121,"The method is returning a new object. However, this object should be reduced as per the javadoc?",571503905,2016-12-06 03:14:42
19247925,73683,90935155,121,"I think ByteAmounts should be immutable, so returning a new one makes sense. I'll update the javadoc to reflect that",571503905,2016-12-06 03:17:37
19247925,6377806,90940438,45,ByteAmount.fromGigabytes(3),571503905,2016-12-06 03:43:57
19247925,6377806,90940984,87,"what do you think about using abbreviations in this method, asMB() ?",571503905,2016-12-06 03:46:42
19247925,6377806,90942226,99,"Agree. 
We could return float or double from these methods, and let the caller perform context specific transformation?",571503905,2016-12-06 03:52:46
19247925,73683,90943740,87,"I debated this one as well. I like the conciseness but not the resulting inconsistency between asBytes, asMB and asGB.",571503905,2016-12-06 04:00:54
19247925,73683,90943833,45,"great catch, thanks.",571503905,2016-12-06 04:01:18
19247925,73683,90946616,99,"Another thought is we could add an enum to the signature where the caller specifies how the rounding should occur: ceil, floor, round, or strict where we fail if there is a remainder. That way the caller has to acknowledge the potential for rounding and d",571503905,2016-12-06 04:17:39
19247925,6377806,90965086,99,Works for me.,571503905,2016-12-06 05:59:20
19247925,73683,90966518,99,"Cool. Since this patch is already large and at risk of drifting out of sync with master, I'd like to commit as-is and address this in a follow-up.",571503905,2016-12-06 06:07:08
19247925,6377806,90933585,99,"I think using Math.ceil would be safer?
For e.g. if unit of container allocation is GB, then at least 1 GB container will be allocated when 500 MB container is requested.",571503905,2016-12-06 03:09:56
19247925,73683,90938430,99,"Yeah, I have mixed feelings about asMegabytes and asGigabytes. They only make sense as convenience methods for callers who are working entirely in MBs or GBs and only adding/subtracting using like units. For example, the yarn scheduler uses asMegabytes to",571503905,2016-12-06 03:33:57
19313545,73683,90286412,182,"please include a helpful error message here, including the bad field value",568106367,2016-12-01 01:42:24
19313545,73683,90285393,111,please include proxy in the exception message here,568106367,2016-12-01 01:37:24
19313545,73683,90280487,82,"If we add a helper method in this class to do `foo != null && !foo.isEmpty()` it would improve the readability of this code:

```
private static boolean isEmpty(String... value) { ... }
```

We could then simplify these conditionals to do:
```
if ",568106367,2016-12-01 01:15:06
19313545,73683,90568022,114,please include the invalid value in the exception,567986370,2016-12-02 08:36:39
19313545,73683,90568545,26,"We should clarify that if both access_key, secret_key and aws_profile are all included the latter will be ignored. Or probably better to throw an exception if all 3 are specified, just to make sure things are clear. That's consistent with how we throw an ",567986370,2016-12-02 08:42:16
19313545,73683,90908129,18,Please include `proxy` in the message.,569804227,2016-12-06 01:00:58
19313545,73683,90908002,6,"I think what we want to convey her is that the user must specify either a profile or a key/secret, but not both. Also the wording is off a bit. We should either use supply or provide but not both.",569804227,2016-12-06 01:00:34
19313545,73683,90568198,196,"Can we replace ""Error undoing deploying"" with something more descriptive? Like what exactly are we trying to undo and why?",567986370,2016-12-02 08:38:42
19387660,73683,90733051,13,How were you able to determine the long list of required includes here? Could you provide a link in a comment?,569603097,2016-12-03 06:41:01
19387660,114449,90734230,1,"This patch already exists for 2.5.0, I just regenerate it for 3.1.0. The reasons why we need it are:

1) The C++11 version is faster, it saves an if check on super hot path.
2) We compile our stream manager with C++11, so it is safe to just remove the ",569603097,2016-12-03 06:51:19
19387660,114449,90743798,1,Will do it in a separate PR.,569603097,2016-12-03 08:39:20
19503565,13159450,91014134,219,"Yes. this `run` function still needs improvement, which I will do after I figured out how to resolve the issue @billonahill asked in https://github.com/twitter/heron/pull/1571#discussion_r90506972",571890393,2016-12-06 13:26:17
19534542,73683,91633970,5,does this have the potential to sleep indefinitely?,572862522,2016-12-09 07:51:51
19534542,13159450,91634090,5,"maybe, which I guess will timeout Travis or internal CI",572862522,2016-12-09 07:53:01
19534542,73683,91634220,5,best to not rely on that and provide a hard limit upon which we give up.,572862522,2016-12-09 07:53:59
19534542,114449,91635249,5,"It's hard to define a time here, b/c we never know if the message is lost or just delayed. I think relying on CI is fine, otherwise still have the same failure.",572862522,2016-12-09 08:02:22
19534542,73683,92023971,5,"30 seconds? It's hard to tell for sure, since I'm not familiar with the specific of what this test is doing. If you start with 30 seconds and we're still timing out we could increase it, or try to understand why.",572862522,2016-12-13 03:43:37
19534542,73683,92006137,5,It's better to provide a reasonable timeout here for how long the test should wait. The CI timeouts can be an hour or more. We don't want this test to hang for that long and potentially clog what is a resource-limited CI queue.,572862522,2016-12-13 02:18:05
19534542,114449,92011828,5,"Can you give a reasonable timeout? As in the current code, 3-second was supposed to be reasonable, but it is not... So I don't know what is a reasonable one.",572862522,2016-12-13 02:46:02
19534542,114449,92060481,5,"Makes sense, it is safer to use a longer timeout.",572862522,2016-12-13 06:56:15
19537842,6334077,91643690,5,"@objmagic - hi, Is there anything I could do? The method name which @billonahill mentioned is better . However, I don't think adding an new enum class is a good idea. Perhaps we could add new static constants in FileUtils instead of handling string variab",572896534,2016-12-09 09:22:23
19537842,13159450,91643840,5,any reason why using enum is not a good idea?,572896534,2016-12-09 09:23:44
19537842,6334077,91644684,5,"@objmagic - Cause `String pkgType` is used for Config's key. Just in my opion, this scene is applicable to the principle of Occam's razor -- `If not necessary, do not increase the entity` ",572896534,2016-12-09 09:33:01
19537842,13159450,91574082,5,sorry for merging this too fast. I'll do this.,572896534,2016-12-09 02:23:12
19537842,73683,91573936,5,"Thanks for the removal of dup code!

Could you also please change to not abbreviate pkg (e.g., packageType and getPackageType).

Also instead of returning strings, better to use an enum, maybe as an inner enum in FileUtils:
```
enum PackageType {
 ",572896534,2016-12-09 02:22:23
19537842,13159450,91575882,5,"actually, returning enum might not be what we want, since we need to put value as string into config. See: https://github.com/twitter/heron/pull/1599/files#diff-1043de1ec8f8e4c0194d4e6035e654cfL80",572896534,2016-12-09 02:32:32
19537842,13159450,91588447,5,where do you think is appropriate to put this? I am really bad at finding an appropriate class to add code????,572896534,2016-12-09 03:28:06
19537842,13159450,91763705,5,@mycFelix imo Bill has better arguments. I will submit a PR to use enum.,572896534,2016-12-10 01:57:58
19537842,73683,91581432,5,"Config.put takes an object as it's value, so we could put enum values in and add a getter that returns it. We did this with ByteAmount for example:

https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/Config.java",572896534,2016-12-09 02:54:34
19537842,73683,91596073,5,"spi.common would be good. Just like Commands:
https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/Command.java#L20",572896534,2016-12-09 04:05:34
19537842,73683,91647983,5,Config supports objects and we should favor type safety where ever possible. Doing so will make code easier to maintain and less prone to bugs than by passing string values around.,572896534,2016-12-09 10:09:11
19571787,13159450,91817105,26,I am not sure if it will return a lowercase one or an uppercase one.,573277227,2016-12-10 07:44:14
19571787,73683,91824222,5,"better to use `.name()` than toString. Also check on the cases, think both return caps.",573335187,2016-12-10 09:25:33
19571787,73683,91824155,38,"We can remove ~20 lines of code and just use guava Files class here:
```
String extension = Files.getFileExtension(topologyBinaryFile)
return PackageType.valueOf(extension.toUpperCase();
```
```",573335187,2016-12-10 09:23:30
19571787,73683,91825336,27,We should rename topologyBinaryFile to something more generic like filename.,573354620,2016-12-10 09:50:54
19571787,13159450,91825473,27,"how about `packageFile`, since this class is `PackageType`? `filename` is too general",573354620,2016-12-10 09:54:02
19571787,73683,91812509,26,Why is a custom toString necessary? IIRC the enum toString prints nicely.,573277227,2016-12-10 07:01:37
19571787,73683,91812550,27,`this.name()` does this,573277227,2016-12-10 07:01:55
19571787,73683,91812866,16,"This if statement can be replaced with a static factory method on the enum. Something like this:

```
public enum PackageType {
  PEX,
  JAR,
  TAR
  
  public static PackageType getType(String filename) {
    // parse extension
    return Packa",573277227,2016-12-10 07:04:21
19571787,73683,91813478,5,"We don't want to rely on `toString()` here since that should only ever really be used for logging. If we need a string better to call `.name()` on the enum, or create a `value` field in the enum that is defined as part of the enum (i.e., `TAR(""tar"")`).",573277227,2016-12-10 07:09:12
19571787,13159450,91817201,16,yes that will be easier. I realized that I am just cargo-culting.,573277227,2016-12-10 07:45:16
19571787,73683,91825316,39,Is this RuntimeException or a subclass? If a subclass we should expect that instead.,573354620,2016-12-10 09:50:23
19571787,73683,91825692,27,sure,573354620,2016-12-10 09:59:18
19640716,73683,92204152,5,"This class is really a utility, not a config. We should probably name it `SchedulerConfigUtils`. Also all but the last method can be private.",574273600,2016-12-14 00:17:18
19640716,6334077,92306819,5,"Understood, I'll update it.",574273600,2016-12-14 09:35:23
19640716,6334077,92307145,4,"My bad, forgot doing this. ",574273600,2016-12-14 09:38:28
19640716,6334077,92307354,5,Good Point!  Thank you for your advice. I'll try to move them into schedulers-core,574273600,2016-12-14 09:40:05
19640716,73683,92204524,4,Are these running elsewhere? I don't see them added under schedulers/tests.,574273600,2016-12-14 00:18:43
19640716,73683,92205840,5,"`schedulers-core` should not depend on `schedulers`, but the other way around. The classes we're moving should live in `schedulers-core` so all implemented schedulers could leverage them.",574273600,2016-12-14 00:23:53
19655592,1278336,92650355,58,Not sure if changing your metrics names over time is a great design either ;) but I will fix that.,574715605,2016-12-16 00:52:07
19655592,2183863,92622117,52,Is it possible to add all these configs as a sample for this sink in metrics_sinks.yaml (https://github.com/twitter/heron/blob/master/heron/config/src/yaml/conf/examples/metrics_sinks.yaml)?,574715605,2016-12-15 22:46:47
19655592,2183863,92623396,52,Can you add comments for all these configs to explain what they are for?,574715605,2016-12-15 22:53:05
19655592,2183863,92623611,69,This variable name does not match the config name. It is good to make them consistent or comment down the reason.,574715605,2016-12-15 22:54:03
19655592,2183863,92623990,79,Should we also print the content in the file?,574715605,2016-12-15 22:56:02
19655592,2183863,92624426,114,Should we also bubble up this exception or solely log it down?,574715605,2016-12-15 22:58:13
19655592,2183863,92625103,58,What is this variable for? Could we add comment for it?,574715605,2016-12-15 23:01:15
19655592,2183863,92626676,149,"Can you tell me what are the differences between:
1. 
```
Map<String, Object> sourceMap = new HashMap<>();
processMetrics("""", record.getMetrics(), sourceMap);
metrics.put(source, sourceMap);
```
2.
```
processMetrics("""", record.getMetrics(), metr",574715605,2016-12-15 23:09:09
19655592,2183863,92626768,118,"1. Comment for this method? 

2.
Also, the argument `Iterable<MetricsInfo> metrics` will hide the field `protected ConcurrentHashMap<String, Object> metrics`, which is bad.

3. Why making it a static method? Also, why passing the out as a argument, w",574715605,2016-12-15 23:09:40
19655592,2183863,92628389,58,"After reviewing this sink, I found there is no limitation on the size of this Map `metrics`. In some cases, for instance, users export metrics with new name at an interval, it is possible the size of `metrics` will grow unboundedly and eventually lead to ",574715605,2016-12-15 23:17:26
19655592,1278336,92649672,79,TypeUtils.getInteger already does that. However I should probably catch and re-throw that to add context.,574715605,2016-12-16 00:48:43
19655592,1278336,92649967,149,"Flat map of metrics (testFlatMetrics)  vs. a map of map of metrics (testGroupedMetrics), check out the unit tests. ",574715605,2016-12-16 00:50:12
19655592,2183863,92838818,4,"Can you add a comment here to indicate this library is used only for websink, since we would later split the all these sinks from the spi parts.",575015466,2016-12-17 00:15:20
19655592,2183863,92838958,114,"Given the RuntimeException contains the error msg, extra SEVERE LOG seems duplicated and unnecessary.",574715605,2016-12-17 00:16:08
19655592,1278336,92700804,114,"Just checked some other Sinks and they tend to throw a RuntimeException if they can't start, I'll make that change as well.",574715605,2016-12-16 05:12:01
19703137,6334077,92556912,42,using `Preconditions.checkState`?,575265270,2016-12-15 15:33:57
19703137,6334077,92557809,42,"Sorry, I didn't notice this PR has been requested a reviewer.",575265270,2016-12-15 15:44:04
19703137,13159450,92645704,42,@mycFelix Every one is welcomed to review.,575265270,2016-12-16 00:31:26
19703137,73683,92646406,42,"Yes, by all means don't be shy about reviewing any PR @mycFelix.",575265270,2016-12-16 00:34:07
19703137,13159450,92647237,42,"I am not sure about using `Preconditions.checkState`. I don't see any particular benefit we could have. Besides, if we use it here, does that mean we should use it elsewhere? Does that mean we should use Guava as much as possible?",575265270,2016-12-16 00:37:57
19703137,73683,92651795,28,You've got the same comment in this block twice,575265270,2016-12-16 00:58:39
19703137,73683,92652086,32,"This method has a ton of duplicate code/patterns with `SubmitterMain` and even `SchedulerMain`. We should share that. One suggestion would be for them to extend a common `AbstractMain` or something like that:
```
abstract class AbstractMain {
  // incl",575265270,2016-12-16 01:00:02
19703137,73683,92662608,20,RuntimeManagementException?,575265271,2016-12-16 01:51:19
19703137,73683,92663549,27,Have the preconditions from this class moved to TMasterUtils?,575265271,2016-12-16 01:56:17
19703137,73683,92663683,23,"append ""from state manager""",575265271,2016-12-16 01:56:56
19703137,73683,92664091,31,No need to create `String errMsg`,575265271,2016-12-16 01:58:57
19703137,73683,92664424,39,No need to define `String errMsg` here and elsewhere,575265271,2016-12-16 02:00:37
19703137,73683,92665063,42,"I favor using Preconditions.checkState for error states that should never really occur except due to a bug (i.e. dividing by 0 for example). For situations like this one though, this can actually happen if two people are trying to run a command at the sam",575265270,2016-12-16 02:04:12
19703137,13159450,92688889,20,"then accordingly, `TopologySubmissionException` should be `SubmissionException`?",575265271,2016-12-16 04:02:16
19703137,73683,92689773,20,Fair point. Let's keep `TopologyRuntimeManagementException`.,575265271,2016-12-16 04:07:16
19703137,13159450,92702604,27,yes,575265271,2016-12-16 05:23:06
19703137,13159450,92702621,23,resolved,575265271,2016-12-16 05:23:12
19703137,13159450,92702644,31,resolved,575265271,2016-12-16 05:23:18
19703137,13159450,92702678,39,resolved,575265271,2016-12-16 05:23:31
19703137,13159450,92702793,32,will do this in another PR,575265270,2016-12-16 05:24:13
19703137,13159450,92702832,28,will do this in another PR,575265270,2016-12-16 05:24:27
19703137,73683,92741776,44,Can we use TMasterException instead of RuntimeException? Also the TM in TMaster should both be in caps.,575265277,2016-12-16 10:33:43
19703137,73683,92741885,29,Sometimes we throw TMasterException and others we throw the exception generated from Proconditions. Should we be consistent and just throw TMasterException? That seems like a better experience.,575265277,2016-12-16 10:35:19
19703137,13159450,92742834,29,"consistency is nice, but does that mean we should put statement `Preconditions.checkNotNull...` inside of a `try...catch` clause. If exception `NullPointerException` gets thrown out, we catch it and throw a `TMasterException` out instead? (and [none of th",575265277,2016-12-16 10:43:09
19703137,13159450,92742991,44,resolved via https://github.com/twitter/heron/pull/1618/commits/9379ed9cfdca138f46c635e3e836a81f260bcf1b,575265277,2016-12-16 10:45:29
19703137,13159450,92744099,29,resolved via https://github.com/twitter/heron/pull/1618/commits/3e55954414684441e5172550ebda2a4697c89a0b,575265277,2016-12-16 11:01:14
19800706,13159450,93190076,61,yes. I forgot this when refactoring.,579553380,2016-12-20 16:33:08
19800706,6334077,93189708,61,"I'm not quite sure if `Strings.repeat` would help this part of code(56-61). 

```
        StringBuilder metaFormatterBuilder = new StringBuilder();
        metaFormatterBuilder.append(Strings.repeat(String.format(""| %s "", ""%%%ds""),title.size()));
   ",579553380,2016-12-20 16:30:05
19800706,6334077,93199284,26,I noticed that the difference between `componentsResource` and `componentsParallelism` method is the return type and those methods were invoked several times by subclass separately. How about we combine two methods into one method named `componentsInfo` a,579975418,2016-12-20 17:33:01
19800706,13159450,93496099,4,"actually, the config value you got is the dry-run format that's going to be used. So, `String` here.",579975418,2016-12-22 02:46:16
19800706,13159450,93496371,4,didn't see your comment below.,579975418,2016-12-22 02:47:52
19800706,13159450,93496602,75,agree. will do in this PR or #1622 ,579975418,2016-12-22 02:49:09
19800706,13159450,93496475,62,let's do it in #1622 ,579975418,2016-12-22 02:48:31
19800706,13159450,93496406,39,make sense. will do.,579975418,2016-12-22 02:48:06
19800706,13159450,93505805,26,"actually how about 

````
elif status_code == 100:
  return Status.HeronError
elif status_code == 200:
  return Status.DryRun
else:
  # some assertion failure",579975418,2016-12-22 03:41:03
19800706,73683,93493305,15,`Verbose mode. Increases logging level to show debug messages`,579975418,2016-12-22 02:30:27
19800706,73683,93492815,26,Unit tests please for all changes to Resource.,579975418,2016-12-22 02:27:38
19800706,73683,93490738,14,"let's put all the dry run responses and renderers in `com.twitter.heron.scheduler.dryrun`. Util should almost only ever be used for static utility helper methods, and even then it should be avoided when possible.",579975418,2016-12-22 02:16:36
19800706,73683,93494402,24,We could remove this and just append ` in dry run mode` to the end of the existing messages if we're in dry-run mode.,579975418,2016-12-22 02:36:20
19800706,73683,93485753,4,This should be a Boolean instead to indicate that it is a dry run.,579975418,2016-12-22 01:48:03
19800706,73683,93490419,26,"Parallelism mapping isn't needed, it's already done in `packingPlan.getComponentCounts()`. If we need to sum all resources by component, we should also provide that as a method in `PackingPlan`. And it should have a unit test.",579975418,2016-12-22 02:14:46
19800706,73683,93493836,26,"shouldn't this be:
```
elif status_code == 200:
  return Status.DryRun
else:
  return Status.HeronError
```",579975418,2016-12-22 02:33:20
19800706,73683,93495287,74,"How is the case handled where someone tries to dry-run a command that doesn't support it? How does the user know which command dry run is valid for? For example:
```
heron deactivate --dry-run
```",579975418,2016-12-22 02:41:22
19800706,73683,93487868,75,"These values should not be buried as hidden strings here. They should be python options to a given argument. In the java code we could have a map of renderers keyed by value, where the keys are constants or enums.",579975418,2016-12-22 01:59:25
19800706,73683,93483469,29,"What about changing the signaure to be more generic:
```
public SubmitDryRunResponse(TopologyAPI.Topology topology, Config config, PackingPlan packingPlan);  
```

That would provide more info to the renderer.",579975418,2016-12-22 01:34:10
19800706,73683,93487032,62,"Instead of hard coding 200 here can we have this be a constant somewhere with it's meaning implied in the name?

RESP_CODE_FOO=100
RESP_CODE_DRY_RUN=200",579975418,2016-12-22 01:55:23
19800706,73683,93495013,16,doesn't `resp` have a response code that we should be returning?,579975418,2016-12-22 02:39:44
19800706,73683,93489985,59,"Instead or requiring each renderer to support all commands for which dry run is supported, we could be more granular here and have a SubmitDryRunRender interface that knows how to render SubmitDryRunResponse objects. Same for update. This will make for sm",579975418,2016-12-22 02:12:37
19800706,73683,93493557,17,We should include a comment here with a reference to the java class where these constants are defined.,579975418,2016-12-22 02:31:51
19800706,73683,93486641,39,"Better to have `--dry_run` be a boolean. If it's true `--output_format` (tsv, json, text, etc) can be set to override the default. We might also need a third flag at some point if we have multiple versions of a format (e.g., summary, detail, etc). ",579975418,2016-12-22 01:53:26
19800706,73683,93488147,35,"We really need to refactor so we can stop copying code between this class and RuntimeManagerMain. Can we do that first, in a separate PR?",579975418,2016-12-22 02:01:15
19800706,13159450,93498721,26,"in my opinion, when new return code class is added (for example, dry-run here), we use number larger than the current largest number (100). I am using 200 here. 130, 150, or other numbers larger than 100 is OK.",579975418,2016-12-22 03:01:01
19800706,13159450,93499034,26,"in your suggestion, HeronError is using number larger than 200 instead of 100, which means we need to modify all the codes that return 100.",579975418,2016-12-22 03:02:50
19800706,13159450,93498055,74,this function is used only in [submit.py](https://github.com/twitter/heron/pull/1629/files/cbcf7659a76643643cc625ce0918333a8066b722#diff-c3a12db5e886d4de25105d68c3e96929R56) and [update.py](https://github.com/twitter/heron/pull/1629/files/cbcf7659a7664364,579975418,2016-12-22 02:57:10
19800706,13159450,93499317,16,"not the case for `help` and `version` subcommands. I feel it is OK to let them return a boolean as always, instead of making them to return a response object",579975418,2016-12-22 03:04:31
19800706,13159450,93501810,74,and `heron help deactivate` will not show anything about `--dry-run`.,579975418,2016-12-22 03:19:03
19800706,73683,93502485,26,"As written you're defining anything >= 200 returned from the java process to be represented as a dry run by the python process. Why?

I thought you were adding a new 200 code explicitly for dry run, which is why I suggested changing the logic from this ",579975418,2016-12-22 03:22:43
19800706,73683,93510729,26,"I think handling a range >= 100 would be a good way to future proof. If the java code adds 101 for example, the python code should pass through 101 without the need for edits.",579975418,2016-12-22 04:09:42
19800706,13159450,93510883,26,I see.,579975418,2016-12-22 04:10:43
19800706,6334077,93548986,26,got it,579975418,2016-12-22 08:46:35
19800706,6334077,93201712,73,"I was wondering if we could use `List<String>` and `Joiner` here instead of `StringBuilder` and `addRow` method as following code.

```
List<String> contentList = new ArrayList();
contentList.add(Strings.repeat(""="", titleRow.length()));
contentList.a",579975418,2016-12-20 17:45:02
19800706,13159450,96327870,35,Leaving this at #1622. Mark this as resolved now.,579975418,2017-01-17 09:04:57
19800706,13159450,96327908,26,unit test added: https://github.com/twitter/heron/pull/1629/files#diff-2fd9d07404811bde28fe7deae9abf3edR48,579975418,2017-01-17 09:05:27
19800706,13159450,96327950,17,comment updated here: https://github.com/twitter/heron/pull/1629/files#diff-a90956032bc120bbfaad04664668a46aR29,579975418,2017-01-17 09:06:09
19800706,13159450,96328056,16,resolved via https://github.com/twitter/heron/pull/1658,579975418,2017-01-17 09:07:25
19800706,13159450,96330996,29,fixed. See https://github.com/twitter/heron/pull/1629/files#diff-3db76a95a638602566f48a8d69b39780R30 https://github.com/twitter/heron/pull/1629/files#diff-b068406a7b6af7b7b4433ec0b01aec01R28 https://github.com/twitter/heron/pull/1629/files#diff-d8f8ef57c1,579975418,2017-01-17 09:42:48
19800706,13159450,96331097,4,fixed. see: https://github.com/twitter/heron/pull/1629/files#diff-5aa882aa5a656504af61600c3013d31b,579975418,2017-01-17 09:44:00
19800706,13159450,96331111,39,done. see https://github.com/twitter/heron/pull/1629/files#diff-5aa882aa5a656504af61600c3013d31b,579975418,2017-01-17 09:44:12
19800706,13159450,96331175,75,done. see https://github.com/twitter/heron/pull/1629/files#diff-d1d1365a41878729fde9e63ed4a847a9,579975418,2017-01-17 09:44:56
19800706,13159450,96331223,59,fixed. See https://github.com/twitter/heron/pull/1629/files#diff-21f2217fff70a9489b1ab27923cc039e and https://github.com/twitter/heron/pull/1629/files#diff-b48f5f206bbbc8bf893c8ac3ef7a0bc5,579975418,2017-01-17 09:45:51
19800706,13159450,96331233,14,done.,579975418,2017-01-17 09:45:59
19800706,13159450,96331251,15,done. see: https://github.com/twitter/heron/pull/1629/files#diff-33e2d5d0d27172c9f4b557d15cc3a3f0R40,579975418,2017-01-17 09:46:17
19800706,13159450,96331280,26,done. see https://github.com/twitter/heron/pull/1629/files#diff-a90956032bc120bbfaad04664668a46a,579975418,2017-01-17 09:46:42
19800706,13159450,96331331,24,done via https://github.com/twitter/heron/pull/1629/files#diff-c3a12db5e886d4de25105d68c3e96929R124,579975418,2017-01-17 09:47:21
19800706,73683,96488378,20,let's given a better description to the user for what we mean by dry run,599022686,2017-01-18 03:19:47
19800706,73683,96488994,34,See my previous comment above where this code is duplicated,599022686,2017-01-18 03:22:15
19800706,73683,96493859,53,can you also assert that the topology update never happens?,599022686,2017-01-18 03:44:05
19800706,73683,96495693,38,best to not suppress star imports,599022686,2017-01-18 03:52:27
19800706,73683,96496164,4,please add unit tests for the new clone methods,599022686,2017-01-18 03:54:31
19800706,73683,96495598,77,"PackingTestUtils contains test helpers that will create a test packing plan or container plan for you so you don't need to assemble all of this manually. Can you use that instead, or extend it as needed?",599022686,2017-01-18 03:52:02
19800706,73683,96490631,24,SubmitDryRunResponse and DryRunResponse are the same. Should we just make DryRunResponse non-abstract?,599022686,2017-01-18 03:29:08
19800706,73683,96494683,20,"The data files should be listed as bazel test resources, which will put them in the classpath of the unit test, so in each test you can just reference them relative to the tests/resources directory.",599022686,2017-01-18 03:47:59
19800706,73683,96494391,1,These should be under tests/resources,599022686,2017-01-18 03:46:29
19800706,73683,96490080,19,This abstraction implies that every command/renderer will have to support the same types of views. Some commands might support different views than others so a single `String render()` method seems more flexible. We can then have multiple implementations.,599022686,2017-01-18 03:26:39
19800706,73683,96494090,51,aren't you trying to assert that the code throws this response without mocking it's behavior to do so?,599022686,2017-01-18 03:45:07
19800706,73683,96495917,53,See comment above. We should avoid all this boilerplate setup code in favor of using shared test utility helpers,599022686,2017-01-18 03:53:21
19800706,73683,96494135,34,aren't you trying to assert that the code throws this response without mocking it's behavior to do so?,599022686,2017-01-18 03:45:19
19800706,13159450,96510987,19,"@billonahill I don't understand. If this is the case, what output format does `String render()` have? Table or raw, or anything else?",599022686,2017-01-18 05:10:25
19800706,13159450,96511969,24,"The reason of doing so is that later in #1622 (AbstractMain), I'd like to have a common abstract method like `protected abstract String renderDryRunResponse(DryRunResponse)` in `AbstractMain`. 

`SubmitterMain` will then override the abstract with a met",599022686,2017-01-18 05:15:43
19800706,13159450,96512295,34,yeah I just realized this... will really mock here...,599022686,2017-01-18 05:17:13
19800706,13159450,96512271,51,yeah I just realized this... will really mock here...,599022686,2017-01-18 05:17:06
19800706,13159450,96512555,1,"I was following the existing structure:
![image](https://cloud.githubusercontent.com/assets/3656079/22040347/60ea7f86-dcb7-11e6-9b5d-ad1ebc64462c.png)
",599022686,2017-01-18 05:18:10
19800706,73683,96512692,19,"Instead of one implementation that knows how to render both table and raw, you'd have two implementations, one for table and one for raw. You'd then bind each to their respective command line flags.",599022686,2017-01-18 05:18:55
19800706,73683,96512988,24,That's fine to follow your planned approach,599022686,2017-01-18 05:20:08
19800706,13159450,96513011,20,I was following https://github.com/twitter/heron/blob/master/heron/common/tests/java/com/twitter/heron/common/config/Constants.java. And include the test files like [this](https://github.com/twitter/heron/pull/1629/files#diff-82363f3f748309fe4666863b76fca,599022686,2017-01-18 05:20:15
19800706,13159450,96513175,38,I see. Will do.,599022686,2017-01-18 05:21:06
19800706,73683,96517691,20,"Test resources is the more standard way to do this:
https://bazel.build/versions/master/docs/be/java.html#java_test.resources",599022686,2017-01-18 05:43:05
19800706,13159450,96527029,20,"@billonahill we have our custom rules `java_tests`, which forbids `resources`. See: https://github.com/twitter/heron/blob/master/tools/rules/java_tests.bzl",599022686,2017-01-18 06:31:39
19800706,13159450,96527272,20,"and I searched the codebase. No test is using the `resources` way. If we choose to do so, should we refactor all the tests that are doing [`data`](https://github.com/twitter/heron/pull/1629/files#diff-82363f3f748309fe4666863b76fca86fR55)?",599022686,2017-01-18 06:32:57
19800706,73683,96529246,20,"I don't know why we wrote our own java_tests target, but if we still need that, we can easily add resources to it. It's just a proxy to the bazel java_test method which takes resources.

Ideally we should write tests to load files using relative paths b",599022686,2017-01-18 06:43:49
19800706,13159450,96543770,20,leaving this in #1688,599022686,2017-01-18 08:24:30
19800706,13159450,96979981,1,renamed to `resources`.,599022686,2017-01-20 07:06:16
19800706,13159450,96979994,4,removed these two methods since I didn't really use it.,599022686,2017-01-20 07:06:21
19800706,13159450,96979988,77,I checked out the `PackingTestUtils`. I think the method it provides is not really flexible to build up the scenario I want to test,599022686,2017-01-20 07:06:18
19800706,13159450,96980445,19,fixed via https://github.com/twitter/heron/pull/1629/commits/9cbe6df7c99b2c204cf5b2e8407305f02940795c,599022686,2017-01-20 07:09:14
19800706,13159450,96981002,34,"resolved. see: https://github.com/twitter/heron/pull/1629/files#diff-9d7c5b93dadaa33d2766bdfdad746d08

<del>minor comment: i have to mock the behavior of `Context` instead of `config` object since mocking `config` does not work... (NPE)</del> (fixed)",599022686,2017-01-20 07:12:39
19800706,13159450,96981527,51,"I've been trying to do a really mock test here. This is what I have done so far: https://github.com/twitter/heron/pull/1629/files#diff-581c3ba72d069451257c5910ad628e4eR216

But as discussed, I can't really work out a correct unit test because I keep enc",599022686,2017-01-20 07:16:20
19800706,13159450,97050702,53,resolved via https://github.com/twitter/heron/pull/1629/commits/641f439aaa7246b8363b2d874bf85bbe0f917e07,599022686,2017-01-20 18:55:15
19800706,13159450,97055125,51,"thanks to @billonahill 's help, this is resolved.",599022686,2017-01-20 19:26:21
19800706,73683,97115606,77,"Why would this not work?
```
PackingPlan.ContainerPlan containerOnePlan = PackingTestUtils.testContainerPlan(1, 1, 3, 5);
PackingPlan.ContainerPlan containerTwoPlan = PackingTestUtils.testContainerPlan(2, 4, 2, 6);
```",599022686,2017-01-21 01:20:13
19800706,73683,97117884,193,"The main classes don't leverage the `DryRunRender` interface. We'd have more flexibility by not binding the `DryRunRender` impls into the same parent class and instead doing something like this:
```
DryRunRender render = null;
switch (formatType) {
  ",600953683,2017-01-21 01:33:38
19800706,13159450,97118115,77,"I'd like to have only two components: `exclaim1` and `word`. However, your code above will create six individual components: `componentName-1`, `componentName-2`, `componentName-3`, `componentName-4`, `componentName-5`, `componentName-6`.",599022686,2017-01-21 01:35:04
19800706,73683,97118127,25,don't suppress this.,600953683,2017-01-21 01:35:09
19800706,13159450,97118283,25,forgot to remove this.,600953683,2017-01-21 01:35:58
19800706,73683,97118602,20,"Resources should be a sibling of java:
```
scheduler-core/tests/resources/com/twitter/heron/scheduler/dryrun
```
Doing so should make everything in resources be in the classpath when using the `resource` attribute to `java_tests`, or propbably the `da",600953683,2017-01-21 01:37:56
19800706,13159450,97119302,193,agree. will refactor.,600953683,2017-01-21 01:41:42
19800706,73683,97119345,39,don't suppress star imports,600953683,2017-01-21 01:41:59
19800706,73683,97119644,13,In `Context` and `Keys` you use `DRY_RUN_FORMAT_TYPE`. Let's change this to be consistent.,600953683,2017-01-21 01:43:42
19800706,13159450,97120260,39,resolved via https://github.com/twitter/heron/pull/1629/commits/3be17b3309d59eb60b5326d4e37c0f9c8529d3b1,600953683,2017-01-21 01:47:26
19800706,13159450,97120234,13,resolved via https://github.com/twitter/heron/pull/1629/commits/addd480372c7c098930748733961e6237cf45f38,600953683,2017-01-21 01:47:16
19800706,13159450,97120274,25,resolved via https://github.com/twitter/heron/pull/1629/commits/3be17b3309d59eb60b5326d4e37c0f9c8529d3b1,600953683,2017-01-21 01:47:30
19800706,13159450,97137135,20,Thanks for pointing this out. Leaving this in https://github.com/twitter/heron/issues/1668,600953683,2017-01-21 03:23:02
19800706,13159450,97138862,193,resolved. see: https://github.com/twitter/heron/pull/1629/files#diff-d46e068b4c18dd1146772b304b784859R456 and https://github.com/twitter/heron/pull/1629/files#diff-1043de1ec8f8e4c0194d4e6035e654cfR519,600953683,2017-01-21 03:32:14
19800706,13159450,97140978,38,forgot this yesterday and resolved today.,599022686,2017-01-21 03:43:33
19800706,13159450,97141031,53,see reply above https://github.com/twitter/heron/pull/1629#discussion_r97118115,599022686,2017-01-21 03:43:51
19800706,13159450,97141231,4,mark this as resolved since I didn't touch this class eventually.,599022686,2017-01-21 03:45:00
19800706,13159450,97141834,20,"as discussed with @billonahill, we will tackle this in the current PR.",600953683,2017-01-21 03:48:17
19800706,73683,97145929,93,'Enable dry-run mode. Information about the command will print but no action will be taken on the topology',601000228,2017-01-21 04:04:35
19800706,73683,97146303,100,"'The format of the dry-run output ([raw|table], default=table). Ignored when dry-run mode is not enabled.",601000228,2017-01-21 04:06:55
19800706,13159450,97152920,100,Thanks. Fixed via https://github.com/twitter/heron/pull/1629/commits/868a6cb36045a45defbb34a2bd289f9ae2c52ef5,601000228,2017-01-21 04:48:38
19800706,13159450,97152929,93,Thanks. Fixed via https://github.com/twitter/heron/pull/1629/commits/868a6cb36045a45defbb34a2bd289f9ae2c52ef5,601000228,2017-01-21 04:48:41
19800706,13159450,97181399,53,done via https://github.com/twitter/heron/pull/1629/commits/4fe8a8f834e984ba6cc1e3eff71e5932186cbaee!,599022686,2017-01-21 08:24:51
19800706,13159450,97181411,77,done via https://github.com/twitter/heron/pull/1629/commits/4fe8a8f834e984ba6cc1e3eff71e5932186cbaee!,599022686,2017-01-21 08:25:00
19800706,73683,97182380,19,"Can you tag this with:
```
@InterfaceAudience.Private
@InterfaceStability.Evolving
```",601176357,2017-01-21 08:36:34
19800706,73683,97182558,19,We no longer need this constant or class right?,601176357,2017-01-21 08:38:32
19800706,13159450,97182542,19,done via https://github.com/twitter/heron/pull/1629/commits/17fb6beba1bded0c310022138cc032cdab3683ca,601176357,2017-01-21 08:38:19
19800706,73683,97182760,22,Does this compile without the BUILD dep on the classification target?,601176531,2017-01-21 08:41:32
19800706,13159450,97182827,22,fixed via https://github.com/twitter/heron/pull/1629/commits/b92871cac5069d67164f3f84be88111843f8ad74,601176531,2017-01-21 08:42:13
19800706,13159450,97182831,19,fixed via https://github.com/twitter/heron/pull/1629/commits/b92871cac5069d67164f3f84be88111843f8ad74,601176357,2017-01-21 08:42:16
19800706,73683,97183440,30,"If you change this signature to use `Pair<String, Integer>...` instead, you can pass an array or an unbounded number of Pairs, which is more flexible to the caller, since you don't need to populate a List or array first.",601176531,2017-01-21 08:50:38
19800706,13159450,97181330,20,done via https://github.com/twitter/heron/pull/1629/commits/a20cfec70032091e95321d3bee783b17c43865c4!,600953683,2017-01-21 08:24:03
19800706,13159450,97185610,30,fixed via https://github.com/twitter/heron/pull/1629/commits/01745ff5dd56717998f16e5ffd9a017745e5873b,601176531,2017-01-21 09:24:49
19800706,13159450,97185680,30,"the generic array and type erasure stuff are quite annoying here, but I found the solution...",601176531,2017-01-21 09:26:02
19800706,73683,97186178,36,"Last nit, is that you typically don't want to split the type from the variable on two separate lines.",601222903,2017-01-21 09:35:09
19800706,13159450,93496703,35,right. I noticed many duplicated code in this PR and decide to leave that for #1622 ,579975418,2016-12-22 02:49:36
19800706,13159450,93503119,26,"I see. make sense. Dry-run code does not have to be a range, while invocation error code needs to be in a range. ",579975418,2016-12-22 03:26:15
19800706,13159450,97854344,344,yes this is annoying. will fix when i get chance.,601981447,2017-01-26 03:08:43
19800706,6334077,97717213,344,tiny comment. a typo?,601981447,2017-01-25 14:37:02
19800706,6334077,99461298,432,A tiny comment. I was wondering if the `titleNames` variable could be a static and immutable `List` instead of being create every times when the function invoked since it looks like the variable will never be changed in every single table.,601981447,2017-02-04 15:03:31
19800706,13159450,99461641,432,agree,601981447,2017-02-04 15:24:46
19804682,13159450,93177774,2,what does this mean? searched around but still couldn't find explanation...,579904722,2016-12-20 14:20:34
19830550,3201045,93537982,90,The include files are in the hdrs now. Realized this is not needed in the srcs actually.,580148391,2016-12-22 07:05:51
19830550,11442576,93537534,90,also + include_files?,580148391,2016-12-22 07:02:53
19830550,11442576,93538164,90,"kk, LGTM",580148391,2016-12-22 07:07:19
19831659,11442576,93551156,67,more header files are included than needed. Is this okay?,580156159,2016-12-22 09:12:38
19831659,3201045,93551265,67,yes - to keep it simple in the grand scheme of things.,580156159,2016-12-22 09:13:51
19831659,11442576,93551641,67,???? ,580156159,2016-12-22 09:18:25
19875475,114449,93681773,19,"Ditto, interfaces_.",580516450,2016-12-23 03:22:37
19875475,114449,93681948,6,So where do you split the list of interfaces?,580516450,2016-12-23 03:23:47
19875475,114449,93684984,62,Why this unix sock addr?,580516450,2016-12-23 03:43:16
19875475,114449,93681593,5,"If you want to allow multiple interfaces, please rename it to INTERFACES (singular vs plural). And I am not sure how much sense it makes to support multiple interfaces here, could you explain?",580516450,2016-12-23 03:21:18
19875475,114449,93685201,58,"I don't understand the logic here, mind to explain?",580516450,2016-12-23 03:44:31
19931602,114449,93847821,6,"I think it is cleaner to just use:

```
proto::stmgr::StartBackPressureMessage* message = nullptr;
message = acquire(message);
```
",583023143,2016-12-26 15:29:23
19931602,3201045,93848071,6,"I don't mind this. If we use your suggestion, somebody later might think it is needs to be cleaned up since a single assignment will suffice.",583023143,2016-12-26 15:34:02
19931602,114449,93895230,6,People should read the definition of acquire() and then figure out the type deduction. So I don't think it is a problem.,583023143,2016-12-27 12:24:24
19931602,10216235,94267983,6,Agree with @congwang ,583023143,2016-12-31 10:51:59
20027207,11442576,94860604,12,Is there any other way to get the hostname without using environment variables? It's very error prone to me: 1. as Karthik pointed out does Docker always set the 'HOST' properly; 2. what if others(not docker) set the 'HOST' environment variable for differ,589770220,2017-01-06 05:58:35
20027207,11442576,94861645,67,can we provide this constant string in marathonCofig? I feel this might change for different users.,589770220,2017-01-06 06:04:46
20027207,11442576,94861242,87,"do we need the portName here? why replace it with 0?
",589770220,2017-01-06 06:02:23
20027207,11442576,94863181,26,Why not just update the config map with the topology binary base name?,589770220,2017-01-06 06:13:51
20027207,11442576,94860718,24,this can be a class member replacing the config if you like,589770220,2017-01-06 05:59:16
20027207,11442576,94861676,68,ditto,589770220,2017-01-06 06:04:59
20027207,1165755,94899311,12,I need to go and verify this -- not sure if there's another way to get the actual hostname but i'll see what i can find,589770220,2017-01-06 12:45:11
20027207,1165755,94899419,67,"Yes, that makes sense. I think it would also be a good idea to actually include the Dockerfile as well. Could I put that file in the /docker directory and name it `Dockerfile.executor` maybe?",589770220,2017-01-06 12:46:45
20027207,1165755,94899518,87,"portName isn't important for it to run within Marathon, but setting the HOST_PORT to 0 allows the host to randomly choose a port on the machine to use. So it does need to be in there.",589770220,2017-01-06 12:48:26
20027207,1165755,94899551,26,Makes sense. Will make this change.,589770220,2017-01-06 12:49:04
20027207,1165755,101513139,12,"As far as I can find, you can't natively ""introspect"" the host IP from within a Docker container. The `HOST` environment variable is set by Marathon automatically as an environment variable for use cases like this where we care about the HOST IP. So, for ",589770220,2017-02-16 21:06:29
20027207,1165755,101513341,68,"BRIDGE networking here I think needs to be a requirement, so I'm just going to make that a constant variable instead of being configurable",589770220,2017-02-16 21:07:38
20027207,3201045,101417342,67,@jrcrawfo - one possible approach is to use a configuration file. Perhaps in the Marathon Scheduler file - @nlu90 can you help?,589770220,2017-02-16 08:13:50
20027207,3201045,113007448,12,"@jrcrawfo - I think what @nlu90 is referring to is - if any other environment (other than Docker) is setting HOST environment variable, this could fail. Hence I was wondering if we can add a check to see if we are running inside a docker environment. If w",589770220,2017-04-25 00:29:09
20027207,3201045,94277156,68,Same as before - should we hard code this?,587179230,2017-01-01 03:56:57
20027207,3201045,94277130,12,Can you add a comment about this line why this needed to improve readability?,587179230,2017-01-01 03:52:40
20027207,3201045,94277153,67,This is a hardcoded value. Can we move this to a generic config so that it is flexible?,587179230,2017-01-01 03:56:34
20027207,3201045,113007917,12,Since this is a test wondering if we need to get the HOST from environment variable - just socket.gethostname() should be fine?,676678013,2017-04-25 00:31:16
20408624,3201045,103072307,13,instead of for - you could use while similar to the mSentPackets (that follows)?,628982859,2017-02-25 14:04:30
20408624,3201045,103072300,13,"this does not seem to be correct. if you delete the iter, how can we do iter++",628982859,2017-02-25 14:03:34
20408624,3201045,103072460,50,"Is this standard c++? I thought it is GNU C++ extension. If this is part of the regular c++ standard, it is fine?",628982859,2017-02-25 14:13:38
20408624,114449,103112955,50,Good point. It does not seem to be standard even for C++.,628982859,2017-02-27 03:02:23
20408624,114449,103113007,13,"iter points to an element which is a pointer, so *iter is the pointer, delete *iter means deleting the contents pointed by that pointer, it is fine.",628982859,2017-02-27 03:04:16
20408624,32022953,104555499,4,release() puts into mempool. why is there potential mem leak?,597056649,2017-03-07 07:50:39
20408624,32022953,104555255,47,"The client.h/client.cpp are in the common directory, which means they are supposed to be general. IMO, the request and message are both general types for a network component to support. Maybe at some time, we need to use request type?",597056659,2017-03-07 07:49:13
20408624,32022953,104562099,17,"I think it is better keep the method with call back param to let the connection.h/cpp be general. There is method without call back param, which can be adopted when call back is not needed.",624267874,2017-03-07 08:37:17
20408624,114449,104585787,47,"We can always add it back if we need it in the future, so I don't worry about it for now.",597056659,2017-03-07 12:20:15
20408624,114449,104585962,4,Because it comes from std::allocator but returns to mempool so never goes back to std::allocator again.,597056649,2017-03-07 12:22:28
20408624,114449,104586168,17,"It is unused, I don't know why an unused parameter contributes to generality. Mind to be more specific?
Again, we can always add it back if we need it in the future, it is pretty easy to do with git. ",624267874,2017-03-07 12:25:35
20576318,13159450,96934102,146,"Should we add some documentation here? What is `bindings` here? I need to read `aurora job create -h` to know what it is. Considering this is an argument of an interface function, I think it is necessary to add some docs here.",600843162,2017-01-20 03:11:43
20576318,73683,96953415,146,"Good catch. I refactored `createJob` to remove the `auroraFilename`, which only applies to the CLI impl. I also renamed `bindings` to `auroraProperties` and changed the key from a string to an enum to make it's usage clear.

@objmagic I was in the proce",600843162,2017-01-20 04:43:53
20576318,13159450,96957142,10,"when `containerId` is `-1`, the entire job will also be restarted according to [here](https://github.com/twitter/heron/pull/1672/commits/a89f379ddbd6a827ab3dbca014ef8a92c985ee92#diff-c41f12543c6d4d61074654ddf05c9c51R87)",600843156,2017-01-20 05:03:36
20576318,73683,96960566,10,"Although not the preferred approach I kept that for backward compatibility, but there's no need to do that since the code will all change in lock step. I've made the change to match behavior to docs.",600843156,2017-01-20 05:19:55
20652585,73683,97236313,14,"Instead of using strings, can we use `StandardCharsets.UTF-8` for a `Locale` or `StandardCharsets.UTF-8.name()`for a string representation? This is consistency with how locales are specified in the rest of the codebase. 

Also please allow at least a fe",603034159,2017-01-23 06:29:31
20652585,13159450,97236481,14,"We can't use enum here since Java does not have such API. See: https://docs.oracle.com/javase/7/docs/api/java/io/PrintStream.html. However, I agree we can use the `.name()`.

And yes, I should allow some hours for reviewers to review. Sorry I've been sl",603034159,2017-01-23 06:33:31
20717764,2183863,97677379,5,"On the one hand, not sure whether it would affect our semantics: originally it is fail-fast but now it is dropping. On the other hand, we would also need to export metrics for this behavior; otherwise, it is hard to trace and debug.

Also, did we really",604445944,2017-01-25 07:27:30
20717764,114449,97677739,5,"Yeah, it makes sense to add a counter for dropped packets in another PR.
There is a real issue in our DC, the cause of the corruption is unknown yet.",604445944,2017-01-25 07:30:04
20717764,2183863,97679613,5,"I am still not convinced by the idea of pull request. This method returns nothing. So this failure will be no way visible to higher layer's logic: we can not handle this dropping. 
I would still prefer the fail-fast.
Could you describe more on the scena",604445944,2017-01-25 07:43:20
20718045,73683,97680752,15,"Can these instead be bound directly to the enum values themselves, instead of managed separately?
http://en.cppreference.com/w/cpp/language/enum",604448057,2017-01-25 07:51:02
20718045,114449,97682536,15,"I am not aware of any C++ syntax for this, we may achieve it by a wrapper class or something like that, but I doubt it is worth the effort to improve it. Does it hurt readability to you?",604448057,2017-01-25 08:04:11
20718045,13159450,97855730,15,"this looks useful https://aantron.github.io/better-enums/tutorial/Conversions.html#Strings and easy to include in, if we bother to use it at all...",604448057,2017-01-26 03:14:48
20718045,114449,97861319,15,"There is always some way to do it. Again, why do you think it is worth our effort to do it? For me, we only have one case so far, no need to bother a complex way to make it unnecessarily elegant. If you believe it is worth, you are welcome to do it in a s",604448057,2017-01-26 03:39:20
20718045,13159450,97862937,15,just pointing out. i have no opinion since C++ language does not have the capability of allowing people to use enum reflection easily.,604448057,2017-01-26 03:46:07
20744934,73683,97840499,15,"While you're at it, could we switch the regex check to allow 1-2 spaces between the leading `//` and the text? My IDE puts 2 spaces after `//` and it drives me nuts. I can't find a way to change it.",605177241,2017-01-26 02:04:40
20744934,73683,97840709,13,Why is this needed?,605177241,2017-01-26 02:05:44
20744934,13159450,97841143,15,"This also drives me into total nuts. I will do this.

P.S.: to change this behavior in IDE, go `Preference -> Editor -> Copyright -> Copyright Profiles`",605177241,2017-01-26 02:08:04
20744934,13159450,97841412,13,"i was attempting to use puppycrawl checkstyle to also check Python header, but failed. This is some leftover during refactoring and not needed now. will remove.",605177241,2017-01-26 02:09:15
20744934,73683,97841921,15,"What's strange is that the copyright in the profile is correctly spaced, but when it's inserted it's not...",605177241,2017-01-26 02:11:39
20744934,13159450,97845649,13,done https://github.com/twitter/heron/pull/1679/commits/927772d44cc601998c337ae2bac59732c2a176db,605177241,2017-01-26 02:29:17
20744934,13159450,97845655,15,done https://github.com/twitter/heron/pull/1679/commits/927772d44cc601998c337ae2bac59732c2a176db,605177241,2017-01-26 02:29:19
20921263,73683,98771042,5,"Let's put null in there instead of ""null"".",609820669,2017-02-01 05:10:34
20921263,32022953,98774362,5,updated,609820669,2017-02-01 05:26:35
20921263,2183863,99036492,20,"Check entry.getKey() too since the key can also be null.
https://docs.oracle.com/javase/7/docs/api/java/util/Map.html#put(K,%20V)",611041125,2017-02-02 09:20:28
20921263,32022953,99037030,20,done,611041125,2017-02-02 09:25:16
20937498,32022953,98807188,53,could you add comment to this field - what this field is for and what key/value in the map means,609942978,2017-02-01 08:43:22
20937498,32022953,98807948,18,is 10 seconds proper?,609942978,2017-02-01 08:49:24
20937498,32022953,98813081,4,why do we remove this callback?,609942978,2017-02-01 09:31:29
20937498,114449,98961492,53,Will add it.,609942978,2017-02-02 02:30:30
20937498,114449,98962369,18,"It is just a copy of PROCESS_METRICS_FREQUENCY. I understand you may suggest to expose it in config file, but we already have too many config's...",609942978,2017-02-02 02:34:30
20937498,114449,98962623,4,"Because we don't need it any more, as I already describe in this PR, we move the code out of hot path",609942978,2017-02-02 02:35:45
21027032,73683,99437364,27,This will be refactored out in a follow-up that addresses defaults.,611708355,2017-02-04 06:39:44
21027032,3201045,99408205,27,Just wondering if this is needed?,611708355,2017-02-04 03:41:18
21045156,32022953,99461297,7,loadClass() throws ClassNotFoundException. why do we throw it manually?,611840243,2017-02-04 15:03:27
21045156,73683,99516201,7,"loadClass throws NullPointerException when passed null. The calling classes catch ClassNotFoundException but not NPE. It a slight semantic stretch to throw CNFE in this case, but it seems like a more practical solution than throwing NPE or adding a new ex",611840243,2017-02-06 12:32:03
21045156,13159450,99480065,7,Thanks. I didn't review carefully here. @billonahill do you have any particular reason to add this check?,611840243,2017-02-05 10:41:19
21069973,32022953,99711746,58,record() increases denominator_ by 1. is it averaged by invocation count or by period 10 seconds? ,612481463,2017-02-07 07:27:55
21069973,2183863,99744735,58,sum of metrics value/ sum of invocation count,612481463,2017-02-07 12:40:01
21069973,2508294,99754296,58,"after long run, the mean metric becomes obtuse. 
for example, numerator_=10\*1000, denominator_=1000, the mean is 10. 
then, 20 value pulse 100 times only lead to 0.9 increase on the mean. 
numerator_=10\*1000+20\*100, denominator_=1000+100, the mean i",612481463,2017-02-07 14:40:59
21069973,2183863,99914015,58,"@huijunw At the start of every metrics-collection-cycle, it would reset the value as 0; then at the end of every metrics-collection-cycle, the metric value would be: sum of metrics value every time recorded/ sum of invocation count => the average value of",612481463,2017-02-08 03:57:09
21069973,32022953,99962644,58,"i saw the reset 0 in MeanMetric::GetAndReset() and the cycle set in config 'heron.metrics.export.interval.sec: 60'. 
+1",612481463,2017-02-08 08:03:01
21069973,16405288,99755312,58,"hey @huijunwu. What i'd like to have is the average queue length using the last N one second samples. For example If i want to ckeck this every minute, then I need the average over 60 samples (each sample taken every sec). Maybe I didn't understand the co",612481463,2017-02-07 14:52:09
21075657,73683,99955245,22,psf should be TITLE_NAMES,612558708,2017-02-08 07:14:35
21075657,32022953,99964740,22,+1,612558706,2017-02-08 08:18:42
21075657,13159450,99969829,22,what do you mean?,612558706,2017-02-08 08:57:22
21075657,32022953,99969978,22,looks good to me. it is expected as the PR description.,612558706,2017-02-08 08:58:35
21075657,13159450,99970088,22,you can add a reply next time instead of making an inline comment.,612558706,2017-02-08 08:59:15
21118938,13159450,100132189,40,what are the tokens and recursive expansion here...?,612844239,2017-02-09 02:15:40
21118938,73683,100134686,40,"Each time the method is invoked we iterate through each config value and do round of pattern substitution on the value, but substituting patterns can in the value can result in more tokens. For example `${HERON_BIN}/heron-executor` can be changed to `${HE",612844239,2017-02-09 02:26:57
21118938,3201045,100577801,147,"If sandbox is not needed any more, do we need this?",614306788,2017-02-11 01:01:53
21118938,3201045,100578136,9,stmgrBinary?,614306788,2017-02-11 01:03:44
21118938,3201045,100576750,40,@billonahill - the previous version was doing one level substitution and it was generic.,612844239,2017-02-11 00:56:59
21118938,3201045,100574808,5,instead of 'toLocalMode' - can we call 'toClientMode' or something better on those lines.,614306788,2017-02-11 00:48:17
21118938,3201045,100574440,14,is there a better name than 'remote' - something like 'toSandboxMode' or 'toContainerMode' - something on the lines.,614306788,2017-02-11 00:46:29
21118938,3201045,100575547,7,Why this requires true?,614306788,2017-02-11 00:51:55
21118938,3201045,100575211,45,it should be stmgrBinary?,614306788,2017-02-11 00:50:20
21118938,73683,100584702,14,"Yeah, I don't love the terminology here of local, remote or sandbox and would like to change it. It's really about how Heron is installed. It's either installed on the system, or bundled in a distribution. I was thinking about ""installed"" and ""bundled"" mo",614306788,2017-02-11 01:37:22
21118938,73683,100584937,5,Agreed I don't like local mode. Client is also overloaded and could cause confusion. Let's discuss in the similar comment above.,614306788,2017-02-11 01:38:40
21118938,73683,100585727,7,True says to initialize the Config with default values. See `Config.Builder.create(loadDefaults)` which this call delegates to.,614306788,2017-02-11 01:42:49
21118938,3201045,100573999,33,it should be stmgrBinary?,614306788,2017-02-11 00:44:19
21118938,73683,100587143,45,fixed,614306788,2017-02-11 01:50:31
21118938,73683,100587200,147,fixed,614306788,2017-02-11 01:50:41
21118938,73683,100587123,33,fixed,614306788,2017-02-11 01:50:23
21118938,73683,100587213,9,fixed,614306788,2017-02-11 01:50:45
21118938,3201045,100590718,14,For remote - 'toClusterMode' is more appropriate I think.,614306788,2017-02-11 02:08:58
21314910,73683,100863158,26,"Instead of using int, can we change this to `ByteAmount` and drop '.mb' from the key value (see https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/Key.java#L104)? We could then use `ByteAmount` everywhere and then",617425888,2017-02-14 02:32:28
21314910,6334077,100941830,26,"@billonahill - Thanks for reviewing. It will be great if we change `driver.memory.mb` from int to `ByteAmount`. I would like to send another PR for this. BTW, dropping '.mb' might not good for users cause they need to know the unit of this parameter.",617425888,2017-02-14 09:26:48
21347979,73683,101123143,4,"While you're here would you please remove `public` from all these constants (and the class) and remove GROUP_KEY and VERSION_KEY, which are unused. #cruftslayer",617615130,2017-02-15 03:35:29
21347979,73683,101122719,4,woot!,617615130,2017-02-15 03:33:41
21347979,73683,101122670,41,"Does the caller ever need an InputStream for anything other than creating a Map<String, Object>? If not, let's just return a  Map<String, Object> here.",617615130,2017-02-15 03:33:30
21347979,73683,101121700,35,please change to a class-level psf String.,617615130,2017-02-15 03:29:25
21347979,73683,101122205,47,ALL_CAPS is for class-level psf Strings. These should either be moved to class level or just passed directly to createTempFile without making a one-time use string variable.,617615130,2017-02-15 03:31:32
21347979,13159450,101125188,41,because I also want to test loading from InputStream here: https://github.com/twitter/heron/pull/1710/files/4f721caaa991ff8c3cc156ebab9ce9b294993720#diff-535d4127d634ce5fd544311ba8e7fb2cR63,617615130,2017-02-15 03:44:15
21418480,3201045,101399196,4,Some comments - will be nice.,618937143,2017-02-16 06:25:35
21418480,1278336,101401960,4,"I would be just repeating this comment,

https://github.com/tc-dc/heron/blob/ed0e25cb71dd882c159ef4bbcf1fe634a891667c/heron/metricsmgr/src/java/com/twitter/heron/metricsmgr/sink/WebSink.java#L74",618937143,2017-02-16 06:40:03
21418480,2183863,101405341,32,"Can we merge L202 and L203 into one line:
sourceCache = (Map<String, Double>) sourceObj;

",618937143,2017-02-16 06:57:47
21418480,1278336,101410326,32,"Sadly we cannot. Apparently you can not annotate a definition if the variable is not also assigned.
e.g. 
```
@SuppressWarnings(""unchecked"")
Map<String, Double> sourceCache;
Object sourceObj = metricsCache.getIfPresent(source);
if (sourceObj instanc",618937143,2017-02-16 07:26:53
21418480,32022953,101423342,39,does this override the old metric of the same name in the sourceCache?,618937143,2017-02-16 08:58:29
21418480,1278336,101535215,39,"Yes, it does. Its the standard `.putAll` method from the Map interface. 
```
public void putAll(Map<? extends K,? extends V> m)
Copies all of the mappings from the specified map to this map. These mappings will replace any mappings that this map had fo",618937143,2017-02-16 22:50:16
21418480,2508294,101541788,39,so it ignores the metric type and caches only the latest one metric,618937143,2017-02-16 23:16:57
21418480,1278336,101552185,39,"I'm not sure what you mean with ignoring the metric type. 

Lets say we have two records `record_1` and `record_2` with this yaml representation:
```
record_1:
  source: source_1
  metrics: 
    metric_1: 1
    metric_2: nop
    metric_3: 3
reco",618937143,2017-02-16 23:54:10
21418480,32022953,101603275,39,i see. thank you,618937143,2017-02-17 03:17:31
21418480,2183863,101886552,32,sounds good.,618937143,2017-02-18 14:45:57
21422612,13159450,101418581,25,is this TODO addressed?,619013354,2017-02-16 08:22:57
21422612,73683,101419495,25,"We now have a mechanism for defaults and we use it for 2 config keys. @maosongfu do you think that's enough for #970 or should we also be adding defaults for other key values. You comment was initially above keys that now have a default, so maybe we're ok",619013354,2017-02-16 08:29:17
21527631,32022953,102608544,4,why not put it in main.py?,623520255,2017-02-23 08:10:54
21527631,13159450,102608723,4,because this variable is also used in other modules. ,623520255,2017-02-23 08:12:08
21527631,32022953,102608730,96,can we check the invariant in the constructor?,623520255,2017-02-23 08:12:13
21527631,13159450,102608900,96,makes sense. will do.,623520255,2017-02-23 08:13:34
21527631,73683,103279279,44,Why is render a static method and not an instance method on Response? The latter seems more natural.,630778021,2017-02-28 02:40:58
21527631,73683,103279092,96,Also please provide more context in the error message.,623520255,2017-02-28 02:40:01
21527631,73683,103277504,18,"Is there some python magic enforcing this? If not, let's explicitly check the state.",630778021,2017-02-28 02:32:43
21527631,73683,103278581,28,do_log and log_context seem like they are intended to be private. If that's the case please move them to the bottom and prepend `_` to the method name to make that clear.,630778021,2017-02-28 02:37:34
21527631,73683,103280741,78,"In this method you're reading stderr, polling if None and then readying stdout, then polling if None. Are their chances for raceconditions here due to state changing on proc between calls? Also are there edge conditions possible when both stderr and stdou",630778021,2017-02-28 02:47:41
21527631,73683,103276951,17,Why add the conditional? Does `shutil.rmtree(os.path.dirname(cur_file))` fail if `cur_file` is a directory?,630778021,2017-02-28 02:30:08
21527631,73683,103275021,42,In this and other severe logs (below) can we include the process string in the message.,630778021,2017-02-28 02:21:31
21527631,73683,103275851,1,`verifyTopology` should really be fixed to return `void` and throw a better exception that `RuntimeException` (with a better message) but that's a fix for another PR...,630778021,2017-02-28 02:25:17
21527631,73683,103280284,53,"This `isinstance` of list or Response seems like some python jank. Are there places where lists of Response objects are being passed in? If not, we should remove this.",630778021,2017-02-28 02:45:36
21527631,73683,103278074,41,can we also log `resp` here?,630778021,2017-02-28 02:35:19
21527631,73683,103278192,39,should include a comment re why we don't log here.,630778021,2017-02-28 02:35:55
21527631,73683,103276548,53,Why does this return the error string and not the response object containing the error string?,630778021,2017-02-28 02:28:24
21527631,73683,103275084,60,s/Run/Running/,630778021,2017-02-28 02:21:51
21527631,13159450,103287583,42,what is process string? do you mean the command? we already do info-level logging of command [here](https://github.com/twitter/heron/pull/1726/files/4c46bb49aeee15225a0a16b6fec5dc14037b5ceb#diff-49b803240c7fae81aca5e36ac0559735R111). ,630778021,2017-02-28 03:17:43
21527631,13159450,103290238,17,"if it is a directory, we remove the directory. If it is a temporary file, we remove the entire temporary directory that contains this temporary file.",630778021,2017-02-28 03:29:04
21527631,73683,103291163,42,"Yes the command. This is always good to log in the exception so you don't have to dig through previous logs to find all others commands run, and then guess which one failed.",630778021,2017-02-28 03:32:51
21527631,73683,103291371,17,"I follow the desired functionality, just not the need for the if/else. Without it would we not get the desired functionality?",630778021,2017-02-28 03:33:51
21527631,13159450,103293533,17,"> Does shutil.rmtree(os.path.dirname(cur_file)) fail if cur_file is a directory

Yes. See below for API documentation. For `/usr/lib`, you'll get `/usr`.

> `os.path.dirname(path)`
> Return the directory name of pathname path. This is the first eleme",630778021,2017-02-28 03:42:58
21527631,13159450,103334263,53,most functions return list of responses because for some reason I don't know we [can launch multiple topologies](https://github.com/twitter/heron/blob/master/heron/tools/cli/src/python/submit.py#L131). [help](https://github.com/twitter/heron/blob/master/h,630778021,2017-02-28 06:54:23
21527631,13159450,103334429,44,no particular reason. I'll make it an instance method.,630778021,2017-02-28 06:55:22
21527631,73683,103334534,53,Forcing all to use a list is also clunky. I'd say leave it as is for now.,630778021,2017-02-28 06:55:53
21527631,13159450,103335003,41,i don't understand. you mean log `succ_context` and `err_context`? why?,630778021,2017-02-28 06:58:16
21527631,73683,103345999,41,"Not necessarily, no. Just something to give the user more actionable info than what they'd have with a message like ""Unknown status type of value foo"". If they got that message and reported it to us we'd have no idea what that mean and or what triggered i",630778021,2017-02-28 08:07:25
21527631,13159450,103516013,44,`render` could also render a list of responses so it should be static method.,630778021,2017-03-01 02:00:55
21527631,13159450,103517909,78,"The reason I implemented in this way is that all Java logging go to stderr and exception message/dry-run response go to stdout. That said, stderr always go before stdout (I am using `always` but not 100% sure this is the case). I may follow [this answer](",630778021,2017-03-01 02:11:23
21527631,13159450,103798498,78,i'm sticking with my original approach.,630778021,2017-03-02 05:52:09
21527631,13159450,104087760,17,"if there is no further question, I'll mark this as resolved.",630778021,2017-03-03 12:39:24
21527631,13159450,104087780,4,mark as resolved.,623520255,2017-03-03 12:39:40
21527631,13159450,104088221,114,This function needs very careful review... @billonahill ,636381316,2017-03-03 12:46:10
21527631,73683,104210876,167,pls remove \n,636381316,2017-03-04 02:13:52
21527631,73683,104212655,114,"This logic seems sound if it works in your tests.

In the future, best to avoid making code changes _and_ doing a file rename at the same time, since there's no longer a diff to review.",636381316,2017-03-04 02:23:34
21527631,73683,104210057,96,can we not inject \n here?,636381316,2017-03-04 02:09:37
21527631,73683,104208961,30,"Why does this method call require passing a StringBuilder that the caller never uses? Can we simplify the API to not require this here, maybe with another signature?",636381316,2017-03-04 02:03:36
21527631,73683,104210247,102,s/message/messages/,636381316,2017-03-04 02:10:38
21527631,73683,104210502,98,"pls clarify that we're combining the two into stderr, which I think is the case.",636381316,2017-03-04 02:11:58
21527631,73683,104211118,195,here and below we're passing an unused StringBuilder. can we refactor to not require that?,636381316,2017-03-04 02:15:16
21527631,73683,104210988,184,pls include host and port,636381316,2017-03-04 02:14:30
21527631,73683,104208650,5,Inserting line breaks in log entries can cause pains when reading the logs. Can we remove the \n?,636381316,2017-03-04 02:01:58
21527631,73683,104209389,54,Why write directly to stderr here instead of LOG like we do below?,636381316,2017-03-04 02:05:53
21527631,73683,104209944,80,why do we no longer start the thread? This seems unexpected from the callers point of view. If we don't start it we need to clarify in the javadocs how to properly use this method.,636381316,2017-03-04 02:08:57
21527631,73683,104210735,116,"this comment talks about multiple buffers, which we no longer have below. please update to reflect new behaviour",636381316,2017-03-04 02:13:12
21527631,73683,104208466,7,Funny I just made the same change on my branch. :) You need a return statement here.,636381316,2017-03-04 02:00:59
21527631,73683,104209714,68,we should clarify in the javadocs how this method behaves w.r.t. logging and stderr.,636381316,2017-03-04 02:07:38
21527631,13159450,104226170,30,only internal uploader tool needs saves all redirected I/O using string builder.,636381316,2017-03-04 03:32:50
21527631,13159450,104226294,54,you are right. we should use LOG here.,636381316,2017-03-04 03:33:30
21527631,13159450,104227510,30,adding another signature actually means we will add three or four more signatures... https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/utils/ShellUtils.java#L63,636381316,2017-03-04 03:39:44
21527631,13159450,104229814,80,it will be started later. ,636381316,2017-03-04 03:51:31
21527631,13159450,104230530,195,"this is used for internal uploader tool. if you ``--json`` to internal uploader tool, it will return a JSON result and we want to catch that",636381316,2017-03-04 03:54:58
21527631,13159450,104230786,7,fixed.,636381316,2017-03-04 03:56:20
21527631,13159450,104230965,54,fixed,636381316,2017-03-04 03:57:11
21527631,13159450,104230983,68,fixed,636381316,2017-03-04 03:57:17
21527631,13159450,104231009,96,fixed,636381316,2017-03-04 03:57:25
21527631,13159450,104231014,98,fixed,636381316,2017-03-04 03:57:27
21527631,13159450,104231046,102,fixed,636381316,2017-03-04 03:57:37
21527631,13159450,104231056,116,fixed,636381316,2017-03-04 03:57:41
21527631,13159450,104231077,167,fixed,636381316,2017-03-04 03:57:45
21527631,73683,104256203,52,can we name builder stdout or output or something more descriptive?,636960238,2017-03-04 06:33:34
21527631,73683,104256004,5,space after : ,636960238,2017-03-04 06:32:08
21527631,73683,104256534,183,space after : ,636960238,2017-03-04 06:35:40
21527631,73683,104256412,80,please clarify in the javadocs that this method doesn't actually run anything. We should rename the method to make that very obvious too actually. Maybe createAsyncProcessThread?,636381316,2017-03-04 06:35:03
21527631,13159450,104258481,183,https://github.com/twitter/heron/pull/1726/commits/ee0b4f2d4ca72eb0a133dcf67670399f50a17287,636960238,2017-03-04 06:49:13
21527631,13159450,104258498,52,https://github.com/twitter/heron/pull/1726/commits/ee0b4f2d4ca72eb0a133dcf67670399f50a17287,636960238,2017-03-04 06:49:20
21527631,13159450,104258506,5,https://github.com/twitter/heron/pull/1726/commits/ee0b4f2d4ca72eb0a133dcf67670399f50a17287,636960238,2017-03-04 06:49:24
21549571,6377806,102301564,16,"Same as above, remove `MB` from method name?",628200585,2017-02-22 03:54:09
21549571,6377806,102301368,15,Remove `mb` from method name since ByteAmount is generic?,628200585,2017-02-22 03:53:17
21549571,6377806,102301066,4,"Instead of adding a utility method for each unit, I think adding a unit to the existing method would be better. For e.g. `getByteAmount(Object o)` will become getByteAmount(Object o, ByteAmountUnit unit). This is same as the usage pattern of `java.util.co",628200585,2017-02-22 03:52:04
21549571,6334077,102359665,15,Agree,628200585,2017-02-22 08:56:58
21549571,6334077,102359696,16,will do,628200585,2017-02-22 08:57:07
21549571,6334077,102359965,4,Good point~,628200585,2017-02-22 08:58:57
21549571,6334077,102362912,4,@billonahill - It seems we don't have `ByteAmountUnit` class currently. Do you think it is a good idea if we add a new class in `c.t.h.common.basics` in this PR? ,628200585,2017-02-22 09:19:40
21549571,13159450,102363928,4,@mycFelix Bill is on vacation so he may not have spare time to reply you. We can definitely add `ByteAmountUnit` (and as a enum class to keep things simple). Another approach is to make [`2048`](https://github.com/twitter/heron/pull/1728/files#diff-7a5b4a,628200585,2017-02-22 09:27:07
21549571,13159450,102364667,4,"@mycFelix actually, now I think @ashvina's suggestion is better. It would be nice to add a enum class `ByteAmountUnit` in the same style of [`SystemConfigKey`](https://github.com/twitter/heron/blob/master/heron/common/src/java/com/twitter/heron/common/con",628200585,2017-02-22 09:33:03
21549571,6334077,102365529,4,@objmagic - Understood. Thank you for your suggestion. ,628200585,2017-02-22 09:40:08
21549571,13159450,102538231,31,"I'm confused here. Shouldn't `DRIVER_MEMORY` accept value of type int, according to [reef](https://github.com/apache/reef/blob/master/lang/java/reef-common/src/main/java/org/apache/reef/client/DriverConfiguration.java#L59)?",629197885,2017-02-23 02:37:04
21549571,6334077,102631018,31,"To be honest, it make me confuse too. I didn't notice that...",629197885,2017-02-23 11:10:10
21549571,6334077,102632116,31,@objmagic - cast it to int,629197885,2017-02-23 11:20:18
21549571,13159450,102632270,31,@mycFelix I now think I am not the right person to review this PR. You can think about [Bill's review](https://github.com/twitter/heron/pull/1728#pullrequestreview-23143032) and wait for @ashvina's comment.,629197885,2017-02-23 11:21:55
21549571,6334077,102632642,31,@objmagic - Sure~,629197885,2017-02-23 11:26:28
21549571,13159450,102632130,31,I don't think you can just cast here...?,629197885,2017-02-23 11:20:27
21549571,6377806,104805782,11,I think it would be useful to add javadocs for these overloaded methods.,630133321,2017-03-08 07:15:50
21746007,3201045,103082443,63,Remove extra log information that you introduced for debugging.,631932698,2017-02-26 00:37:57
21746007,3201045,103082445,65,ditto,631932698,2017-02-26 00:38:07
21746007,114449,107078546,70,Use std::to_string().,646099666,2017-03-21 12:56:19
21746007,114449,107078646,66,Use 'auto',646099666,2017-03-21 12:57:23
21746007,73683,107184090,33,please elaborate on what should and should not be included in /runtimestate,646099666,2017-03-21 22:18:26
21746007,73683,107184539,54, this debug message doesn't seem useful,646099666,2017-03-21 22:20:05
21746007,73683,107189605,26,"Why do we still need this endpoint? I thought the plan was to not add it, but instead use /runtimestate to serve this info. Can we remove this?",646099666,2017-03-21 22:36:49
21746007,73683,107183428,32,"please elaborate on what should and should not be included in /metadata
",646099666,2017-03-21 22:16:01
21746007,73683,107183917,52,prepend something contextual log string before outputting a stack trace,646099666,2017-03-21 22:17:49
21746007,13159450,107238581,70,"`std::string(length_str)`? Fails to compile using Clang (Apple LLVM version 8.0.0 (clang-800.0.38)).

Error message:
```
ERROR: .../heron/tmaster/src/cpp/BUILD:3:1: C++ compilation of rule '//heron/tmaster/src/cpp:tmaster-cxx' failed: cc_wrapper.sh fa",646099666,2017-03-22 01:30:54
21746007,114449,107258846,70,**to_**string(),646099666,2017-03-22 02:56:07
21746007,13159450,107266489,70,oh my mad. definitely typo,646099666,2017-03-22 03:29:23
21746007,73683,108020062,1,"IIRC we decided that executionstate would be deprecated in favor of /metadata and /runtimestate. Is that correct? If so would you clarify that in the executionstate class, so it's clear to other readers why we have duplicate info returned by multiple endp",650891239,2017-03-25 06:59:19
21746007,13159450,108021160,1,imo deprecating execution state could be done in another PR,650891239,2017-03-25 07:16:14
21746007,13159450,108020346,1,"heron-ui is using it. If necessary I will refactor heron-ui in another PR. In the meantime, let us keep this API here.",650891239,2017-03-25 07:03:56
21746007,73683,108022322,1,"I wasn't suggesting removing/refactoring it in this PR, just putting a comment describing that it's slated to be removed. That way if it takes a while to remove people readying the code will understand the duplication.",650891239,2017-03-25 07:38:35
21746007,13159450,108023763,1,"Updated: https://github.com/twitter/heron/pull/1734/commits/ee1a73010632b39572e6c53c1299c41545e80637

Also see: https://github.com/twitter/heron/issues/1779",650891239,2017-03-25 08:07:44
22071595,13159450,104757162,4,some leftover here?,639830057,2017-03-08 03:31:11
22071595,73683,104758140,4,fixed.,639830057,2017-03-08 03:35:02
22071595,2183863,104804125,7,"Should we use heron raw api directly @kramasamy 

Even if we try to use heron api in examples, should we add a new example rather than reuse this ExclamationTopology?",639863625,2017-03-08 07:05:27
22103142,3201045,104859509,12,"Instead of LOG(ERROR), use PLOG(ERROR) and you won't need strerror(errno)",639974036,2017-03-08 15:37:38
22103142,114449,104982801,12,Good point. Never know this API before...,639974036,2017-03-09 02:10:11
22103447,73683,104810435,22,"It would be better to| declare this in the throws clause and not handle it, since it should trigger a test failure.",639980093,2017-03-08 07:45:16
22122271,73683,104970496,5,"adding 'of' would mean we should make components singular. Instead though, we can change this to ""can self-adjust in the event that a component lags.""",640396617,2017-03-09 01:16:23
22142505,3201045,105099383,6,"Instead of multiplying by 1024* 1024 - every time, can you define a constant in one of the include file called 

const int MB = 1024 * 1024;

somewhere in the include file",641022548,2017-03-09 15:17:32
22142505,3201045,105099781,180,This is not 100 MB it should be 100 * 1024 * 1024,641022548,2017-03-09 15:21:31
22142505,114449,105229238,180,"This is not my code, it shows up as diff context... Also, the 100M there might mean 100 million rather than 100 megabytes.",641022548,2017-03-10 01:59:21
22142505,114449,105229363,6,"Yeah, we can do it in a separate PR, because there are multiple places using the same.",641022548,2017-03-10 01:59:59
22142505,3201045,105229487,180,got it. my bad.,641022548,2017-03-10 02:00:29
22142505,2183863,105288450,23,"Should we pass high_watermark and low_watermark from constructor, or similar to max_packet_size, reading config inside CreateClient(...) method?

On the one hand, it is not necessary to change the signature of a class's constructor. On the other hand, I",641022548,2017-03-10 06:36:51
22142505,114449,105289127,23,"We have to, because the stmgr unit test cases don't want to read from config, they set these values by themselves.",641022548,2017-03-10 06:40:47
22142505,2183863,105290622,23,"Just wondering: how does the ""max_packet_size"" config work?",641022548,2017-03-10 06:49:27
22142505,114449,105295991,23,"1) StMgr() doesn't accept NetworkOptions as parameter, max_packet_size is passed in NetworkOptions for those who accept it.

2) stmgr unit tests want 2 different values in different tests, so you have to provide at least 2 different configs if you reall",641022548,2017-03-10 07:22:15
22142505,2183863,105301634,23,OK Sounds good to me.,641022548,2017-03-10 07:59:30
22142505,3201045,105302192,6,can you please open an issue to track this?,641022548,2017-03-10 08:04:17
22142505,114449,105303606,6,Done: https://github.com/twitter/heron/issues/1758,641022548,2017-03-10 08:15:31
22305353,13159450,105760036,17,"If I understand correctly, using `amount` for argument name instead of `bytes` makes better sense? (`100_MB` means _one hundreds_ megabytes. )",644339369,2017-03-14 03:14:40
22305353,114449,105770627,17,"Yeah, or change it to 'megabytes'.",644339369,2017-03-14 04:01:58
22305353,32022953,105772489,70,'xxxxMb() * y_MB' looks like 'byte * byte = byte^2',644339369,2017-03-14 04:09:54
22305353,114449,105773203,70,"If you want to interpret literally, yeah.",644339369,2017-03-14 04:13:23
22346888,32022953,106053837,20,? d->set_value(std::to_string(total_time_msecs_));,645223050,2017-03-15 06:31:30
22346888,114449,106266725,20,We could do that but need to move 'total_time_msecs_ = 0' down.,645223050,2017-03-16 02:52:34
22531661,3201045,106953570,5,Again switching of arguments?,649109344,2017-03-20 23:49:05
22531661,3201045,106953349,5,Why the need to switch args for this one and several subsequent functions?,649109344,2017-03-20 23:48:16
22531661,114449,106955129,5,"Please read the description of this PR: ""The only thing needs to note is that template parameter pack must be the last so we have to reorder the arguments for callback1.""",649109344,2017-03-20 23:55:04
22531661,3201045,106956749,5,Got it!,649109344,2017-03-21 00:01:04
22556953,73683,122323750,6,Why is 'sandbox' in the new arg names? Can we remove that?,714901216,2017-06-16 05:03:22
22556953,73683,122328214,63,please add unit tests for the new logic in this class,714901216,2017-06-16 05:30:30
22556953,73683,122327398,6,why are these being hard coded here and why use strings to represent integers?,714901216,2017-06-16 05:25:04
22556953,73683,122327623,6,What are the acceptable values for autoHeal and autoHealInterval and can these be Duration?,714901216,2017-06-16 05:26:15
22556953,32022953,122505196,6,updated,714901216,2017-06-17 01:28:51
22556953,32022953,122505210,6,updated,714901216,2017-06-17 01:28:56
22556953,32022953,122505235,6,updated,714901216,2017-06-17 01:29:05
22556953,3201045,122181898,47,@huijunw - what does the --secret do? Do we need only when the restart back pressure is enabled? or it can be enabled in all the cases?,714901216,2017-06-15 18:34:19
22556953,3201045,122182298,5,I would recommend to use --config-property in heron submit which is a generic mechanism which is already in place for passing feature specific parameters.,714901216,2017-06-15 18:36:50
22556953,3201045,122573169,4,No changes in this file.,716528041,2017-06-18 00:29:11
22556953,3201045,122573107,6,No change required.,716528041,2017-06-18 00:27:00
22556953,3201045,122573068,44,If clause is not needed since the secret could be enabled by default in all cases.,716528041,2017-06-18 00:25:04
22556953,3201045,122573178,5,no changes in this file,716528041,2017-06-18 00:29:22
22556953,3201045,122573117,6,No change here also.,716528041,2017-06-18 00:27:20
22556953,3201045,122573051,34,Not needed.,716528041,2017-06-18 00:24:33
22556953,3201045,122573133,118,Logic should move to Health Manager process.,716528041,2017-06-18 00:28:08
22556953,3201045,122573044,23,This is not needed.,716528041,2017-06-18 00:24:14
22556953,3201045,122573023,1,"Please move this to heron_internals.yaml.

```
################################################################################
# To autorestart containers, if they go into unrecoverable back pressure
#################################################",716528041,2017-06-18 00:23:11
22556953,3201045,122573215,34,No changes in this file as well.,716528041,2017-06-18 00:29:40
22556953,3201045,122573165,162,Logic should move to HealthManager process,716528041,2017-06-18 00:28:45
22556953,3201045,122182455,4,All the parameter code passing will be gone - if --config-property is used.,714901216,2017-06-15 18:37:56
22556953,3201045,122573086,15,this is not needed.,716528041,2017-06-18 00:25:50
22556953,3201045,122573038,7,This block of code is not needed.,716528041,2017-06-18 00:23:54
22556953,3201045,122573125,4,No changes required in the file,716528041,2017-06-18 00:27:45
22556953,3201045,122573102,6,"0, 20 is not needed.",716528041,2017-06-18 00:26:48
22556953,3201045,122573096,10,Shared secret with HeathManager,716528041,2017-06-18 00:26:27
22556953,3201045,122573217,6,No changes in this file,716528041,2017-06-18 00:29:50
22556953,3201045,122573110,19,no change required.,716528041,2017-06-18 00:27:09
22556953,3201045,122181682,36,"If not, there is some kind of white list that can be include the back pressure metrics. I already see the back pressure metrics in UI.",714901216,2017-06-15 18:32:44
22556953,3201045,122181583,36,"@huijunw - why is this metrics port needed? Tmaster is already receiving all the metrics, correct?",714901216,2017-06-15 18:32:01
22576737,2183863,107075456,17,Same as the comment above.,649987880,2017-03-21 12:17:29
22576737,2183863,107075430,5,"Can we also log down the stmgr-id here? like ""Another stmgr {stmgr-id} exists at ....""",649987880,2017-03-21 12:17:11
22576737,114449,107081296,5,Will add it.,649987880,2017-03-21 13:27:16
22576737,114449,107222878,5,"Hmm, actually we already have a log for stmgr-id:

`LOG(INFO) << ""Got a register stmgr request from "" << stmgr_id << std::endl;`

So I don't think we need to log it again.",649987880,2017-03-22 00:34:17
22576737,13159450,107228219,5,@congwang agree with @maosongfu. add id so when we grep it we can also see the id,649987880,2017-03-22 00:52:33
22576737,114449,107231613,5,@objmagic Why not turn on -B for your grep? ;),649987880,2017-03-22 01:04:32
22576737,13159450,107232138,5,ok..,649987880,2017-03-22 01:06:33
22576737,2183863,107269804,5,"@congwang It is better to have a log having all necessary info self-contained, than relying on earlier logs. It is possible that people mistakenly hurt this log without knowing it.",649987880,2017-03-22 03:43:12
22576737,114449,107271369,5,"@maosongfu It is right before this log, I don't know why it is hard for you to find it... At least I don't rely on one-line log for debugging, I read its context too.",649987880,2017-03-22 03:49:55
22576737,2183863,107271779,5,"Also one mirror comment, (maybe not relate to this pr): when logging ""Got a register stmgr request from "", it is better to log ""Got a register stmgr request from {stmgr-id} at {host:port}""",649987880,2017-03-22 03:51:28
22576737,2183863,107272282,5,"@congwang Yeah we read context for debugging. My concern is: people can change/remove the log ""Got a register stmgr request from ..."" without knowing this change will affect another log.",649987880,2017-03-22 03:53:45
22576737,13159450,107272828,5,"Also, shall we tell everyone there is `grep -B`? What if people don't know? Do you just tell them to RTFM? Just how hard is it to add a stream id? If you do not do it, I will do it in another PR.",649987880,2017-03-22 03:56:05
22576737,3201045,107965301,8,@congwang - can you print the stmgr id as well?,649987880,2017-03-25 01:02:01
22576737,3201045,107965421,17,@congwang - here also please print the stmgr id,649987880,2017-03-25 01:02:39
22720808,114449,108027423,23,No need newline at the end.,651081594,2017-03-25 10:56:41
22720808,114449,108027415,22,"No need c_str() here, operator<< works well with string",651081594,2017-03-25 10:56:15
22720808,32022953,108028696,23,done,651081594,2017-03-25 12:26:51
22720808,32022953,108028693,22,done,651081594,2017-03-25 12:26:47
22763872,32022953,108231246,27,"Does the 'duration' mean time window [now-duration, now]?",653457144,2017-03-28 00:35:08
22763872,32022953,108229909,29,Is the return value passed to IDiagnoser?,653457144,2017-03-28 00:29:32
22763872,32022953,108232682,43,we may provide a default comparison for 'Double value;',653457144,2017-03-28 00:40:41
22763872,32022953,108226969,39,why is it 'default'?,653457144,2017-03-28 00:17:10
22763872,32022953,108233282,23,who is responsible to execute the Action object? IHealthPolicy.execute()?,653457144,2017-03-28 00:42:59
22763872,32022953,108232212,37,why do we need asInt()?,653457144,2017-03-28 00:38:46
22763872,32022953,108242955,24,"It may be hard to use 'duration'. 
The metric values are rarely same between two consecutive observations.",653457144,2017-03-28 01:22:36
22763872,32022953,108243782,20,which part of this class is abstract?,653457144,2017-03-28 01:25:40
22763872,32022953,108244913,25,I saw Collection used in the other files. Why Set here? Any reason?,653457144,2017-03-28 01:30:16
22763872,32022953,108247988,23,ComponentSymptom/InstanceSymptom is  a Collection of MetricsInfo that has timestamp and duration. What is the relation between timestamp/duration in MetricsInfo and observedAt/duration here?,653457144,2017-03-28 01:42:18
22763872,32022953,108249940,40,Does it imply there should be a 'name'->'null' pair for each metric in the collection?,653457144,2017-03-28 01:50:20
22763872,32022953,108252300,25,What if there are several data points in the duration? I suggest it return a Collection of MetricsInfo,653457144,2017-03-28 02:00:33
22763872,32022953,108255752,26,why do we use PackingPlan rather than physical plan?,653457144,2017-03-28 02:16:25
22763872,32022953,108270652,20,"I assume 
step 1, ISymptomDetector => Symptom
step 2, IDiagnoser => Diagnosis (Set<Symptom>)

Why not put step 1 & 2 together? What do we separate the detecting process into 2 procedures?",653457144,2017-03-28 03:23:38
22763872,32022953,108271256,25,"how does BaseHeronDiagnoser get the Symptom from BaseHeronDetector?
should we inject a BaseHeronDetector obj?",653457144,2017-03-28 03:26:15
22763872,32022953,108271614,25,should we inject a BaseHeronDiagnoser and a BaseHeronResolver here so that the BaseHeronPolicy.execute() can access them?,653457144,2017-03-28 03:27:43
22763872,6377806,108796586,39,"This is to avoid creation of ""empty"" methods. I have seen empty `close()` method all over heron code. Once java 8 is accepted, dead code like this can be avoided.",653457144,2017-03-30 04:52:24
22763872,6377806,108796802,29,"Yes, a `HealthPolicy` could collect the symptoms and invoke `Diagnoser` as needed.",653457144,2017-03-30 04:53:34
22763872,6377806,108797009,27,"Yes, that is the intention. Current tracker API can return aggregated values.",653457144,2017-03-30 04:54:42
22763872,6377806,108797324,37,This pattern is inspired by `ByteAmount`. The intent is to avoid casting related errors when converting from one type to other. This class will get more methods in due course.,653457144,2017-03-30 04:56:28
22763872,6377806,108797560,43,"Yes, double could be a good starting point. Will add it.",653457144,2017-03-30 04:57:54
22763872,6377806,108797807,23,The `Action` object would be used for maintaining a audit log.,653457144,2017-03-30 04:59:12
22763872,6377806,108798409,24,One of the use cases of the `duration` field would be for `executeCount`. The aggregate value of count is return by tracker today. This `duration` field will be used by the `Detector` or `Diagnoser` for accurate comparisons and calculations.,653457144,2017-03-30 05:02:16
22763872,6377806,108798691,20,We expect Storm and Heron specific implementations for `MetricsInfo`. The `abstract` enforces the need to create one. Also this is work in progress and more methods and fields will be added to this class. ,653457144,2017-03-30 05:03:48
22763872,6377806,108799065,23,"We should use consistent names for timestamp, thanks for caching this. Will fix it. The semantics for duration is the same in both cases.",653457144,2017-03-30 05:05:53
22763872,6377806,108800049,25,Interesting. Can you share an example where Heron will return multiple data points for the same metric?,653457144,2017-03-30 05:11:46
22763872,6377806,108807138,26,My impression si that the `protobuf` based physical plan is more suitable for serializing the plan and the `PackingPlan` is to be used otherwise. For e.g. the `UpdateManager` also depends on `PackingPlan`. What do you think?,653457144,2017-03-30 05:56:44
22763872,6377806,108807431,20,The relation between a `symptom` and a `diagnoser` is not 1-1. Separating enables reuse and customization.,653457144,2017-03-30 05:58:34
22763872,6377806,108807853,25,Currently we are thinking of invoking the detector from the diagnoser. Other option is to inject a `provider`. Provider can optimize the number of times a detector is invoked.,653457144,2017-03-30 06:01:34
22763872,6377806,108808314,25,"Yes, that seems ok. Though, it might complicate the way these components are configured.",653457144,2017-03-30 06:04:37
22945111,10216235,109228713,30,if instance_stats_[_stmgr_id] does not exist?,659111697,2017-04-01 01:57:12
22945111,10216235,109228291,18,"can we add more description here as to whats the key, value means.",659111697,2017-04-01 01:55:01
22945111,10216235,109229280,46,where are you clearing this? Shouldn;t this be cleared on a regular basis?,659111697,2017-04-01 02:00:02
22945111,114449,109238374,46,What makes you think a += operator is clearing it?? I am totally confused...,659111697,2017-04-01 02:56:35
22945111,114449,109238639,46,"Oops, replied too fast. Good point, we need to clear it after a backpressure is triggered.",659111697,2017-04-01 02:58:34
22945111,114449,109238700,18,Sure.,659111697,2017-04-01 02:58:50
22945111,114449,109239643,30,"If instance_stats_[_stmgr_id] does not exist that means we don't have any traffic to that stmgr, therefore impossible to trigger a back pressure.",659111697,2017-04-01 03:04:21
22945111,32022953,113559151,4,"it failed the unit test test_back_pressure_stmgr_reconnect.
when the stmgr X in backpressure disconnects and reconnects, stmgr X is supposed to receive backpressure notice according to test_back_pressure_stmgr_reconnect.",667224609,2017-04-27 03:50:17
22945111,32022953,114038817,4,"follow up question:
how do you maintain the state eg. backpressure_starters_ after stmgr restarts/reconnects? ",667224609,2017-04-29 07:01:50
22945111,114449,114188564,4,@huijunw That should be handled in HandleConnectionClose().,667224609,2017-05-02 02:55:49
22945111,114449,114189368,4,"@huijunw I already noticed the test case failure, will fix it.",667224609,2017-05-02 02:59:51
22976246,73683,109479532,24,What's modified and how is it different than NEW and/or REMOVED?,659721916,2017-04-04 00:42:16
22976246,13159450,109484645,24,it is from [here](https://github.com/twitter/heron/pull/1788/files/25a39b507aa8c58419658b335289711afdf7c513#diff-4850d7a660ab463553d7e473b7ee6142L42). Modified means there are instances added/removed from the container.,659721916,2017-04-04 01:03:16
23063810,73683,115539320,5,s/fetch_bp/fetch_backpressure,663202804,2017-05-09 23:41:50
23063810,73683,115539502,5,"Here and elsewhere, let's use backpressure instead of the abbreviated form of bp.",663202804,2017-05-09 23:42:40
23063810,73683,115538260,13,s/bp/backpressure,663202804,2017-05-09 23:37:42
23063810,73683,115538520,80,s/fetch_bp/fetch_backpressure,663202804,2017-05-09 23:38:45
23063810,14058032,115561919,5,"I intentionally named it BP in the heron/tools/ui/resources/static/js/plan-stats.js file as this name is too long and it gets cut while rendering, as shown below:
 
![image](https://cloud.githubusercontent.com/assets/1450850/25865571/28fe2c46-34a8-11e7-",663202804,2017-05-10 01:14:06
23063810,13159450,115564599,5,@kkdoon ideally we should adjust CSS to make that column wider.,663202804,2017-05-10 01:24:17
23063810,14058032,115570793,5,@objmagic ok I will try to adjust the CSS and try again with 'Back Pressure' label.,663202804,2017-05-10 01:48:34
23063810,13159450,118386417,5,@kkdoon We can include this in next release if we can do the CSS fix today or tomorrow.,663202804,2017-05-25 06:11:46
23090729,32022953,109763263,23,I would suggest `joinString` name. The `toString` may be confusing with `Object.toString`.,662330910,2017-04-05 03:03:39
23090729,32022953,109764110,52,why not call shell command 'java --version' from python?,662330910,2017-04-05 03:07:45
23090729,13159450,109767968,23,+1,662330910,2017-04-05 03:24:49
23090729,13159450,109768668,52,"you still need to parse its output. This could be flaky compared with a call of `System.getProperty(""java.version"")` which is a stable API.",662330910,2017-04-05 03:27:36
23090729,73683,109781466,52,Exactly. The string output is very different depending on the jvm. Try it with a default jvm vs a twitter one for example. Parsing those differences would be more brittle.,662330910,2017-04-05 04:25:35
23090729,73683,109781483,23,Will do.,662330910,2017-04-05 04:25:41
23090729,3201045,109805272,52,"Also, bin/java - you might not want to hard code it. You might want to do two path join - we can make it windows proof.",662330910,2017-04-05 06:55:11
23090729,3201045,109805520,52,"Another issue could be Twitter internal JVM version detection needs to be different since on the version string, it does something different - we have to look at the next line and parse it to determine the version.",662330910,2017-04-05 06:57:06
23312767,13159450,110753079,24,should it be `* 1000`?,667069844,2017-04-11 03:18:38
23319367,13159450,111065568,35,shall we check if `key` is null before fetching value?,667304634,2017-04-12 12:04:45
23319367,73683,111202361,35,"Good call, updated.",667304634,2017-04-12 23:45:54
23319367,11442576,111493503,14,why here uses the logger of `HeronTopology`?,668824666,2017-04-14 04:41:07
23319367,73683,111494561,14,"Good catch, fixed.",668824666,2017-04-14 04:47:46
23667917,11442576,112564799,4,why `proto-java` and `proto-java-nl` are deleted?,674888343,2017-04-21 04:26:37
23667917,11442576,112563705,2,why `com.twitter` also shaded to `org.apache.storm`,674888343,2017-04-21 04:20:38
23667917,11442576,112565244,21,is this class related to the fatjar issue?,674888343,2017-04-21 04:29:15
23667917,13159450,112565576,4,not used.,674888343,2017-04-21 04:31:09
23667917,13159450,112565803,21,"Not really, but since `heron-storm.jar` does not include backtype now. We can only use `org.apache.storm`. However, `GlobalMetrics` is not in `org.apache.storm`.

Actually, I have already explained this in this PR.",674888343,2017-04-21 04:32:44
23667917,13159450,112565880,4,"I have already explained this in the PR: ""Removed some unused protobuf build targets."".",674888343,2017-04-21 04:33:22
23667917,134219,112565719,1,I recommend to make name worse (with __shaded__ for example if possible) to make it impossible to pass the review in user code with accidental usages.,674888343,2017-04-21 04:32:10
23667917,134219,112566692,1,same as above for shading. ,674888343,2017-04-21 04:38:19
23667917,134219,112565839,26,Unclear for me why do we need two of them.,674888343,2017-04-21 04:33:01
23667917,134219,112565859,13,Do we really need this? Comment explaining that will be very useful.,674888343,2017-04-21 04:33:11
23667917,134219,112566274,24,"nit: spaces, here and couple of times beyond.",674888343,2017-04-21 04:35:48
23667917,134219,112566064,15,nit: I prefer to separate this kind of things and keep review as small as possible.,674888343,2017-04-21 04:34:35
23667917,134219,112566521,15,"Do we depend on simulator to implement `LocalCluster` in heron-storm library? Or, if we removed `LocalCluster`, I recommend do not depend on `simulator` from `heron-storm`. I guess publishing of separate `testing` artifact would be useful for that.",674888343,2017-04-21 04:37:14
23667917,13159450,112567864,2,"@nlu90 Timur is right. I am thinking `com.twitter.xxx` is just ""implementation"" in this context.",674888343,2017-04-21 04:44:55
23667917,134219,112567698,2,"In general I can see a point - `heron-storm` artifacts aims to provide storm api, and therefore heron inside is impl detail. But I guess it's better to expose dependency on `heron-api`, for different config related things for example.",674888343,2017-04-21 04:43:50
23667917,134219,112568097,21,Is `GlobalMetrics` exposed in storm 1.0 api?,674888343,2017-04-21 04:46:20
23667917,13159450,112568119,15,"This sounds like a better move, but I feel like that needs more discussion, planning, and effort for implementation.",674888343,2017-04-21 04:46:27
23667917,13159450,112568617,26,which one do you think we should keep? I explained why we need both here: https://github.com/twitter/heron/pull/1811#issuecomment-295926431,674888343,2017-04-21 04:49:39
23667917,13159450,112568683,24,will fix.,674888343,2017-04-21 04:50:03
23667917,13159450,112568822,1,"@nlu90 what do you think? Do you remember the ""com.twitter.heron.shaded.do.not.use"" that I showed you during the stand-up yesterday?",674888343,2017-04-21 04:50:54
23667917,11442576,112568832,21,Did find it in 1.0.2 api,674888343,2017-04-21 04:50:58
23667917,11442576,112569146,2,"hmm, `com.twitter` is different from 3rdparty dependency, these are all classes from our own project. Not shading them would be better I suppose.",674888343,2017-04-21 04:52:54
23667917,13159450,112569145,21,"I am not familiar with the heron <-> storm compatibility story here. But isn't it OK if our storm is a superset of their storm? By ""superset"" I mean including more metrics API like `GlobalMetircs`?",674888343,2017-04-21 04:52:53
23667917,134219,112569435,1,@objmagic `__shaded__` in the beginning will be enough I believe.,674888343,2017-04-21 04:54:46
23667917,13159450,112569577,2,"What if user accesses some APIs in `com.twitter.heron.xxx`? Is it OK? If we shade, user will see something like `org.apache.storm.shaded.do.not.use.com.twitter.heron.xxx`, and he will not use it either intentionally or accidentally for sure.",674888343,2017-04-21 04:55:43
23667917,11442576,112570219,1,"I also vote for `__shaded__`
",674888343,2017-04-21 04:59:52
23667917,73683,112583266,15,"+1. Please don't change these imports in this review. If we want to do this, we should have a review that is just about that, that people might chime in on. I know there are people with an opinion about this so you don't want potentially hide this change ",674888343,2017-04-21 06:40:40
23667917,73683,112583747,13,"also, the nl part of the name isn't informative. I assume it relates to neverlink, but could we instead name based on the functional difference, like something to do with excluding from the artifact? The casual reader won't know what nverlink means.",674888343,2017-04-21 06:44:57
23667917,13159450,112583838,15,"This change, along with the introduction of `GlobalMetrics`, is here because I changed to only include ""org/apache/**"" in storm lib. See: https://github.com/twitter/heron/pull/1811/files#diff-cf85344880ea3bb51b03100c97fb7a82R22

This means I have to dro",674888343,2017-04-21 06:45:43
23667917,13159450,112583918,13,How about `api_deps_files_neverlink_kryo`?,674888343,2017-04-21 06:46:36
23667917,73683,112584102,21,Why does the jar no longer include backtype? We still want to support this.,674888343,2017-04-21 06:48:21
23667917,134219,112584127,15,"@objmagic you can do that separately, merge and do this review on top of it. I'm not strictly against that (maybe too much action needed) but I will prefer to do things this way.",674888343,2017-04-21 06:48:35
23667917,13159450,112584319,15,That's true. Let's hold off this.,674888343,2017-04-21 06:50:30
23667917,13159450,112584555,21,@billonahill probably @nlu90 can give you a better answer? We think because this is not really used anywhere.,674888343,2017-04-21 06:52:54
23667917,73683,112584754,26,Could we only use the neverlink version and then add kryo as it's own jar to whatever artifact bundle should also have it?,674888343,2017-04-21 06:54:47
23667917,134219,112585106,21,"@billonahill one of the reasons is - storm api < 1.0 uses kryo 2.x, while >= 1.0 uses kryo 3.x. 
I guess it's not a big dial to migrate to new storm api if you want to use heron and use old storm thou.",674888343,2017-04-21 06:58:14
23667917,73683,112585235,15,"yeah, we certainly don't want to abandon support for the the backtype api as part of this review.",674888343,2017-04-21 06:59:11
23667917,3201045,112585391,2,@objmagic - the intention of com.twitter.heron.xxx is to hide implementation details. Nobody should access the com.twitter.heron.xxx api - since it is bound to change. Developers should stick with org.apache.storm.xxx or backtype.storm.xxx apis only.,674888343,2017-04-21 07:00:37
23667917,13159450,112585502,2,@kramasamy thanks. I think your word means it is OK to shade `com.twitter.heron.xxx`.,674888343,2017-04-21 07:01:44
23667917,3201045,112585796,15,I agree that we should not mix backtype api (which is storm < 1.0) and org.apache.storm api (storm >= 1.0) together.,674888343,2017-04-21 07:04:29
23667917,13159450,112586440,15,"@billonahill @ttim btw, there is only one Kryo that is being used in this entire codebase: Kryo 3.0.3 (as shown in WORKSPACE file). If our backtype (storm < 1.0) is using Kryo 2.x, then it is confusing to me now.",674888343,2017-04-21 07:10:53
23667917,13159450,112586499,15,"actually, current backtype.storm is bundled with Kryo 3.0.3.",674888343,2017-04-21 07:11:26
23667917,13159450,112586660,15,"@kramasamy I see. If backtype is storm < 1.0 and org.apache.storm is storm >= 1.0, then we should not put them together in `heron-storm.jar`. This PR will only include `org.apache.storm` and will drop `backtype.storm`. cc @billonahill ",674888343,2017-04-21 07:13:11
23667917,13159450,112587053,1,resolved via https://github.com/twitter/heron/pull/1811/commits/85de0d9e67a98003a00e4d8cd5ee9eb21991e516,674888343,2017-04-21 07:17:50
23667917,13159450,112587066,1,resolved via https://github.com/twitter/heron/pull/1811/commits/85de0d9e67a98003a00e4d8cd5ee9eb21991e516,674888343,2017-04-21 07:17:57
23667917,73683,112723667,15,"@kramasamy @objmagic the two versions of storm have 2 different namespaces so they can coexist, providing the deps align. That seems more simple than producing different jars. ",674888343,2017-04-21 23:08:55
23667917,73683,113008479,2,why would we shade com.twitter classes to the org.apache.storm namespace? I don't think we should do this.,677026932,2017-04-25 00:33:53
23667917,73683,113007814,27,"No need for all caps, that's what warning is intended to do. Also can you specify in the log message what someone should do differently (i.e. that they should use Kryo and how to configure it). If we have a link to the documentation for how to use Kryo th",677026932,2017-04-25 00:30:49
23667917,73683,113007360,31,I thought we agreed we would not shade heron-api?,677026932,2017-04-25 00:28:46
23667917,13159450,113009341,31,"I don't think there is need to exclude Guava dependency now (similarly, heron-storm.jar has Guava dependency that is impossible to remove. so I have to bundle and shade it). That's why I need to shade all `com.google.*`.",677026932,2017-04-25 00:37:50
23667917,13159450,113009371,2,forgot to change this.,677026932,2017-04-25 00:38:01
23667917,13159450,113013028,27,https://github.com/twitter/heron/pull/1811/commits/b27da030962bc4e1f8792547f4bc31b717e3bf43,677026932,2017-04-25 00:53:33
23667917,13159450,113013051,2,https://github.com/twitter/heron/pull/1811/commits/440e82e00dc2eab925c3fe11fc3d3a53456c4c46,677026932,2017-04-25 00:53:38
23667917,73683,113030645,23,"Is this class really no longer needed? I thought we supported configs that specify this to be loaded via reflection and that we had to keep it, just in a new location outside of c.t.h.api.",677549082,2017-04-25 02:05:35
23667917,73683,113030228,28,"Can you please include these all in one log message? It's typically better to have the entire log entry in one longer warning without line breaks, than to have it split into multiple lines.",677549082,2017-04-25 02:03:46
23667917,73683,113029840,31,I see. I missed that we were only shading com.google. I thought all of heron-api was affected.,677026932,2017-04-25 02:01:52
23667917,134219,113048639,23,"Nobody used this before, because everyone uses `heron-storm` lib and therefore `HeronPluggableSerializerDelegate`.

We should dive into it again when people will start to use `heron-api` directly (if this will happen), but for now I guess it's totally f",677549082,2017-04-25 03:32:38
23667917,73683,113053629,23,What if instead of removing this completely we move it into contrib at `contrib/kryo-serializer/src/java`? That way we can easily resurrect it. It won't effect the build there for now.,677549082,2017-04-25 03:53:56
23667917,13159450,113055338,23,done here https://github.com/twitter/heron/pull/1811/commits/91ef2db266f5dd18c5164c07048ee05edea6ab64,677549082,2017-04-25 04:01:22
23667917,134219,113055361,23,"@billonahill I see your point, but this class will be easy to resurrect because it's just simplified version of `HeronPluggableSerializerDelegate` (and actually it's not really useful because doesn't allow user to customize kryo serializer).

That's sai",677549082,2017-04-25 04:01:31
23667917,73683,113055422,15,Please match the directory structure to the package name.,677694938,2017-04-25 04:01:49
23667917,13159450,113056532,15,https://github.com/twitter/heron/pull/1811/commits/09e11f03c8104d43e546001803a76c3d101d85a8,677694938,2017-04-25 04:07:07
23667917,73683,113062633,5,"please update the directory structure to match the package structure:
```
contrib/kryo-serializer/src/java/com/twitter/heron/serializer/kryo/KryoSerializer.java
```",677700936,2017-04-25 04:35:47
23667917,134219,113067720,7,"`heron-api` doesn't depend on kryo, right?",677730343,2017-04-25 05:02:29
23667917,134219,113067449,5,Is it in `contrib`? If yes - it's unclear.,677730343,2017-04-25 05:00:58
23667917,134219,113067334,4,Do we need this?,677730343,2017-04-25 05:00:20
23667917,3201045,112787839,15,+1,674888343,2017-04-22 05:28:58
23667917,3201045,113074859,23,Why does the pom file exist here? What is it for?,677730343,2017-04-25 05:49:09
23667917,13159450,113076499,23,"Because the dependency Kryo will be specified in POM file, instead of being bundled (and shaded) into fatjar. This is the same for open-sourced Heron. When you publish to Maven, you also want to publish this POM file.",677730343,2017-04-25 06:02:04
23667917,13159450,113076683,7,fixed https://github.com/twitter/heron/pull/1811/commits/909b32b1be591a9286e5574fd1a7b96c4e0e5594,677730343,2017-04-25 06:03:24
23667917,3201045,113076775,23,@objmagic - does not feel write to be in this directory. ,677730343,2017-04-25 06:04:03
23667917,13159450,113076792,5,cc @billonahill ,677730343,2017-04-25 06:04:11
23667917,13159450,113077233,23,so where do you suggest to put it?,677730343,2017-04-25 06:07:41
23667917,13159450,113080518,23,fixed via https://github.com/twitter/heron/pull/1811/commits/d08acae850c541d3177c0eb0b7df3b2f6f26326f,677730343,2017-04-25 06:36:53
23667917,13159450,113080985,4,"well, yes or no. I can revert this.",677730343,2017-04-25 06:40:49
23667917,73683,113081155,5,"I think this naming is ok as is. It's consistent with how we name scheduler implementations (i.e., `c.t.h.scheduler.[aurora|marathon|yarn]`). The location of the code could move in or our of the contrib folder without requiring a package renaming.",677730343,2017-04-25 06:42:11
23667917,134219,113081598,5,"@billonahill It's unclear from the name of the class that this is contrib. How do you package this class then? In which artifact? This name suggests this class is a part of somehow main API, which is not. 

Anyway I don't expect you to change the way yo",677730343,2017-04-25 06:46:04
23834624,13159450,113571099,211,better remove this.,679445449,2017-04-27 04:47:58
23878311,11442576,113580247,6,"one general question:
1. should we provide the setters method like other configs listed here. e.g. setTopologyStateful();",679563394,2017-04-27 05:44:19
23878311,10216235,113581880,6,Makes sense. I will add it and update,679563394,2017-04-27 05:56:31
23878311,11442576,113583656,25,"is there any common operation across different type of states, like adding something into the current state? we could put them here.

",679563394,2017-04-27 06:09:59
23878311,11442576,113580397,20,this comment is for IBolt. not for IStatefulBolt,679563394,2017-04-27 05:45:19
23878311,11442576,113583075,23,"The extends here looks odd to me. 

Could we make a hashmap member instead of using inheritance?",679563394,2017-04-27 06:05:25
23878311,11442576,113580466,20,"The comment here is for for ISpout, not for IStatefulSpout",679563394,2017-04-27 05:45:49
23878311,11442576,113581685,23,"do we need an access method to get the current state of the component? Otherwise, how does the framework know what state to save for the compoment?",679563394,2017-04-27 05:55:02
23878311,10216235,113588692,25,The State as defined here is a very generic interface for spouts/bolts to keep their internal state. Any type of common operation will probably come in higher layers(like DSL),679563394,2017-04-27 06:49:43
23878311,10216235,113588766,23,Spouts/bolts should hold on to state variable to store their data. This is very consistent with OutputCollector in ISpout/IBolt,679563394,2017-04-27 06:50:29
23878311,10216235,113591307,6,Done,679563394,2017-04-27 07:11:47
23878311,2183863,113617761,26,"I would think having IStatefulComponent is good enough; no need IStatefulBolt or IStatefulSpout:
- IStatefulBolt does not add more methods than IStatefulComponent and IRichBolt. A bolt can simply implement IStatefulComponent if it wants Stateful feature;",679611229,2017-04-27 12:28:18
23878311,2183863,113617775,29,Similar to above.,679611229,2017-04-27 12:28:35
23878311,2508294,113642420,23,"interface State is already a map. If a hashmap member placed here, it leads to nested map.",679563394,2017-04-27 15:36:01
23878311,10216235,113701369,26,"IStatefulSpout/IStatefulBolt are mimicking IRichSpout/IRichBolt. They are essentially a shorthand version for any kind of stateful component.
IRich/IBasic stuff are essentially more developer friendly versions of the basic ISpout stuff. Thus in the futur",679611229,2017-04-27 20:55:00
23878311,73683,113762433,26,+1 for `IStatefulComponent` interface with common methods. If we later find that bolts and spouts need specific methods we can subclass `IStatefulComponent`. Fewer interfaces and a shared top-level interface hierarchy will simplify the lives of both heron,679611229,2017-04-28 00:58:21
23878311,73683,113761199,20,Is this a pointer to a config file? If so can we include `file` in the name and clarify in the comments?,679563394,2017-04-28 00:53:03
23878311,73683,113760670,10,Can we include `seconds` in the variable and field naming to be explicit.,679563394,2017-04-28 00:51:15
23878311,73683,113760538,6,"Is this something the user needs to set, or the field that Heron internally sets when inspecting the DAG? (I would expect the latter, in which case can we document that or not expose it as a user setting?)",679563394,2017-04-28 00:50:48
23878311,73683,113760959,15,Is this the implementation class? If so can we use `class` instead of type to be more explicit?,679563394,2017-04-28 00:52:10
23878311,73683,113760126,25,"Can we use generics in the State API for better type safety? (`Map<<K extends Serializable>, <V extends Serializable>>`)",679563394,2017-04-28 00:48:44
23878311,10216235,113788570,6,These are all user facing apis. Users are expected to set this(we of course take some default stuff),679563394,2017-04-28 02:59:05
23878311,73683,113789377,6,Why does the user need to set `topology.stateful`? Should using `IStatefulComponent` and configuring the stateful store be sufficient? Are you thinking they'll want a flag to turn it off? ,679563394,2017-04-28 03:02:48
23878311,10216235,113790282,25,"We don't want to restrict State to a particular type of key/value. Thus say KafkaSpout can do state.put(""offset"", 111);
while some other type of bolt can do
state.put(120, ""Sanjeev"");
We should take any object as long as it is serializable.",679563394,2017-04-28 03:07:14
23878311,10216235,113790689,6,"Not really.
One could run a stateful topology in non stateful mode. i.e. I could write a IStatefulSpout/Bolt but may prefer to turn on and off the stateful config for maybe different use-cases or experimentation.",679563394,2017-04-28 03:09:28
23878311,10216235,113792329,15,done,679563394,2017-04-28 03:17:51
23878311,10216235,113792337,20,done,679563394,2017-04-28 03:17:53
23878311,73683,113796157,25,"`Map<<K extends Serializable>, <V extends Serializable>>` says that we should take any kind of state as long as it is serializable. The difference is how the users will write their code, not how the system deals with serializables. For the spout and bolt ",679563394,2017-04-28 03:37:04
23878311,73683,113796796,6,"Would we need this globally, or per component? Assuming globally, could we give a more descriptive name like `topology.component.state.enabled` or something like that?",679563394,2017-04-28 03:39:58
23878311,10216235,113802142,6,"This is a topology specific config. Thus it should always be topology.<feature>
All per component variables are prefixed by topology.component.",679563394,2017-04-28 04:05:00
23878311,2183863,113808686,6,"Agree it should be a topology specific config:
- if people want a component to be stateless, they can simply not to store any states, even with this config is set true
- it does not make sense to make this config per component; the whole topology DAG is",679563394,2017-04-28 04:36:51
23878311,2183863,113811371,23,@nlu90 Heron feeds the state during `void initState(State state);` so it always has the reference for the `state`. ,679563394,2017-04-28 04:51:31
23878311,2183863,113811012,25,"+1 `Map<<K extends Serializable>, <V extends Serializable>>` ",679563394,2017-04-28 04:49:13
23878311,13159450,113815282,25,"@billonahill 
> Can we use generics in the State API for better type safety? (Map<<K extends Serializable>, <V extends Serializable>>)

Out of curiosity, what is the meaning of ""type safety"" in this sentence? In what way could user implement the `State",679563394,2017-04-28 05:15:50
23878311,13159450,113816536,25,"@billonahill do you mean that `<K extends Serializable>` will simply put constraint on `K`, while `Map<Serializable, Serializable>` will cast key or value to `Serializable` and thus we will lose some type information?",679563394,2017-04-28 05:24:08
23878311,73683,113817678,25,"yes, but also if we had K, V users could write this:
```
  class MyStatefulBolt implements ITypedStatefulComponent<String, Integer> {
    @Override
    public void initState(TypedState<String, Integer> state) {

    }
  }
```
and work with the ty",679563394,2017-04-28 05:32:24
23878311,13159450,113820878,25,"@billonahill 
> This provides compile time checks in user code for their types

Sorry for bugging in this thread, but can you be more specific? Do you mean with K, V we can also provide compile-time type checks to make sure **both** that `String` is ex",679563394,2017-04-28 05:57:38
23878311,73683,113824925,25,"Correct. Here's some mock code to show what I mean. Note that the internals use serializable but the user land code can be typed.
```
public class StateExample {

  interface TypedState<K extends Serializable, V extends Serializable> {
    void put(K",679563394,2017-04-28 06:30:09
23878311,73683,114371126,6,Can we name this in a way that implies that heron state management is enabled or disabled by this boolean flag? It should be very clear to the user the effect of using `IStatefulComponents` for example with this set to `false`. Or what this should be set ,679563394,2017-05-03 00:06:32
23878311,10216235,114376277,6,Changed to TOPOLOGY_STATEFUL_ENABLED,679563394,2017-05-03 00:29:10
23878311,73683,114379706,4,"Instead of ""Is this topology stateful?"" can we clarify in the comments what happens when this is set to true/false? For example if I set it to false but use `IStatefulComponent`, I assume I can still be in-memory stateful, but the state will not persist u",683619587,2017-05-03 00:43:54
23878311,10216235,114381918,4,Added more comments to clarify,683619587,2017-05-03 00:52:48
23878311,73683,114383983,14,"we're combing the behavior of state management with atleast/atmost/exactly once semantics, so I think more explanation is helpful. For exactly once semantics do we require acking to be enabled and topology.stateful.enabled, for example? We should clarify ",683633901,2017-05-03 01:01:17
23878311,10216235,114392697,14,Thats a good point. I've separated out Stateful processing and exactly once semantics.,683633901,2017-05-03 01:38:14
24044119,3201045,114393116,5,What does << stmgr_port means? Does it just print stmgr_port when the test fails or succeeds?,683456373,2017-05-03 01:39:57
24044119,32022953,114409453,5,"When the check fails, it prints stmgr_port.
The ci seems always failing after adding the checking. I doubt if this test ever run correctly.",683456373,2017-05-03 02:53:56
24044119,3201045,114444100,5,@huijunw - can you add some meaningful message so that it says what it is printing?,683456373,2017-05-03 05:54:19
24044119,32022953,114619364,5,done.,683456373,2017-05-04 01:29:09
24044370,13159450,114368494,46,PLOG?,683226520,2017-05-02 23:55:00
24044370,3201045,114369462,7,Are errno's negative? Otherwise it might not work. Instead I would suggest to return NOT_OK.,683226520,2017-05-02 23:59:14
24044370,3201045,114369981,7,It should SP_NOTOK. Here is the file common/src/cpp/basics/sprcodes.h,683226520,2017-05-03 00:01:30
24072796,11442576,114434551,100,s/stmgr/stmgr_id,683763883,2017-05-03 04:52:49
24072796,11442576,114436436,166,add `required heron.proto.system.Status status`?,683763883,2017-05-03 05:03:18
24072796,11442576,114437983,178,is this message to handle the case where a downstream instance has multiple updtream instances?,683763883,2017-05-03 05:13:24
24072796,11442576,114434299,83,do we need the ability to clean only one particular checkpoint?,683763883,2017-05-03 04:51:32
24072796,11442576,114432139,30,what is this txid for?,683763883,2017-05-03 04:39:52
24072796,11442576,114433616,58,"when is this message sent? Is it only sent once during the topology startup?

This message looks strange to me that if a topology is configured with stateful processing, then once it starts running, the processing is stateful already.",683763883,2017-05-03 04:47:52
24072796,11442576,114436537,171,the same question as `StartStmgrStatefulProcessing `,683763883,2017-05-03 05:03:52
24072796,11442576,114434451,89,also response with the cleaned checkpoint ids would be better?,683763883,2017-05-03 04:52:19
24072796,73683,114439670,11,"Instead of storing an string id and a string[] backupId, could we instead store an ordered array of Checkpoint objects, most recent first? Using an object instead of a string would allow for extensibility to bind more metadata to a checkpoint than just id",683763883,2017-05-03 05:24:06
24072796,73683,114439933,8,message is stored in state manager right? zk is just one of state managers impls.,683763883,2017-05-03 05:25:55
24072796,10216235,114444149,30,Added more comments to explain this. Let me know if it makes more sense now :),683763883,2017-05-03 05:54:44
24072796,10216235,114444179,58,Added comments.,683763883,2017-05-03 05:54:56
24072796,10216235,114444246,83,This is just the oldest checkpoint that needs to be preserved. All older ones can be cleaned,683763883,2017-05-03 05:55:26
24072796,10216235,114444269,89,added,683763883,2017-05-03 05:55:36
24072796,10216235,114444289,166,added,683763883,2017-05-03 05:55:45
24072796,10216235,114444279,100,done,683763883,2017-05-03 05:55:41
24072796,10216235,114444318,171,Explained earlier,683763883,2017-05-03 05:55:56
24072796,10216235,114444377,178,This is the marker message. Added comments to explain,683763883,2017-05-03 05:56:19
24072796,10216235,114444396,11,Made changes,683763883,2017-05-03 05:56:29
24072796,10216235,114444419,8,changed,683763883,2017-05-03 05:56:39
24072796,73683,114448774,10,"Why an inner class? If we make this a top level class it can be used on its own without the collection, like in the RPC for example while working with a specific checkpoint.",683831866,2017-05-03 06:29:30
24072796,10216235,114449587,10,Done,683831866,2017-05-03 06:35:46
24072796,73683,114451397,27,If this is an RPC request object should it be `StartStatefulCheckpointRequest`?,683852742,2017-05-03 06:50:23
24072796,73683,114451828,54,Is this the payload of an RPC request? If so it should follow the same standard and be `ResetTopologyStateRequest`.,683852742,2017-05-03 06:53:38
24072796,10216235,114454520,27,"We do follow that terminology where all request/responses are labelled as such.
Anything else that is not a request/response are just best effort messages that go from one component to another. For some, a response is not expected. For others it cannot b",683852742,2017-05-03 07:17:25
24072796,10216235,114454539,54,Same as above,683852742,2017-05-03 07:17:40
24072796,73683,114455097,27,Do the heron client/server model use a protobuf RPC interface or do they just send protobuf object bytes on raw sockets?,683852742,2017-05-03 07:22:37
24072796,10216235,114455299,27,the latter(i.e. use protobuf object bytes),683852742,2017-05-03 07:24:13
24072796,73683,114601457,80,"Why does TMaster register itself with the checkpoint manager instead of the other way around, like the way state manager registers with TMaster? TMaster is already discoverable in StateManager.

Also space before {",683852742,2017-05-04 00:15:40
24072796,73683,114603987,109,"""establish the connection"" should be ""register itself"" no?",683852742,2017-05-04 00:26:08
24072796,73683,114601610,82,Why would checkpoint manager need to be told the topology name and id? This info is static and can be passed to checkpoint manager at startup. Same question for `RegisterStMgrRequest` below.,683852742,2017-05-04 00:16:21
24072796,73683,114605674,164,"Is this the message or is this the state info that's part of another message? Reading above it seems the latter but the description states the former. If it is the former, can we put a verb in this object, to make it more clear what action is being reques",683852742,2017-05-04 00:32:50
24072796,73683,114602528,97,"If these fields are both optional neither of them can be set, which I assume would be invalid. If that's the case can we enforce that one of them is set view `oneof`? That would assure that every possible field setting is valid.
https://developers.google",683852742,2017-05-04 00:20:14
24072796,73683,114600668,71,"When/how is this message used and how does the stream manager get into the state that is before or after this one (i.e., one where it's not started)?",683852742,2017-05-04 00:12:05
24072796,73683,114605855,171,typo: instace,683852742,2017-05-04 00:33:38
24072796,73683,114600155,59,Why does the tmaster need to be aware of specific instance state? Why not have the stream manager manage the states of the instances under it's control?,683852742,2017-05-04 00:09:42
24072796,73683,114603281,103,`cleaned_checkpoint_ids`,683852742,2017-05-04 00:23:14
24072796,73683,114606543,187,"Same question as above w.r.t. state changes. If this request triggers processing to start, how does the instance get into the state where it's not processing?",683852742,2017-05-04 00:36:46
24072796,73683,114607672,168,Can we more clearly specify state than an arbitrary array of bytes? What is this byte array and how does the StateStore implementor know how to read the bytes? How for example would I persist the byte array in a key value store in a way where I could insp,683852742,2017-05-04 00:41:59
24072796,73683,114606857,193,"I thought checkpointing was non-blocking, but this comment sounds like checkpointing happens serially from one component to the next. Why?

Also why does each instance broadcast this message to all instances of the downstream component?",683852742,2017-05-04 00:38:08
24072796,73683,114604039,111,space before {,683852742,2017-05-04 00:26:21
24072796,73683,114607927,10,We need to associate the checkpoint with a packing plan or physical plan so we know it's valid to reuse upon topology restart.,683852742,2017-05-04 00:43:06
24072796,10216235,114612055,59,This is purely for information sake only. Mostly used for printing/debugging,683852742,2017-05-04 00:59:40
24072796,10216235,114612746,80,The idea is to use ckptmgr as some sort of service by the tmaster. TMaster upon startup would connect to it(which is also running in the same container) and register itself,683852742,2017-05-04 01:02:28
24072796,10216235,114612847,82,This is for the sake of consistency wrt all other register requests. The original idea was sanity checking,683852742,2017-05-04 01:02:57
24072796,10216235,114614011,168,"Current phase only treats it as arbitrary bytes. The aim is to get the flow mechanism correct, before expanding this",683852742,2017-05-04 01:07:29
24072796,10216235,114614559,193,"distributed checkpointing is non-blocking. However the mechanism of how they are triggered are serialized. This is part of the Lamport's algorithm. To be part of a consistent checkpoint, an upstreamer needs to checkpoint first and then send these markers ",683852742,2017-05-04 01:09:45
24072796,10216235,114615459,97,oneof is not supported by the protobuf version that we are using,683852742,2017-05-04 01:13:31
24072796,10216235,114616627,10,Rather than do this in the design doc(which is seperate entity) I would rather include some sort of flow in the file itself,683852742,2017-05-04 01:17:58
24072796,10216235,114622299,10,This is done. Please take a look,683852742,2017-05-04 01:42:09
24072796,10216235,114622362,71,Added more in the header section,683852742,2017-05-04 01:42:24
24072796,10216235,114622457,80,Done style fix,683852742,2017-05-04 01:42:53
24072796,10216235,114622520,109,changed,683852742,2017-05-04 01:43:09
24072796,10216235,114622529,111,fixed,683852742,2017-05-04 01:43:12
24072796,10216235,114622496,103,done,683852742,2017-05-04 01:43:04
24072796,10216235,114622586,164,Fixed this,683852742,2017-05-04 01:43:22
24072796,10216235,114622618,171,Fixed,683852742,2017-05-04 01:43:32
24072796,73683,114642755,193,"Why is this at the instance level and not the component level? Couldn't ""Once an instance is done checkpointing"" be ""Once a component is done checkpointing""? Also, if each instance is broadcasting to all of it's downstream instances, that implies that the",683852742,2017-05-04 03:18:36
24072796,10216235,114646424,193,"Couple of clarifications:-
1. Just to be clear in Heron parlance component means one logical component(like spout/bolt). Instance is one running process of it. Thus there are 5 instances of 'wordSpout' component. In this case, it is instance level.
2. C",683852742,2017-05-04 03:34:39
24072796,73683,114646805,132,s/exactly once semantics/stateful processing/,684558071,2017-05-04 03:36:21
24072796,73683,114644154,22,"""because instances are all busy recovering their state"" assumes that the reader knows the startup sequence of events, which is what we're trying to describe. Could you list the sequence of startup events for stateful topologies? It should be very clear to",684558071,2017-05-04 03:25:21
24072796,73683,114643345,8,"This text description is helpful, but it would still be great to have a sequence diagram of these flows. Visualizing the interactions between the many agents really helps to understand the system and to expose quirks. Here's an example that we created to ",684558071,2017-05-04 03:21:33
24072796,73683,114643532,16,in turn,684558071,2017-05-04 03:22:18
24072796,73683,114643471,15,all stmgrs connect to,684558071,2017-05-04 03:22:03
24072796,73683,114643582,19,s/exactly once semantics/stateful topologies/,684558071,2017-05-04 03:22:38
24072796,73683,114645008,39,receives,684558071,2017-05-04 03:29:15
24072796,73683,114646747,71,"Two questions:
1. Could deactivate/activate be used for this, or would that overload the activation semantics?
2. This message would be sent when recovering to a given checkpoint, during which processing is already started, so this message would also be",683852742,2017-05-04 03:36:03
24072796,73683,114643402,14,upon startup,684558071,2017-05-04 03:21:48
24072796,10216235,114660493,71,"1. activate/deactivate are meant for totally different things and imo not applicable.
2. yup. In future we could add some commands like that to the cli itself",683852742,2017-05-04 04:41:13
24072796,10216235,114662709,39,fixed,684558071,2017-05-04 04:54:17
24072796,10216235,114662730,132,fixed,684558071,2017-05-04 04:54:23
24072796,10216235,114662759,22,reworded,684558071,2017-05-04 04:54:32
24072796,10216235,114663016,14,fixed,684558071,2017-05-04 04:56:09
24072796,11442576,114664633,193,"The instance itself doesn't need to be aware of the upstream/downstream task infromations, stmgr can manage this and decide when to ask a local instance to do the checkpoint by sending `message InitiateStatefulCheckpoint` I suppose.",683852742,2017-05-04 05:05:41
24072796,73683,114665770,28,omit: sends,684690031,2017-05-04 05:13:05
24072796,10216235,114669491,28,removed,684690031,2017-05-04 05:37:52
24072796,73683,114698280,10,I think your comment was about my request for a sequence diagram. What about my comment about how we need to bind a checkpoint to a given packing plan or physical plan to know if it's valid upon startup?,683852742,2017-05-04 11:23:49
24072796,73683,114698155,228,"Why is state a byte array and not something more typed, like a map of kv pairs? How does the `StatefulStorage` impl know how to read the bytes?",684716339,2017-05-04 11:21:29
24072796,73683,114698438,97,"It's  listed in the version 2 spec:
https://developers.google.com/protocol-buffers/docs/reference/proto2-spec

What's the minimum version that supports it? We should consider upgrading, since this was included in 2.x.",683852742,2017-05-04 11:26:53
24072796,73683,114698491,168,Can you add a TODO next to that then to clarify that we don't want to ship with this being a byte array?,683852742,2017-05-04 11:27:49
24120612,73683,114700474,35,Please follow the same builder pattern that we use elsewhere. See `SystemConfig.newBuilder(..)`.,684767777,2017-05-04 12:02:37
24120612,73683,114699912,14,"This causes a failure where some children are deleted but others are not, so it's not clear how a caller would recover. Could we instead have this return void and throw an IOException that includes the failed path?",684767777,2017-05-04 11:52:31
24120612,73683,114701307,188,Prefer `String.format(..)` for static string template assembly. Here and elsewhere in this class and in LocalFS.,684767777,2017-05-04 12:18:07
24120612,73683,114699518,99,pleae use an `Options`/`CommandLineParser` instead of positional fields. See `RuntimeManagerMain` for examples.,684767777,2017-05-04 11:45:05
24120612,73683,114700998,150,See other comment about not using `RuntimeExcepion` and not swallowing exceptions.,684767777,2017-05-04 12:12:05
24120612,73683,114700518,32,s/backendConfig/config/,684767777,2017-05-04 12:03:14
24120612,73683,114699259,20,Can we package the specific storage implementations independently of the API interfaces and core snapshot code? Also elsewhere we split up core/API and impl classes in scheduler-core/schedulers at the top level. Should we follow that pattern here too?,684767777,2017-05-04 11:40:51
24120612,73683,114700406,36,This logic already exists in `ConfigReader.loadFile(..)`.,684767777,2017-05-04 12:01:28
24120612,73683,114700119,66,"1. We typically don't want to append messages to an exception, since it swallows it the exception chain.
2. Also we should never throw `RuntimeException` since it's too generic for a client to derive any real meaning from.
3. Always include meaningful i",684767777,2017-05-04 11:56:27
24120612,73683,114698653,21,Can we change this to `IStatefulStorage` or maybe `ICheckpointStorage` and change the package to storage?,684767777,2017-05-04 11:30:55
24120612,73683,114700331,28,Please follow the same pattern that we use elsewhere where we use an enum for the key that defines the type of the value. See `SystemConfigKey` and the getters that use it in `SystemConfig`.,684767777,2017-05-04 12:00:14
24120612,73683,114701143,29,Can we instead use a Config class here?,684767777,2017-05-04 12:15:05
24120612,73683,114698720,37,`HDFSStorage`,684767777,2017-05-04 11:32:07
24120612,73683,114699341,49,please fix to read from config.,684767777,2017-05-04 11:42:02
24120612,73683,114701253,85,"`throw new CheckpointException(""Failed to persist checkpoint with id "" + checkpoint, e);`",684767777,2017-05-04 12:17:00
24120612,73683,114699633,124,"Ugh, we need to upgrade these methods to use `ByteAmount` instead of ints, but that's for another PR.",684767777,2017-05-04 11:47:05
24120612,73683,114698772,82,"please use `String.format("" ..."", ...)` for improved readability",684767777,2017-05-04 11:32:59
24120612,73683,114699188,25,"Why do we need both `ckptmgr-java` and `ckptmgr-unshaded` as separate binaries, when neither is shaded?",684767777,2017-05-04 11:39:46
24120612,73683,114700946,99,Could we instead create a `CheckpointRequestHandler` interface with a single method and have a class for each of these? That approach would be more OO and would allow us to share more of the copied code in these methods in an abstract handler superclass. ,684767777,2017-05-04 12:11:03
24120612,73683,114701342,29,`LocalFilesystemStateStorage`,684767777,2017-05-04 12:18:52
24120612,73683,114699325,31,please provide javadocs.,684767777,2017-05-04 11:41:37
24120612,73683,114699005,11,Why does `ckptmgr-java` exclude `CheckpointManager.java` and `ckptmgr-unshaded` include it?,684767777,2017-05-04 11:36:59
24120612,73683,114698877,37,"Favor returning `void` and throwing a `StatefulStorageException` instead of using booleans to represent failure conditions, here and elsewhere. See https://github.com/twitter/heron/issues/1311",684767777,2017-05-04 11:35:06
24120612,11442576,114854474,11,"`CheckpointManager.java` is the entry point of the checkpoint management, which includes the `main` method.

since `ckptmgr-java` is a `java_library`, the entry point class is not needed at the library level. On the other hand, `ckptmgr-unshaded` is a `",684767777,2017-05-05 01:28:50
24120612,10216235,115081326,21,I've done most of the changes that you requested. Working on unittests. Meanwhile can you please take a look again?,684767777,2017-05-06 03:27:49
24120612,73683,115375246,11,Thanks. I missed the `java_library` and `java_binary` part the first time through.,684767777,2017-05-09 06:11:05
24120612,73683,115378841,60,please don't throw `RuntimeException` unless we're in a `main` method. Can we instead throw something like `IStatefulStorageException`?,686970553,2017-05-09 06:38:03
24120612,73683,115376613,23,"Can we model this config class more like `SystemConfig` and `SystemConfigKey`, where enums are used for the system keys, which also define their type and default values?",686970553,2017-05-09 06:21:10
24120612,73683,115377667,74,will this happen often? If so maybe it's debug logging?,686970553,2017-05-09 06:29:01
24120612,73683,115378508,47,omit: Initialing... ,686970553,2017-05-09 06:35:20
24120612,73683,115379107,195,Can we call this `getCheckpointFile` so it doesn't sound the same as `getCheckpointDir`?,686970553,2017-05-09 06:40:13
24120612,73683,115379855,38,Can we break these up so that `CheckpointManagerConfig.java` contains the Checkpoint Manager configs and `StatefulStorageConfig.java` contains the storage configs? It will help to separate concerns and to more easily initialize unit tests.,686970553,2017-05-09 06:46:44
24120612,73683,115381077,72,s/localFSBackend/localFileSystemStorage,686970553,2017-05-09 06:56:23
24120612,73683,115379956,27,`void init(StatefulStorageConfig conf);`,686970553,2017-05-09 06:47:33
24120612,73683,115379587,34,s/backendConfig/statefulStorageConfig/,686970553,2017-05-09 06:44:30
24120612,73683,115378359,35,"Can we make these return `void` and throw one or more custom exceptions upon failure, instead of using the ""booleans to represent failures"" anti-pattern? See https://github.com/twitter/heron/issues/1311",686970553,2017-05-09 06:34:04
24120612,73683,115380146,75,this should be part of initialization so we fail to start versus failing later upon first checkpoint.,686970553,2017-05-09 06:49:02
24120612,73683,115377439,46,"Nit: can we call the `NIOLooper` looper, or slave instead of s?",686970553,2017-05-09 06:27:23
24120612,73683,115379292,40,We should write these with an assumption that they're self explanatory when combined with a bunch of other unrelated configs. Something like `heron.stateful.storage.hdfs.root.path`.,686970553,2017-05-09 06:41:54
24120612,73683,115381173,29,s/LocalFSStorage/LocalFileSystemStorage for consistency with LocalFileSystemStateManager,686970553,2017-05-09 06:57:12
24120612,73683,115380412,29,Local and hdfs storage are basically the same with the exception of how files are read/written. Can we please use a common abstract superclass for consistency and less code duplication? Similar to what we did with `FileSystemStateManager`. I'm already loo,686970553,2017-05-09 06:51:15
24120612,73683,115376095,212,"Is this necessary? I don't see it accessed. Ideally we should prefer classes that take their customizations in the form of specific constructor args, versus static config objects that classes pick specific things from. This helps with testability and clea",686970553,2017-05-09 06:17:13
24120612,73683,115378686,58,"please be more specific in the log message re just what ""URL"" is. Also why are we logging the user's home dir? Seems better to log the root dir where data will be stored.",686970553,2017-05-09 06:36:53
24120612,73683,115376211,228,omit: for,686970553,2017-05-09 06:18:06
24120612,73683,115376285,229,s/Id/checkpointManagerId/,686970553,2017-05-09 06:18:36
24120612,73683,115381227,49,s/LocalFSStorageTest/LocalFileSystemStorageTest for consistency with LocalFileSystemStateManager,686970553,2017-05-09 06:57:38
24120612,73683,115381010,84,s/hdfsBackend/hdfsStorage,686970553,2017-05-09 06:55:45
24120612,10216235,115400026,99,"Not sure I like the idea. All throughout Heron code, we have specific handlers for specific requests. Also, this allows the request/response semantics to be within the ckptmgr server and not leak to actual backend implementations",684767777,2017-05-09 10:17:31
24120612,10216235,115400158,212,Again this is consistent with how Instance/MetricsManager/StMgr handle config. I would suggest to keep this consistent across different services and change all services in one go if we do this change.,686970553,2017-05-09 10:19:33
24120612,10216235,115401733,23,i don't think its a good idea making this as complicated as SystemConfig. It looks very heavy weight for this purpose,686970553,2017-05-09 10:41:06
24120612,10216235,115401888,38,Again my same comments as above. We really do not want to make things this modular (and complicated) at this stage. Start with something simple and see how it evolves,686970553,2017-05-09 10:43:31
24120612,10216235,115401969,74,Not very often. Would prefer to be in info mode for better visibility,686970553,2017-05-09 10:44:48
24120612,73683,115519104,212,"By keeping this here we're continuing to perpetuate a pattern that we should avoid/remove. If there are no current consumers of this and we don't want consumers, it seems better to not include it than to maintain consistency.",686970553,2017-05-09 22:22:44
24120612,73683,115523217,23,"Using an enum of supported key values, that includes their types and default values isn't really heavyweight, it's good practice. It leads to easier to understand code with fewer bug and a better user experience. By following the approach in SystemConfig ",686970553,2017-05-09 22:37:23
24120612,73683,115525699,38,There's a lot of code in Heron that has evolved in a way that has been loose/sloppy/bug prone/hard to maintain because short cuts were made initially. Before and after open sourcing we spent a lot of time cleaning up tech debt. Search for PRs that include,686970553,2017-05-09 22:46:39
24120612,73683,115535141,99,"By following an OO approach using a handler interface (versus the procedural approach) we can support the following:

- ability to share common code in abstract or concrete superclasses (
- ability to use the decorator or filter pattern for common hand",684767777,2017-05-09 23:24:09
24120612,10216235,115542428,14,Done,684767777,2017-05-09 23:54:54
24120612,10216235,115543074,99,"a) Not sure what prevents us from sharing code with the current approach?
b) same as above
c) we still have all the unittests for each of these components
d) I dont believe that the current implementations are huge by any means
e) I especially want to",684767777,2017-05-09 23:57:42
24120612,73683,115577048,99,"a.) The current approach allows us to share code via composition. Using a handler interface allows that as well as via polymorphism or the decorator pattern, the filter pattern or the template pattern, which can be useful in request handling.
c.) Note th",684767777,2017-05-10 02:11:20
24120612,11442576,115587739,49,"The `LocalFSStorageTest` here is in consistency with the class it's testing,i.e. `LocalFSStorage`.

If we make this change, then we also need to update the `LocalFSStorage.java` to `LocalFileSystemStorage.java`.

Let me know your thoughts.",686970553,2017-05-10 03:00:08
24120612,10216235,115590497,99,My meta comment about this request is that it makes the whole thing too complicated. I always favor simple(and working) solutions first before going to one thats very modular. I still stand by that argument.,684767777,2017-05-10 03:13:06
24120612,73683,115617594,49,+1 to update all classes to use FileSystem instead of FS.,686970553,2017-05-10 05:29:16
24120612,11442576,115622074,49,done,686970553,2017-05-10 05:59:36
24120612,73683,116068061,168,How is the implementation of this method different from handleTMasterRegisterRequest? They appear to be duplicates.,690362790,2017-05-12 01:29:46
24120612,73683,116060454,157,"If the directory doesn't exist that should be an exception correct? If it's never acceptable for this method to not create a dir, let's change to return `void` and throw upon failure.",690362790,2017-05-12 00:58:25
24120612,73683,116069013,154,"please don't swallow `e` here and elsewhere where this code is copied. Also please don't copy the logic. Instead make a helper method to do this consistently.
```
LOG.warning(""Failed to close connection from: "" + connection.socket().getRemoteSocketAddre",690362790,2017-05-12 01:33:47
24120612,73683,116056213,203,omit ': ',690362790,2017-05-12 00:39:52
24120612,73683,116059937,26,"I mentioned this in the other PR, which is that we should store something more structured than just an arbitrary byte array. IIRC we're only storing bytes for now while prototyping. If that's the case can we rename this from `saveBytes` to something more ",690362790,2017-05-12 00:56:16
24120612,73683,116060745,175,Can we add unit tests for these methods? This will keep a change in path naming structure from being introduces inadvertently between releases.,690362790,2017-05-12 00:59:37
24120612,73683,116055957,168,we should include the classname in this message as well.,690362790,2017-05-12 00:38:49
24120612,73683,116056922,27,"Can this be a Config class of some sort, instead of OBJECT?",690362790,2017-05-12 00:43:01
24120612,73683,116062396,152,"Can we refactor how tests are run to not need this sleep (and all the others)? Tests that require sleep are likely going to be flaky. Also  Hardcoding sleep times in tests has slows down CI, which is already too long (this class spends 20 seconds just sle",690362790,2017-05-12 01:06:27
24120612,73683,116069634,254,"please remove `res`, it's not used.",690362790,2017-05-12 01:36:33
24120612,73683,116063767,229,Let's use static imports for all the `Assert.assertFoo` calls as well to improve readability.,690362790,2017-05-12 01:12:11
24120612,73683,116062162,139,ouch. `HeronSocketOptions` also needs to be updated to use ByteAmount in another pr.,690362790,2017-05-12 01:05:34
24120612,73683,116061229,68,lots of duplication of boilerplate constants and `before()` logic in each of the stateful storage tests and in `CheckpointManagerServerTest`. Can we share this code in some test helpers?,690362790,2017-05-12 01:01:42
24120612,73683,116058443,130,s/mockFSDateOutpurStream/mockFSDateOutputStream,690362790,2017-05-12 00:49:53
24120612,73683,116068305,215,Please favor `String.format(...)` for readability here and elsewhere.,690362790,2017-05-12 01:30:46
24120612,73683,116066403,115,What happens when an unchecked exception occurs w.r.t. the response sent?,690362790,2017-05-12 01:23:17
24120612,73683,116057436,14,I'm not seeing any changes since my initial comment. Also please add test to `FileUtilsTest`.,684767777,2017-05-12 00:45:09
24120612,73683,116065723,116,"Here and elsewhere in this class can we do `LOG.log(Level.WARNING, ""Request to dispose checkpoint with id ... failed with error"", e);` (or log error) so we don't swallow the stack trace?

Also can we add a message to `Status.message` as well when we fai",690362790,2017-05-12 01:20:25
24120612,73683,116064442,81,Any chance these request classes can be part of an protobuf enum so we could use a case statement instead of the if-else/instanceof stuff?,690362790,2017-05-12 01:15:07
24120612,73683,116070699,94,Can we change this method so it doesn't mutate the state of the checkpoint passed to it and instead have it return a new Checkpoint? Generally it's preferred to favor immutability and to have methods without side effects. It also makes the contract very c,690362790,2017-05-12 01:40:44
24120612,73683,116067201,138,"This assertion logic is copied in this class. Please make a generic assertValidRequest method so we can get code reuse.

How come the assertion of valid topologyName and topologyId only happens in some methods but not all?

(I have a broader question ",690362790,2017-05-12 01:26:29
24120612,73683,116056786,163,Can we not support generic OBJECT? The idea is to only support specific types.,690362790,2017-05-12 00:42:23
24120612,73683,116059475,77,Can we name this method better? It can be a bit confusing having a Checkpoint class with a checkpoint() method.,690362790,2017-05-12 00:54:14
24120612,73683,116055623,152,s/checkpointsBackend/statefulStorage,690362790,2017-05-12 00:37:40
24120612,10216235,116085678,14,The changes are on the ckptmgr side of things. I don't want to change in the FileUtils layer yet because all other calls there are all returning status as return value(as opposed to throwing exceptions).,684767777,2017-05-12 02:49:07
24120612,10216235,116087811,26,"I'll rename the saveBytes, but this description should go in the proto file actually when we do make changes to a more structured form",690362790,2017-05-12 02:59:52
24120612,10216235,116089907,152,done,690362790,2017-05-12 03:10:22
24120612,10216235,116090293,152,"WRT refactor of IStatefulStorage, we really cannot predict what kind of storage mechanism will be used. The first two might look similar but lets say if the next one is cassandra, then no longer we deal with files/dirs but with keyspaces.",690362790,2017-05-12 03:12:19
24120612,10216235,116090313,168,done,690362790,2017-05-12 03:12:24
24120612,10216235,116090332,203,done,690362790,2017-05-12 03:12:30
24120612,10216235,116090384,77,done,690362790,2017-05-12 03:12:47
24120612,73683,116101981,152,"Is this comment in response to mine about the IStatefulStorage impls to use a common hierarchy? If so I wasn't suggesting that they all need to, but those that are file based should have a common hierarchy since their implementations will be very similar.",690362790,2017-05-12 04:04:43
24120612,10216235,116114798,94,done,690362790,2017-05-12 05:13:33
24120612,10216235,116116113,157,Fixed,690362790,2017-05-12 05:22:07
24120612,10216235,116116326,81,Not sure we want to pollute the proto structures with enums. The fact that we are doing enum is just a limitation of our java Client interface. Probably a cleanup needed there in a separate change,690362790,2017-05-12 05:23:37
24120612,10216235,116116413,115,Not sure what you mean by response sent? You mean at the client side?,690362790,2017-05-12 05:24:18
24120612,73683,116117696,115,"When a checked exception occurs, you set the status to NOTOK, create a responseBuilder and call sendResponse. What happens when an unchecked exception occurs? Does the status still get properly set (by the superclass?), and does the response get properly ",690362790,2017-05-12 05:33:14
24120612,10216235,116117816,116,No longer swallowing the exception,690362790,2017-05-12 05:34:09
24120612,73683,116118077,81,"Thrift allows the ability to do something like this (psuedo-code), which is really convenient for thinks like this. It doesn't seem like protobufs allows this though. It seems to limit the enum values to just constants, which is unfortunate.
```
enum Re",690362790,2017-05-12 05:36:05
24120612,10216235,116118504,138,This check only happens for the register requests. And the log message etc are all different and the checks are very minor. Thats why it's not worth refactoring them.,690362790,2017-05-12 05:39:25
24120612,10216235,116118548,154,done,690362790,2017-05-12 05:39:38
24120612,10216235,116118583,168,The error messages are different,690362790,2017-05-12 05:39:54
24120612,10216235,116119011,254,removed,690362790,2017-05-12 05:42:56
24120612,10216235,116122981,215,done,690362790,2017-05-12 06:08:58
24120612,10216235,116125078,115,The IStorageInterface declares that only StatefulStorage exceptions are thrown. Isn't that not sufficient?,690362790,2017-05-12 06:25:56
24120612,73683,116151043,115,That's totally sufficient for the implementors of IStorageInterface. The issue I'm seeing is that one of them throws an unchecked exception due to a bug. In that case that exception seems like it will get thrown all the way up to HeronServer.handleAccept ,690362790,2017-05-12 11:26:44
24120612,73683,116151440,37,s/getBackendConfig/getStatefulStorageConfig,691093819,2017-05-12 11:32:37
24120612,73683,116151470,38,s/backendConfigObject/statefulStorageConfigObject,691093819,2017-05-12 11:33:00
24120612,73683,116151509,44,s/backend/stateful,691093819,2017-05-12 11:33:39
24120612,73683,116151522,25,s/backend/stateful,691093819,2017-05-12 11:33:57
24120612,73683,116151533,30,s/backend/stateful,691093819,2017-05-12 11:34:06
24120612,73683,116151557,41,s/checkpointsBackend/statefulStorage,691093819,2017-05-12 11:34:26
24120612,73683,116151577,47,s/checkpointsBackend/statefulStorage,691093819,2017-05-12 11:34:46
24120612,73683,116151648,82,s/backendStorage/statefulStorage,691093819,2017-05-12 11:35:37
24120612,10216235,116152481,115,"If the exception runs all the way to slaveLooper runnable, that would actually kill the ckptmanager. Thus its kind of a fail fast approach. ",690362790,2017-05-12 11:48:47
24120612,10216235,116152812,82,All backendConfig have been changed to statefulStorageConfig,691093819,2017-05-12 11:54:37
24120612,73683,116154515,115,"I thought the checkpoint manager was a long-running daemon that should be up for the duration of the topology? If that's the case, we wouldn't want an exception thrown during a single RPC call to kill it, right?",690362790,2017-05-12 12:20:10
24120612,10216235,116272917,115,Just stmgr/metricsmgr/tmaster any 'bugs' will result in the daemon process being killed and restarted by the executor. So in that way its pretty consistent with the rest of the system,690362790,2017-05-12 23:36:45
24120612,73683,116281959,177,The methods below are all duplicated in LocalFileSystemStorage.java. Please share them somehow.,691655115,2017-05-13 00:23:24
24120612,73683,116285122,86,lots of duplication of boilerplate constants and `before()` logic in each of the stateful storage tests and in `CheckpointManagerServerTest`. Can we share this code in some test helpers?,691655115,2017-05-13 00:38:55
24120612,73683,116284846,49,"These can all be local variables in setup() except for TOPOLOGY_NAME and CHECKPOINT_ID. All others are not used, except during initialization.",691655115,2017-05-13 00:37:30
24120612,73683,116282028,41,ROOT_PATH_KEY is duplicated in LocalFileSystemStorage.java. Please share it somehow.,691655115,2017-05-13 00:23:45
24120612,73683,116283455,138,There are 9 lines of duplicated validation code in two adjacent methods. Can we please share that in a common assertion method?,690362790,2017-05-13 00:30:44
24120612,10216235,116288699,41,They have different values and are specific to their own implementation. Not sure how we could share those. ,691655115,2017-05-13 00:55:37
24120612,73683,116289406,41,I see. I missed that part.,691655115,2017-05-13 00:58:32
24120612,11442576,116291155,49,updated,691655115,2017-05-13 01:06:51
24120612,11442576,116291759,86,"refactored the code so that `LocalFileSystemStorageTest` and `HDFSStorageTest` shares same setup code.

not making this change to `CkeckpointManagerServerTest` code. Logically, it's separate from the other two, so I prefer also keep them separate on the",691655115,2017-05-13 01:09:34
24120612,10216235,116292477,177,"Again, I want to give maximum flexibility for these state managers to diverge in the future(which they almost certainly will).",691655115,2017-05-13 01:12:46
24120612,73683,116303125,177,"Why would we not want to standardize on a single directory structure layout for local versus hdfs? I would think we'd want to prevent their structure from diverging, not encourage it. This is similar to what we did with state server.",691655115,2017-05-13 02:04:00
24120612,73683,116316109,120,"Whenever we set a status code that is not OK, can we also set Common.Status.message as well to give a brief description of what went wrong. This will help when troubleshooting a failed RPC from the client logs, by removing the need to have to inspect the ",691691439,2017-05-13 03:18:39
24120612,10216235,116330252,177,There could be several reasons. Local File System and HDFS differ in how they handle files/directories. Thus there might a chance that we might take a different route in a production hdfs environment minimizing directories and just going plain files. Whil,691655115,2017-05-13 04:45:45
24120612,73683,116330876,177,"The local filesystem is for testing and would be best to be implemented the same w.r.t. structure as the HDFS version, so people see apples-to-apples of what HDFS does. Having inconsistencies between the two seems really undesirable.",691655115,2017-05-13 04:50:38
24120612,73683,116331124,82,This class still uses backendStorage.,691093819,2017-05-13 04:52:27
24120612,73683,116331173,50,s/localFileSystemBackend/localFileSystemStorage,691816863,2017-05-13 04:52:53
24120612,10216235,116331632,120,done,691691439,2017-05-13 04:56:32
24120612,10216235,116331929,82,Fixed,691093819,2017-05-13 04:59:08
24120612,73683,116332497,183,Can we set an error message here?,691824441,2017-05-13 05:03:37
24120612,73683,116332482,153,Can we set an error message here?,691824441,2017-05-13 05:03:28
24120612,73683,116332572,212,This errorMessage is never set on the response.,691824441,2017-05-13 05:04:09
24120612,73683,116332661,265,This errorMessage is never set on the response.,691824441,2017-05-13 05:04:58
24120612,10216235,116333403,265,fixed,691824441,2017-05-13 05:11:30
24120612,10216235,116333426,212,fixed,691824441,2017-05-13 05:11:40
24120612,10216235,116333443,183,fixed,691824441,2017-05-13 05:11:47
24120612,10216235,116333450,153,fixed,691824441,2017-05-13 05:11:53
24120612,11442576,116333939,177,"IMO, where and how the checkpoints are stored is totally decided by the actual implementation of different storages. LocalFSStorage and HDFSStorage are totally separate implementations. Putting a same standard on them seems unnecessary to me.",691655115,2017-05-13 05:16:06
24120612,73683,116338381,177,"Do you really think it's the best developer experience for us to implement the two filesystem layouts differently? Based on that logic, we should also implement the local filesystem's `IStateStorage` class differently than we implement the Zookeeper imple",691655115,2017-05-13 05:56:32
24126385,13159450,114886142,12,can we use `std::chrono::seconds::zero()` here?,685152299,2017-05-05 03:58:29
24126385,32022953,114900227,12,done,685152299,2017-05-05 05:16:17
24126385,3201045,115808179,8,"the comment does not read well. it should be rephrased as 
// If the count is greater than target, then wait until the count reaches the value of target.",685566609,2017-05-11 00:52:20
24126385,3201045,115811900,8,I am assuming d is duration - can make it a descriptive name?,685566609,2017-05-11 01:06:45
24126385,32022953,115814538,8,done,685566609,2017-05-11 01:18:07
24158458,3201045,114942186,5,Instead of using global variable - can you the function directly where a port is needed?,685562476,2017-05-05 14:20:36
24158458,3201045,114941985,9,Can you return SP_NOTOK to be consistent with other functions?,685562476,2017-05-05 14:18:46
24158458,32022953,115095084,9,done,685562476,2017-05-06 04:58:30
24158458,32022953,115095100,5,done,685562476,2017-05-06 04:58:37
24163977,3201045,115598227,24,"Do we require tunneling? If not, please remove the tunnel configuration.",685627428,2017-05-10 03:47:47
24163977,3201045,115597592,8,Is this a local file system or it expects zookeeper?,685627428,2017-05-10 03:44:49
24163977,3201045,115599475,35,"Instead of adding code to this function, can we make a overall function called get_host - in which we can check whether it is running in docker or ECS or use socket.gethostname() and return the hostname. ",685627428,2017-05-10 03:52:39
24163977,3201045,115600120,58,There is a lot of hard coding of values here. Not sure why you need them?,685627428,2017-05-10 03:55:27
24163977,73683,115614554,92,"We should either throw an exception here, or log a warning to the logging framework, but we should not do `e.printStackTrace()`.",685627428,2017-05-10 05:09:14
24163977,73683,115614082,76,remove?,685627428,2017-05-10 05:06:00
24163977,73683,115614051,77,why does each container need a different set of port numbers?,685627428,2017-05-10 05:05:47
24163977,73683,115614428,85,"Does ECS always use docker containers? I thought you could also just run a given AMI without docker, no?",685627428,2017-05-10 05:08:13
24163977,73683,115615748,147,return builder.toString();,685627428,2017-05-10 05:16:42
24163977,73683,115610784,58,+1 for removing as much of this hard-coding as possible.,685627428,2017-05-10 04:47:04
24163977,73683,115614728,105,Why are all these methods public?,685627428,2017-05-10 05:10:17
24163977,73683,115609736,24,Tunneling could be needed for any of the schedulers and they're valid configs so I think it's ok to keep them in the config file. Maybe we set it to False by default though.,685627428,2017-05-10 04:41:36
24163977,73683,115613638,46,please include empty line between members and methods,685627428,2017-05-10 05:02:57
24163977,73683,115611529,27,"please remove and replace with valid javadocs, without personal attribution. Same for other classes.",685627428,2017-05-10 04:51:02
24163977,73683,115614170,81,Is `String.valueOf(` needed?,685627428,2017-05-10 05:06:36
24163977,73683,115611419,28,Both PART1 and CMD are only used once. No need to public statics for them. Also there are a bunch of built in assumptions in these commands that should be either config or command line driven. ,685627428,2017-05-10 04:50:24
24163977,73683,115610827,55,Why does this code require a dep on heron-examples.jar?,685627428,2017-05-10 04:47:18
24163977,73683,115615901,171,These methods all need to be implemented and annotated with @Override.,685627428,2017-05-10 05:17:43
24163977,73683,115615226,126,"Favor StringBuilder over string concat. Or better yet, use String.format(..)",685627428,2017-05-10 05:13:26
24163977,73683,115610897,54,Why does jvm location need to be hardcoded?,685627428,2017-05-10 04:47:39
24163977,73683,115613458,50,please remove empty lines before `}` lines in this class,685627428,2017-05-10 05:01:50
24163977,73683,115615368,118,please clarify in the javadocs what this method does. Also I suspect StringBuilder might be a better fit here.,685627428,2017-05-10 05:14:20
24163977,73683,115614914,116,The 5000 here and the logic in this method looks duplicative of other logic in this class. Can you consolidate?,685627428,2017-05-10 05:11:17
24163977,73683,115610325,35,+1 for ways to do this without one-off logic to support ECS.,685627428,2017-05-10 04:44:37
24163977,3201045,115650981,13,@ananthgs - why is this URL hard coded?,685627428,2017-05-10 11:13:44
24163977,3201045,115651177,28,@ananthgs - Is this image a generic ubuntu image downloaded from docker hub? or specially created image? If this is specially created image - what does it contain other than the basic OS?,685627428,2017-05-10 11:15:52
24163977,3201045,115651260,36,Why these ports are hard coded? Can we ask ECS to provide a dynamic port?,685627428,2017-05-10 11:16:50
24163977,2645428,115781909,8,It does expect zookeeper to be running on one of the ec2 instances. As suggested I will put up a document explaining the offline set ups on Amazon ec2 and the following steps on the scheduler.,685627428,2017-05-10 23:01:08
24163977,1165755,115902533,28,This seems to be similar to what we had to do with the Marathon Docker environment. You can basically run the executor on any image built with the Dockerfile in the `docker/Dockerfile.dist.ubuntu<version>` image. The issue here is that we don't currently ,685627428,2017-05-11 11:20:32
24163977,1165755,115902665,54,"If your Docker image contains a pre-installed version of the Java 8 JRE, you should be able to reference $JAVA_HOME here. You should also be able to set that from within the scheduler configuration as well, via the `heron.directory.sandbox.java.home` opti",685627428,2017-05-11 11:22:55
24163977,1165755,115903668,86,Can you please explain what the process is here for creating this docker.yml file just so I understand what's going on? What is it used for and what is it composed of -- just so I can understand a little better.,685627428,2017-05-11 11:37:55
24163977,1165755,115903013,40,No need for this line since you won't be grabbing `os.environ['HOST']` after this,685627428,2017-05-11 11:28:31
24163977,1165755,115903288,30,That paths to the core binaries will need to be more dynamic than this and will need to feed out of the `heron.package.core.uri` configuration option in the scheduler library right?,685627428,2017-05-11 11:32:36
24163977,11442576,115906650,38,same hard code url problem,685627428,2017-05-11 12:19:19
24163977,11442576,115907247,171,"+1, please implement those methods in the following commits",685627428,2017-05-11 12:27:07
24163977,11442576,115907720,76,any specific reason not using this getFreePort() method but hard code the port number?,685627428,2017-05-11 12:33:46
24163977,11442576,115908519,159,log the event of starting normal container here,685627428,2017-05-11 12:43:23
24163977,11442576,115906548,13,"please remove hard coded url addresses

pass it from out side if necessary",685627428,2017-05-11 12:17:51
24163977,11442576,115907313,168,an empty ArrayList is better than a null,685627428,2017-05-11 12:27:49
24163977,2645428,116126199,28,"This docker image contains ububtu, java, python, heron-clinet, heron-tools and aws s3 cli. I agree with @ jrcrawfo if there is a plan to have a Docker repo we can leverage it.
",685627428,2017-05-12 06:35:11
24163977,2645428,117130339,24,Done set default to false,685627428,2017-05-18 06:06:34
24163977,2645428,117130437,13,"done, Passing it as argument",685627428,2017-05-18 06:07:13
24163977,2645428,117130515,35,added gethost function ,685627428,2017-05-18 06:07:42
24163977,2645428,117130577,40,Done ,685627428,2017-05-18 06:08:09
24163977,2645428,117130739,28,Removed the hard coding. Created a template.yaml file which will be used instead.,685627428,2017-05-18 06:09:20
24163977,2645428,117130767,36,Done removed hard coded ports,685627428,2017-05-18 06:09:37
24163977,2645428,117130822,54,Done.,685627428,2017-05-18 06:10:03
24163977,2645428,117130856,58,Done. ,685627428,2017-05-18 06:10:21
24163977,2645428,117130942,27,removed IDE generated lines.,685627428,2017-05-18 06:10:55
24163977,2645428,117131336,46,Done,685627428,2017-05-18 06:13:47
24163977,2645428,117131476,76,Changed to using getFreePorts(),685627428,2017-05-18 06:15:01
24163977,2645428,117131541,81,Done ..,685627428,2017-05-18 06:15:31
24163977,2645428,117131592,81,Removed the String.valueOf ,685627428,2017-05-18 06:15:55
24163977,2645428,117131956,85,The Default ECS Cluster Formation uses the ecs tasks where in we can pass the docker image and an entry point to start each of the containers. Not sure on the AMIs .. ,685627428,2017-05-18 06:18:42
24163977,2645428,117132000,92,Done,685627428,2017-05-18 06:19:01
24163977,2645428,117132048,116,Done.,685627428,2017-05-18 06:19:20
24163977,2645428,117132123,126,I agree. Will modify,685627428,2017-05-18 06:19:44
24163977,2645428,117132423,168,Added the get joblink feature to return the ecs tasks,685627428,2017-05-18 06:21:43
24163977,2645428,117662643,86,"The AWS ECS task can be triggered via a docker style compose command.  This Task is then run on the AWS Cluster in a Container instance. The overall approach is explained  here : 
https://docs.google.com/document/d/1ecbCuA46cIKPfY0SP0F1dcRlei4DIPz3pZ6ZSZ",685627428,2017-05-22 12:08:52
24169875,32022953,115080362,10,i would suggest throw it so that all `halt()` in one same place at line 230,685811409,2017-05-06 03:21:47
24169875,2183863,115084138,10,"I would prefer to halt() directly here, since:
1. It is more clear to know the process will fail fast without tracing other parts of the code.
2. It reduces extra operations, which are not guaranteed to execute during Error. For instance, catching excep",685811409,2017-05-06 03:44:53
24169875,32022953,115084413,10,ok,685811409,2017-05-06 03:46:28
24189274,13159450,115057600,43,How about adding a [bufsize=1](https://github.com/twitter/heron/blob/master/heron/tools/cli/src/python/execute.py#L71) here for better performance?,686292196,2017-05-06 01:13:41
24189274,13159450,115058334,29,I use while loop because of [this issue](http://bugs.python.org/issue3907). It seems that Python 2.7 fixed this issue but as you can see in the thread some people are still reporting seeing this issue in 2.7,686292196,2017-05-06 01:17:19
24287853,3201045,115596606,12,Do we need to need to have a global variable for saving the port? Can we add something in the class itself?,688412204,2017-05-10 03:40:13
24287853,32022953,115610865,4,comments added in the header.,688412204,2017-05-10 04:47:29
24287853,32022953,115611188,12,removed global variable,688412204,2017-05-10 04:49:04
24335005,32022953,115663627,15,is it possible that get() throws NoSuchElementException ,689501155,2017-05-10 13:45:38
24335005,11442576,115663706,15,see my comments above. It's guaranteed the scheduledresource is set,689501155,2017-05-10 13:46:21
24335005,32022953,115664055,15,???? ,689501155,2017-05-10 13:49:34
24383894,10216235,119702924,5,"When metrics mgr client is created, you are going to supply it a port to connect to. Supplying 0 should not be an option at all. Thus I dont understand why this method is required at all.",691828732,2017-06-02 02:06:46
24383894,2508294,119705607,5,The metrics mgr client contructor does initiates the connection until the client Start(). This method is to supply the actual stmgr port before metrics mgr client Start(),691828732,2017-06-02 02:19:31
24383894,10216235,119706741,5,IMO the most cleanest solution would be to not create metrics mgr client until you are ready to start it in the first place. That would avoid all this unnecessary code. Thoughts?,691828732,2017-06-02 02:24:46
24383894,2508294,119707850,5,agree. it will touch more code in the stmgr. will do,691828732,2017-06-02 02:30:27
24383894,32022953,120740685,5,@srkukarni I found that it needs alot refactoring to create clients after the server gets actual port. too many objects need metrics_manager_client_ and tmaster_client_ before StMgrServer binds to port 0.,691828732,2017-06-08 03:48:39
24383894,10216235,120746545,5,"@huijunw If you can hold on for a week or so, I have other refactoring coming in stmgr that hopefully should alleviate some of this",691828732,2017-06-08 04:14:27
24383894,13159450,121494158,5,"@srkukarni can we merge our PR first, you merge with master, and continue with your refactor?",691828732,2017-06-13 01:43:03
24383894,32022953,121799281,5,"We saw this test failure a lot and we suffer from it. Do you have any ETA when your refactor could be merged?
How about I fix this test failure first and then later align to your changes when your refactoring is available? Will create an issue for tracki",691828732,2017-06-14 04:17:28
24383894,10216235,121508295,5,My feeling is that this pr breaks abstractions and should be avoided unless its breaking something in production.,691828732,2017-06-13 02:45:35
24383894,10216235,133168270,24,also eventloop should not necessary here. Its already passed to us in the constructor,760645705,2017-08-15 18:27:53
24383894,10216235,133168880,24,Could you please elaborate why this portion of code moved?,760645705,2017-08-15 18:32:03
24383894,10216235,133168111,24,an assert that client is null,760645705,2017-08-15 18:26:42
24383894,10216235,133168005,14,Can you specifically set client_ = null,760645705,2017-08-15 18:26:00
24383894,10216235,133168435,34,shouldnt this be options_?,760645705,2017-08-15 18:29:06
24383894,32022953,133315407,24,explanation added in comments.,760645705,2017-08-16 05:01:13
24383894,32022953,133315425,34,fixed,760645705,2017-08-16 05:01:20
24383894,32022953,133315444,24,updated,760645705,2017-08-16 05:01:27
24383894,32022953,133315466,14,done,760645705,2017-08-16 05:01:34
24383894,3201045,118148277,5,why this check?,691828732,2017-05-24 09:09:29
24383894,3201045,118148630,6,@huijunwu - I saw this fragment of code repeating in another PR. Can you write a small utility function in sockutils.cpp - getPort - given the socket and use that function here?,691828732,2017-05-24 09:12:01
24383894,3201045,118148814,21,Use references instead of pointers,691828732,2017-05-24 09:14:08
24383894,3201045,118148868,6,why this check?,691828732,2017-05-24 09:14:49
24383894,2508294,118155886,5,"If the input `_port` is zero, which is not a actual port in use, it is not a valid input.
If the existing `port_` in `MetricsMgrClient` is not zero, it should not be set to another value during `MetricsMgrClient` lifetime.",691828732,2017-05-24 10:33:26
24383894,2508294,118156103,6,"This PR depends on #1847. This piece code appears only once.
If #1847 is merged, this code will not be highlighted here.",691828732,2017-05-24 10:35:41
24383894,2508294,118156173,21,"Copied from #1847:
The compiler complained on reference here",691828732,2017-05-24 10:36:46
24383894,2508294,118156343,6,"Similar to `MetricsMgrClient::SetPublisherPort`
The `stmgr_port_` should be set once if it was originally zero and keeps same during its lifetime.",691828732,2017-05-24 10:38:52
24448635,11442576,116625569,27,"can we use a separate `directGroupingTragetTaskIds` to handle direct grouping cases? Also instead of using `if... else if`, can we separate the handling of direct grouping and custom grouping?",691831064,2017-05-16 06:36:00
24448635,73683,116666948,27,"@nlu90 I tried splitting up the code paths and it got pretty redundant and hard to follow. 

To remove the if/then I'd need to do the emit direct check at a higher level when creating the tuple builder. But the tuple builder is created in both SpoutOutp",691831064,2017-05-16 13:57:32
24448635,11442576,117078816,27,"kk, I see what you mean",691831064,2017-05-18 01:36:36
24533177,13159450,116624861,39,"like other questions, shall we also do `ByteAmount` here? I assume you are following some principle here: what are converted to ByteAmount, what are converted. Can you elaborate a bit?",693746832,2017-05-16 06:29:46
24533177,13159450,116624622,9,also `ByteAmount` here?,693746832,2017-05-16 06:27:54
24533177,13159450,116623792,29,"Just curious since I don't have a strong opinion here: in this kind of scenario, shall we use [greaterThan](https://github.com/twitter/heron/blob/master/heron/common/src/java/com/twitter/heron/common/basics/ByteAmount.java#L179) API instead?",693746832,2017-05-16 06:20:38
24533177,73683,116662513,29,"The collector and the simulator both still track how many bytes they've emitted as a long, so I convert to that and do the comparison. I've mainly just been converting the static `ByteAmounts` that are read from the configs, but not the dynamic ones that ",693746832,2017-05-16 13:20:21
24533177,73683,116662669,9,"Same comment as above. For now, holding off on updating dynamic byte amounts.",693746832,2017-05-16 13:21:30
24533177,73683,116662739,39,See my response above. Holding off on highly dynamic byte counters for now.,693746832,2017-05-16 13:22:10
24539508,73683,117104054,5,"We want to use plural here for consistency, right? `statefulcheckpoints`",695242822,2017-05-18 03:38:25
24539508,11442576,117108626,5,good catch. I'll update them all to `statefulcheckpoints`,695242822,2017-05-18 03:59:35
24539522,73683,116795902,19,"This method should set a single checkpoint, so `StatefulConsistentCheckpoint` not `StatefulConsistentCheckpoints`. It will also need to set them in a way that we can a.) delete a single checkpoint and b.) identify the packing plan that it's bound to.",693876921,2017-05-16 23:44:46
24539522,73683,116794967,26,The object contains multiple checkpoints so we should put an 's' on the method name. Also can it take some identifier of the currently topology like the packing plan id? For example upon restarting a topology we need to know if the previous checkpoints ar,693876921,2017-05-16 23:40:39
24539522,11442576,116819973,26,"added the 's'.

Checkpoint state is bounded to an instance. And instance is a logical concept. Where is the instance running should not affect what the instance checkpoint state is. So the mapping of checkpoints and packing plan id is not needed to me.",693876921,2017-05-17 01:22:53
24539522,11442576,116820916,19,"If only a single checkpoint is allowed to set, then the topology is not able to recovery from some early states.",693876921,2017-05-17 01:26:52
24539522,11442576,116825234,26,"The packing plan id is already packed in the message `StatefulConsistentCheckpoint`
```
message StatefulConsistentCheckpoint {
  required string checkpoint_id = 1;
  required string packing_plan_id = 2;
  // One can add more meta data about this ckpt",693876921,2017-05-17 01:44:32
24539522,73683,116850697,288,The deleteStatefulCheckpoint method needs to take an identifier to make it clear which checkpoint is to be deleted. The state server stores multiple checkpoints per topology,694420785,2017-05-17 03:35:42
24539522,73683,116852130,19,"Multiple checkpoints must be persisted and managed by the state server, but they're set one by one, each time a new one is created. Think of it as a Heap, where new ones are pushed to the head and old ones are periodically deleted from the tail. At any ti",693876921,2017-05-17 03:42:02
24539522,73683,116850988,269,"setStatefulCheckpoint sets a specific checkpoint, not a collection.",694420785,2017-05-17 03:36:53
24539522,73683,116853261,26,"We should store the checkpoints in a way that allows us to easily delete (or manually browse when troubleshooting) an entire set by the packing plan hash and checkpoint id, so we should considering including those in the path in the directory tree.

Con",693876921,2017-05-17 03:46:38
24539522,10216235,116856581,269,The proto structure thats stored in the statemgr is the actual list. Not just the last one.,694420785,2017-05-17 04:00:50
24539522,10216235,116856785,288,All manipulation of the proto structure happens inside the relevant servers. This class purely is for interfacing with the statemgr to store/retrieve/delete,694420785,2017-05-17 04:01:35
24539522,11442576,116858745,19,"Storing a list of checkpoints achieves the same result as the solution you proposed here. Plus it's much more simpler in terms of implementation and management.

To manage those checkpoints, the TMaster could fetch all of them in the state managers and ",693876921,2017-05-17 04:10:24
24539522,11442576,116860331,26,The actual checkpoints are stored in the stateful storages not in the state manager. State manager only stores the ckpt id (which reference the actual checkpoint) and pp_id(which corresponds the ckpt_id).,693876921,2017-05-17 04:16:52
24539522,11442576,116860562,269,maybe `setStatefulCheckpoints` makes more sense,694420785,2017-05-17 04:17:54
24614424,3201045,118610704,75,Update the print out if changed to constant,700255069,2017-05-26 06:56:06
24614424,3201045,118610668,74,Should we use constants instead of hard coded 5 secs?,700255069,2017-05-26 06:55:47
24614424,32022953,118613568,74,done,700255069,2017-05-26 07:25:21
24614424,32022953,118613595,75,"done
",700255069,2017-05-26 07:25:29
24614424,3201045,118147426,29,@huijunw - instead of * can you use reference like sp_uint32& port?  It is much more easy to read.,695333668,2017-05-24 09:05:43
24614424,3201045,118147507,5,@huijunw - do you need this message?,695333668,2017-05-24 09:06:36
24614424,3201045,118147659,21,use reference instead of pointer for both port and latch?,695333668,2017-05-24 09:07:44
24614424,2508294,118156878,5,"This printout is added for future diagnosis. 
The timeout issue was not reproduced. I suspect the timeout issue may be due to this timer action. 
It does not print a lot since it is supposed to be called only once.",695333668,2017-05-24 10:45:16
24614424,2508294,118156942,29,The compiler complained on the reference,695333668,2017-05-24 10:46:01
24614424,2508294,118156962,21,The compiler complained on the reference,695333668,2017-05-24 10:46:11
24619095,3201045,120197401,6,if you are using auto there is no need for auto*,707983329,2017-06-06 03:11:22
24619095,32022953,120506724,6,done,707983329,2017-06-07 06:52:24
24619095,10216235,133622543,14,this breaks one fundamental invariant in tmaster design. No operations before verifying that we are the master. ,762080404,2017-08-17 11:45:50
24619095,2508294,133642882,14,What is the reason for 'No operations before verifying that we are the master'?,762080404,2017-08-17 14:41:49
24619095,32022953,134037113,14,@srkukarni ^^,762080404,2017-08-19 02:23:38
24619095,10216235,134059334,14,"One of the fundamental assumptions in tmaster when it is processing requests is that it is already established itself as the master. This is to prevent multiple tmasters trampling on each other. Thats the reason, we do StartServer only after TMaster Estab",762080404,2017-08-19 04:28:29
24620220,11442576,117355846,170,This method seems not generic for most test cases to utilize. Can we put it back to the MetricsManagerServerTest?,696125884,2017-05-19 04:14:31
24620220,11442576,117356412,48,"this class packs mant interfaces, abstract classes and classes. How about creating separate files for them and only keep those needed here?",696125884,2017-05-19 04:17:31
24620220,11442576,117356059,179,can we avoid `Thead.sleep` here？,696125884,2017-05-19 04:15:39
24620220,73683,117371811,48,"Yeah good call @nlu90 . I moved `TestCommunicator` into `c.t.h.common.basics` to be along side `Communicator`. I also moved `awaitMultiCountMetric` into the test that needs it (not yet put up for PR).

The remaining inner classes are now more closely co",696125884,2017-05-19 05:49:46
24620220,11442576,117376141,48,???? ,696125884,2017-05-19 06:23:08
24621692,11442576,117378276,25,is this new line expected?,695447935,2017-05-19 06:41:38
24621692,11442576,117378350,4,could you add a test case for the auth failure?,695447935,2017-05-19 06:42:10
24621692,1165755,118123941,4,"Yes, I can try to add a test here where i'm looking for the specific response code",695447935,2017-05-24 05:44:10
24621692,1165755,118123986,25,"Nope, will reset that",695447935,2017-05-24 05:44:24
24627971,73683,117301046,7,Could we instead attempt to set the location again in ZK if it's lost?,695579417,2017-05-18 23:58:56
24627971,10216235,117322442,7,"According to zk semantics, this situation should never happen. If it happens it certainly is a zk client/server bug and we are already in a bad state. better to die and restart fresh",695579417,2017-05-19 01:37:58
24627971,11442576,117322640,7,"1. IMO, Fail fast in this case is better. TMaster only knows the fact that its location is lost but doesn't know the exact cause. So cleaning itself up and then resetting its location from scratch is cleaner.
2. From implementation side, ""set the locatio",695579417,2017-05-19 01:38:52
24627971,73683,117327687,7,"Is it possible that a lost ZK location gets recovered or once it's lost is it lost for good? Is there a scenario where brief network faults would cause this to be lost and the quickly recovered? I suspect it's lost for good, but I don't know for sure.",695579417,2017-05-19 02:01:30
24627971,11442576,117337850,7,"Based on the problematic topologies we investigate, if the location is lost, then it's just lost for good. Even the connection between the tmaster container and zk is alive, the location is still not recovered.",695579417,2017-05-19 02:51:01
24627971,32022953,117342532,7,"shall we reuse the existing code
```
master_establish_attempts_ = 0;
EstablishTMaster(EventLoop::TIMEOUT_EVENT);
```",695579417,2017-05-19 03:13:47
24627971,32022953,117343254,7,Tmaster trys to reconnect to zookeeper in `SetTMasterLocationDone()` for `master_establish_attempts_` times. Shall we somehow reuse that piece of code?,695579417,2017-05-19 03:17:05
24627971,11442576,117348507,7,"@huijunw killing and restarting the tmaster achieve the same result. In addition, it's cleaner and simplier",695579417,2017-05-19 03:39:54
24657378,73683,117373661,45,"Do we need this? We mostly refactored out the concept of ""sandbox"" by introducing config value wildcards.",696216151,2017-05-19 06:03:29
24657378,11442576,117376000,45,@billonahill how about change the name to `statefulStorageClassPath` which corresponds to `Context.schedulerClassPath`?,696216151,2017-05-19 06:22:07
24657378,73683,117380813,46,s/backendConfig/statefulStorageConfig,696253607,2017-05-19 07:05:59
24663643,11442576,117380850,25,rename it to `EXPECTED_RECORDS`?,696268934,2017-05-19 07:06:17
24663643,73683,117381610,25,It took all I had to not update that field :) because I didn't want to clutter up the diff. If everything else looks ok I can make that change.,696268934,2017-05-19 07:14:24
24663643,11442576,117381945,25,"kk, cool",696268934,2017-05-19 07:17:51
24693117,11442576,117857502,28,ambiguous comment,698055238,2017-05-23 05:12:29
24693117,11442576,117856253,40,"s/NULL/nullptr

and same for any following files",698055238,2017-05-23 05:04:41
24693117,11442576,117856893,32,comments for methods?,698055238,2017-05-23 05:08:46
24693117,10216235,118055141,32,Added,698055238,2017-05-24 00:30:00
24693117,10216235,118055170,40,Changed everywhere,698055238,2017-05-24 00:30:07
24693117,10216235,118055193,28,Corrected,698055238,2017-05-24 00:30:13
24724704,73683,117824755,13,Why do we need classpath and custom classpath? Can we get rid of the later?,697643401,2017-05-23 02:19:29
24724704,11442576,117828723,13,"`STATEFUL_STORAGES_CLASSPATH` is telling the jvm where are the stateful storage implementations (LocalFileSystemStorage, HDFSStorage).

`STATEFUL_STORAGES_CURTOM_CLASS` is telling the jvm where are additional classes needed by the stateful storage imple",697643401,2017-05-23 02:40:55
24724704,73683,117839863,13,Got it. Should we change `custom` to `additional` to be consistent with `Config.TOPOLOGY_ADDITIONAL_CLASSPATH`?,697643401,2017-05-23 03:38:38
24771146,11442576,117813448,37,update docstring,698790273,2017-05-23 01:25:33
24771146,11442576,117814329,64,Will this be blocked forever?,698790273,2017-05-23 01:29:05
24771146,13159450,117817882,64,"why? and what is ""this""?",698790273,2017-05-23 01:45:41
24771146,11442576,117823143,64,"If the `proc.wait()` call is blocked forever, then it will never return. And the method is blocked here. Just want to make sure this case won't happen.",698790273,2017-05-23 02:10:41
24771146,13159450,117825678,64,"no, none of the subprocess will block in heron-shell. And even if it blocks, server will return a HTTP timeout",698790273,2017-05-23 02:24:35
24771146,11442576,117840425,6,return doc also needs to be updated,698862127,2017-05-23 03:41:29
24771146,11442576,117840484,64,kk,698790273,2017-05-23 03:41:45
24778347,10216235,117846612,5,name it stateful_config_file maybe?,698928530,2017-05-23 04:11:16
24778347,11442576,117848802,5,renamed to `STATEFUL_YAML` to be consistent with other yaml files,698928530,2017-05-23 04:22:27
24832263,11442576,118541598,102,ditto,700014989,2017-05-26 00:43:01
24832263,11442576,118541534,93,is this return needed?,700014989,2017-05-26 00:42:44
24832263,73683,118548744,93,"Yes, since `Void` is uninstantiable. It's a placeholder to be used as a type where needed, but you can't actually return one, so you instead return null.",700014989,2017-05-26 01:14:18
24832263,11442576,118550614,93,"kk, cool",700014989,2017-05-26 01:22:35
24832266,11442576,118547166,52,"for the `physicalPlan` seems each test has its own value, can we make it a local variable?",700015051,2017-05-26 01:07:44
24836707,73683,118569871,8,Where does this field get set? Is this controlled by the user? The topology sets acking enabled or not for at least and at most once. How does exactly once get enabled and how does that relate to acking settings?,700098114,2017-05-26 02:52:57
24836707,73683,118569263,17,Why is this method required?,700098114,2017-05-26 02:49:48
24836707,73683,118569058,5,The 3 bool methods have identical implementations except for the `TopologyConfigVars` object checked. Can you have each method instead delegate to an internal helper that centralizes this logic that takes a `TopologyConfigVars` object?,700098114,2017-05-26 02:48:43
24836707,10216235,118578875,17,This will be required in stmgrs to see whether marker propagation needs to be done,700098114,2017-05-26 03:37:00
24836707,11442576,118587256,8,"It's set in the topology config: https://github.com/twitter/heron/blob/master/heron/api/src/java/com/twitter/heron/api/Config.java#L472

I think we need to clarify the relations of acking and exactly once and educate our users to set them properly. 

",700098114,2017-05-26 04:17:03
24836707,73683,118604643,8,"The user has 3 options: exactly once, at most once and at least once. Can this Config setting take an enum of one of those 3 and do the right thing re acking etc? If we have a simple approach like that, there is no user education required about the variou",700098114,2017-05-26 06:04:34
24836707,10216235,118579297,5,Done,700098114,2017-05-26 03:38:52
24836707,10216235,118579190,8,"This field gets set via Config.java in the api. This is controlled by the user.
https://github.com/twitter/heron/blob/master/heron/api/src/java/com/twitter/heron/api/Config.java#L202
explains the relation",700098114,2017-05-26 03:38:18
24836707,10216235,118604828,8,I feel that we kind of made that choice some time back. IMO it belongs to a different discussion and not really releveant to this pr.,700098114,2017-05-26 06:06:14
24836707,73683,118604861,5,Can IsTopologyStateful also call GetBooleanConfigValue?,700098114,2017-05-26 06:06:34
24836707,10216235,118606006,5,"Sorry, missed that. Fixed",700098114,2017-05-26 06:15:47
24836707,73683,118606020,8,"This PR is adding support for a boolean for exactly once, which I don't think we should do, so it is relevant. Doing so will create a poor user experience/design where the right combination of isExactlyOnce and acking needs to be set to for people to get ",700098114,2017-05-26 06:15:54
24836707,10216235,118606687,8,"This pr is not adding any new user facing config variables. It is just the implementation part of the already existing api(ACKING ENABLED, EXT1_ONCE, etc) that already exists in the Config.java which is the main user api. As such this api just addresses t",700098114,2017-05-26 06:21:13
24836707,73683,118608822,8,"Apologies, I missed that `Config.setTopologyExactlyOnceEnabled(boolean)` was already committed. That should be fixed before we ship. We've discussed the need for better support for how users specify semantics in the past, and the desire to get rid of the ",700098114,2017-05-26 06:40:01
24836707,10216235,118609511,8,"We could certainly clean that up in a later pr. However one good thing is that all of these methods are abstracted out by the config helpers. So when we make that change, its just a matter of making the change in this class rather than in any other compon",700098114,2017-05-26 06:45:44
24836707,10216235,118609730,8,"BTW I also feel that the other change has wider implications. It would need a careful migration policy since existing topologies will have to be recompiled.
One good thing however is that heron api itself is not widely used, but the wrapper apis(Storm, e",700098114,2017-05-26 06:47:38
24836707,73683,118612554,8,I would envision we deprecate the `setAckingEnabled` method for a few releases while updating it's implementation to set the semantics enum to atLeastOnce. Then we can migrate before ultimately removing the acking setter.,700098114,2017-05-26 07:13:14
24836707,73683,118613465,8,Opened issue #1904 to track refactoring out `setTopologyExactlyOnceEnabled`,700098114,2017-05-26 07:24:09
24837677,11442576,118591640,50,can we replace `sc2` with a meaningful name?,700114879,2017-05-26 04:40:20
24837677,11442576,118592397,174,"a nitpick, we can replace this and following `if..else` with `String s = ((i&1) == 0) ? ""A"" : ""B"";`",700114879,2017-05-26 04:44:35
24837677,73683,118603945,50,"Yes, good call. Updated.",700114879,2017-05-26 05:58:57
24837677,73683,118603959,174,"Yes, good call. Updated.",700114879,2017-05-26 05:59:01
24838219,11442576,118608087,28,also move this to `Constant`?,700121843,2017-05-26 06:33:12
24838219,73683,118610180,28,"Cool catch, updated.",700121843,2017-05-26 06:51:34
24838219,13159450,118784167,21,`final int`?,700921926,2017-05-27 03:29:21
24886958,11442576,118814817,4,"the method `InstallRequestHandler` and `InstallMessageHandler` on line 150 and 160 are also using the `new` and `delete` operator manage message memory, should we also update them？",701147257,2017-05-27 13:27:12
24886958,11442576,118814918,10,"line 59 mentioned memory leak, can we solve the issue also?",701147257,2017-05-27 13:33:03
24886958,11442576,118814586,1,should we put this `mempool` into `common/src/cpp/basics` dir?,701147257,2017-05-27 13:12:59
24886958,11442576,118814865,25,"the process is single-thread, any specific reason to use mutex to guard the access to the pool?",701147257,2017-05-27 13:30:13
24886958,10216235,118822705,1,Makes sense. Done,701147257,2017-05-27 22:21:40
24886958,10216235,118822716,25,Made it generic so that even multi threaded processes can use the interface.,701147257,2017-05-27 22:22:32
24886958,10216235,118822724,4,The Install methods are only in the control plane. Not worth using pool imo.,701147257,2017-05-27 22:22:53
24886958,10216235,118822744,10,"Not sure what the memory leak here is. Ideally would have had more comments.
I want to keep this change as logic less as possible so maybe we can find the leak and fix it in a separate pr. ",701147257,2017-05-27 22:24:16
24983574,3201045,119260051,20,@cckellogg - ubuntu is misspelled.,703561673,2017-05-31 09:42:50
24983574,3201045,118179912,9,"Do you need a string array for this, if the URL is going to always one?",703561689,2017-05-24 14:24:13
24983574,1165755,120674298,20,"With the tag, the only comment i have is to be sure we have tags corresponding to versions number. So, ideally, you'd be referencing something like `streamlio/heron:0.14.8`",703561673,2017-06-07 23:20:41
24983574,7235147,120722249,20,We are planning on publishing images for different operating systems so we came up with the convention heron:heron-version-os-version. So would publish a release image like this streamlio/heron:0.14.8-ubuntu14.04. What do you think?,703561673,2017-06-08 02:26:41
25128812,11442576,120249537,80,this is used by the heron UI to link the actually running job with the heron ui page. Are you sure `null` should be returned?,706471110,2017-06-06 08:47:36
25128812,11442576,120250510,201,you may also need to set disk space,706471110,2017-06-06 08:58:01
25128812,11442576,120249981,115,"`getScheduledResource()` should be used here to request the maximal container resource.

Basically, `Required Resource` is the resource generated from packing plan, and `Scheduled Resource` is the actually maximal resource.

For details, please check ",706471110,2017-06-06 08:52:07
25128812,11442576,120248800,86,could you log some message here to indicate the restart cmd is not supported,706471110,2017-06-06 08:39:49
25128812,11442576,120248873,98,"the commented log, please remove it if not needed.

misleading comments, please remove/update them if they are not correct in this code",706471110,2017-06-06 08:40:37
25128812,11442576,120249579,90,maybe some log here,706471110,2017-06-06 08:47:58
25128812,11442576,120250737,7,stateful.yaml also needs to be added into the kubernetes conf diretory,706471110,2017-06-06 09:00:34
25128812,11442576,120248293,53,"the ckptmgr-port is also needed for starting the checkpoint-manager if necessary. Though currently most topology doesn't start the ckptmgr, but the port is still needed.",706471110,2017-06-06 08:35:15
25128812,1165755,120798842,86,Done. In the controller,706471110,2017-06-08 11:42:18
25128812,1165755,120799010,115,Done,706471110,2017-06-08 11:44:48
25128812,1165755,120799698,7,Merged master and took care of this,706471110,2017-06-08 11:54:25
25128812,1165755,120799894,201,This is not yet supported in kubernetes,706471110,2017-06-08 11:57:06
25128812,3201045,120801800,201,"If this is not supported - when multiple containers/pods run in the same machine, how to do they divvy up the disk space - is there a formula?",706471110,2017-06-08 12:21:46
25128812,1165755,120939745,201,"I couldn’t find it immediately in the docs last night, but it seems like based on my reading there’s essentially no limit until the node runs out of space. They are planning to add this very soon though from what I read",706471110,2017-06-08 23:44:14
25128812,3201045,120942747,201,"got it. We can add this once the feature is available, the tracking issue is
https://github.com/twitter/heron/issues/1943",706471110,2017-06-08 23:57:08
25135143,73683,121234193,48,who calls `HandleInstanceStateStored`? Why does this need to be public?,709793125,2017-06-10 05:27:54
25135143,73683,121234487,30,Why is this redefined here?,709793125,2017-06-10 05:30:28
25135143,73683,121233984,37,please add class-level docs describing what this class does and what it's responsibilities are.,709793125,2017-06-10 05:26:10
25135143,73683,121234670,41,How do we know that a checkpoint is valid for a given packing plan? Should we build this into the id or bind it some other way? We will need this to know if a checkpoint can be assigned to a redeployed topology with a different packing plan.,709793125,2017-06-10 05:32:04
25135143,73683,121233857,6,Why is `StMgrMapConstIter` needed? I don't see it used anywhere.,709793125,2017-06-10 05:25:04
25135143,11442576,121799287,30,This is not redefining but forward declaration.  Details about forward declaration could be found here: https://stackoverflow.com/questions/4757565/what-are-forward-declarations-in-c,709793125,2017-06-14 04:17:29
25135143,11442576,121799279,6,removed. Will add it when used in the future code,709793125,2017-06-14 04:17:27
25135143,11442576,121799310,41,This is not a checkpointer's job. tmaster will be responsible for it.,709793125,2017-06-14 04:17:35
25135143,11442576,121799294,37,added,709793125,2017-06-14 04:17:31
25135143,11442576,121799302,48,"When tmaster received the InstanceStateStored message, it calls this method to notify the checkpointer. And also, checkpointer will let tmaster know if all states for the checkpoint_id are stored.

I'll update the comment",709793125,2017-06-14 04:17:33
25135143,73683,122070323,38,I've seen this method in a number of test classes. If you have ideas for how to effectively share test code like this that would be awesome.,714051310,2017-06-15 04:31:47
25215520,3201045,120436611,1,Please rename the file to build heron docker image.,708526579,2017-06-07 01:08:10
25215520,3201045,120436901,1,something like docker/build-docker-image.sh - it is confusing with build-docker.sh,708526579,2017-06-07 01:09:13
25215520,3201045,120435915,18,Why the tools is twice?,708526579,2017-06-07 01:05:28
25215520,3201045,120437188,7,Seems inconsistent in the documentation.,708526579,2017-06-07 01:10:22
25215520,7235147,120496953,18,removing,708526579,2017-06-07 05:24:50
25215520,7235147,120497212,1,how about build-heron-docker-image.sh?,708526579,2017-06-07 05:26:31
25215520,7235147,120497233,7,fixing,708526579,2017-06-07 05:26:37
25215520,3201045,120746514,13,run_build_docker please change build_docker_image,709702707,2017-06-08 04:14:18
25215520,3201045,120744404,5,No check is required.,709694590,2017-06-08 04:04:52
25215520,3201045,120744439,7,use mkdir -p ,709694590,2017-06-08 04:05:02
25242685,73683,120537042,5,"Great catch! Could we instead change `deactivateTopology` to return the new topology, and push the fetch into that method?",709053855,2017-06-07 12:24:58
25242685,7709647,120538920,5,"Thanks, and sure I'll take a look at it this week. I think that'd require modifying the argument list for deactivateTopology so that the new packing plan is available to construct the final Topology. Is that okay? Another way to do it would be to return a",709053855,2017-06-07 12:44:14
25242685,73683,120679510,5,"Ah right, we'd have to pass in proposedPackingPlan to the deactivateTopology method. That's unfortunate, but I think that's our best option. That way we can at least encapsulate the deactivateTopology logic to return a new valid topology that aligns with ",709053855,2017-06-07 23:40:57
25277240,73683,120768086,8,"Is there a way to covey that this doesn't actually represent a file or path on the local disk, but the name of the file that will be invoked on the executor?",709752507,2017-06-08 06:17:44
25277240,10216235,120771933,8,Suggestions please?,709752507,2017-06-08 06:47:38
25277240,73683,120965897,8,".desc(""The remote filename of the heron topology jar/tar/pex file to be run by the executor."")
.argName(""topology binary filename on the cluster"")",709752507,2017-06-09 01:34:59
25278039,73683,120997885,31,Is 2PC 2 Phase Commit? If so can we expand that here and elsewhere in this patch. That abbreviation is not obvious to the code reader.,709768437,2017-06-09 04:00:58
25278039,73683,120998374,33,"Can you clarify what happens in the log message (e.g., do we ignore the request or start another one?). If we're able to start and do another one, why is it a warning and how does shared state of this class in_progress_, restore_txid_, etc) not collide?",709768437,2017-06-09 04:03:12
25278039,11442576,121005032,31,good point. will update it,709768437,2017-06-09 04:37:13
25278039,11442576,121005472,33,"basically what happens here is if a new start restore requested, the previous one will be ignored and a new storing is started.",709768437,2017-06-09 04:39:31
25278039,11442576,121014067,33,"The warning is to indicated that a new restoring is started.

Given that only a single thread executing the tmaster code, everything will be ordered. So there's no race conditions here. Either the states remains unchanged or they are all updated to next",709768437,2017-06-09 05:30:29
25278039,73683,121017913,33,In that case can you include in the log that the restore with id checkpoint_id_in_progress_ will be abandoned? ,709768437,2017-06-09 05:58:04
25278039,11442576,121803095,33,sure,709768437,2017-06-14 04:34:33
25278039,73683,122041730,36,s/Restore/restore,714093985,2017-06-15 02:25:10
25278039,11442576,122061004,36,fixed,714093985,2017-06-15 03:50:57
25278039,73683,122067067,35,Please also replace the 2 other occurrences of Restore in this log message with restore.,714883130,2017-06-15 04:17:16
25314921,73683,121000082,2,Can you provide a link to Parsely for reference. Also should we change to README.md to be consistent with other readmes in the repo?,710539111,2017-06-09 04:12:05
25314921,3201045,121001337,2,"This is required for Python packaging - so that we can submit to pypi. When we package it, the packager specifies that the readme file should either README or README.txt or README.rst (not README.md)",710539111,2017-06-09 04:18:23
25314921,3201045,121001357,2,Link is added.,710539111,2017-06-09 04:18:32
25324530,10216235,121127138,182,Could you please add some doc about sample heron submit/kill commands on kubernetics,710758728,2017-06-09 20:35:18
25430473,7235147,121557153,38,Should we prefix these args with 'sm' or something like that?,713281549,2017-06-13 07:10:55
25430473,13159450,122089840,23,"""exists"" -> ""exist""",713286710,2017-06-15 06:34:01
25430473,13159450,122089559,38,yeah better to have prefix,713281549,2017-06-15 06:31:54
25430473,13159450,122089787,29,there is an `self.configs` above.,713286710,2017-06-15 06:33:36
25464317,73683,123019289,61,can this be private? same for other non-override methods in the other sensor classes.,718450571,2017-06-20 22:58:23
25464317,73683,123018683,48,Can this return a Duration object instead?,718450571,2017-06-20 22:56:11
25464317,73683,123019379,54,can this be private?,718450571,2017-06-20 22:58:43
25464317,73683,123020019,58,could you elaborate on the javadocs for this class and how to use it.,718450571,2017-06-20 23:01:13
25464317,73683,123022282,132,"as discussed, this will need to be a released maven jar not bound to an individual.",718450571,2017-06-20 23:09:23
25464317,73683,123019576,39,@Override?,718450571,2017-06-20 22:59:22
25464317,73683,123021502,44,Can this class leverage ConfigReader to load yaml data from a file path?,718450571,2017-06-20 23:06:35
25464317,73683,123021746,54,```for (int value : values) {```,718450571,2017-06-20 23:07:23
25464317,73683,123021865,32,"no star imports, here and elsewhere.",718450571,2017-06-20 23:07:55
25464317,6377806,123783146,132,"????  
Fixed in #1980 ",718450571,2017-06-23 22:53:56
25464317,6377806,123785196,32,"Fixed. Somehow, checkstyle on my dev box did not catch this issue.",718450571,2017-06-23 22:59:33
25464317,73683,123807079,32,I've had this issue too. For some reason checkstyle doesn't always seem to fire on mac and I haven't been able to figure out why.,718450571,2017-06-24 00:48:42
25468481,10216235,121829468,41,Why Packing Plan is fetched ahead of TMaster set? One invariant is that we should be confirmed as Tmaster before doing anything,714145573,2017-06-14 07:29:04
25468481,10216235,121829740,100,Are we sure we are the tmaster here?,714145573,2017-06-14 07:31:30
25468481,73683,122002063,41,Fetching the packing plan is required for initialization so we can determine the stream manager id set (`absent_stmgrs_`). We need to be prepared with this info before TMaster registers it's location and starts receiving registration requests from stream ,714145573,2017-06-14 23:47:01
25468481,73683,122003797,100,"No, we're not actually. What is the deterministic way to know that? We could set a flag during a successful `SetTMasterLocationDone` call to indicate that we're TMaster since we successfully set our location.",714145573,2017-06-14 23:54:05
25468481,73683,122030808,100,@srkukarni I added a flag to denote if we're master. LMKWYT,714145573,2017-06-15 01:37:30
25468481,10216235,122029705,41,"A better approach to prevent that is a) still maintain the invariant that you first become tmaster, and only after fetching packing plan, do you start your listening server. That way stmgrs wont reach you",714145573,2017-06-15 01:33:06
25468481,73683,122543423,41,"Why is the proposed approach a better one? With the proposed approach tmaster would register itself as master, which would result in stream managers trying to connect to it. They will fail until tmaster continues it's initialization and opens its server s",714145573,2017-06-17 05:13:09
25468481,73683,122543817,41,"If the intent is to not register the packing plan listener that handles updates (and physical plan deletion) until after we're fully up and running, that seems like a good call. We can differ the packing plan watch initialization until after we've become ",714145573,2017-06-17 05:17:04
25549349,13159450,122337785,66,this,715777080,2017-06-16 06:46:23
25549349,13159450,122337775,46,remove this.,715777080,2017-06-16 06:46:15
25550095,11442576,122340895,12,"why not let `long currentTime = System.nanoTime()` and keep the `startOfCycle` unchanged? On line 225 or 226, there's a timeout check. If we move create the `startOfCycle` here, the semantics there is changed.",715792479,2017-06-16 07:13:51
25550095,2183863,122341791,12,Make senses. Updated.,715792479,2017-06-16 07:22:19
25550095,73683,122374076,7,"This logic makes sense, but what doesn't is what `currentTime` is expected to be after the loop on line 225. Because it gets reset on line 213, after the loop it seems to represent the time after the last tuple was deserialized but before it was handled. ",715800196,2017-06-16 13:46:22
25550095,2183863,122385823,7,"There was an intent optimization to reduce one  `System.nanoTime()` call per tuple execution. In the new commit this optimization is removed to simplify the reasoning. 
Now it is much easier to understand.",715800196,2017-06-16 15:04:33
25550095,73683,122478434,7,Can you clarigy (in comments) what `currentTime` is expected to reflect when it's used after the loop? It's not clear from reading the code.,715800196,2017-06-16 23:12:40
25550095,2183863,122499375,7,Please check with latest code. No `currentTime` there now,715800196,2017-06-17 00:59:07
25556614,73683,122485078,115,"This same 6 lines of connection initialization logic are repeated in each method. could you put them into a shared helper that takes a uri, returns a connection and throws if it can't for any reason?",715954068,2017-06-16 23:46:54
25556614,73683,122486916,156,"You can remove the need for `allSuccessful` by doing this here and returning true at the end:
```
if (!deployContainer(appConfs[i])) {
  return false;
}
```

Or better yet, change this method to return void and throw an exception if one fails. It c",715954068,2017-06-16 23:56:05
25556614,73683,122484490,79,"in all of these messages we should include more contextual info to help the log reader understand the issue.. this one for example, should include the uri. The following one should include the uri and probably the json post body.",715954068,2017-06-16 23:43:50
25556614,73683,122483970,71,"instead of returning a boolean to indicate success, can we return void and throw an exception (maybe `SchedulerException`) upon failure? Same elsewhere. See #1311.",715954068,2017-06-16 23:41:11
25556614,73683,122482825,38,can we throw an exception here instead of returning null? same for other occurrences in this class.,715954068,2017-06-16 23:35:17
25556614,73683,122486386,148,"```
for (String appConf : appConfs) {
```",715954068,2017-06-16 23:53:29
25556614,73683,122482375,27,Could we reduce the visibility of many of these methods to package private?,715954068,2017-06-16 23:33:09
25556614,73683,122480469,45,"In the past we've had issues with credentials being logged when doing this. Can we change this to FINE or remove it. If we keep it, it's also good to add some sort of contextual logging to the message.",715954068,2017-06-16 23:22:48
25556614,73683,122482061,30,Is this path always this way for all kubernetes users? Is `default` ever something else for example?,715954068,2017-06-16 23:31:23
25556614,73683,122481745,209,Please add unit tests for add/remove containers and the spec builder methods.,715954068,2017-06-16 23:29:31
25556614,73683,122483428,73,"variants of this uri building are repeated in this class. could you centralize this logic into a shared method or member? During initialization of this class it seems we could replace set `kubernetesURI` as `""[kubernetesURI]/api/v1/namespaces/default/pods",715954068,2017-06-16 23:38:28
25556614,73683,122482632,49,success can be removed and this can just be in the `if` clause. same for below.,715954068,2017-06-16 23:34:26
25556614,1165755,122489774,30,Good point. Should probably convert this into a configuration for the scheduler,715954068,2017-06-17 00:11:19
25556614,73683,122778698,27,close parens or open curly don't get their own line in our styles.,717857072,2017-06-20 00:56:58
25556614,73683,122778027,32,"I recommend we put this in `c.t.h.common.network` since it's generic and not specific to schedulers. Also instead of a bunch of static helpers, could follow an approach more like the java network libraries or `HeronClient`, where we initialize a `HttpJson",717857072,2017-06-20 00:54:22
25556614,73683,122775867,9,"I'm really not as fan of returning null to represent exceptions (see rant in #1311). If we can't get a response code it's an exceptional case, so I think we should throw an exception.",717857072,2017-06-20 00:46:03
25556614,73683,122779409,34,"Instead of initializing namespace, can we initialize `""%s/api/v1/namespaces/%s/pods` as `baseUriPath`? Every method uses this as their base, so this would reduce duplicate logic.",717857072,2017-06-20 00:59:33
25556614,73683,122851500,4,can we remove this method since it's implementation is only a one-liner?,718501172,2017-06-20 06:45:15
25556614,73683,122852345,240,pls remove empty lines between closing brackets.,718501172,2017-06-20 06:51:46
25556614,73683,122853344,179,please include comments about what's happening here with an example.,718501172,2017-06-20 06:59:37
25556614,73683,122851103,19,Looks like kubernetesURI is only used in the constructor now so this can be removed.,718501172,2017-06-20 06:42:22
25556614,73683,122853083,228,"Does kubernetes provide the ability to add/remove multiple containers with one call? Doing it individually leaves us in a bad state if we fail midway through. If not we should clearly log that state upon failure (which ones succeeded, which failed or were",718501172,2017-06-20 06:57:33
25556614,73683,122852261,251,"General comment about logging and exceptions... Typically we either log an error or throw an exception, but not both. Doing both tends to clutters up the logs with duplicate info. Let's instead just throw here, and include more contextual info in the exce",718501172,2017-06-20 06:51:05
25556614,1165755,123415530,228,Unfortunately not. I will make a clear log to cover this.,718501172,2017-06-22 10:40:56
25556614,1165755,123416814,209,Done,715954068,2017-06-22 10:59:28
25556614,73683,123563477,247,"can we remove the logging here and add any relevant info to the exception message? Instead of log info, log sever and throw exception, best to just throw the exception with a good message.",720785022,2017-06-22 23:46:06
25556614,73683,123561374,47,"It would be great to change the existing methods in this class to also return `void` and throw exceptions instead. I know that's scope creep on what you're adding in this PR though, so we could make that change in a follow up PR if you prefer.",720785022,2017-06-22 23:37:15
25556614,1165755,123632933,47,"Yeah, since I'll need to re-do the tests here, I'd prefer to do a separate PR here.",720785022,2017-06-23 05:01:26
25556614,73683,123633551,148,here and elsewhere let's not specify `@return [type]` unless we have something specific to say about what's returned. The return type will be included in the javadocs without specifying `@return String`.,720979490,2017-06-23 05:05:52
25556614,73683,123633371,144,"Here and elsewhere can we not echo the method name in the javadocs, since it's redundant. ",720979490,2017-06-23 05:04:37
25556614,73683,123633761,207,please include a link to a github issue for this.,720979490,2017-06-23 05:07:06
25556614,73683,123635274,83,here and elsewhere please remove empty returns.,720986882,2017-06-23 05:17:20
25556614,73683,123644745,22,typo: dowp,721020067,2017-06-23 06:27:05
25586850,32022953,128392458,36,how to use it? could you show how to use this class in unit test?,740176891,2017-07-20 06:20:55
25586850,32022953,128392709,58,CountDownLatch seems implementing the similar PV operations. What is benefit to use pipe rather than CountDownLatch,740176891,2017-07-20 06:22:48
25586850,11442576,129113512,36,Piper is used to inject events into the eventloop to trigger event handlers.,740176891,2017-07-25 01:16:44
25586850,11442576,129113564,58,it's different from CountDownLatch,740176891,2017-07-25 01:16:56
25586850,10216235,129121791,113,"Can you actually have
heron::config::TopologyConfigVars::EXACTLY_ONCE
instead of a ""EXACTLY_ONCE""",744359862,2017-07-25 01:49:28
25586850,73683,129166477,39,please add comments describing the controller and what it's general area of responsibility is.,744359862,2017-07-25 05:03:56
25586850,10216235,129184982,59,stateful_controller?,744542661,2017-07-25 07:06:18
25586850,10216235,129184920,67,stateful_controller?,744542661,2017-07-25 07:05:52
25662614,73683,123005682,144,can we include the relevant version numbers in the error message here?,719022974,2017-06-20 22:14:07
25662614,73683,123008603,168,Here and elsewhere can we throw the original exception and not wrap in RuntimeException?,719022974,2017-06-20 22:23:23
25662614,73683,123005960,39,Can we replace all `Object` references in the method names of this class with `StorageObject` to be less generic?,719022974,2017-06-20 22:15:05
25662614,73683,123010409,48,it's best to re-initialize mocks in the before() method.,719022974,2017-06-20 22:28:59
25662614,73683,123006310,50,`...a path to the service...`,719022974,2017-06-20 22:16:11
25662614,73683,123009872,34,"here and in other classes, please remove empty lines from between class members of same type.",719022974,2017-06-20 22:27:23
25662614,73683,123010959,137,"instead of subclassing, could you instead return a mock GcsUploader that has the createGcsController method mocked to return the mock GcsController. better to consistently use mocks than a mix of mocks and sub-classes.",719022974,2017-06-20 22:30:38
25662614,73683,123011107,121,createStorageObject,719022974,2017-06-20 22:31:05
25662614,7235147,123035694,39,Will change all Object references to StorageObject,719022974,2017-06-21 00:02:26
25662614,7235147,123035676,168,"They are all checked exceptions and the initialize method does not support throwing an exception. I'm not sure what else to do, any ideas?",719022974,2017-06-21 00:02:22
25662614,7235147,123035853,144,Can I get a version number for the Config or should I supply the version number from the StoredObject?,719022974,2017-06-21 00:03:09
25662614,7235147,123041091,50,Will update the that sections of the javadoc and add an example.,719022974,2017-06-21 00:24:13
25662614,73683,123114438,168,"I would recommend letting methods declare their exceptions as much as we can. So createGcsController throws IOException and GeneralSecurityException, and the initialize method catches both and wraps in RuntimeException.",719022974,2017-06-21 05:38:00
25662614,73683,123114812,144,Can you fetch the version from the StorageObject? Are there even versions that would be useful for a user to see?,719022974,2017-06-21 05:40:33
25662614,7235147,123287282,168,Will update with the next commit.,719022974,2017-06-21 22:43:42
25662614,7235147,123287169,144,I don't think adding a storage object version would be useful to the user.,719022974,2017-06-21 22:43:17
25662614,73683,123580833,13,Could you create a `google_client_version=1.22.0` at the top of this file and reuse that for each of these so we always upgrade in lock step. ,719955349,2017-06-23 00:57:37
25662614,7235147,123809803,13,done,719955349,2017-06-24 01:01:12
25662614,7235147,123811479,34,done,719022974,2017-06-24 01:09:02
25777480,10216235,123623965,20,Why mention Storm at all here?,720903649,2017-06-23 04:14:33
25777480,10216235,123624091,5,"Can we say more along the lines of
Heron is a general purpose streaming engine with performance, low latency, isolation, reliability in mind. It also provides API compatibilty with Storm.",720903649,2017-06-23 04:15:18
25777480,73683,123633126,20,"I had the same thought but kept it because the section title is Relationship with Storm, so the intent I believe was to clarify the differences. I'm fine with removing the Storm mention here if we think the section would still make sense without being exp",720903649,2017-06-23 05:02:52
25781051,32022953,123838871,26,com.twitter.heron.common.config.ConfigReader may help reading yaml,721509472,2017-06-24 03:34:47
25781051,32022953,123846257,32,They may be moved to com.twitter.heron.spi.common.Key,721509472,2017-06-24 04:17:29
25781051,32022953,123840600,272,Topology level component does not need cluster,721509472,2017-06-24 03:44:16
25781051,32022953,123842016,311,"These configs seem not necessary. Once config_home is determined, they can be calculated.",721509472,2017-06-24 03:51:31
25781051,32022953,123840320,74,MetricsCacheMgr is more proper for a topology level component. Tracker is cluster level component.,721509472,2017-06-24 03:42:49
25781051,32022953,123844242,111,loadClusterConfig() may be simpler here.,721509472,2017-06-24 04:04:09
25781051,32022953,123839600,68,Why SchedulerStateManagerAdaptor is used here? What is relation between HealthMgr and Scheduler to StateMgr?,721509472,2017-06-24 03:38:53
25781051,32022953,123843314,104,release_file is not defined in Options?,721509472,2017-06-24 03:58:39
25781051,32022953,123845986,17,why not enum?,721509472,2017-06-24 04:15:43
25781051,32022953,123851125,39,How does HealthMgr use TopologyProvider?,721509472,2017-06-24 04:49:24
25781051,6377806,123851574,68,The `HealthManager` will fetch topology info and scheduler location from the state manager.,721509472,2017-06-24 04:53:03
25781051,6377806,123852130,74,"Agree, `MetricsCacheMgr` could be another provider of metrics. We should talk about it.  Currently `Dhalion` depends on the `timeline` api of the `Tracker`. When requested for metrics over 300 seconds, `Tracker` will provide 5 readings one for each of the",721509472,2017-06-24 04:57:12
25781051,6377806,123852240,272,The `Tracker` api needs cluster name.,721509472,2017-06-24 04:58:11
25781051,6377806,123852572,39,The `HealthManager` will just `inject` instance of `TopologyProvider`. It will be used by `Dhalion Sensors`,721509472,2017-06-24 05:00:45
25781051,32022953,123854455,74,MetricsCacheMgr has the same http query interface as Tmaster. https://github.com/twitter/heron/blob/master/heron/metricscachemgr/src/java/com/twitter/heron/metricscachemgr/MetricsCacheManagerHttpServer.java,721509472,2017-06-24 05:17:44
25781051,3201045,123854621,74,+1 - let us use Metrics Cache Manager. ,721509472,2017-06-24 05:19:27
25781051,6377806,124130907,74,"Just to be clear, Dhalion should provide both implementations, one for `tracker` and one for `MetricsCacheManager`. It is possible that users have not configured `MetricsCacheManager` sinks or `tmaster` sink. We cannot replace one for other. I also think ",721509472,2017-06-27 04:48:44
25781051,32022953,124139339,74,Agree to let this PR go. We may add MetricsCache ingestor in later PR. @kramasamy @maosongfu ,721509472,2017-06-27 05:38:13
25781051,6377806,124140327,104,`release_file` is not needed. Will replace the only usage with a `null` value.,721509472,2017-06-27 05:44:07
25781051,6377806,124141661,111,"As per the javadocs of `loadClusterConfig`, the method assumes default home and config path: `Loads raw configurations using the default configured heronHome and configPath on the cluster`. This may not be the case here. The method is only useful for `sch",721509472,2017-06-27 05:52:31
25781051,3201045,125189097,74,"If the health manager is per topology, we can enable MetricsCacheManager Sink by default, similar to Tmaster sink.",721509472,2017-07-03 01:11:21
25781051,3201045,125189011,43,@ashvina - wondering why there are so many dependencies?,724522790,2017-07-03 01:06:52
25781051,3201045,125189059,74,@ashvina - is the health manager one per topology or for all topologies?,721509472,2017-07-03 01:08:55
25781051,73683,127101240,32,"no star imports please, here and elsewhere",724522790,2017-07-13 06:59:04
25781051,73683,127090609,67,"Can we throw an exception that is not RuntimeException? Also, let's include the topologyName in the message.",724522790,2017-07-13 05:40:16
25781051,73683,127085864,274,This method is called `commandLineConfigs` but it has nothing in it's impl related to command lines. Can we either change the name to something like `initConfig` or change it to take `CommandLine cmd` in it's signature?,724522790,2017-07-13 05:11:44
25781051,73683,127091597,66,Please use `java.time.Instant` and `java.time.Duration` for startTime and duration.,724522790,2017-07-13 05:47:05
25781051,73683,127089452,57,This method is only used by tests. Why is it needed?,724522790,2017-07-13 05:32:51
25781051,73683,127087283,30,"pls clarify what Map<String, Map<String, String>> is. If the inner map is a config, why are all values strings?",724522790,2017-07-13 05:20:07
25781051,73683,127091760,71,Is there any retry if one of the getMetricsFromTracker calls fails?,724522790,2017-07-13 05:48:17
25781051,73683,127090851,85,This is only used in the tests. How is it needed. Also it would be better to make this a utility somewhere that takes a Topology. That way you don't have potential for a race condition.,724522790,2017-07-13 05:42:03
25781051,73683,127082868,131,"Can this artifact be put in maven? This will break Twitter's internal CI build, which doesn't not have access to the public internet, only an internal maven proxy/cache.",724522790,2017-07-13 04:56:41
25781051,73683,127085370,74,"Passing a trackerUrl implies that this impl can only work with tracker. Could we instead have an interface which has a tracker-based impl (e.g., a `MetricsProvider` impl), which could be replaced with a metrics cache manager impl? That impl could be wired",721509472,2017-07-13 05:09:10
25781051,73683,127089289,92,@Override?,724522790,2017-07-13 05:31:40
25781051,73683,127086974,258,Can this method be done via guice?,724522790,2017-07-13 05:18:19
25781051,73683,127088675,35,s/long/Duration/g,724522790,2017-07-13 05:27:57
25781051,73683,127090572,65,"This is the topology at the time of submission, not the latest one. The latest one can be gotten from the current physicalPlan.getTopology(), but even that one doesn't contain updates to the config (e.g. parallelism) since creation. If that's needed see U",724522790,2017-07-13 05:39:56
25781051,73683,127087613,17,"+1 for enums.

Also using Interfaces for constants is a no-no:
https://stackoverflow.com/questions/320588/interfaces-with-static-fields-in-java-for-sharing-constants",721509472,2017-07-13 05:21:59
25781051,73683,127083171,8,would you please remove the quotes around numbers as json values.,724522790,2017-07-13 04:58:05
25781051,73683,127087174,29,please provide javadocs for this class,724522790,2017-07-13 05:19:28
25781051,73683,127084760,86,Can we also support a dry run mode that just detects but doesn't take action in the resolvers? This could be a follow-up PR.,724522790,2017-07-13 05:06:04
25781051,73683,127083795,16,These proto deps can all be replaces with `//heron/proto:proto-java`,724522790,2017-07-13 05:01:08
25781051,73683,127083517,1,elsewhere in the repo we abbreviate manager with mgr. Please name this dir healthmgr for consistency.,724522790,2017-07-13 04:59:43
25781051,73683,127090095,71,This assumes an instance naming convention declared elsewhere which could change. Could we leverage consistent code for this?,724522790,2017-07-13 05:36:51
25781051,73683,127090225,97,This method is never accessed.,724522790,2017-07-13 05:37:35
25781051,73683,127088167,34,These are only used by `HealthPolicyConfigReader` and it's tests. Better to move them there.,724522790,2017-07-13 05:24:56
25781051,6377806,128093362,26,Fixed,721509472,2017-07-19 03:57:43
25781051,6377806,128109534,74,"Fixed. The trackerUrl is replaced by a guice module. Alternatively, we could also opt for adding a new constructor once metrics cache implementation is added.",721509472,2017-07-19 05:11:31
25781051,6377806,128109761,104,Fixed,721509472,2017-07-19 05:11:53
25781051,6377806,128109901,311,Fixed,721509472,2017-07-19 05:12:34
25781051,6377806,128110286,17,"Fixed.
I have removed the interface. An enum was added where feasible. Guice `Named` qualifier annotation expects a constant String. Such constants cannot be replaced with enum.",721509472,2017-07-19 05:14:50
25781051,6377806,128110362,32,Guice `Named` qualifier annotation expects a constant String. Such constants cannot be replaced with enum.,721509472,2017-07-19 05:15:17
25781051,6377806,128110694,1,Fixed,724522790,2017-07-19 05:17:18
25781051,6377806,128111140,8,"I think a consistent value format, String in this case, is easier to create using scripts. Also the consumer gets to decides the format in which the value is used?",724522790,2017-07-19 05:20:01
25781051,6377806,128111178,16,Fixed,724522790,2017-07-19 05:20:14
25781051,6377806,128111663,86,Yes. it will be part of a new PR. User would provide the dry run configuration using policy config file. Dhalion policy executor will just log the diagnosis and skip execution of resolver if dry run is true.,724522790,2017-07-19 05:23:16
25781051,6377806,128112257,258,"The state mgr needs to be initialized before it could be used in the adaptor. I can think of instantiating the stateMgr through guice, but not sure if adds any value. Using `ReflectionUtils` is consistent with the usage in other places.",724522790,2017-07-19 05:26:58
25781051,6377806,128112293,274,Fixed,724522790,2017-07-19 05:27:13
25781051,6377806,128112322,29,Fixed,724522790,2017-07-19 05:27:21
25781051,6377806,128112620,34,Fixed,724522790,2017-07-19 05:28:02
25781051,6377806,128112654,35,Fixed,724522790,2017-07-19 05:28:10
25781051,6377806,128112781,57,This method is used in classes in a followup PR. ,724522790,2017-07-19 05:29:02
25781051,6377806,128112816,97,This method is used in classes in a followup PR.,724522790,2017-07-19 05:29:17
25781051,6377806,128112847,85,This method is used in classes in a followup PR.,724522790,2017-07-19 05:29:31
25781051,6377806,128112937,32,Fixed,724522790,2017-07-19 05:30:05
25781051,6377806,128120801,71,No. It is assumed that the detectors will wait for the next execution cycle or retry. ,724522790,2017-07-19 06:24:34
25781051,6377806,128123780,66,Sure. I am assuming any of the java 8 features can be used henceforth? Including lambda?,724522790,2017-07-19 06:46:41
25781051,73683,128605610,258,"Ideally we could replace the reflection pattern with guice everywhere. The initialize() method is an artifact of the reflection approach. If there were a way to do this with guice that would be awesome, since it would show how this pattern could be replac",724522790,2017-07-21 02:08:54
25781051,73683,128604207,8,"all other heron yaml configs in this directory and elsewhere leverage primitive ints so we should provide a consistent user experience. Actually we don't use quotes around strings or numbers elsewhere, so I think we should remove them here to not be the e",724522790,2017-07-21 02:02:41
25781051,73683,128607507,67,"This is the topology at the time of submission, not the latest one, which is what you want right?. The latest one can be gotten from the current `physicalPlan.getTopology()`, but even that one doesn't contain updates to the config (e.g. parallelism) since",741581325,2017-07-21 02:18:29
25781051,73683,128607870,43,@can these be package private and `@VisibleForTesting`? looks like they're only used by testing.,741581325,2017-07-21 02:20:11
25781051,73683,128608111,66,"We've been using Instant and Duration yes, but not labdas AFAIK. Seems if we're using the former we should be able to use the latter. :)",724522790,2017-07-21 02:21:21
25781051,73683,128606702,71,could we use the enums as the config keys?,741581325,2017-07-21 02:14:15
25781051,73683,128607217,73,This assumes an instance naming convention declared elsewhere which could change. Are there other places in the java codebase where this logic exists which we could share somehow?,741581325,2017-07-21 02:16:59
25781051,73683,128607584,69,"Can we throw an exception that is not RuntimeException? Also, let's include the topologyName in the message.",741581325,2017-07-21 02:18:53
25781051,73683,128606229,91,could you consolidate unnecessary string concatenation here pls. Much of this can fit on one line.,741581325,2017-07-21 02:11:54
25781051,73683,128608192,70,Let's use Instance and Duration for these.,741581325,2017-07-21 02:21:39
25781051,6377806,128611342,91,Ok. The code is generated using tools provided by java IDE. Is this change suggested for readability?,741581325,2017-07-21 02:35:56
25781051,6377806,128612585,43,These variables are used outside the package by the `HealthManager`,741581325,2017-07-21 02:41:51
25781051,6377806,128629372,71,I am not sure I understand that. Do you mean the name of the enum should be same as the key in the config file?,741581325,2017-07-21 03:59:21
25781051,6377806,128632781,67,I am looking at https://github.com/twitter/heron/blob/master/heron/scheduler-core/src/java/com/twitter/heron/scheduler/UpdateTopologyManager.java?utf8=%E2%9C%93#L168. The topology is getting updated after a config change. Could you please help me understa,741581325,2017-07-21 04:15:07
25781051,73683,128637834,91,"The IDE generated code is overly clunky at times. For readability and perf it's nicer to avoid this much string concat for what could be just ""string"" + object + ""string"".",741581325,2017-07-21 04:40:45
25781051,73683,128637908,43,got it.,741581325,2017-07-21 04:41:11
25781051,73683,128638226,44,"Our standard for enums is camel case, so `PolicyConf`.",741581325,2017-07-21 04:42:58
25781051,73683,128638339,71,"Can the map be `Map<PolicyConf, Object>`?",741581325,2017-07-21 04:43:33
25781051,73683,128639115,67,"Look at the `getTopology` method:
https://github.com/twitter/heron/blob/master/heron/scheduler-core/src/java/com/twitter/heron/scheduler/UpdateTopologyManager.java?utf8=%E2%9C%93#L337
```
stateManager.getPhysicalPlan(topologyName).getTopology();
```
",741581325,2017-07-21 04:47:44
25781051,6377806,128652027,73,The instance id `container_%s_%s_%d` seems to be set here https://github.com/twitter/heron/blob/master/heron/executor/src/python/heron_executor.py?utf8=%E2%9C%93#L568 and then used by `MetricsManagerServer` to be sent to tracker. I did not find any other ,741581325,2017-07-21 06:10:45
25781051,6377806,128653529,67,"Understood. Thanks! 

In my opinion there is redundancy and confusing implementation here. Both `stateManagerAdaptor.getTopology` and `stateManagerAdaptor.getPhysicalPlan.getTopology` should return the same state of the topology. WDYT?",741581325,2017-07-21 06:22:23
25781051,73683,128653560,73,That's what I suspected - only set elsewhere in python. Good to leave it as is here then. Maybe make a comment on both occurrences of it about the other for now.,741581325,2017-07-21 06:22:37
25781051,73683,128653821,67,I recently learned of this myself and I agree with you that it's confusing and error prone. I wonder if there is any value though in keeping the original topology at getTopology. @maosongfu @kramasamy @nlu90 @srkukarni thoughts?,741581325,2017-07-21 06:24:26
25781051,6377806,128794007,71,"The policy config map `configs` will contain system configs, for e.g. policy class name, and user component specific configs, for e.g. buffer size threshold. Hence a map with enum as the key cannot be created in this case.",741581325,2017-07-21 22:40:30
25781051,6377806,128809489,91,Fixed,741581325,2017-07-21 23:53:49
25781051,6377806,128811173,67,Fixed,741581325,2017-07-22 00:01:57
25781051,6377806,128811235,70,Fixed,741581325,2017-07-22 00:02:21
25781051,6377806,128811261,44,Fixed,741581325,2017-07-22 00:02:30
25781051,73683,128878452,44,Could we name this `PolicyConfigKey` for consistency with `SystemConfigKey`?,742394677,2017-07-22 06:17:14
25781051,73683,128878317,69,"Can we create a different exception to use here that's not `RuntimeException` here and elsewhere in this review? Typically we should avoid throwing generic exceptions like this, except maybe in a `main(..)` method. Using a more specific exception allows c",742394677,2017-07-22 06:15:39
25781051,6377806,129089919,43,@kramasamy As of now Dhalion uses http client to query tracker and fetch metrics. These dependencies are related to the client and parsing the json returned by the tracker.,724522790,2017-07-24 23:44:36
25781051,6377806,129090012,8,fixed,724522790,2017-07-24 23:44:59
25781051,6377806,129090184,30,fixed,724522790,2017-07-24 23:45:41
25781051,6377806,129090971,69,Fixed by adding `MissingStateException`,742394677,2017-07-24 23:49:01
25781051,73683,129094868,20,Could we change to something like `InvalidStateException` to make it slightly more generic? That way it could be used for any inconsistent or unexpected state.,744267386,2017-07-25 00:05:06
25781051,6377806,129105092,20,Fixed by renaming,744267386,2017-07-25 00:44:19
25781051,3201045,129136075,129,"If you don't need this, please remove it.",744314902,2017-07-25 02:50:18
25781051,3201045,129135931,1,Why this file is called BUILDX?,744314902,2017-07-25 02:49:48
25781051,6377806,129144094,129,The Dhalion build files and the dependencies have been temporarily disabled till maven repo is enabled. I would suggest we keep it like this for a few more days. ,744314902,2017-07-25 03:26:08
25781051,6377806,129144781,1,The Dhalion build files and the dependencies have been temporarily disabled till maven repo is enabled. I would suggest we keep it like this for a few more days. Some CI systems are based on local maven repo only and cannot download jar files from the int,744314902,2017-07-25 03:29:04
25784610,73683,123649132,55,"If we're going to copy this pattern for other calls, we might want to consider a generic method that takes a string of the heron command and a collection of strings of popen commands. Using strings will likely be easier than arrays. The shared method woul",721032024,2017-06-23 07:07:42
25784610,73683,123648472,5,"this seems like a functional change beyond just what's required for the testing, no?",721032024,2017-06-23 07:01:11
25784610,73683,123648562,10,why is this being removed?,721032024,2017-06-23 07:02:03
25784610,73683,123649635,51,is `pass` necessary?,721032024,2017-06-23 07:11:48
25784610,73683,123649525,27,`OptsTest` sounds like a test that verifies option parsing logic. Can we call this something more representative like `SubmitTest` or something (which extends a common `ClientCommandTest` or something like that)? We can then have a bunch of tests to repre,721032024,2017-06-23 07:10:50
25784610,13159450,123804481,10,It is not used. Pretty sure it is some leftover when we move from close-sourced to open-sourced Heron.,721032024,2017-06-24 00:35:19
25784610,13159450,123804647,5,"At first I thought we don't need to copy all the env variables, but now I think we do need all env vars. For example, Java program could fetch environmental variables.",721032024,2017-06-24 00:36:15
25784610,73683,123819666,5,"right, so should this change be reverted?",721032024,2017-06-24 01:45:39
25784610,13159450,123819732,55,"addressed in https://github.com/twitter/heron/pull/1983/commits/f18b0a417bb96f0b473db62eea39b12705a59f3f. Using string looked better at first. But when I was refactoring to use string, I realized the command string is too long and I have to break them int",721032024,2017-06-24 01:46:00
25784610,13159450,123819789,5,yes later. ,721032024,2017-06-24 01:46:17
25784610,13159450,123820185,5,https://github.com/twitter/heron/pull/1983/commits/4de4efbb19ade9fada1a6adbe6c9b6bd7e8cbfd7,721032024,2017-06-24 01:48:13
25784610,73683,123823371,55,"IMO putting spaces at the end of multi-line strings is a pretty standard thing to do, so I would recommend that.

We could even evolve this to read the commands from a text file at some point if we wanted to remove the need for long strings in code.",721032024,2017-06-24 02:03:15
25910624,13159450,124172310,38,Add newline at end of the file.,723790561,2017-06-27 10:39:55
25910624,2508294,124346448,38,done,723790561,2017-06-28 00:45:22
25935360,13159450,124356769,6,`exit 1` here?,724397066,2017-06-28 01:23:39
25935360,13159450,124356889,9,`exit 1` early here?,724397066,2017-06-28 01:24:01
25935360,3201045,124357071,6,"if the argument is not valid, we exit right away - since it is a mandatory argument",724397066,2017-06-28 01:24:43
25935360,3201045,124357147,9,Yes it is a mandatory argument,724397066,2017-06-28 01:24:59
25935936,32022953,124675292,12,"The profiling is enabled during the whole stmgr life time.

What about adding two handlers to the stmgr server to control the profiling start & end:
1. HandleStartHeapProfilingMessage: HeapProfilerStart()
2. HandleStopHeapProfilingMessage: HeapProfile",724510807,2017-06-29 05:44:23
25984317,3201045,124651992,26,Is this test flaky?,725454088,2017-06-29 03:45:13
25986231,10216235,124675511,6,Migrate,725529209,2017-06-29 05:45:51
25986231,10216235,124675564,6,migrate ,725529209,2017-06-29 05:46:12
25986231,10216235,124675185,75,ditto,725529209,2017-06-29 05:43:39
25986231,10216235,124675485,3,Migrate please ,725529209,2017-06-29 05:45:41
25986231,10216235,124675224,107,ditto,725529209,2017-06-29 05:43:55
25986231,10216235,124675159,53,remove streamparse,725529209,2017-06-29 05:43:33
25986231,10216235,124675028,11,"Please remove the streamparse sentence since that is no longer supported. 
Also please change the ""upgrade from Storm to Heron"" to something along the lines written in architecture.md",725529209,2017-06-29 05:42:47
25986231,10216235,124675438,145,please remove upgrade along the lines stated above,725529209,2017-06-29 05:45:19
25986231,10216235,124675088,19,please remove streamparse related stuff,725529209,2017-06-29 05:43:05
25986231,10216235,124687011,42,shouldnt 0.14.9 be changed?,725563147,2017-06-29 07:12:42
25986231,10216235,124686847,32,same here,725563147,2017-06-29 07:11:18
25986231,10216235,124686828,10,is the link right? pyheron does not exist anymore,725563147,2017-06-29 07:11:06
25986231,10216235,124686859,53,same here,725563147,2017-06-29 07:11:26
25986231,64790,124853800,42,Yep. Done.,725563147,2017-06-29 23:47:54
25989408,32022953,124684106,4,"Shall we add the design principle at the file beginning? Copied from slack:

```
The heron/common targets is divided into 3 levels by design: 
1. only depends on jdk; 
2. depends on jdk and heron internal code; 
3. depends on jdk, heron internal cod",725559448,2017-06-29 06:49:25
25989408,11442576,124685948,4,good idea. updated,725559448,2017-06-29 07:03:58
25989408,3201045,124691314,5,I would suggest not to move the file - this is going to be used in DC/OS and ECS later. Hence the original place was more apt and we take a dependency on jackson and we shade jackson where it is being used (like instance).,725574287,2017-06-29 07:53:35
25989408,3201045,124691112,4,similarly the target should //heron/common/src/java:testhelpers-java,725574287,2017-06-29 07:51:31
25989408,3201045,124690909,5,Can you make the package name as com.twitter.heron.common.testhelpers or something similar - you don't want to give the impression that it is some kind of test.,725574287,2017-06-29 07:49:14
25989408,11442576,124704067,5,"The `network` directory contains very fundamental network util classes for internal usage. Given this `HttpJsonClient` will be used in `schedulers` in different places only, I would suggest we put it into `schedulers-utils`.

Thus we can keep the `commo",725574287,2017-06-29 10:15:17
25989408,1165755,124869156,5,"@nlu90 agreed, that seems like the best place for it",725574287,2017-06-30 00:51:26
25991254,11442576,124702058,16,"can we put this constant string into a separate final class like `MetricsConstants`?

Making a variable public in interface or abstract class smells dangerous.",725590595,2017-06-29 09:51:09
25991254,2183863,124711798,16,"One the one hand, it seems we don't have such Constants class;
on the other hand, we have a class designed to abstract out the shared actions/implementations, which IMO is a good place to put some shared things, like a shared field.",725590595,2017-06-29 11:53:02
25991254,11442576,124863264,16,"Making a field public while allowing the class to be extended is in general a bad design.

For the problem why it's an interface, @billonahill may have a better idea.

To land this metric fast, I'll approve it for now.",725590595,2017-06-30 00:26:29
25991254,2183863,124894925,16,No rush for this pull request. Will also wait for Bill's comments.,725590595,2017-06-30 02:42:50
25996784,3201045,124715235,21,WindowInfo - can we come up with a better name?,725716314,2017-06-29 12:35:55
25996784,3201045,124715189,1,Please change the copyright?,725716314,2017-06-29 12:35:24
25996784,3201045,125070099,5,Can we have a better name than WindowInfo?,726394725,2017-06-30 22:44:28
26026234,11442576,124915161,13,need to `sort` before `uniq`,726346153,2017-06-30 04:17:04
26026234,13159450,124920374,13,"`jar tf` gives you sorted result, but just in case I can add a sort here.",726346153,2017-06-30 04:45:13
26026234,13159450,124920514,13,resolved via https://github.com/twitter/heron/pull/2023/commits/4e04b678ab612dd3b64ba100c993613c21ec1011,726346153,2017-06-30 04:46:06
26027555,11442576,124922348,44,"can we have more meaningful names for different drainers? Like for drainer1, it's tuple_set_drainer.",726371009,2017-06-30 04:55:51
26027555,11442576,124922583,33,// namespace common,726371009,2017-06-30 04:57:03
26027555,11442576,124925062,175,s/NULL/nullptr,726371009,2017-06-30 05:12:15
26027555,11442576,124922153,41,"can we use initializer list to initialize class members?
",726371009,2017-06-30 04:54:48
26027555,10216235,124932473,44,done,726371009,2017-06-30 06:05:17
26027555,10216235,124932464,41,done,726371009,2017-06-30 06:05:13
26027555,10216235,124932491,33,fixed,726371009,2017-06-30 06:05:24
26027555,10216235,124932480,175,done,726371009,2017-06-30 06:05:21
26249333,3201045,126097933,18,What is this samplebolt for? Can you add more comments?,731550699,2017-07-07 15:47:48
26249333,3201045,126097646,26,Better log message?,731550699,2017-07-07 15:46:23
26249333,3201045,126097569,25,Better log message - is this needed?,731550699,2017-07-07 15:45:57
26249333,3201045,126098313,24,"Can we do dotted notation, in a cascading fashion?",731550699,2017-07-07 15:49:54
26249333,10216235,126289116,18,Added more comments,731550699,2017-07-09 03:05:20
26249333,10216235,126289122,25,This is debug anyways. I've reworded it,731550699,2017-07-09 03:05:31
26249333,10216235,126289154,24,Changed,731550699,2017-07-09 03:07:55
26276311,10216235,126265056,15,CachedByteSize?,732117512,2017-07-08 06:35:33
26276311,32022953,126272074,15,"I did not find the CachedByteSize() in protobuf.
There is SpaceUsed() which is noticeably slower than ByteSize()",732117512,2017-07-08 09:19:41
26362100,32022953,127035419,32,`DrainTupleSet2` to explicitly mark the function for protobuf tuple version 2,734995508,2017-07-13 01:30:55
26362100,32022953,127036512,98,`bool drop` is not necessary. This branch can be in a `else`,734995508,2017-07-13 01:35:24
26362100,10216235,127039595,98,Fixed,734995508,2017-07-13 01:47:51
26362100,10216235,127039768,32,"As part of my cleanup, I'm going to change the TupleSet2 protobufs to remove the 2 part in future changes.",734995508,2017-07-13 01:48:31
26362100,32022953,127060037,32,got it,734995508,2017-07-13 03:16:48
26402851,73683,126836321,24,"Could we instead allow the caller to pass the entire list of handlers, so they could either remove or add to the defaults?
```
def run(handlers=utils.default_url_to_handlers)
```",734935741,2017-07-12 06:53:24
26402851,13159450,126836654,24,"i see little possibility that we will need to remove in the future. And if we want to enable remove here, we may want to switch to use dict. find and remove a tuple in a list is quite awkward.",734935741,2017-07-12 06:56:24
26402851,73683,126996537,24,"I wouldn't expect someone to remove from the url_to_handlers list, but instead pass a new list, that might include some of those entries.",734935741,2017-07-12 22:57:57
26433716,32022953,127038380,10,why eliminate `count--` in the `if` branch,735579055,2017-07-13 01:42:52
26433716,73683,127054075,10,"tuplesToAck gets incremented when a test message is sent, but decremented when any ack is recieved, even if it's not a test message. This seems like a bug, so I changed decrement to only happen when acks for test messages are received.

I actually don't",735579055,2017-07-13 02:51:23
26433716,73683,127081725,10,"Realized this isn't the right change and reverted it, since there are cases where tuples are emitted with a pre-existing message id, in the case that they're not test messages.",735579055,2017-07-13 04:50:37
26453887,73683,127268520,29,Can you clarify in comment what the difference is between draining and clearing?,735994839,2017-07-13 23:40:15
26453887,10216235,127279764,29,Done,735994839,2017-07-14 00:27:45
26482361,73683,127348109,30,please append with `.bytes` to make units explicit. same for disk settings.,736497408,2017-07-14 05:30:37
26482361,73683,127348161,83,s/nbytes/byteAmount/g here and below.,736497408,2017-07-14 05:31:02
26482361,73683,127349000,70,"The packing type is just a Class. It needs to be extensible so users can implement their own so an enum won't work.
```
public static void setTopologyPackingClass(Map<String, Object> conf,
    Class<? extends IPacking> packingClass);
public static voi",736497408,2017-07-14 05:36:13
26482361,73683,127348198,79,s/ncpus/cpus/g here and below,736497408,2017-07-14 05:31:19
26482361,13159450,127349355,70,I was worried if doing this can pull in lots of dependencies from schedulers. But I can try though.,736497408,2017-07-14 05:38:26
26482361,73683,127351226,70,"This would cause a problem, since IPacking and IRepacking are in spi, which depends on api, but not the other way around. We could considering moving these interfaces into api. @kramasamy do you have an opinion on this one?",736497408,2017-07-14 05:52:38
26482361,13159450,127351430,70,"You are right. I was not clear in my message above: yes, I was worried about circular dependencies as well when reading BUILD files.",736497408,2017-07-14 05:54:14
26482361,6377806,127531137,70,"Regarding packaging of `IPacking` and `IRepacking`, is the distribution of interfaces between `api` and `spi` packages needed? Given the current structure, moving these interfaces may create confusion. These interfaces are closely linked to other componen",736497408,2017-07-15 02:23:35
26482361,73683,127538164,70,"I think the intent (which makes sense to me) is that `api` is where  topology-level APIs are that topology developers might implement or specify (i.e., IBolt, ISpout, etc). The `spi` package is where system-level APIs live that would be implemented by adm",736497408,2017-07-15 03:06:19
26482361,6377806,127541489,70,"Thanks @billonahill I agree with the interpretation of the `api` and `spi` packages. 

I think packing configuration is rarely provided by topology developer. It is rather commonly specified by the administrator or the member deploying the topology via ",736497408,2017-07-15 03:25:42
26482361,73683,127542115,70,"I think the packing impls should be defaulted at the system level, but I certainly see the need to be able to override them at the topology level. We've recommended to some topology owners to specify a different packing impl to change the way resources ar",736497408,2017-07-15 03:29:11
26482361,11442576,127841961,16,"I really doubt if we need the packing algorithm to be configurable by users. By the original design, it's a system wide property which should only be set by the heron administrator.

Also, how are the `ram`, `cpu` and `disk` resource configs used? It se",736497408,2017-07-18 05:25:59
26482361,73683,127850674,16,"I could see having multiple packing implementation supported, where power users could specify a non-default based on their needs. Or even write one of their own.",736497408,2017-07-18 06:21:18
26483710,32022953,127344602,15,How does a restore help the stmgr resume from dead connection/connection lost?,736519855,2017-07-14 05:08:04
26483710,10216235,127348833,15,"This will become clearer in the following prs.
But essentially the intuition is that when a stmgr notices that its connection to another stmgr is gone, it should initiate certain actions. Like for instance, if it was running normally, it should ask the t",736519855,2017-07-14 05:34:58
26516971,73683,127545332,64,What is a local spout? Is that a marker on spout instances that are on this container?,737219454,2017-07-15 03:47:53
26516971,73683,127543435,14,why are both instance and task id necessary? Doesn't the former contain the latter?,737219454,2017-07-15 03:37:10
26516971,10216235,127547490,14,good catch. Fixed.,737219454,2017-07-15 03:59:02
26516971,10216235,127546881,64,"A stmgr services a bunch of tasks, some spouts and others bolts. local spouts are the former. This check is basically checking if this task is a local spout and only send the initiate checkpoint message to them. I will add a comment here.",737219454,2017-07-15 03:55:36
26523670,73683,127767201,7,why are the client methods virtual?,738234800,2017-07-18 00:15:23
26523670,73683,127771860,142,Could you include the _checkpoint_id being ignore here.,738234800,2017-07-18 00:34:14
26523670,73683,127771473,166,"Can you clarify what is meant by ""we will get back to restore"" here.",738234800,2017-07-18 00:32:58
26523670,73683,127775916,29,"Is there a cpp library that could be used to test with mock objects, instead of having to write dummy impls for all classes?",738234800,2017-07-18 00:49:02
26523670,73683,127768986,78,"Could you add comments to StartRestore, HandleCheckpointState and HandleInstanceRestoredState clarifying what the responsibilities of each is.",738234800,2017-07-18 00:22:35
26523670,73683,127770563,135,"instead of silently ignoring bad requests, would it be useful to the caller to know what happened? should we consider returning a more descriptive status response?",738234800,2017-07-18 00:29:08
26523670,73683,127775350,58,This code appears to be copied from one of a few other places that contain the same code. Could you put this is a common place and share it?,738234800,2017-07-18 00:47:16
26523670,73683,127770955,169,"Why does in_progress_ get set to false if it's a non-OK status, but not if it's an invalid checkpoint id that's being ignored?",738234800,2017-07-18 00:30:48
26523670,73683,127773677,51,can you clarify the responsibilities of the restorer in comments. What does it do or manage and why/when/by whom is it called?,738234800,2017-07-18 00:40:46
26523670,73683,127768522,114,why's the comment discuss sending message but the method implies getting a checkpoint?,738234800,2017-07-18 00:20:44
26523670,73683,127772081,189,"could you include the _checkpoint_id in this log message. also is this an unexpected condition (i.e., should it be a warning)?",738234800,2017-07-18 00:35:03
26523670,32022953,127786297,51,+1 could you pls put comments in header .h,738234800,2017-07-18 01:28:46
26523670,10216235,127788364,7,"For unit-testing of StatefulRestorer class, we need to define dummy ckptmgr client(and others) that override certain methods.",738234800,2017-07-18 01:35:45
26523670,10216235,127802011,78,Added,738234800,2017-07-18 02:28:30
26523670,10216235,127801994,51,Updated comments in .h(as well as the pr description),738234800,2017-07-18 02:28:26
26523670,10216235,127802062,142,Included,738234800,2017-07-18 02:28:40
26523670,10216235,127802071,166,Updated,738234800,2017-07-18 02:28:43
26523670,10216235,127802088,169,"If we cannot get the state from the checkpoint manager, then we cannot proceed with the restore. Thus its better to invoke the callback with a failure code and reset ourselves by making is_progress = false. (Most likely there will be another attempt by tm",738234800,2017-07-18 02:28:46
26523670,10216235,127802031,114,Fixed,738234800,2017-07-18 02:28:33
26523670,10216235,127802052,135,"Actually the aim is to keep the caller caller(the stmgr class) as simple as possible. Even if we did return some status code, it's not clear what stmgr would do(other than logging). But taking all those actions in this class, we can isolate all decision m",738234800,2017-07-18 02:28:37
26523670,10216235,127802115,58,This is part of a bigger cleanup that touches other tests in the directory. Will send that as part of a cleanup in another pr,738234800,2017-07-18 02:28:52
26523670,10216235,127802105,189,Done,738234800,2017-07-18 02:28:49
26523670,10216235,127802127,29,Sailesh attempted this some time back and only did partial things(mostly in the networking world). The thing is that there is some extensive re jiggering needed to make our classes mock friendly. That's why we are using virtual methods for unit tests for ,738234800,2017-07-18 02:28:57
26564680,73683,127779488,5,"this review looks like you're just calculating size of the pool differently, but what causes the pool size logic to change from being based on number of bytes to number of message in the pool impl?",738420321,2017-07-18 01:02:36
26564680,13159450,127779934,5,This is explained above: https://github.com/twitter/heron/pull/2073#issue-243279094,738420321,2017-07-18 01:04:22
26564680,73683,127815942,5,Got it. Looks like your changing the 512 to be configurable. Shouldn't the config-driven value be used here now?,738420321,2017-07-18 03:27:16
26564680,13159450,127816346,5,"it is config driven. The initial value is 512, and will be overridden here: https://github.com/twitter/heron/pull/2073/files#diff-5ff5ed00c50afd2302f522a9181e50a1R90

As for why initial value cannot be read from config, see the discussion between Sanjee",738420321,2017-07-18 03:28:59
26564680,73683,127817209,5,"Got it. Could you update the TODO nlu comment above to explain why this is config-driven, but hard coded here.",738420321,2017-07-18 03:32:28
26564680,13159450,127818131,5,@billonahill Updated here: https://github.com/twitter/heron/pull/2073/commits/01acca884a923b0fbe556e266586b8bd54019c76,738420321,2017-07-18 03:36:21
26564680,11442576,127833394,5,"Is this config for limiting the # of messages in the mempool or the total byte size in this mempool? This config is different than the other above 9 config.

Could you make them consistent and update the comment and even the config name to avoid confusi",739128219,2017-07-18 04:40:11
26564680,13159450,127833653,5,oh you are right. this is typo.,739128219,2017-07-18 04:41:22
26598326,11442576,127856952,9,should we allow multiple tasks death?,739157841,2017-07-18 07:10:03
26598326,11442576,127855864,61,should we use the global mempool here and any following places?,739157841,2017-07-18 07:00:31
26598326,11442576,127856897,83,"Why do we need this start_stateful_processing callback? Whether a topology is stateful or not is configured in user's topology code. Once a stmgr is started, it should already know if it's stateful or not by reading the topology config. And thus can behav",739157841,2017-07-18 07:09:31
26598326,10216235,127857535,61,My feeling is that its not necessary since its on control path,739157841,2017-07-18 07:15:11
26598326,10216235,127857748,83,"So topologies not doing exactly once can start processing right away as soon as assignment are propagated to all stmgrs/instances. However for exactly once semantics, we have to wait until all of the stmgrs/instances are restored to a certain globally con",739157841,2017-07-18 07:17:10
26598326,10216235,127857864,9,Not necessary. We issue these messages to the tmaster as soon as we notice any instance failure. The same applies for any stmgr client connection failures,739157841,2017-07-18 07:18:09
26598326,73683,128060594,5,typo: intiate,739157841,2017-07-19 01:41:34
26598326,73683,128060921,16,why is the checkpoint id necessary to start processing?,739157841,2017-07-19 01:42:33
26598326,10216235,128087544,16,Mostly for correctness checking purposes. Instances will check that they have recovered to this checkpoint id before starting. They should die if this checkpoint id does not match theirs.,739157841,2017-07-19 03:33:43
26640795,11442576,128119198,4,"Just a clarification, this change basically doesn't log actual message whenever any error happens. Not only the OOM error.",740079265,2017-07-19 06:09:51
26640795,13159450,128119573,4,"ok, do you want me to add an `if` to see if exception is ` OutOfMemoryError`?",740079265,2017-07-19 06:12:18
26640795,11442576,128121279,4,I'm fine with this change. Please check with others.,740079265,2017-07-19 06:28:52
26640795,2183863,128124225,4,"we should either add a ""if"" or update the description of this pull request.",740079265,2017-07-19 06:50:03
26640795,73683,128124272,4,"If the concern is only OOM errors I say we check for that and log a message that it's an OOM without logging the error. If it's anything else, we should log it.",740079265,2017-07-19 06:50:18
26640795,134219,128125120,10,"I guess you can do something like 
```
try {
  LOG.log(""..."")
} finally {
  Runtime.getRuntime().halt(1);
}
```

This both will log and most likely will halt process.",740100708,2017-07-19 06:57:10
26676890,32022953,128365076,31,"39.1  
391.1",740846935,2017-07-20 03:57:16
26681866,73683,128577943,137,"For this and others we should annotate as deprecated:
```
/**
 * Acking is now internally set based on the reliability mode being used.
 *
 * @deprecated use {@link #setReliabilityMode()} instead.  
 */
@Deprecated
public static void setEnableAcki",740925990,2017-07-21 00:20:09
26681866,73683,128577021,44,"This seems orthogonal to the reliability mode IMO. If exactly once leverages the stateful impl that's an implementation detail. From the users perspective these are different things. The reliability mode should specify guarantees with tuple reliability, w",740925990,2017-07-21 00:16:05
26681866,10216235,128591797,44,Thats an interesting thought! It seems in general there might be lack of consensus/clarity on this one. So I've removed STATEFUL from the list of the modes. We'll add it back later.,740925990,2017-07-21 01:15:19
26681866,73683,128601286,13,"FWIW, I found no occurrences of `TOPOLOGY_ENABLE_ACKING` or `setEnableAcking` in twitters codebase. @nlu90 @maosongfu do you know how topologies set acking without using those?",741567632,2017-07-21 01:51:29
26681866,73683,128599508,4,"Where we add this, we should add a comment that it's only need until TOPOLOGY_ENABLE_ACKING is removed. That way it doesn't linger after TOPOLOGY_ENABLE_ACKING is removed. Same for other occurrences in this pr.",741567632,2017-07-21 01:45:06
26681866,10216235,128603955,4,Added comments,741567632,2017-07-21 02:01:37
26681866,73683,128609888,13,"I thought there were too, but I don't see it being enabled by using either of these. Is there any other way?",741567632,2017-07-21 02:29:00
26681866,10216235,128604089,13,I remember @maosongfu @kramasamy mentioning that there are some native heron topologies inside Twitter that might be using these features.,741567632,2017-07-21 02:02:11
26681866,10216235,128591528,137,Fixed,740925990,2017-07-21 01:14:08
26719408,73683,128836852,5,"This occurrence should redirect people to the one with the similar constructor, so the first one with the map. The other javadoc error in this class should send them to the second one without it.",742438182,2017-07-22 01:54:38
26719408,64790,128837493,5,"Okay, will change.",742438182,2017-07-22 01:57:16
26728199,11442576,128870883,153,"could you elaborate why in this case the `ResetTopologyState` message needs to be sent?
",741995595,2017-07-22 05:06:29
26728199,11442576,128866480,292,this comment here is duplicated with the one in the above method. Could you update it to correctly describe the actual behavior of this method?,741995595,2017-07-22 04:37:39
26728199,11442576,128870282,126,s/withi/with,741995595,2017-07-22 05:01:52
26728199,11442576,128867135,79,should we have some metrics for the amount of data being dropped for both stmgr data and instance data for future tracking and investigation?,741995595,2017-07-22 04:42:21
26728199,10216235,128898350,79,Added,741995595,2017-07-22 21:57:22
26728199,10216235,128898354,126,Fixed,741995595,2017-07-22 21:57:26
26728199,10216235,128898357,153,Changed the description,741995595,2017-07-22 21:57:34
26728199,10216235,128898361,292,Fixed the comment,741995595,2017-07-22 21:57:40
26762389,3201045,128924226,8,can you move it to the top - all the version so that it is all in one place.,742661835,2017-07-23 23:51:24
26762389,3201045,128924244,18,do you want to keep at 8888 similar to tracker?,742661835,2017-07-23 23:52:14
26762389,7235147,128924533,8,ok,742661835,2017-07-24 00:06:07
26762389,7235147,128924559,18,I wanted something different until we collapse it so it doesn't interfere with the tracker and ui default ports.,742661835,2017-07-24 00:07:41
26762389,13159450,128936933,66,lots of unnecessary newlines here,743531941,2017-07-24 08:31:12
26762389,7235147,129058491,66,will remove,743531941,2017-07-24 21:52:04
26834816,10216235,129167061,9,should this be called cleanallstatefulcheckpoints?,744484505,2017-07-25 05:06:24
26834816,73683,129167385,9,"are we able to inject underscores for readability for long, multi-word paths?",744484505,2017-07-25 05:08:12
26834816,11442576,129170972,9,@srkukarni @billonahill  updated the handler name as well as adding underscores,744484505,2017-07-25 05:27:29
26862786,32022953,129381806,28,"if we want to add more sensors, do we have to add enum here as well?",745118219,2017-07-26 01:08:09
26862786,6377806,129419423,28,"No, custom sensors will not need to add metric names to this enum. This enum simplifies development and testing of sensor implementation shipped with heron.",745118219,2017-07-26 03:40:52
26862786,73683,129915654,8,awesome! :),746194987,2017-07-28 01:04:44
26862786,73683,129918468,51,"Can these by private and final? If needed by subclasses could we instead do so with a getter? Or if just for initialization they could be part of a constructor. This helps to better define the class contract, and to make that clear in javadocs.",746194987,2017-07-28 01:14:50
26862786,73683,129915888,4,"This should not be necessary, since `//heron/proto:proto-java` should contain all protos. If that's not the case would you please fix that target to make it so.",746194987,2017-07-28 01:05:41
26862786,73683,129917555,80,can you clarify why 1000 is chosen as the cap,746194987,2017-07-28 01:11:50
26862786,73683,129918236,64,Can duration be calculated once in the constructor?,746194987,2017-07-28 01:13:59
26862786,6377806,130388183,80,`averageBP` is the number of millisec backpressure per second. Hence the value 1000. Sometimes Heron can double count the back pressure time and provide a value larger than 1000 (https://github.com/twitter/heron/issues/1753). This check partially corrects,746194987,2017-07-31 22:37:42
26862786,6377806,130393541,51,fixed,746194987,2017-07-31 22:57:19
26862786,6377806,130393684,64,fixed,746194987,2017-07-31 22:57:51
26862786,6377806,130394581,4,"The `proto_packing_plan_java` target is included in `heron/proto/BUILD:proto-java`. So `proto-java` should be sufficient? However, earlier my local build failed and bazel suggested that I add these targets. For now I have removed the targets to check if i",746194987,2017-07-31 23:01:16
26862786,73683,130426602,80,would you please clarify this with comments in the code.,746194987,2017-08-01 01:37:48
26862786,6377806,130461101,80,Fixed by adding comments,746194987,2017-08-01 04:02:06
26875186,13159450,129472040,8,"We need to test if we can build inside of Twitter environment. Inside Twitter, there is no access to outside network. This means we cannot fetch pex rules repo.",745360497,2017-07-26 09:49:51
26875186,3201045,129473279,8,agreed - the repo can be easily duplicated since once it is deployed the changes will be none or minimal,745360497,2017-07-26 10:03:37
26875186,13159450,129477432,8,"Sorry @kramasamy, can you clarify ""duplicated"" and ""deploy"" here? I can't follow the context...",745360497,2017-07-26 10:59:26
26875186,3201045,129477710,8,"you can have a copy of that repo internally at Twitter. In twitterify script, you could change the repo to refer to the internal repo.",745360497,2017-07-26 11:02:58
26875186,13159450,129477928,8,@kramasamy Understood. Sounds good - but we need to set up mirror first. I will give a shipit now but we should make sure mirror is set up first (cc @huijunw since I'm on PTO.),745360497,2017-07-26 11:05:43
26875186,3201045,129478114,8,@objmagic - let us get this branch work internally first before we can merge the changes. I have been testing and it seems to work - except a java test failure in one of the travis-ci,745360497,2017-07-26 11:08:13
26875186,73683,129694959,8,"Before creating a twitter fork we should look into whether we can proxy this in twitter's env. The fork is not a good solution since it will not automatically get new tags on it, so the build will fail when version updates happen without manual interventi",745360497,2017-07-27 04:01:11
26875186,32022953,129696451,8,@nlu90 suggested to mirror that repo as we did for twitter-heron repo,745360497,2017-07-27 04:07:09
26875186,73683,129702872,8,+1 for a mirror that picks up updates.,745360497,2017-07-27 04:36:40
26875186,3201045,129737919,8,mirror will not be sufficient since the remote repository URLs have to change to internal twitter URLs.,745360497,2017-07-27 08:45:55
26876113,11442576,129461011,217,nullptr,745376843,2017-07-26 07:51:26
26876113,11442576,129461121,49,s/Ckpt/Checkpoint,745376843,2017-07-26 07:52:24
26876113,11442576,129460901,209,nitpick: s/controller_/tmater_controller_ to differentiate with the stateful_controller_,745376843,2017-07-26 07:50:17
26876113,11442576,129461191,33,"s/GetStatefulCheckpointDone/GetStatefulCheckpointsDone

And the same for the following methods.",745376843,2017-07-26 07:53:03
26876113,10216235,129467798,209,Can I do it in the next pr? My feeling is that this name change will make this change confusing.,745376843,2017-07-26 09:01:06
26876113,10216235,129468312,217,fixed,745376843,2017-07-26 09:06:59
26876113,10216235,129468329,33,changed,745376843,2017-07-26 09:07:04
26876113,10216235,129468337,49,renamed,745376843,2017-07-26 09:07:09
26876113,11442576,129481642,209,sure,745376843,2017-07-26 11:54:21
26884489,2183863,129764812,257,"It implies that we would only use java default serialization/deserialization. It is good to have an interface for it, similar to tuple serialization/deserialization. Users could provide an implemented one, or a default one will be used (java default or kr",746417934,2017-07-27 13:48:37
26884489,10216235,129907336,257,"For what its worth, its better to just piggy back on the regular serialization that ppl use for tuples instead of having multiple serialization interfaces.",746417934,2017-07-28 00:34:20
26884489,73683,129931475,13,Why not use generics in the interface here so instances can handle any types of state?,746883847,2017-07-28 02:04:48
26884489,73683,129932042,62,why have the Slave create empty state? shouldn't this be injected? there could be previous state to be loaded.,746883847,2017-07-28 02:07:15
26884489,73683,129932996,12,"Why are State types being limited to byte[] here? A bolt implementor should be able to define state as anything that satisfies `State<? extends Serializable, ? extends Serializable>` no?",746883847,2017-07-28 02:11:10
26884489,11442576,129937567,12,good suggestion. Updating it.,746883847,2017-07-28 02:31:01
26884489,11442576,129958872,12,updated,746883847,2017-07-28 04:04:12
26884489,11442576,129963654,62,"This empty state is just for initialization. If the instance is instructed to restore from a state, they will receive a `RestoreInstanceStateRequest` request, and thus `handleRestoreInstanceStateRequest ` will take care of loading the state",746883847,2017-07-28 04:25:59
26884489,73683,129966521,62,"But the state should always be injected from the state server right? The slave should not assume that the state is empty state until it hears from the state server. It should be told this state by someone else, even if it's empty.",746883847,2017-07-28 04:40:35
26884489,11442576,129969886,62,"When `HeronInstance` starts the slave thread, it also doesn't know what's the state for it. So it's not the guy who can inject the state into an instance. Actually, stream manager is the one who sends the state to a local instance via the network. Instead",746883847,2017-07-28 04:58:07
26884489,10216235,129978317,62,"Agree with Neng, null might be more appropriate",746883847,2017-07-28 05:52:24
26884489,73683,129981769,62,+1 for null,746883847,2017-07-28 06:18:13
26884489,73683,129982015,262,null check?,747088127,2017-07-28 06:20:03
26884489,73683,129982080,209,is it possible that instanceState hasn't yet been set here?,747088127,2017-07-28 06:20:38
26884489,11442576,129982423,262,good catch,747088127,2017-07-28 06:23:25
26884489,11442576,129983429,209,"If the topology is not a stateful one, then a `null` state won't affect anything. It's not used by user code at all.

If the topology is a stateful one, and we haven't received the RestoreInstanceStateRequest. Then the components will start with a null ",747088127,2017-07-28 06:31:30
26922051,6377806,130992138,135,Is the `info` level logging required here?,749790001,2017-08-03 03:48:04
26922051,6377806,130990533,42,It seems this provider depends on `metricscachemgr-java` in BUILD because of this import. Would it be better to rather define the constant here?,749790001,2017-08-03 03:41:35
26922051,6377806,130991419,93,s / tracker / metricsCache,749790001,2017-08-03 03:45:16
26922051,6377806,130953573,58,We could also take the provider class name as input. In which case we would need to load the class followed by binding. I think this would be consistent with the way modules are configured in heron.,749790001,2017-08-03 01:11:09
26922051,6377806,131264299,144,"In normal cases this string concatenation will not be needed and hence can be avoided. For e.g. using LOG.log(Level.FINE, msg, param)",752216298,2017-08-04 04:27:53
26922051,6377806,131264229,136,"In normal cases this string concatenation will not be needed and hence can be avoided. For e.g. using `LOG.log(Level.FINE, msg, param)`",752216298,2017-08-04 04:27:30
26965163,32022953,129997061,12,"Does `heron.instance.set.data.tuple.size.bytes` have to be less than `heron.instance.network.options.maximum.packet.bytes`? If yes, shall we validate them before use them?",747146513,2017-07-28 08:40:17
26965163,10216235,130003295,12,We could. Do you know where is validation done?,747146513,2017-07-28 09:56:00
26988560,4456654,130147134,6,"What is jobs 25 parameter doing , is it controlling parallelism",747674432,2017-07-29 00:48:58
26988560,3201045,130149249,6,"It is controlling the number of jobs that can run in parallel. Docker containers in Mac by default comes with 4 cores and 2 GB of memory. Within that constraint, we are able to run 25 jobs without bazel terminating with the error 'EOF'.",747674432,2017-07-29 00:59:05
26999382,73683,130428314,16,please add some comments about what this target does and how it does it.,747886243,2017-08-01 01:44:12
26999382,73683,130428186,20,we should apply javac settings consistently for all targets. Can we do this for all?,747886243,2017-08-01 01:43:43
26999382,4456654,130434288,20,The goal would be do eventually not part of this commit.,747886243,2017-08-01 02:07:34
26999382,3201045,130434957,1,please move this file into tools/rules - where we keep all the bazel rule files. It is not ideal in the new version of bazel but eventually when we move to next version of bazel we can move this around.,747886243,2017-08-01 02:10:24
26999382,3201045,130435199,1,Again this should be in tools/rules as well - until we move it later versions of bazel.,747886243,2017-08-01 02:11:27
26999382,4456654,130436068,16,"What kind of comments specifically it's , not my it's from google themselves.",747886243,2017-08-01 02:15:18
27000699,2508294,130210725,28,"If stmgr A lost connection to stmgr B and tried 28 times on Monday, and re-connected successfully at the 29th attempt. Four days later on Friday, stmgr A lost connection to stmgr B again and tried to re-connect 2 times and quit.
I suggest resetting `reco",747916218,2017-07-29 08:34:41
27000699,11442576,130213534,28,Good idea. Updated,747916218,2017-07-29 11:44:03
27010102,3201045,130222690,5,We might need this as well so that we file that is being used always.,748214268,2017-07-29 22:24:11
27010102,3201045,130222692,5,"this should Log.info since it gives an idea about how long it look always independent of whether there is verbose.

",748214268,2017-07-29 22:24:13
27010102,10216235,130224804,5,Why do we need it in non verbose mode?,748214268,2017-07-30 00:31:05
27010102,10216235,130224810,5,Again the same reason as above. Why do we need it in non verbose mode?,748214268,2017-07-30 00:31:28
27058073,3201045,130402661,5,What happens when you relaunch the topology after changing code? Then the new code will not take effect?,749480334,2017-07-31 23:47:52
27058073,10216235,130440528,5,"The thing is that when launching we need to clean the directory. I've updated the pr to ensure that we clean the working directory while setting it up. This way, new topology launches will be ok.",749480334,2017-08-01 02:35:11
27066622,73683,130452065,11,"Instead of ""all Heron jars are required to run with Java 8"" how about ""but Heron topologies are required to run with a Java 8 JRE""

/cc @lucperkins, @kramasamy for comment",749667959,2017-08-01 03:24:54
27066622,3201045,130454522,11,+1,749667959,2017-08-01 03:35:33
27066622,4456654,130455475,11,done,749667959,2017-08-01 03:39:25
27110627,32022953,130749828,70,"If we don't want this test, we may remove it.",750561114,2017-08-02 05:58:07
27110627,6377806,131005432,70,"Good catch, thanks. Fixed by reenabling the test. ",750561114,2017-08-03 04:45:43
27120370,10216235,130779554,12,why is the SuppressWarnings needed?,750714459,2017-08-02 10:43:24
27120370,11442576,130985055,12,"yes, we need to suppress the cast of `State<Serializable, Serializable>`, java's type erasure the two parameter type of the `State` is lost.",750714459,2017-08-03 03:19:37
27166933,3201045,131070970,5,you should use ${HOME}/.herondata/checkpoints,751688670,2017-08-03 14:33:39
27166933,3201045,131070858,5,you should use ${HOME}/.herondata/checkpoints,751688670,2017-08-03 14:32:59
27166933,10216235,131120155,5,"It's much easier to expand ~ than using ${HOME}.
BTW the other uses of ${HOME} used in files like statemgr.yaml is really not used by the code. Its being overriden manually. See https://github.com/twitter/heron/blob/master/heron/statemgrs/src/java/com/tw",751688670,2017-08-03 18:49:00
27227124,3201045,131450250,15,self._initialized_global_metrics?,752887122,2017-08-05 01:01:21
27229422,3201045,131574297,4,generate_pom.cc should go into tools - this looks a generation tool that can be shared by others.,752929813,2017-08-07 12:22:43
27229422,4456654,131628476,4,"Will have to parameterize it to make it shareable , will do that.",752929813,2017-08-07 18:09:57
27229422,13159450,132023332,23,libtensorflow?,752929813,2017-08-09 03:30:30
27229422,4456654,132029251,23,Will change that and take a look at the existing pom scripts.,752929813,2017-08-09 03:54:41
27229422,13159450,132029947,23,"Yes, we **must** follow existing POM files. The generated POM files **must** be the same one generated now.

Please read https://github.com/twitter/heron/pull/1811 if you want to know why.

And why a C++ program to do this job? A Python program should",752929813,2017-08-09 03:57:27
27359474,3201045,132059771,5,It should be a sub block,755844276,2017-08-09 06:39:05
27403137,10216235,132332985,32,Note that parallelism is optional and will inherit from the prev stage.,756685213,2017-08-10 06:32:54
27442167,10216235,132589290,5,pythonconnectors-py. Here and other places,757470150,2017-08-11 05:57:37
27470950,32022953,133053857,125,"If these functions include a single line simple body, I would suggest calling its body directly. I do not see the necessity of wrapping it in function.",758892502,2017-08-15 03:33:41
27470950,6377806,133063281,125,"The methods are utility methods related to use of enum to replace hard-coded argument names. Instead of adding `.text` everywhere, which seems annoying, I added these utility methods",758892502,2017-08-15 04:13:59
27470950,32022953,133063636,125,got it,758892502,2017-08-15 04:15:27
27602920,11442576,133528580,4,"Since this change changes the aurora conf file and also adds new yaml conf file, it will break the current topology deployment process for Twitter's environment. Please coordinate with @huijunw @objmagic or me to make sure that the necessary changes insid",761738577,2017-08-17 01:24:35
27602920,32022953,133532191,4,thanks for reminder,761738577,2017-08-17 01:38:27
27602920,6377806,133538310,4,"Ok, please let me know once the private env is ready.

Also, I think it is time to make the `executor` smart. As per the current pattern, the scheduler loads the configs and passes to the `executor`. This could be avoided as the executor has access to t",761738577,2017-08-17 02:01:40
27602920,32022953,133552599,4,"The original idea of heron-executor is the simple entry point in the container to start and monitor the other processes in the same container. Loading configs is not heron-executor's job. However, heron-executor evolves complex. Correct me if i am wrong.",761738577,2017-08-17 03:05:24
27602920,32022953,133556395,53,"If MetricsCacheMgr is the source, MetricsCacheMgr port is not determined in the config yaml. The port in the url has to be passed by command line. I suggest pass the url in command line for MetricsCacheMgr. The heron-executor knows MetricsCacheMgr port.",761738577,2017-08-17 03:21:48
27602920,32022953,133555327,36,"This LOG is before `setupLogging(cmd, config);`?",761738577,2017-08-17 03:17:22
27602920,32022953,133553135,15,why is scheduler class path in healmgr class path,761738577,2017-08-17 03:07:50
27602920,6377806,133602954,15,"The health manager needs repacking algorithm, state manager and scheduler client. All these components are part of scheduler classpath.",761738577,2017-08-17 08:02:50
27602920,6377806,133603510,53,I realized that the cache manager port is dynamic. As the executor does not know the type of the provider and the metrics cache port does not apply to other metrics providers. So that is not feasible. The metrics cache port is saved in state manager. Heal,761738577,2017-08-17 08:08:28
27602920,2508294,133608293,53,agree.,761738577,2017-08-17 08:59:08
27602920,32022953,134037374,53,@ashvina any update?,761738577,2017-08-19 02:25:02
27602920,6377806,134098002,36,Fixed by removing the log message.,761738577,2017-08-20 01:34:24
27697140,4456654,133886468,24,why are we switching to cmake ?,762946152,2017-08-18 13:16:48
27697140,3201045,133886564,24,new gflags use cmake now - instead of configure/make in the older versions.,762946152,2017-08-18 13:17:37
27724678,4456654,134056977,5,You are deleting this function,763487930,2017-08-19 04:14:27
27724678,10216235,134058412,5,"I'm deleting the interface function from streamlet, but letting all other derivates implement calculating inputs in their own way. Thus the _calculate_inputs method here is the local one defined above",763487930,2017-08-19 04:23:06
27774363,3201045,134139494,4,"Instead of long name distributedlog, can we use just dlog?",764708109,2017-08-21 10:18:26
27774363,3201045,134139532,6,dlog-java?,764708109,2017-08-21 10:19:18
27774363,3201045,134139551,6,dlog-java?,764708109,2017-08-21 10:19:39
27774363,7235147,134140465,4,this should be BKDownloader.class instead of Downloader.class,764708109,2017-08-21 10:36:58
27774363,7235147,134140813,21,typo in the key? should it be heron.uploader.bk? ,764708109,2017-08-21 10:43:14
27774363,269478,134574389,4,"we don't support 'dlog://' in distributedlog now. if we want to support that, it requires a change on distributedlog itself.",764708109,2017-08-23 02:07:09
27774363,269478,134574437,6,I will change that.,764708109,2017-08-23 02:07:17
27774363,7235147,134880129,21,spelling mistake? heron,767037593,2017-08-24 04:49:13
27774363,269478,134880804,21,nice caught,767037593,2017-08-24 04:52:49
27774363,269478,134882330,21,fixed ,767037593,2017-08-24 05:00:47
27774363,7235147,134906266,22,Is it possible to remove the guava dependency for downloader?,767064095,2017-08-24 08:01:47
27774363,269478,134925986,22,@cckellogg I can remove direct dependency. however the dlog/bk library depends on guava. I can try to shade them in dlog library. does that work for you?,767064095,2017-08-24 11:47:31
27774363,7235147,135074113,22,Yes that works.,767064095,2017-08-25 00:06:19
27774363,11442576,139337076,8,"What's the reason to use singleton pattern here? In general, I think we should avoid using this patter. It causes a lot of pain to maintain code related with the singleton.",783729436,2017-09-18 11:54:20
27774363,269478,139338413,8,I changed it from static method to a class method of a singleton for unit testing. so I can easily mock Extractor for unit testing.,783729436,2017-09-18 12:21:18
27774363,11442576,139339990,8,"If it's just for easier unit testing purpose, you don't need to change the original static method.

PowerMockito could help you mock static method easily. Here's an example: https://github.com/twitter/heron/blob/master/heron/scheduler-core/tests/java/co",783729436,2017-09-18 12:50:26
27800492,1165755,134349354,124,No need to extract the TAR file anymore? Assuming you've tested this.,765359961,2017-08-22 05:50:55
27800492,7235147,134349884,124,the downloader extracts the tar.gz on the file. There is a test for this (ExtractorTests under heron/downloaders/tests),765359961,2017-08-22 05:55:01
27836737,10216235,135329976,9,?,768524560,2017-08-26 01:54:18
27836737,10216235,135329935,5,?,768524560,2017-08-26 01:54:05
27843852,2183863,134623331,60,final,766217887,2017-08-23 06:09:48
27843852,2183863,134622353,94,"no need to make it synchronized:
- it is a private method
- the only entry is get() above, a synchronized public method",766217887,2017-08-23 06:02:41
27843852,2183863,134622685,86,"getShellUrl can return null. A safety check is required here. Otherwise, the debug could be hard.",766217887,2017-08-23 06:04:46
27843852,2183863,134622989,95,A log is required here to tell no resolver exists. Or throw exceptions if it means some really bad things.,766217887,2017-08-23 06:06:59
27843852,2183863,134621741,61,"return stmgr.getHostName() + "":"" + stmgr.getShellPort();",766217887,2017-08-23 05:58:03
27843852,2183863,134622131,81,"I can not find an override toString() method for ContainerRestart. Could we check we get a meaningful print-out?
If so, can you add a comment for a sample event.toString() in the code?",766217887,2017-08-23 06:01:06
27843852,2183863,134623352,62,final,766217887,2017-08-23 06:09:59
27843852,2183863,134623470,91,I would recommend breaking this method into several smaller methods.,766217887,2017-08-23 06:10:59
27843852,2183863,134622111,90,"I can not find an override toString() method for ContainerRestart. Could we check we get a meaningful print-out?
If so, can you add a comment for a sample event.toString() in the code?",766217887,2017-08-23 06:00:58
27843852,2183863,134622847,57,"plz document down clear in comments whether it will:
- return null
- return """"
- or throw exceptions
for this method in abnormal case",766217887,2017-08-23 06:05:46
27843852,2183863,134623341,61,final,766217887,2017-08-23 06:09:54
27843852,2183863,134622513,78,Can we use a more type-safe method rather than a cast `(int) policyConfig.getConfig....`?,766217887,2017-08-23 06:03:48
27843852,2183863,134624022,104,safer to return an empty List; would not rely on an external safety check.,766235954,2017-08-23 06:15:19
27843852,32022953,134625882,81,@ashvina what is output sample for TopologyUpdate.toString()?,766217887,2017-08-23 06:29:30
27843852,32022953,134625915,57,throw exception doen,766217887,2017-08-23 06:29:45
27843852,32022953,134625953,61,fixed,766217887,2017-08-23 06:29:54
27843852,32022953,134626157,94,@ashvina what is rational to `synchronized` https://github.com/twitter/heron/blob/master/heron/healthmgr/src/java/com/twitter/heron/healthmgr/common/PackingPlanProvider.java#L99,766217887,2017-08-23 06:31:28
27843852,32022953,134626817,95,"added.
@ashvina same comment to DynamicResourceAllocationPolicy",766217887,2017-08-23 06:36:54
27843852,32022953,134626988,104,"need @ashvina confirm the expected return value for resolve()
what is difference between empty list and null?",766235954,2017-08-23 06:38:18
27843852,32022953,134627057,86,done with exception,766217887,2017-08-23 06:38:46
27843852,32022953,134627147,91,"the code is refactored, which looks more concise.",766217887,2017-08-23 06:39:22
27843852,32022953,134627593,62,done,766217887,2017-08-23 06:42:51
27843852,32022953,134627609,61,done,766217887,2017-08-23 06:42:57
27843852,32022953,134627650,60,"done
@ashvina the same comment to ScaleUpResolver",766217887,2017-08-23 06:43:19
27843852,6377806,134803625,48,The scheduler implements a command to restart a given container. Why is the scheduler not used here?,766253119,2017-08-23 23:32:20
27843852,6377806,134805553,60,"My impression is that this policy will restart a container if a slow instance is detected. So this policy just depends on `BackPressureDetector`, `WaitQueueDisparityDetector`, `SlowInstanceDiagnoser` and `RestartContainerResolver`. The other detector and ",766253119,2017-08-23 23:40:16
27843852,6377806,134804831,48,Please add java doc explaining this policy. I missed adding it to the `DynamicResourceAllocationPolicy`.,766253119,2017-08-23 23:37:16
27843852,6377806,134803602,16,The `GrowingWaitQueueDetector` is not used by this policy. This config can be removed.,766253119,2017-08-23 23:32:14
27843852,6377806,134803751,79,"This method does not belong to this class. This class should just provide the physical plan. Creation of shell url should live in some utility class?

Also, save as above, why not use the scheduler's restart command as used by the command line?",766253119,2017-08-23 23:32:58
27843852,6377806,134805656,64,`UnderProvisioningDiagnoser` and `DataSkewDiagnoser` is not needed?,766253119,2017-08-23 23:40:42
27843852,6377806,134806269,51,The variable name has `millis` as the unit whereas the config name as `min` as the unit. In absence of conversion this will be incorrect?,766253119,2017-08-23 23:43:23
27843852,6377806,134805726,62,`ProcessingRateSkewDetector` is not needed?,766253119,2017-08-23 23:41:02
27843852,6377806,134805969,85,These diagnosis will not be generated if the diagnoser is not added by the policy.,766253119,2017-08-23 23:41:58
27843852,32022953,134843299,48,"The Aurora scheduler restart command is done by CLI `aurora job restart xxx`, however aurora CLI is not available inside container. If we install Aurora CLI inside container, we do not have the user's key which was used to submit the topology and the `aur",766253119,2017-08-24 02:06:20
27843852,6377806,134847114,48,"@huijunwu @maosongfu 

This is a aurora specific limitation and the accordingly the implementation of this resolver is aurora specific. I would suggest we rename this restart policy and this resolver to clearly mark that. A generic implementation should",766253119,2017-08-24 02:24:00
27843852,32022953,134854952,48,"Agree with a generic based on scheduler. I would suggest:
1. For `restart container` resolver, we use scheduler api
2. For Aurora scheduler, we add an implementaion for `restart` command by heron-shell, and a config to indicate the Aurora scheduler is d",766253119,2017-08-24 02:59:49
27843852,2183863,134860731,48,"+1 for the proposal above.

For scheduler service for Aurora, it violates part of Twitter DC's security design, so I would say not betting on it for near future, at least for the Twitter environment. ",766253119,2017-08-24 03:24:36
27843852,32022953,135626701,16,removed,766253119,2017-08-29 03:33:12
27843852,32022953,135630177,48,changed to scheduler api to restart container,766253119,2017-08-29 03:46:13
27843852,32022953,135630227,79,removed,766253119,2017-08-29 03:46:23
27843852,32022953,135631373,48,added,766253119,2017-08-29 03:50:58
27843852,32022953,135632122,60,removed,766253119,2017-08-29 03:53:56
27843852,32022953,135632218,62,removed,766253119,2017-08-29 03:54:19
27843852,32022953,135632240,64,removed,766253119,2017-08-29 03:54:26
27843852,32022953,135632281,85,removed,766253119,2017-08-29 03:54:37
27843852,32022953,135636650,51,"changed `min` to `ms`
there is the same issue in `DynamicResourceAllocationPolicy`",766253119,2017-08-29 04:13:21
27872200,32022953,134860511,33,The buildCommonConfigModule() is associated with the injector inside HealthMgr. How does Guice link that inject to here.,766837498,2017-08-24 03:23:38
27876388,10216235,134832794,5,Is this correct?,766923273,2017-08-24 01:25:22
27876388,4456654,134842306,5,fixed,766923273,2017-08-24 02:02:03
27876388,3201045,134906883,7,aggregate all common and instance references?,767147999,2017-08-24 08:08:36
27876388,3201045,134907034,15,can you change the target pytest-py to something like instance-tests-py,767147999,2017-08-24 08:10:27
27876388,3201045,134906664,6,move one line up,767147999,2017-08-24 08:06:27
27876388,4456654,134933497,7,done,767147999,2017-08-24 13:09:25
27876388,4456654,134933491,6,done,767147999,2017-08-24 13:09:22
27876388,4456654,134933501,15,done,767147999,2017-08-24 13:09:28
27876388,10216235,135100540,4,pex loader should go back to common. That way tools will not depend on instance,767763974,2017-08-25 01:53:04
27876388,4456654,135111309,4,done,767763974,2017-08-25 02:41:00
27957154,10216235,135351926,84,I believe Java already has a Duration?,768542074,2017-08-26 03:58:24
27957154,10216235,135587416,310,Could it be possible not to use getSourceGlobalStreamId(). One of the reasons that we did not implement this in heron was that we felt it exposed too low level details. Could we instead get the SourceComponent and SourceStreamId as individual parameters?,769903728,2017-08-29 00:47:52
27957154,10216235,135588789,17,Could you please add java docs as well as descriptions for what these members stand for,769903728,2017-08-29 00:53:20
27957154,10216235,135590432,21,What does S stand for?,769903728,2017-08-29 00:59:00
27957154,1575030,135621371,310,"@srkukarni I understand what you are saying, but there are already places in the Heron Java API that use proto buf objects e.g. TopologyContext:

Map<TopologyAPI.StreamId, TopologyAPI.Grouping> getThisSources()",769903728,2017-08-29 03:11:25
27957154,1575030,135625305,21,"will remove.  This had to do with state implementation along side windowing, but we will not pulling in that piece yet",769903728,2017-08-29 03:27:23
27957154,1575030,135625339,17,will add,769903728,2017-08-29 03:27:31
27957154,10216235,135972046,10,can we have heron_java_api_proto_files instead,770476550,2017-08-30 12:19:54
27957154,1575030,135972231,10,sure,770476550,2017-08-30 12:22:01
27964384,32022953,135640401,114,what is this httpserver for ? who will send request to this server?,769810703,2017-08-29 04:29:11
27964384,32022953,135638996,18,This class seems like a Util class. The class name may be Util rather than Metrics,769810703,2017-08-29 04:23:28
27964384,7235147,135643530,18,I will update the name.,769810703,2017-08-29 04:44:00
27964384,7235147,135644087,114,It is there from the old WebSink sink class. This provides an endpoint for the prometheus service to scrape metrics from.  I added this class so both the WebSink and PrometheusSink could share the http server code. Thoughts? ,769810703,2017-08-29 04:46:39
27964384,32022953,135645272,114,"I though MetricsSink is a client which send metrics to Prometheus server.
If we need to make MetricsSink as server, why not use tmaster/metricscache httpserver https://github.com/twitter/heron/blob/master/heron/tmaster/src/cpp/manager/stats-interface.h#L",769810703,2017-08-29 04:52:48
27964384,7235147,135876284,114,The metrics for prometheus need to be in a certain format for exporting (https://prometheus.io/docs/instrumenting/exposition_formats/). This why the http server is used. I think keeping it here makes it less invasive with the core code and less stress on ,769810703,2017-08-30 01:35:16
27964384,10216235,135884001,114,It might also be a more scalable way of doing things because now you have prometheus server connecting to each metrics manager to get the stats so the load is more evenly distributed. ,769810703,2017-08-30 02:05:06
27964384,7235147,139557170,114,@huijunw do you have any more concerns? we would like to get this in. thanks.,769810703,2017-09-19 05:30:53
27964384,2508294,139579065,114,"@cckellogg no more concerns, LGTM",769810703,2017-09-19 08:27:12
27964384,11442576,139588966,10,this line of comment is no longer valid. Please remove it or update it,786844098,2017-09-19 10:16:02
27964384,11442576,139588988,10,this line of comment is no longer valid. Please remove it or update it,786844098,2017-09-19 10:16:22
28033272,10216235,135605674,14,ByteSizeLong?,770389707,2017-08-29 02:02:04
28033272,13159450,135613451,14,I could not find `ByteSizeLong` API in generated code. Let me try again...,770389707,2017-08-29 02:37:01
28033272,13159450,135613900,14,seems this is [introduced in 3.1.0](https://github.com/google/protobuf/blob/master/CHANGES.txt#L319) and then [deprecated in 3.4.0](https://github.com/google/protobuf/blob/master/CHANGES.txt#L58),770389707,2017-08-29 02:39:06
28033272,13159450,135622664,14,"also, ByteSize calculates size of serialized message, which seems will be slightly larger than actual size in memory.",770389707,2017-08-29 03:17:00
28033272,13159450,135628705,14,"so if the message is 60MB but only little part of it is used to hold the incoming message (because incoming message is small), we will not delete it because I believe serialized size is much smaller than 60MB. ",770389707,2017-08-29 03:40:28
28158582,10216235,136430904,9,can we print iter->first here as well,772933995,2017-09-01 02:46:11
28210533,3201045,136690192,19,downloaded?,773941269,2017-09-02 13:08:36
28210533,3201045,136690184,4,@jerrypeng - comment about how these values are being chosen will be helpful. Are these values configurable by the user?,773941269,2017-09-02 13:08:01
28210533,1575030,136690223,19,will fix,773941269,2017-09-02 13:10:49
28210533,1575030,136690269,4,@kramasamy I discussed with @srkukarni and he recommended we just use some hard coded values since these values for the queue are going to be transient anyways,773941269,2017-09-02 13:14:25
28210533,3201045,136690295,4,"@jerrypeng - that is fine. please just add a comment saying that we are using arbitrary values since it is going to transient. Later when somebody reads the code, they might not be able to know the context.",773941269,2017-09-02 13:16:04
28210533,1575030,136690311,4,The values used are default values chosen from the heron_internals.yaml file,773941269,2017-09-02 13:16:57
28210533,1575030,136690318,4,@kramasamy sure I can add some comments,773941269,2017-09-02 13:17:18
28320167,2183863,137137370,105,Have a try-catch-finally block and put `con.disconnect()` in finally,776407546,2017-09-06 06:10:09
28320167,2183863,137141798,21,"This implementation here is really ugly and bad.
One alternative is to use constant enum;
another alternative is to use a boolean to decide which one to use since you have only two cases and it will fail otherwise.
Polymorphism can be another one.
",776407546,2017-09-06 06:43:53
28320167,2183863,137137016,70,"Need we throw an exception if we could not initialize `stateMgr` and `stateMgrAdaptor`? Otherwise, the `AuroraHeronShellController` is in a wrong state.",776407546,2017-09-06 06:07:44
28320167,2183863,137141881,4,"given you have only 2 options, you can consider this is a boolean. You could evolve from it in future if needed, but I seriously doubt that.",776407546,2017-09-06 06:44:36
28320167,2183863,137137167,96,call the variable `host` or `hostname`. `ip` is confusing here.,776407546,2017-09-06 06:08:50
28320167,32022953,137151196,70,"Eventually any exception has to be caught before AuroraScheduler.initialize(). If the exception is not caught here, where shall we catch them?",776407546,2017-09-06 08:07:21
28320167,32022953,137151244,96,done,776407546,2017-09-06 08:07:47
28320167,32022953,137152663,21,changed to boolean,776407546,2017-09-06 08:22:31
28320167,32022953,137152672,4,changed to boolean,776407546,2017-09-06 08:22:38
28320167,32022953,137152849,105,done,776407546,2017-09-06 08:24:07
28320167,2183863,137153019,70,"Bubble up a RuntimeException to external logic. Otherwise, the program will execute with a bad state but it is no way to execute with a bad state.",776407546,2017-09-06 08:25:42
28320167,32022953,137153794,70,done: throw to external logic,776407546,2017-09-06 08:33:38
28331868,3201045,137193850,1,Similarly the class as well.,776653981,2017-09-06 14:47:39
28331868,3201045,137193767,1,you should rename the file 'RemapCustomGrouping.java'?,776653981,2017-09-06 14:47:17
28331868,3201045,137194203,1,please rename it to RemapStreamlet.java and also the class.,776653981,2017-09-06 14:48:49
28331868,7235147,137324038,34,why StreamletImpl and not just Streamlet?,776653981,2017-09-06 23:43:54
28331868,7235147,137322047,63,maybe BaseStreamlet?,776653981,2017-09-06 23:36:20
28331868,7235147,137323363,25,"Should this be immutable? Also maybe add a static create(K key, V value) method for connivence? ",776653981,2017-09-06 23:41:24
28331868,7235147,137322814,291,is there a better name? java methods usually don't have underscores. Maybe doBuild()? Make this protected too since it should never be called externally?,776653981,2017-09-06 23:39:09
28331868,7235147,137325979,45,Can this and all the ones below be KVStreamlets?,776653981,2017-09-06 23:51:21
28331868,1575030,137332237,54,"can we use the Class Count for the parameter instead of an int?
",776653981,2017-09-07 00:14:19
28331868,1575030,137337261,54,"Can we also have a windowing operator e.g.

source
.window(TumblingWindows.of(Duration.seconds(2)))
.flatMap(s -> Arrays.asList(s.split("" "")))",776653981,2017-09-07 00:33:59
28331868,1575030,137332680,60,"can we change this line to something like:

.reduceByKeyAndWindow(TumblingWindow.of(Count.of(10)), (x, y) -> x + y)",776653981,2017-09-07 00:16:05
28331868,1575030,137360973,57,"Can we reduce 

Streamlet<String> source = Streamlet.createStreamlet(() -> ""Mary had a little lamb"");
builder.addSource(source);

to something like:

Streamlet<String> source = builder.newStreamlet(() -> ""Mary had a little lamb"")

so we can just:",776653981,2017-09-07 02:01:33
28331868,10216235,137981431,1,Done,776653981,2017-09-11 12:15:43
28331868,10216235,137981492,63,Which one are you referring to? Streamlet or StreamletImpl?,776653981,2017-09-11 12:16:42
28331868,10216235,137983707,291,done,776653981,2017-09-11 12:43:32
28331868,10216235,137983718,25,Done,776653981,2017-09-11 12:43:37
28331868,10216235,137983760,34,Because BuilderImpl needs access to doBuild which is only in StreamletImpl,776653981,2017-09-11 12:44:09
28331868,10216235,137983928,45,JoinStreamlet for example requires KVStreamletImpl rather than KVStreamlet. Thats the reason for using. Do you see any issue?,776653981,2017-09-11 12:46:08
28331868,10216235,137984028,54,"As discussed, Count might be overkill for now. So leaving it as it is for now.",776653981,2017-09-11 12:47:15
28331868,10216235,137984094,54,Could you illustrate what the window function would do?,776653981,2017-09-11 12:48:00
28331868,10216235,137985099,57,Done,776653981,2017-09-11 12:58:14
28331868,10216235,138231439,34,"Renamed StreamletImpl to BaseStreamlet.
Did same for KV",776653981,2017-09-12 08:14:31
28331868,73683,138455551,24,Could this be just `KeyedWindow`?,781094454,2017-09-13 03:23:34
28331868,73683,138455398,56,"Would Java's lambda syntactic sugar allow this to instead be written as:
```
.mapToKV((word) -> (word, 1))
```",781094454,2017-09-13 03:22:51
28331868,73683,138452314,63,typo: gerts,781094454,2017-09-13 03:08:58
28331868,73683,138452213,25,Could this be just `Window`?,781094454,2017-09-13 03:08:27
28331868,73683,138452903,110,Best to include the unknown join type in the message.,781094454,2017-09-13 03:11:44
28331868,10216235,138463650,25,Done,781094454,2017-09-13 03:57:00
28331868,10216235,138463680,110,Added,781094454,2017-09-13 03:57:07
28331868,10216235,138463665,63,Fixed,781094454,2017-09-13 03:57:04
28331868,10216235,138463694,24,Changed,781094454,2017-09-13 03:57:10
28331868,10216235,138475278,56,"Not clear how. I tried some variations. Will keep you posted, but if you have any ideas that would be great",781094454,2017-09-13 04:48:01
28331868,1575030,138754615,54,"How will a user implement a custom source?  The current builder.newStreamlet on allows a supplier function to be passed in, but what if the user wants more functionality such as use the ""open"" function to initialize some parameters?",781867402,2017-09-14 05:18:41
28331868,1575030,138755111,55,"Similar comment for operators?  Users might won't to use a ""prepare"" method to initialize things only once in the beginining",781867402,2017-09-14 05:21:27
28331868,11442576,138770385,25,misplaced comments,781867402,2017-09-14 07:08:35
28331868,11442576,138767759,27,mis-placed comments,781867402,2017-09-14 06:47:43
28331868,11442576,138762030,153,`sinkTo` should be easier to understand,781867402,2017-09-14 06:05:27
28331868,11442576,138771107,73,This `ReduceByWindowOperator` only supports time based window. How about other types of window?,781867402,2017-09-14 07:14:35
28331868,11442576,138759192,44,There are two types of SlidingWidnow: time based and size based. How about using different names for each to make it clear.,781867402,2017-09-14 05:46:32
28331868,11442576,138763229,25,"This is a timestamp based window. Do we also need to support other kind of windows? If not, can we rename it properly?",781867402,2017-09-14 06:14:19
28331868,11442576,138766216,82,we should also check if sName is empty.,781867402,2017-09-14 06:35:22
28331868,11442576,138769757,37,this method occurs at multiple places and the logic is same. Can we move it to `BaseStreamlet`?,781867402,2017-09-14 07:03:52
28331868,11442576,138759613,123,curious about the use case of this `clone` method?,781867402,2017-09-14 05:49:20
28331868,11442576,138769219,52,throw exception or log some error message here to indicate the error,781867402,2017-09-14 06:59:07
28331868,10216235,138981708,55,Check out the transform method,781867402,2017-09-15 01:54:52
28331868,10216235,138982922,54,"The main interface is the newSource(renamed from newStreamlet) that supplies an already created streamlet. How to write source streamlet, is probably another set of documentation/pr",781867402,2017-09-15 02:00:13
28331868,10216235,138983518,44,Fixed,781867402,2017-09-15 02:03:08
28331868,10216235,138983991,153,renamed to toSink,781867402,2017-09-15 02:05:25
28331868,10216235,138985324,25,fixed by adding count,781867402,2017-09-15 02:11:29
28331868,10216235,138985763,82,added check,781867402,2017-09-15 02:13:28
28331868,10216235,138986088,27,fixed,781867402,2017-09-15 02:14:58
28331868,10216235,138986607,52,This is not an error. Added comments.,781867402,2017-09-15 02:17:44
28331868,10216235,138986909,73,It supports both size/time based operations. We now pass both the time and count information,781867402,2017-09-15 02:19:18
28331868,10216235,138986801,25,fixed,781867402,2017-09-15 02:18:47
28331868,10216235,138989975,37,refactored,781867402,2017-09-15 02:32:22
28331868,2183863,139337244,46,Use `switch - case - default` instead of `if - else if - else if - else`?,783575249,2017-09-18 11:57:44
28331868,2183863,139337506,93,abstract this into another private method?,783575249,2017-09-18 12:02:01
28331868,2183863,139336408,30,Need it be public?,783575249,2017-09-18 11:39:38
28331868,2183863,139336060,32,java style is `getTaskId()`. Similar to other methods in this interface.,783575249,2017-09-18 11:32:50
28331868,2183863,139337823,42,Also Log `No name found for xxx. Use the default name xxx instead` for easy tracing.,783575249,2017-09-18 12:08:16
28331868,2183863,139337646,46,Do we need to `ack`?,783575249,2017-09-18 12:04:36
28331868,2183863,139337418,47,"Good to specify a constant field externally in a Constant class, rather than use a String constant directly; easy to trace and understand.",783575249,2017-09-18 12:00:24
28331868,2183863,139337653,48,Same as above.,783575249,2017-09-18 12:04:45
28331868,2183863,139337434,36,Same as above,783575249,2017-09-18 12:00:39
28331868,2183863,139337630,49,Do we need to `ack`?,783575249,2017-09-18 12:04:22
28331868,2183863,139338030,42,Can we move the String `consumer` to a Constant class? Same to below.,783575249,2017-09-18 12:13:08
28331868,2183863,139337932,41,Same as above.,783575249,2017-09-18 12:10:45
28331868,2183863,139337925,39,"It seems the method `doBuild()`s in `ConsumerStreamlet`, `FilterStreamlet` and other `xxxStreamlet`s have a lot of duplicates. Can we try to abstract them out to reduce duplications?",783575249,2017-09-18 12:10:34
28331868,2183863,139337039,25,"Do we also need to consider other types of window, for instance, SessionWindows?",781867402,2017-09-18 11:53:37
28331868,2183863,139337209,27,Same as above. Do we need to consider other types too?,783575249,2017-09-18 11:57:03
28331868,1575030,139487322,29,don't think these comments are relevant anymore,783575249,2017-09-19 00:27:08
28331868,10216235,139488036,25,Deliberately kept it simple for now. We can add SessionWindows later,781867402,2017-09-19 00:29:56
28331868,10216235,139488313,27,Want to keep the first cut simple by adding simple types first. We can add SessionWindows later,783575249,2017-09-19 00:31:06
28331868,1575030,139489294,55,"""word"" should probably be renamed to ""sentence""",786479797,2017-09-19 00:35:05
28331868,10216235,139489725,29,Fixed,783575249,2017-09-19 00:37:02
28331868,10216235,139490050,55,fixed,786479797,2017-09-19 00:38:18
28331868,3201045,139517438,1,BiFunction - should be Bifunction ?,786563210,2017-09-19 02:29:40
28331868,10216235,139520556,1,I'm just following java.util.function terminology as defined in https://docs.oracle.com/javase/8/docs/api/java/util/function/BiFunction.html,786563210,2017-09-19 02:43:32
28331868,7235147,139526451,33,Does it make sense for the Builder interface to have a build() method on it so we don't have to cast here?,786563210,2017-09-19 03:09:13
28331868,3201045,139526650,33,+1,786563210,2017-09-19 03:09:48
28331868,10216235,139536815,33,I avoided that because that would expose the TopologyBuilder stuff which is really an implementation detail,786563210,2017-09-19 03:51:03
28373228,10216235,137451417,18,why not make it a an actual instance of register request rather than a pointer? That way the cleaning logic is greatly simplified,777450037,2017-09-07 12:54:58
28373228,11442576,137680367,18,Good suggestion. The original reason I want to use pointer here is I can do safety check before sending out the request. Now I updated the code: 1. use an instance instead of pointer; 2. introduce a boolean value indicating if the request is initialized p,777450037,2017-09-08 06:33:17
28373228,10216235,139510072,52,"I belive we could do a simplification here.
Can we rename SetStmgrRegisterRequest to SetInstanceInfo, where the tmaster client copies the instances into local variable. And then during send register, just copies them back into the register request and se",778183003,2017-09-19 01:57:01
28373228,11442576,139511676,52,"The proposed solution is a cleaner way to do the thing. But why is it a simplification? There're two sets of copy operations instead of one. Plus, it requires the management of some objects in the memory.",778183003,2017-09-19 02:04:00
28447750,11442576,137903535,13,is this `print` expected behavior?,778964748,2017-09-09 05:37:24
28447750,7235147,137907041,13,no left over from debugging. will remove,778964748,2017-09-09 06:10:20
28472256,7235147,137938421,9,should this be removed too cp $SCRIPT_FILE $SCRIPT_OUT_FILE?,779582328,2017-09-10 08:05:51
28499716,32022953,138175998,39,"do we keep the simulator in the heron example?
same comment to the other LocalCluster example",780282901,2017-09-12 03:03:47
28499716,1575030,138187824,39,"Do we really need a simulator in Heron?  A LocalCluster or simulator is useful in Storm because running a single topology requires you start up a cluster on a single node (Nimbus, zookeeper, Supervisor, etc.) which can be a lot of work.  This is not the c",780282901,2017-09-12 03:51:08
28499716,32022953,138196372,39,"as far as i know, the heron-simulator runs all heron-components in single process for topology writers to easily debug, which is different from multi-process local mode.",780282901,2017-09-12 04:26:27
28499716,1575030,138197170,39,"gotcha, but is it easier to debug if everything just threads in a single process? A jstack might be confusing as there are many threads executing at the same time.  People often say it was hard to debug storm workers because there are many instances/threa",780282901,2017-09-12 04:30:04
28499716,1575030,138200004,39,but perhaps this discussion about the usefulness of the simulator is not in the scope of this pull request.  I can just add back the code for the simulator and we can discuss the usefulness of having a simulator in heron somewhere else,780282901,2017-09-12 04:43:32
28614401,10216235,138732476,6,can heronpy dep come first before the common?,782683488,2017-09-14 03:38:05
28614401,10216235,138732507,4,pl remove,782683488,2017-09-14 03:38:14
28614401,1575030,138742770,6,sure,782683488,2017-09-14 04:20:14
28614401,1575030,138742934,4,I intentionally left this comment in here so it is easier to debug the integration tests.  Tuples received is already printed but tuples emitted was missing,782683488,2017-09-14 04:21:01
28714821,2508294,139280044,22,is it `local_data_port`?,784699357,2017-09-16 13:42:10
28714821,10216235,139280119,22,"in the executor, the ports are called master_port and tmaster_controller_port. They are labelled that way for both the tmaster container, as well as the regular container.
What we are doing is that using the tmaster_controller_port to be the local data p",784699357,2017-09-16 13:48:08
28714821,11442576,139338527,6,stmgr_port and instance_port should be better. There are both data and control infos passed to and from these two ports.,784699357,2017-09-18 12:24:23
28714821,10216235,139479489,6,I prefer not to change any 'names' in this pr because that will pollute this pr. I will send out a follow up pr to fix the names,784699357,2017-09-18 23:57:26
28714821,11442576,139496724,6,???? ,784699357,2017-09-19 01:04:52
28760104,2508294,139490067,1,what is this patch file for?,785918123,2017-09-19 00:38:24
28760104,3201045,139594188,1,this patch is to ensure we use a fast path for C++11x so that performance is not affected. The patch was originally done by @congwang - just redid it for protobuf 3.4.0,785918123,2017-09-19 11:15:59
28801426,13159450,139588365,8,"""Found exception when initializing state managers""",786829070,2017-09-19 10:08:43
28803932,10216235,139595661,68,"1. We need to Clean instances_ if it already exists
2. for (auto iter = _instances.begin(); iter != _instances.end(); ++iter) {
    auto instance = new proto::system::Instance();
    instance->CopyFrom(*iter);
    instances_.push_back(instance)
   }",786885900,2017-09-19 11:34:29
28803932,10216235,139595788,29,Please rebase with master,786885900,2017-09-19 11:36:14
28803932,11442576,139596947,29,rebased.,786885900,2017-09-19 11:51:20
28832238,32022953,139804124,15,"`and need strong ` .. 
this sentence seems not complete.",787470050,2017-09-20 03:08:53
28832238,32022953,139804781,60,"`An example of a non-idempotent` ..
this sentence is not complete",787470050,2017-09-20 03:11:41
28832238,32022953,139804650,57,"if topology is idempotent, at-least once can achieve the same result ? no need to enable `effectively once`?",787470050,2017-09-20 03:11:14
28832238,64790,139805182,15,"Sorry, forgot to add that the PR is a work in progress",787470050,2017-09-20 03:13:33
28832238,10216235,139840160,57,"I would reword this as
they need to ensure that any state changes caused by execution of the tuple is captured in the heron state variable thats passed at startup time. This way Heron can keep track of state of the processing logic and rewind state when ",787470050,2017-09-20 06:05:17
28832238,64790,140839839,57,"@huijunw As far as I know, idempotency and effectively once correspond to different concerns. A topology can be idempotent and process tuples more than once, which is a problem if you have effectively once requirements.",787470050,2017-09-26 00:17:05
28840123,3201045,139889988,42,view cluster configuration or properties?,787751140,2017-09-20 14:06:54
28840123,3201045,139889826,26,Help should be appropriate?,787751140,2017-09-20 14:06:07
28928229,10216235,140377353,24,Leftover debugging changes?,789344425,2017-09-22 05:45:06
28928229,2183863,140611151,74,Do we need a `LOG.info(..)` here?,789449539,2017-09-23 05:47:31
28928229,2183863,140611098,8,Do we need the `LOG.info(...)` here? ,789449539,2017-09-23 05:46:54
28928229,2183863,140610495,15,It is good to have a method to convert `config.get(Config.TOPOLOGY_RELIABILITY_MODE)` to enum and then compare two enum values. Comparing two Strings is error prone.,789449539,2017-09-23 05:41:10
28928229,2183863,140611196,7,Do we need a `LOG.info(..)` here?,789449539,2017-09-23 05:47:56
28928229,11442576,140613651,8,removed this log,789449539,2017-09-23 06:12:21
28928229,11442576,140614356,15,good suggestion. Fixed.,789449539,2017-09-23 06:19:46
28928229,11442576,140613798,74,"This log message is indicating the instance is doing checkpoint, we should keep it. But I moved this `LOG.info()` into `persistState` method for better organization",789449539,2017-09-23 06:14:00
28928229,11442576,140613592,7,removed this log,789449539,2017-09-23 06:11:41
28928229,11442576,140379478,24,sure,789344425,2017-09-22 06:01:08
29084205,10216235,141146521,5,This should be 0.16.0,792586826,2017-09-27 01:38:57
29084205,10216235,141146802,56,this is not supported in dsl. Might be removed from python dsl as well,792586826,2017-09-27 01:40:01
29084205,10216235,141147003,77,createSupplierStreamlets are now not public. Please use Builder.newSource,792586826,2017-09-27 01:40:47
29084205,64790,141152758,5,Please note that this is a work in progress,792586826,2017-09-27 02:01:49
29084205,10216235,141172521,169,Can we talk about how Resources can be specified?,792586826,2017-09-27 03:22:22
29084205,64790,141172863,169,"Again, this is a work in progress. I'll ping you as soon as it's in reviewable shape.",792586826,2017-09-27 03:23:32
29084205,10216235,141449765,5,0.16.0,794297834,2017-09-28 02:51:48
29084205,10216235,141450084,119,Can we include Type safety ,794297834,2017-09-28 02:53:08
29084205,64790,141450073,5,Got it,794297834,2017-09-28 02:53:05
29084205,64790,141450118,119,Yep,794297834,2017-09-28 02:53:16
29084205,32022953,141151262,40,what is difference between DSL streamlet and existing data model stream?,792586826,2017-09-27 01:55:53
29155767,11442576,141646257,8,log also needs to handle timer event,794607385,2017-09-28 22:08:48
29155767,11442576,141648977,49,why the `reset()` doesn't triggerTask here?,794607385,2017-09-28 22:17:59
29155767,11442576,141651270,34,"Instead of updating the config here within a bolt, can we push this task to topology creation time and provide some default value if user doesn't set it? In this way, you don't need to change the `BoltInstance` code and pass around the conf object",794607385,2017-09-28 22:25:50
29155767,1575030,141657322,34,"@nlu90 not all types of windows need the timer.  Only processing time based windows that use the TimerTriggerPolicy need a timer thus tick tuples other window types do not need it.   
 Its not eloquent to determine what kind of window it is on the client",794607385,2017-09-28 22:46:55
29155767,1575030,141657881,49,The point of reset is to clear some internal state of the trigger.  Please look at the CountTriggerPolicy.  The TimeTriggerPolicy does not have any internally held state to clear since its just a timer,794607385,2017-09-28 22:48:55
29155767,1575030,141658316,8,+1 thanks for pointing that out,794607385,2017-09-28 22:50:32
29155767,10216235,141737174,23,can we name them explicitly. like setTickTupleFreqencySec and Msec,795039552,2017-09-29 04:09:49
29155767,1575030,141752937,23,but that might break backwards compatibility right?,795039552,2017-09-29 05:37:58
29155767,10216235,141753121,23,Ok. How about the new api then. Make it explicitly say Ms?,795039552,2017-09-29 05:39:12
29202200,10216235,141785059,5,Just __execute-time-ns should do the trick. Since the stream name could be different,795419979,2017-09-29 10:43:38
29202200,7235147,141869314,5,"I tried without the default on some of the examples and seems to not work. It seems like the default is needed.

msa/exclaim1/container_1_exclaim1_3:
{__execute-time-ns/word/default=4.36168882E8, __fail-count/word/default=0.0, __execute-latency/default",795419979,2017-09-29 20:35:39
29307671,13159450,142514528,22,`result symptom:`,798089743,2017-10-04 03:33:06
29307671,32022953,142517669,22,done,798089743,2017-10-04 03:45:07
29307671,6377806,142524996,14,This log message does not look very helpful. Either remove it or augment with wait q sizes and back pressure metrics.,799076732,2017-10-04 04:13:11
29307671,6377806,142524416,6,These logs seem noisy? Diagnosers will be invoked periodically/frequently and I am not sure how these logs will help the user debug an issue. ,799076732,2017-10-04 04:10:28
29307671,6377806,142525199,22,Seems noisy and not very helpful during normal execution or when the problem is in other components. ,799076732,2017-10-04 04:14:07
29307671,32022953,142528469,6,"what we observed is the topology is in backpressure state, but the detector failed to catch
```
[2017-10-03 21:00:26 +0000] [WARNING] com.twitter.heron.healthmgr.policy.AutoRestartBackpressureContainerPolicy: Unknown diagnoses. None resolver selected. ",799076732,2017-10-04 04:27:44
29307671,32022953,142531428,14,updated log message,799076732,2017-10-04 04:40:50
29307671,32022953,142531621,22,we found this function returned null. i think this log may help to find out why the detector failed to catch the abnormals.,799076732,2017-10-04 04:41:47
29307671,11442576,142543307,57,is this `println` for debugging purpose？,799118124,2017-10-04 05:43:19
29307671,32022953,142545453,57,"this is a tool.
it echo prints user input params.",799118124,2017-10-04 05:56:56
29326924,32022953,142240569,4,who will use these files `conf-sandbox-yaml`,798107044,2017-10-03 03:05:19
29326924,3201045,142294249,4,@huijunw - this is for docker sandbox image.,798107044,2017-10-03 08:16:59
29326924,32022953,142296366,4,thanks @kramasamy ,798107044,2017-10-03 08:38:29
29334902,11442576,142546724,19,"this method no longer sets up directory, should rename it peoperly",798259234,2017-10-04 06:04:42
29334902,11442576,142547856,52,"code on line 123 to line 148 is doing the actual setup work. Can we move them into the `SchedulerUtils. setupWorkingDirectory`? 

If there's a reason we couldn't put them there, we can create a local method here to make the code here clear.",798259234,2017-10-04 06:11:48
29334902,11442576,142546538,4,will this symbolic file deletion work with directories?,798259234,2017-10-04 06:03:28
29334902,7235147,142757239,4,This will only delete the symlink and not any of the potential files/directories under it.,798259234,2017-10-05 01:38:55
29334902,7235147,142757435,19,I will rename it to something better.,798259234,2017-10-05 01:39:35
29334902,7235147,142758620,52,I wanted to separate the create/clean directory and the tar.gz file extraction. This decouples things for when a scheduler would like to use an installed version of the code. The extraction of the core.tar.gz is not needed but you had to pass those values,798259234,2017-10-05 01:43:50
29338659,11442576,142548260,30,"Instead of using `instanceof`, we should catch the `ConnectException` directly and handle it separately. Something like:
```
try {
...
} catch (ConnectException) {
...
} catch (IOException) {
...
}
```
",798909868,2017-10-04 06:14:15
29497067,2508294,143108629,6,"indent could be improved for better reading, or put ')' in a new line.",801073361,2017-10-06 11:42:18
29497067,10216235,143109152,6,done,801073361,2017-10-06 11:49:59
29539441,10216235,144417424,76,You could move this line to preSave. That way the topoliogy can be used both in effectively once as well as atleast/atmost once mode,804060782,2017-10-13 04:41:33
29539441,1575030,144417734,76,+1,804060782,2017-10-13 04:42:52
29539441,10216235,144419046,39,Why have this method (and the execute method below)? ,804060782,2017-10-13 04:49:15
29539441,10216235,144427110,13,Is this a breaking change? @maosongfu?,804060782,2017-10-13 05:35:17
29539441,1575030,144624032,39,you are rights it redundant. I can remove,804060782,2017-10-14 01:17:26
29539441,2183863,145036866,13,it does not break current code. But I am wondering why we need this change?,804060782,2017-10-17 13:31:25
29539441,2183863,145039270,29,"Will users mistakenly use the same key for their own states leading to a conflict? Same for below.

Also, should we have another separate `xxxState` class wrapping up these fields, and provide `restore(..)` and `getState(...)`?",808072090,2017-10-17 13:48:38
29539441,2183863,145039040,63,Same as above.,808072090,2017-10-17 13:46:51
29539441,2183863,145038032,40,"I would argue let `IWindowedBolt extends IBolt`, then 
- we no longer need `setBolt(..., IStatefulWindowBolt, ...)` method.
- it follows the convention we used for low-level heron stateful API as: https://github.com/twitter/heron/blob/master/examples/sr",808072090,2017-10-17 13:40:30
29539441,1575030,145500491,13,"@maosongfu The change is need because we need a way to store buffered tuples in windows that haven't been triggered yet.  So that when a checkpoint a happens, the state of all untriggered windows, which is essentially just buffered tuples, will be persist",804060782,2017-10-19 01:23:17
29539441,1575030,145502419,29,@maosongfu the hashmap state is partitioned into USER_STATE and WINDOWING_INTERNAL_STATE and the user will only get state.get(USER_STATE). Thus even if the user uses the same key it won't matter since its part of a different namespace as you might think o,808072090,2017-10-19 01:30:06
29539441,1575030,145503202,29,We could have another class e.g. WindowState that contain these objects but what are the benefits of that?  It just seems like a wrapper class that will only be used in the WindowManager,808072090,2017-10-19 01:32:48
29539441,1575030,145506220,40,IWindowedBolt cannot extend IBolt since the execute API for IBolt is execute(Tuple tuple) but for windowed bolts in needs to be execute(TupleWindow window),808072090,2017-10-19 01:43:52
29661101,10216235,143877508,5,"Would we rather have SerializableFunction<? super R, ? extends Iterable<? extends T>> flatMapFn
",804607236,2017-10-11 06:15:45
29661101,1575030,143881888,5,What does that really buy us though?,804607236,2017-10-11 06:50:18
29661101,1575030,143882773,5,Ya we can change it to that,804607236,2017-10-11 06:57:36
29671721,7235147,144747664,10,"There is a Google Storage uploader too, should we add doc on the website for that?",806382105,2017-10-16 10:13:36
29723877,10216235,144146263,23,This is not true. @jerrypeng can you add some more color here?,805304984,2017-10-12 04:51:19
29724796,3201045,144166255,4,the same as before,805398885,2017-10-12 06:58:31
29724796,3201045,144166106,5,There is no notion of worker child process in heron - can you rephrase it?,805398885,2017-10-12 06:57:23
29724796,1575030,144191873,4,Lets keep this same as it is for Storm,805398885,2017-10-12 11:27:52
29724796,1575030,144191879,5,will fix,805398885,2017-10-12 11:27:57
29728863,11442576,144178743,11,"Is the ‘toSink’ method general enough that needed by every streamlet?

Is this new method here for stateful processing?",805400175,2017-10-12 08:56:13
29728863,11442576,144178483,26,Comment needs to be updated,805400175,2017-10-12 08:53:37
29728863,10216235,144185657,26,updated,805400175,2017-10-12 10:10:39
29728863,10216235,144185766,11,The toSink is just for abstracting out complex sinks(aka terminator bolts) that might need a setup/cleanup.Not really related to stateful processing.,805400175,2017-10-12 10:11:59
29763205,10216235,145239838,1,Whats this new file?,811328987,2017-10-18 03:04:01
29763205,10216235,145240242,1,same as above comment,811328987,2017-10-18 03:05:30
29763205,64790,145243711,1,Both of these files (along with two others) seem to be results of errant merges.,811328987,2017-10-18 03:19:15
29763205,10216235,145248722,8,Need to include JoinOperatortest?,811343031,2017-10-18 03:37:24
29763205,10216235,145248954,5,why streamletapi? why not just streamlet?,811343031,2017-10-18 03:38:18
29763205,64790,145249547,8,Done,811343031,2017-10-18 03:40:15
29763205,64790,145249608,5,Works for me either way. I'll shorten it to just streamlet.,811343031,2017-10-18 03:40:28
29930094,7235147,145250104,55,let's update the image to be heron/heron:<version> or heron/heron:latest,810465186,2017-10-18 03:42:26
29930094,7235147,145250122,80,Let's update this to a heron image heron/heron:latest,810465186,2017-10-18 03:42:30
29930094,7235147,145250620,20,"should we add or Minikube here?
A Kubernetes cluster with at least 3 nodes or Minikube",810465186,2017-10-18 03:44:25
29930094,64790,145250661,80,This is just a WIP for now. I'll ping you when it's ready for review.,810465186,2017-10-18 03:44:33
29988045,3201045,145319066,125,it should be OnReconnectTimer() - Reconnect is one word.,811596261,2017-10-18 12:30:25
29988045,3201045,145319112,55,Should be ReconnectTimer?,811596261,2017-10-18 12:30:53
29988045,10216235,145514718,125,fixed,811596261,2017-10-19 02:16:57
29988045,10216235,145514728,55,fixed,811596261,2017-10-19 02:17:00
30031471,7235147,146361006,26,We should remove this because the prometheus sink will always flatten the metrics.,812401947,2017-10-24 01:56:09
30031471,64790,146373555,26,Got it,812401947,2017-10-24 02:46:18
30081800,10216235,145834053,5,Can you add one for cpp as well?,813316803,2017-10-20 04:52:58
30122245,10216235,146106431,4,"If we are introducing this dep, we need to add a shading rule for this.",814483299,2017-10-21 21:13:13
30122245,1575030,146110835,4,I have added a rule to shade this dep,814483299,2017-10-22 00:34:46
30188672,3201045,146147072,1,can you rename the file to bookkeeper-apiserver.yaml? just to make it easy.,815585935,2017-10-23 05:47:36
30189247,3201045,146147140,41,It should Apache before BookKeeper,815598109,2017-10-23 05:49:20
30189247,3201045,146147194,114,please change it to bookkeeper-apiserver.yaml - so that it is easy to remember,815598109,2017-10-23 05:51:11
30227202,10216235,146344541,25,This should be INFO,816373989,2017-10-24 00:54:59
30241118,10216235,146755851,4,why are we adding this dep?,816714249,2017-10-25 12:05:50
30241118,1575030,146925707,4,com.twitter.heron.common.basics.ByteAmount is from there,816714249,2017-10-26 00:15:00
30243013,3200023,149592341,13,"Why 9? Suggest to make a const for it with a name.

Also I am wondering if it could be useful to have an else {} block with a log?",825162842,2017-11-08 15:34:54
30243013,1575030,149593476,13,"This is because ports are pass in as positional arguments.  There are 9 ports prior to the debugging ports which could be more than one port.  

This PR should address the positional arguments issue:

https://github.com/twitter/heron/pull/2516",825162842,2017-11-08 15:43:20
30243013,3200023,149603727,13,"I see. Feels a little scary for future maintenance, especially for adding or removing ports. I looked at the other PR briefly but don't have good idea about the typical use cases yet. A few questions I am wondering so far:

- is this map necessary? can ",825162842,2017-11-08 16:42:33
30243013,1575030,149606342,13,"@nwangtw 
Your first question:

The reason why we pass multiple debugger ports is because the heron_executor.py can potentially starts up multiple heron instances based on the physical plan thus we need multiple debugger port assignments to be passed t",825162842,2017-11-08 16:54:23
30243013,32022953,150155030,14,do we need to add one more param in config/heron.aurora,825162842,2017-11-10 13:06:55
30243013,32022953,150155248,36,"once heron-instance listens to this port, what requests will it accept?",825162842,2017-11-10 13:09:04
30243013,1575030,150395631,36,a user can attach a remote debugger to the port,825162842,2017-11-12 06:59:53
30243013,1575030,150395647,14,currently remote debugging is implemented for localscheduler and kubernetes scheduler.  ,825162842,2017-11-12 07:00:40
30243013,3200023,151207686,54,"Please add the port info in the logging message below if it is not there yet:

LOG.info(""\nStarting instance "" + instanceId + "" for topology "" + topologyName
         + "" and topologyId "" + topologyId + "" for component "" + componentName		         + "" a",837147284,2017-11-16 02:10:21
30243013,10216235,151232783,4,Can you add a little more color to what this port is? ,837147284,2017-11-16 03:47:01
30243013,1575030,151234174,54,I have added this,837147284,2017-11-16 03:52:32
30284171,10216235,146667269,33,this is not necessary,817520539,2017-10-25 02:26:40
30284171,10216235,146667428,39,We technically need to create a new message id for every new message. Maybe some explanation about that and why we are doing the way we are doing in this example,817520539,2017-10-25 02:27:25
30284171,10216235,146680300,38,"Can you add the following line as well
Technically each new message that we emit should be annottated with a unique message id. This will allow the spout to keep track of which messages should be acked back to the producer/retried when appropriate ack/fa",817578924,2017-10-25 03:19:32
30447591,32022953,147521469,5,there is `conf-aurora-yaml` why not use that,820599351,2017-10-28 04:34:34
30447591,3201045,147561657,5,@huijunw - this target ```conf-yaml``` includes every yaml file and also every aurora file.,820599351,2017-10-29 01:57:20
30551447,10216235,148676424,79,Does Files.write do an open/write/close? Isnt that inefficient to do it per element,825798259,2017-11-03 05:25:10
30551447,10216235,148676955,1,I believe a better example is a Copy example where in you read from one File Source and copy it to another File Sink,825798259,2017-11-03 05:28:14
30551447,64790,148677123,79,"It probably is less efficient than a lot of other alternatives, but it's only happening every half second and I like that it's just a one liner, which keeps the code clean",825798259,2017-11-03 05:28:55
30551447,64790,148677486,1,"We could do that, but there is a separate example topology that covers sources. Up to you.",825798259,2017-11-03 05:31:16
30551447,10216235,149449985,1,"It's ok for now. When we will have say a twitter connector handy, we could think of converting this example to reading twitter and writing to a file",825798259,2017-11-08 01:47:37
30551447,64790,149450380,1,Agreed. That would be very cool. We can iterate on these a lot in the coming weeks.,825798259,2017-11-08 01:49:03
30551447,10216235,149450787,168,Do you want to instead join on the adid/userid combo?,829529282,2017-11-08 01:50:36
30551447,10216235,149450997,171,this reduce will not needed once you change the key in the join,829529282,2017-11-08 01:51:15
30551447,10216235,149451373,52,"We need a better example for repartition.
",829529282,2017-11-08 01:52:40
30551447,64790,149451542,171,"Okay, yeah, I see the issue now. Will change up the processing logic accordingly.",829529282,2017-11-08 01:53:20
30551447,10216235,149451752,103,might be better to pipe this to the log operator,829529282,2017-11-08 01:54:08
30551447,64790,149451804,52,It is a bit hackneyed. Feel free to suggest other ideas. I’m really not sure how people will use this in the wild.,829529282,2017-11-08 01:54:17
30551447,64790,149452126,103,It’s eventually logged in the consume operator. In this case I’m using it mostly for debugging so it can be removed.,829529282,2017-11-08 01:55:33
30554539,1575030,147842134,18,Can you update the java doc to reflect the change in method signature?,822931237,2017-10-31 04:37:08
30554539,1575030,147842170,10,Can you update the java doc to reflect the change in method signature?,822931237,2017-10-31 04:37:19
30554539,64790,147841956,13,I'd suggest that we brainstorm some alternative names for `identity`. Maybe `initialValue` or something like that?,822931237,2017-10-31 04:36:15
30554539,1575030,147866378,34,"shouldn't a null check be conducted here? if identity is null, it should be set to to the first tuple or something",823079792,2017-10-31 06:56:52
30554539,1575030,147866423,83,"shouldn't a null check be conducted here? if identity is null, it should be set to to the first tuple or something",823079792,2017-10-31 06:57:10
30671301,7235147,148576505,7,spelling mistake? should just be .js right?,825511107,2017-11-02 22:54:44
30717054,6377806,148702704,22,Why is `Object` used here instead of `Integer`?,826028106,2017-11-03 09:39:01
30717054,6377806,148702554,42,"Instead of overloading `toString`, I think it would be better to add a `getter` method",826028106,2017-11-03 09:36:41
30717054,6377806,148702507,56,Is this method duplicating the responsibility of `getPortNames()`,826028106,2017-11-03 09:36:01
30717054,6377806,148703323,107,The method name and the return type do not match. Moreover could you please explain the use of this method.,826028106,2017-11-03 09:48:38
30717054,6377806,148703133,89,Any negative value is invalid,826028106,2017-11-03 09:45:21
30717054,6377806,148703049,81,Should we check for extra ports provided? i.e. `portsToUse == requiredPorts`,826028106,2017-11-03 09:44:09
30717054,6377806,148703257,22,I am also unsure what is the significance of extending a `HashMap` here. Seems unnecessary here.,826028106,2017-11-03 09:47:31
30717054,6377806,148702955,74,I am not sure if I understand the need of a static method and a non-static method for the same function?,826028106,2017-11-03 09:42:44
30717054,6377806,148703098,87,iterator or lambda would be better here,826028106,2017-11-03 09:44:50
30717054,1575030,148714329,22,"This is done to be generic so that some options in the future like ports for remote debugging of the jvm can be a list of integers as well:

https://github.com/twitter/heron/pull/2484",826028106,2017-11-03 13:11:34
30717054,1575030,148714861,56,"Currently it contains all the defined port types, but this is not going to be the case in the future.  For example, the ports for remote debugging as part of https://github.com/twitter/heron/pull/2484 is optional and with not be part of the required.  And",826028106,2017-11-03 13:20:04
30717054,1575030,148715246,89,That is what the existing implementation implies.  SysUtils.getFreePort will return a -1 if it cannot find a free port.  We can do the check here or when we call SysUtils.getFreePort in the respective schedulers.  I am ok with either way,826028106,2017-11-03 13:25:49
30717054,1575030,148715356,87,Sorry i don't quite follow how I can use an iterator or lambda here.  I am iterating portsToUse and ExecutorPortNames.values() at the same time.  ,826028106,2017-11-03 13:27:28
30717054,1575030,148715568,42,"I think its more nature to override toString.  If I was to print ExecutorPortNames, I can just do 

System.out.println(ExecutorPortNames.MASTER_PORT) instead of something like System.out.println(ExecutorPortNames.MASTER_PORT.getName())",826028106,2017-11-03 13:31:39
30717054,1575030,148715591,81,"We can, but I am not sure it is the place to check for something like that since currently it will work fine even if there are additional ports but not if there are not enough ports.",826028106,2017-11-03 13:31:57
30717054,1575030,148715683,107,This method is just used for getting ports that are not required thus I don't throw an exception if I don't find the port in the map unlike getRequired,826028106,2017-11-03 13:33:10
30717054,1575030,148715846,74,"This method is just so that in the scheduler code I don't need to:

ExecutorPorts executorPorts = new ExecutorPorts();
executorPorts.setRequiredPorts(portsToUse);

instead I can just :
ExecutorPorts.withRequiredPorts(portsToUse)
",826028106,2017-11-03 13:35:59
30717054,1575030,148716185,22,"its simpler because if I didn't I would have to have a class variable that is a map which will hold the contents of the portname to port mappings.  I would also need to write wrappers such as ""put"" to expose the those methods to users or make the variable",826028106,2017-11-03 13:40:00
30717054,6377806,148829097,56,"I am looking at #2484. It seems remote debugging ports are required by the scripts and proto files. If that is correct, are you planning to change that? 

It also seems remote debugging ports will get promoted to `required` if remote debugging is enable",826028106,2017-11-03 23:18:23
30717054,6377806,148829107,42,I will not come to know that `toString` is returning the id of the port without looking at the code. One might also assume `System.out.println(ExecutorPortNames.MASTER_PORT)` prints port name and value too.,826028106,2017-11-03 23:18:25
30717054,6377806,148829127,22,Based on the current code `put` is the only method that would need to be exposed. As of now other methods from HashMap are not used anywhere. This class is not altering the behavior of the base class either. In which case I would prefer `composition` over,826028106,2017-11-03 23:18:28
30717054,6377806,148829133,22,"I think this added flexibility makes use of this class complex, requiring casting to the correct type. The object could be anything, a `String`, a `Topology`. The user will need knowledge of all references before any modification can be made.",826028106,2017-11-03 23:18:29
30717054,6377806,148831361,107,I thought `Optional` referred to `java.util.Optional`.,826028106,2017-11-03 23:27:41
30717054,6377806,148831541,74,"`static` methods are harder to test. On that note, there are no test cases in the PR.",826028106,2017-11-03 23:28:29
30717054,1575030,148892405,56,remote debugging ports will only be need if the user sets a flag in there topology.  This will be an optional port .  The scheduler will decide how to get these ports and pass them to SchedulerUtils.  ,826028106,2017-11-04 04:00:55
30717054,73683,149742950,42,Please do not use the value of `toString()` for any business logic. The `toString` value should only ever be used to log messages **and nothing else**. Overriding `toString()` for logic is an anti-pattern. Doing so violates encapsulation and provides and ,826028106,2017-11-09 01:40:26
30717054,73683,149747105,107,"If we have an `ExecutorPort` enum which includes whether it's required or optional, then the caller doesn't need to know which of the two methods to call here. They can just call `getPort(ExecutorPort port)` and the method can return `Integer` or throw if",826028106,2017-11-09 01:55:48
30717054,73683,149740193,22,I agree that ports should be Integers. Using `Object` for flexibility is almost always an anti-pattern. I would suggest using integer and if we find later that there's a requirement for multiple port bound to a single name (which seems like something to a,826028106,2017-11-09 01:29:56
30717054,73683,149741287,25,"This enum of port names provides little more than a list of strings. I suggest instead having an enum of ports (not names) and include metadata of each, like whether it's required or not and it's default value. Then enum itself could then have a getter fo",826028106,2017-11-09 01:34:11
30717054,6377806,150421405,111,"Please update the javadoc for `ports`. 
Also one of these two methods can be deleted, `getExecutorCommand` and `executorCommand`. I am not sure if the intent is to consume `<String, Integer>` type map in one of the methods.",831928489,2017-11-13 04:03:57
30717054,6377806,150422066,35,I suggested a method `getRequiredPorts` in one of the comments. Please see if using that would be better. If a required port is not `put` into the `EXECUTOR_PORTS` throw an error.,831928489,2017-11-13 04:24:32
30717054,6377806,150422003,60,"In the current approach each scheduler seeks for a specific port and adds its value. The scheduler will not fail If a new `required` port is added and the scheduler is not updated. I have a suggestion. Lets add a method to return all required ports, `Set<",831928489,2017-11-13 04:22:34
30717054,6377806,150421322,79,The java doc needs to be updated for `ports`,831928489,2017-11-13 04:02:24
30717054,6377806,150421609,24,"Converting `KubernetesConstants.EXECUTOR_PORTS` to a `<String, Integer>` map would reduce one unnecessary `Integer.parseInt` below.",831928489,2017-11-13 04:09:07
30717054,1575030,150422588,24,"I am not sure this is a good idea.  For some of the schedulers, e.g. Marathon Scheduler, the ports are actually strings, e.g. $PORT1.  Thus, its probably simpler if we just keep everything as a String.",831928489,2017-11-13 04:38:41
30717054,1575030,150422723,60,"In the current implementation, a exception will be thrown if the scheduler doesn't set all of the required ports.  The method ""executorCommandArgs"" calls the ""getPort"" method in ""ExecutorPort"" to get all the ports.  If the port is required and missing a r",831928489,2017-11-13 04:42:12
30717054,1575030,150422811,79,will update,831928489,2017-11-13 04:45:37
30717054,1575030,150422959,111,I will delete the executorCommand method.  It was my intention to pass the port map where the value is a string since some schedulers specify their ports as a string such as the Marathon Scheduler.,831928489,2017-11-13 04:50:01
30717054,1575030,150422980,35,Please see me previous comment concerning the current implementation will already throw an exception if a required port is missing.,831928489,2017-11-13 04:50:41
30717054,1575030,150423566,35,I will replace getNumOfRequiredPorts with getRequiredPorts as it is a more generic method,831928489,2017-11-13 05:07:44
30717054,1575030,150423251,60,"If a new port required port is added here and retrieved in the ""executorCommandArgs"" method then an exception will be thrown.",831928489,2017-11-13 04:56:33
30800774,3200023,149827324,6,Sort,830847299,2017-11-09 07:23:43
30800774,3200023,149827305,1,Formatting looks different.,830847299,2017-11-09 07:23:35
30800774,3200023,149826704,37,"I am wondering if ""interval"" is more clear than ""timerDuration"". Open to other thoughts.",830847299,2017-11-09 07:20:12
30800774,3200023,149827126,20,need to be public?,830847299,2017-11-09 07:22:36
30800774,1575030,149828478,20,nope I will change it back,830847299,2017-11-09 07:29:49
30800774,1575030,149869048,37,I will change the name,830847299,2017-11-09 13:20:04
30878179,10216235,149269186,10,actually the better way to do this would be to add edison backports and just do apt-get install.,829541512,2017-11-07 12:16:36
30930822,10216235,149576399,5,"Currently the translation occurs at the end of the step, in StormSubmitter. Any reason  not to do it there? That way there will be just one centralized place of doing it",830698525,2017-11-08 13:03:32
30930822,3200023,149581381,5,"The translation in StormSubmitter processes topology level configs. Components have their own configs and component level configs are merged later when Spouts and Bolts are created.


Without this change, the raw Storm configs for Spouts and Bolts are ",830698525,2017-11-08 13:58:50
30930822,3200023,149583806,5,"Doing all the translation in StormSubmitter.submitTopology() is one option, but it would require iterating all components and replacing their configs(so there will be heron configs in storm objects, which is not ideal). Overall, doing translation in *Decl",830698525,2017-11-08 14:22:40
30987031,7235147,150029336,52,Can we update the image here too heron/heron:latest?,831853508,2017-11-10 01:21:18
30987031,1575030,150040336,52,"sure
",831853508,2017-11-10 02:02:39
31034199,3200023,150146972,4,"why ""Legacy""? My understanding is that this API should be suggested in some cases. Same for the functional comment. It is not ""External"".",832745358,2017-11-10 11:26:00
31034199,3200023,150147533,12,"Not sure if this is necessary.

1. StreamletUtils is a class in examples directory. I feel it is reasonable for heron to provide a general function like sleep.
2. Utils looks like a low level object, correct? Why high level classes should avoid using i",832745358,2017-11-10 11:32:19
31034199,10216235,150299930,12,I think one of attempts of these examples is to show that one can use just the high level api without relying on anything from the low level api. ,832745358,2017-11-11 01:58:13
31034199,4456654,150307498,4,fixed,832745358,2017-11-11 02:35:33
31034199,3200023,150355535,12,Make sense. Thanks.,832745358,2017-11-11 06:53:58
31079472,3200023,150404182,5,what is this dummy ctor for? Is it better to have mis-usage protection if this is required by kryo?,834306402,2017-11-12 17:11:56
31079472,3200023,150404259,29,"Suggest to be more explicit in error message, like ""Linking with kryo is needed because useKryoSerializer is used"".",834306402,2017-11-12 17:14:42
31079472,3200023,150404228,13,Is this change necessary?,834306402,2017-11-12 17:13:10
31079472,10216235,150405952,13,Not needed. Reverted,834306402,2017-11-12 18:21:09
31079472,10216235,150405953,29,Changed,834306402,2017-11-12 18:21:16
31079472,10216235,150405966,5,This is primarily for Kryo. Made it non public,834306402,2017-11-12 18:21:40
31186342,3200023,150738412,4,seems not necessary?,836241367,2017-11-14 13:04:29
31186342,3200023,150739422,4,"Hmm. Do we really want to make Kryo as default?

Also I don't like this new boolean. If in future we need/have a new serializer, this code could become messy. In fact it already has issues If user calls: builder. useKryoSerializer(false). useKryoSeriali",836241367,2017-11-14 13:14:44
31186342,64790,150914127,4,"I conferred with @srkukarni on this and he agreed that the performance improvements associated with using Kryo are significant enough (with no apparent drawbacks) that Kryo should be the default. As for an enum, that could make things trickier in the futu",836241367,2017-11-15 02:01:36
31186342,3200023,151005229,129,Not sure if this error message is accurate or not.,837194330,2017-11-15 08:32:55
31186342,3200023,151005020,123,"Suggest to have two stages.

setSerializer() function set the variable. And have another applySerializer() to be called in build() function.",837194330,2017-11-15 08:31:25
31186342,64790,151222534,123,Good idea. Done.,837194330,2017-11-16 03:07:33
31186342,64790,151222944,129,"You’re right. I was misidentifying the problem. Using KryoSerializer.class instead of instantiating a KryoSerializer seems to have fixed the issue. You can still set the serializer more than once but again, I believe this is an issue in all builder patter",837194330,2017-11-16 03:09:10
31240316,3200023,151057433,26,"What if the id is not found? It would be better to have protective code instead of creating a connection to ""http://x:-1/killexecutor"".",837450677,2017-11-15 16:16:33
31240316,3200023,151058267,19,"Suggest to move this logic into a function and compare the names in the reversed way:

StMgr searchContainer(Integer id) {
  prefix = ""stmgr-"" + id;
  for (StMgr sm : stateMgrAdaptor.getPhysicalPlan(topologyName).getStmgrsList()) {
    if (sm.getId()",837450677,2017-11-15 16:21:22
31240316,32022953,151255857,19,done,837450677,2017-11-16 05:24:42
31240316,32022953,151255884,26,done,837450677,2017-11-16 05:24:48
31240621,32022953,151044444,16,do we put them in yaml?,837460719,2017-11-15 14:44:16
31240621,2183863,151044727,16,"If people want to override the value, they would put it in the yaml file. 
Currently, we just put `5` as the default value and use it.",837460719,2017-11-15 14:47:02
31240621,32022953,151045906,16,"i would suggest put an example config in yaml, otherwise how can user know there is a config like this in the code ?",837460719,2017-11-15 14:56:10
31240621,3200023,151056324,16,true. better to have an example.,837460719,2017-11-15 16:10:14
31240621,2183863,151057671,16,Added. Thanks.,837460719,2017-11-15 16:17:57
31240621,3201045,151244214,16,"This value is hard coded, probably not a good idea. Since you already have the yaml config, you can use this value - whatever this value is. Since most of the time this value is not changed, it automatically becomes the default value. 

Also the logic s",837460719,2017-11-16 04:34:55
31240621,2183863,151249908,16,"- This value is hard coded, probably not a good idea.
We need to handle backward compatibility; this is why we have this value in source code. Different places would use their own configs, not necessarily sync up with OSS Heron repo. This implementation ",837460719,2017-11-16 05:00:10
31247932,3200023,151210471,18,QQ: Do we need to delete the old node?,837617302,2017-11-16 02:21:39
31247932,32022953,151256258,18,"no, since the node is ephemeral",837617302,2017-11-16 05:26:28
31247932,2183863,151308907,41,"`if (b != null && b)` is good enough, or `if (b != null && b.booleanValue())`",838343823,2017-11-16 10:39:25
31247932,2183863,151309531,54,"`LOG.severe` does not lead to fail-fast. We would need to throw an exception here.
Furthermore, the `start()` returns `void`, we need to handle it carefully so the process will exit with non-zero exit code (throwing exceptions can be a good idea.)",838343823,2017-11-16 10:45:10
31247932,2183863,151309934,28,"Several comments:
1. Based on the design/comment/signature of this method, it should return `Null` or `False` and the failure handling should be outside this method.

2. For
```
LOG.severe(""creating zk metricscache node failed, fail fast"");
throw ne",838343823,2017-11-16 10:48:51
31247932,32022953,151327363,41,done,838343823,2017-11-16 14:05:29
31247932,32022953,151327401,54,changed to exception,838343823,2017-11-16 14:05:47
31247932,32022953,151327479,28,changed to fail fast when connection state is disrupted.,838343823,2017-11-16 14:06:34
31250273,3200023,151204609,5,suggest to move internal util functions to the beginning.,837666892,2017-11-16 01:58:20
31250273,3200023,151208916,26,suggest to add comments for the if and else blocks.,837666892,2017-11-16 02:15:30
31250273,32022953,151260840,26,done,837666892,2017-11-16 05:44:03
31250273,32022953,151260817,5,done,837666892,2017-11-16 05:43:55
31250273,2183863,151283758,37,Do you need to release the resource after `open`?,838163217,2017-11-16 07:32:32
31250273,2183863,151283471,30,"The variable name `processName` is a bit confusing. It seems what you refer to is `instanceId`, rather than the `processName`. Similarly, I would recommend changing the `request` structure so we can have `instance_id_to_restart` here",838163217,2017-11-16 07:30:51
31250273,32022953,151308044,37,added,838163217,2017-11-16 10:30:40
31250273,32022953,151308033,30,done,838163217,2017-11-16 10:30:34
31276628,3201045,151331011,17,@erenavsarogullari - ByteAmount is a convenience class that we use to make it more readable. Any idea why we need to change ByteAmount?,838334431,2017-11-16 14:39:35
31277246,10216235,151821384,4,Can we pl not do this. I specifically want no dep with anything heron other than api.,840187437,2017-11-18 08:58:23
31277246,64790,151822591,4,Another possibility might be to move this into the `heron-api` library.,840187437,2017-11-18 09:17:42
31277246,64790,151822814,4,"Actually wait, we can't do that because the basics lib is supposed to depend only on the JDK. Never mind.",840187437,2017-11-18 09:21:04
31277246,64790,151822551,4,"This doesn't require any dependencies that aren't currently included with the examples. In fact, one of the Topology API examples relies on this as well: 

https://github.com/twitter/heron/blob/master/examples/src/java/com/twitter/heron/examples/api/Com",840187437,2017-11-18 09:17:05
31284800,10216235,151512623,5,What is this?,839050162,2017-11-17 03:23:03
31284800,10216235,151512915,23,Can this be done better?,839050162,2017-11-17 03:24:11
31284800,7235147,151516260,23,The flag we set is called shard so i updated the variable name to match. We can probably do this better but that is probably a bigger change that we can address in another pr.,839050162,2017-11-17 03:36:54
31341414,32022953,151616540,5,better add a comment saying this config key-value pair for bolt level config setting demo,839511988,2017-11-17 15:17:41
31341414,2183863,151626020,5,Added.,839511988,2017-11-17 16:25:52
31341414,2183863,151625980,5,Added.,839511988,2017-11-17 16:25:39
31373019,992335,151822314,4,I think definition of Streamlet/StagePrefixNameType as enum can be useful by supporting type-safety and all types can sit in single place.,840165056,2017-11-18 09:12:58
31373019,992335,151821750,18,Hi Luc. I was also thinking about this changes. Thanks for it. Adding streamlet name to stagesNames logic looks missed for `ConsumerStreamlet`. Other Streamlets look ok. I think this logic can also be part of the abstracted `setDefaultNameIfNone` method a,840165056,2017-11-18 09:04:12
31378514,64790,152088652,16,I think it might be a bit premature to have a separate utils class for the streamlet API. I like this `require` function but I'd say let's keep it in the `StreamletImpl` class for now. If a handful of utility functions emerge then a util class will become,840277935,2017-11-21 03:31:51
31378514,64790,152089348,18,"Related to my comment on the `StreamletUtils` class above, I'd say include this with the `StreamletImplTest` for now. We can create a separate test suite for streamlet utils at a future time when a separate utils class makes more sense. The test is a good",840277935,2017-11-21 03:33:58
31378514,992335,152113673,18,UT coverages have been addressed for two use cases via ```testSetNameWithInvalidValues``` and ```testSetNumPartitionsWithInvalidValue``` and also ```require``` is set as private to avoid opening to public.,840277935,2017-11-21 05:19:07
31378514,992335,152113659,16,"Sure, this has just been addressed with last commit.",840277935,2017-11-21 05:19:03
31378622,3200023,151821093,7,s/then/throw?,840282229,2017-11-18 08:54:00
31378622,3200023,151821142,21,real names for the results.,840282229,2017-11-18 08:54:37
31378622,3200023,151821264,4,s/delete/considered as success,840282229,2017-11-18 08:56:20
31383639,2183863,151833302,43,"I don't think we need to make it so complicated. We will not do any recovering here,
so we can simply:
```
Log(...);
// The ReleaseResourcesExplicitlyIfNeeded() can be a bit tricky. 
// If you want to release resources explicitly, make sure set a tim",840432081,2017-11-18 16:55:37
31383639,32022953,151833875,43,updated,840432081,2017-11-18 17:30:08
31383639,2183863,151833953,29,You can put this in `finally`,840491440,2017-11-18 17:36:53
31383639,32022953,151849793,29,updated,840491440,2017-11-19 06:40:12
31527776,7235147,152717337,26,this should be ENV HERON_HOME /heron/heron-core/,844938483,2017-11-23 10:57:06
31527776,7235147,152717364,42,we can remove line 31,844938483,2017-11-23 10:57:32
31527776,3200023,152718094,24,suggest to move this line to beginning. not a blocker.,844938483,2017-11-23 11:09:47
31527776,3200023,152718299,20,suggest to be the same order as build-artifacts.sh,844938483,2017-11-23 11:13:19
31527776,3201045,153090549,24,removed this since the image already sets JAVA_HOME.,844938483,2017-11-27 09:15:05
31537419,3200023,152654409,5,this is expected?,844176691,2017-11-23 03:06:22
31537419,32022953,152711904,5,no need to use `topologyState ` any more,844176691,2017-11-23 09:30:28
31568536,3200023,153404857,28,what if remapping doesn't have the key?,849211643,2017-11-28 14:32:15
31568536,3200023,153405808,12,"- the actual deployed container-id is a ContainerPlan object? the comment is a little confusing.
- if the mapping is not needed in a specific scheduler, the function should return empty map?

suggest to have a comment about it.",849211643,2017-11-28 14:40:25
31568536,3200023,153425057,47,should this function be VisibleForTesting too? Seems more suitable for unit tests.,849214709,2017-11-28 16:45:55
31568536,32022953,153643076,28,then keep the original key,849211643,2017-11-29 06:29:47
31568536,32022953,153643626,12,updated,849211643,2017-11-29 06:32:19
31568536,32022953,153643649,47,updated with test,849214709,2017-11-29 06:32:27
31568536,3200023,153648189,32,suggest to factory out this block into a new function like extractContainerIds() so we can test it.,849214709,2017-11-29 06:53:26
31568536,3200023,153651318,33,"Not good to match against ""Querying instance statuses: "". I think it is better to match against regex "".*\[(\S*)\]"" and extract the string within [] and then parse it.


",849214709,2017-11-29 07:09:43
31568536,2183863,153696382,13,"It is good to comment clearly:
- Will the map-to-return include all container-ids to add, no matter whether requesting a remapping? 
Or
- Will the map-to-return include only the container-ids requesting a remapping?
Or
- Will the map-to-return includ",849995786,2017-11-29 13:25:23
31568536,2183863,153695955,43,Good to make this parsing logic as a method below,849995786,2017-11-29 13:20:30
31568536,2183863,153696038,20,Good to add more comments to illustrate the remapping logic.,849995786,2017-11-29 13:21:30
31568536,2183863,153695853,37,"If we need to add containers, and `stderr.length() <= 0`, should we consider it as an error and throw an exception?",849995786,2017-11-29 13:19:15
31568536,2183863,153695708,22,This should be `fine` Level Logging,849995786,2017-11-29 13:17:07
31568536,2183863,153695790,18,Should we return a list to preserve order or set?,849995786,2017-11-29 13:18:10
31568536,2183863,153695690,37,This should be `fine` Level Logging,849995786,2017-11-29 13:16:57
31568536,32022953,153702507,18,i prefer set because aurora returns unique ids. aurora does not enforce id order,849995786,2017-11-29 14:31:22
31568536,32022953,153705788,33,"`[]` is not enough, the stdout includes another [] list which is not container id list.",849214709,2017-11-29 15:01:07
31568536,32022953,153705818,32,updated,849214709,2017-11-29 15:01:20
31568536,32022953,153705953,22,updated,849995786,2017-11-29 15:02:02
31568536,32022953,153705962,37,updated,849995786,2017-11-29 15:02:07
31568536,32022953,153705981,37,updated,849995786,2017-11-29 15:02:14
31568536,32022953,153705994,43,updated,849995786,2017-11-29 15:02:21
31568536,32022953,153706008,20,updated,849995786,2017-11-29 15:02:27
31568536,32022953,153706019,13,updated,849995786,2017-11-29 15:02:33
31568536,32022953,153709703,18,e. how can it help remapping with less items,849995786,2017-11-29 15:30:23
31568536,2183863,153706878,18,"But don't you want a list of ids with increasing order? 

It could potentially help the remapping with less items.",849995786,2017-11-29 15:09:41
31568536,6377806,159538334,14,What is container-id remapping? This is not applicable to all schedulers. Please see if you can re-word this or give some examples.,879187217,2018-01-04 05:57:43
31568536,3200023,162707947,45,"I think this line might have a bug.

idx1 is not -1 when the string is not found. Instead, it is -1 + pattern.length(). So you cannot compare it with 0.

Suggest to add a unit test for the function to make sure it works correctly in both successful an",892493765,2018-01-20 03:15:14
31568536,32022953,162738494,45,updated,892493765,2018-01-20 05:39:25
31568536,3200023,162759281,23,"I think it should be better to test containersToAdd.size() == newAddedContainerId.size().

The controller.addContainers() function could return empty set or smaller set, and we need to handle the two cases here.",893238301,2018-01-20 07:49:20
31568536,3200023,162758360,43,"Suggest to have a unit test for this function, not a blocker though.",893238301,2018-01-20 07:41:22
31568536,3200023,162758530,40,"the function signature is ""String auroraStdoutStr"" and here the parameter is stderr. Maybe the parameter should be renamed.",893238301,2018-01-20 07:42:37
31568536,32022953,162761573,40,update to `auroraOutputStr`,893238301,2018-01-20 08:07:20
31568536,32022953,162763048,43,"there was a unit test already.
added one more unit test",893238301,2018-01-20 08:24:05
31568536,32022953,162763058,23,done,893238301,2018-01-20 08:24:12
31665704,32022953,153666099,19,"there is a space after `:`, which breaks our jeckins ci for two days. @maosongfu  @nwangtw ",847255586,2017-11-29 08:42:02
31689770,64790,153083089,16,This change is already included in an existing PR: https://github.com/twitter/heron/pull/2559/files#diff-59aa6c12ff571579c86e35a77cafe55eR95. I'd recommend leaving this change out of this PR to avoid conflict (I also would prefer for this enum to remain p,847824743,2017-11-27 05:55:23
31689770,64790,153083187,13,"In general, I think that the changes suggested in this PR are already covered in #2559. But I do think these tests would be nice to have. Could you possibly re-submit this or a different PR with just the tests once #2559 is merged?",847824743,2017-11-27 05:58:16
31689770,992335,153083621,28,"Thanks @lucperkins for quick feedback. Sure, i will be removing enum changes form this PR due to addressed by other PR. 

In addition to test cases, this change (abstraction of `stageNames.add(getName()); `) can be part of this PR, if there is no concer",847824743,2017-11-27 06:11:57
31689770,64790,153083675,28,"Yep, sounds good!",847824743,2017-11-27 06:14:01
31703639,7235147,153286181,22,should we make this a for loop so we fail after sometime?,848173361,2017-11-28 02:45:09
31703639,7235147,153286100,1,Do we need this file? ,848173361,2017-11-28 02:44:48
31703639,7235147,153286660,65,Should there be a bookkeeper dependency in the chart?,848173361,2017-11-28 02:46:59
31703639,3201045,154178505,1,Yes indeed - it gives some overview of what has been installed.,848173361,2017-12-01 03:34:22
31745466,3200023,153654308,26,"Do we have any information for the package we can log? Like time window, etc? Sorry if this is a silly question.",849040698,2017-11-29 07:26:16
31745466,3200023,153653774,6,Do we need to check state&pointer here? Can conn_ be NULL in some cases/states?,849040698,2017-11-29 07:23:10
31745466,3200023,153656081,22,"Just to confirm. The drop upon backpressure logic is handled in the ""(!IsConnected())"" branch. Is it expected? Do we need it in the ""(IsConnected)"" branch?",849040698,2017-11-29 07:36:07
31745466,3200023,153655817,26,"The drop count is for both not connected and backpressure, so the log could be misleading. Just a concern to me, not a real issue. Your call.",849040698,2017-11-29 07:34:37
31745466,3200023,153654478,41,"same, suggest to add ""and droptuples_upon_backpressure is set to true"" in log.",849040698,2017-11-29 07:27:17
31745466,3200023,153655036,88,"Suggest to add a log here like ""droptuples_upon_backpressure is set to true, hence no backpressure mechanism is initialized""",849040698,2017-11-29 07:29:59
31745466,3200023,153656405,39,"I don't know this part of code yet. Just to confirm, the StartBackPressureOnServer() call doesn't affect the HasCausedBackpressure() result, right?",849040698,2017-11-29 07:38:04
31745466,3200023,153654847,86,I am just wondering if this should be a WARNING log. Not a blocker.,849040698,2017-11-29 07:28:59
31745466,3200023,153654082,25,"suggest to add ""and droptuples_upon_backpressure is set to true"" in log.

Also, how many logs are we talking about here?",849040698,2017-11-29 07:24:57
31745466,10216235,153747975,6,"Not really, but I've added some checks just for safety",849040698,2017-11-29 18:31:17
31745466,10216235,153748054,25,Expanded comment and also log every so often,849040698,2017-11-29 18:31:36
31745466,10216235,153748118,26,Addressed by adding bytes dropped,849040698,2017-11-29 18:31:50
31745466,10216235,153748145,41,Added,849040698,2017-11-29 18:31:57
31745466,10216235,153748187,88,Added,849040698,2017-11-29 18:32:08
31745466,10216235,153748165,86,Sounds good,849040698,2017-11-29 18:32:03
31745466,10216235,153748230,22,Redid the logic,849040698,2017-11-29 18:32:19
31745466,10216235,153748312,26,"I think as long as we are counting drops, we should be ok",849040698,2017-11-29 18:32:37
31745466,10216235,153748356,39,Nopes,849040698,2017-11-29 18:32:49
31952695,2183863,154484592,76,"This implementation tries to keep the ratio of `#(instances)/#(containers)` always the same during re-scaling.

The issue here is:
During each re-scale, we would update only # of instances in topology def, and # of containers will not be updated. So th",853186949,2017-12-02 09:56:33
31952695,3200023,154488416,72,"Please add comment about what the logic below is doing and why. This function is not very straightforward.

Also are there unit tests for this class?",853186949,2017-12-02 12:47:32
31952695,3200023,154488515,76,"I am curious about how the original number of container is evaluated? Is it configured or calculated? If it is configured, maybe better to pass a parameter? If it is calculated based on topology, can we run the same calculation with the new topology confi",853186949,2017-12-02 12:53:47
31952695,3200023,154488372,53,TopologyUtils.getTotalInstance() doesn't work? Maybe worth adding this code to TopologyUtils as a util function?,853186949,2017-12-02 12:42:52
31952695,2183863,154491487,76,"- I am curious about how the original number of container is evaluated? 
It is set by customers by is put into the topology-level config: https://github.com/twitter/heron/blob/master/heron/api/src/java/com/twitter/heron/api/Config.java#L356


One issu",853186949,2017-12-02 16:39:50
31952695,2183863,154491514,72,"+1 for unit tests. Particularly, the unit tests should guarantee situations below not to happen:
- count of instances in a container grows boundlessly
- count of instances in a container reduces to 1 eventually",853186949,2017-12-02 16:43:20
31952695,2183863,154491588,53,"The implementation of `TopologyUtils.getTotalInstance()`, https://github.com/twitter/heron/blob/57310fe58a808ee9cf88b91121d9d8822698bee1/heron/api/src/java/com/twitter/heron/api/utils/TopologyUtils.java#L130, seems same?",853186949,2017-12-02 16:48:12
31952695,32022953,154777020,76,"how about count the max#(instance) and min#(instance) per container from the current packing plan, and keep both counts during scaling ?",853186949,2017-12-05 05:15:29
31952695,32022953,154778858,53,"getTotalInstance() needs a TopologyAPI.Topology which is different from Map<String, Integer>
or we may refactor getTotalInstance()? what do you think",853186949,2017-12-05 05:23:02
31952695,3200023,154821334,53,"I think refactoring might be better. Easier to read and easier to test.
",853186949,2017-12-05 09:01:40
31952695,32022953,154822428,76,make the ratio remains same during topology lifecycle #2602,853186949,2017-12-05 09:09:22
31952695,32022953,154987507,53,refactored,853186949,2017-12-05 23:48:40
31952695,32022953,154988639,72,added comment,853186949,2017-12-05 23:52:03
31952695,32022953,154992991,72,added unit test,853186949,2017-12-06 00:04:47
31952695,3200023,155366309,63,"is ""current packing plan"" accurate?",856468977,2017-12-07 05:28:09
31952695,3200023,155367600,75,"I am wondering if it is easier to understand this way:

newComponentParallelism = currentComponentParallelism;
for (e: componentChanges) {
  newComponentParallelism.put(e.getKey, e.getValue);
}

int newNumInstance = TopologyUtils.getTotalInstance(n",856468977,2017-12-07 05:33:23
31952695,3200023,155367855,75,"also, I am wondering if we should verify that the value needs to be positive?",856468977,2017-12-07 05:34:21
31952695,32022953,155390086,63,this packing plan is the latest from zk.,856468977,2017-12-07 07:15:17
31952695,32022953,155392998,75,"newComponentParallelism is supposed to include the old and new components, while the suggested code includes new components only.

",856468977,2017-12-07 07:31:42
31952695,32022953,155395935,75,added positive parallelism check in RuntimeManagerRunner.java,856468977,2017-12-07 07:50:40
31952695,32022953,155400286,75,adopt @nwangtw suggestion code,856468977,2017-12-07 08:21:12
32019569,10216235,154738234,32,can you comment on what's going on here?,854857708,2017-12-05 02:45:23
32019569,1575030,154738918,32,"I add this because specifying an override via commandline for the config ""heron.statemgr.connection.string"" does not get propagated into the heron_executor.  Thus, if I want to specify the location of zookeeper via command line, I cannot.",854857708,2017-12-05 02:47:57
32019569,3200023,154776274,29,"space between ""+"" and ""[""",854857708,2017-12-05 05:12:08
32019569,3200023,154774030,4,revert this change,854857708,2017-12-05 05:02:04
32019569,3200023,154775473,20,"Why a new downloader is added? HttpDownloader is not enough in this case? The implementation seems to be the same.

If there is a new case, please add comment to explain. My concern is that in future people dont know which one to use or could mis-use th",854857708,2017-12-05 05:08:35
32019569,3200023,154774244,23,do we need try/cache here?,854857708,2017-12-05 05:02:59
32019569,3200023,154773774,5,Hmm. Is it possible to avoid the .sh files here?,854857708,2017-12-05 05:01:21
32019569,7235147,154785191,5,This needs to be a string because we use an environment variable for the container id,854857708,2017-12-05 05:47:04
32019569,7235147,154785927,17,Kubernetes needs to be able to send a string as the shard id,854857708,2017-12-05 05:49:55
32019569,1575030,154802883,20,"So I added this because the heron_downloader couldn't handle URIs like: ""file:///foo/bar"".  This is the same implementation as the HttpDownloader, but I am not sure if we should point URIs with a prefix of ""file"" to the the http downloader or just have a ",854857708,2017-12-05 07:07:04
32019569,1575030,154803306,4,will revert,854857708,2017-12-05 07:09:25
32019569,1575030,154803469,23,though this is really done once on the start of the topology,854857708,2017-12-05 07:10:20
32019569,1575030,154804047,5,We need the heron_nomad.sh script to start heron_executors in nomad.  Not sure where else would be more appropriate to put this since the script needs to be available on where you install the heron cli.  The heron.aurora script is placed in the aurora con,854857708,2017-12-05 07:13:20
32019569,1575030,154810659,17,will change back,854857708,2017-12-05 07:50:27
32019569,1575030,154810698,5,will change back,854857708,2017-12-05 07:50:39
32019569,3200023,154866250,20,Got it. thx. Please add a comment about the use case. An example could be good enough.,854857708,2017-12-05 15:43:47
32019569,3200023,154865952,5,why 2181? I think it is the default port for zk so maybe better to avoid if possible.,855687511,2017-12-05 15:41:33
32019569,3200023,154866422,106,Remove the empty line.,855687511,2017-12-05 15:44:45
32019569,3200023,154866434,111,Remove the empty line.,855687511,2017-12-05 15:44:50
32019569,3200023,154867479,5,nit: bad indent.,855687511,2017-12-05 15:51:18
32019569,3200023,154867143,205,"nit: s/succeed/Succeed

There are a few of them in this file",855687511,2017-12-05 15:49:28
32019569,3200023,154868715,5,"heron.aurora might be ok (maybe not ideal though) because aurora file is a config and used by aurora cli.

.sh file is worse than aurora file. :(  So I am wondering if it is possible to avoid this .sh file and have a config to be used by nomad CLI?

I",854857708,2017-12-05 15:56:30
32019569,3200023,154866192,23,kk.,854857708,2017-12-05 15:43:23
32019569,3200023,154867165,228,nit: s/fail/Fail,855687511,2017-12-05 15:49:39
32019569,1575030,155039673,5,"The .sh file is actually read by the scheduler and submitted to nomad as part of a job description in json format.  I can inline the contents of the .sh script in the scheduler code, but that might not be as clear to the user as just having a file with co",854857708,2017-12-06 02:44:36
32019569,1575030,155039731,20,sure thing,854857708,2017-12-06 02:44:50
32019569,1575030,155041385,5,"2181 is the default port number for zookeeper.  If I was to run whole setup (scheduler, topology, and zookeeper) on a single node, this is the default I would use.  The cli and all executors will be able to contact the local zookeeper on 127.0.0.1:2181",855687511,2017-12-06 02:51:14
32019569,1575030,155041669,5,will fix,855687511,2017-12-06 02:52:24
32019569,1575030,155042005,205,will fix,855687511,2017-12-06 02:53:27
32019569,1575030,155042157,228,will fix,855687511,2017-12-06 02:54:08
32019569,1575030,155042438,106,will fix,855687511,2017-12-06 02:55:14
32019569,1575030,155042460,111,will fix,855687511,2017-12-06 02:55:19
32019569,3200023,155108753,5,got it. thx.,855687511,2017-12-06 07:36:33
32019569,3200023,155108836,5,kk.,854857708,2017-12-06 07:36:48
32019569,1575030,154803156,29,will add,854857708,2017-12-05 07:08:34
32019569,32022953,155362152,23,config/yaml/heron.aurora needs update to add this param.,856540858,2017-12-07 05:11:55
32019569,3200023,155364426,23,:( required. Is it possible to be optional?,856540858,2017-12-07 05:20:58
32019569,3200023,157640550,23,I don't see any scheduler passes this flag. Why it is not causing errors?,856540858,2017-12-19 08:53:35
32019569,1575030,157641485,23,"it is added in SchedulerUtils that every scheduler calls except aurora I believe.

https://github.com/twitter/heron/pull/2601/files#diff-2f8f616b79cedacafb019678d260770fR265",856540858,2017-12-19 09:00:52
32019569,3200023,157669041,23,"I see. That could be the case.

Another note is that it seems all the other schedulers have statemanager configs explicitly in the following file. It may make sense to have this new config as well, especially since it is a required field.

heron/confi",856540858,2017-12-19 13:49:53
32019569,3200023,157669521,23,Never mind. I see what you mean. You want to override the config file itself.,856540858,2017-12-19 13:54:40
32019569,3200023,157671174,23,"@jerrypeng  Cant add you as reviewer. :(  Here is the PR for aurora when you get a minute. I am testing the change internally.

https://github.com/twitter/heron/pull/2630",856540858,2017-12-19 14:11:47
32058065,2183863,154825848,6,"If we remove the topology-update on stateManager, it seems we could remove or clean a lot of codes, like:
```
private TopologyAPI.Topology getUpdatedTopology(...)
static TopologyAPI.Topology mergeTopology(...)
private static boolean updateComponent(..",855716533,2017-12-05 09:35:02
32058065,32022953,154984204,6,removed,855716533,2017-12-05 23:38:59
32058065,2183863,155061369,48,"Good to have a comment here saying:
`Will throw exceptions internally if failed to xxxx`",856370467,2017-12-06 04:05:58
32058065,2183863,155061342,28,"Good to have a comment here saying:
`Will throw exceptions internally if failed to xxxx`",856370467,2017-12-06 04:05:51
32058065,32022953,155111811,28,done,856370467,2017-12-06 07:54:14
32058065,32022953,155111826,48,done,856370467,2017-12-06 07:54:21
32207473,3201045,155666085,47,@lucperkins  - working on hosting the open source charts in a different place. It should be done today.,858825556,2017-12-08 07:02:15
32207473,64790,155666321,47,@kramasamy Awesome! Let me know how that turns out. FYI this is just a work in progress at the moment.,858825556,2017-12-08 07:03:39
32207473,3201045,162518213,132,"n1-standard-4 and there is no need for 2 SSDs per machine. Since we use stateful sets, there is no need for it.",892402502,2018-01-19 09:32:49
32207473,3201045,162518494,167,"We need to add a repo - 

helm repo add heron-charts <url>",892402502,2018-01-19 09:35:16
32207473,3201045,162518384,155,local ssd count - is not needed.,892402502,2018-01-19 09:34:19
32207473,3201045,162518341,147,Again SSDs are not needed since we use stateful sets. The stateful sets automatically create the necessary persistent claim templates.,892402502,2018-01-19 09:33:52
32211569,3200023,155734852,17,Hmm. API is removed? This will affect Twitter internal use case. Is it possible for you to add it back?,858936162,2017-12-08 17:30:36
32262535,7235147,156168262,7,could metaData.get here ever return null?,859987326,2017-12-12 03:04:50
32262535,7235147,156170178,77,Can we add some useful error messages here? There are some private helper methods (that could be refactored out) in the TopologyResources to help with this.,859987326,2017-12-12 03:12:00
32262535,7235147,156168520,137,"Maybe use a util here? FileHelper.copy(in, path)?",859987326,2017-12-12 03:05:48
32262535,1575030,156252087,7,Yes if there is some other nomad job running that does not have this user defined meta data set e.g. API server,859987326,2017-12-12 09:43:07
32262535,1575030,156260183,137,I can move the function to FileHelper but the existing copy only copies files already on disk,859987326,2017-12-12 10:50:16
32262535,3200023,157706306,26,"1. Why change to FINE? This error looks serious.
2. why append strings in two places? One in msg =, another in LOG.log()?",868197929,2017-12-19 17:47:27
32262535,3200023,157706849,14,sort,868197929,2017-12-19 17:49:39
32262535,3200023,157705904,6,"Maybe a stupid question, can we use if (metaData != null && metaData.get(NomadConstants.NOMAD_TOPOLOGY_NAME) == topologyName) here?

Also if we need to break it into two if statements, I think if (metaData != null ) { if (...) } might be better.",868197929,2017-12-19 17:45:44
32262535,3200023,157706632,14,Just to confirm that this indent is expected or not.,868197929,2017-12-19 17:48:47
32262535,3200023,157707656,40,"suggest to put the standalone command to the local command list, instead of here as an or operation. It is  more complicated than the version command.

See below in main() function,
local_commands = ('help', 'version', 'config')
",868197929,2017-12-19 17:52:47
32262535,3200023,157704478,1,suggest adding an example here.,868197929,2017-12-19 17:40:05
32262535,3200023,157703545,5,"nit: suggest moving ""[conf/**.*.yaml""] to next line, and suggest sorting them.",868197929,2017-12-19 17:36:19
32262535,3200023,157704353,1,suggest adding an example here.,868197929,2017-12-19 17:39:45
32262535,3200023,157704528,1,suggest adding an example here.,868197929,2017-12-19 17:40:20
32262535,1575030,157852263,1,will add,868197929,2017-12-20 03:27:58
32262535,1575030,157852307,1,will add,868197929,2017-12-20 03:28:09
32262535,1575030,157852288,1,will add,868197929,2017-12-20 03:28:04
32262535,1575030,157853446,5,will do,868197929,2017-12-20 03:32:34
32262535,1575030,157854571,6,"We cannot do ""metaData.get(NomadConstants.NOMAD_TOPOLOGY_NAME) == topologyName)"" because first in java to compare strings you have to your .equals instead of ""=="".  ""=="" will check if its the same instance rather if it has to same value.  If you use .equa",868197929,2017-12-20 03:36:51
32262535,1575030,157856329,14,I will fix the incorrect indent,868197929,2017-12-20 03:43:37
32262535,1575030,157856095,26,"To answer you first question:

The job spec can be quite long that is why I would rather print it explicitly if the user specified --verbose via the command line.

To answer your second question:

The reason why I append if so that the RuntimeExcept",868197929,2017-12-20 03:42:48
32262535,1575030,157859893,14,will do,868197929,2017-12-20 03:58:03
32302716,7235147,156107498,105,alignment looks off,861148557,2017-12-11 23:37:03
32302716,7235147,156107593,65,alignment looks off,861148557,2017-12-11 23:37:18
32302716,7235147,156107433,161,alignment is off,861148557,2017-12-11 23:36:49
32570222,64790,157625677,5,Could you rename this enum to `StreamletNamePrefix`? I think it makes more sense that way.,866724590,2017-12-19 07:08:15
32570222,992335,157633388,5,"Firstly, thanks for review.
Sure, what about `StreamletNamePrefixType` by emphasizing type? In general, most of the enums have type suffix (e.g: `JoinType`)",866724590,2017-12-19 07:57:50
32570222,64790,157829780,5,"In this case I would say no, because you’re not specifying a type per se but rather just providing a string",866724590,2017-12-20 02:00:41
32570222,992335,157884135,5,Addressed and ready for re-review ;),866724590,2017-12-20 05:46:04
32676717,3200023,158374340,13,"It seems cluster config is used only for downloading topology after this change? If this is true, maybe add comment or rename variable. The variable itself gives me an impression that there are a local mode and a cluster mode.",868512537,2017-12-22 04:44:59
32676717,3200023,158374509,1,"s/2016/2017.

This is a new tool? Is there a doc about it?",868512537,2017-12-22 04:45:49
32676717,1575030,158544618,1,"There isn't currently.  Will right one in the future, but the you can always type ""heron-admin help"" and it will give you a detailed explanation of all commands and subcommads",868512537,2017-12-23 03:09:53
32683138,3201045,158184022,23,@cckellogg - you might want to change heron.aurora file that launches heron_executor as well.,868567368,2017-12-21 10:16:13
32873374,32022953,158744956,5,who overrides them,873954451,2017-12-27 06:40:18
32873374,3200023,158745350,5,Users who want to customize the tools.,873954451,2017-12-27 06:49:28
32873374,3200023,158747007,5,I can also add an option to override heron client data files in cli.,873954451,2017-12-27 07:28:26
32911852,5113813,159020136,19,Isn't `metricsCacheStartedAttempts` the number of attempts?,874955749,2017-12-29 10:40:19
32911852,3200023,159040603,19,Yeah. It is the number of attempts to connect to a specific endpoint.,874955749,2017-12-29 17:32:58
32911852,3200023,159041248,19,"In fact, let me think about this line again. The idea for the old and new code are similar and the new code focus on the first time. I may consider reverting this line. Thanks for the question.",874955749,2017-12-29 17:38:44
32911852,5113813,159041431,19,"Yeah, I was feeling it's wired to compare (x times >= y seconds).",874955749,2017-12-29 17:40:12
32911852,5113813,159043130,6,typo: localtion -> location,875756593,2017-12-29 17:58:31
32911852,5113813,159043115,6,typo: localtion -> location,875756593,2017-12-29 17:58:22
32911852,5113813,159043199,17,`RESTART_WAIT_INTERVAL/RECONNECT_INTERVAL`?,875756593,2017-12-29 17:59:12
33054928,32022953,159323358,14,what happens if looper does not stop after 10 seconds,878396987,2018-01-03 05:49:07
33054928,3200023,159341271,14,"The function stops waiting and returns false.

In this case, the code works pretty much the same way as before after the waiting. Except exitLoop() set a flag to true so the looper won't do any real work afterwards.
",878396987,2018-01-03 07:51:59
33063163,1575030,159369831,6,nit.  Please remove extra space,878618811,2018-01-03 15:19:46
33063163,1575030,159369854,23,Place remove extra line,878618811,2018-01-03 15:20:06
33063163,1575030,159487372,2,"If a custom trigger or evictor, validate should not be called.  Arguments would be directly passed into the custom evictor and trigger when they are intialized",878618811,2018-01-04 01:56:53
33063163,1575030,161408960,36,I think we should remove this from the interface.  Having this interface is confusing to users since WindowManager implements the TriggerHandler interface.  WindowManager is also not a interface that users can implement thus it shouldn't be part of an int,885444532,2018-01-15 04:30:05
33063163,1575030,161409014,44,"Not sure if this interface is necessary, if we remove WindowManager from the TriggerPolicy interface ",885444532,2018-01-15 04:31:29
33063163,39206301,161416236,36,"The reasoning behind this was that the WindowManager, TriggerHandler (which is the WindowManager) and TopologyConfig are three things the users may not have access to directly.  I was aiming to provide access to the same structures used in the internal Tr",885444532,2018-01-15 08:39:14
33063163,39206301,161416239,44,"Regardless, you would still need a way to get the TriggerHandler (WindowPolicy) attached to the custom TriggerPolicy that was passed to the config.  AbstractBaseTriggerPolicy was just made as a way to standardize how these attachments were handled for the",885444532,2018-01-15 08:39:17
33063163,1575030,161630966,36,Looking more closely at the code I am confused how the a custom trigger policy will work.  All the existing trigger policies require the WindowManager to actually trigger windows. How will a user implementing a custom TriggerPolicy do this.  They have no ,885444532,2018-01-16 07:10:02
33063163,39206301,161769918,36,"Take a look at the changes i’ve made to windowedBoltExecutor.  Essentially, in order to allow these to attach to arbitrary triggerPolicies, Ive replaced their inclusion in the constructor with the setters you see in the interface for all trigger policies.",885444532,2018-01-16 22:21:26
33063163,1575030,161849364,59,Not sure if we need these checks.  I think it should be up to the user to make sure to pass in the correct objects he or she needs for a custom trigger.  Having to pass these booleans into the constructor also makes the interface confusing to some reading,885444532,2018-01-17 02:43:52
33063163,1575030,161849573,36,I see,885444532,2018-01-17 02:44:39
33063163,39206301,161969295,59,"@jerrypeng These checks were in place to keep the existing trigger policies as restrictive as they were before wrt which of the objects were attached.  I could provide an alternate no-arg constructor that sets them all to false, then use setters instead? ",885444532,2018-01-17 15:00:34
33063163,1575030,162161196,59,lets remove them to keep the interface as simple and clean as possible,885444532,2018-01-18 03:52:45
33063163,39206301,162227420,59,@jerrypeng will do,885444532,2018-01-18 09:23:07
33481070,32022953,161305240,12,why newRam != currentRam,886837991,2018-01-13 03:22:21
33481070,3200023,161838450,12,"It happens to all algorithms in fact, but it may not be a problem because some algorithms requires per component resources specified.

And it is impossible to be handled in RoundRobin. Different container has different set of components. RoundRobin calc",886837991,2018-01-17 02:02:32
33753834,3200023,162491040,20,is this expected?,892304767,2018-01-19 06:37:03
33753834,32022953,162739355,20,This configuration value is just an example showing it may be different from the slow instance configuration. Uses have to tune the value in the field.,892304767,2018-01-20 05:43:34
33753834,3200023,162764649,20,kk. thx.,892304767,2018-01-20 08:42:48
33836311,992335,162817636,35,"In the light of Scala User perspective and in my opinion, All exposed Scala `Traits` should be **pure scala**. This means Scala traits should accept `Scala Functions` instead of `FunctionalInterface` here:

`def newSource[R](supplier: () => R): Streamle",894006103,2018-01-22 00:35:02
33836311,992335,162817400,1,"**General BUILD Comment**:
`*.scala` files are not referenced here. Bazel supports Scala via 
https://github.com/bazelbuild/rules_scala 
so i think we need to use scala_library to compile scala files by referencing
`com/twitter/heron/streamlet/scala/*",894006103,2018-01-22 00:26:14
33836311,992335,162817521,1,"**General Comment:**
Currently, All files look living under `heron/api/src/scala`. 
- Related `*.scala` files should be under package: `heron/api/src/scala/com/twitter/heron/streamlet/scala`  (except `BUILD` file)
e.g: Currently, _Java Streamlet API_ l",894006103,2018-01-22 00:31:13
33836311,992335,162817759,1,"**General Serializable-FunctionalInterfaces Comment**
I think all Serializable Functional Interfaces(SerializableFunction, SerializableConsumer etc...) should be hidden from Scala Users. This means Scala API should just accept pure Scala functions instea",894006103,2018-01-22 00:39:49
33836311,992335,162817813,71,"In the light of my previous comment, as a sample for `map` function, i think this should be as follows.
`def map[T](mapFn: R => _ <: T): Streamlet[T]`
instead of 
`def map[T](mapFn: SerializableFunction[R, _ <: T]): Streamlet[T]`

Same comment for th",894006103,2018-01-22 00:41:59
33836311,3200023,163033502,213,UIDs seem to be the same as Java version. Just to confirm if this what we want or not.,894557749,2018-01-23 02:55:59
33836311,3200023,163325547,35,"I am wondering if we can use case class here? if it is not expected to be extended.

case class KeyValue[K, V](
  @BeanProperty val key: K,
  @BeanProperty val value V) {
  override def toString() = ....
}

val or var depending on the usage.",894557749,2018-01-24 01:56:31
33836311,3200023,163326005,37,"suggest to add {}.

try {
  ...
} catch {
   ...
}",894557749,2018-01-24 01:58:15
33836311,3200023,163326298,35,is this line necessary?,894557749,2018-01-24 01:59:16
33836311,3200023,163332588,25,another candidate to be case class.,894557749,2018-01-24 02:23:23
33836311,3200023,163324211,85,"consider import the package as
import com.twitter.heron.api.{Config => ApiConfig}

then use ApiConfig.TopologyReliabilityMode, etc

instead of full path.
",894557749,2018-01-24 01:51:28
33836311,3200023,163325723,28,"same as KeyValue, maybe case class if possible.",894557749,2018-01-24 01:57:12
33836311,269478,163351982,50,"can't we just use `""{ "" + key + "" : "" + value + "" }""`?",894557749,2018-01-24 03:31:07
33836311,269478,163353619,71,"`SerializableFunction` is a java function, not a scala function. which I think you can't really use all those scala syntactic sugar. if we are generating a scala oriented api, it would be better to think about taking scala function, rather than using java",894557749,2018-01-24 03:36:59
33836311,269478,163352154,43,"do we really need `String.valueOf` or `toString`? if you just `""{ key: "" + key + "" window: "" + window + "" }""`, it is better than explicitly call `toString`, because it handles null field, while `window.toString` would throw NPE if `window` is null.",894557749,2018-01-24 03:31:42
33852600,3200023,163428293,5,"suggest to revert this change. This pattern seems to be used in some other files as well, so this change seems to be unnecessary.",894450754,2018-01-24 09:02:37
33852600,3200023,163427571,97,maybe keep the Runnable() wrapper?,894450754,2018-01-24 08:57:23
33852600,39206301,164031368,5,"Okay, will revert",894450754,2018-01-26 12:11:42
33852600,39206301,164031674,97,"Just realized :: was a Java 8 feature- is that why you want this to be reverted?

If so, should I be developing in Java 7?

If not, why? What’s wrong with it?",894450754,2018-01-26 12:15:37
33852600,3201045,164036547,97,@dancollins34 - we all use java 8 by default.,894450754,2018-01-26 13:34:25
33852600,3200023,164220563,97,"not a blocker.

nothing wrong. more about consistency to other modules.

also in case some users may have to run heron on java7 for any reason.",894450754,2018-01-27 04:59:00
33852600,3201045,164221329,97,"@nwangtw - use to generate library jars for 7. After twitter moved to Java 8, we also moved to Java 8 - by default you need Java 8 to compile and even to run your topologies.",894450754,2018-01-27 05:03:18
33852600,39206301,164261420,97,There seems to be a significant feeling it should be the other way- will revert tomorrow.,894450754,2018-01-27 11:03:11
33917539,7235147,163129558,35,"let's add a method that we can use below when forming the uri. I don't like setting a static variable here. 
private String getHostnameOrIp(Config config);
Also you can call config.getString(key, defaultValue) so we don't need the string util.
",895868681,2018-01-23 10:31:36
33917539,7235147,163313038,33,"can we do a little refactoring and have method call getHostnameOrIp() so we are not setting a static variable like this. Then lines 119/120 becomes:
String uri = String.format(""http://%s:%s/api/v1/file/download/%s"", getHostnameOrIp(), getPort(), fileName",895907872,2018-01-24 01:11:54
33917539,7235147,163350444,68,"I think we should not be setting static state here.
final String downloadHostName = getDownloadHostName();
if (StringUtil.isNotBlank(downloadHostName) {
  return downloadHostName;
}

return hostname != null ? hostname : ip;
",896630142,2018-01-24 03:25:39
33917539,4456654,163366000,68,Changed it and added a check for ip being null,896630142,2018-01-24 04:23:27
34031075,1575030,163760596,19,"This changes the expected behavior of the install and will break a lot of things.  For example, the nomad scheduler expected that heron core to be at:

file://${HERON_DIST}/heron-core.tar.gz

you unTARing it here and removing the archive will break th",898082202,2018-01-25 14:40:25
34031075,1575030,163760720,19,this will Aurora too,898082202,2018-01-25 14:41:39
34031075,3201045,163760774,19,@jerrypeng - are you using the heron-install.sh script or just untaring the heron.tar.gz?,898082202,2018-01-25 14:42:10
34031075,1575030,163761063,19,"For nomad/standalone, the user will use heron-install.sh to install on a bootstrap machine.  Then the .heron directory will be copied to all the machines in the standalone cluster as is",898082202,2018-01-25 14:44:58
34031075,1575030,163761449,19,"It will break Aurora as well:

heron_core_release_uri = '{{CORE_PACKAGE_URI}}'
heron_topology_jar_uri = '{{TOPOLOGY_PACKAGE_URI}}'
core_release_file = ""heron-core.tar.gz""
topology_package_file = ""topology.tar.gz""

# --- processes ---
fetch_heron_s",898082202,2018-01-25 14:48:14
34031075,3201045,163762053,19,"@jerrypeng - for nomad case, we can add a config that in nomad/scheduler.yaml - similar to local and it will work. For aurora nothing will break since the core_package_uri will be in a URL that is stored somewhere else.
",898082202,2018-01-25 14:53:58
34031075,1575030,163762845,19,"I don't understand how adding just a config will work?  Both in Nomad and Aurora start scripts it expects a archive and will execute ""tar zxf"" on it to untar it. We will have to change that as welll",898082202,2018-01-25 15:00:15
34031075,3201045,163763325,19,"the core logic - can either curl or use symbolic - which is controlled by a config. It is a question of telling nomad which one to use. For Aurora, the deployment is that - heron-core.tar.gz is served from a file server (like webserver or packer) ",898082202,2018-01-25 15:04:24
34031075,1575030,163764609,19,ok,898082202,2018-01-25 15:15:48
34031075,1575030,163766959,19,"gotcha, we can probably use the same method of creating a symbolic link in heron-nomad.sh",898082202,2018-01-25 15:33:43
34031075,7235147,164808076,4,if these keys do not exist will false just be returned?,902657813,2018-01-31 00:54:20
34063374,3201045,163957344,9,We use 4 spaces indentation.,898684674,2018-01-26 04:21:14
34063374,992335,163960786,9,Addressed.,898684674,2018-01-26 04:36:35
34063374,138807,163968940,25,"can we add a method that allows one to collect state associated with a streamlet's state, also I would like to return a meaningful data structure from these methods, maybe a map[String,Int] that corresponds with a status and a meaningful error message",898738032,2018-01-26 05:12:25
34069895,3201045,164027067,24,"How do you distinguish the case between 
- Normal running topology
- Topology in a partial state",898905945,2018-01-26 11:12:53
34069895,3200023,164036860,24,"if a topology has defn and executionState data, it is considered as ""running"", otherwise it is considered as ""not running"". This is the validation logic in RuntimeManager, and i updated the validateSubmit() called right above to follow the same condition ",898905945,2018-01-26 13:39:53
34087173,32022953,164188380,36,how is your proposal different from 'change 300 to 300/8',899188814,2018-01-27 02:36:21
34087173,3200023,164200001,36,"The issue here is for a bad stmgr, all connections are failing and it is more likely to be a local problem. with a global max attempt, stmgr doesn't need to wait per client failure count to reach 300. Because network failure can be very slow, bad stmgr te",899188814,2018-01-27 03:21:52
34087173,32022953,164200184,36,"cool, got it",899188814,2018-01-27 03:22:38
34087173,3200023,164201186,36,The PR is a simple demo and I don't really like this solution myself. I just think we need a check based on global view. Any ideas are welcome.,899188814,2018-01-27 03:26:38
34131189,3201045,164495454,6,@lucperkins - is this change ok?,900284996,2018-01-30 01:02:41
34131189,3201045,164495181,9,@joshfischer1108 - API can be used for topologies running as well in cluster - correct?,900284996,2018-01-30 01:01:51
34131189,3210939,164520350,6,"I will back this change out.  I had to do some tricky stuff to get the pages to build on my local.  I meant to revert this, it slipped my mind.  Good catch.  Thank you",900284996,2018-01-30 02:28:18
34131189,3210939,164520532,9,"@kramasamy Yes, just a typo error. I will fix ",900284996,2018-01-30 02:28:57
34147784,138807,166426981,21,can you add some comments here as to what this class actually does?,906244148,2018-02-07 04:03:51
34147784,138807,166426698,21,Is this annotation needed?,906244148,2018-02-07 04:02:49
34275173,992335,164848418,13,"Hi @nwangtw,

Thanks for working on this.

For long-term maintenance perspective, i think the following constants can help us when Scala version is upgraded with just small change (if makes sense)
```
scala_version = ""2.11""
scala_point_version = sc",903170925,2018-01-31 03:14:24
34275173,3200023,164987931,13,"Sounds good to me.

The lines are pretty much copy/paste from rules_scala. In Twitter we need them to be explicit so that we can redirect them. :( I am just testing if it works ok or not. It seems like Travis is happy now. I am going to update the numbe",903170925,2018-01-31 17:01:52
34298046,7235147,164960758,13,is this needed anymore?,903609004,2018-01-31 14:15:24
34298046,3201045,164960899,13,@cckellogg - you mean heron_tools_bin_files - probably leave it for now until we don't need it.,903609004,2018-01-31 14:17:07
34298046,7235147,164961482,13,Yes the heron_tools_bin_files it looks like the new one replaces it.,903609004,2018-01-31 14:22:47
34298046,3201045,164961572,13,yes for now - Let us leave the old one and remove it later.,903609004,2018-01-31 14:23:35
34298046,3201045,165217139,13,@cckellogg - we need both since one is used for heron binary packaging while the other is used for docker container.,903609004,2018-02-01 07:12:20
34346624,3201045,166784429,183,please remove the extra line,907548305,2018-02-08 06:59:05
34346624,3201045,166784950,47,LOG.info -  I am assuming that it prints information always during eco topology submission?,907548305,2018-02-08 07:01:36
34346624,3201045,166784345,158,Please remove the extra space.,907548305,2018-02-08 06:58:41
34346624,3201045,166784268,103,Please remove the extra line.,907548305,2018-02-08 06:58:21
34346624,3201045,166784477,185,same as before.,907548305,2018-02-08 06:59:17
34346624,3210939,166819512,47,"This will only print if someone submits a topology with a `--props` flag pointing to a  file.  If you want I can take this out.
",907548305,2018-02-08 10:42:42
34346624,3201045,167044194,47,It will be nice to print the highlevel steps that eco topologies do - during submission,907548305,2018-02-09 03:33:55
34346624,3210939,167047602,47,"@kramasamy Ok I will end some high level logging for each one of the steps.  I will do this after master comes back to a passing state.
",907548305,2018-02-09 03:46:24
34382174,4456654,165462066,19,call this container logs,905217468,2018-02-02 03:27:34
34386099,3200023,165487356,7,Suggest to add a comment here.,905285079,2018-02-02 05:05:58
34386099,32022953,165533584,7,added,905285079,2018-02-02 08:57:08
34432861,992335,165855415,16,"Apache Http Client test dependency requires `classifier` flag with `tests` value. To achieve this, `http_jar` support has been used.",905917886,2018-02-05 03:51:49
34432861,3201045,165855706,16,@erenavsarogullari - is it not possible to use maven jar?,905917886,2018-02-05 04:02:40
34432861,992335,165856415,16,"@kramasamy -  Thanks for review this. Currently, Bazel looks having an open PR to support `classifier` functionality. I have tried with `maven-jar` as well. Also, classifier is supported by Maven and Gradle. 
https://github.com/johnynek/bazel-deps/issues",905917886,2018-02-05 04:25:41
34476535,3201045,166442421,4,@huijunw - thanks for the PR - should we use the same algorithm for both?,906251701,2018-02-07 05:09:35
34476535,32022953,166444431,4,done,906251701,2018-02-07 05:16:25
34636483,1575030,167470046,21,installing -> running,913535897,2018-02-12 13:13:50
34636483,1575030,167470498,100,y -> by,913535897,2018-02-12 13:22:24
34642676,3201045,166799326,58,should we have something like /download/core rather /downloadcore,907539529,2018-02-08 08:20:07
34642676,3201045,166799091,1,Do we need this - if we are changing the config later in the same file?,907539529,2018-02-08 08:18:24
34642676,1575030,166800153,1,we are not changing it in the file.  The later config is commented an serves just as a reminder that user can do that as well,907539529,2018-02-08 08:24:54
34642676,1575030,166800554,58,I can make that change,907539529,2018-02-08 08:27:19
34691944,138807,167376245,50,"I see a pecularity in the java code that we should discuss, all the implemented Sink classes extend the StreamletOperator and all the classes like StreamletCloneTopology have inner classes that implement Sink<SomeClass>, take a look at this and just make ",908617986,2018-02-10 08:04:03
34691944,138807,167375281,24,should this also have the @SerialVersionUID annotation or not or is that only for classes,908617986,2018-02-10 07:55:21
34691944,992335,167442886,50,"Firstly, thanks for review.

High level Flow is as follows:
`Scala Streamlet API => [Java Streamlet API => Topology API]`

`ComplexSink, ConsumerSink and LogSink` are internal implementation used as adapter between Java Streamlet and Topology API. Cu",908617986,2018-02-12 01:40:22
34691944,992335,167442891,24,"It is required for `class/implementation` level because they keep the state. On the other hand, each interface can have multiple implementation and each of them should have its own `@SerialVersionUID`",908617986,2018-02-12 01:40:30
34878976,2183863,168635996,12,"2 minor comments:
1. Why pass the flag `running` in the constructor, rather than in the `Config runtime`?
2. Name the boolean as `isRunning` will be more expressive and more java style.
",917226664,2018-02-16 07:06:13
34878976,3200023,168640519,12,"Thanks!

For 1, ""config"" is for the topology configuration. running flag is not a config.
For 2, will do.",917226664,2018-02-16 07:30:06
34878976,2183863,168641766,12,OK Fair enough.,917226664,2018-02-16 07:37:33
34878976,3201045,168695941,25,Here the topology might not be in the running state?,918805509,2018-02-16 16:26:17
34878976,3200023,168835408,25,"""Running"" means there are both topology defn and execution state data.

If any of them is not available, it means the topology is not ""running"". This could be caused by a failed submit command or a failed kill command.

Like we discussed before, in th",918805509,2018-02-17 02:31:48
34878976,3200023,168835647,25,"And for all other commands, validation code shouldn't allow them to be executed. So in this line, isRunning flag should always be true.",918805509,2018-02-17 02:32:50
34878976,2183863,168896422,25,"Karthik mentioned a good point. `Running` can be confusing since we have used it already for topology state `Running`, `Paused`, etc.
Maybe we could rename it to `isExisting`?",918805509,2018-02-17 07:36:14
34878976,3200023,168904631,25,That is true. Let me think about it. Thanks.,918805509,2018-02-17 08:57:01
34878976,3201045,169002058,54,What is this message for?,919966905,2018-02-19 15:41:20
34878976,3201045,169002176,13,foundData - does not sound like a good name. Any other choices?,919966905,2018-02-19 15:42:36
34878976,3200023,169030142,54,"I think if topology data is not available, it is possible that the topology was not running.  The message ""Scheduler killed topology %s successfully.""  can be misleading. So I think in this case, ""scheduler has tried to clean up"" is more accurate.

",919966905,2018-02-19 18:07:11
34878976,3200023,169030399,13,"sigh.

Maosong suggested ""exist"" but I feel it is not good either. :(

This is a trick case and naming is tricky too.

",919966905,2018-02-19 18:08:08
34878976,3201045,169031073,13,"this data is all about executionState - is it correct? if so we can name it as
```
executionStateExists
```
will do?


",919966905,2018-02-19 18:11:09
34878976,3200023,169032347,13,"- dataFound
- topologyFound
- topologyExist
or reverse them:
- topologyNotFound
- topologyNotExist

Which one sounds better?",919966905,2018-02-19 18:16:11
34878976,3200023,169170898,13,"it is not only about executionState.

We got a report later that executionStateExists is available but definition is not. Basically none of them is safe.

This flag is from this logic:
Boolean isTopologyRunning = adaptor.isTopologyRunning(topologyNam",919966905,2018-02-20 05:00:18
34878976,3201045,169225450,13,"@nwangtw - this is not data. this is metadata actually. this is what we call executionState (it consists of logical, physical plan and additional information)",921964655,2018-02-20 14:22:18
34878976,3201045,169225651,13,"alternatively a better one is 

```
staleExecutionData
```
",921964655,2018-02-20 14:23:24
34878976,3200023,169239430,13,kk. sgtm. let me make the change.,921964655,2018-02-20 16:02:44
34878976,3200023,169241100,13,"It seems ""ExecutionState"" is a bit unclear here. One zk node is for ""ExecutionState"", the code is:

ExecutionEnvironment.ExecutionState executionState = adaptor.getExecutionState(topologyName);

I am going to use ""hasExecutionData"" in this function an",921964655,2018-02-20 16:12:29
34878976,3201045,170336524,89,@nwangtw - can you make this as a function?,922241443,2018-02-24 02:58:55
34878976,3200023,170337876,89,sounds good. let me do it.,922241443,2018-02-24 03:03:58
34878976,3201045,170356463,55,this message might not be misleading - since we are not killing the topology I think.,925703891,2018-02-24 04:14:14
34878976,3201045,170356790,13,"is this variable 

```
hasStaleExecutionData
```",925703891,2018-02-24 04:15:40
34915379,2183863,168050525,39,Need to think about whether to rollback the packing_plan on zk if failure happens.,916940220,2018-02-14 08:52:45
34915379,2183863,168051075,24,Need to check whether we successfully add containers.,916940220,2018-02-14 08:56:08
34915379,2183863,168050815,43,"Would be much better if we can print meaningful log to notify users when unrecoverable bad things happen, like:
```
Failing to update topology. The topology can be in a strange stage. Please check carefully or redeploy the topology.
```",916940220,2018-02-14 08:54:44
34915379,32022953,168162798,39,"There are two scenarios: recoverable and unrecoverable. Aurora may be in unknown state when it fails, resulting unrecoverable situation. ",916940220,2018-02-14 20:45:12
34915379,32022953,168162850,24,updated,916940220,2018-02-14 20:45:22
34915379,32022953,168165753,43,The update procedure may throw several exceptions which are hard to be differentiated in the upper function. I added the suggested print msg in the present exception msg.,916940220,2018-02-14 20:58:32
34915379,2183863,168388542,149,"We can simply get the env from `Context` (https://github.com/twitter/heron/blob/master/heron/spi/src/java/com/twitter/heron/spi/common/Context.java#L36). No need to ask Aurora Status.
",918073289,2018-02-15 14:25:41
34915379,2183863,168388233,148,I think this `check quota` logic should be at the upper level rather than at this level. i.e. in `AuroraScheduler.addContainers(...)`,918073289,2018-02-15 14:22:44
34915379,32022953,168389237,149,i do not think so. the aurora tier is not same with env in job spec key,918073289,2018-02-15 14:32:13
34915379,32022953,168395263,148,do you mean adding `check quota` to spi/scheduler interface,918073289,2018-02-15 15:24:48
34915379,2183863,168400227,148,"I mean, we can do this 
```
try {
      JsonNode jsonStatus = askAuroraStatus();
     ...
}
```
in `AuroraScheduler.addContainers(...)`",918073289,2018-02-15 15:59:19
34915379,2183863,168400744,149,"I mean, only when users try to update a topology in `prod` env, which can be parsed from the `Context`, we will try to `askAuroraQuota()`; we don't need the method `askAuroraStatus()`",918073289,2018-02-15 16:02:35
34915379,3200023,168401991,136,"This is not safe.

Although ""tier = preferred"" is the current config for production jobs,  I would expect that ""production: true"" is still being used in many other companies.

Also tier is customizable, so I think there is no safe way to check isProd(",918073289,2018-02-15 16:10:26
34915379,3200023,168399614,45,"Personally I feel this is a bit overkill.

Aurora does resource check for prod environment first and throw an error if there is no enough resource so try/catch should work although not perfect. It is definitely nice to have a pre-check to have more mean",918073289,2018-02-15 15:55:39
34915379,3200023,168400252,150,"I am afraid that this is not totally true. Dedicate cluster doesn't have quota requirements to start a cluster I think.

""Aurora requires resource quotas for production non-dedicated jobs. "" in
http://aurora.apache.org/documentation/latest/features/mul",918073289,2018-02-15 15:59:29
34915379,3200023,168397949,1,update year,918073289,2018-02-15 15:44:28
34915379,3200023,168404664,149,It is not a safe assumption.,918073289,2018-02-15 16:26:56
34915379,2183863,168409150,149,"@nwangtw it should be safe; this should be verified ahead to come to the actual update stage.
Furthermore, topology-name is unique for a cluster, so there will be not topologies with the same name in one cluster.",918073289,2018-02-15 16:50:24
34915379,32022953,168413438,136,"if we cannot know if topo is prod anyway, shall we use cluster/role/`env` to judge isProd() as maosong suggested previously. so that the code will be simple and stupid .. what do you think @maosongfu  @nwangtw ",918073289,2018-02-15 17:07:46
34915379,2183863,168415355,45,"I agree it is a bit overkill, if we are to use this implementation.

But the point is: it is pretty common that users forget requesting more resources and then fail with insufficient resources. It is a super bad experience.

Another thought is: before",918073289,2018-02-15 17:16:10
34915379,32022953,168419062,45,"If there is prompt, do we need this pr still? I assume user types Y and takes the risk",918073289,2018-02-15 17:30:31
34915379,3200023,168623693,136,the env value is less safe. :(  ,918073289,2018-02-16 06:08:58
34915379,3200023,168625262,45,"I agree with maosong that this is a quite common issue and we should see what we can do. I think a warning could be helpful for users to be aware of this issue. They are free to take the risk but it is our problem that they don't know the risk.

Ideally",918073289,2018-02-16 06:15:50
34915379,3200023,168626491,149,"I mean from aurora point of view.

From aurora doc it seems to me that environments are configurable. For example, inside Twitter we call it ""prod"" and in apache doc it is called ""production"".

Another one is that users might config their prod jobs to",918073289,2018-02-16 06:20:51
35026648,3200023,168683014,4,I am wondering if it is possible to move this check to RuntimeManagerRunner.java.,918882459,2018-02-16 14:25:40
35026648,3200023,168682150,14,looks like you dont need the space at the end of fmt.,918882459,2018-02-16 14:16:00
35026648,3200023,168682397,12,maybe rename to something like confirmWithUser(). How do you think?,918882459,2018-02-16 14:18:53
35026648,3200023,168681964,25,"I think it might be better to check ""y"" instead of ""n"". don't forget to update ""[Y/n]"" to ""[y/N]""",918882459,2018-02-16 14:13:48
35026648,3200023,168683451,6,"""Scheduler failed to add requested containers. Requested X, added Y. ...""",918882459,2018-02-16 14:30:16
35026648,3200023,168682115,17,"suggest: ""No console to prompt user. Proceeding.""",918882459,2018-02-16 14:15:33
35026648,3200023,168682725,42,maybe a warning to be more explicit,918882459,2018-02-16 14:22:45
35026648,3200023,168683296,4,This error message is declared and used in a few different places. Is it possible to clean it up?,918882459,2018-02-16 14:28:36
35026648,32022953,168690080,6,updated,918882459,2018-02-16 15:40:07
35026648,32022953,168690071,4,how to?,918882459,2018-02-16 15:40:01
35026648,32022953,168689986,12,updated,918882459,2018-02-16 15:39:17
35026648,32022953,168690016,17,updated,918882459,2018-02-16 15:39:32
35026648,32022953,168690032,25,updated,918882459,2018-02-16 15:39:38
35026648,32022953,168690037,42,updated,918882459,2018-02-16 15:39:43
35026648,32022953,168690158,4,"this file in schedulers directory, the others are in scheduler-core. what do you suggest?",918882459,2018-02-16 15:40:47
35026648,32022953,168690002,14,removed,918882459,2018-02-16 15:39:25
35026648,2183863,168689551,15,"In general, it is a bad idea to require a console to be assigned as this very much impacts the flexibility of your application. Many ways of invoking Java will not assign a console (i.e. `System.console()` returns null), and your application is unusable i",918882459,2018-02-16 15:35:32
35026648,2183863,168691264,41,"I would suggest having an option (can be overridden by `config-override`) to bypass the prompt so it is easier to invoke the `update` command in other scripts or process, like ci, Jenkins.",918882459,2018-02-16 15:50:07
35026648,2183863,168683502,18,Why not LOG.error(...)?,918882459,2018-02-16 14:31:04
35026648,32022953,168697769,15,updated,918882459,2018-02-16 16:38:29
35026648,32022953,168697801,18,gone with Console,918882459,2018-02-16 16:38:41
35026648,32022953,168697830,41,will do in another pr,918882459,2018-02-16 16:38:51
35026648,32022953,168912331,41,added the config to pass ci,918882459,2018-02-17 12:43:20
35026648,3200023,168918837,8,"The config name is not very straghtforward. Suggest to add a comment for it. Also include the values:
disabled => no prompt
prompt => enable prompt.
",919875844,2018-02-17 18:53:02
35026648,3200023,168918360,4,"The function addContainers() above the if statement is in AuroraCLIController, the code looks like:

public Set<Integer> addContainers(Integer count) {
  ....
  return extractContainerIds(stderr.toString());
}

You should be able to check container",918882459,2018-02-17 18:24:07
35026648,32022953,168919440,4,"i think this check is for all schedulers, not only for aurora , as suggested by maosong",918882459,2018-02-17 19:26:26
35026648,3200023,168919612,8,"still not very clear. How about let's do something like this:

// Prompt user when more containers are required so that user has another chance to double check quota is available. To enable it, change the config from ""disabled"" to ""prompt"".",919875844,2018-02-17 19:34:07
35026648,3200023,168919470,4,kk. that could be useful.,918882459,2018-02-17 19:27:43
35026648,32022953,168919872,8,updated,919875844,2018-02-17 19:46:40
35026648,3201045,168999439,17,Confirmation with the user should not be for all cases. If the user knows the behavior - it is annoying everytime to say yes/no - furthermore think about the fact that heron update is running in CI/CD - yes/no will not work very well.,919942338,2018-02-19 15:18:53
35026648,3201045,168999172,13,This code is in scheduler core - you cannot assume that it is aurora specific. It is used by other schedulers. Please change this,919942338,2018-02-19 15:16:09
35026648,3201045,169001332,17,This verification can be done at the cli level itself - rather than doing it in the core.,919942338,2018-02-19 15:36:04
35026648,3201045,169001444,54,Do you need this another warning?,919942338,2018-02-19 15:36:55
35026648,3201045,169004004,17,"furthermore, there is no way for the user to verify whether the resources are available. Resource checking should be automatic.",919942338,2018-02-19 15:55:29
35026648,32022953,169033865,54,"The user usually assumes the topology keeps same as before the command is issued, however, the topology may be in unknown state. This warning is explicitly to tell user the check the topology state.",919942338,2018-02-19 18:22:49
35026648,32022953,169033403,13,will remove `aurora`,919942338,2018-02-19 18:20:48
35026648,32022953,169033389,17,"There is a toggle switch for this prompt. The default value is off, no change to the existing behavior.",919942338,2018-02-19 18:20:43
35232857,138807,170487982,35,"It seems we are overriding the java Sink and plugging in our sink, however what happens if the sink is sufficiently complicated inside those methods, do we need to account for that",922839368,2018-02-26 11:35:23
35232857,138807,170488112,29,"what does this imply when we pass the javaStreamlet as an arg and have it listed with a colon, the notation is a bit confusing here, can you add some comments",922839368,2018-02-26 11:36:52
35232857,138807,170487819,23,"I think we need to make this object be general purpose for all of the scala traits to use, for the Builder stuff lets get this code review moving before I work more on that because I will add more to this function for the Builder stuff",922839368,2018-02-26 11:33:17
35232857,138807,169523965,20,"I am assuming this class can be used across the Streamlet API , is that assumption correct, where do you see this class being used?",922839368,2018-02-21 10:54:43
35232857,138807,169524088,23,"I see that you have a singleton object and a class, do we need both?",922839368,2018-02-21 10:55:52
35232857,992335,170768240,23,"`Builder` functions accept both `SerializableSupplier` and `Source`. You can use existing `toSerializableSupplier` for `SerializableSupplier`. For `Source`, `toJavaSource` function needs to be created as same as with existing `toJavaSink` function.",922839368,2018-02-27 07:14:48
35232857,992335,170770670,23,"Yes, this is `Scala Companion object` and object parts covers `static functions`. For example, `createSupplierStreamlet` function is static in `Java StreamletImpl` and used by its UTs.",922839368,2018-02-27 07:27:10
35232857,992335,170771137,29,"After related `user defined function` is applied(e.g: `map`), it will return `Java Streamlet` object type and this needs to be transformed to `Scala Streamlet `object type again before exposing the user so in order to achieve this, `toScalaStreamlet` func",922839368,2018-02-27 07:29:31
35232857,992335,170770398,35,"`Sink` exposes the following functions(`setup, put and cleanup`) as _public_ and other logics which are covered internally are managed and exposed to low level Topology API by these functions. (e.g: `com.twitter.heron.streamlet.impl.sinks.ComplexSink` jus",922839368,2018-02-27 07:25:40
35232857,992335,170767693,20,"`Builder, Streamlet, Source, Sink` Traits are the main interfaces for Scala API and `ScalaToJavaConverter` is common container for these traits.",922839368,2018-02-27 07:12:12
35232857,138807,171139226,23,Yes I was saying I would like this checked in so that I can add those functions that you are describing,922839368,2018-02-28 12:11:20
35297308,13649525,169863243,22," private static final String CONFIRMED_YES = ""y"";
,
return CONFIRMED_YES.equalsIgnoreCase(userInput);
",923933063,2018-02-22 14:18:08
35297308,13649525,169867894,31,"return null sometimes will cause an additional null check logic when using this method.
In the effective java design pattern, it should always avoid returning null.
Or you can return an empty object or initial the object at the very beginning.
ag, I do",923933063,2018-02-22 14:55:57
35297308,13649525,169867073,29,"try to avoid if else or if if, maybe single statement is a little bit clear. But I am not sure the entire logic, I could be wrong.

```
Boolean hasNotConfirmedWithUser = ""prompt"".equalsIgnoreCase(Context.updatePrompt(config)) && !hasConfirmedWithUser(c",923933063,2018-02-22 14:49:23
35297308,13649525,169863325,22,"```
private static final String CONFIRMED_YES = ""y"";
,
return CONFIRMED_YES.equalsIgnoreCase(userInput);
```",923933063,2018-02-22 14:18:50
35297308,13649525,169863595,13,"I'd prefer to use the name pattern like ""hasConfirmedWithUser(int newContainerCount )"", but it is up to you",923933063,2018-02-22 14:20:59
35297308,32022953,170007143,22,updated,923933063,2018-02-23 00:05:51
35297308,32022953,170007214,29,updated,923933063,2018-02-23 00:06:02
35297308,32022953,170007247,31,updated,923933063,2018-02-23 00:06:08
35297308,32022953,170007182,13,updated,923933063,2018-02-23 00:05:56
35404319,3200023,170401725,5,"why ""if parsed_args.jvm_remote_debugger_ports""? typo?",925904018,2018-02-24 08:47:47
35404319,3200023,170401827,6,do we need a default value?,925904018,2018-02-24 08:48:49
35404319,32022953,170407349,5,"typo, updated",925904018,2018-02-24 10:21:40
35404319,32022953,170407338,6,there is a default value in Key.java,925904018,2018-02-24 10:21:29
35431950,3201045,171083595,84,@erenavsarogullari - instead of forward slash - can you use Java Path class - to keep it more generic?,926636200,2018-02-28 06:09:29
35431950,992335,171108036,84,"Sure, will be addressing.",926636200,2018-02-28 08:05:05
35433838,3201045,173613850,227,"Spelling mistake - it should be ""topology id""",938023451,2018-03-10 14:40:32
35433838,3201045,173613825,83,@nwangtw - why is the validation code removed?,938023451,2018-03-10 14:38:54
35433838,3200023,173617090,227,"This is not a typo. 'topologyid' is the URL argument. The original error is:

LOG(ERROR) << ""topologyid not specified in the request"";

Let me add '' around it to be more readable.",938023451,2018-03-10 17:28:27
35433838,3200023,173617038,83,"Ah. Good call.

I refactored the common validations into a function and call it from all handlers. I must have missed this one. Thanks!",938023451,2018-03-10 17:26:16
35433838,10216235,173899820,66,why the check comp->has_config?,941765376,2018-03-13 01:23:37
35433838,10216235,173899857,74,same as above,941765376,2018-03-13 01:23:45
35433838,10216235,173900128,95,all new code should use std::string. sp_string is legacy,941765376,2018-03-13 01:24:38
35433838,10216235,173900961,156,HandleUpdateRuntimeConfigRequest,941765376,2018-03-13 01:27:13
35433838,10216235,173901037,197,tmaster_->UpdateRuntimeConfigTopology,941765376,2018-03-13 01:27:30
35433838,3200023,173983514,66,"so that in case user has a typo, topology can reject the request.",941765376,2018-03-13 07:05:34
35433838,3200023,173983552,95,got it. will do.,941765376,2018-03-13 07:05:51
35433838,10216235,173995961,66,"If I read the code correctly, if a particular component doest not have a comp specific configuration initially, I wont be able to add something specific there. Why this limitation?",941765376,2018-03-13 08:42:04
35433838,3200023,174020272,66,"Yeah. That is correct. This check is just for protection. I am open for other thoughts.

Here are a few cases,
- the topology has a config topology.config.1, and user can use command line tool to update the value. in case there is a typo like topolog.c",941765376,2018-03-13 12:31:26
35433838,3200023,174020464,197,I am going to use UpdateRuntimeConfig for this one.,941765376,2018-03-13 12:33:09
35433838,3200023,174028894,66,"On the other hand, we can skip the check and leave all runtime configs pass through. In addition to user mistakes, there might be some unused configs and it could be harder to track them.",941765376,2018-03-13 13:45:16
35522992,7235147,170778349,38,Should we add a static util method isNotEmpty()?,928497107,2018-02-27 08:10:06
35522992,1575030,170778518,38,sure,928497107,2018-02-27 08:11:07
35522992,1575030,170779486,38,"done
",928497107,2018-02-27 08:16:03
35522992,13649525,170786008,38,"Duplicate code found here, better to have a method to reduce the code

getResponseByFile(String filePath)
```
  public Response downloadFile(final @PathParam(""file"") String file) {
    Config config = createConfig();
    String uploadDir = config.ge",928497107,2018-02-27 08:54:56
35522992,1575030,170786696,38,@fred521 thanks for point that out I have refactored the code,928497107,2018-02-27 08:59:11
35587329,3200023,171141189,50,"two questions:
1. is modifying the list at the time expected? If not, maybe a more proper fix is to solve issue in the appending code?
2. will some exit tasks and tasks on wake up being missed with copyOnWrite list?",929694856,2018-02-28 12:32:17
35587329,2183863,171145879,17,"WakeableLooper is designed not to be thread-safe; concurrent scenarios should be handled in outer logic.

If the purpose of this pull request is to support thread-safety, using this concurrent structure is not safe enough, if thinking this from an appli",929694856,2018-02-28 13:21:39
35587329,2183863,171147130,50,"IIRC, previously we could only add a task to such kind of `tasks-list` when executing tasks from it, but we could not remove a task.

On the other hand, WakeableLooper is designed not to be thread-safe; so it should be executed with only one thread.",929694856,2018-02-28 13:34:18
35587329,2183863,171148285,17,"Also, if the purpose is to avoid task-removal during execution, why not find out such code snippets and correct them?",929694856,2018-02-28 13:45:36
35587329,1575030,171149665,17,"@maosongfu The code snippet of the task that clears the tasksOnWakeup list:

https://github.com/twitter/heron/blob/master/heron/instance/src/java/com/twitter/heron/instance/Slave.java#L113


Has to do with restoring state.",929694856,2018-02-28 13:58:26
35587329,3200023,171402998,24,"I would suggest checking == 0, like

for (int i = 0; i < s; i ++) {
      exitTasks.get(i).run();
      // in case previous task cleared the list
      if (exitTasks.size() == 0) {
        break;
      }
}		    

Another qq, no tasks would be ad",930614062,2018-03-01 06:14:12
35587329,1575030,171475852,24,Though is checking tasksOnWakeup.size() <= i more defensive programming?  With this check an index out of bounds exception cannot happen while for some reason or another not all the tasks are cleared you can get into a situation where i > list size causin,930614062,2018-03-01 14:57:05
35587329,2183863,171480329,113,"Based on the comment above: `We pre-get the size to avoid execute the tasks added during execution`

Will we encounter the scenario: remove a task and then add a task -> we would execute the tasks added during this round of execution? Otherwise, not sur",930966038,2018-03-01 15:33:44
35587329,1575030,171485410,113,This won't happen during the state restore since I just add the locks which will prevent new tasks from being add during the state restore.  And its only during the state restore that we clear the tasks,930966038,2018-03-01 16:08:34
35587329,3200023,171939875,24,"it is more defensive, but confusing mathematically.

In fact I dont like either of them because it is not ideal to check the size an array when it can change.

Another option is to change the interface:
task.run() should return a boolean value indica",930614062,2018-03-03 03:25:32
35587329,3200023,171939840,113,"I think we need to answer two questions beforehand:
- where the tasks are added?
- when can tasks be added?",930966038,2018-03-03 03:25:22
35587329,3200023,171940999,24,"It seems that it is possible and allowed to add new tasks when the array is being executed. :(

but i think the new tasks added by the tasks before restore should be cleared too. So the clear() call is still correct.",930614062,2018-03-03 03:29:52
35587329,3200023,171943702,61,"QQ: Can tasks be added by other thread?

If they can, then there might be a racing condition.
the existing tasks are being cleared, and a new package is received and some tasks might be added. A lock flag is not enough and we have to sync up the two th",931551907,2018-03-03 03:39:47
35587329,3200023,171942410,13,"If we want to use this lock, it needs to be an atomicBoolean, or needs to be volatile.

my concern is that simple boolean might have code cache and can be inconsistent between threads.",931551907,2018-03-03 03:34:56
35587329,3200023,172456909,13,"maybe better for the two flags to be initialized in constructor?

Another suggest is to rename to clearTasksOnWakeupFlag to avoid variable and function sharing the same name. Maybe not a big deal. Your call.",933679269,2018-03-06 17:34:55
35587329,3200023,172454459,58,"is it guaranteed that the clear() function is called in the same thread? the concern is that if the clear() function is called in a different thread, it might be called after the if() check and you can still get the wrong index error. Since this object mi",933679269,2018-03-06 17:25:57
35587329,1575030,172639915,58,"I have checked all code paths.  Ya I can confirm clear() is always called from the same thread.  I don't know how we can make nExit, executeTasksOnWakeup, clearTasksOnWakeup and clearExitTasks synchronized.  This would give rise to deadlock situations sin",933679269,2018-03-07 03:54:21
35587329,3200023,172655652,58,I was thinking of simply adding synchronized keyword to these functions. I believe Java synchronized blocks in Java are reentrant so it is not a deadlock.,933679269,2018-03-07 04:52:06
35587329,1575030,172658581,58,"I see what you are saying, but should we add them? It gives a developer the sense that these operations are thread safe now.  Should we even allow that in the architecture.  I think that is a bigger discussion. I can't think of a use case for that now.  I",933679269,2018-03-07 05:02:41
35587329,1575030,172658642,13,I have renamed,933679269,2018-03-07 05:02:53
35587329,2183863,172674623,13,"Can we add comments for `terminateAllTasksOnWakeup ` and `terminateAllExitTasks `? Though I can understand them after I go through the code, it is still better to have more comments.",936399889,2018-03-07 05:59:26
35587329,2183863,172675664,28,"Can you remove this comment (and similar comments below), and add comments at the head to declare:
1. Most methods except the `onExit()` are not thread-safe.
2. People should handle the concurrent scenarios in their business logic rather than in this cl",936399889,2018-03-07 06:03:13
35735476,3201045,173614122,75,just use component_parallelism instead of component_parallelisms,940095405,2018-03-10 14:57:07
35735476,3201045,173614048,87,use vector<string> and no need to allocate memory.,940095405,2018-03-10 14:52:27
35735476,3201045,173613981,46,@nwangtw - what happens if both the update component parallelism and also user run time config is provided simultaneously.,940095405,2018-03-10 14:48:20
35735476,3201045,173614143,36,leave it as component_name - so that it is informative.,940095405,2018-03-10 14:58:37
35735476,3201045,173614176,46,This seems to be the case across the board.,940095405,2018-03-10 15:00:04
35748258,3200023,171990097,13,"? why not import them? SerializablePredicate, SerializableConsumer, Sink, Context?",932715691,2018-03-03 07:38:47
35748258,3200023,171990374,26,import,932715691,2018-03-03 07:40:47
35748258,992335,172063481,13,"@nwangtw Firstly, thanks for the review.

Updated by using multi import. Just an exceptional point here: Scala API supports own `Sink Trait` via `com.twitter.heron.streamlet.scala` package so `toJavaSink` function needs to have Java Sink package definit",932715691,2018-03-05 04:35:57
35748258,992335,172063494,26,Addressed.,932715691,2018-03-05 04:36:19
35748258,3200023,172425361,44,use import to avoid full path,934184236,2018-03-06 15:06:22
35748258,3200023,172425769,24,"Ideally we should support this syntax.

.map[String] { num: Double =>
  (num * 10).toString
}

Not a blocker for now. We can add this support in the next version.",934184236,2018-03-06 15:09:18
35748258,3200023,172425861,34,Clean up the full package path com.twitter.heron.streamlet.impl.streamlets,934184236,2018-03-06 15:10:05
35882110,3200023,172747287,91,to import,935378871,2018-03-07 13:55:30
35882110,3200023,172747238,12,to import,935378871,2018-03-07 13:55:03
35882110,3200023,172747272,73,to import,935378871,2018-03-07 13:55:22
35882110,3200023,172747268,69,to import,935378871,2018-03-07 13:55:17
35882110,3200023,172747279,88,to import,935378871,2018-03-07 13:55:26
35882110,138807,172975432,23,why was this change needed,936971220,2018-03-08 04:32:48
35882110,138807,172975717,32,can this become an perf issue if the number of clones are high?,936971220,2018-03-08 04:33:54
35882110,992335,173312425,23,"Scala Functions support `contravariant`(parameter type) and `covariance`(return type) type parameters as default as follows :

From `scala.Function1` source code:
```
trait Function1[-T1, +R] extends scala.AnyRef {
 this : scala.Function1[T1, R] =>
",936971220,2018-03-09 06:26:36
35882110,992335,173312678,32,"Currently, there is no limitation about the `number of clones` and `number of partitions`. I think limitation can be useful as long-term by getting team-agreement first and putting Java tier.",936971220,2018-03-09 06:27:47
35882110,3200023,173615253,24,"suggest to rename to fromJavaStreamlet(). The current class is streamlet.scala.impl. StreamletImpl, so I feel fromJavaStreamlet() makes more sense.",939870870,2018-03-10 15:56:53
35882110,992335,173638045,24,@nwangtw Thanks again for the review. Addressed.,939870870,2018-03-11 07:17:06
35983758,3200023,173038862,30,Just want to double check. I think the new build targets are heron.tar.gz and heron-install.sh and I am wondering if these lines need to be updated as well.,937268594,2018-03-08 09:25:39
35983758,3201045,173613782,30,@ajorgensen - yes we have only heron.tar.gz and heron-install.sh -- please update the PR.,937268594,2018-03-10 14:36:05
36006656,3200023,172997846,46,no need for the full path,937629654,2018-03-08 05:55:50
36006656,3200023,172997726,54,no need for the full path,937629654,2018-03-08 05:55:21
36006656,3200023,172997498,59,no need for the full path,937629654,2018-03-08 05:54:28
36006656,992335,173001105,54,@nwangtw Thanks for the review. Scala API has own `SerializabLeTransformer` and `Sink` Traits. They need to be transformed to their Java versions before passing to Java API. This class covers this transformation functions and same named classes living in ,937629654,2018-03-08 06:07:53
36006656,992335,173305318,54,"@nwangtw Thanks for the comment. Yep, alias make sense and addressed with new commit.",937629654,2018-03-09 05:59:11
36006656,3200023,173039665,54,"I see.

I think you may consider using alias like:

import com.twitter.heron.streamlet.{SerializableTransformer => JavaSerializableTransformer}
import com.twitter.heron.streamlet.scala.SerializableTransformer

",937629654,2018-03-08 09:30:32
36067013,3200023,173284028,38,"add ""@return""",938669483,2018-03-09 04:40:49
36067013,3200023,173285155,39,"""override def get()"" to be consistent",938669483,2018-03-09 04:45:17
36067013,3200023,173283855,49,maybe better parameter name,938669483,2018-03-09 04:40:04
36067013,3200023,173286595,68,test data generation as well.,938669483,2018-03-09 04:50:40
36067013,3200023,173285187,38,"""override def get()"" to be consistent",938669483,2018-03-09 04:45:23
36067013,3200023,173286416,61,test data generation as well.,938669483,2018-03-09 04:50:01
36067013,3200023,173286837,78,"""override def get()"" to be consistent",938669483,2018-03-09 04:51:35
36067013,3200023,173285374,44,clean up empty lines,938669483,2018-03-09 04:46:03
36067013,3200023,173284836,33,to remove or to implement?,938669483,2018-03-09 04:43:58
36067013,3200023,173284529,17,"suggest to use import alias.

import com.twitter.heron.streamlet.{Source => JavaSource}",938669483,2018-03-09 04:42:46
36067013,3200023,173284294,21,"""scala.collection.JavaConverters."" is not necessary.",938669483,2018-03-09 04:41:52
36067013,3200023,173285693,26,use import alias.,938669483,2018-03-09 04:47:20
36067013,3200023,173283897,46,this is expected?,938669483,2018-03-09 04:40:14
36067013,3200023,173285429,28,??,938669483,2018-03-09 04:46:13
36067013,3200023,173285846,28,"This function name ""toScalaStreamlet"" seems to be a bit misleading. ""fromJavaStreamlet"" might be better?",938669483,2018-03-09 04:47:53
36067013,138807,173301172,39,Done,938669483,2018-03-09 05:43:49
36067013,138807,173302272,49,"sourceFn stands for source function, what better name were you thinking about?",938669483,2018-03-09 05:47:47
36067013,138807,173301230,44,Done,938669483,2018-03-09 05:44:03
36067013,138807,173302390,21,"It is actually, I noticed that I was getting compilation errors if I didnt include this even though I had the appropriate import statement",938669483,2018-03-09 05:48:13
36067013,138807,173301055,28,I removed this class as its no longer needed,938669483,2018-03-09 05:43:24
36067013,138807,173302717,17,"I will leave it as is, this is a nice to have that I can put in once we make deeper changes, right now lets focus on getting Builder operational",938669483,2018-03-09 05:49:25
36067013,138807,173302764,26,See my comment above,938669483,2018-03-09 05:49:35
36067013,138807,173303035,61,"Done, see newest checkin",938669483,2018-03-09 05:50:43
36067013,138807,173303085,68,"Done as well, see newest checkin",938669483,2018-03-09 05:50:58
36067013,138807,173302989,33,Removed,938669483,2018-03-09 05:50:32
36067013,138807,173303106,78,Done,938669483,2018-03-09 05:51:04
36067013,138807,173304240,28,Will rename in a later commit,938669483,2018-03-09 05:55:09
36067013,3201045,173490839,28,@nwangtw - if the intention is to convert to - toScalaStreamlet - that will be fine.,938669483,2018-03-10 00:01:27
36067013,3201045,173491083,21,@skanjila - any idea why the compilation errors occurred?,938669483,2018-03-10 00:02:21
36067013,138807,173524710,28,Yes that is indeed the intention,938669483,2018-03-10 02:09:16
36067013,138807,173526681,21,I will dig into that issue on the next commit,938669483,2018-03-10 02:17:52
36067013,992335,173549539,26,"Scala Builder needs to pass Java Builder instance via constructor as follows. 
```
object Builder {
  def newBuilder(): Builder =
    new BuilderImpl(com.twitter.heron.streamlet.Builder.newBuilder())
}
```",939662608,2018-03-10 03:45:30
36067013,138807,173551128,26,"actually it doesnt , if you look at the overridden methods they dont use the java builder object at all , instead they create a Java source and/or supplier object and convert that to a scala streamlet, I dont see an immediate value to using the Java Build",939662608,2018-03-10 03:52:03
36067013,992335,173550074,17,"Currently, Java Source is accepted and return type Java Streamlet. However, this is Scala Builder Trait so `Java Source` and `Streamlet` should not be `return types` so following import needs to be removed.
```
import com.twitter.heron.streamlet.{Source",939662608,2018-03-10 03:47:50
36067013,992335,173551623,5,"This is Scala Streamlet Trait and return types are itself(Scala Streamlet), not Java one so `Streamlet` needs to be removed.  ",939662608,2018-03-10 03:54:09
36067013,992335,173555429,22,"BuilderImpl level, we need to call Java Builder `` functions. Currently, Java BuilderImpl creates a `List<StreamletImpl<?>> sources` and keeps `Sources, Transformations and Sink` to build `topology` so this is why important and for example, this function ",939744520,2018-03-10 04:10:04
36067013,992335,173553904,20,"`BuilderImpl` needs to get `Java Builder` via constructor as follows.
```
BuilderImpl(builder: com.twitter.heron.streamlet.Builder)
```",939744520,2018-03-10 04:03:25
36067013,992335,173558943,28,"Yep, this function transform `Java Streamlet` to `Scala Streamlet` version so why its naming convention is `toScalaSource`. Also, it is same convention what Scala currently has (i.e: `toList`, `toMap` etc..) ",938669483,2018-03-10 04:25:49
36067013,138807,173569206,5,Removed,939662608,2018-03-10 05:12:56
36067013,138807,173569280,22,Changed for both methods to leverage java builder,939744520,2018-03-10 05:13:14
36067013,138807,173572648,20,Changed,939744520,2018-03-10 05:28:17
36067013,138807,173572675,22,Changed,939744520,2018-03-10 05:28:23
36067013,3200023,173615506,53,Function signature doesn't match comment.,939801234,2018-03-10 16:08:44
36067013,3200023,173615574,21,"hmm. interesting. another note is that ""asJavaCollectionConverter(...).asJavaCollection"" looks a bit strange. from function name, it seems asJavaCollectionConverter(...) should return a Java collection, hence the following asJavaCollection looks a bit con",938669483,2018-03-10 16:12:34
36067013,3200023,173615532,18,Please use import alias instead of full path,939801234,2018-03-10 16:10:03
36067013,3200023,173615433,28,"Suggest to use alias,

import com.twitter.heron.streamlet.{Builder => JavaBuilder}
...
    new BuilderImpl(JavaBuilder.newBuilder())
",939801234,2018-03-10 16:06:22
36067013,3200023,173615609,20,Suggest to use import alias,939801234,2018-03-10 16:14:49
36067013,3200023,173615626,40,description seems to be wrong.,939801234,2018-03-10 16:15:57
36067013,3200023,173615634,19,sort imports,939801234,2018-03-10 16:16:23
36067013,138807,173827988,21,"I believe this just takes an input collection and converts it to a Java collection, again I will dig into this as well on the next commit to simplify this, here's the issue I created to track the import alias issue and this: https://github.com/twitter/her",938669483,2018-03-12 22:02:33
36133104,13649525,173861647,113,"Curious why you not using java-> java.util.concurrent.atomic.AtomicLong package, it is thread safe with better performance.

synchronized with the method which makes the code single thread only even there are multiple threads running.

",939937133,2018-03-12 23:32:48
36133104,3200023,173883708,114,missing incr()?,939937133,2018-03-13 00:36:13
36133104,3200023,173883777,122,missing incr()?,939937133,2018-03-13 00:36:25
36133104,3200023,173884050,137,"Might be safer to be in this order?

looper.exitLoop();
metricsMgrClient.stop();
outMetricsQueues.clear();",939937133,2018-03-13 00:37:13
36133104,3200023,173883747,118,missing incr()?,939937133,2018-03-13 00:36:19
36133104,3200023,173618005,4,sort,939937133,2018-03-10 18:12:45
36133104,32022953,173926939,4,done,939937133,2018-03-13 02:56:15
36133104,32022953,173926977,118,done,939937133,2018-03-13 02:56:24
36133104,32022953,173926961,114,done,939937133,2018-03-13 02:56:20
36133104,32022953,173927002,122,done,939937133,2018-03-13 02:56:29
36133104,32022953,173927028,137,done,939937133,2018-03-13 02:56:36
36133104,32022953,173927354,113,"I just wanted to reuse the existing CountMetric, however CountMetric does not have atomic interface",939937133,2018-03-13 02:57:48
36434694,1575030,174996783,18,"do we need .replace(""="", ""&equals;"")) here?  All the ""="" would already be replaced by the previous replace statement right?",946352594,2018-03-16 11:45:34
36434694,1575030,174996845,8,"can we add a comment on why we need to replace ""="" for future reference",946352594,2018-03-16 11:46:35
36434694,3200023,174997196,18,"right. Technically it is not really necessary.

I left it here to be consistent with the decoding path and easier (just a little) for people to understand. In future we can remove both of them at the same time.",946352594,2018-03-16 11:50:45
36434694,1575030,174997344,18,gotcha can we just add some comments at the places this is done for future reference.  Thanks!,946352594,2018-03-16 11:52:25
36434694,1575030,174997370,18,or maybe a TODO for the future,946352594,2018-03-16 11:52:43
36434694,3200023,174998272,8,Sure. added.,946352594,2018-03-16 12:00:01
36434694,3200023,175020614,18,"Thinking about it again. Now I don't think leaving the encoding part here is very helpful. Plus it looks wrong and could cause more confusion. I am removing this replace() call in the new update.

It is also easier to tell that the decode() part is for ",946352594,2018-03-16 15:16:02
36536375,3200023,175311058,11,sort,948713906,2018-03-19 07:14:00
36536375,3200023,175311081,29,remove ths empty line,948713906,2018-03-19 07:14:49
36536375,3200023,175311073,15,clean up?,948713906,2018-03-19 07:14:32
36642809,1575030,175918357,5,why are we doing this?,951054975,2018-03-21 03:52:14
36642809,1575030,175918392,5,how can index but less than 0?,951054975,2018-03-21 03:52:25
36642809,10216235,175947366,5,"hashCode can return negative numbers. % according to spec can be negative if dividend is negative(it really is implementation specific, but looks like atleast some versions of jvm return negative).",951054975,2018-03-21 05:52:06
36642809,3200023,175992592,5,"First of all, what is the impact? This could cause crashing? or bad results?

This line is a bit redundant. Just notes, not a blocker.

(index + taskIds.size()) % taskIds.size()
or 
if (index) {
  index = index + taskIds.size();
}

should be eno",951054975,2018-03-21 13:34:28
36642809,10216235,176083423,5,"The issue is that if index is negative, list.get(index) fails.",951054975,2018-03-21 20:39:50
36642809,1575030,176528003,5,"Math.abs(hash). This can also give you negative numbers when hash is bigger than 2^31, and the best way would be to use a shift mask (key.hashCode() & 0x7fffffff) % M, where M is the table size.",951054975,2018-03-23 01:30:02
36642809,3200023,176873377,5,"Math.abs(hash) can give negative result? Sounds strange to me.

bitmask is dangerous because it assumes the var is 32 bits. In case someone changed the data type it can cause other problem.",951054975,2018-03-24 04:54:39
36705458,3200023,176316314,31,do we need to add the same logic in c++ and python?,952305078,2018-03-22 13:08:38
36705458,10216235,176527674,31,"@nwangtw Good catch!
It looks like python already does this but c++ doesn't. I've added that logic as well.",952305078,2018-03-23 01:29:18
36714857,6377806,176483802,12,"Is this statement accurate: all instances of a component together will get this amount of RAM, be default? For e.g. if a comp C has instance i1 and i2 and default RAM is 2 GB, i1 will be assigned 1GB of ram.

On the other hand, if this is instance defau",952752045,2018-03-22 23:22:06
36714857,3201045,176509025,12,@ashvina - this default is for all instances for a particular topology. if your instance needs more memory - you can override using setComponentRam - which is the next PR that will be coming up. ,952752045,2018-03-23 00:35:26
36714857,3200023,176516333,12,"yeah. the existing ones, instance.cpu, etc are heron internal configs for all topologies
the new ones here, component.default.cpu, etc are for users to set/config for all instances in each topology.
the future ones will be for each component.",952752045,2018-03-23 00:56:07
36714857,6377806,176522592,12,"@kramasamy @nwangtw 
I am a bit confused. 
1. The config name is `COMPONENT_DEFAULT`, but it is use to configure `INSTANCE_DEFAULT`. Should this be renamed? 
1. Why are we replacing existing configs for cpu and disk, `heron.resources.instance.cpu` and ",952752045,2018-03-23 01:14:30
36714857,3200023,176538282,12,"1. It is a good question. I think both makes sense, in a different way. If you consider the next step, per component resource config, component_default makes more sense. If you consider that all instances are using the config as default value, instance_de",952752045,2018-03-23 02:03:19
36764208,3200023,176522007,13,I am wondering if the change in this file is expected/needed in this PR. it seems unrelated and looks a little strange.,953303634,2018-03-23 01:12:53
36764208,3201045,176522367,13,good catch it is not needed.,953303634,2018-03-23 01:13:53
36764208,3201045,176553435,13,"@nwangtw - i need to take my comment back. this is needed to ensure all linux variants are grouped under one target which is k8 - otherwise, it is ubuntu, centos and more variations.",953303634,2018-03-23 02:56:40
36764208,3200023,176560503,13,I see. So now k8 is considered as a platform? A little unclear but not a blocker to me.,953303634,2018-03-23 03:22:32
36783555,3201045,176913650,6,@jerrypeng - is this needed for 'nomad' direct deployment?,954659961,2018-03-24 23:31:54
36783555,1575030,176915464,6,no this is for API server,954659961,2018-03-25 00:47:16
36783555,3201045,176915497,6,ok got it - let us fix the CI and merge it.,954659961,2018-03-25 00:48:32
36931193,3200023,177167920,70,"not effecient. Why not just use:
case x if (x >=0 && x <= 99) => x / 20 + 1
case _ => throw",957012782,2018-03-27 00:14:30
36931193,3200023,177166671,25,use default arguments directly,957012782,2018-03-27 00:10:07
36931193,3200023,177167460,46,Same as above. Suggest to break the pipe to two steps.,957012782,2018-03-27 00:12:48
36931193,3200023,177168049,48,same as above.,957012782,2018-03-27 00:14:56
36931193,3200023,177167260,72,"suggest to break this code into two steps to be more readable
1. create musicSource1
2. musicSource1.filter(...).....",957012782,2018-03-27 00:12:02
36931193,992335,177377542,25,`Kryo` needs explicit defined `no-arg constructor` for Serialization so this has been added for it,957012782,2018-03-27 17:27:58
36931193,3200023,177605801,72,suggest to move this above musicSource2. :)  not a blocker,957806553,2018-03-28 06:53:19
36931193,3200023,177605721,25,got it. kk then.,957012782,2018-03-28 06:52:45
36932748,1575030,177838312,31,Thanks for adding these checks.  We need to add these checks all around in Heron.  We currently lack any sort of organized config validation,957048218,2018-03-29 00:58:56
36932748,992335,177840781,31,"@jerrypeng Yes, exactly. Thanks for review ;)",957048218,2018-03-29 01:06:55
36932748,1575030,177844285,31,"I created a config validation system using annotations in storm back in the day:

https://github.com/apache/storm/blob/master/storm-client/src/jvm/org/apache/storm/Config.java

Perhaps worthwhile to think if its worth while to have in Heron.  Though i",957048218,2018-03-29 01:18:35
37020599,7235147,177911021,4,"what about no short name or ""rc""? 

Also instead of doing a list you can do something like this
final Option property = Option.builder(""rc"")
        .argName(""comp:property=value"")
        .numberOfArgs(2)
        .valueSeparator()
        .desc(""u",958834838,2018-03-29 05:40:30
37020599,3200023,177918851,4,sounds good! Didn't even thinking about two characters. :D,958834838,2018-03-29 06:29:12
37020599,3200023,177919598,4,"We do want to keep the current format though to be consistent to component_parallelism.

[comp:]<name>:<value>,[comp:]<name>:<value>,.....

The number of component can be infinity, not really 2.

This is the argument for scheduler, not the CLI argum",958834838,2018-03-29 06:34:57
44733978,10141051,213173063,5,"nitpick: why did you remove `__attribute__((const))` from this function, but not from `TLSLogChannelApplicationDefault()` just below ?  don't they both return references to `NSString * const` internally?",1114653160,2018-08-28 10:08:27
44733978,2011749,213352262,5,"So, the issue is that `TLSLogLevelToString` was updated to provide a debug string when an invalid level is provided which is dynamically created (not const) and thus if you provide an invalid level you risk crashing from compiler optimization.  It's super",1114653160,2018-08-28 22:04:49
16015651,6636815,73751304,41,do we want to explicitly mention how long we should wait after a +1 (so that other committers can take a look?),487306849,2016-08-06 03:02:55
16015651,622449,73752526,41,"Maybe it's up to the first committer that reviews? If all they say is +1, then I think it's ready to go. But if they say +1 for me but maybe `<person>` should take a look, then you should wait some amount of time. We could say 3 business days.",487306849,2016-08-06 03:13:39
16015651,6636815,73753354,41,Yeah I guess I was getting at the scenario where the committer might not explicitly mention one of the other committers to review. Might be a good idea to mandate waiting a day or two (unless its an urgent fix) to ensure in case anyone else has concerns t,487306849,2016-08-06 03:20:22
16015651,622449,73764369,41,"Anyone else want to weigh in? We could do 1 business day? I don't think we've done this in the past though, so I don't know if we need to introduce a new rule?",487306849,2016-08-06 04:47:33
16015651,7111,73771775,41,"reverts are not expensive. If we don't have a problem, maybe bias to speed?",487306849,2016-08-06 06:11:28
16015651,622449,73773089,41,"Yeah, I agree. We can always revert if there's further discussion needed. And the committer who +1s should mention if further discussion is needed before +1-ing ",487306849,2016-08-06 06:30:18
16015651,6636815,73773582,41,Yeah sounds good.,487306849,2016-08-06 06:37:15
18742741,2215690,87632540,5,what exactly is the change here from master?,554203089,2016-11-12 02:15:36
18742741,438579,87633030,5,"```
However, we also provides `NullableNode`
```

to:

```
However, we also provide `NullableNode`
```",554203089,2016-11-12 02:18:44
18742741,2215690,87636851,5,"thanks, missed that",554203089,2016-11-12 02:43:40
34178836,2215690,164327110,32,can you align indents with existing style?,901185983,2018-01-29 10:47:15
34178836,2003669,164333513,32,"My bad, IntelliJ decided to be fancy.  
Updated the pull request.",901185983,2018-01-29 12:11:51
34178836,2215690,164346275,69,same for this function also,901462858,2018-01-29 14:51:19
34178836,2215690,164346207,62,"some lines are too long now, please keep below 120 chars per line",901462858,2018-01-29 14:50:43
34178836,2003669,164476854,62,Done.,901462858,2018-01-30 00:04:29
34178836,2003669,164476883,69,Done,901462858,2018-01-30 00:04:36
17622182,360007,82287632,4,"in addition to MAX_RECOMMENDATION_RESULTS, could we have DEFAULT_RECOMMENDATION_RESULTS set to 100 so that we don't have to return this many results all the time?",525344906,2016-10-07 04:19:32
17622182,12105170,82290243,4,"Added DEFAULT_RECOMMENDATION_RESULTS too. DEFAULT_RECOMMENDATION_RESULTS is used in TopSecondDegreeByCount algorithm, in which the maxResults is a Map and it is possible that client does not set the value for the corresponding recommendation type. In othe",525344906,2016-10-07 04:32:57
18050425,12105170,84364748,38,"I wonder if you need to include com.twitter.common.metrics in the dependency. Before open sourcing GraphJet, we spend a lot of effort removing twitter metrics library from GraphJet library, and I do not see it is being used in graphjet-adapter.",537503897,2016-10-21 03:04:46
18050425,12105170,84390529,8,it is 1.0.4-SNAPSHOT now in master.,538491540,2016-10-21 05:41:21
18051100,12105170,84098650,41,"The majority of the candidates will have one social proof in one social proof type. You probably need to loop through the social proof before hand to get the sum of undedup social proofs. If this is smaller than the threshold, then no need to use HashSet ",537508195,2016-10-19 22:33:47
18051100,12105170,84165916,65,"could you change the flag name from keep to lessThan in this file and initialize it to true at the start? At the end of the function, we will return lessThan instead of !keep. I started to use keep as the flag name, and I realize now it was a mistake. My ",537603760,2016-10-20 04:00:32
18051100,12105170,84165149,41,initialize it to 0.,537603760,2016-10-20 03:56:46
18051100,12105170,84187310,24,change comments,537678936,2016-10-20 06:15:25
18051100,12105170,84188029,75,socialProof.get(2) ?,537686058,2016-10-20 06:22:58
18051100,2880538,84188973,75,"As discussed offline, we now have edge types, so I want to add both of them on the map corresponding to element indexed at 1",537686058,2016-10-20 06:31:31
18051100,12105170,83970623,23,could you add the new argument in the original request constructor? and clients can assign socialProofTypeUnions to emptySet if it is None in the thrift request. adding a new constructor for each new argument will be hard to maintain later on. ,537189328,2016-10-19 06:14:44
18051100,2880538,83971087,23,I was only worried that this introduces a backwards-incompatible change and that everyone who uses this request needs to update their code when this goes out. What do you think?,537189328,2016-10-19 06:18:41
18051100,12105170,83973223,23,"We have only one client which uses this request AFAIK, so this should be Okay.",537189328,2016-10-19 06:36:51
18051100,12105170,83975388,34,it is better to avoid autoboxing and unboxing whenever we can. Prefer LongOpenHashSet which stores primitive long directly instead of Long object.,537189326,2016-10-19 06:55:50
18051100,12105170,83976289,35,"this method will be called for every candidate of each request. Say each host receives 1000 requests per second, and each request generates 500 candidates. The current implementation will create at least 500K HashSet objects. assuming all hash set objects",537189326,2016-10-19 07:04:10
18051100,2880538,83978458,35,"Awesome suggestions. Thanks for the feedback!

1) I will use LongOpenHashSet as opposed to a regular HashSet.
2) I will break out of both for-loops as soon as the size >= minUserSocialProofSize. This means that the LongOpenHashSet for each candidate wi",537189326,2016-10-19 07:24:58
18051100,2880538,83980229,35,4) Only generate one LongOpenHashSet per call and avoid creating any other unneccessary variables,537189326,2016-10-19 07:45:14
18051100,2880538,84166507,65,hehe. Will do!,537603760,2016-10-20 04:03:22
18051100,2880538,84217852,27,"Good observation! As a matter of fact, I think this is true throughout this file and probably a better and cleaner pattern!

Can you please update all the occurrences in this file along your other changes?",537686058,2016-10-20 13:10:43
18051100,12243029,84216022,46,"Same here, we can directly return from the for loop to avoid a dummy variable",537686058,2016-10-20 12:45:55
18051100,12243029,84216869,89,Same here,537686058,2016-10-20 12:57:39
18051100,12243029,84216309,59,"Same here, we can return the method from for loop. Would be nice if we could start a boolean type method with ""is***"", to keep it consistent with other methods",537686058,2016-10-20 12:50:39
18148133,8460311,85047850,53,Have we talked about having a way for the graph to expose all nodes via an iterator (cc @aneeshs @jerryjiangabc) ? The only way for you to call this on an actual dynamic (non test) graph is to keep track of all nodes ever added and if some of them drop ou,540456042,2016-10-26 11:28:31
18148133,8460311,85044834,111,line length,540456042,2016-10-26 10:40:18
18148133,8460311,85047725,27,Can we have the iteration formula somewhere here? (also line length < 100),540456042,2016-10-26 11:26:11
18148133,8460311,85048175,106,"Not awesome that it requires a double cast, but gotta unbox I guess..",540456042,2016-10-26 11:35:14
18148133,8460311,85048505,40,I think I missed it - why does it need to be Atomic?,540456042,2016-10-26 11:41:01
18148133,8460311,85048103,53,"Also - for this to work, do all ids need to sequentially take up ids 0-maxId and fit within max integer? That is, in the case of (snowflake) userIds which are not sequential but rather hashed into the space of longs does this not work?",540456042,2016-10-26 11:33:41
18148133,8460311,85046496,305,typo 'sur',540456042,2016-10-26 11:06:29
18148133,8460311,85047862,53,maxNodesId to maxNodeId?,540456042,2016-10-26 11:28:45
18148133,8460311,85044597,53,move dampingFactor to keep line < 100 ?,540456042,2016-10-26 10:36:26
18148133,8460311,85043926,32,Just to make sure - we don't plan to implement this algo for InIndexedDIrectedGraph?,540456042,2016-10-26 10:26:11
18148133,8460311,85048914,76,Atomic because..? Not seeing where multiple threads will touch this. I don't think any of the algorithms use atomics since they're just using the (snapshot consistent) graphjet api to run all computations on a single thread..,540456042,2016-10-26 11:48:30
18148133,88368,85103931,27,"For PageRank, seriously? :)

For a lesser-known algorithm, I'll agree, but I think everyone knows what PageRank is... and if you don't, you probably have no business with GraphJet.
",540456042,2016-10-26 18:46:22
18148133,88368,85103957,32,That is correct.,540456042,2016-10-26 18:46:37
18148133,88368,85104034,40,"You are correct. After this I'm planning to implement multi-threaded PageRank, which *does* need it. Jumping the gun a bit.",540456042,2016-10-26 18:47:16
18148133,88368,85104297,53,k,540456042,2016-10-26 18:49:04
18148133,88368,85104366,53,"See https://github.com/twitter/GraphJet/issues/10
",540456042,2016-10-26 18:49:35
18148133,88368,85104517,53,"That is correct. I've already described this in the top-level documentation of the class, but probably worth elaborating.
",540456042,2016-10-26 18:50:36
18148133,88368,85104545,76,will fix.,540456042,2016-10-26 18:50:47
18148133,88368,85104605,106,Correct.,540456042,2016-10-26 18:51:07
18148133,360007,85448862,27,"Sorry I'm a bit confused about the model here: for running pagerank, are we assuming that the graph has a fixed set of nodes? How about edges? The reason I want to clarify this is that this will determine the API to GraphJet.",543853720,2016-10-28 06:33:47
18187814,2880538,83968580,96,"It might make sense to refactor this into a function in GeneratorUtils, since it is similarly used in the User Generator",541479641,2016-10-19 05:58:53
18187814,2880538,83968905,15,I would rename this file into TopSecondDegreeByCountRecsGeneratorHelper,541479641,2016-10-19 06:01:30
18187814,2880538,83969554,40,"Again, similar logic exists in the other generator, so it's worth refactoring",541479641,2016-10-19 06:06:54
18188512,12105170,84775767,141,recordIntermediateStats  -> updateAlgorithmStats,541491244,2016-10-25 03:27:15
18188512,12105170,84752515,10,TopSecondDegreeByCount algorithm?,541491244,2016-10-25 01:30:02
18188512,12105170,84759080,46,"to achieve parity with TopSecondDegreeByCountTweetRecsGenerator, here it should be RecommendationRequest.MAX_RECOMMENDATION_RESULTS, which 1000.

Also, max 100 is too low for some clients who want to query user-user graph for relevant signals. ",541491244,2016-10-25 01:59:15
18188512,12105170,84752282,35,use consistent comment about query id as it is in TopSecondDegreeByCountRequestForTweet ,541491244,2016-10-25 01:28:59
18188512,12105170,84751818,39,"consistent comment as the base class, TopSecondDegreeByCountRequest. In TopSecondDegreeByCountRequest, it is the number of social proof types in the graph.",541491244,2016-10-25 01:26:52
18188512,12105170,84759544,154,"you do not need to pass class variable, such as visitedRightNodes, around in class methods",541491244,2016-10-25 02:01:34
18188512,12105170,84756649,4,could you change TopSecondDegreeByCountTweetMetadataRecsGenerator to query this field instead of TopSecondDegreeByCountTweetMetadataRecsGenerator.MIN_USER_SOCIAL_PROOF_SIZE,541491244,2016-10-25 01:48:35
18188512,2880538,84760315,1,"I see that the path of this file has .../Request/... 

All folders should start with lower case: Request -> request",541491244,2016-10-25 02:05:39
18188512,2880538,84759038,35,"Probably better to initialize it on line 29 above, since it is not passed as a variable through the constructor.",541491244,2016-10-25 01:59:04
18188512,2880538,84778895,123,"1) One variable per line.

2) I know there is some conflict between style guide and GraphJet code base, but I would keep the indentation to 2 spaces everywhere. ",541491244,2016-10-25 03:42:56
18188512,2880538,84762674,53,"(Optional)

... whose edges ""are incident"" to the RHS nodes. (as a more appropriate graph theory terminology)",541491244,2016-10-25 02:17:43
18188512,2880538,84780160,219,I suggest going through all the changes in the RB and update the indentation to 2 spaces for consistency ,541491244,2016-10-25 03:49:05
18188512,2880538,84766687,77,This can go in the GeneratorHelper as a function that accepts a RecommendationType,541491244,2016-10-25 02:40:26
18188512,2880538,84759886,84,Indentation should be 2 spaces,541491244,2016-10-25 02:03:27
18188512,2880538,84762182,1,I think every single file needs to have this comment on the top. Go through all the modified files and make sure it's there,541491244,2016-10-25 02:14:57
18188512,2880538,84777704,10,Update/Remove the comment as necessary,541491244,2016-10-25 03:36:57
18188512,2880538,84766257,32,Remove empty line,541491244,2016-10-25 02:37:59
18188512,2880538,84766657,52,This can go in the GeneratorHelper as a function that accepts a RecommendationType,541491244,2016-10-25 02:40:16
18188512,2880538,84781921,15,Make this an Object ,541491244,2016-10-25 03:58:09
18188512,2880538,84766306,37,"Add empty line before ""return results""",541491244,2016-10-25 02:38:18
18188512,2880538,84764438,161,Accidental space?,541491244,2016-10-25 02:27:38
18188512,2880538,84761766,53,space before resultFilterChain,541491244,2016-10-25 02:13:08
18188512,2880538,84765463,237,Accidental space?,541491244,2016-10-25 02:33:29
18188512,2880538,84767410,282,Thanks for updating all these functions! Much cleaner! :),541491244,2016-10-25 02:44:34
18188512,2880538,84765364,210,"You can keep the ""if (edgeIterator != null) {"" logic as it used to be. The less unnecessary changes the easier to review :)",541491244,2016-10-25 02:32:56
18188512,2880538,84766013,6,Fix,541491244,2016-10-25 02:36:31
18188512,2880538,84764630,140,Why do we need to pass the class variables as arguments to these functions?,541491244,2016-10-25 02:28:49
18188512,12243029,84790173,210,"Personally, I favor guard conditions than nested if. Breaking the original format doesn't necessarily make the code harder to read but actually easier imo, because it conveys the same logic while avoiding a layer nesting. If this makes the code hard to re",541491244,2016-10-25 04:41:54
18188512,12243029,84790328,123,Fixed. Agreed with Jerry we will use 2 space across the codebase,541491244,2016-10-25 04:42:49
18188512,12243029,84790574,53,Thanks! Didn't know that word before,541491244,2016-10-25 04:44:11
18188512,2880538,84800779,210,"Ah, yes! I agree with your comment. What I meant is that the review is harder to read with all the changes. The code is readable both ways :)",541491244,2016-10-25 05:52:27
18188512,2880538,84808316,31,"You should consider using the Singleton pattern: https://www.tutorialspoint.com/java/java_using_singleton.htm
which is equivalent to Scala Object",541682276,2016-10-25 06:58:32
18188512,2880538,84812103,85,Indentation,541682276,2016-10-25 07:36:10
18188512,2880538,84808657,130,Remove the visitedRightNodes from these two functions as well,541682276,2016-10-25 07:01:28
18188512,12105170,84975481,79,threshold,541717936,2016-10-26 01:55:47
18188512,12105170,84975945,71,change qualified to valid everywhere,541717936,2016-10-26 01:57:45
18188512,12105170,84975732,65,"in recommendation team's repositories, we prefer to user the term Valid instead of Qualified to refer to those candidates passing all filters.",541717936,2016-10-26 01:56:53
18188512,12105170,84972612,67,"even if we initialize all the states, we can not run TopSecondDegreeByCount because it is an abstract class, right?",541717936,2016-10-26 01:43:11
18188512,12105170,84972138,37,"in this abstract class, we do not need to list every concrete class implementing it. otherwise every time we add a concrete class, we have to change the comment in the abstract class too.",541717936,2016-10-26 01:41:01
18188512,12105170,84980566,31,"1. public final class
2. add private constructor ",541717936,2016-10-26 02:22:01
18188512,12105170,84979890,256,"curious why you add ""this"" reference before all class variables?",541717936,2016-10-26 02:18:04
18188512,12105170,84980724,31,This class should be public final and have a private constructor.,541682276,2016-10-26 02:22:47
18188512,12105170,84980386,25,this private constructor and the final class ensure that it will not be instantiated or subclassed by anyone. could you add it back?,541717936,2016-10-26 02:21:04
18188512,12105170,84981298,49,"Twitter enforces 100 character limit per line for java, and this line looks to me exceeding the limit? you might need to rename the variable.",541717936,2016-10-26 02:25:31
18188512,8460311,84984157,49,"We should add checkstyle to the project to catch these - I think we've probably introduced some style issues, but I can take a crack at cleaning it up..",541717936,2016-10-26 02:40:57
18188512,88368,84984912,49,"For the record, I *hate* checkstyle because it's so damn inflexible. Sometimes breaking formatting runs makes code more readable. A classic example is something like:

```
a = a very long assignment
b = another very long assignment
c = yet another ve",541717936,2016-10-26 02:45:01
18188512,8460311,84995104,49,"Yeah, definitely see your point. On the other hand reviews may get filled up with line length, import ordering and spacing issues, and that too with imperfect recall. Happy to defer to others' sensibilities though",541717936,2016-10-26 03:36:22
18188512,12243029,84997886,37,You're right! This was a typo. Fixed,541717936,2016-10-26 03:50:07
18188512,12243029,84998380,67,"Correct, this is another typo. Sorry I forgot to remove some of the premature comments I made during dev. I will address all the ones you pointed out. Thanks!",541717936,2016-10-26 03:52:48
18188512,12243029,84997593,256,"Now it looks like a poor choice, but here's my reasoning: 
I wanted to make clear to the inheriting class that the variables they modify are class variables, which are shared. One problem I faced when designing the parent class interface is the ambiguity",541717936,2016-10-26 03:48:32
18314280,360007,87680625,48,"note that reducing #segments and increasing edges/segment will likely help boost performance --- in the limit, a single segment should not be too much slower than cassovary (it still does a number of hash lookups)",544870570,2016-11-12 08:42:55
18314280,360007,87680647,120,"can store a reuse a ""(byte) 1"" variable",544870570,2016-11-12 08:43:36
18314280,88368,87698517,48,"Yes, once I get everything merged to master I will start playing with the parameters.
",544870570,2016-11-13 03:17:52
18314280,88368,87698518,120,done.,544870570,2016-11-13 03:17:57
18314280,360007,87736888,69,"Note that if a client reuses this function, the behavior is somewhat strange: the top-k items are already pulled out, but some of them could be reinserted so at that point it won't be top (k+1, 2k) either. If you'd like to make this reusable, then you'd p",544870570,2016-11-14 12:23:10
18314280,360007,87736970,69,"Sorry, I just noticed that you actually empty out the queue. In that case, the behavior is easier to define but still keep some of the above in mind...",544870570,2016-11-14 12:25:48
18314280,360007,87680409,69,"might want to make entries final as computing it mutates the queue so this function should be ""compute once"".",544870570,2016-11-12 08:39:21
18314280,88368,87698502,69,"Added `final`, but I'm not sure about this method being limited to ""compute once"". In theory, a client could use it, get top *k*, keep throwing more stuff on it, and call top *k* again?",544870570,2016-11-13 03:17:05
18352023,360007,87741339,214,"sorry, i'm possibly not following how the multi-threaded implementation is working --- isn't it possible (indeed likely) for multiple threads to try and update the same node at one time? If so, getAndAdd is insufficient as all the weight is not guaranteed",544867979,2016-11-14 13:53:01
18352023,360007,87741399,30,could you please add some more details on how synchronization will work with the multi-threading version?,544867979,2016-11-14 13:54:10
18352023,88368,88058099,30,"Added some comments. Let me know if you need any more details.

The short version is that we use atomic doubles so that it's okay that multiple thread are trying to updated the PageRank vector.
",544867979,2016-11-16 00:42:44
18352023,360007,88072765,225,"[i'm hallucinating that i commented on this before, but trying again]

sorry, i'm not sure i understand this bit --- CAS will ensure that if multiple threads try to update the nbr weight then only one will succeed, but others will fail. since you move o",556767785,2016-11-16 01:48:58
18352023,88368,88074702,225,"See: https://google.github.io/guava/releases/19.0/api/docs/com/google/common/util/concurrent/AtomicDoubleArray.html#getAndAdd(int, double)

Check out implementation:
https://github.com/google/guava/blob/master/guava/src/com/google/common/util/concurren",556767785,2016-11-16 01:58:07
18352023,360007,88085170,225,"ah, very cool! thanks for the pointer; i didn't realize the guava implementation had a loop in there already.

There is no conflict in terms of value fidelity here, but one thing to be cognizant of is that in pagerank we'd update values for high degree ",556767785,2016-11-16 02:47:57
18352023,88368,88096149,225,"Yes, that's true - hubs will get a lot of CAS contention, so we should not expect linear speedup.

Good to shipit?",556767785,2016-11-16 03:39:33
18496672,6597183,86430055,36,nit: space before return,548084621,2016-11-04 02:58:59
18860704,12105170,88556955,5,creationTimeInMillis,558397730,2016-11-18 06:01:57
18860704,12105170,88557026,34,getCreationTimeInMillis,558397730,2016-11-18 06:02:22
18860704,12105170,88555557,12,"it is preferable to pass minimum necessary information to another function. in this case, instead of passing the entire request, you can pass only the timestamp.",558397730,2016-11-18 05:55:00
18860704,12105170,88560932,22,"""segment"" is an implementation detail, and it is better not expose it through the interface. you can name the interface  method as getCurrentEdgeEngagementTime().",558397730,2016-11-18 06:24:00
18860704,12105170,88562685,23,"in RecentTweetFilter.java, there is similar functionality. clients pass a variable called keepWithInLastXMillis, and the tweet creation time is compared against (System.currentTimeMillis() - keepWithInLastXMillis). in that implementation, the client only ",558397730,2016-11-18 06:34:50
18860704,12105170,88734860,21,keepSocialProofsWithinTime => maxEdgeEngagementAgeInMillis,558623836,2016-11-19 04:38:30
18860704,12105170,88734375,16,edgeLastEngagedTime => edgeEngagementTime; the term last seems to suggest there are multiple engagement times for one edge.,558623836,2016-11-19 04:35:36
18860704,12105170,88733281,5,update comments,558623836,2016-11-19 04:28:11
18860704,12105170,88734690,27,getCurrentEdgeEngagementTime  => getCurrentEdgeEngagementTimeInMillis,558623836,2016-11-19 04:37:29
18860704,12105170,88735328,12,"this function name can be more specific, e.g. isEdgeEngagementWithinAgeLimit",558623836,2016-11-19 04:41:23
18860704,12105170,89188521,9,"return true if this edge is within the max age limit, false otherwise.",560422544,2016-11-23 03:10:59
18860704,12105170,89191757,13,"for the first argument, prefer passing in maxEdgeEngagementAgeInMillis instead of request.
for the second argument, prefer passing in currentEdgeEngagementTimeInMillis instead of edgeIterator.


",560422544,2016-11-23 03:26:54
18860704,12105170,89191023,8,"engagement time of the current edge -> the engagement time of the current edge. 

for an individual edge, there is only one engagement time.",560422544,2016-11-23 03:23:13
18860704,12105170,89188797,4,"no need to mention node info here, as it is not used in this function.
Just say
Return whether the edge is within the age limit which is specified in the request.",560422544,2016-11-23 03:12:22
18860704,12105170,89191978,2,Add a java doc for the interface.,560422544,2016-11-23 03:28:06
18860704,12243029,89220470,13,"It is hard to achieve this when the parent class abstracts the knowledge of TimestampeEdgeIterator. This method is shared between user and tweet recommendations, but for now the tweet side bipartite graph does not implement timestamps, so in the parent cl",560422544,2016-11-23 06:05:58
18870068,12243029,88329337,30,"In the original implementation, we were passed a byte array of social proof types. Here we use the index as social proof types instead, but I think it is unsafe. For example, validSocialProofs could be {0, 2} whereas their indices are 0, 1, respectively. ",557045777,2016-11-17 04:59:42
18870068,12243029,88329931,30,"In the original implementation, we were passed a byte array of social proof types. Here we use the index as social proof types instead, but I think it is unsafe. For example, validSocialProofs could be {0, 2} whereas their indices are 0, 1, respectively. ",557045777,2016-11-17 05:03:12
18870068,12243029,88520981,30,Understood. Thanks for explaining the reasoning.,557045777,2016-11-18 02:57:02
18870068,2880538,88351480,30,"1) Check how the array socialProofs is created in algorithms/NodeInfo.java. Basically, it's an array initialized to a size of maxSocialProofTypeSize=10 and the indices of the array correspond to the edgeTypes == socialProofTypes.

2) The way I refactore",557045777,2016-11-17 07:01:10
18888748,360007,90055130,92,would be good to explain in a comment why the double casting is required,557468169,2016-11-30 01:03:09
18888748,360007,90054926,107,space around - ,557468169,2016-11-30 01:02:19
19309127,360007,90739805,7,"The javadoc for this class says that there is no get function, so perhaps add a warning in the doc for this function to discourage wider use since it scans linearly.",568777497,2016-12-03 07:46:37
19309127,360007,90739905,4,is the function of this to make the references to bytes more transparent?,568777497,2016-12-03 07:47:40
19309127,2880538,90942903,7,"Thanks for catching that. Also, the function is ""constant"" time, since it either scans linearly at most 8 entries or it does a set lookup if the size is more than 8.",568777497,2016-12-06 03:56:09
19309127,2880538,90942943,4,"Yes. But, as discussed offline, better to keep the code as it was.",568777497,2016-12-06 03:56:26
19309127,360007,90972319,4,AUTHOR_SOCIAL_PROOF_TYPE ?,571654055,2016-12-06 06:38:55
19309127,360007,90972213,8,please change these to use a list as we talked about.,571654055,2016-12-06 06:38:19
20307874,12105170,95488618,31,authoredByUsers  => tweetAuthors?,594961156,2017-01-11 08:21:06
20307874,12105170,95488490,27,authoredByUsersNodes  => authoredTweets?,594961156,2017-01-11 08:20:00
20307874,12105170,95488253,26,AuthoredByUsersFilter => TweetAuthorFilter?,594961156,2017-01-11 08:17:44
20334650,2880538,95705602,26,"There is a similar type of filtering (but not exactly the same functionality) provided by SocialProofTypesFilter. I am not sure if this filter is used in the ResultFilterChain for the User request, but it's worth checking. 

For the Tweet request, we do",595647150,2017-01-12 08:43:28
20334650,2880538,95704077,55,What does this name mean? Might need to add a comment or improve the naming,595647150,2017-01-12 08:30:01
20334650,2880538,95704529,27,No space before : ,595647150,2017-01-12 08:33:52
20334650,2880538,95703707,85,Remove empty line,595647150,2017-01-12 08:26:52
20334650,2880538,95703879,5,"1) It might be a good time to split this file. Probably keep this one for generic testing and also add one for Tweet and one for User. I want block this change, but maybe a follow up just to refactor the Test files?

2) Rename to onlyUseSpecifiedProofTy",595647150,2017-01-12 08:28:17
20334650,12243029,95861336,5,"1. Yes I agree! Updated.
2. Redundant variable. Removed. Thanks for noticing",595647150,2017-01-13 03:05:25
20334650,12243029,95861392,55,Updated!,595647150,2017-01-13 03:05:39
20334650,12243029,95862401,26,"Right, this filtering is different from the SocialProofTypesFilter. In User recs, the desired behavior is only specified social proof types are qualified to be counted into the weights, and this filter function does exactly the job of taking away unspecif",595647150,2017-01-13 03:10:20
20334650,12105170,96551466,40,"it is better not to pass request inside updateNodeInfo function. 

another implementation alternative is to follow the original pattern of isEdgeEngagementWithinAgeLimit. It was outside of updateNodeInfo. how about creating a new, more generic function ",599693298,2017-01-18 09:31:21
20334650,12105170,96550753,15,"prefer it.unimi.dsi.fastutil over java.util library.
interface: Set<Byte> => ByteSet
implementation: HashSet<Byte> => ByteOpenHashSet",599693298,2017-01-18 09:24:42
21233956,12243029,100611709,2,2017*,613782115,2017-02-11 03:54:32
21233956,12243029,100613461,27,"I like that you're adding context to clarify the usage, but I'm not sure if this is relevant to explain this reuses common code. Could you provide some context to what you're trying to explain? Also *its*",613782115,2017-02-11 04:03:40
21233956,12243029,100615664,51,"I'm a bit concerned about overriding a method that is already implemented. For example, in this implementation:
MultiSegmentIterator. findNextSegmentForNode() 
vs 
MultiSegmentReverseIterator. findNextSegmentForNode() will result in 2 different behavio",613782115,2017-02-11 04:15:48
21233956,12105170,100860301,51,second this.,613782115,2017-02-14 02:19:53
21233956,12105170,101806229,17,public => protected,620074031,2017-02-18 01:31:43
21233956,12105170,101810870,40,"A more complicated test case is to create a randomly generated graph and compare the results of two iterators, which should be the exactly same. in the test case, it is better to check edge order across different segments as well as edge order within the ",620074031,2017-02-18 01:56:11
21233956,12105170,101807464,28,is this function needed? can we remove it?,620074031,2017-02-18 01:38:21
21233956,12105170,101805809,23,reverse chronological => chronological,620074031,2017-02-18 01:29:15
21233956,12105170,101808458,19,"in the previous super.resetForNote(node), in addition to rebuildSegmentIteratorsForNode, there are other logics such as
currentSegmentId = oldestSegmentId;
initializeCurrentSegmentIterator();

do you intend to remove them?",620074031,2017-02-18 01:43:25
21233956,2880538,101828007,28,With the current implementation of having the abstract function in the MultiSegmentIterator we need to implement it in the Random Iterator as well. I am open to better refactoring suggestions though,620074031,2017-02-18 03:20:55
21233956,2880538,101825255,19,Correct. In the Random Iterator these are not used and they were unnecessarily called.,620074031,2017-02-18 03:06:46
21653878,12105170,103285813,25,could you add more comments to describe the behavior here? it is better to use an example instead of the high-level description.,631831748,2017-02-28 03:10:21
21653878,12105170,103290979,1,"could you move this MockEdgeTypeMask to graphjet-core/src/test/java/com/twitter/graphjet/bipartite/segment? There is another one there already HigherBitsEdgeTypeMask.

Also, please add copyRight statement here too.",631831748,2017-02-28 03:32:00
21653878,12105170,103289986,32,"why add the extra hasAuthors variable?
it looks like we just need to check !authoredTweets.isEmpty() && !authoredTweets.contains(resultNode);",631831748,2017-02-28 03:27:55
21653878,12105170,103287348,23,"consistent comment style with other concrete filters? for example
This filter keeps the nodes with the exact number of user social proofs equal to the parameter of the query, no more, no less. ",631831748,2017-02-28 03:16:41
21653878,12243029,103300182,32,"The behavior here is actually a bit different. When initializing this Filter, we check for all the tweets authored by a list of authors, and toss them into a list called authoredTweets.
If we don't specify a list of authors in the beginning, it means we ",631831748,2017-02-28 04:10:39
21653878,12105170,103305169,32,"I see, thanks for explaining! then what about !tweetAuthors.isEmpty && !authoredTweets.contains(resultNode)?",631831748,2017-02-28 04:34:12
21653878,12243029,103319047,32,"That's exactly what the boolean variable does, i.e. to preserve whether authors are empty. tweetAuthors only exists in the scope of the object constructor, so we must have some sort of additional variable to store this information.",631831748,2017-02-28 05:40:15
21653878,12105170,103335603,30,resultFilterSet => resultFilterList,633677997,2017-02-28 07:01:28
22055296,12243029,104544053,38,"Here you actually mean the tweet author social proof, correct?",639089798,2017-03-07 06:45:08
22055296,12243029,104544519,35,"nit: In this generator class, we've opted for returning true/false directly, instead of using a conditional variable. Probably should keep the style consistent unless there's a good use case here",639089798,2017-03-07 06:47:42
22055296,12105170,104551847,38,Changed.,639089798,2017-03-07 07:27:24
22055296,12105170,104551822,35,Fixed,639089798,2017-03-07 07:27:14
22672281,12243029,107961925,27,This can be made private,650722095,2017-03-25 00:47:12
22672281,12243029,107964548,58,nit: remove extra space,650722095,2017-03-25 00:58:43
22672281,12105170,108022607,44,MomentRecommendationInfo,650924472,2017-03-25 07:44:17
22891615,12105170,109007190,4,this function is being called hundreds of thousand times a second. this additional object creation will be roughly 1M bytes per second. why not use static function? or at least this should be a class variable?,658045285,2017-03-31 01:49:02
22891615,12105170,109007538,4,"ditto, static or class variable.",658045285,2017-03-31 01:50:33
22891615,12243029,109004940,24,Explicitly declare visibility of the function,658045285,2017-03-31 01:40:04
22891615,12243029,108999073,4,"Same, better to change it to a class field",658045285,2017-03-31 01:16:08
22891615,12243029,108997158,20,+ @Override ,658045285,2017-03-31 01:08:11
22891615,12243029,109003965,24,Seems there is no use case for this class either,658045285,2017-03-31 01:36:13
22891615,12243029,109004701,19,Looks like it's only used for Moments. Rename to MomentsIDMask?,658045285,2017-03-31 01:39:12
22891615,12243029,108997089,20,Could you copy the original description of id masks here? Easier to tell the usage of this class especially when it only contains a simple function,658045285,2017-03-31 01:07:50
22891615,12243029,109001582,24,"hmm, don't see this being used anywhere other than test.",658045285,2017-03-31 01:26:43
22891615,12243029,109005053,18,@Override,658045285,2017-03-31 01:40:25
22891615,12243029,108998791,4,We can move this to be a class field,658045285,2017-03-31 01:14:55
22891615,2880538,109050670,4,Fixed,658045285,2017-03-31 05:14:52
22891615,2880538,109050681,4,Fixed,658045285,2017-03-31 05:14:58
22891615,2880538,109051516,20,Done,658045285,2017-03-31 05:20:26
22891615,2880538,109051648,19,"Right now it's only used for Moments, but I will keep it generic for any other entity that is not using masks to encode information into the IDs (for example, URLs, Users etc)",658045285,2017-03-31 05:21:08
22891615,2880538,109051872,20,Fixed,658045285,2017-03-31 05:22:35
22891615,2880538,109051972,18,Fixed,658045285,2017-03-31 05:23:07
22891615,12105170,109204799,4,consistent usage of field modifiers. ,658974483,2017-03-31 23:59:09
22891615,12105170,109207238,4,consistent usage of variable modifiers. ,658974483,2017-04-01 00:12:13
22891615,12105170,109204508,9,"if you declare TweetIDMask as final, declare every other IDMask implementation as final too.",658974483,2017-03-31 23:57:37
22891615,12105170,109206147,110,"I prefer the original variable name, connectingUsers",658974483,2017-04-01 00:06:29
22891615,12105170,109206467,77,inputIds => inputRightNodeIds,658974483,2017-04-01 00:08:07
22891615,12105170,109205875,100,the weight of a rightNode => the weight of the rightNode.,658974483,2017-04-01 00:04:59
22891615,12105170,109204307,4,"capitalize static variable. also, it is better to make it final static to clearly show it is a global constant.",658974483,2017-03-31 23:56:32
22891615,2880538,109253286,110,Fixed,658974483,2017-04-01 04:25:11
22891615,2880538,109253189,4,Fixed,658974483,2017-04-01 04:24:33
22891615,2880538,109253244,4,Updated everywhere to be private static final,658974483,2017-04-01 04:24:53
22891615,2880538,109253116,9,Updated the other implementation to be final,658974483,2017-04-01 04:24:05
22891615,12243029,109269287,9,Curious about the benefit of declaring the masks final?,658974483,2017-04-01 07:02:11
22891615,12243029,109269743,2,nit: 2017,659703390,2017-04-01 07:09:21
22891615,2880538,109295347,9,"Mostly maintaining the existing behavior, but the main thing about declaring final classes is to show that they should not be extended, which makes sense in this case. You should only extend IDMask, but not extend the subclasses in any way.",658974483,2017-04-02 05:06:25
22891615,2880538,109295356,2,Fixed,659703390,2017-04-02 05:06:59
22891615,12105170,109478989,4,"this is java, so the static final field should be TWEET_ID_MASK. could you do a git grep and change it everywhere?",659703390,2017-04-04 00:40:05
24023661,2880538,114419331,1,Please add the copyright comment at the top of each file (and make sure it is for 2017),682778581,2017-05-03 03:39:11
24023661,2880538,114421758,19,Typo: conversions?,682778581,2017-05-03 03:50:41
24023661,12105170,114646343,1,Added.,682778581,2017-05-04 03:34:18
24146060,2880538,114891626,25,"I am not sure if IntIterator is appropriate here. We use Int for our current edges because we have the internal mapping from Long to Int, but for Metadata I thought we were only using Long. Should we just name it EdgeMetadataIterator and not extend the In",685425182,2017-05-05 04:26:24
24146060,2880538,114897958,15,I think something like EdgeMetadataIntIteratorImpl is a more descriptive name.,685425182,2017-05-05 05:01:10
24146060,12105170,114906126,25,"This interface is an int edge iterator with access to edge metadata, not an edge metadata iterator. 
The original class name meant to say IntIterator with access to edge metadata. Now I change the name to WithEdgeMetadataIntIterator to make it more clear",685425182,2017-05-05 05:57:00
24146060,12105170,114924788,15,changed. ,685425182,2017-05-05 09:41:56
24314873,2880538,115570237,23,"Just to make sure:

1) For favorites, the edge timestamp is the timestamp of the Favorite.
2) For retweets, replies etc, the edge timestamp is the timestamp of the original tweet
3) Why do we treat isMentioned and isMediatagged separately? Can't we ju",689120378,2017-05-10 01:46:19
24314873,2880538,115563718,18,typo: th -> the,689120378,2017-05-10 01:20:57
24314873,12105170,115616472,23,"1. For favorites, the edge timestamp is the timestamp of the Favorite.
Yes. 
2. For retweets, replies etc, the edge timestamp is the timestamp of the original tweet
For retweets, replies and quotes, the edge metadata is the intermediate tweet id, which",689120378,2017-05-10 05:21:15
24314873,12105170,115616462,18,changed. Thanks for catching this!,689120378,2017-05-10 05:21:13
24375037,360007,116049002,2,"Consider just using one of the many publicly available Pair implementations: https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/Pair.html

I've also often found that there is many times a better solution than using a p",690783836,2017-05-12 00:12:45
24375037,12105170,116113381,2,"Sure. I will use the apache one. Originally I thought to add a new Pair here will have one less external dependency. 

I am using it to return (LongList(node), LongList(metadata)), and the LongList inside does not have auto-boxing.  ",690783836,2017-05-12 05:05:14
24375037,360007,116114703,2,"Right, in that case I'm not sure why using a pair is better than returning a class that can be more easily interpreted. Might be worth thinking about whether there is solution that avoids the object creation if that shows up as an overhead while profiling",690783836,2017-05-12 05:12:56
24375037,12105170,116120005,2,"The original social proof that GraphJet returns is Map<EdgeType, LongList>, and the new social proof that GraphJet returns is Map<EdgeType, Pair<LongList, LongList>>, and here Pair usage has the lowest memory impact. Alternatively, we could create a new C",690783836,2017-05-12 05:49:25
24411927,360007,116132397,7,"also, perhaps a more descriptive name is ConnectingUsersWithMetadata",691056824,2017-05-12 07:35:38
24411927,360007,116132244,7,would be good to add a small doc,691056824,2017-05-12 07:33:53
24448573,2880538,116390508,32,Same here,691828887,2017-05-15 03:59:50
24448573,2880538,116390380,16,I think this is redundant.,691828887,2017-05-15 03:53:05
24448573,2880538,116390569,24,"Since this is internal and the naming is ""not important"" interface-wise, should we reuse the 3rd party apache pair class?",691828887,2017-05-15 04:03:21
24448573,12105170,116395048,16,"I want to get rid of this line too. Internally, the capacity of the array grows as a multiple of 2. There are situations like the size of the array is 5, but the capacity is 8. If we do not call trim function here, the following line, new LongArrayList(so",691828887,2017-05-15 07:22:03
24448573,12105170,116395052,32,Ditto!,691828887,2017-05-15 07:22:12
24448573,12105170,116395110,24,"All 3rd party apache pair classes are based on generics, and when it holds a pair of longs, it will autobox them into object Longs, which this internal class avoids.",691828887,2017-05-15 07:23:58
26667858,12105170,128592914,20,"the name of the test suggests taking four arguments, but the actual test is for a negative number of nodes? a couple of other test cases with the name ""four arguments"" seem to have the similar mismatch. ",740890032,2017-07-21 01:20:15
26667858,12105170,128594434,54,one space before null,740890032,2017-07-21 01:26:41
26667858,12105170,128591933,24,"Could you use NullStatsReceiver nullStatsReceiver = new NullStatsReceiver() everywhere instead of DefaultStatsReceiver(""a"")? In fact, you can just use new NullStatsReceiver() whenever a statsReceiver is expected in the codes without having to declare a se",740890032,2017-07-21 01:15:58
26667858,3163687,129115635,24,Corrected,740890032,2017-07-25 01:24:39
26667858,3163687,129116219,20,Corrected.,740890032,2017-07-25 01:26:59
26667858,3163687,129116667,54,Corrected.,740890032,2017-07-25 01:28:30
26667858,12105170,129638592,43,"nitpick: in GraphJet code base, we prefer to have each line of code shorter than 100 characters. for example, in this line, it is better to break it into two or three different lines.",744348335,2017-07-27 00:19:17
26667858,12105170,129637419,55,"not a big fan of super long function names... When a test case fails, the test file name appends the failed test case name in the error message. in this case, it will say RegularDegreeEdgePoolTest.testFailsToCreateRegularDegreeEdgePoolTakingThreeArguments",744348335,2017-07-27 00:14:50
26667858,3163687,129654677,43,Corrected.,744348335,2017-07-27 01:17:46
26667858,3163687,129654704,55,Corrected.,744348335,2017-07-27 01:17:52
26996769,12105170,130669599,19,change testOne and testTwo to something more specific. ,747833992,2017-08-02 00:15:14
26996769,12105170,130669822,10,could you remove the date here and everywhere else?,747833992,2017-08-02 00:15:52
26996769,3163687,130707658,19,Done.,747833992,2017-08-02 02:41:49
26996769,3163687,130707692,10,Done.,747833992,2017-08-02 02:41:56
27066005,6597183,131022942,60,for (long timestamp : allMetadata) {,749839738,2017-08-03 06:33:22
27066005,12105170,130967421,2,2017,749839738,2017-08-03 02:04:16
27066005,12105170,131188746,37,it is a bit confusing here to mix the usage of min and young in the context of a timestamp. could you look at RecentTweetFilter? There we compare each value with a cutOff threshold. ,751516408,2017-08-03 23:16:52
27157873,12105170,131015724,40,indentation,751469100,2017-08-03 05:43:00
28788237,12243029,145299819,36,s/testFilterResultReturningFalseTwo()/testWithRecentTweetFilter(),811267460,2017-10-18 08:47:57
28788237,12243029,145299522,26,This test is almost equivalent to testNoFilter() where the socialProof array and resultNode values are changed. Can we reuse the existing setup and merge them under the same test function?,811267460,2017-10-18 08:44:55
28788237,12243029,145300112,41,s/aNDFilters/andFilters,811267460,2017-10-18 08:50:53
28788237,12243029,145300071,37,"Variables should generally be named by its designed purpose, i.e. in this case the var linkedList should be called something like ""filters""",811267460,2017-10-18 08:50:23
28788237,12243029,145301443,15,The GraphJet codebase adopts a 2-space convention. Could you trim the spacing in this file?,811267460,2017-10-18 09:04:53
28788237,12243029,145300152,42,s/smallArrayBasedLongToDoubleMapArray/socialProofs,811267460,2017-10-18 08:51:25
28788237,3163687,145717107,26,Done.,811267460,2017-10-19 21:29:20
28788237,3163687,145717887,36,"Renamed method.
I consider your comment requesting to change the name of the method.",811267460,2017-10-19 21:31:49
28788237,3163687,145718275,41,Done.,811267460,2017-10-19 21:32:59
28788237,3163687,145718558,42,Done.,811267460,2017-10-19 21:33:52
28788237,3163687,145719076,15,Done.,811267460,2017-10-19 21:35:40
28788237,3163687,145718125,37,Done.,811267460,2017-10-19 21:32:32
29626535,12243029,143583645,2,2017 :),804050074,2017-10-10 04:39:24
29626535,12243029,143584770,90,"nitpicking on style: prefer smaller functions.
- Each loop here can be abstracted into a separate function to make the main loop more readable
- Guard clause can reduce the number of nesting. ex: 
`  if (edgeIterator == null) { 
      continue; 
    ",804050074,2017-10-10 04:45:39
29626535,12243029,143584029,2,ditto,804050074,2017-10-10 04:41:34
29626535,12243029,143584003,2,ditto,804050074,2017-10-10 04:41:28
29626535,12243029,143586105,74,"Could you be more specific on what interactions refer to, because ""social proofs"" for entities can refer to the users, actions (edges), or the right nodes (tweets), we should be as specific here as possible",804050074,2017-10-10 04:53:14
29626535,12243029,143585244,102,Is the casting here necessary? Double casting feels suspiciously redundant,804050074,2017-10-10 04:48:19
29626535,12243029,143587148,31,"It looks like these fields are internal, and hence can be made private. Prefer getter/setters over direct class field access. You can make these fields private and assign them values by passing them in through the class constructor :)",804050074,2017-10-10 04:59:12
29626535,2880538,143588732,49,Update the naming in the comments -> EntitySocialProofGenerator (and also update the comments appropriately everywhere),804050074,2017-10-10 05:09:14
29626535,2880538,143589543,62,Wrap the types in parentheses,804050074,2017-10-10 05:14:32
29626535,12243029,144149308,62,nit: 2 space,805329509,2017-10-12 05:08:02
29626535,12243029,144151986,57,"I think the concept of ""entity"" in GraphJet's namespace is ""node metadata"". Can we generalize this class to be ""NodeMetadataSocialProofGenerator"" instead?",805329509,2017-10-12 05:23:55
29626535,12243029,144150403,35,Could you add the descriptions to the social proof layers here as well?,805329509,2017-10-12 05:14:23
29626535,12243029,144150799,73,nit: 2 space,805329509,2017-10-12 05:16:47
29626535,12243029,144148499,169,nit: 2 space,805329509,2017-10-12 05:03:14
29626535,12243029,144149075,18,nit: fix spacing. ,805329509,2017-10-12 05:06:50
29626535,12243029,144148974,27,nit: function definition can be placed on the same line,805329509,2017-10-12 05:06:14
29626535,12243029,144148755,40,nit: 2 space,805329509,2017-10-12 05:04:50
29626535,12243029,144149295,58,nit: 2 space,805329509,2017-10-12 05:07:56
29626535,12243029,144147985,136,"style nit: 
either
`if (edgeIterator == null) continue;`
or place the { continue; } on separate lines",805329509,2017-10-12 05:00:09
29626535,12243029,144150840,88,nit: 2 space,805329509,2017-10-12 05:17:01
29626535,12105170,144344870,72,"this assumption (<10) is just from our first use case, and once we expose the api, there will be clients sending requests more than 10 to this api. it is better not to rely on the mercy of clients in library implementation. e.g. we can choose OpenHashSetM",806442038,2017-10-12 23:40:49
29626535,12105170,144341993,166,Integer => int,806442038,2017-10-12 23:29:39
29626535,12105170,144347256,87,"1. will at most => will have at most
2. better not to say ""at most"" a specific max value in the library code. 

We choose ArrayMap over OpenHashMap since the request will have at most a few edge types, usually less than five.
",806442038,2017-10-12 23:50:20
29626535,12105170,144346986,70,Variables such as socialProofs and socialProofWeights are re-used for each request.,806442038,2017-10-12 23:49:05
29626535,12105170,144343901,71,s/chose/choose/g in every file. ,806442038,2017-10-12 23:37:19
29626535,12105170,144340334,41,s/Integer/int prefer int over Integer whenever possible,806442038,2017-10-12 23:23:06
29626535,12105170,144342223,51,EMPTY_SOCIALPROOF_MAP => EMPTY_SOCIAL_PROOF_MAP,806442038,2017-10-12 23:30:33
29626535,12105170,144374897,149,"sometimes clients might want to fetch the social proof for both hashtags and urls in one call, can we support that?",806527267,2017-10-13 01:35:43
29626535,12105170,144370968,45,metadatas => metadata,806527267,2017-10-13 01:22:37
29626535,12105170,144372738,123,"it is cleaner to have a reset function including those two clear functions, and it is better to call the reset function in computeRecommendations right before collectRecommendations. 

could you fix the other TweetSocialProof Generator as well?",806527267,2017-10-13 01:28:30
29626535,12105170,144371574,152,inputIds => inputNodeMetadataIds,806527267,2017-10-13 01:24:54
29626535,12105170,144374120,127,is it possible to fetch multiple node metadata types in one request?,806527267,2017-10-13 01:32:50
37309864,12243029,178946389,71,"This isn't necessarily an edge filter, but a node filter instead. If there are new engagements to an old tweet, it would be filtered out because the tweet itself is too old. I believe you are either looking for RecentTweetFilter through filterChain, or th",965116179,2018-04-04 03:08:30
37309864,12243029,178954534,67,"The new graph type does not actually add authorId information, is it missing a commit?
",965116179,2018-04-04 03:37:39
38768047,12243029,186220819,40,nit: update comment,999757489,2018-05-05 04:01:45
38768047,12243029,186229870,44,"nit: this is actually the size of compressed metadata. Might as well call it ""compressed""/""packed""MetadataSize to avoid confusion",999757489,2018-05-05 04:50:01
38768047,12243029,186232333,9,"We should have a TODO item to consolidate the edge types into one file. Currently this is scattered into several places (tweet/TopSecondDegreeByCountForTweet, tweetfeature/TopSecondDegreeByCountForTweet, and here), which might pose problems in the future",999757489,2018-05-05 05:06:40
38768047,12243029,186230738,19,"Nit: In addition to the gotchas, would be nice to document the compression mechanism we are using here as well, i.e the schema of mutable features and immutable features in the int array, for clarity purposes",999757489,2018-05-05 04:55:59
38768047,12243029,185883103,13,"Essentially, this function does more than just one thing - iterate all segments to retrieve feature counts, populate the metadata array, and lastly set immutable features. If they need to live inside one function, could we make these actions clear in the ",997790144,2018-05-04 00:43:30
40130084,12105170,191851198,61,"This getLeftNodeEdges in the for loop is an expensive step. What it does is to retrieve all the engagements for a user, and since it happens inside a for loop, it will retrieve all the engagements for all users specified in tweetAuthors.

One alternativ",1026408434,2018-05-31 00:18:08
40130084,12243029,191871951,61,"The performance concern is totally fair, I had similar thoughts on this. However, combing the 2 filters feels a bit hacky, as the author sets for whitelist and blacklist could be different. I think it is the caller's responsibility to acknowledge the cost",1026408434,2018-05-31 01:19:41
40130084,6922330,192226978,55,"let us query for blacklist tweets only when whitelist is empty. Otherwise, we are querying for blacklist tweets all the time.",1027600704,2018-06-01 03:28:48
45971310,12105170,218592719,48,could you add more comments on why this change is necessary?,1137981076,2018-09-19 03:58:43
46103726,12105170,219265476,29,complete comments?,1140208108,2018-09-21 01:11:27
46979707,12105170,222847844,86,"Generally speaking, we should avoid creating request object inside an algorithm. The request is the input, and the underlying algorithm could parse it and convert it to something else internal, but rewriting requests is not a good idea.

In this case, d",1156118562,2018-10-05 05:34:55
46979707,12243029,222851167,86,"Agree, yes in this case we just need to find a way to squeeze in the unfavorite social proof types into the algorithm. 
I did it this way to decouple the unfavorite logic from the remainder of the class logic, though now thinking back I agree this is mor",1156118562,2018-10-05 05:53:50
24923733,2011749,118962771,134,"when running the unit tests, this fails with kvImageRoiLargerThanInputBuffer",702274750,2017-05-29 23:22:35
24923733,2011749,118962827,4,"should alphebetize imports (keeping <> imports first and """" imports second)",702274750,2017-05-29 23:23:13
24923733,2011749,118963220,106,"this seems to assume alpha, is that correct?   What if the image has no alpha?",702274750,2017-05-29 23:27:39
24923733,2011749,118963922,96,This is returning CGImageAlphaInfo value (same as CGImageGetAlphaInfo returns) --- likely a bug in Apple's framework failing to properly convert the CGImageAlphaInfo to CGBitmapInfo.  I think you should use CGImageGetAlphaInfo and do the conversion yourse,702274750,2017-05-29 23:35:02
24923733,523163,118999762,106,"Yes - I believe the an alpha channel should be always included in the output (please correct me if I'm misunderstanding here). As I understand, if the source image has no alpha channel, `vImage` will just fill the alpha channel of the destination with ful",702274750,2017-05-30 08:44:19
29084207,30370591,141178661,4,"Looks like we don't need this declaration anymore?
http://answers.unity3d.com/comments/1100699/view.html
I tested the project w/o it and the composer was presented successfully.",792586842,2017-09-27 03:44:12
29084207,471737,141180214,4,"Right- I've always forward-declared it in my plugins, should I want to compile a static library. But since you all include the .mm as part of the Unity project, that line is perhaps unnecessary.",792586842,2017-09-27 03:50:07
28086552,8562599,137692704,106,I don't think we use these comparators?,771457573,2017-09-08 08:29:39
28086552,8562599,137692448,17,"No big deal, but these are out of order",771457573,2017-09-08 08:26:47
28086552,839832,137694335,106,"They're used in CoreSerializers#getComparatorSerializer, though we might be able to remove that if it's not useful",771457573,2017-09-08 08:46:09
28086552,8562599,137696786,106,It looks like we're only using them in tests? Let's just get rid of them.,771457573,2017-09-08 09:14:02
31019037,184275,150062560,3,Since function is private you can just remove it without modifying the public API.,832398647,2017-11-10 03:27:03
31024773,73249,150085041,17,final,832507977,2017-11-10 05:00:05
31024773,73249,150085136,24,final,832507977,2017-11-10 05:00:25
31024773,8562599,150089275,24,"Also, this is copying the string as well. Why are we removing this code at all? Is this code suspect as well?",832507977,2017-11-10 05:18:26
31024773,8562599,150087863,33,\>=,832507977,2017-11-10 05:12:31
31024773,8562599,150088791,75,"This is copying the string into a byte array, right? Can you avoid that?",832507977,2017-11-10 05:16:16
31024773,8562599,150087795,24,"Also, you should move this into the else below",832507977,2017-11-10 05:12:14
31287994,184275,151445173,6,Is this still required for a Java only project?,838482931,2017-11-16 23:26:22
31287994,184275,151445569,15,I think we can just use `packaging jar`.,838482931,2017-11-16 23:27:27
31287994,184275,151448817,45,All these values can be moved to gradle.properties,838482931,2017-11-16 23:37:44
31287994,184275,151448972,49,project.VERSION_NAME -> VERSION_NAME,838482931,2017-11-16 23:38:16
31287994,73249,151494808,15,"Based on our POM file here, https://repo1.maven.org/maven2/com/twitter/serial/serial/0.1.5/serial-0.1.5.pom, I think it's actually ""packaging 'aar'"" that we want. Agree that we don't need this ternary though",838482931,2017-11-17 02:14:35
31287994,73249,151494906,45,"Ah okay, I wasn't sure what should go there, so I just put stuff I expected would change, i.e. just the version name",838482931,2017-11-17 02:14:56
31287994,73249,151495119,6,"Good question, file an issue or send a PR for this to discuss separately, I'm not sure.",838482931,2017-11-17 02:15:49
31287994,184275,151527416,15,I think JAR is the correct value since the artifact is a jar file.,838482931,2017-11-17 04:23:37
37075110,8562599,177967844,5,"Ah thanks! Do you mind adding the `@NotNull` annotations as well, for consistency?",959886140,2018-03-29 14:01:19
37075110,6570061,177968016,5,"oh,I'll check it.",959886140,2018-03-29 14:02:36
29029695,1614541,140807140,40,back to /twitter/scoot? + line 43,789359468,2017-09-25 22:16:32
29029695,9795471,140380822,56,"I don't really  understand this script, but... is this change supposed to be in this repo (scootdev/scoot) or in the new twitter/scoot repo?",789359471,2017-09-22 06:10:43
29029695,912560,140381467,56,"Nope, I made this in the twitter repo and then thought better of it and moved it here.",789359471,2017-09-22 06:15:12
29174894,1614541,141654343,7,"Can we init log.Fields and then add to it? i.e. add c.runningID, then use a single 'if' to add runningCmd fields that drops the need for 'else'. (nit) Same for l287",795001299,2017-09-28 22:36:36
29236208,912560,141988734,5,"This doesn't work, the full string is an actual command. You may need to do some escaping though.",796079543,2017-09-30 06:45:53
29236208,1614541,141993101,5,"Will update, as is I was getting syntax error running this script (it had an early closing single quote)",796079543,2017-09-30 08:05:57
29568526,8324668,143358088,36,super duper nit: might be more clear to wg.Add(1) in each goroutine,802659931,2017-10-08 22:44:32
29568526,8324668,143358043,5,What's the motivation behind these changes?,802659931,2017-10-08 22:42:21
29568526,912560,143477543,5,These tests fail when my macbook has a high load.,802659931,2017-10-09 21:08:20
29568526,912560,143477650,36,I believe it needs to be done outside of the goroutines.,802659931,2017-10-09 21:08:46
29685030,8324668,144019709,11,Is this still true? (i.e. priority=2 jobs can kill other tasks),804783760,2017-10-11 20:59:31
29685030,8324668,144019340,5,Curious - what are you taking into account when adjusting this value? Could you add a short comment?,804783760,2017-10-11 20:58:23
30241733,8324668,147234254,2,Think the pkg level comments only work if there isn't a blank line between comment & pkg name,817751531,2017-10-27 01:50:53
30241733,8324668,147218673,67,ditto,817751531,2017-10-27 00:53:34
30241733,8324668,147218636,63,*marshal,817751531,2017-10-27 00:53:28
30241733,912560,147293672,46,This may be redundant.,817751531,2017-10-27 06:30:04
30241733,912560,147293600,52,Does this get used?,817751531,2017-10-27 06:29:24
30241733,912560,147293636,31,This may be redundant.,817751531,2017-10-27 06:29:43
30300227,1614541,146912561,4,does this do anything?,817921623,2017-10-25 23:26:10
30300227,1614541,146912017,2,"Can we add a package-level comment describing what this test is for? At this point it would also be nice to have a small comment on the readme w/ a one-liner summary of the various tests and what they are for (swarm, recovery, integration)",817921623,2017-10-25 23:24:02
30300227,1614541,146911302,3,"just ""tests"" based on dir conventions? unless this to work around some travis or +build issue",817921623,2017-10-25 23:21:10
30300227,8324668,146917056,2,yep definitely,817921623,2017-10-25 23:42:06
30300227,8324668,146917006,4,yeah - running this test creates a tests/.scootdata dir that we don't want in here,817921623,2017-10-25 23:41:53
30300227,8324668,146920776,3,"not sure I understand the question. Are you suggesting this should be in the ""tests"" pkg? Or asking if it's in the ""tests_test"" pkg b/c of dir conventions?

If the former, we've been using <pkg>_test pkg naming convention.
If the latter, yes :)",817921623,2017-10-25 23:55:47
30300227,1614541,146951553,3,"Oh, hm. I forgot this is another golang thing. Either is acceptable and depends on whether the test is white or black box. I think here it's definitely black box so _test is appropriate.",817921623,2017-10-26 01:47:16
30300227,912560,146998325,118,This should split on ':' and take the first entry.,818661317,2017-10-26 04:56:50
30392035,8324668,147236547,15,Recommend logging ctx.Err() if it == context.DeadlineExceeded so we know this is happening,819538260,2017-10-27 01:59:26
30392035,8324668,147263923,14,Quick nit - could you add a comment providing context for the... context. It isn't immediately clear looking at this why exec.Cmd.CombinedOutput() would need a timeout,819649608,2017-10-27 03:53:49
30628664,9795471,148255829,25,"I've been trying to understand the scheduling algorithm - need much more time to digest it, perhaps we can review it in tech discussion and update the write up.... given that:
- config.SoftMaxSchedulableTasks will be ever increasing since config.SoftMaxS",824137753,2017-11-01 20:12:54
30628664,8324668,149197952,26,Still a little concerned about this line - seems weird that it never resets & is always increasing.,829114599,2017-11-07 04:45:04
30628664,912560,149591248,26,"Ok, I took that part out since it appears to be more confusing than useful.",829114599,2017-11-08 15:26:00
30952228,1614541,150248458,119,"""jobsRuning"" -> ""jobsRunning"" (at least it's consistent!)",831127472,2017-11-10 22:30:56
30952228,1614541,150249160,128,"Assuming this format ""<req>_<num>"" is easy enough to group on in viz?",831127472,2017-11-10 22:33:51
30952228,1614541,150248085,75,"Nit that we are mixing use of ""//"", ""/* ... */"", and ""/* * * * * */"" styles",831127472,2017-11-10 22:29:15
30952228,9795471,150252380,75,fixed,831127472,2017-11-10 22:47:05
30952228,9795471,150254717,119,"fixed
",831127472,2017-11-10 22:56:11
30952228,8324668,150257260,39,extra n,833208958,2017-11-10 23:06:13
30952228,9795471,150260169,39,fixed,833208958,2017-11-10 23:17:32
31189751,145409,151645858,13,"Would it be possible to drop the size >= 0 constraint, and remove size from the addressing information of blobs?

I have desires to fetch digests without knowing how big they are in advance, and it feels like passing size=-1 is a better way of doing tha",838163261,2017-11-17 18:05:35
31189751,145409,151647158,107,"In line with my other comment about size, can you drop the GetReadOffset() >= resource.Digest.GetSizeBytes() check (and make the check be against the actual underlying blob's real size)?",838163261,2017-11-17 18:11:24
31189751,145409,151650903,5,You probably don't actually want a trailing space here; log.Info will add one,838163261,2017-11-17 18:28:31
31189751,145409,151648152,133,Why are you re-subtracting this after it was already subtracted on line 133?,838163261,2017-11-17 18:15:55
31189751,145409,151650239,234,"As we're not implementing resumable writes, it feels like we probably want to error if this isn't set to true, and always break.",838163261,2017-11-17 18:25:33
31189751,1614541,154177208,234,"I'd like to circle back on resumable writes soon - mainly taking a shortcut there. I think we still need this as even without resumables, we have to loop over the this and check each request that is part of the write stream.",838163261,2017-12-01 03:29:46
31189751,1614541,154244608,5,Space is actually needed here,838163261,2017-12-01 08:56:01
31189751,912560,154672318,7,PrePost?,853038937,2017-12-04 23:02:25
31189751,912560,154671995,234,"I think we shouldn't break when we can reasonably satisfy a request. That said, depending on how long we keep some manner of shortcut, if it should be an error to upload something that's inordinately large or taking too much time between each write.",838163261,2017-12-04 23:01:19
31189751,912560,154527631,5,How does this work with parenthesis instead of brackets? Also GOPATH needs to be split on the first instance of ';' if any.,853038937,2017-12-03 23:49:07
31189751,912560,154672899,10,Link? And what does a grpc name look like?,853038937,2017-12-04 23:04:23
31189751,912560,154674380,12,sp: accessing. I'm not sure what the implications of this are / why we can't check for 40 or 64 digits and act accordingly.,853038937,2017-12-04 23:09:16
31189751,912560,154670704,16,"This could use more comments, i.e. why does this need three identifiers, two of which are unique?",853038937,2017-12-04 22:56:56
31189751,912560,154676278,18,The naming change from bundlestore -> store seems incomplete? When are we choosing to use one or the other?,853038937,2017-12-04 23:16:04
31189751,1614541,154747780,18,"I'm not renaming bundlestore to store, I just separated Store into its own package so it is portable. If anything bundlestore should be apiserver or blobserver or storeserver or something now.",853038937,2017-12-05 03:18:26
31189751,1614541,154747174,12,"this was mainly for by-hand testing convenience, e.g. write with grpc then read with http. the APIs are not really cross-compatible for other reasons, though, so I left out naming derestriction for http until there is a real reason to have it",853038937,2017-12-05 03:16:00
31189751,1614541,154746046,234,"that's not what this is doing, the GetFinishWrite is the end of a normal successful write request. the write server could probably use some timeout or safeguard but this is fine for v1/now",838163261,2017-12-05 03:12:18
31189751,1614541,154745510,5,Updated to work with split gopaths. Parens because makefile.,853038937,2017-12-05 03:10:13
31189751,1614541,154746102,7,changed to just prefix,853038937,2017-12-05 03:12:30
31189751,1614541,154745560,16,added,853038937,2017-12-05 03:10:24
32105955,145409,155225817,32,FYI this is implemented in https://github.com/pantsbuild/pants/pull/5179 (but currently only used for read operations). Write operations coming soon!,856736120,2017-12-06 20:45:02
32105955,145409,155204905,37,This ended up getting changed to --local-store-path because it turns out pants uses -s everywhere. Sorry about that!,856736120,2017-12-06 18:59:52
32105955,145409,155226390,32,"As soon as we support write operations (probably next week), I'll start publishing compiled fs_util binaries somewhere useful :)",856736120,2017-12-06 20:47:49
32105955,8324668,155291049,32,cool! looking forward to giving it a whirl,856736120,2017-12-07 00:41:14
32105955,8324668,155291066,37,no prob ???? ,856736120,2017-12-07 00:41:17
32105955,1614541,155636955,20,"Should return ""bz-\<hash\>-\<size\>""?",856736120,2017-12-08 04:50:21
32105955,1614541,155639425,46,default case should probably return an err,856736120,2017-12-08 05:00:35
32105955,1614541,155590077,8,"Nit, but prefer these to be more specific for readability. Like ""bzCmdDirectory"" or something (or maybe it's just me). Also include ""materialize"" here.",856736120,2017-12-08 01:36:27
32105955,1614541,155640707,24,"plus comment on expected filer usage wrt ""command""",856736120,2017-12-08 05:05:46
32105955,1614541,155590642,46,"I don't think it's safe to access output here, or at least it defies usual ""output, err := "" conventions",856736120,2017-12-08 01:38:56
32105955,1614541,155638208,30,Prefer to error log and no-op rather than panic,856736120,2017-12-08 04:55:47
32105955,1614541,155607169,6,nit - ordering,856736120,2017-12-08 02:47:47
32105955,1614541,155641352,175,would add a check against returned ID here to make sure it checks out - should be able to expect hardcoded hash and size 0 from empty temp file (see also later comment on ID returned form Ingest),856736120,2017-12-08 05:08:33
32105955,1614541,155638663,19,same comment about logging output,856736120,2017-12-08 04:57:42
32105955,1614541,155640361,25,"Need to parse and validate output, and return ID conforming to our expectation of bz-\<digest\>-\<size\> format. In our cases, fs_util returns ""\<digest\> \<size\>"".

We should probably have a couple util functions for all ID-related operations - genera",856736120,2017-12-08 05:04:26
32105955,1614541,155590814,49,want to log var id instead of directory?,856736120,2017-12-08 01:39:43
32105955,8324668,155892155,30,For this one I just copied the implementation from dbaAdapter - I prefer an error log no-op too and will change both.,856736120,2017-12-09 06:37:09
32105955,1614541,155904598,14,add bzCheckout,859758324,2017-12-09 08:28:31
32105955,1614541,155903186,25,use the constants here,859758324,2017-12-09 08:11:04
32105955,1614541,155906983,52,"can ditch this, no expected output",859758324,2017-12-09 09:00:20
32105955,1614541,155905223,24,"might as well make ""save"" a const as well",859758324,2017-12-09 08:35:46
32105955,1614541,156121135,23,unused?,861239126,2017-12-12 00:18:50
32105955,1614541,156124716,8,"save interface might want to return string (for snapshot ID). materialize, I don't think needs any output beyond error. WDYT?",861239126,2017-12-12 00:29:50
32105955,1614541,156122698,32,"this impl. function will have to do its own conversion from fs_util output into a bazel snapshot id before we can validate - fs_util returns space-separated hash/size, and lacks the bz- prefix",861239126,2017-12-12 00:23:25
32449067,145409,156895773,4,"Technically the pants release here is 1.4.0dev23, and fs_util is just a part of the pants release.",864204236,2017-12-14 17:46:46
32449067,145409,156895827,22,$arch isn't set anywhere,864204236,2017-12-14 17:47:00
32449067,145409,156899323,71,"You should be able to assert on the actual expected size and sha here, rather than just that they're non-empty?

Handy hint for manually doing this kind of thing, to generate a binary serialized proto you can run something like:
```
echo ""files: {
  ",864204236,2017-12-14 18:01:38
32449067,145409,156899408,129,As above,864204236,2017-12-14 18:01:58
32449067,145409,156899639,175,"Look for the right files (and maybe their contents)?

Just running `diff` on the two directories should do the job pretty easily.",864204236,2017-12-14 18:02:55
32449067,1614541,156791933,56,same thing about first go path. may want to be a function that lives in common/,864204236,2017-12-14 05:34:53
32449067,1614541,156786918,27,"GOPATH supports ':' separated lists, so we should do what Makefile is doing with FIRSTGOPATH",864204236,2017-12-14 05:15:19
32449067,1614541,156797077,14,"I am wondering what we should use as our filer root directories - we may want to initialize bzFilers to a certain root location (or a temp by default) - so that these can be easier to inspect.

This is more of an optimization, but it might be nice to se",864204236,2017-12-14 05:55:24
32449067,1614541,156790882,35,"Why is this needed? Assuming a setup such as: /var/bazel/sandbox/ is our root and we want to ingest /var/bazel/sandbox/foo (foo being a dir), does `fs_util directory save --root /var/bazel/sandbox foo` not work?

I'm guessing this is because of somethin",864204236,2017-12-14 05:30:32
32449067,1614541,156981534,24,"Have to say I am not a fan of this pattern, strongly prefer explicit parameter list that constructs bzcommand as required. If this was an external API, maybe, but this is a specific interface implementation and not likely to cause breaking changes",864204236,2017-12-14 23:50:55
32449067,8324668,157000105,22,"whoops, good catch. thanks",864204236,2017-12-15 00:51:43
32449067,8324668,157000182,71,"cool, thanks for the tip",864204236,2017-12-15 00:52:01
32449067,8324668,157001344,24,"My hope was to avoid having MakeBzFiler, MakeBzFilerWithLocalStore, MakeBzFilerWithServerAddr, MakeBzFilerWithLocalStoreAndServerAddr, & all the other possible options when skipServer and skipLocalStore are enabled",864204236,2017-12-15 00:56:12
32449067,8324668,157001308,14,"agreed - think that would be very useful. I'll throw in the option to not blow away on Release in here, and we can think more about how we'd want these root dirs to look like and implement later.",864204236,2017-12-15 00:56:05
32449067,1614541,157007305,24,"We wouldn't need more than one constructor - MakeBzFiler("""", """", false, false) would create the filer with no local store, no server addr, skip options disabled for example.  I will leave this one up to you to change or leave as-is",864204236,2017-12-15 01:17:50
32449067,8324668,157066129,35,"you have to specify the globs to save - your example would save foo but not any files contained in foo, for that you would need foo/*",864204236,2017-12-15 05:26:28
32545309,8324668,157598193,133,"task.Command.SnapshotID is required too, right?",866096017,2017-12-19 04:56:18
32545309,8324668,157598364,128,"Obvious, but could you add something slightly more explicit wrt what's left TODO",866096017,2017-12-19 04:56:59
32545309,1614541,157602131,133,Adding later in another ticket - putting snapshot in now will basically just make these tasks fail every time since they aren't likely to be available. Will add a todo,866096017,2017-12-19 05:13:57
32672037,8324668,158349382,14,"Looks like TimeMarker never gets updated. Is that the intent? If so, why not just use TimeCreated?",868469346,2017-12-22 02:41:34
33095256,1614541,159538487,32,Would add one more TODO about moving some of this boilerplate response struct generation into a function later,879276502,2018-01-04 05:58:39
33095256,1614541,159538880,51,what's this for?,879276502,2018-01-04 06:00:50
33095256,8324668,159539469,51,"just to explicitly differentiate responses dependent on request, it isn't necessary at all.",879276502,2018-01-04 06:04:00
33208461,8324668,160175133,14,Are there any particular internal modifications you think are likely to be necessary?,881589518,2018-01-08 23:42:35
33208461,8324668,160177830,64,"""worker will retrieve Command""
How? From where?",881589518,2018-01-08 23:51:09
33208461,8324668,160177474,32,"Could you structure this log to make it more easily searchable?
  ",881589518,2018-01-08 23:49:55
33208461,8324668,160177157,4,"Somewhat obvious, but could you link e.g. https://godoc.org/google.golang.org/genproto/googleapis/devtools/remoteexecution/v1test#Digest next to struct declarations to clarify their origin ",881589518,2018-01-08 23:48:54
33208461,1614541,160185000,4,Sure will add,881589518,2018-01-09 00:15:26
33208461,1614541,160185323,64,"Worker will retrieve the command from the CAS, will make comment more clear",881589518,2018-01-09 00:16:36
33208461,1614541,160184900,14,"Not really, if anything it gives us a type alias and potentially protects from changes in googleapis struct",881589518,2018-01-09 00:15:04
33208461,1614541,160185037,32,Sure,881589518,2018-01-09 00:15:35
33208461,8324668,160190671,14,"I wonder if those are worth the slight complexity add. I don't have a strong opinion either way, up to you.",881589518,2018-01-09 00:34:03
33382304,8324668,160813363,1,Note to self: Change this comment before merging,885114258,2018-01-11 06:13:29
33382304,8324668,160853036,2,Note to self: Change this comment before merging,885114258,2018-01-11 10:41:57
33382304,1614541,160989857,5,package_prefix,885114258,2018-01-11 23:47:24
33382304,1614541,160988239,18,Why the '_'?,885114258,2018-01-11 23:41:51
33382304,1614541,160987406,20,"I just added this for runner.Commands (see runner/runner.go - doesn't add anything when nil), that's what the String() funcs in bazelapi are for",885114258,2018-01-11 23:38:20
33382304,1614541,160990126,5,"package_prefix

ugh, maybe we should just reference the Makefile target in these comments so we have a canonical source of truth and generation method?",885114258,2018-01-11 23:48:17
33382304,1614541,160989642,7,package_prefix,885114258,2018-01-11 23:46:44
33382304,8324668,160991744,18,Not sure - that's what the thrift generated,885114258,2018-01-11 23:52:54
33382304,8324668,160992007,5,"yeah, I think that's a good call",885114258,2018-01-11 23:53:43
33382304,8324668,160993077,20,"Gotcha. The duplication of fields is a little weird though. There ends up being 2 ExitCodes and a StdoutRef, StdoutDigest, and StdoutRaw (+ errs) for a RunStatus with an ActionResult",885114258,2018-01-11 23:56:52
33382304,1614541,160994602,20,Sure - could add an additional short/truncated string function to bazelapi and use that here,885114258,2018-01-12 00:01:20
33644360,912560,162118506,25,It's not immediately clear what this is used for.,890371468,2018-01-18 01:14:56
33644360,8324668,162106540,53,*server,890371468,2018-01-18 00:35:45
33644360,8324668,162105797,32,"Don't need to specify, 0 will be the default value. Think a constant would be good here though",890371468,2018-01-18 00:33:25
33644360,8324668,162102602,26,Would be nice to have a GetReadResourceNameDefault that doesn't take an instance or fname,890371468,2018-01-18 00:23:20
33644360,8324668,162107867,20,"It looks like we aren't doing anything with context.Background(), why not use grpc.Dial(serverAddr)?",890371468,2018-01-18 00:40:02
33644360,1614541,162409461,25,this was useless; removed,890371468,2018-01-19 01:11:17
33644360,1614541,162409491,20,"yep, done",890371468,2018-01-19 01:11:24
33644360,1614541,162409517,26,done,890371468,2018-01-19 01:11:29
33644360,8324668,162994979,84,"Will this work if we have multiple filers with IDC's? E.g. the first x to return error, and the last to return is successful, then I think initErr will be nil.",893381782,2018-01-23 00:42:26
33644360,1614541,163011546,84,"initErr only gets set if the IDC returned a non-nil error, so although it can get overwritten, it can't get overwritten with nil (and we log all the individual failures)",893381782,2018-01-23 01:36:53
33644360,1614541,163012287,78,This has to be broken up because of the way some of our tests and implementations are - they expect if no IDC was given the controller will be available immediately after the constructor returns (this will fail race detector tests). We could make those im,893381782,2018-01-23 01:39:42
33644360,8324668,163030129,7,*in,895529830,2018-01-23 02:44:31
33644360,8324668,163031023,84,ah yep you're right - missed that,893381782,2018-01-23 02:47:40
33644360,912560,163066072,11,"Remind me, what is fname for and why is it optional?",895551043,2018-01-23 04:58:10
33644360,912560,163064158,67,Truncated,895529830,2018-01-23 04:51:22
33644360,912560,163072958,219,Can't you just close the ch once here?,895551043,2018-01-23 05:25:59
33644360,912560,162751864,23,Does this actually accomplish #3 above?,892180659,2018-01-20 06:53:53
33644360,912560,162753626,44,"How does the rest of cmd get filled, ex: priority?",892180659,2018-01-20 07:04:57
33644360,912560,162752824,27,nit - should this happen in the caller instead?,892180659,2018-01-20 06:59:44
33644360,912560,163074637,119,"All this locking stuff seems unwieldy, I can't easily tell if it's necessary. It seems like you can just use yet another channel and send it the run type every time the respective ticker updates.",895551043,2018-01-23 05:32:57
33644360,912560,162761177,17,Is there another method that users would expect?,893191295,2018-01-20 08:04:02
33644360,912560,163071759,67,"A little late for this comment, but why is this considered a runner?",895551043,2018-01-23 05:21:11
33644360,912560,163067523,3,This doesn't seem like an accurate description.,895551043,2018-01-23 05:04:05
33644360,912560,162735366,13,Doesn't seem like a useful default.,893191295,2018-01-20 05:23:57
33644360,1614541,163271873,23,"yes, the hand of grpc/protobuf is merciful and kind. I might update this later to data: ' ' (nothing w/ length 1) as it still works, and certain underlying internal blob stores do not accept 0 length",892180659,2018-01-23 23:10:34
33644360,1614541,163274569,17,removing. I guess I had in mind some of the other scoot semantics for Stores that try to transparently support local alternatives,893191295,2018-01-23 23:18:15
33644360,1614541,163275203,11,part of the Bazel API spec - described in remote_execution.proto in the description of the ContentAddressableStore service. there is a fair amount of subtlety described in the API this way  https://github.com/googleapis/googleapis/blob/master/google/devto,895551043,2018-01-23 23:20:13
33644360,1614541,163276446,3,updating,895551043,2018-01-23 23:24:05
33644360,1614541,163278262,44,The handler in bazel/execution/service.go:execReqToScoot does this. The only things unavailable at that level are the argv/env vars. Adding comments to execReqToScoot,892180659,2018-01-23 23:29:17
33644360,1614541,163278312,27,"makes sense, will move",892180659,2018-01-23 23:29:25
33644360,912560,163278484,11,"Ugh, I'm not a fan of this api. Could you elaborate a little in the github comments about our interpretation of: 

""the client MAY reuse the `uuid` for uploading
// different blobs. The `resource_name` may optionally have a trailing filename
// (or ot",895551043,2018-01-23 23:29:47
33644360,1614541,163283149,67,"runs underlying bazel operations... I'm open to other suggestions here, this would be easy to change. BzTreeer? BzFs? etc",895551043,2018-01-23 23:43:07
33644360,145409,163285924,23,"FWIW as of https://github.com/pantsbuild/pants/pull/5378

`fs_util --local-store-path=/Users/dwagnerhall/tmp/store --server-address=localhost:12100 directory save --root=/ ''`

should work. I can put together a pre-release binary if you want to try it",892180659,2018-01-23 23:50:50
33644360,1614541,163287073,219,"We start N updateTickers in separate goroutines, not sure how if we recv on one the others will get the message?",895551043,2018-01-23 23:54:08
33644360,1614541,163288841,119,"I'm using the lock only when tickers update the map of bool flags that indicate what filers have update requests, and then once in the loop to read & reset the flags.  To queue these up on a channel it would have to be buffered -- to what length? how do u",895551043,2018-01-23 23:58:58
33644360,1614541,163291344,23,"oh, by certain underlying stores I mean Blobstore :) gives us an HTTP 411 for doing that",892180659,2018-01-24 00:05:46
33644360,1614541,163291942,11,"Yeah, I don't totally understand the point of the fname fragments as there is no prescribed behavior on how to use it on the server - perhaps just for logging as you indicated. Will add a comment on uuid",895551043,2018-01-24 00:07:31
33644360,912560,163305802,119,"Why does it have to be buffered? They end up being processed serially right? Seems like we can do a blocking send and ultimately it doesn't matter if it gets backed up or not, although I'd expect it shouldn't with reasonable ticker times.",895551043,2018-01-24 00:48:11
33644360,912560,163306256,219,"All the goroutines will receive ""_, notOK := <-ch"" when a channel is closed afaik.",895551043,2018-01-24 00:49:33
33644360,912560,163306883,67,"Seems confusing to reuse the term runner, anything else would be better as long as it's unique or thematically consistent.",895551043,2018-01-24 00:51:31
33644360,1614541,163332803,219,Ah yes - thanks,895551043,2018-01-24 02:24:09
33644360,1614541,163334055,119,"I think an updater could get starved out in this case, if the request channel has a request and before it's drained by the updater (some task is running and taking a while), several updaters hit their tick again and compete to make the next request. Possi",895551043,2018-01-24 02:28:39
33644360,912560,163343217,119,True. In that case I'd use a single ticker with the gcd of filer intervals and then on each tick loop through the filers seeing who all deserves a turn.,895551043,2018-01-24 02:59:52
33644360,912560,163343348,119,"Up to  you though, whatever you think will be the most understandable.",895551043,2018-01-24 03:00:23
33644360,8324668,162991593,50,I wonder if it would make sense to also validate the ID in the case of a standard Scoot snapshot,893381782,2018-01-23 00:32:02
33644360,8324668,162994816,78,"I think you can just call wg.Wait(), and it will immediately pass if it was never added to (i.e. if wait was never set to true)",893381782,2018-01-23 00:41:55
33908389,8324668,163078530,23,"I think you can just have ns.node here, the %s calls String() on it",895672780,2018-01-23 05:48:42
33908389,912560,163275901,30,It's not clear to me - why did you change from logging NodeState to logging Node?  We're losing a lot of useful information by doing this.,895672780,2018-01-23 23:22:26
33908389,8324668,163614510,66,"can just have ns.node here, %s calls String() which calls Id()",897555169,2018-01-25 01:10:08
33908389,8324668,163614418,73,"Think we still want %#v on ns, and the first %v can be a %s for ns.node instead of ns.node.Id()",897555169,2018-01-25 01:09:56
33908389,8324668,163613524,82,"can just have ns.node here, %s calls String() which calls Id()",897555169,2018-01-25 01:06:54
33908389,8324668,163613002,86,"can just have ns.node here, %s calls String() which calls Id()",897555169,2018-01-25 01:05:35
33908389,9795471,163629784,66,"fixed
",897555169,2018-01-25 02:06:50
33908389,9795471,163629834,73,fixed,897555169,2018-01-25 02:07:03
33908389,9795471,163629870,86,fixed,897555169,2018-01-25 02:07:11
33908389,9795471,163630764,30,fixed - was trying to get logging to print the wily node content instead of its address,895672780,2018-01-25 02:10:34
33908389,9795471,163630188,82,fixed and reverted to printing ns (all of nodeState),897555169,2018-01-25 02:08:25
33908389,9795471,163630971,23,fixed and reverted to using ns,895672780,2018-01-25 02:11:22
33908389,912560,163665470,13,"And what was the reason for going from #%v to %s? If I remember correctly, I changed this so it would print the field names rather than just bare values. ",897606342,2018-01-25 04:15:28
33908389,9795471,163669310,13,"using %s trigger using ns.String() which prints the host name, shard id as well as the IP address from update.Node.  ns.String() prints field name as well as values.  The big difference is that it does not print readyCh nor removedCh.
You can see the dif",897606342,2018-01-25 04:30:48
34267924,9795471,165113010,76,"Can we print what type the filer was? 
fmt.Errorf(""postProcessBazel() expected filer to be a BzFiler, instead it was %s"", reflect.TypeOf(filer))
",903029365,2018-02-01 00:43:14
34267924,9795471,165115938,141,"put 'skipping' on the error message.
",903029365,2018-02-01 00:52:29
34267924,9795471,165124686,174,just curious.... this doesn't really abort the ingest does it?,903029365,2018-02-01 01:21:04
34267924,9795471,165114920,116,"continuing error handling comment from above.....
this is where we would put the stack trace on the error (see github.com/pkg/errors - already in vendors)",903029365,2018-02-01 00:49:31
34267924,9795471,165120109,148,"put 'is' in the message: ""Expected output file %s is not a regular file""",903029365,2018-02-01 01:05:55
34267924,9795471,165121265,49,do we really want to remove this TODO- it seems to be a reasonable comment to me.,903029365,2018-02-01 01:09:29
34267924,9795471,165120688,188,add 'is',903029365,2018-02-01 01:07:36
34267924,9795471,165123035,98,this is a lot of code in this if block - can it be pulled into a well-named/documented function?,903029365,2018-02-01 01:15:15
34267924,9795471,165120465,181,add 'skipping',903029365,2018-02-01 01:06:58
34267924,9795471,165113810,81,"I've been thinking about our error handling.... should we include the stack trace on the initial error generation,  these sorts of 'if err != nil {}' blocks simply return the error and have the top level that finally resolves the error print the stack tra",903029365,2018-02-01 00:46:03
34267924,1614541,166047779,49,"I don't feel these TODOs about design level decisions add anything. No one is going to notice this comment and then implement its suggestion, and todo's are not an issue tracking system. IMO todos should not be checked into master branch, but I found this",903029365,2018-02-06 01:29:26
34267924,1614541,166048218,174,"It lets the worker go and do something else, but the actual ingestion keeps going (same as existing behavior)",903029365,2018-02-06 01:31:07
34267924,1614541,166048852,98,"Had thought about that. As-is I left the ""Scoot"" type behavior inline and broke out the Bazel processing. Will break some of this out into a post-process piece",903029365,2018-02-06 01:33:35
34267924,912560,166058188,49,"I agree and disagree. TODO's are useful to document things that are unintuitive, behaviorally or semantically, yet appear to work, and therefore don't warrant polluting jira. In this case, it's unlikely that anyone will ever be impacted, but you *did* not",903029365,2018-02-06 02:08:20
34548814,1614541,166705684,48,I think this is fine w/out the note - metrics is a bigger todo tracked internally,906829196,2018-02-08 02:10:35
34548814,1614541,166706376,52,"For all the errors in these top-level api-defined function, return errors only as  grpc/status.Error(<grpc/codes.Code>, ""<user-digestable message>"") since these are client-facing. see other return examples. there might be a few returns that were in here a",906829196,2018-02-08 02:12:52
34548814,1614541,166725544,95,Add Digest of the action here - I think that's the only additional EOM data required. This might be a good candidate for adding a field to the bazelapi wrapper data struct (record once in the Execute function when we initially calculate the ActionDigest a,906829196,2018-02-08 03:17:39
34548814,1614541,166729595,62,Might want to move this validation and retrieval of runStatus to small function,906829196,2018-02-08 03:31:02
34548814,1614541,167657333,250,should be fine with 'normal' errors here since top-level is wrapping into a status.Error,915689976,2018-02-13 03:14:52
34861072,1614541,167717550,5,"just checking - supposed to be a ""%2B"" here or ""+""?",915925183,2018-02-13 07:17:13
34861072,145409,167721370,5,"Technically it's a `+` in the version number, but it needs to be `%2B` in the curl command line. This seemed nicer than `pants_release_urlencoded=""$(perl -MURI::Escape -e ""print uri_escape('${pants_release}');"")""` and putting that in the `curl`s, but I ca",915925183,2018-02-13 07:37:46
34929730,912560,168083349,4,"This was resulting in double writes to the response header, which isn't allowed. (io.Copy() calls Write() which sets status=200=OK as the final header content).",917150410,2018-02-14 14:02:19
35306987,1614541,169998323,51,was the 'break' a bug before?,924117744,2018-02-22 23:41:15
35306987,912560,170003829,51,"Since new retry jobs have to match previous jobs, would could exit early before, but now we want to unconditionally iterate across all jobs with the same requestor.",924117744,2018-02-22 23:56:32
35306987,8324668,170073367,28,"Could you expand on this point? Do retries get assigned a non-unique ""retry"" tag?",924117744,2018-02-23 03:49:15
36014750,8324668,174483170,44,"nit: for all of these, can just fmt.Errorf(errstr)",943387279,2018-03-14 21:43:09
36014750,8324668,174482253,24,why?,943387279,2018-03-14 21:40:40
36014750,8324668,174482118,23,"maybe log.Errorf(Error retrieving Bazel command data: %v"")",943387279,2018-03-14 21:40:15
36014750,8324668,174485677,62,ditto,943387279,2018-03-14 21:49:54
36014750,8324668,174295090,27,Is this confirmed as being part of the API spec?,943387279,2018-03-14 04:46:09
36014750,8324668,174484678,9,curious - why this change?,943387279,2018-03-14 21:47:19
36014750,8324668,174299263,41,"nit: this main() is a little long, consider splitting into addSubcommands, addSubcommandFlags, etc.",943387279,2018-03-14 05:03:12
36014750,8324668,174484144,74,Do we need to check if cmd.ExecuteRequest is nil to avoid a nil pointer dereference?,943387279,2018-03-14 21:45:54
36014750,8324668,174485289,37,"don't need this, right?",943387279,2018-03-14 21:48:48
36014750,1614541,174617971,27,Yes - had this clarified in the Bazel API Revisions  gdoc,943387279,2018-03-15 04:37:34
36014750,1614541,174618232,23,added,943387279,2018-03-15 04:38:36
36014750,1614541,174618199,41,added a few comments and grouped flags w/ subcommands to make a bit clearer,943387279,2018-03-15 04:38:31
36014750,1614541,174618279,44,"done, thanks",943387279,2018-03-15 04:38:45
36014750,1614541,174618809,24,"added comments here and in bazel/cas/service about returning NotFoundError. kind of an open question what the standard for errors should be - bubbling up vs wrapping in a new err, when to log, etc.",943387279,2018-03-15 04:40:53
36014750,1614541,174618970,74,"We should never hit that case, the first thing we do in the bazel workflow is check that ExecReq is non nil",943387279,2018-03-15 04:41:37
36014750,1614541,174619541,9,We have always been testing packages during the coverage step multiple times because we are not uniq'ing between for loop iterations,943387279,2018-03-15 04:43:56
36014750,1614541,174619590,37,"removed both, thanks",943387279,2018-03-15 04:44:07
36014750,8324668,174875157,9,gotcha - nice catch,943387279,2018-03-16 00:55:15
36014750,8324668,174877240,74,Gotcha. Think it'd still be worth using the helper method cmd.ExecuteRequest.GetActionDigest() from https://github.com/twitter/scoot/pull/362/files#diff-9776fc4ea2a6e05f737bf7c9ef6106bfR58?,943387279,2018-03-16 01:01:03
36014750,1614541,174879472,74,"ohh, yes, thanks",943387279,2018-03-16 01:07:44
36592442,1614541,176421247,27,"Worth checking here? No check in Offline request, and if for some reason the state changes between now and when the request is processed, the requestor won't know what happened anyway.",949974323,2018-03-22 20:37:17
36592442,8324668,176780618,27,True - will remove.,949974323,2018-03-23 22:54:23
36592442,8324668,176783511,27,"Ah - remembered we need this check, ns is used for the add. Can put a similar check in OfflineWorker for consistency.",949974323,2018-03-23 23:02:53
36767459,8324668,176856407,27,"should there be a `return nil, err` here? (for the case that `err` isn't a `*cas.NotFoundError`",953460163,2018-03-24 03:35:13
36767459,1614541,176857487,27,Nah - no reason to fail the run - we just want to log that we weren't able to check the cache (metrics to come),953460163,2018-03-24 03:40:57
36767459,8324668,176861838,27,"whoops, missed the ! in !ok",953460163,2018-03-24 03:59:29
37051406,1614541,178085858,12,"If this passes for internal use as well, could define once as a default in setup.go (or if not in default but we want to reuse, throw under common somewhere)",959433605,2018-03-29 22:04:24
37051406,1614541,178085044,7,Only suggestion is returning an iota int64 type with an entry for unknown that can be returned e.g. when the func is not compatible with the os,959433605,2018-03-29 22:01:50
37703837,8324668,180818001,7,Job 4 when one of those finishes?,973734949,2018-04-11 23:29:35
37703837,8324668,180819847,108,Looks like this isn't accurate based on line 294,973734949,2018-04-11 23:35:42
37703837,8324668,180820058,67,ditto per line 294,973734949,2018-04-11 23:36:29
37703837,912560,180900842,5,I believe this was a recent addition of mine that is meant to handle the case where worker goes offline/online and we abort the old run. So I think we still need this but you can verify if that sounds suspect.,974032103,2018-04-12 04:15:57
37703837,912560,180901791,5,"Let's adjust these to be a little more fair, it's too easy for p0 tasks to starve when everything seems to be high priority. Maybe .15, .3, .55? I'd like this rewritten or at least moved to a config file but I don't think you want to do that in this PR.",974032103,2018-04-12 04:19:34
37703837,912560,180903331,57,I'm not entirely sure if this is just for P3. Do you think the if-statement above is sufficient to handle the node lost case?,974032103,2018-04-12 04:25:55
37703837,912560,180904316,209,Should this be a warn or err?,974032103,2018-04-12 04:30:10
37703837,1614541,181141452,57,"I was trusting the comment here stating that this section should only get hit in the P3 case, which would have already handled cleanup.

Assuming for a sec that this could be hit in the node lost case as well - would we want to return like this block wa",974032103,2018-04-12 23:20:44
37703837,1614541,181141603,5,"Will update, but yeah will skip a refactor here",974032103,2018-04-12 23:21:13
37703837,1614541,181141993,5,"This bool was only set in the ""if ta.running != nil"" block, and that taskAssignment.running field was only ever set in the assign() function when we went to steal a node from killableTasks. With the removal of killable tasks there's not longer an entry po",974032103,2018-04-12 23:22:37
37703837,1614541,181142090,209,will warn,974032103,2018-04-12 23:22:52
37703837,912560,181223654,57,"On second thought, let's trust the comment at face value.

That said, I think what's bothering me is the handling of jobState.numTimesTried if a node hiccups and comes back. We may need to keep the 'preempted' arg and set it to true if the nodeId is the",974032103,2018-04-13 04:13:22
37703837,912560,181223823,5,"See other comment, I may have missed an edge case in my last fix, and we may still need this.",974032103,2018-04-13 04:14:12
38423688,8324668,184183325,7,`nodeReAdded = (&nodeStInstance.readyCh != &nodeSt.readyCh)` would make this _slightly_ easier to read imo,990279460,2018-04-26 02:42:27
38586044,8324668,185246640,22,Why do we need to log a start before an end?,994303338,2018-05-01 22:18:56
38586044,912560,185267476,22,https://github.com/twitter/scoot/blob/master/saga/saga_state.go#L267,994303338,2018-05-01 23:39:47
38586044,8324668,185290714,22,Ah - would be nice if that dir had a README just to clarify what saga updates are allowed and when.,994303338,2018-05-02 01:08:56
41006318,8324668,196220904,35,nit: *curry30goat,1043027316,2018-06-19 03:51:14
41006318,8324668,196235236,25,"Just a thought - setting these timing fields sprinkled throughout the codebase could end up being somewhat difficult to find. 

How would you feel about making the runTimes fields (e.g. invokeStart, invokeEnd, etc...) some custom struct with a time.Time",1043027316,2018-06-19 04:43:28
41006318,8324668,196182974,45,"is this supposed to be ""google.golang.org/genproto/googleapis/devtools/remoteexecution/v1test""?",1043027316,2018-06-19 01:39:46
41006318,1614541,196254464,45,"yep, thanks",1043027316,2018-06-19 06:20:43
41006318,1614541,196254936,25,"Yeah... I added a crude alias around time.Now that at least makes these grep-able (I guess, the only way to strictly enforce would be to break out in a separate pkg with non-exported field names). Added a note that I'd like to end up breaking the invoker ",1043027316,2018-06-19 06:23:15
42505926,1614541,202832657,25,Suggest move to bazel/digest.go if making public,1072409608,2018-07-17 04:37:12
42794548,8324668,204880057,146,ditto,1080175508,2018-07-25 02:19:02
42794548,8324668,204879927,76,why?,1080175508,2018-07-25 02:18:34
42794548,8324668,204879825,58,this reads a little weird... not sure how to clean it up though. maybe just a little more context in the comment as to why this isn't counted as a request failure.,1080175508,2018-07-25 02:18:12
44461916,1614541,212142873,15,Dup of common/common.go:GetFirstGopath,1109362524,2018-08-23 06:34:52
44461916,1614541,212145719,117,Redundant?,1109362524,2018-08-23 06:51:41
44461916,8324668,212338975,117,"thanks, missed that",1109362524,2018-08-23 21:48:48
44868739,1614541,213889987,21,Let's use https://golang.org/pkg/os/#Symlink instead of exec here,1116796125,2018-08-30 09:48:45
44868739,1614541,213890875,12,Does this work here? This is pre checkout in invoker - does the symlink end up in the checkout working directory for the task run? Was assuming this logic would likely live in a function here and be called immediately after the checkout channel recv<- in ,1116796125,2018-08-30 09:56:42
44868739,1614541,213890389,17,"Suggest more generic prefix for errors here - ""Failed setting up platform property X: $reason"" ",1116796125,2018-08-30 09:52:32
44868739,1614541,213889900,4,"Add a leading comment so 'k=v,' format is clear",1116796125,2018-08-30 09:47:55
44868739,8324668,214101136,12,"Nope you're right, totally missed that. Good catch.",1116796125,2018-08-30 23:41:19
44868739,1614541,214198183,12,"I think this will not work if we get multiple properties and the first one is not ""JDK_SYMLINK"" - the if will get skipped and we'll send nil on the ch, even if the next prop was ""JDK_SYMLINK.""

This looks pretty dangerous being async - if there is ever ",1118005738,2018-08-31 05:19:14
44868739,8324668,214233749,12,Misunderstood your previous feedback. Submitting new diff...,1118005738,2018-08-31 09:57:50
45962214,912560,218585388,53,Not sure why you'd limit action results. I thought those are supposed to be small but I could be mistaken?,1137830801,2018-09-19 03:36:16
45962214,1614541,218599864,53,"It's more about controlling any access to the underlying resource, until we do something smarter like limit by bytes and use digests to count concurrent access.",1137830801,2018-09-19 04:22:30
45962214,912560,218602782,53,"Fair enough, if you have other plans in mind.",1137830801,2018-09-19 04:33:27
45978067,912560,218629049,6,Is it a possibility/problem if hash is EmptySha but size is not empty?,1138088921,2018-09-19 06:43:53
45978067,1614541,218630415,6,"It's unlikely but possible that could get passed somehow, but it's essentially an invalid digest and a sign that something was not computed or passed in correctly. Checking it is on the pedantic side but won't hide any errors that should surface because o",1138088921,2018-09-19 06:51:49
46538227,8324668,221337619,57,Wonder if we'll want this to be Warn or Error level...,1148303868,2018-09-29 01:09:49
47214841,8324668,223488969,37,do we need a `if runType == runner.RunTypeBazel`?,1160271360,2018-10-09 03:33:19
47214841,1614541,223492129,37,"yes, good catch, looks like a few of these are applicable",1160271360,2018-10-09 03:45:45
47214841,8324668,224623834,99,ditto,1163722945,2018-10-12 05:27:55
47214841,8324668,224623800,86,think this one needs an `if runType = runner.RunTypeBazel` too,1163722945,2018-10-12 05:27:47
47214841,1614541,224824726,86,"this one's OK, in a runtype bazel code path already",1163722945,2018-10-12 22:29:15
47214841,1614541,224824760,99,"this one was bad, fixed",1163722945,2018-10-12 22:29:18
31325192,32869,151808355,5,Looks like a typo: `s/requried/required/`.,839192252,2017-11-18 06:56:49
31325192,1731417,151839714,5,"Whoops - fixing now
",839192252,2017-11-18 23:14:39
31328415,1731417,151560552,6,"each call to lexeme allocates a new String, separating this out halves the number of strings generates.",839249867,2017-11-17 06:51:54
31328415,1731417,151560709,5,This is a very hot path - each call to ```tree.point``` created an instance of TreePointOps.,839249888,2017-11-17 06:52:49
31467905,32869,152131518,13,"As @retronym, the member of the Lightbend Scala compiler team, alluded to in the comments above, the Rsc typecheck phase does significantly more work than the Scalac namer phase. 

The namer phase in Scalac only traverses packages and top-level definiti",842613558,2017-11-21 06:37:24
31467905,32869,152131787,8,"As described in the comment above, please add `rscScheduler` here and rerun `sbt bench`.",842613558,2017-11-21 06:38:39
31467905,32878,152841878,8,"I won't have time to do this in the next couple of days, but I am happy to run this benchmark too. Can you share your code for rscScheduler? Any issue with going to 2.12.4 across the board, so we don't have an explosion of numbers? ",842613558,2017-11-24 00:35:35
31467905,2061461,152851593,8,We haven’t moved to 2.12 due to lack of Scala Native support. ,842613558,2017-11-24 01:29:37
31467905,32869,152895273,8,I've refactored our benchmarking infrastructure to accommodate both Scala 2.11 and Scala 2.12. Please see https://github.com/twitter/reasonable-scala/pull/27.,842613558,2017-11-24 12:13:51
31610596,32869,152891866,66,"@eed3si9n @dwijnand Can you provide some advice on deduplicating code in `benchScalac211` and `benchScalac212`? Files in these two projects are currently completely identical, which is clearly suboptimal, but I don't know how to make sbt do my bidding oth",845822900,2017-11-24 11:14:43
31610596,32869,152892472,66,"@retronym I've been meaning to compare notes wrt. scala/compiler-benchmark right after we opensourced Rsc, but forgot about that in the post-release rush. Looks like we have another good opportunity to chat.

Just like you guys, we found it useful to sp",845822900,2017-11-24 11:24:02
31610596,2061461,152903812,44,"You can resolve https://github.com/twitter/reasonable-scala/issues/22 in the pr while you're at it by adding:
```
.nativeSettings(nativeMode := ""release)
```",845822900,2017-11-24 14:30:55
31610596,32869,153035204,44,https://github.com/twitter/reasonable-scala/pull/27/commits/263273d91ce3c1e076d13c8f6c70f8658c158930,845822900,2017-11-25 09:05:42
31610596,2061461,153051045,66,It’s a bit hacky but I think you can use separate empty project directories and set them to have the same managed sources (or additional sources) to get around the fact that two projects can’t have the same directory.,845822900,2017-11-26 02:01:16
31610596,32869,153051436,66,"Interesting idea, thanks! Let's keep this in mind for the future.",845822900,2017-11-26 02:24:10
31610596,30452,153533956,66,"Sorry, with all the reasonable-scala repo activity I missed this notification was directly at me.

I too would go the way of adding a shared source directory to both projects.",845822900,2017-11-28 23:52:33
31689209,32869,153863770,6,How about we say `val lexeme = this.lexeme` here to avoid the need to think about names every time we need to cache lexeme?,847814101,2017-11-30 01:47:07
31689209,32869,153863830,1,The commit message has a typo.,847814101,2017-11-30 01:47:26
31689209,1731417,153864889,6,Thats a better name I agree.,847814101,2017-11-30 01:51:31
31689209,1731417,153864856,1,Last minute dash as my train pulled in - will fix.,847814101,2017-11-30 01:51:24
31689209,1731417,153869165,1,The commit message does not include the benchmark info - I can add it if desired.,847814101,2017-11-30 02:08:10
31689209,32869,153869559,1,"Thanks for the suggestion! Let me finish with `bin/benchQuick`, and then we'll rerun the benchmarks.",847814101,2017-11-30 02:09:45
31689209,32869,154263154,1,Almost there infrastructure-wise. Please take a look at https://github.com/twitter/reasonable-scala/pull/38.,847814101,2017-12-01 11:51:05
31689209,32869,154263238,1,"Also, there's still a typo in the commit message :) I'd expect it to say ""Avoid repeated calls to lexeme in hexadecimalNumber"".",847814101,2017-12-01 11:52:07
31689209,1731417,154276394,1,Do'h!   I stared at the commit message after your last comment and still missed it....,847814101,2017-12-01 14:35:46
31689209,1731417,154280252,1,fixed now....,847814101,2017-12-01 15:15:38
31903344,32869,154262756,7,"@densh We adopted this requirement from https://scala-native.readthedocs.io/en/latest/contrib/contributing.html#prepare-meaningful-commits, but I'm currently unsure how to check it automatically in Travis, since Travis seems to only run checks for the top",852302277,2017-12-01 11:45:49
31903344,32869,154263016,13,"@rorygraves In addition to testing performance of rscJVM, this new script now also tests peformance of rscNative, while also being able to automatically detect and highlight benchmark results. Running time went up slightly, but I think it's still tolerabl",852302277,2017-12-01 11:49:13
31903344,2061461,154263374,7,I don’t know of any automated feature.  I do know some people who will go to the effort of manually pushing every commit one right after the other to get them all to run.  Seems hard to get people to honor that though.,852302277,2017-12-01 11:53:50
31903344,2061461,154263487,7,How will this file be updated when we change our test files?,847062306,2017-12-01 11:55:34
31903344,32869,154263761,7,Will be addressed as part of https://github.com/twitter/reasonable-scala/issues/3.,847062306,2017-12-01 11:58:40
31903344,2061461,154263978,9,For every push to github?,852302276,2017-12-01 12:00:51
31903344,2061461,154264064,7,"Are we doing squash merges?  If so, then every commit to master will end up compiling and still make bisecting possible.",852302277,2017-12-01 12:01:57
31903344,32869,154265957,7,"This is a good argument for squash merges. @densh, is this why you guys are using them?",852302277,2017-12-01 12:28:32
31903344,32869,154267739,9,"I think it is useful to have full performance information about git history. For the current bench suite and bench box, we can do ~25-30 commits a day, which should be enough for the time being.",852302276,2017-12-01 12:52:13
31903344,2061461,154269849,9,"I wasn’t very clear here, I was suggesting a text change as we can’t actually make Travis-CI run on every commit.",852302276,2017-12-01 13:18:27
31903344,32869,154269964,9,"We can't trust Travis to run benchmarks. This will be done by a dedicated service that runs on our benchbox, implemented within https://github.com/twitter/reasonable-scala/issues/3.",852302276,2017-12-01 13:20:13
31903344,1731417,154280614,13,"This makes sense to me.  It is not that onerous on the developer and provides confidence.
 ",852302277,2017-12-01 15:19:16
31903344,53003,154395898,7,"I think Travis has a build-every-commit setting, it just isn't enabled by default?",852302277,2017-12-02 01:00:44
31903344,32869,154530689,7,"Hmm I just check and can't find it. Could it be that it's limited to the enterprise edition?

Btw, @SethTisue, since you're here. How do you deal with this at scala/scala?",852302277,2017-12-04 01:31:40
31903344,2061461,154530762,7,"All I know of is Travis has a “cancel existing build if a new commit comes in while building previous commit”.  This is not enabled by default and with that setting every push will be built, but not every commit.",852302277,2017-12-04 01:34:12
32555453,1731417,157335835,9,"This feels weird and non-obvious - it looks like null is lifted to 0 here.
I played with this code area because the originala keywords.getOrElseId generates a closure to return a constant value for ID.
I think if we are using the behaviour we should hid",866284160,2017-12-16 14:43:14
32555453,1731417,157335856,60,I think this should be moved to the companion - the map build will be per-run rather an an initialisation cost.,866284160,2017-12-16 14:44:22
32555453,32869,157344436,9,"This is somewhat obscure, I agree. 

Speaking of the proposed solution, how about instead we just create another constant in Tokens that says `final val NONE = 0` and then use `NONE` here?",866284160,2017-12-16 23:36:16
32555453,32869,157344464,60,Can you elaborate?,866284160,2017-12-16 23:38:23
32555453,1731417,157344510,60,"Of course. 
The val will be recomputed each time you instantiate an implementing class.  
Although when I went to look I realised its on the package object, so my point is moot.",866284160,2017-12-16 23:41:48
34497182,2061461,166501114,4,"I have no idea what this does, but if the branch passes I won't argue with it.",906418295,2018-02-07 10:05:10
34497182,32869,166501250,4,https://unix.stackexchange.com/questions/122845/using-a-b-for-variable-assignment-in-scripts,906418295,2018-02-07 10:06:20
32940677,1618206,159021822,15,"Hi @ra1028 ,

Use `[NSLocale currentLocale]` instead of using en_US locale so not to confuse with region dates.",875581652,2017-12-29 11:22:15
34350117,2465,174339076,7,"After a bit more exploring of modal-on-modal behavior, I noticed that `[viewController.presentedViewController dismissViewControllerAnimated:YES completion:nil];` was actually unnecessary since `SFSafariViewController` will dismiss by itself on ""dismiss"" ",904632070,2018-03-14 09:34:50
32609211,1578484,158570014,13,"Please use the following format

```
if (condition) {
  // do first thing
} else {
  // do second thing
}
```",867759676,2017-12-23 07:51:45
32951034,1578484,159100349,5,"this is an auto generated file and the typo is coming from a tool. it will be overwritten, so let's remove this from the PR.",875749149,2017-12-30 04:20:22
32951034,1578484,159100318,5,"this is an auto generated file and the typo is coming from a tool. it will be overwritten, so let's remove this from the PR.",875749149,2017-12-30 04:20:01
32951034,1578484,159100544,5,"this is a third party code, I don't think our repo is the appropriate place to fix the typo. let's remove this from the PR.",875749149,2017-12-30 04:22:29
32951034,1578484,159100336,5,"this is an auto generated file and the typo is coming from a tool. it will be overwritten, so let's remove this from the PR.",875749149,2017-12-30 04:20:13
36902637,30452,177036208,9,"this doesn't look unmanageable.

but as an alternative you might find https://github.com/dwijnand/sbt-travisci useful.",956357913,2018-03-26 16:56:20
42883096,2061461,204581909,124,Do we still use _root_ in semanticdb 4.0?,1079208611,2018-07-24 06:16:56
42883096,2061461,204583789,6,Why is this AnyRef with Permit instead of just Permit?,1079248991,2018-07-24 06:28:53
42883096,2061461,204584153,5,"I'm not intuitively understanding what items need _root_, like why scala.Tuple2 needs it but parser.this.Parser does not.",1079248991,2018-07-24 06:31:25
42883096,32869,204585536,124,"We no longer use the `_root_` prefix in the recent versions of SemanticDB, however we need this prefix in RscCompat to avoid inadvertent name capture until https://github.com/twitter/rsc/issues/141 is fixed.",1079208611,2018-07-24 06:39:37
42883096,32869,204586769,6,"Return types produced by RscCompat directly mirror the return types inferred by Scalac. 

In this case, Scalac infers the return type as `AnyRef with Promise`, because that's the normalized representation for the type of the anonymous class on the right",1079248991,2018-07-24 06:46:29
42883096,32869,204587329,5,"Current version of RscCompat qualifies everything as much as possible. In the case of `this` types, their qualifier must be an identifier, so we have to say `parsers.this.Parser`, not `com.twitter.util.Credentials.parser.this.Parser`.",1079248991,2018-07-24 06:49:55
42883096,824906,204584210,350,"Why is `InfoNotes` a `class` that is only instantiated once per instance of `TypePrinter` rather than an `object` in `class TypePrinter`?

Similarly for `GenSym` below.

Is this because you're thinking about moving these classes outside of `TypePrinte",1079208611,2018-07-24 06:31:49
42883096,824906,204582281,62,"How about handling destructuring binds for `val` and `var`? Currently they just go to `case _`, but at a minimum you should log a not implemented warning and include a `FIXME` comment.",1079208611,2018-07-24 06:19:10
42883096,824906,204581603,5,How is switching from `.toTypeMessage` to `.asMessage` related to introducing `RscCompat`?,1079208611,2018-07-24 06:15:04
42883096,824906,204586920,369,Add a brief comment explaining what a trivial prefix is. I don't really understand what's going on in here.,1079208611,2018-07-24 06:47:26
42883096,824906,204590129,243,"My understanding is ""λ"" is just a local type variable that the type lambda is bound to, but other names could be used instead. So that means the generated code could be stylistically inconsistent with other uses of type lambdas in the codebase, right? It ",1079208611,2018-07-24 07:09:06
42883096,824906,204582826,156,"It would help with readability to add a comment pointing out that `sym.desc` comes from an implicit conversion to `scala.meta.internal.semanticdb.Scala.ScalaSymbolOps`.

Yes, I realize that means I'm essentially asking to make the implicit more explicit",1079208611,2018-07-24 06:22:43
42883096,32869,204602334,5,"Tangentially. RscCompat requires the latest version of Scalameta (https://github.com/scalameta/scalameta/pull/1716), and upgrading to that version requires this change. I rebased the PR to factor out the upgrade into a separate commit: https://github.com/",1079208611,2018-07-24 08:45:56
42883096,32869,204602748,369,Fixed.,1079208611,2018-07-24 08:49:17
42883096,32869,204602840,350,"It's the other way around, actually - both of these classes were copy/pasted from elsewhere. You're right though - they both can be turned into objects. Fixed.",1079208611,2018-07-24 08:50:04
42883096,32869,204603061,243,"`λ` is a somewhat idiomatic to call this helper type alias, though it's definitely not a standard. As you said, it would be good to have this configurable.",1079208611,2018-07-24 08:51:43
42883096,32869,204603870,62,"I'm not completely sure about what exactly needs to be done in RscCompat, so I'd like to avoid extra noise on the console for the time being. However, I've introduced a fixme comment and added the corresponding ticket to the current milestone.",1079208611,2018-07-24 08:58:17
42883096,32869,204604623,156,"Extension methods like this one (e.g. `sym.owner`) are used very frequently across Scalameta, Scalafix and Rsc, so adding comments like that will likely be hard to pull off.

However, I do recognize the fact that the `scala.meta.internal.semanticdb` API",1079208611,2018-07-24 09:04:39
43026626,30452,205342225,6,(complete side-note: this is also available as [absolutePath](https://github.com/sbt/sbt/blob/v0.13.17/util/io/src/main/scala/sbt/Path.scala#L28) if you'd like),1081791174,2018-07-26 13:20:52
43026626,32869,205345707,6,Very nice!! I'm going to use this right away. Thank you :),1081791174,2018-07-26 13:42:09
43059813,32869,205598501,78,"I believe you'll need `str(""()"")` here.",1082413264,2018-07-27 03:51:43
43059813,32869,205599133,95,It looks like `pprintSym` would be a better name.,1082413264,2018-07-27 03:54:01
43059813,32869,205598211,66,"On a second thought, there seems to be a simpler solution for the limited subset of trees we're interested in: 1) get the original text via `doc.substring(range)`, 2) parse that text via `.parse[m.Term]`, 3) if the resulting term is ApplyInfix, insert par",1082413264,2018-07-27 03:50:32
43059813,32869,205597296,51,"Looks like this is what you need: https://github.com/xeno-by/scalameta/blob/master/semanticdb/metap/src/main/scala/scala/meta/internal/metap/RangePrinter.scala#L21-L45. Let's use that logic for now, and then we'll properly expose it in `scala.meta.Positio",1082413264,2018-07-27 03:47:10
43059813,32869,205590927,37,Looks like we don't need this logic at all. See below.,1082413264,2018-07-27 03:24:56
43059813,32869,205599572,98,"How about `typePrinter.pprint(s.TypeRef(s.NoType, sym, Nil))`? This will avoid the need for any changes to `TypePrinter`.",1082413264,2018-07-27 03:55:10
43059813,32869,205598726,95,Why does this method need to take `env`?,1082413264,2018-07-27 03:52:35
43059813,32869,205583649,72,`positionToTree`,1082413264,2018-07-27 02:58:23
43059813,32869,205598674,90,See related comment to the output test.,1082413264,2018-07-27 03:52:23
43059813,32869,205598747,102,Same question about `env`.,1082413264,2018-07-27 03:52:41
43059813,32869,205590785,72,"Also, it looks like we probably don't need this map at all. See below.",1082413264,2018-07-27 03:24:30
43059813,32869,205583846,90,I think you should be able to do `rewriteTargets.map.asPatch` instead of having an explicit accumulator.,1082413264,2018-07-27 02:59:03
43059813,32869,205573337,8,"I suggest we print originals for macro expansions, so that the code with inserted synthetics can not only successfully compile, but also successfully run and pass tests.",1082413264,2018-07-27 02:18:52
43059813,32869,205583445,70,"Try using `ctx.tree.collect` instead of manual traversal like it's done in ExplicitResultTypes. For RscCompat, manual traversal is necessary because we want to limit the scope, but for this rule I think the standard `ctx.tree.collect` will be fine.",1082413264,2018-07-27 02:57:44
43059813,32869,205598967,103,Why have this as a separate variable?,1082413264,2018-07-27 03:53:22
43059813,32995077,205605564,98,"This does something different. I just want to print the name of the symbol for this method, not the fully qualified path.",1082413264,2018-07-27 04:17:46
43059813,32869,205610910,98,"Okay let's use this code as is for now. Later on, I'll refactor the printers.",1082413264,2018-07-27 04:38:31
43059813,32995077,205612628,70,"It appears that I cannot build an Env made out of scopes with a `collect`, and I need that for the type printer.",1082413264,2018-07-27 04:45:41
43059813,32995077,205619564,98,I was able to replace this by just looking up the names in the document's symbols.,1082413264,2018-07-27 05:17:34
43059813,32869,205638426,70,Fair enough.,1082413264,2018-07-27 07:19:57
43079076,32869,205657441,81,@maxov This is needed to work around the extravagant way how ClassTag synthesis is done in Scalac: https://github.com/scala/scala/blob/v2.12.6/src/library/scala/reflect/package.scala#L59-L63. Adding this mechanism to Scalac wasn't my brightest idea ???? ,1082761560,2018-07-27 10:14:12
43079076,32869,205657086,5,This brings @maxov's improvements to MacroExpansionTree (https://github.com/scalameta/scalameta/pull/1722) and my improvements to m.Position (https://github.com/scalameta/scalameta/pull/1723).,1082761560,2018-07-27 10:10:26
43079076,32869,205657156,7,"@maxov It turned out that we never tested that scalafixOutput compiles, and it didn't ????",1082761560,2018-07-27 10:11:28
43079076,32869,205657308,59,"@maxov Not sure what you meant here, so I commented this out. Please add a test in a follow-up PR (or completely delete this check).",1082761560,2018-07-27 10:12:41
47231594,32869,223540307,4,"@retronym Have you by any chance published Jardiff to Maven Central? I couldn't find the binaries, so I had to copy/paste the source code.",1160520582,2018-10-09 08:41:34
